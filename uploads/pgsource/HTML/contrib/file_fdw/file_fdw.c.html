<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\file_fdw\file_fdw.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\file_fdw\file_fdw.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:25 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * file_fdw.c 
 *        foreign-data wrapper for server-side flat files (or programs). 
 * 
 * Copyright (c) 2010-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *        contrib/file_fdw/file_fdw.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/reloptions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_table.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/copy.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/explain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/vacuum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/fdwapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/foreign.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/restrictinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/sampling.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Describes the valid options for objects that use this wrapper. 
 */ 
</span><a name="LN43"></a><span class='Control'>struct</span> <span class='Declare_Struct'>FileFdwOption</span> 
<span class='Delimiter'>{ 
</span><a name="LN45"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>optname</span><span class='Delimiter'>; 
</span><a name="LN46"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>optcontext</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Oid of catalog in which option may appear */ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Valid options for file_fdw. 
 * These options are based on the options for the COPY FROM command. 
 * But note that force_not_null and force_null are handled as boolean options 
 * attached to a column, not as table options. 
 * 
 * Note: If you are adding new option for user mapping, you need to modify 
 * fileGetOptions(), which currently doesn't bother to look at user mappings. 
 */ 
</span><a name="LN58"></a><span class='Keyword'>static const </span><span class='Control'>struct</span> <a href="file_fdw.c.html#LN43"><span class='Ref_to_Struct'>FileFdwOption</span></a> <span class='Declare_Var'>valid_options</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Data source options */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"filename"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"program"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span> 
    <span class='Comment_Multi_Line'>/* Format options */ 
</span>    <span class='Comment_Multi_Line'>/* oids option is not supported */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"format"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"header"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"delimiter"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"quote"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"escape"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"null"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"encoding"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"force_not_null"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"force_null"</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>}, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * force_quote is not supported by file_fdw because it's for COPY TO. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Sentinel */ 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>} 
}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * FDW-specific information for RelOptInfo.fdw_private. 
 */ 
</span><a name="LN86"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>FileFdwPlanState</span> 
<span class='Delimiter'>{ 
</span><a name="LN88"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>filename</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* file or program to read from */ 
</span><a name="LN89"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_program</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* true if filename represents an OS command */ 
</span><a name="LN90"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>options</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* merged COPY options, excluding filename and 
                                 * is_program */ 
</span><a name="LN92"></a>    <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Member'>pages</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* estimate of file's physical size */ 
</span><a name="LN93"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>ntuples</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* estimate of number of data rows */ 
</span><a name="LN94"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>FileFdwPlanState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * FDW-specific information for ForeignScanState.fdw_state. 
 */ 
</span><a name="LN99"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>FileFdwExecutionState</span> 
<span class='Delimiter'>{ 
</span><a name="LN101"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>filename</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* file or program to read from */ 
</span><a name="LN102"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_program</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* true if filename represents an OS command */ 
</span><a name="LN103"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>options</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* merged COPY options, excluding filename and 
                                 * is_program */ 
</span><a name="LN105"></a>    <a href="../../src/include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Member'>cstate</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* COPY execution state */ 
</span><a name="LN106"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>FileFdwExecutionState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL functions 
 */ 
</span><a name="LN111"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN167"><span class='Ref_to_Func'>file_fdw_handler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN192"><span class='Ref_to_Func'>file_fdw_validator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * FDW callback routines 
 */ 
</span><a name="LN117"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileGetForeignRelSize</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN118"></a>                      <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN119"></a>                      <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileGetForeignPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN121"></a>                    <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN122"></a>                    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fileGetForeignPlan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN124"></a>                   <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN125"></a>                   <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                   <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>best_path</span><span class='Delimiter'>, 
</span><a name="LN127"></a>                   <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                   <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scan_clauses</span><span class='Delimiter'>, 
</span><a name="LN129"></a>                   <a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outer_plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN130"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileExplainForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileBeginForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>fileIterateForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN133"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileReScanForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileEndForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN135"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>fileAnalyzeForeignTable</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN136"></a>                        <a href="../../src/include/foreign/fdwapi.h.html#LN133"><span class='Ref_to_Typedef'>AcquireSampleRowsFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN137"></a>                        <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>totalpages</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN138"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>fileIsForeignScanParallelSafe</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN139"></a>                              <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Helper functions 
 */ 
</span><a name="LN144"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>is_valid_option</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>option</span><span class='Delimiter'>, </span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN145"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fileGetOptions</span><span class='Parentheses'>(</span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN146"></a>               <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, 
</span><a name="LN147"></a>               <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_program</span><span class='Delimiter'>, 
</span><a name="LN148"></a>               <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>other_options</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN149"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_file_fdw_attribute_options</span><span class='Parentheses'>(</span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>check_selective_binary_conversion</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN151"></a>                                  <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN152"></a>                                  <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>columns</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN153"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>estimate_size</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN154"></a>              <a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN155"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>estimate_costs</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN156"></a>               <a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Delimiter'>, 
</span><a name="LN157"></a>               <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>startup_cost</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>total_cost</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>file_acquire_sample_rows</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>onerel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, 
</span><a name="LN159"></a>                         <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>targrows</span><span class='Delimiter'>, 
</span><a name="LN160"></a>                         <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totalrows</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totaldeadrows</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Foreign-data wrapper handler function: return a struct with pointers 
 * to my callback routines. 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN168"></a><span class='Declare_Function'>file_fdw_handler</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN170"></a>    <a href="../../src/include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdwroutine</span> <span class='Operator'>= </span><a href="../../src/include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../src/include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN173"><span class='Ref_to_Member'>GetForeignRelSize</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN117"><span class='Ref_to_Proto'>fileGetForeignRelSize</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN174"><span class='Ref_to_Member'>GetForeignPaths</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN120"><span class='Ref_to_Proto'>fileGetForeignPaths</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN175"><span class='Ref_to_Member'>GetForeignPlan</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN123"><span class='Ref_to_Proto'>fileGetForeignPlan</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN212"><span class='Ref_to_Member'>ExplainForeignScan</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN130"><span class='Ref_to_Proto'>fileExplainForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN176"><span class='Ref_to_Member'>BeginForeignScan</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN131"><span class='Ref_to_Proto'>fileBeginForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN177"><span class='Ref_to_Member'>IterateForeignScan</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN132"><span class='Ref_to_Proto'>fileIterateForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN178"><span class='Ref_to_Member'>ReScanForeignScan</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN133"><span class='Ref_to_Proto'>fileReScanForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN179"><span class='Ref_to_Member'>EndForeignScan</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN134"><span class='Ref_to_Proto'>fileEndForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN217"><span class='Ref_to_Member'>AnalyzeForeignTable</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN135"><span class='Ref_to_Proto'>fileAnalyzeForeignTable</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN223"><span class='Ref_to_Member'>IsForeignScanParallelSafe</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN138"><span class='Ref_to_Proto'>fileIsForeignScanParallelSafe</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN170"><span class='Ref_To_Local'>fdwroutine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Validate the generic options given to a FOREIGN DATA WRAPPER, SERVER, 
 * USER MAPPING or FOREIGN TABLE that uses file_fdw. 
 * 
 * Raise an ERROR if the option or its value is considered invalid. 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN193"></a><span class='Declare_Function'>file_fdw_validator</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN195"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options_list</span> <span class='Operator'>= </span><a href="../../src/include/access/reloptions.h.html#LN260"><span class='Ref_to_Proto'>untransformRelOptions</span></a><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN196"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>catalog</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN197"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN198"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>force_not_null</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN199"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>force_null</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN200"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>other_options</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN201"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only superusers are allowed to set options of a file_fdw foreign table. 
     * This is because we don't want non-superusers to be able to control 
     * which file gets read or which program gets executed. 
     * 
     * Putting this sort of permissions check in a validator is a bit of a 
     * crock, but there doesn't seem to be any other place that can enforce 
     * the check more cleanly. 
     * 
     * Note that the valid_options[] array disallows setting filename and 
     * program at any options level other than foreign table --- otherwise 
     * there'd still be a security hole. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN196"><span class='Ref_To_Local'>catalog</span></a> <span class='Operator'>== </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a> <span class='Operator'>&& !</span><a href="../../src/backend/utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only superuser can change options of a file_fdw foreign table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that only options supported by file_fdw, and allowed for the 
     * current object type, are given. 
     */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN201"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN195"><span class='Ref_To_Local'>options_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN227"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN201"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../postgres_fdw/option.c.html#LN52"><span class='Ref_to_Proto'>is_valid_option</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN196"><span class='Ref_To_Local'>catalog</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN231"></a>            <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="file_fdw.c.html#LN43"><span class='Ref_to_Struct'>FileFdwOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opt</span><span class='Delimiter'>; 
</span><a name="LN232"></a>            <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Unknown option specified, complain about it. Provide a hint 
             * with list of valid options for the object. 
             */ 
</span>            <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="file_fdw.c.html#LN232"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN231"><span class='Ref_To_Local'>opt</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN58"><span class='Ref_to_Global_Var'>valid_options</span></a><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN231"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN45"><span class='Ref_to_Member'>optname</span></a><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN231"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN196"><span class='Ref_To_Local'>catalog</span></a> <span class='Operator'>== </span><a href="file_fdw.c.html#LN231"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN46"><span class='Ref_to_Member'>optcontext</span></a><span class='Parentheses'>) 
</span>                    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="file_fdw.c.html#LN232"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN232"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>", "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                                     <a href="file_fdw.c.html#LN231"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN45"><span class='Ref_to_Member'>optname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FDW_INVALID_OPTION_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid option \"%s\""</span><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="file_fdw.c.html#LN232"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> 
                     <span class='Operator'>? </span><a href="../../src/backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Valid options in this context are: %s"</span><span class='Delimiter'>, 
</span>                               <a href="file_fdw.c.html#LN232"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>) 
</span>                  <span class='Operator'>: </span><a href="../../src/backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"There are no valid options in this context."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !is_valid_option(def-... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Separate out filename, program, and column-specific options, since 
         * ProcessCopyOptions won't accept them. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"filename"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"program"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN197"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="file_fdw.c.html#LN197"><span class='Ref_To_Local'>filename</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * force_not_null is a boolean option; after validation we can discard 
         * it - it will be retrieved later in get_file_fdw_attribute_options() 
         */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_not_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN198"><span class='Ref_To_Local'>force_not_null</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"option \"force_not_null\" supplied more than once for a column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="file_fdw.c.html#LN198"><span class='Ref_To_Local'>force_not_null</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Don't care what the value is, as long as it's a legal boolean */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* See comments for force_not_null above */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN199"><span class='Ref_To_Local'>force_null</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"option \"force_null\" supplied more than once for a column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="file_fdw.c.html#LN199"><span class='Ref_To_Local'>force_null</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="file_fdw.c.html#LN200"><span class='Ref_To_Local'>other_options</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN200"><span class='Ref_To_Local'>other_options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN227"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now apply the core COPY code's validation logic for more checks. 
     */ 
</span>    <a href="../../src/include/commands/copy.h.html#LN29"><span class='Ref_to_Proto'>ProcessCopyOptions</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN200"><span class='Ref_To_Local'>other_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Either filename or program option is required for file_fdw foreign 
     * tables. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN196"><span class='Ref_To_Local'>catalog</span></a> <span class='Operator'>== </span><a href="../../src/include/catalog/pg_foreign_table.h.html#LN26"><span class='Ref_to_Const'>ForeignTableRelationId</span></a> <span class='Operator'>&& </span><a href="file_fdw.c.html#LN197"><span class='Ref_To_Local'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FDW_DYNAMIC_PARAMETER_VALUE_NEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"either filename or program is required for file_fdw foreign tables"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end file_fdw_validator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check if the provided option is one of the valid options. 
 * context is the Oid of the catalog holding the object the option is for. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN321"></a><span class='Declare_Function'>is_valid_option</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>option</span><span class='Delimiter'>, </span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN323"></a>    <span class='Keyword'>const </span><span class='Control'>struct</span> <a href="file_fdw.c.html#LN43"><span class='Ref_to_Struct'>FileFdwOption</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN323"><span class='Ref_To_Local'>opt</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN58"><span class='Ref_to_Global_Var'>valid_options</span></a><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN323"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN45"><span class='Ref_to_Member'>optname</span></a><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN323"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN321"><span class='Ref_to_Parameter'>context</span></a> <span class='Operator'>== </span><a href="file_fdw.c.html#LN323"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN46"><span class='Ref_to_Member'>optcontext</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN323"><span class='Ref_To_Local'>opt</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN45"><span class='Ref_to_Member'>optname</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN321"><span class='Ref_to_Parameter'>option</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch the options for a file_fdw foreign table. 
 * 
 * We have to separate out filename/program from the other options because 
 * those must not appear in the options list passed to the core COPY code. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN340"></a><span class='Declare_Function'>fileGetOptions</span><span class='Parentheses'>(</span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN341"></a>               <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_program</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>other_options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN343"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN344"></a>    <a href="../../src/include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN345"></a>    <a href="../../src/include/foreign/foreign.h.html#LN34"><span class='Ref_to_Struct'>ForeignDataWrapper</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wrapper</span><span class='Delimiter'>; 
</span><a name="LN346"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN347"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>, 
</span><a name="LN348"></a>               <span class='Operator'>*</span><span class='Declare_Local'>prev</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract options from FDW objects.  We ignore user mappings because 
     * file_fdw doesn't have any options that can be specified there. 
     * 
     * (XXX Actually, given the current contents of valid_options[], there's 
     * no point in examining anything except the foreign table's own options. 
     * Simplify?) 
     */ 
</span>    <a href="file_fdw.c.html#LN343"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN340"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN344"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN343"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN345"><span class='Ref_To_Local'>wrapper</span></a> <span class='Operator'>= </span><a href="../../src/backend/foreign/foreign.c.html#LN33"><span class='Ref_to_Func'>GetForeignDataWrapper</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN344"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN47"><span class='Ref_to_Member'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN345"><span class='Ref_To_Local'>wrapper</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN41"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN344"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN52"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN343"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN67"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN149"><span class='Ref_to_Proto'>get_file_fdw_attribute_options</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN340"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Separate out the filename or program option (we assume there is only 
     * one). 
     */ 
</span>    <span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>is_program</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN348"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN347"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN377"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN347"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN377"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"filename"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN377"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN347"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN348"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN377"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"program"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN377"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>is_program</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN238"><span class='Ref_to_Proto'>list_delete_cell</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN347"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN348"><span class='Ref_To_Local'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="file_fdw.c.html#LN348"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN347"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The validator should have checked that filename or program was included 
     * in the options, but check again, just in case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"either filename or program is required for file_fdw foreign tables"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="file_fdw.c.html#LN341"><span class='Ref_to_Parameter'>other_options</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN346"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fileGetOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Retrieve per-column generic options from pg_attribute and construct a list 
 * of DefElems representing them. 
 * 
 * At the moment we only have "force_not_null", and "force_null", 
 * which should each be combined into a single DefElem listing all such 
 * columns, since that's what COPY expects. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN414"></a><span class='Declare_Function'>get_file_fdw_attribute_options</span><span class='Parentheses'>(</span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN416"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN417"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>natts</span><span class='Delimiter'>; 
</span><a name="LN419"></a>    <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN420"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fnncolumns</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN421"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fncolumns</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
<a name="LN423"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN416"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../src/include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN414"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN417"><span class='Ref_To_Local'>tupleDesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN416"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN418"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN417"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Retrieve FDW options for all user-defined attributes. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN419"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN419"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="file_fdw.c.html#LN418"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN419"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN432"></a>        <a href="../../src/include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN417"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="file_fdw.c.html#LN419"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN433"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN434"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip dropped attributes. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN432"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="file_fdw.c.html#LN433"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN79"><span class='Ref_to_Proto'>GetForeignColumnOptions</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN414"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN419"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN434"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN433"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN443"></a>            <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN434"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN443"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_not_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN443"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN449"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN432"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="file_fdw.c.html#LN420"><span class='Ref_To_Local'>fnncolumns</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN420"><span class='Ref_To_Local'>fnncolumns</span></a><span class='Delimiter'>, </span><a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN449"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN443"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN443"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span><a name="LN458"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN432"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="file_fdw.c.html#LN421"><span class='Ref_To_Local'>fncolumns</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN421"><span class='Ref_To_Local'>fncolumns</span></a><span class='Delimiter'>, </span><a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN458"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* maybe in future handle other options here */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attnum=1;attnum&LT;=natt... &raquo; </span> 
 
    <a href="../../src/include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN416"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return DefElem only when some column(s) have force_not_null / 
     * force_null options set 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN420"><span class='Ref_To_Local'>fnncolumns</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="file_fdw.c.html#LN423"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN423"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"force_not_null"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN420"><span class='Ref_To_Local'>fnncolumns</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN421"><span class='Ref_To_Local'>fncolumns</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="file_fdw.c.html#LN423"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN423"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"force_null"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN421"><span class='Ref_To_Local'>fncolumns</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="file_fdw.c.html#LN423"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_file_fdw_attribute_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileGetForeignRelSize 
 *      Obtain relation size estimates for a foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN487"></a><span class='Declare_Function'>fileGetForeignRelSize</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN488"></a>                      <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN489"></a>                      <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN491"></a>    <a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_private</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch options.  We only need filename (or program) at this point, but 
     * we might as well get everything and not need to re-fetch it later in 
     * planning. 
     */ 
</span>    <a href="file_fdw.c.html#LN491"><span class='Ref_To_Local'>fdw_private</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN145"><span class='Ref_to_Proto'>fileGetOptions</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN489"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN491"><span class='Ref_To_Local'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN88"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN491"><span class='Ref_To_Local'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN89"><span class='Ref_to_Member'>is_program</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN491"><span class='Ref_To_Local'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN90"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN488"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN491"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimate relation size */ 
</span>    <a href="file_fdw.c.html#LN153"><span class='Ref_to_Proto'>estimate_size</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN487"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN488"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN491"><span class='Ref_To_Local'>fdw_private</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fileGetForeignRelSize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileGetForeignPaths 
 *      Create possible access paths for a scan on the foreign table 
 * 
 *      Currently we don't support any push-down feature, so there is only one 
 *      possible access path, which simply returns all records in the order in 
 *      the data file. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN518"></a><span class='Declare_Function'>fileGetForeignPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN519"></a>                    <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN520"></a>                    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN522"></a>    <a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_private</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN519"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN523"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>startup_cost</span><span class='Delimiter'>; 
</span><a name="LN524"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>total_cost</span><span class='Delimiter'>; 
</span><a name="LN525"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>columns</span><span class='Delimiter'>; 
</span><a name="LN526"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>coptions</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Decide whether to selectively perform binary conversion */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN150"><span class='Ref_to_Proto'>check_selective_binary_conversion</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN519"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                          <a href="file_fdw.c.html#LN520"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="file_fdw.c.html#LN525"><span class='Ref_To_Local'>columns</span></a><span class='Parentheses'>))</span> 
        <a href="file_fdw.c.html#LN526"><span class='Ref_To_Local'>coptions</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/makefuncs.h.html#LN82"><span class='Ref_to_Proto'>makeDefElem</span></a><span class='Parentheses'>(</span><span class='String'>"convert_selectively"</span><span class='Delimiter'>, 
</span>                                          <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN525"><span class='Ref_To_Local'>columns</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimate costs */ 
</span>    <a href="file_fdw.c.html#LN155"><span class='Ref_to_Proto'>estimate_costs</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN518"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN519"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN522"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN523"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN524"><span class='Ref_To_Local'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a ForeignPath node and add it as only possible path.  We use the 
     * fdw_private list of the path to carry the convert_selectively option; 
     * it will be propagated into the fdw_private list of the Plan node. 
     */ 
</span>    <a href="../../src/include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN519"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>             <a href="../../src/include/optimizer/pathnode.h.html#LN106"><span class='Ref_to_Proto'>create_foreignscan_path</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN518"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN519"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* default pathtarget */ 
</span>                                     <a href="file_fdw.c.html#LN519"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, 
</span>                                     <a href="file_fdw.c.html#LN523"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, 
</span>                                     <a href="file_fdw.c.html#LN524"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no pathkeys */ 
</span>                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* no outer rel either */ 
</span>                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* no extra plan */ 
</span>                                     <a href="file_fdw.c.html#LN526"><span class='Ref_To_Local'>coptions</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If data file was sorted, and we knew it somehow, we could insert 
     * appropriate pathkeys into the ForeignPath node to tell the planner 
     * that. 
     */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end fileGetForeignPaths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileGetForeignPlan 
 *      Create a ForeignScan plan node for scanning the foreign table 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>* 
</span><a name="LN567"></a><span class='Declare_Function'>fileGetForeignPlan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN568"></a>                   <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN569"></a>                   <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN570"></a>                   <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>best_path</span><span class='Delimiter'>, 
</span><a name="LN571"></a>                   <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN572"></a>                   <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scan_clauses</span><span class='Delimiter'>, 
</span><a name="LN573"></a>                   <a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outer_plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN575"></a>    <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>scan_relid</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN568"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have no native ability to evaluate restriction clauses, so we just 
     * put all the scan_clauses into the plan node's qual list for the 
     * executor to check.  So all we have to do here is strip RestrictInfo 
     * nodes from the clauses and ignore pseudoconstants (which will be 
     * handled elsewhere). 
     */ 
</span>    <a href="file_fdw.c.html#LN572"><span class='Ref_to_Parameter'>scan_clauses</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/restrictinfo.h.html#LN35"><span class='Ref_to_Proto'>extract_actual_clauses</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN572"><span class='Ref_to_Parameter'>scan_clauses</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the ForeignScan node */ 
</span>    <span class='Control'>return</span> <a href="../../src/include/optimizer/planmain.h.html#LN50"><span class='Ref_to_Proto'>make_foreignscan</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN571"><span class='Ref_to_Parameter'>tlist</span></a><span class='Delimiter'>, 
</span>                            <a href="file_fdw.c.html#LN572"><span class='Ref_to_Parameter'>scan_clauses</span></a><span class='Delimiter'>, 
</span>                            <a href="file_fdw.c.html#LN575"><span class='Ref_To_Local'>scan_relid</span></a><span class='Delimiter'>, 
</span>                            <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* no expressions to evaluate */ 
</span>                            <a href="file_fdw.c.html#LN570"><span class='Ref_to_Parameter'>best_path</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1131"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                            <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* no custom tlist */ 
</span>                            <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* no remote quals */ 
</span>                            <a href="file_fdw.c.html#LN573"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fileGetForeignPlan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileExplainForeignScan 
 *      Produce extra output for EXPLAIN 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN602"></a><span class='Declare_Function'>fileExplainForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN604"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN605"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_program</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch options --- we only need filename and is_program at this point */ 
</span>    <a href="file_fdw.c.html#LN145"><span class='Ref_to_Proto'>fileGetOptions</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN602"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN604"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN605"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN606"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN605"><span class='Ref_To_Local'>is_program</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/commands/explain.h.html#LN92"><span class='Ref_to_Proto'>ExplainPropertyText</span></a><span class='Parentheses'>(</span><span class='String'>"Foreign Program"</span><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN604"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN602"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../src/include/commands/explain.h.html#LN92"><span class='Ref_to_Proto'>ExplainPropertyText</span></a><span class='Parentheses'>(</span><span class='String'>"Foreign File"</span><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN604"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN602"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Suppress file size if we're not showing cost details */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN602"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/commands/explain.h.html#LN33"><span class='Ref_to_Member'>costs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN620"></a>        <span class='Control'>struct</span> <a href="../../src/include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>stat_buf</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="file_fdw.c.html#LN605"><span class='Ref_To_Local'>is_program</span></a> <span class='Operator'>&& 
</span>            <a href="../../src/include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN604"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN620"><span class='Ref_To_Local'>stat_buf</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../src/include/commands/explain.h.html#LN96"><span class='Ref_to_Proto'>ExplainPropertyLong</span></a><span class='Parentheses'>(</span><span class='String'>"Foreign File Size"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN620"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_size<span class='Delimiter'>, 
</span>                                <a href="file_fdw.c.html#LN602"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fileExplainForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileBeginForeignScan 
 *      Initiate access to the file by creating CopyState 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN634"></a><span class='Declare_Function'>fileBeginForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN636"></a>    <a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN634"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN637"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_program</span><span class='Delimiter'>; 
</span><a name="LN639"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN640"></a>    <a href="../../src/include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN641"></a>    <a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>festate</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do nothing in EXPLAIN (no ANALYZE) case.  node-&GT;fdw_state stays NULL. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN634"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><a href="../../src/include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch options of foreign table */ 
</span>    <a href="file_fdw.c.html#LN145"><span class='Ref_to_Proto'>fileGetOptions</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN634"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN637"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN638"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN639"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add any options from the plan (currently only convert_selectively) */ 
</span>    <a href="file_fdw.c.html#LN639"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN639"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN636"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create CopyState from FDW options.  We always acquire all columns, so 
     * as to match the expected ScanTupleSlot signature. 
     */ 
</span>    <a href="file_fdw.c.html#LN640"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN30"><span class='Ref_to_Proto'>BeginCopyFrom</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                           <a href="file_fdw.c.html#LN634"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Delimiter'>, 
</span>                           <a href="file_fdw.c.html#LN637"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, 
</span>                           <a href="file_fdw.c.html#LN638"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>, 
</span>                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                           <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                           <a href="file_fdw.c.html#LN639"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Save state in node-&GT;fdw_state.  We must save enough information to call 
     * BeginCopyFrom() again. 
     */ 
</span>    <a href="file_fdw.c.html#LN641"><span class='Ref_To_Local'>festate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN641"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN101"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN637"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN641"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN102"><span class='Ref_to_Member'>is_program</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN638"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN641"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN103"><span class='Ref_to_Member'>options</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN639"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN641"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN105"><span class='Ref_to_Member'>cstate</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN640"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN634"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN641"><span class='Ref_To_Local'>festate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fileBeginForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileIterateForeignScan 
 *      Read next record from the data file and store it into the 
 *      ScanTupleSlot as a virtual tuple 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN687"></a><span class='Declare_Function'>fileIterateForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN689"></a>    <a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>festate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN687"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN690"></a>    <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN687"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span><a name="LN691"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN692"></a>    ErrorContextCallback <span class='Declare_Local'>errcallback</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up callback to identify error line number. */ 
</span>    <a href="file_fdw.c.html#LN692"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN37"><span class='Ref_to_Proto'>CopyFromErrorCallback</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN692"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN689"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN105"><span class='Ref_to_Member'>cstate</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN692"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="file_fdw.c.html#LN692"><span class='Ref_To_Local'>errcallback</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The protocol for loading a virtual tuple into a slot is first 
     * ExecClearTuple, then fill the values/isnull arrays, then 
     * ExecStoreVirtualTuple.  If we don't find another row in the file, we 
     * just skip the last step, leaving the slot empty as required. 
     * 
     * We can pass ExprContext = NULL because we read all columns from the 
     * file, so no need to evaluate default expressions. 
     * 
     * We can also pass tupleOid = NULL because we don't allow oids for 
     * foreign tables. 
     */ 
</span>    <a href="../../src/include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN690"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN691"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN33"><span class='Ref_to_Proto'>NextCopyFrom</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN689"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN105"><span class='Ref_to_Member'>cstate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                         <a href="file_fdw.c.html#LN690"><span class='Ref_To_Local'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN690"><span class='Ref_To_Local'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>, 
</span>                         <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN691"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/executor/tuptable.h.html#LN155"><span class='Ref_to_Proto'>ExecStoreVirtualTuple</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN690"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove error callback. */ 
</span>    <a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN692"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="file_fdw.c.html#LN690"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fileIterateForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileReScanForeignScan 
 *      Rescan table, possibly with new parameters 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN730"></a><span class='Declare_Function'>fileReScanForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN732"></a>    <a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>festate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN730"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/commands/copy.h.html#LN32"><span class='Ref_to_Proto'>EndCopyFrom</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN732"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN105"><span class='Ref_to_Member'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN732"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN105"><span class='Ref_to_Member'>cstate</span></a> <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN30"><span class='Ref_to_Proto'>BeginCopyFrom</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                    <a href="file_fdw.c.html#LN730"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Delimiter'>, 
</span>                                    <a href="file_fdw.c.html#LN732"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN101"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, 
</span>                                    <a href="file_fdw.c.html#LN732"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN102"><span class='Ref_to_Member'>is_program</span></a><span class='Delimiter'>, 
</span>                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                    <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                    <a href="file_fdw.c.html#LN732"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN103"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * fileEndForeignScan 
 *      Finish scanning foreign table and dispose objects used for this scan 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN750"></a><span class='Declare_Function'>fileEndForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN752"></a>    <a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>festate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN99"><span class='Ref_to_Struct'>FileFdwExecutionState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN750"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if festate is NULL, we are in EXPLAIN; nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN752"><span class='Ref_To_Local'>festate</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/commands/copy.h.html#LN32"><span class='Ref_to_Proto'>EndCopyFrom</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN752"><span class='Ref_To_Local'>festate</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN105"><span class='Ref_to_Member'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * fileAnalyzeForeignTable 
 *      Test whether analyzing this foreign table is supported 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN764"></a><span class='Declare_Function'>fileAnalyzeForeignTable</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN765"></a>                        <a href="../../src/include/foreign/fdwapi.h.html#LN133"><span class='Ref_to_Typedef'>AcquireSampleRowsFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN766"></a>                        <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>totalpages</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN768"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN769"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_program</span><span class='Delimiter'>; 
</span><a name="LN770"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN771"></a>    <span class='Control'>struct</span> <a href="../../src/include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>stat_buf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch options of foreign table */ 
</span>    <a href="file_fdw.c.html#LN145"><span class='Ref_to_Proto'>fileGetOptions</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN764"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN768"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN769"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN770"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this is a program instead of a file, just return false to skip 
     * analyzing the table.  We could run the program and collect stats on 
     * whatever it currently returns, but it seems likely that in such cases 
     * the output would be too volatile for the stats to be useful.  Maybe 
     * there should be an option to enable doing this? 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN769"><span class='Ref_To_Local'>is_program</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get size of the file.  (XXX if we fail here, would it be better to just 
     * return false to skip analyzing the table?) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN768"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN771"><span class='Ref_To_Local'>stat_buf</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="file_fdw.c.html#LN768"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert size to pages.  Must return at least 1 so that we can tell 
     * later on that pg_class.relpages is not default. 
     */ 
</span>    <span class='Operator'>*</span><a href="file_fdw.c.html#LN766"><span class='Ref_to_Parameter'>totalpages</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN771"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>+ </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span>BLCKSZ<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="file_fdw.c.html#LN766"><span class='Ref_to_Parameter'>totalpages</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="file_fdw.c.html#LN766"><span class='Ref_to_Parameter'>totalpages</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="file_fdw.c.html#LN765"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN158"><span class='Ref_to_Proto'>file_acquire_sample_rows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fileAnalyzeForeignTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * fileIsForeignScanParallelSafe 
 *      Reading a file, or external program, in a parallel worker should work 
 *      just the same as reading it in the leader, so mark scans safe. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN815"></a><span class='Declare_Function'>fileIsForeignScanParallelSafe</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN816"></a>                              <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rte</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * check_selective_binary_conversion 
 * 
 * Check to see if it's useful to convert only a subset of the file's columns 
 * to binary.  If so, construct a list of the column names to be converted, 
 * return that at *columns, and return TRUE.  (Note that it's possible to 
 * determine that no columns need be converted, for instance with a COUNT(*) 
 * query.  So we can't use returning a NIL list to indicate failure.) 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN831"></a><span class='Declare_Function'>check_selective_binary_conversion</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN832"></a>                                  <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN833"></a>                                  <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>columns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN835"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN836"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN837"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN838"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span><span class='Delimiter'>; 
</span><a name="LN839"></a>    <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN840"></a>    <a href="../../src/include/nodes/bitmapset.h.html#LN36"><span class='Ref_to_Struct'>Bitmapset</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>attrs_used</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN841"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_wholerow</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN842"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numattrs</span><span class='Delimiter'>; 
</span><a name="LN843"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="file_fdw.c.html#LN833"><span class='Ref_to_Parameter'>columns</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* default result */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check format of the file.  If binary format, this is irrelevant. 
     */ 
</span>    <a href="file_fdw.c.html#LN835"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN832"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN836"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN835"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN67"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN853"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN836"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN853"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"format"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN857"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>format</span> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN853"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="file_fdw.c.html#LN857"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>, </span><span class='String'>"binary"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Collect all the attributes needed for joins or final output. */ 
</span>    <a href="../../src/include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN831"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN882"><span class='Ref_to_Member'>exprs</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN831"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="file_fdw.c.html#LN840"><span class='Ref_To_Local'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add all the attributes used by restriction clauses. */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN836"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN831"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN872"></a>        <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN836"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN872"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN831"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="file_fdw.c.html#LN840"><span class='Ref_To_Local'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Convert attribute numbers to column names. */ 
</span>    <a href="file_fdw.c.html#LN837"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../src/include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN832"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN838"><span class='Ref_To_Local'>tupleDesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN837"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="file_fdw.c.html#LN839"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN97"><span class='Ref_to_Proto'>bms_first_member</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN840"><span class='Ref_To_Local'>attrs_used</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Adjust for system attributes. */ 
</span>        <a href="file_fdw.c.html#LN839"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>+= </span><a href="../../src/include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN839"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="file_fdw.c.html#LN841"><span class='Ref_To_Local'>has_wholerow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore system attributes. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN839"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get user attributes. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN839"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN900"></a>            <a href="../../src/include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN838"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="file_fdw.c.html#LN839"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN901"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span> <span class='Operator'>= </span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN900"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Skip dropped attributes (probably shouldn't see any here). */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN900"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="file_fdw.c.html#LN833"><span class='Ref_to_Parameter'>columns</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="file_fdw.c.html#LN833"><span class='Ref_to_Parameter'>columns</span></a><span class='Delimiter'>, </span><a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN901"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (attnum=bms_first_mem... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Count non-dropped user attributes while we have the tupdesc. */ 
</span>    <a href="file_fdw.c.html#LN842"><span class='Ref_To_Local'>numattrs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="file_fdw.c.html#LN838"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="file_fdw.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN914"></a>        <a href="../../src/include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN838"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="file_fdw.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN914"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="file_fdw.c.html#LN842"><span class='Ref_To_Local'>numattrs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN837"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there's a whole-row reference, fail: we need all the columns. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN841"><span class='Ref_To_Local'>has_wholerow</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="file_fdw.c.html#LN833"><span class='Ref_to_Parameter'>columns</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If all the user attributes are needed, fail. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN842"><span class='Ref_To_Local'>numattrs</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="file_fdw.c.html#LN833"><span class='Ref_to_Parameter'>columns</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="file_fdw.c.html#LN833"><span class='Ref_to_Parameter'>columns</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_selective_binary_conversion &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate size of a foreign table. 
 * 
 * The main result is returned in baserel-&GT;rows.  We also set 
 * fdw_private-&GT;pages and fdw_private-&GT;ntuples for later use in the cost 
 * calculation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN948"></a><span class='Declare_Function'>estimate_size</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN949"></a>              <a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN951"></a>    <span class='Control'>struct</span> <a href="../../src/include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>stat_buf</span><span class='Delimiter'>; 
</span><a name="LN952"></a>    <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>pages</span><span class='Delimiter'>; 
</span><a name="LN953"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>ntuples</span><span class='Delimiter'>; 
</span><a name="LN954"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>nrows</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get size of the file.  It might not be there at plan time, though, in 
     * which case we have to use a default estimate.  We also have to fall 
     * back to the default if using a program as the input. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN949"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN89"><span class='Ref_to_Member'>is_program</span></a> <span class='Operator'>|| </span><a href="../../src/include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN949"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN88"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN951"><span class='Ref_To_Local'>stat_buf</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="file_fdw.c.html#LN951"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>= </span><span class='Number'>10</span> <span class='Operator'>* </span>BLCKSZ<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert size to pages for use in I/O cost estimate later. 
     */ 
</span>    <a href="file_fdw.c.html#LN952"><span class='Ref_To_Local'>pages</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN951"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>+ </span><span class='Parentheses'>(</span>BLCKSZ <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span>BLCKSZ<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN952"><span class='Ref_To_Local'>pages</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="file_fdw.c.html#LN952"><span class='Ref_To_Local'>pages</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN949"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN92"><span class='Ref_to_Member'>pages</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN952"><span class='Ref_To_Local'>pages</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Estimate the number of tuples in the file. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN563"><span class='Ref_to_Member'>pages</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We have # of pages and # of tuples from pg_class (that is, from a 
         * previous ANALYZE), so compute a tuples-per-page estimate and scale 
         * that by the current file size. 
         */ 
</span><a name="LN982"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>density</span><span class='Delimiter'>; 
</span> 
        <a href="file_fdw.c.html#LN982"><span class='Ref_To_Local'>density</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN563"><span class='Ref_to_Member'>pages</span></a><span class='Delimiter'>; 
</span>        <a href="file_fdw.c.html#LN953"><span class='Ref_To_Local'>ntuples</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/cost.h.html#LN71"><span class='Ref_to_Proto'>clamp_row_est</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN982"><span class='Ref_To_Local'>density</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN952"><span class='Ref_To_Local'>pages</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Otherwise we have to fake it.  We back into this estimate using the 
         * planner's idea of the relation width; which is bogus if not all 
         * columns are being read, not to mention that the text representation 
         * of a row probably isn't the same size as its internal 
         * representation.  Possibly we could do something better, but the 
         * real answer to anyone who complains is "ANALYZE" ... 
         */ 
</span><a name="LN997"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tuple_width</span><span class='Delimiter'>; 
</span> 
        <a href="file_fdw.c.html#LN997"><span class='Ref_To_Local'>tuple_width</span></a> <span class='Operator'>= </span><a href="../../src/include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>            <a href="../../src/include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="../../src/include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="file_fdw.c.html#LN953"><span class='Ref_To_Local'>ntuples</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/cost.h.html#LN71"><span class='Ref_to_Proto'>clamp_row_est</span></a><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN951"><span class='Ref_To_Local'>stat_buf</span></a><span class='Operator'>.</span>st_size <span class='Operator'>/ 
</span>                                <span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN997"><span class='Ref_To_Local'>tuple_width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="file_fdw.c.html#LN949"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN93"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN953"><span class='Ref_To_Local'>ntuples</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now estimate the number of rows returned by the scan after applying the 
     * baserestrictinfo quals. 
     */ 
</span>    <a href="file_fdw.c.html#LN954"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN953"><span class='Ref_To_Local'>ntuples</span></a> <span class='Operator'>* 
</span>        <a href="../../src/backend/optimizer/path/clausesel.c.html#LN97"><span class='Ref_to_Func'>clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                               <a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Delimiter'>, 
</span>                               <span class='Number'>0</span><span class='Delimiter'>, 
</span>                               <a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN954"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/cost.h.html#LN71"><span class='Ref_to_Proto'>clamp_row_est</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN954"><span class='Ref_To_Local'>nrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save the output-rows estimate for the planner */ 
</span>    <a href="file_fdw.c.html#LN948"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN954"><span class='Ref_To_Local'>nrows</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end estimate_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate costs of scanning a foreign table. 
 * 
 * Results are returned in *startup_cost and *total_cost. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1029"></a><span class='Declare_Function'>estimate_costs</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN1030"></a>               <a href="file_fdw.c.html#LN86"><span class='Ref_to_Struct'>FileFdwPlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Delimiter'>, 
</span><a name="LN1031"></a>               <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>startup_cost</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>total_cost</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1033"></a>    <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>pages</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN1030"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN92"><span class='Ref_to_Member'>pages</span></a><span class='Delimiter'>; 
</span><a name="LN1034"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>ntuples</span> <span class='Operator'>= </span><a href="file_fdw.c.html#LN1030"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Operator'>-&GT;</span><a href="file_fdw.c.html#LN93"><span class='Ref_to_Member'>ntuples</span></a><span class='Delimiter'>; 
</span><a name="LN1035"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>run_cost</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1036"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>cpu_per_tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We estimate costs almost the same way as cost_seqscan(), thus assuming 
     * that I/O costs are equivalent to a regular table file of the same size. 
     * However, we take per-tuple CPU costs as 10x of a seqscan, to account 
     * for the cost of parsing records. 
     * 
     * In the case of a program source, this calculation is even more divorced 
     * from reality, but we have no good alternative; and it's not clear that 
     * the numbers we produce here matter much anyway, since there's only one 
     * access path for the rel. 
     */ 
</span>    <a href="file_fdw.c.html#LN1035"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="../../src/backend/optimizer/path/costsize.c.html#LN103"><span class='Ref_to_Global_Var'>seq_page_cost</span></a> <span class='Operator'>* </span><a href="file_fdw.c.html#LN1033"><span class='Ref_To_Local'>pages</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="file_fdw.c.html#LN1031"><span class='Ref_to_Parameter'>startup_cost</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN1029"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN585"><span class='Ref_to_Member'>baserestrictcost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN1036"><span class='Ref_To_Local'>cpu_per_tuple</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/costsize.c.html#LN105"><span class='Ref_to_Global_Var'>cpu_tuple_cost</span></a> <span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><a href="file_fdw.c.html#LN1029"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN585"><span class='Ref_to_Member'>baserestrictcost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN1035"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="file_fdw.c.html#LN1036"><span class='Ref_To_Local'>cpu_per_tuple</span></a> <span class='Operator'>* </span><a href="file_fdw.c.html#LN1034"><span class='Ref_To_Local'>ntuples</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="file_fdw.c.html#LN1031"><span class='Ref_to_Parameter'>total_cost</span></a> <span class='Operator'>= *</span><a href="file_fdw.c.html#LN1031"><span class='Ref_to_Parameter'>startup_cost</span></a> <span class='Operator'>+ </span><a href="file_fdw.c.html#LN1035"><span class='Ref_To_Local'>run_cost</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end estimate_costs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * file_acquire_sample_rows -- acquire a random sample of rows from the table 
 * 
 * Selected rows are returned in the caller-allocated array rows[], 
 * which must have at least targrows entries. 
 * The actual number of rows selected is returned as the function result. 
 * We also count the total number of rows in the file and return it into 
 * *totalrows.  Note that *totaldeadrows is always set to 0. 
 * 
 * Note that the returned list of rows is not always in order by physical 
 * position in the file.  Therefore, correlation estimates derived later 
 * may be meaningless, but it's OK because we don't use the estimates 
 * currently (the planner only pays attention to correlation for indexscans). 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1072"></a><span class='Declare_Function'>file_acquire_sample_rows</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>onerel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, 
</span><a name="LN1073"></a>                         <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>targrows</span><span class='Delimiter'>, 
</span><a name="LN1074"></a>                         <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totalrows</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totaldeadrows</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1076"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numrows</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1077"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rowstoskip</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* -1 means not set yet */ 
</span><a name="LN1078"></a>    <a href="../../src/include/utils/sampling.h.html#LN46"><span class='Ref_to_Typedef'>ReservoirStateData</span></a> <span class='Declare_Local'>rstate</span><span class='Delimiter'>; 
</span><a name="LN1079"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN1080"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN1081"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN1082"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN1083"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN1084"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_program</span><span class='Delimiter'>; 
</span><a name="LN1085"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN1086"></a>    <a href="../../src/include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN1087"></a>    ErrorContextCallback <span class='Declare_Local'>errcallback</span><span class='Delimiter'>; 
</span><a name="LN1088"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../../src/backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span><a name="LN1089"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>tupcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1072"><span class='Ref_to_Parameter'>onerel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>targrows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="file_fdw.c.html#LN1079"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1072"><span class='Ref_to_Parameter'>onerel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN1080"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1079"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN1081"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1079"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fetch options of foreign table */ 
</span>    <a href="file_fdw.c.html#LN145"><span class='Ref_to_Proto'>fileGetOptions</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1072"><span class='Ref_to_Parameter'>onerel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN1083"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN1084"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="file_fdw.c.html#LN1085"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create CopyState from FDW options. 
     */ 
</span>    <a href="file_fdw.c.html#LN1086"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN30"><span class='Ref_to_Proto'>BeginCopyFrom</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1072"><span class='Ref_to_Parameter'>onerel</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1083"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1084"><span class='Ref_To_Local'>is_program</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                           <a href="file_fdw.c.html#LN1085"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use per-tuple memory context to prevent leak of memory used to read 
     * rows from the file with Copy routines. 
     */ 
</span>    <a href="file_fdw.c.html#LN1089"><span class='Ref_To_Local'>tupcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"file_fdw temporary context"</span><span class='Delimiter'>, 
</span>                                       <a href="../../src/include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare for sampling rows */ 
</span>    <a href="../../src/include/utils/sampling.h.html#LN54"><span class='Ref_to_Proto'>reservoir_init_selection_state</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="file_fdw.c.html#LN1078"><span class='Ref_To_Local'>rstate</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>targrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up callback to identify error line number. */ 
</span>    <a href="file_fdw.c.html#LN1087"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN37"><span class='Ref_to_Proto'>CopyFromErrorCallback</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN1087"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="file_fdw.c.html#LN1086"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>; 
</span>    <a href="file_fdw.c.html#LN1087"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="file_fdw.c.html#LN1087"><span class='Ref_To_Local'>errcallback</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="file_fdw.c.html#LN1074"><span class='Ref_to_Parameter'>totalrows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="file_fdw.c.html#LN1074"><span class='Ref_to_Parameter'>totaldeadrows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check for user-requested abort or sleep */ 
</span>        <a href="../../src/include/commands/vacuum.h.html#LN188"><span class='Ref_to_Proto'>vacuum_delay_point</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch next row */ 
</span>        <a href="../../src/include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1089"><span class='Ref_To_Local'>tupcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1089"><span class='Ref_To_Local'>tupcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="file_fdw.c.html#LN1082"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><a href="../../src/include/commands/copy.h.html#LN33"><span class='Ref_to_Proto'>NextCopyFrom</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1086"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1080"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1081"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1088"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="file_fdw.c.html#LN1082"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The first targrows sample rows are simply copied into the 
         * reservoir.  Then we start replacing tuples in the sample until we 
         * reach the end of the relation. This algorithm is from Jeff Vitter's 
         * paper (see more info in commands/analyze.c). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1076"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>&LT; </span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>targrows</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>rows</span></a><span class='Delimiter'>[</span><a href="file_fdw.c.html#LN1076"><span class='Ref_To_Local'>numrows</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1079"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1080"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1081"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * t in Vitter's paper is the number of records already processed. 
             * If we need to compute a new S value, we must use the 
             * not-yet-incremented value of totalrows as t. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1077"><span class='Ref_To_Local'>rowstoskip</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="file_fdw.c.html#LN1077"><span class='Ref_To_Local'>rowstoskip</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/sampling.h.html#LN55"><span class='Ref_to_Proto'>reservoir_get_next_S</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="file_fdw.c.html#LN1078"><span class='Ref_To_Local'>rstate</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="file_fdw.c.html#LN1074"><span class='Ref_to_Parameter'>totalrows</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>targrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1077"><span class='Ref_To_Local'>rowstoskip</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Found a suitable tuple, so save it, replacing one old tuple 
                 * at random 
                 */ 
</span><a name="LN1168"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>k</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>targrows</span></a> <span class='Operator'>* </span><a href="../../src/include/utils/sampling.h.html#LN23"><span class='Ref_to_Proto'>sampler_random_fract</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1078"><span class='Ref_To_Local'>rstate</span></a><span class='Operator'>.</span><a href="../../src/include/utils/sampling.h.html#LN49"><span class='Ref_to_Member'>randstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1168"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="file_fdw.c.html#LN1168"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>targrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../src/include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>rows</span></a><span class='Delimiter'>[</span><a href="file_fdw.c.html#LN1168"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="file_fdw.c.html#LN1073"><span class='Ref_to_Parameter'>rows</span></a><span class='Delimiter'>[</span><a href="file_fdw.c.html#LN1168"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1079"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1080"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1081"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="file_fdw.c.html#LN1077"><span class='Ref_To_Local'>rowstoskip</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Operator'>*</span><a href="file_fdw.c.html#LN1074"><span class='Ref_to_Parameter'>totalrows</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Remove error callback. */ 
</span>    <a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="file_fdw.c.html#LN1087"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up. */ 
</span>    <a href="../../src/include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1089"><span class='Ref_To_Local'>tupcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/commands/copy.h.html#LN32"><span class='Ref_to_Proto'>EndCopyFrom</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1086"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1080"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1081"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit some interesting relation info 
     */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1072"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\": file contains %.0f rows; "</span> 
                    <span class='String'>"%d rows in sample"</span><span class='Delimiter'>, 
</span>                    <a href="../../src/include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="file_fdw.c.html#LN1072"><span class='Ref_to_Parameter'>onerel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Operator'>*</span><a href="file_fdw.c.html#LN1074"><span class='Ref_to_Parameter'>totalrows</span></a><span class='Delimiter'>, </span><a href="file_fdw.c.html#LN1076"><span class='Ref_To_Local'>numrows</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="file_fdw.c.html#LN1076"><span class='Ref_To_Local'>numrows</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end file_acquire_sample_rows &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>