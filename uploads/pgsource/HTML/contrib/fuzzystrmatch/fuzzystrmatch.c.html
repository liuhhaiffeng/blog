<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\fuzzystrmatch\fuzzystrmatch.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\fuzzystrmatch\fuzzystrmatch.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:25 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 * fuzzystrmatch.c 
 * 
 * Functions for "fuzzy" comparison of strings 
 * 
 * Joe Conway &LT;mail@joeconway.com&GT; 
 * 
 * contrib/fuzzystrmatch/fuzzystrmatch.c 
 * Copyright (c) 2001-2017, PostgreSQL Global Development Group 
 * ALL RIGHTS RESERVED; 
 * 
 * metaphone() 
 * ----------- 
 * Modified for PostgreSQL by Joe Conway. 
 * Based on CPAN's "Text-Metaphone-1.96" by Michael G Schwern &LT;schwern@pobox.com&GT; 
 * Code slightly modified for use as PostgreSQL function (palloc, elog, etc). 
 * Metaphone was originally created by Lawrence Philips and presented in article 
 * in "Computer Language" December 1990 issue. 
 * 
 * Permission to use, copy, modify, and distribute this software and its 
 * documentation for any purpose, without fee, and without a written agreement 
 * is hereby granted, provided that the above copyright notice and this 
 * paragraph and the following two paragraphs appear in all copies. 
 * 
 * IN NO EVENT SHALL THE AUTHORS OR DISTRIBUTORS BE LIABLE TO ANY PARTY FOR 
 * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING 
 * LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS 
 * DOCUMENTATION, EVEN IF THE AUTHOR OR DISTRIBUTORS HAVE BEEN ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE. 
 * 
 * THE AUTHORS AND DISTRIBUTORS SPECIFICALLY DISCLAIM ANY WARRANTIES, 
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY 
 * AND FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS 
 * ON AN "AS IS" BASIS, AND THE AUTHOR AND DISTRIBUTORS HAS NO OBLIGATIONS TO 
 * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS. 
 * 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Soundex 
 */ 
</span><a name="LN51"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_soundex</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>instr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>outstr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SOUNDEX_LEN</span> <span class='Number'>4</span> 
 
<span class='Comment_Multi_Line'>/*                                  ABCDEFGHIJKLMNOPQRSTUVWXYZ */ 
</span><a name="LN56"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Var'>soundex_table</span> <span class='Operator'>= </span><span class='String'>"01230120022455012623010202"</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static char 
</span><a name="LN59"></a><span class='Declare_Function'>soundex_code</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>letter</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="fuzzystrmatch.c.html#LN59"><span class='Ref_to_Parameter'>letter</span></a> <span class='Operator'>= </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="fuzzystrmatch.c.html#LN59"><span class='Ref_to_Parameter'>letter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Defend against non-ASCII letters */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN59"><span class='Ref_to_Parameter'>letter</span></a> <span class='Operator'>&GT;= </span><span class='String'>'A'</span> <span class='Operator'>&& </span><a href="fuzzystrmatch.c.html#LN59"><span class='Ref_to_Parameter'>letter</span></a> <span class='Operator'>&LT;= </span><span class='String'>'Z'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="fuzzystrmatch.c.html#LN56"><span class='Ref_to_Global_Var'>soundex_table</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN59"><span class='Ref_to_Parameter'>letter</span></a> <span class='Operator'>- </span><span class='String'>'A'</span><span class='Delimiter'>]; 
</span>    <span class='Control'>return</span> <a href="fuzzystrmatch.c.html#LN59"><span class='Ref_to_Parameter'>letter</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Metaphone 
 */ 
</span><a name="LN71"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_METAPHONE_STRLEN</span>        <span class='Number'>255</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Original code by Michael G Schwern starts here. 
 * Code slightly modified for use as PostgreSQL function. 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/************************************************************************** 
    metaphone -- Breaks english phrases down into their phonemes. 
 
    Input 
        word            --  An english word to be phonized 
        max_phonemes    --  How many phonemes to calculate.  If 0, then it 
                            will phonize the entire phrase. 
        phoned_word     --  The final phonized word.  (We'll allocate the 
                            memory.) 
    Output 
        error   --  A simple error flag, returns TRUE or FALSE 
 
    NOTES:  ALL non-alpha characters are ignored, this includes whitespace, 
    although non-alpha characters will break up phonemes. 
****************************************************************************/ 
</span> 
 
<span class='Comment_Multi_Line'>/************************************************************************** 
    my constants -- constants I like 
 
    Probably redundant. 
 
***************************************************************************/ 
</span> 
<a name="LN103"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>META_ERROR</span>          <span class='Boolean'>FALSE 
</span><a name="LN104"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>META_SUCCESS</span>        <span class='Boolean'>TRUE 
</span><a name="LN105"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>META_FAILURE</span>        <span class='Boolean'>FALSE 
</span> 
 
<span class='Comment_Multi_Line'>/*  I add modifications to the traditional metaphone algorithm that you 
    might find in books.  Define this if you want metaphone to behave 
    traditionally */ 
</span><span class='Keyword'>#undef </span>USE_TRADITIONAL_METAPHONE 
 
<span class='Comment_Multi_Line'>/* Special encodings */ 
</span><a name="LN114"></a><span class='Keyword'>#define</span>  <span class='Declare_Constant'>SH</span>     <span class='String'>'X'</span> 
<a name="LN115"></a><span class='Keyword'>#define</span>  <span class='Declare_Constant'>TH</span>     <span class='String'>'0'</span> 
 
<a name="LN117"></a><span class='Keyword'>static char </span><span class='Declare_Prototype'>Lookahead</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>how_far</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN118"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>_metaphone</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>max_phonemes</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>phoned_word</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Metachar.h ... little bits about characters for metaphone */ 
</span> 
 
<span class='Comment_Multi_Line'>/*-- Character encoding array & accessing macros --*/ 
/* Stolen directly out of the book... */ 
</span><a name="LN125"></a><span class='Keyword'>static const char </span><span class='Declare_Var'>_codes</span><span class='Delimiter'>[</span><span class='Number'>26</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Number'>16</span><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Delimiter'>, </span><span class='Number'>0</span> 
<span class='Comment_Multi_Line'>/*  a  b c  d e f g  h i j k l m n o p q r s t u v w x y z */ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Keyword'>static int 
</span><a name="LN131"></a><span class='Declare_Function'>getcode</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="fuzzystrmatch.c.html#LN131"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="fuzzystrmatch.c.html#LN131"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>= </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="fuzzystrmatch.c.html#LN131"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Defend against non-ASCII letters */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN131"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>&GT;= </span><span class='String'>'A'</span> <span class='Operator'>&& </span><a href="fuzzystrmatch.c.html#LN131"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>&LT;= </span><span class='String'>'Z'</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="fuzzystrmatch.c.html#LN125"><span class='Ref_to_Global_Var'>_codes</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN131"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>- </span><span class='String'>'A'</span><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN143"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>isvowel</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN130"><span class='Ref_to_Func'>getcode</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN143"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* AEIOU */ 
</span> 
<span class='Comment_Multi_Line'>/* These letters are passed through unchanged */ 
</span><a name="LN146"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NOCHANGE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) (</span><a href="fuzzystrmatch.c.html#LN130"><span class='Ref_to_Func'>getcode</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN146"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>2</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* FJMNR */ 
</span> 
<span class='Comment_Multi_Line'>/* These form diphthongs when preceding H */ 
</span><a name="LN149"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>AFFECTH</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN130"><span class='Ref_to_Func'>getcode</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN149"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>4</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* CGPST */ 
</span> 
<span class='Comment_Multi_Line'>/* These make C and G soft */ 
</span><a name="LN152"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>MAKESOFT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) (</span><a href="fuzzystrmatch.c.html#LN130"><span class='Ref_to_Func'>getcode</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN152"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>8</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* EIY */ 
</span> 
<span class='Comment_Multi_Line'>/* These prevent GH from becoming F */ 
</span><a name="LN155"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NOGHTOF</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN130"><span class='Ref_to_Func'>getcode</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN155"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>16</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* BDH */ 
</span> 
<a name="LN157"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN158"><span class='Ref_to_Func'>levenshtein_with_costs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN159"></a><span class='Declare_Function'>levenshtein_with_costs</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN161"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN162"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>dst</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN163"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ins_c</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN164"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>del_c</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN165"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sub_c</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN166"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>s_data</span><span class='Delimiter'>; 
</span><a name="LN167"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>t_data</span><span class='Delimiter'>; 
</span><a name="LN168"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>s_bytes</span><span class='Delimiter'>, 
</span><a name="LN169"></a>                <span class='Declare_Local'>t_bytes</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract a pointer to the actual character data */ 
</span>    <a href="fuzzystrmatch.c.html#LN166"><span class='Ref_To_Local'>s_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN161"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN167"><span class='Ref_To_Local'>t_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN162"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Determine length of each string in bytes */ 
</span>    <a href="fuzzystrmatch.c.html#LN168"><span class='Ref_To_Local'>s_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN161"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN169"><span class='Ref_To_Local'>t_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN162"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/varlena.h.html#LN20"><span class='Ref_to_Proto'>varstr_levenshtein</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN166"><span class='Ref_To_Local'>s_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN168"><span class='Ref_To_Local'>s_bytes</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN167"><span class='Ref_To_Local'>t_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN169"><span class='Ref_To_Local'>t_bytes</span></a><span class='Delimiter'>, 
</span>                                       <a href="fuzzystrmatch.c.html#LN163"><span class='Ref_To_Local'>ins_c</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN164"><span class='Ref_To_Local'>del_c</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN165"><span class='Ref_To_Local'>sub_c</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end levenshtein_with_costs &raquo; </span> 
 
 
<a name="LN183"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN184"><span class='Ref_to_Func'>levenshtein</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN185"></a><span class='Declare_Function'>levenshtein</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN187"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN188"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>dst</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN189"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>s_data</span><span class='Delimiter'>; 
</span><a name="LN190"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>t_data</span><span class='Delimiter'>; 
</span><a name="LN191"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>s_bytes</span><span class='Delimiter'>, 
</span><a name="LN192"></a>                <span class='Declare_Local'>t_bytes</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract a pointer to the actual character data */ 
</span>    <a href="fuzzystrmatch.c.html#LN189"><span class='Ref_To_Local'>s_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN187"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN190"><span class='Ref_To_Local'>t_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN188"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Determine length of each string in bytes */ 
</span>    <a href="fuzzystrmatch.c.html#LN191"><span class='Ref_To_Local'>s_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN187"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN192"><span class='Ref_To_Local'>t_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN188"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/varlena.h.html#LN20"><span class='Ref_to_Proto'>varstr_levenshtein</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN189"><span class='Ref_To_Local'>s_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN191"><span class='Ref_To_Local'>s_bytes</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN190"><span class='Ref_To_Local'>t_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN192"><span class='Ref_To_Local'>t_bytes</span></a><span class='Delimiter'>, 
</span>                                       <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end levenshtein &raquo; </span> 
 
 
<a name="LN206"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN207"><span class='Ref_to_Func'>levenshtein_less_equal_with_costs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN208"></a><span class='Declare_Function'>levenshtein_less_equal_with_costs</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN210"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN211"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>dst</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN212"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ins_c</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN213"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>del_c</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN214"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sub_c</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN215"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>max_d</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN216"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>s_data</span><span class='Delimiter'>; 
</span><a name="LN217"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>t_data</span><span class='Delimiter'>; 
</span><a name="LN218"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>s_bytes</span><span class='Delimiter'>, 
</span><a name="LN219"></a>                <span class='Declare_Local'>t_bytes</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract a pointer to the actual character data */ 
</span>    <a href="fuzzystrmatch.c.html#LN216"><span class='Ref_To_Local'>s_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN210"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN217"><span class='Ref_To_Local'>t_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN211"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Determine length of each string in bytes */ 
</span>    <a href="fuzzystrmatch.c.html#LN218"><span class='Ref_To_Local'>s_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN210"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN219"><span class='Ref_To_Local'>t_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN211"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/varlena.h.html#LN24"><span class='Ref_to_Proto'>varstr_levenshtein_less_equal</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN216"><span class='Ref_To_Local'>s_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN218"><span class='Ref_To_Local'>s_bytes</span></a><span class='Delimiter'>, 
</span>                                                  <a href="fuzzystrmatch.c.html#LN217"><span class='Ref_To_Local'>t_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN219"><span class='Ref_To_Local'>t_bytes</span></a><span class='Delimiter'>, 
</span>                                                  <a href="fuzzystrmatch.c.html#LN212"><span class='Ref_To_Local'>ins_c</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN213"><span class='Ref_To_Local'>del_c</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN214"><span class='Ref_To_Local'>sub_c</span></a><span class='Delimiter'>, 
</span>                                                  <a href="fuzzystrmatch.c.html#LN215"><span class='Ref_To_Local'>max_d</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end levenshtein_less_equal_with_costs &raquo; </span> 
 
 
<a name="LN235"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN236"><span class='Ref_to_Func'>levenshtein_less_equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN237"></a><span class='Declare_Function'>levenshtein_less_equal</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN239"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN240"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>dst</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN241"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>max_d</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN242"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>s_data</span><span class='Delimiter'>; 
</span><a name="LN243"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>t_data</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>s_bytes</span><span class='Delimiter'>, 
</span><a name="LN245"></a>                <span class='Declare_Local'>t_bytes</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract a pointer to the actual character data */ 
</span>    <a href="fuzzystrmatch.c.html#LN242"><span class='Ref_To_Local'>s_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN239"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN243"><span class='Ref_To_Local'>t_data</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN240"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Determine length of each string in bytes */ 
</span>    <a href="fuzzystrmatch.c.html#LN244"><span class='Ref_To_Local'>s_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN239"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN245"><span class='Ref_To_Local'>t_bytes</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN240"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/varlena.h.html#LN24"><span class='Ref_to_Proto'>varstr_levenshtein_less_equal</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN242"><span class='Ref_To_Local'>s_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN244"><span class='Ref_To_Local'>s_bytes</span></a><span class='Delimiter'>, 
</span>                                                  <a href="fuzzystrmatch.c.html#LN243"><span class='Ref_To_Local'>t_data</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN245"><span class='Ref_To_Local'>t_bytes</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                  <a href="fuzzystrmatch.c.html#LN241"><span class='Ref_To_Local'>max_d</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end levenshtein_less_equal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Calculates the metaphone of an input string. 
 * Returns number of characters requested 
 * (suggested value is 4) 
 */ 
</span><a name="LN266"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN267"><span class='Ref_to_Func'>metaphone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN268"></a><span class='Declare_Function'>metaphone</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN270"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str_i</span> <span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN271"></a>    size_t      <span class='Declare_Local'>str_i_len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN270"><span class='Ref_To_Local'>str_i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN272"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>reqlen</span><span class='Delimiter'>; 
</span><a name="LN273"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>metaph</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* return an empty string if we receive one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN271"><span class='Ref_To_Local'>str_i_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN271"><span class='Ref_To_Local'>str_i_len</span></a> <span class='Operator'>&GT; </span><a href="fuzzystrmatch.c.html#LN71"><span class='Ref_to_Const'>MAX_METAPHONE_STRLEN</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument exceeds the maximum length of %d bytes"</span><span class='Delimiter'>, 
</span>                        <a href="fuzzystrmatch.c.html#LN71"><span class='Ref_to_Const'>MAX_METAPHONE_STRLEN</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN272"><span class='Ref_To_Local'>reqlen</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN272"><span class='Ref_To_Local'>reqlen</span></a> <span class='Operator'>&GT; </span><a href="fuzzystrmatch.c.html#LN71"><span class='Ref_to_Const'>MAX_METAPHONE_STRLEN</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"output exceeds the maximum length of %d bytes"</span><span class='Delimiter'>, 
</span>                        <a href="fuzzystrmatch.c.html#LN71"><span class='Ref_to_Const'>MAX_METAPHONE_STRLEN</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN272"><span class='Ref_To_Local'>reqlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ZERO_LENGTH_CHARACTER_STRING<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"output cannot be empty string"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
 
    <a href="fuzzystrmatch.c.html#LN274"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="fuzzystrmatch.c.html#LN118"><span class='Ref_to_Proto'>_metaphone</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN270"><span class='Ref_To_Local'>str_i</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN272"><span class='Ref_To_Local'>reqlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="fuzzystrmatch.c.html#LN273"><span class='Ref_To_Local'>metaph</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN274"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>== </span><a href="fuzzystrmatch.c.html#LN104"><span class='Ref_to_Const'>META_SUCCESS</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN273"><span class='Ref_To_Local'>metaph</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* internal error */ 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"metaphone: failure"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* keep the compiler quiet */ 
</span>        <a href="../../src/include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end metaphone &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Original code by Michael G Schwern starts here. 
 * Code slightly modified for use as PostgreSQL 
 * function (palloc, etc). 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* I suppose I could have been using a character pointer instead of 
 * accessing the array directly... */ 
</span> 
<span class='Comment_Multi_Line'>/* Look at the next letter in the word */ 
</span><a name="LN322"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>Next_Letter</span> <span class='Parentheses'>(</span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="../../src/backend/regex/regcomp.c.html#LN47"><span class='Ref_to_Proto'>word</span></a><span class='Delimiter'>[</span>w_idx<span class='Operator'>+</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
<span class='Comment_Multi_Line'>/* Look at the current letter in the word */ 
</span><a name="LN324"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>Curr_Letter</span> <span class='Parentheses'>(</span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="../../src/backend/regex/regcomp.c.html#LN47"><span class='Ref_to_Proto'>word</span></a><span class='Delimiter'>[</span>w_idx<span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
<span class='Comment_Multi_Line'>/* Go N letters back. */ 
</span><a name="LN326"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>Look_Back_Letter</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span>w_idx <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN326"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span> <span class='Operator'>? </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="../../src/backend/regex/regcomp.c.html#LN47"><span class='Ref_to_Proto'>word</span></a><span class='Delimiter'>[</span>w_idx<span class='Operator'>-</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN326"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
<span class='Comment_Multi_Line'>/* Previous letter.  I dunno, should this return null on failure? */ 
</span><a name="LN329"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>Prev_Letter</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN326"><span class='Ref_to_Macro'>Look_Back_Letter</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
<span class='Comment_Multi_Line'>/* Look two letters down.  It makes sure you don't walk off the string. */ 
</span><a name="LN331"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>After_Next_Letter</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>? </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="../../src/backend/regex/regcomp.c.html#LN47"><span class='Ref_to_Proto'>word</span></a><span class='Delimiter'>[</span>w_idx<span class='Operator'>+</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
<a name="LN333"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>Look_Ahead_Letter</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="fuzzystrmatch.c.html#LN117"><span class='Ref_to_Proto'>Lookahead</span></a><span class='Parentheses'>(</span><a href="../../src/backend/regex/regcomp.c.html#LN47"><span class='Ref_to_Proto'>word</span></a><span class='Operator'>+</span>w_idx<span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN333"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
 
 
<span class='Comment_Multi_Line'>/* Allows us to safely look ahead an arbitrary # of letters */ 
/* I probably could have just used strlen... */ 
</span><span class='Keyword'>static char 
</span><a name="LN339"></a><span class='Declare_Function'>Lookahead</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>how_far</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN341"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>letter_ahead</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* null by default */ 
</span><a name="LN342"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN342"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fuzzystrmatch.c.html#LN339"><span class='Ref_to_Parameter'>word</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN342"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& </span><a href="fuzzystrmatch.c.html#LN342"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&LT; </span><a href="fuzzystrmatch.c.html#LN339"><span class='Ref_to_Parameter'>how_far</span></a><span class='Delimiter'>; </span><a href="fuzzystrmatch.c.html#LN342"><span class='Ref_To_Local'>idx</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Edge forward in the string... */ 
</span> 
    <a href="fuzzystrmatch.c.html#LN341"><span class='Ref_To_Local'>letter_ahead</span></a> <span class='Operator'>= </span><a href="fuzzystrmatch.c.html#LN339"><span class='Ref_to_Parameter'>word</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN342"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>];</span>   <span class='Comment_Multi_Line'>/* idx will be either == to how_far or at the 
                                 * end of the string */ 
</span>    <span class='Control'>return</span> <a href="fuzzystrmatch.c.html#LN341"><span class='Ref_To_Local'>letter_ahead</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* phonize one letter */ 
</span><a name="LN354"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>Phonize</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>  <span class='Control'>do</span> <span class='Delimiter'>{</span><span class='Parentheses'>(</span><span class='Operator'>*</span>phoned_word<span class='Parentheses'>)</span><span class='Delimiter'>[</span>p_idx<span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>;} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><span class='Comment_Multi_Line'>/* Slap a null character on the end of the phoned word */ 
</span><a name="LN356"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>End_Phoned_Word</span> <span class='Control'>do</span> <span class='Delimiter'>{</span><span class='Parentheses'>(</span><span class='Operator'>*</span>phoned_word<span class='Parentheses'>)</span><span class='Delimiter'>[</span>p_idx<span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><span class='Comment_Multi_Line'>/* How long is the phoned word? */ 
</span><a name="LN358"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>Phone_Len</span>   <span class='Parentheses'>(</span>p_idx<span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* Note is a letter is a 'break' in the word */ 
</span><a name="LN361"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>Isbreak</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><span class='Operator'>!</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) (</span><a href="fuzzystrmatch.c.html#LN361"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>)))</span> 
 
 
<span class='Keyword'>static int 
</span><a name="LN365"></a><span class='Declare_Function'>_metaphone</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>word</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* IN */ 
</span><a name="LN366"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>max_phonemes</span><span class='Delimiter'>, 
</span><a name="LN367"></a>           <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>phoned_word</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* OUT */ 
</span><span class='Delimiter'>{ 
</span><a name="LN369"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>w_idx</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* point in the phonization we're at. */ 
</span><a name="LN370"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>p_idx</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* end of the phoned phrase */ 
</span> 
    <span class='Comment_Multi_Line'>/*-- Parameter checks --*/ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Shouldn't be necessary, but left these here anyway jec Aug 3, 2001 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Negative phoneme length is meaningless */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Comment_Multi_Line'>/* internal error */ 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"metaphone: Requested output length must be &GT; 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Empty/null string is meaningless */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="fuzzystrmatch.c.html#LN365"><span class='Ref_to_Parameter'>word</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>|| !</span><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN365"><span class='Ref_to_Parameter'>word</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Comment_Multi_Line'>/* internal error */ 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"metaphone: Input string length must be &GT; 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*-- Allocate memory for our phoned_phrase --*/ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* Assume largest possible */ 
</span>        <span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN367"><span class='Ref_to_Parameter'>phoned_word</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Operator'>* </span>strlen<span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN365"><span class='Ref_to_Parameter'>word</span></a><span class='Parentheses'>) </span><span class='Operator'>+</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN367"><span class='Ref_to_Parameter'>phoned_word</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/*-- The first phoneme has to be processed specially. --*/ 
</span>    <span class='Comment_Multi_Line'>/* Find our first letter */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><span class='Operator'>!</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) (</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; </span><a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* On the off chance we were given nothing but crap... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="fuzzystrmatch.c.html#LN356"><span class='Ref_to_Const'>End_Phoned_Word</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="fuzzystrmatch.c.html#LN104"><span class='Ref_to_Const'>META_SUCCESS</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* For testing */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* AE becomes E */ 
</span>        <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'E'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* Remember, preserve vowels at the beginning */ 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'A'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* [GKP]N becomes N */ 
</span>        <span class='Control'>case</span> <span class='String'>'G'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'K'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'N'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'N'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * WH becomes H, WR becomes R W if followed by a vowel 
             */ 
</span>        <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'H'</span> <span class='Operator'>|| 
</span>                <a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'R'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN143"><span class='Ref_to_Macro'>isvowel</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'W'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* else ignore */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* X becomes S */ 
</span>        <span class='Control'>case</span> <span class='String'>'X'</span><span class='Operator'>: 
</span>            <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'S'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Vowels are kept */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We did A already case 'A': case 'a': 
             */ 
</span>        <span class='Control'>case</span> <span class='String'>'E'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'I'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'O'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'U'</span><span class='Operator'>: 
</span>            <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* do nothing */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch Curr_Letter &raquo; </span> 
 
 
 
    <span class='Comment_Multi_Line'>/* On to the metaphoning */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& 
</span>         <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="fuzzystrmatch.c.html#LN358"><span class='Ref_to_Const'>Phone_Len</span></a> <span class='Operator'>&LT; </span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>         <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * How many letters to skip because an earlier encoding handled 
         * multiple letters 
         */ 
</span><a name="LN487"></a>        <span class='Keyword'>unsigned short int </span><span class='Declare_Local'>skip_letter</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * THOUGHT:  It would be nice if, rather than having things like... 
         * well, SCI.  For SCI you encode the S, then have to remember to skip 
         * the C.  So the phonome SCI invades both S and C.  It would be 
         * better, IMHO, to skip the C from the S part of the encoding. Hell, 
         * I'm trying it. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore non-alphas */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) (</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Drop duplicates, except CC */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a> <span class='Operator'>== </span><a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a> <span class='Operator'>&& 
</span>            <a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a> <span class='Operator'>!= </span><span class='String'>'C'</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* B -&GT; B unless in MB */ 
</span>            <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a> <span class='Operator'>!= </span><span class='String'>'M'</span><span class='Parentheses'>) 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'B'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * 'sh' if -CIA- or -CH, but not SCH, except SCHW. (SCHW is 
                 * handled in S) S if -CI-, -CE- or -CY- dropped if -SCI-, 
                 * SCE-, -SCY- (handed in S) else K 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN152"><span class='Ref_to_Macro'>MAKESOFT</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{</span>               <span class='Comment_Single_Line'>/* C[IEY] */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'A'</span> <span class='Operator'>&& 
</span>                        <a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'I'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{</span>           <span class='Comment_Single_Line'>/* CIA */ 
</span>                        <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* SC[IEY] */ 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a> <span class='Operator'>== </span><span class='String'>'S'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Dropped */ 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'S'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'H'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><span class='Directive'>#ifndef</span> USE_TRADITIONAL_METAPHONE 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'R'</span> <span class='Operator'>|| 
</span>                        <a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a> <span class='Operator'>== </span><span class='String'>'S'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{</span>           <span class='Comment_Single_Line'>/* Christ, School */ 
</span>                        <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                    <a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * J if in -DGE-, -DGI- or -DGY- else T 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'G'</span> <span class='Operator'>&& 
</span>                    <a href="fuzzystrmatch.c.html#LN152"><span class='Ref_to_Macro'>MAKESOFT</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'J'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'T'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * F if in -GH and not B--GH, D--GH, -H--GH, -H---GH else 
                 * dropped if -GNED, -GN, else dropped if -DGE-, -DGI- or 
                 * -DGY- (handled in D) else J if in -GE-, -GI, -GY and not GG 
                 * else K 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'G'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'H'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN155"><span class='Ref_to_Macro'>NOGHTOF</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN326"><span class='Ref_to_Macro'>Look_Back_Letter</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>                          <a href="fuzzystrmatch.c.html#LN326"><span class='Ref_to_Macro'>Look_Back_Letter</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'H'</span><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'F'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* silent */ 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'N'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN361"><span class='Ref_to_Macro'>Isbreak</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                        <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'E'</span> <span class='Operator'>&& 
</span>                         <a href="fuzzystrmatch.c.html#LN333"><span class='Ref_to_Macro'>Look_Ahead_Letter</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'D'</span><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* dropped */ 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN152"><span class='Ref_to_Macro'>MAKESOFT</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                         <a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a> <span class='Operator'>!= </span><span class='String'>'G'</span><span class='Parentheses'>)</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'J'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* H if before a vowel and not after C,G,P,S,T */ 
</span>            <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN143"><span class='Ref_to_Macro'>isvowel</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                    <span class='Operator'>!</span><a href="fuzzystrmatch.c.html#LN149"><span class='Ref_to_Macro'>AFFECTH</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a><span class='Parentheses'>))</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'H'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * dropped if after C else K 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'K'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN329"><span class='Ref_to_Const'>Prev_Letter</span></a> <span class='Operator'>!= </span><span class='String'>'C'</span><span class='Parentheses'>) 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * F if before H else P 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'P'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'H'</span><span class='Parentheses'>) 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'F'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'P'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * K 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'Q'</span><span class='Operator'>: 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * 'sh' in -SH-, -SIO- or -SIA- or -SCHW- else S 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'I'</span> <span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'O'</span> <span class='Operator'>|| 
</span>                     <a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'A'</span><span class='Parentheses'>))</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'H'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#ifndef</span> USE_TRADITIONAL_METAPHONE 
                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'C'</span> <span class='Operator'>&& 
</span>                         <a href="fuzzystrmatch.c.html#LN333"><span class='Ref_to_Macro'>Look_Ahead_Letter</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'H'</span> <span class='Operator'>&& 
</span>                         <a href="fuzzystrmatch.c.html#LN333"><span class='Ref_to_Macro'>Look_Ahead_Letter</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'W'</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
                <span class='Control'>else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'S'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * 'sh' in -TIA- or -TIO- else 'th' before H else T 
                 */ 
</span>            <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'I'</span> <span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'O'</span> <span class='Operator'>|| 
</span>                     <a href="fuzzystrmatch.c.html#LN331"><span class='Ref_to_Const'>After_Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'A'</span><span class='Parentheses'>))</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN114"><span class='Ref_to_Const'>SH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a> <span class='Operator'>== </span><span class='String'>'H'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN115"><span class='Ref_to_Const'>TH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'T'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* F */ 
</span>            <span class='Control'>case</span> <span class='String'>'V'</span><span class='Operator'>: 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'F'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* W before a vowel, else dropped */ 
</span>            <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN143"><span class='Ref_to_Macro'>isvowel</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>))</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'W'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* KS */ 
</span>            <span class='Control'>case</span> <span class='String'>'X'</span><span class='Operator'>: 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'K'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="fuzzystrmatch.c.html#LN358"><span class='Ref_to_Const'>Phone_Len</span></a> <span class='Operator'>&LT; </span><a href="fuzzystrmatch.c.html#LN366"><span class='Ref_to_Parameter'>max_phonemes</span></a><span class='Parentheses'>) 
</span>                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'S'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Y if followed by a vowel */ 
</span>            <span class='Control'>case</span> <span class='String'>'Y'</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN143"><span class='Ref_to_Macro'>isvowel</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN322"><span class='Ref_to_Const'>Next_Letter</span></a><span class='Parentheses'>))</span> 
                    <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'Y'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* S */ 
</span>            <span class='Control'>case</span> <span class='String'>'Z'</span><span class='Operator'>: 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><span class='String'>'S'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* No transformation */ 
</span>            <span class='Control'>case</span> <span class='String'>'F'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'J'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'L'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'M'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'N'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'R'</span><span class='Operator'>: 
</span>                <a href="fuzzystrmatch.c.html#LN354"><span class='Ref_to_Macro'>Phonize</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN324"><span class='Ref_to_Const'>Curr_Letter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* nothing */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch Curr_Letter &raquo; </span>                       <span class='Comment_Single_Line'>/* END SWITCH */ 
</span> 
        <a href="fuzzystrmatch.c.html#LN369"><span class='Ref_To_Local'>w_idx</span></a> <span class='Operator'>+= </span><a href="fuzzystrmatch.c.html#LN487"><span class='Ref_To_Local'>skip_letter</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;Curr_Letter!='\0'&&(... &raquo; </span>                           <span class='Comment_Single_Line'>/* END FOR */ 
</span> 
    <a href="fuzzystrmatch.c.html#LN356"><span class='Ref_to_Const'>End_Phoned_Word</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN104"><span class='Ref_to_Const'>META_SUCCESS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _metaphone &raquo; </span>   <span class='Comment_Single_Line'>/* END metaphone */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function: soundex(text) returns text 
 */ 
</span><a name="LN730"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN732"><span class='Ref_to_Func'>soundex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN733"></a><span class='Declare_Function'>soundex</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN735"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>outstr</span><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN736"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN736"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN51"><span class='Ref_to_Proto'>_soundex</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN736"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN735"><span class='Ref_To_Local'>outstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN735"><span class='Ref_To_Local'>outstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN746"></a><span class='Declare_Function'>_soundex</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>instr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>outstr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN748"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip leading non-alphabetic characters */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>&& </span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
        <span class='Operator'>++</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No string left */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Take the first letter as is */ 
</span>    <span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a><span class='Operator'>++ = </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN748"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a> <span class='Operator'>&& </span><a href="fuzzystrmatch.c.html#LN748"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&LT; </span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="fuzzystrmatch.c.html#LN58"><span class='Ref_to_Func'>soundex_code</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="fuzzystrmatch.c.html#LN58"><span class='Ref_to_Func'>soundex_code</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a> <span class='Operator'>= </span><a href="fuzzystrmatch.c.html#LN58"><span class='Ref_to_Func'>soundex_code</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a> <span class='Operator'>!= </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>++</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>++</span><a href="fuzzystrmatch.c.html#LN748"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>++</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>instr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Fill with 0's */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN748"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&LT; </span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a> <span class='Operator'>= </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>++</span><a href="fuzzystrmatch.c.html#LN746"><span class='Ref_to_Parameter'>outstr</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>++</span><a href="fuzzystrmatch.c.html#LN748"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end _soundex &raquo; </span> 
 
<a name="LN794"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN796"><span class='Ref_to_Func'>difference</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN797"></a><span class='Declare_Function'>difference</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN799"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sndx1</span><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>], 
</span><a name="LN800"></a>                <span class='Declare_Local'>sndx2</span><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN801"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN802"></a>                <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN51"><span class='Ref_to_Proto'>_soundex</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN799"><span class='Ref_To_Local'>sndx1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="fuzzystrmatch.c.html#LN51"><span class='Ref_to_Proto'>_soundex</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>, </span><a href="fuzzystrmatch.c.html#LN800"><span class='Ref_To_Local'>sndx2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="fuzzystrmatch.c.html#LN802"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN801"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="fuzzystrmatch.c.html#LN801"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="fuzzystrmatch.c.html#LN53"><span class='Ref_to_Const'>SOUNDEX_LEN</span></a><span class='Delimiter'>; </span><a href="fuzzystrmatch.c.html#LN801"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN799"><span class='Ref_To_Local'>sndx1</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN801"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="fuzzystrmatch.c.html#LN800"><span class='Ref_To_Local'>sndx2</span></a><span class='Delimiter'>[</span><a href="fuzzystrmatch.c.html#LN801"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="fuzzystrmatch.c.html#LN802"><span class='Ref_To_Local'>result</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="fuzzystrmatch.c.html#LN802"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end difference &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>