<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\hstore\hstore_io.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\hstore\hstore_io.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:25 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 * contrib/hstore/hstore_io.c 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/json.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/jsonapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/jsonb.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"hstore.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* old names for C functions */ 
</span><a name="LN25"></a><span class='Declare_Prototype'>HSTORE_POLLUTE</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN487"><span class='Ref_to_Func'>hstore_from_text</span></a><span class='Delimiter'>, </span>tconvert<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN30"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>begin</span><span class='Delimiter'>; 
</span><a name="LN31"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>ptr</span><span class='Delimiter'>; 
</span><a name="LN32"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>cur</span><span class='Delimiter'>; 
</span><a name="LN33"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>word</span><span class='Delimiter'>; 
</span><a name="LN34"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>wordlen</span><span class='Delimiter'>; 
</span> 
<a name="LN36"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>pairs</span><span class='Delimiter'>; 
</span><a name="LN37"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>pcur</span><span class='Delimiter'>; 
</span><a name="LN38"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>plen</span><span class='Delimiter'>; 
</span><a name="LN39"></a>} <span class='Declare_Typedef'>HSParser</span><span class='Delimiter'>; 
</span> 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RESIZEPRSBUF</span> <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>( </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>cur <span class='Operator'>- </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>word <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&GT;= </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>wordlen <span class='Parentheses'>) </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>                <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> clen <span class='Operator'>= </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>cur <span class='Operator'>- </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>word<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>wordlen <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>word <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Operator'>*</span><span class='Parentheses'>)</span><a href="../../src/include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span> <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Operator'>*</span><span class='Parentheses'>)</span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>word<span class='Delimiter'>, </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>wordlen <span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>                <a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>cur <span class='Operator'>= </span><a href="../../src/timezone/pgtz.h.html#LN40"><span class='Ref_to_Struct'>state</span></a><span class='Operator'>-&GT;</span>word <span class='Operator'>+ </span>clen<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
 
<a name="LN53"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>GV_WAITVAL</span> <span class='Number'>0</span> 
<a name="LN54"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>GV_INVAL</span> <span class='Number'>1</span> 
<a name="LN55"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>GV_INESCVAL</span> <span class='Number'>2</span> 
<a name="LN56"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>GV_WAITESCIN</span> <span class='Number'>3</span> 
<a name="LN57"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>GV_WAITESCESCIN</span> <span class='Number'>4</span> 
 
<span class='Keyword'>static bool 
</span><a name="LN60"></a><span class='Declare_Function'>get_val</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN28"><span class='Ref_to_Typedef'>HSParser</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>ignoreeq</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>escaped</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN62"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>st</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN53"><span class='Ref_to_Const'>GV_WAITVAL</span></a><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN34"><span class='Ref_to_Member'>wordlen</span></a> <span class='Operator'>= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN34"><span class='Ref_to_Member'>wordlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>escaped</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN53"><span class='Ref_to_Const'>GV_WAITVAL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>escaped</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN55"><span class='Ref_to_Const'>GV_INESCVAL</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'='</span> <span class='Operator'>&& !</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>ignoreeq</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Syntax error near '%c' at position %d"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN30"><span class='Ref_to_Member'>begin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN56"><span class='Ref_to_Const'>GV_WAITESCIN</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN54"><span class='Ref_to_Const'>GV_INVAL</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if st==GV_WAITVAL &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN54"><span class='Ref_to_Const'>GV_INVAL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN56"><span class='Ref_to_Const'>GV_WAITESCIN</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'='</span> <span class='Operator'>&& !</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>ignoreeq</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>','</span> <span class='Operator'>&& </span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>ignoreeq</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN41"><span class='Ref_to_Const'>RESIZEPRSBUF</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if st==GV_INVAL &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN55"><span class='Ref_to_Const'>GV_INESCVAL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN57"><span class='Ref_to_Const'>GV_WAITESCESCIN</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unexpected end of string"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN41"><span class='Ref_to_Const'>RESIZEPRSBUF</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if st==GV_INESCVAL &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN56"><span class='Ref_to_Const'>GV_WAITESCIN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unexpected end of string"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN41"><span class='Ref_to_Const'>RESIZEPRSBUF</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN54"><span class='Ref_to_Const'>GV_INVAL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN57"><span class='Ref_to_Const'>GV_WAITESCESCIN</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unexpected end of string"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN41"><span class='Ref_to_Const'>RESIZEPRSBUF</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>) </span><span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN55"><span class='Ref_to_Const'>GV_INESCVAL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unknown state %d at position line %d in file '%s'"</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN62"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span>__LINE__<span class='Delimiter'>, </span>__FILE__<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while 1 &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end get_val &raquo; </span> 
 
<a name="LN174"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>WKEY</span>    <span class='Number'>0</span> 
<a name="LN175"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>WVAL</span>    <span class='Number'>1</span> 
<a name="LN176"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>WEQ</span> <span class='Number'>2</span> 
<a name="LN177"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>WGT</span> <span class='Number'>3</span> 
<a name="LN178"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>WDEL</span>    <span class='Number'>4</span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN182"></a><span class='Declare_Function'>parse_hstore</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN28"><span class='Ref_to_Typedef'>HSParser</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN184"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>st</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN174"><span class='Ref_to_Const'>WKEY</span></a><span class='Delimiter'>; 
</span><a name="LN185"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>escaped</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN38"><span class='Ref_to_Member'>plen</span></a> <span class='Operator'>= </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN38"><span class='Ref_to_Member'>plen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN30"><span class='Ref_to_Member'>begin</span></a><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN174"><span class='Ref_to_Const'>WKEY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hstore_io.c.html#LN59"><span class='Ref_to_Func'>get_val</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN185"><span class='Ref_To_Local'>escaped</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a> <span class='Operator'>&GT;= </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN38"><span class='Ref_to_Member'>plen</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN38"><span class='Ref_to_Member'>plen</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN38"><span class='Ref_to_Member'>plen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN176"><span class='Ref_to_Const'>WEQ</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN176"><span class='Ref_to_Const'>WEQ</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'='</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN177"><span class='Ref_to_Const'>WGT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unexpected end of string"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Syntax error near '%c' at position %d"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN30"><span class='Ref_to_Member'>begin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN177"><span class='Ref_to_Const'>WGT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'&GT;'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN175"><span class='Ref_to_Const'>WVAL</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unexpected end of string"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Syntax error near '%c' at position %d"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN30"><span class='Ref_to_Member'>begin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN175"><span class='Ref_to_Const'>WVAL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hstore_io.c.html#LN59"><span class='Ref_to_Func'>get_val</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN185"><span class='Ref_To_Local'>escaped</span></a><span class='Parentheses'>))</span> 
                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unexpected end of string"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN174"><span class='Ref_to_Proto'>hstoreCheckValLen</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN32"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a> <span class='Operator'>== </span><span class='Number'>4</span> <span class='Operator'>&& !</span><a href="hstore_io.c.html#LN185"><span class='Ref_To_Local'>escaped</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Number'>0</span> <span class='Operator'>== </span><a href="../../src/port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>))</span> 
                    <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN33"><span class='Ref_to_Member'>word</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN178"><span class='Ref_to_Const'>WDEL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN178"><span class='Ref_to_Const'>WDEL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>','</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN174"><span class='Ref_to_Const'>WKEY</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Syntax error near '%c' at position %d"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN30"><span class='Ref_to_Member'>begin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"Unknown state %d at line %d in file '%s'"</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN184"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span>__LINE__<span class='Delimiter'>, </span>__FILE__<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN182"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="hstore_io.c.html#LN31"><span class='Ref_to_Member'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while 1 &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end parse_hstore &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN281"></a><span class='Declare_Function'>comparePairs</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN283"></a>    <span class='Keyword'>const </span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pa</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN281"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN284"></a>    <span class='Keyword'>const </span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pb</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN281"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN283"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN284"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN288"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="hstore_io.c.html#LN283"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN284"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN283"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN288"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="hstore_io.c.html#LN288"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* guarantee that needfree will be later */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN284"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN283"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN283"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN283"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>&GT; </span><a href="hstore_io.c.html#LN284"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end comparePairs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * this code still respects pairs.needfree, even though in general 
 * it should never be called in a context where anything needs freeing. 
 * we keep it because (a) those calls are in a rare code path anyway, 
 * and (b) who knows whether they might be needed by some caller. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN311"></a><span class='Declare_Function'>hstoreUniquePairs</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>l</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN313"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>, 
</span><a name="LN314"></a>               <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>buflen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>l</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>l</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>buflen</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>l</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>l</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN280"><span class='Ref_to_Func'>comparePairs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>l</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>&& 
</span>            memcmp<span class='Parentheses'>(</span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>buflen</span></a> <span class='Operator'>+= </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hstore_io.c.html#LN313"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while ptr-a&LT;l &raquo; </span> 
 
    <span class='Operator'>*</span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>buflen</span></a> <span class='Operator'>+= </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="hstore_io.c.html#LN314"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>- </span><a href="hstore_io.c.html#LN311"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstoreUniquePairs &raquo; </span> 
 
size_t 
<a name="LN353"></a><span class='Declare_Function'>hstoreCheckKeyLen</span><span class='Parentheses'>(</span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN353"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="hstore.h.html#LN40"><span class='Ref_to_Const'>HSTORE_MAX_KEY_LEN</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_STRING_DATA_RIGHT_TRUNCATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"string too long for hstore key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="hstore_io.c.html#LN353"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
} 
</span> 
size_t 
<a name="LN363"></a><span class='Declare_Function'>hstoreCheckValLen</span><span class='Parentheses'>(</span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN363"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="hstore.h.html#LN41"><span class='Ref_to_Const'>HSTORE_MAX_VALUE_LEN</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_STRING_DATA_RIGHT_TRUNCATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"string too long for hstore value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="hstore_io.c.html#LN363"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
} 
</span> 
 
<a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a> <span class='Operator'>* 
</span><a name="LN374"></a><span class='Declare_Function'>hstorePairs</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pairs</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>pcount</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN376"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN377"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN378"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN379"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN380"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN381"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN380"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>pcount</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN380"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN380"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore.h.html#LN61"><span class='Ref_to_Macro'>HS_SETCOUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>pcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>pcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN377"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN379"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN378"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN381"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN381"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>pcount</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN381"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="hstore.h.html#LN111"><span class='Ref_to_Macro'>HS_ADDITEM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN377"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN379"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN378"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN381"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore.h.html#LN128"><span class='Ref_to_Macro'>HS_FINALIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN374"><span class='Ref_to_Parameter'>pcount</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN379"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN378"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="hstore_io.c.html#LN376"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstorePairs &raquo; </span> 
 
 
<a name="LN403"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN404"><span class='Ref_to_Func'>hstore_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN405"></a><span class='Declare_Function'>hstore_in</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN407"></a>    <a href="hstore_io.c.html#LN28"><span class='Ref_to_Typedef'>HSParser</span></a>    <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN408"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN409"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="hstore_io.c.html#LN30"><span class='Ref_to_Member'>begin</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN181"><span class='Ref_to_Func'>parse_hstore</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN170"><span class='Ref_to_Proto'>hstoreUniquePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN408"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN409"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="hstore_io.c.html#LN36"><span class='Ref_to_Member'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN407"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="hstore_io.c.html#LN37"><span class='Ref_to_Member'>pcur</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN408"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN409"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a name="LN423"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN424"><span class='Ref_to_Func'>hstore_recv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN425"></a><span class='Declare_Function'>hstore_recv</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN427"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN428"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN429"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pairs</span><span class='Delimiter'>; 
</span><a name="LN430"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN431"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>pcount</span><span class='Delimiter'>; 
</span><a name="LN432"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../src/include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a> <span class='Operator'>= </span><a href="../../src/include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN432"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN428"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN428"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a> <span class='Operator'>&GT; </span><a href="../../src/common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of pairs (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                     <a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="../../src/common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN451"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>rawlen</span> <span class='Operator'>= </span><a href="../../src/include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN432"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN452"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN451"><span class='Ref_To_Local'>rawlen</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for hstore key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/libpq/pqformat.h.html#LN44"><span class='Ref_to_Proto'>pq_getmsgtext</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN432"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN451"><span class='Ref_To_Local'>rawlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN452"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN452"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN451"><span class='Ref_To_Local'>rawlen</span></a> <span class='Operator'>= </span><a href="../../src/include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN432"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN451"><span class='Ref_To_Local'>rawlen</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="../../src/include/libpq/pqformat.h.html#LN44"><span class='Ref_to_Proto'>pq_getmsgtext</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN432"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN451"><span class='Ref_To_Local'>rawlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN452"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN174"><span class='Ref_to_Proto'>hstoreCheckValLen</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN452"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN430"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;pcount;++i &raquo; </span> 
 
    <a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN170"><span class='Ref_to_Proto'>hstoreUniquePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN427"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN428"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN429"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN431"><span class='Ref_To_Local'>pcount</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN427"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN428"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_recv &raquo; </span> 
 
 
<a name="LN486"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN487"><span class='Ref_to_Func'>hstore_from_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN488"></a><span class='Declare_Function'>hstore_from_text</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN490"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN492"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>       <span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN493"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../src/include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN490"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN490"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN490"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN491"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN491"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN174"><span class='Ref_to_Proto'>hstoreCheckValLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN491"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hstore_io.c.html#LN493"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>+ </span><a href="hstore_io.c.html#LN492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN493"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_from_text &raquo; </span> 
 
 
<a name="LN522"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN523"><span class='Ref_to_Func'>hstore_from_arrays</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN524"></a><span class='Declare_Function'>hstore_from_arrays</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN526"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN527"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN528"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pairs</span><span class='Delimiter'>; 
</span><a name="LN529"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>key_datums</span><span class='Delimiter'>; 
</span><a name="LN530"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>key_nulls</span><span class='Delimiter'>; 
</span><a name="LN531"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>key_count</span><span class='Delimiter'>; 
</span><a name="LN532"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>value_datums</span><span class='Delimiter'>; 
</span><a name="LN533"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>value_nulls</span><span class='Delimiter'>; 
</span><a name="LN534"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>value_count</span><span class='Delimiter'>; 
</span><a name="LN535"></a>    <a href="../../src/include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>key_array</span><span class='Delimiter'>; 
</span><a name="LN536"></a>    <a href="../../src/include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>value_array</span><span class='Delimiter'>; 
</span><a name="LN537"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../src/include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * must check &GT;1 rather than != 1 because empty arrays have 0 dimensions, 
     * not 1 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="hstore_io.c.html#LN529"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN530"><span class='Ref_To_Local'>key_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* see discussion in hstoreArrayToPairs() */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a> <span class='Operator'>&GT; </span><a href="../../src/common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of pairs (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                     <a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="../../src/common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* value_array might be NULL */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN534"><span class='Ref_To_Local'>value_count</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN532"><span class='Ref_To_Local'>value_datums</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN533"><span class='Ref_To_Local'>value_nulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>             <a href="../../src/include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../src/include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>             <a href="../../src/include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN535"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../src/include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"arrays must have same bounds"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN536"><span class='Ref_To_Local'>value_array</span></a><span class='Delimiter'>, 
</span>                          <a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="hstore_io.c.html#LN532"><span class='Ref_To_Local'>value_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN533"><span class='Ref_To_Local'>value_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN534"><span class='Ref_To_Local'>value_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a> <span class='Operator'>== </span><a href="hstore_io.c.html#LN534"><span class='Ref_To_Local'>value_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN530"><span class='Ref_To_Local'>key_nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for hstore key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hstore_io.c.html#LN533"><span class='Ref_To_Local'>value_nulls</span></a> <span class='Operator'>|| </span><a href="hstore_io.c.html#LN533"><span class='Ref_To_Local'>value_nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN529"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= 
</span>                <a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN529"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN529"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN532"><span class='Ref_To_Local'>value_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= 
</span>                <a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN529"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= 
</span>                <a href="hstore.h.html#LN174"><span class='Ref_to_Proto'>hstoreCheckValLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN532"><span class='Ref_To_Local'>value_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key_count;++i &raquo; </span> 
 
    <a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN170"><span class='Ref_to_Proto'>hstoreUniquePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN526"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN527"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN528"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN531"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN526"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN527"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_from_arrays &raquo; </span> 
 
 
<a name="LN642"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN643"><span class='Ref_to_Func'>hstore_from_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN644"></a><span class='Declare_Function'>hstore_from_array</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN646"></a>    <a href="../../src/include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>in_array</span> <span class='Operator'>= </span><a href="../../src/include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN647"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span> <span class='Operator'>= </span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN646"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN648"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span><span class='Delimiter'>; 
</span><a name="LN649"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN650"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN651"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pairs</span><span class='Delimiter'>; 
</span><a name="LN652"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in_datums</span><span class='Delimiter'>; 
</span><a name="LN653"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>in_nulls</span><span class='Delimiter'>; 
</span><a name="LN654"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>in_count</span><span class='Delimiter'>; 
</span><a name="LN655"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN646"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN647"><span class='Ref_To_Local'>ndims</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>            <a href="hstore_io.c.html#LN650"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN650"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../src/include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN646"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>% </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array must have even number of elements"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../src/include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN646"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array must have two columns"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ndims &raquo; </span> 
 
    <a href="../../src/include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN646"><span class='Ref_To_Local'>in_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN653"><span class='Ref_To_Local'>in_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN654"><span class='Ref_To_Local'>in_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN654"><span class='Ref_To_Local'>in_count</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* see discussion in hstoreArrayToPairs() */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&GT; </span><a href="../../src/common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of pairs (%d) exceeds the maximum allowed (%d)"</span><span class='Delimiter'>, 
</span>                     <a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="../../src/common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>)))))</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN653"><span class='Ref_To_Local'>in_nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for hstore key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN653"><span class='Ref_To_Local'>in_nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= 
</span>                <a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= 
</span>                <a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= 
</span>                <a href="hstore.h.html#LN174"><span class='Ref_to_Proto'>hstoreCheckValLen</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN652"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN655"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;++i &raquo; </span> 
 
    <a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN170"><span class='Ref_to_Proto'>hstoreUniquePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN649"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN650"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN651"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN648"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN649"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN650"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_from_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* most of hstore_from_record is shamelessly swiped from record_out */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * structure to cache metadata needed for record I/O 
 */ 
</span><a name="LN742"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ColumnIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN744"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>column_type</span><span class='Delimiter'>; 
</span><a name="LN745"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>typiofunc</span><span class='Delimiter'>; 
</span><a name="LN746"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN747"></a>    <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>proc</span><span class='Delimiter'>; 
</span><a name="LN748"></a>} <span class='Declare_Typedef'>ColumnIOData</span><span class='Delimiter'>; 
</span> 
<a name="LN750"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>RecordIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN752"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>record_type</span><span class='Delimiter'>; 
</span><a name="LN753"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>record_typmod</span><span class='Delimiter'>; 
</span><a name="LN754"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN755"></a>    <a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Declare_Member'>columns</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
</span><a name="LN756"></a>} <span class='Declare_Typedef'>RecordIOData</span><span class='Delimiter'>; 
</span> 
<a name="LN758"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN759"><span class='Ref_to_Func'>hstore_from_record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN760"></a><span class='Declare_Function'>hstore_from_record</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN762"></a>    <a href="../../src/include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN763"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>buflen</span><span class='Delimiter'>; 
</span><a name="LN764"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN765"></a>    <a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pairs</span><span class='Delimiter'>; 
</span><a name="LN766"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN767"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span><a name="LN768"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN769"></a>    <a href="../../src/include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN770"></a>    <a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span><a name="LN771"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN772"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN773"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN774"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN775"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN779"></a>        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtype</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * have no tuple to look at, so the only source of type info is the 
         * argtype. The lookup_rowtype_tupdesc call below will error out if we 
         * don't have a known composite type oid here. 
         */ 
</span>        <a href="hstore_io.c.html#LN766"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN779"><span class='Ref_To_Local'>argtype</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN767"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN275"><span class='Ref_to_Macro'>PG_GETARG_HEAPTUPLEHEADER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Extract type info from the tuple itself */ 
</span>        <a href="hstore_io.c.html#LN766"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../src/include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN767"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../src/include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN766"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN767"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the needed I/O info just once per series of 
     * calls, assuming the record type doesn't change underneath us. 
     */ 
</span>    <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= 
</span>            <a href="../../src/include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                               <a href="../../src/include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a><span class='Delimiter'>, </span>columns<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                               <a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN766"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>|| 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN767"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>               <a href="../../src/include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a><span class='Delimiter'>, </span>columns<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN766"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN767"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>&LT;= </span><a href="../../src/include/access/htup_details.h.html#LN32"><span class='Ref_to_Const'>MaxTupleAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* thus, no overflow */ 
</span>    <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN160"><span class='Ref_to_Typedef'>Pairs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>        <a href="hstore_io.c.html#LN769"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../src/include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN769"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN769"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN769"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN762"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN774"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN775"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Break down the tuple into fields */ 
</span>        <a href="../../src/include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN769"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN774"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN775"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN774"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN775"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN856"></a>        <a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>column_info</span> <span class='Operator'>= &</span><a href="hstore_io.c.html#LN770"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN46"><span class='Ref_to_Member'>columns</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN857"></a>        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>column_type</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span><a name="LN858"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dropped columns in datatype */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN162"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN164"><span class='Ref_to_Member'>keylen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN173"><span class='Ref_to_Proto'>hstoreCheckKeyLen</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hstore_io.c.html#LN775"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>|| </span><a href="hstore_io.c.html#LN775"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Operator'>++</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert the column value to text 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN856"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN34"><span class='Ref_to_Member'>column_type</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN857"><span class='Ref_To_Local'>column_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN882"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typIsVarlena</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN857"><span class='Ref_To_Local'>column_type</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="hstore_io.c.html#LN856"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN35"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="hstore_io.c.html#LN882"><span class='Ref_To_Local'>typIsVarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN856"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN35"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN856"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN38"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                          fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN856"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN34"><span class='Ref_to_Member'>column_type</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN857"><span class='Ref_To_Local'>column_type</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN856"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN38"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN774"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN772"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN163"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN165"><span class='Ref_to_Member'>vallen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN174"><span class='Ref_to_Proto'>hstoreCheckValLen</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN166"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="hstore.h.html#LN167"><span class='Ref_to_Member'>needfree</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Operator'>++</span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0,j=0;i&LT;ncolumns;++... &raquo; </span> 
 
    <a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN170"><span class='Ref_to_Proto'>hstoreUniquePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN773"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN763"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN764"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN171"><span class='Ref_to_Proto'>hstorePairs</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN765"><span class='Ref_To_Local'>pairs</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN771"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN763"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN768"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN764"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_from_record &raquo; </span> 
 
 
<a name="LN911"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN912"><span class='Ref_to_Func'>hstore_populate_record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN913"></a><span class='Declare_Function'>hstore_populate_record</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN915"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtype</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN916"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>hs</span><span class='Delimiter'>; 
</span><a name="LN917"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span><span class='Delimiter'>; 
</span><a name="LN918"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN919"></a>    <a href="../../src/include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN920"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN921"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span><a name="LN922"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN923"></a>    <a href="../../src/include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN924"></a>    <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettuple</span><span class='Delimiter'>; 
</span><a name="LN925"></a>    <a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span><a name="LN926"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN927"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN928"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN929"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN915"><span class='Ref_To_Local'>argtype</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"first argument must be a rowtype"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../src/include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * have no tuple to look at, so the only source of type info is the 
         * argtype. The lookup_rowtype_tupdesc call below will error out if we 
         * don't have a known composite type oid here. 
         */ 
</span>        <a href="hstore_io.c.html#LN920"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN915"><span class='Ref_To_Local'>argtype</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN921"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN275"><span class='Ref_to_Macro'>PG_GETARG_HEAPTUPLEHEADER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Extract type info from the tuple itself */ 
</span>        <a href="hstore_io.c.html#LN920"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../src/include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN921"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../src/include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hstore_io.c.html#LN916"><span class='Ref_To_Local'>hs</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN917"><span class='Ref_To_Local'>entries</span></a> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN916"><span class='Ref_To_Local'>hs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN918"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN916"><span class='Ref_To_Local'>hs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the input hstore is empty, we can only skip the rest if we were 
     * passed in a non-null record, since otherwise there may be issues with 
     * domain nulls. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN916"><span class='Ref_To_Local'>hs</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN920"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN921"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>        <a href="hstore_io.c.html#LN923"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../src/include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN923"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN923"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN923"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../src/include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the needed I/O info just once per series of 
     * calls, assuming the record type doesn't change underneath us. 
     */ 
</span>    <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= 
</span>            <a href="../../src/include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                               <a href="../../src/include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a><span class='Delimiter'>, </span>columns<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                               <a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN920"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>|| 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN921"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>               <a href="../../src/include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN41"><span class='Ref_to_Struct'>RecordIOData</span></a><span class='Delimiter'>, </span>columns<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN920"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN921"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hstore_io.c.html#LN928"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Break down the tuple into fields */ 
</span>        <a href="../../src/include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN923"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN928"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN928"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN926"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1035"></a>        <a href="../../src/backend/utils/adt/rowtypes.c.html#LN32"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>column_info</span> <span class='Operator'>= &</span><a href="hstore_io.c.html#LN925"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN46"><span class='Ref_to_Member'>columns</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1036"></a>        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>column_type</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span><a name="LN1037"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1038"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span><span class='Delimiter'>; 
</span><a name="LN1039"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>vallen</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dropped columns in datatype */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="hstore_io.c.html#LN1038"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="hstore_op.c.html#LN35"><span class='Ref_to_Func'>hstoreFindKey</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN916"><span class='Ref_To_Local'>hs</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                            <a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            strlen<span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * we can't just skip here if the key wasn't found since we might have 
         * a domain to deal with. If we were passed in a non-null record 
         * datum, we assume that the existing values are valid (if they're 
         * not, then it's not our fault), but if we were passed in a null, 
         * then every field which we don't populate needs to be run through 
         * the input function just in case it's a domain type. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1038"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="hstore_io.c.html#LN919"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Prepare to convert the column value from text 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN34"><span class='Ref_to_Member'>column_type</span></a> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN1036"><span class='Ref_To_Local'>column_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/utils/lsyscache.h.html#LN161"><span class='Ref_to_Proto'>getTypeInputInfo</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1036"><span class='Ref_To_Local'>column_type</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN35"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN36"><span class='Ref_to_Member'>typioparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN35"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN38"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                          fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN34"><span class='Ref_to_Member'>column_type</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN1036"><span class='Ref_To_Local'>column_type</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1038"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN917"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1038"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * need InputFunctionCall to happen even for nulls, so that domain 
             * checks are done 
             */ 
</span>            <a href="hstore_io.c.html#LN928"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN38"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                          <a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN36"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, 
</span>                                          <a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN1039"><span class='Ref_To_Local'>vallen</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN917"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1038"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="hstore_io.c.html#LN1039"><span class='Ref_To_Local'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN917"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN918"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1038"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1039"><span class='Ref_To_Local'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Keyword'>value</span><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN1039"><span class='Ref_To_Local'>vallen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <a href="hstore_io.c.html#LN928"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN38"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                          <a href="hstore_io.c.html#LN1035"><span class='Ref_To_Local'>column_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/backend/utils/adt/rowtypes.c.html#LN36"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, 
</span>                                          <a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="hstore_io.c.html#LN927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;ncolumns;++i &raquo; </span> 
 
    <a href="hstore_io.c.html#LN924"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="../../src/backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN928"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN929"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN922"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../src/include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN924"><span class='Ref_To_Local'>rettuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_populate_record &raquo; </span> 
 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1110"></a><span class='Declare_Function'>cpw</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1112"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="hstore_io.c.html#LN1110"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1112"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="hstore_io.c.html#LN1110"><span class='Ref_to_Parameter'>src</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1110"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hstore_io.c.html#LN1112"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'"'</span> <span class='Operator'>|| *</span><a href="hstore_io.c.html#LN1112"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1110"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hstore_io.c.html#LN1110"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>++ = *</span><a href="hstore_io.c.html#LN1112"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="hstore_io.c.html#LN1110"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>; 
} 
</span> 
<a name="LN1123"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1124"><span class='Ref_to_Func'>hstore_out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1125"></a><span class='Declare_Function'>hstore_out</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1127"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1128"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>buflen</span><span class='Delimiter'>, 
</span><a name="LN1129"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1130"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1127"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1131"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>, 
</span><a name="LN1132"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN1133"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base</span> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1127"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1134"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1127"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1130"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="hstore_io.c.html#LN1128"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * this loop overestimates due to pessimistic assumptions about escaping, 
     * so very large hstore values can't be output. this could be fixed, but 
     * many other data types probably have the same issue. This replaced code 
     * that used the original varlena size for calculations, which was wrong 
     * in some subtle ways. 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1130"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* include "" and =&GT; and comma-space */ 
</span>        <a href="hstore_io.c.html#LN1128"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>+= </span><span class='Number'>6</span> <span class='Operator'>+ </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* include "" only if nonnull */ 
</span>        <a href="hstore_io.c.html#LN1128"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>+= </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>                       <span class='Operator'>? </span><span class='Number'>2</span> 
                       <span class='Operator'>: </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="hstore_io.c.html#LN1131"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1128"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1130"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN1109"><span class='Ref_to_Func'>cpw</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN78"><span class='Ref_to_Macro'>HSTORE_KEY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1133"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'='</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'&GT;'</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'N'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'U'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'L'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'L'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="hstore_io.c.html#LN1109"><span class='Ref_to_Func'>cpw</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1133"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1134"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1129"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN1130"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>','</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;i++ &raquo; </span> 
    <span class='Operator'>*</span><a href="hstore_io.c.html#LN1132"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1131"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_out &raquo; </span> 
 
 
<a name="LN1194"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1195"><span class='Ref_to_Func'>hstore_send</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1196"></a><span class='Declare_Function'>hstore_send</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1198"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1199"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1200"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1198"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1201"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base</span> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1198"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1202"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1198"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1203"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1200"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1200"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1211"></a>        <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>keylen</span> <span class='Operator'>= </span><a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1202"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1211"><span class='Ref_To_Local'>keylen</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/libpq/pqformat.h.html#LN22"><span class='Ref_to_Proto'>pq_sendtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN78"><span class='Ref_to_Macro'>HSTORE_KEY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1202"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1201"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1211"><span class='Ref_To_Local'>keylen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1202"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1221"></a>            <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>vallen</span> <span class='Operator'>= </span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1202"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1221"><span class='Ref_To_Local'>vallen</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/libpq/pqformat.h.html#LN22"><span class='Ref_to_Proto'>pq_sendtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1202"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1201"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1221"><span class='Ref_To_Local'>vallen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1203"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_send &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * hstore_to_json_loose 
 * 
 * This is a heuristic conversion to json which treats 
 * 't' and 'f' as booleans and strings that look like numbers as numbers, 
 * as long as they don't start with a leading zero followed by another digit 
 * (think zip codes or phone numbers starting with 0). 
 */ 
</span><a name="LN1240"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1241"><span class='Ref_to_Func'>hstore_to_json_loose</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1242"></a><span class='Declare_Function'>hstore_to_json_loose</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1244"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1245"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1246"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1244"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1247"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base</span> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1244"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1248"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1244"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1249"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>tmp</span><span class='Delimiter'>, 
</span><a name="LN1250"></a>                <span class='Declare_Local'>dst</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1246"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><span class='String'>"{}"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1246"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN78"><span class='Ref_to_Macro'>HSTORE_KEY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1247"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>": "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* guess that values of 't' or 'f' are booleans */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                 <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1247"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='String'>'t'</span><span class='Parentheses'>)</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                 <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1247"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='String'>'f'</span><span class='Parentheses'>)</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1247"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1248"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/utils/jsonapi.h.html#LN132"><span class='Ref_to_Proto'>IsValidJsonNumber</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span> 
                <a href="../../src/include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../src/include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1249"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1245"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN1246"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;i++ &raquo; </span> 
    <a href="../../src/backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1250"><span class='Ref_To_Local'>dst</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_to_json_loose &raquo; </span> 
 
<a name="LN1295"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1296"><span class='Ref_to_Func'>hstore_to_json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1297"></a><span class='Declare_Function'>hstore_to_json</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1299"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1300"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1301"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1299"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1302"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base</span> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1299"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1303"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1299"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1304"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>tmp</span><span class='Delimiter'>, 
</span><a name="LN1305"></a>                <span class='Declare_Local'>dst</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1301"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><span class='String'>"{}"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1301"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN78"><span class='Ref_to_Macro'>HSTORE_KEY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1303"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1302"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1303"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>": "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1303"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1303"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1302"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1303"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1300"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>!= </span><a href="hstore_io.c.html#LN1301"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;i++ &raquo; </span> 
    <a href="../../src/backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1305"><span class='Ref_To_Local'>dst</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_to_json &raquo; </span> 
 
<a name="LN1340"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1341"><span class='Ref_to_Func'>hstore_to_jsonb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1342"></a><span class='Declare_Function'>hstore_to_jsonb</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1344"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1345"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1346"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1344"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1347"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base</span> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1344"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1348"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1344"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1349"></a>    <a href="../../src/include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1350"></a>    <a href="../../src/include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1349"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1346"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1356"></a>        <a href="../../src/include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>key</span><span class='Delimiter'>, 
</span><a name="LN1357"></a>                    <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN1356"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN1356"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN257"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1348"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN1356"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN258"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN78"><span class='Ref_to_Macro'>HSTORE_KEY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1348"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1347"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1349"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1356"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1348"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN1357"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN1357"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN1357"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN257"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1348"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN1357"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN258"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1348"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1347"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1345"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1349"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1357"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;i++ &raquo; </span> 
 
    <a href="hstore_io.c.html#LN1350"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1349"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1350"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_to_jsonb &raquo; </span> 
 
<a name="LN1383"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1384"><span class='Ref_to_Func'>hstore_to_jsonb_loose</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1385"></a><span class='Declare_Function'>hstore_to_jsonb_loose</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1387"></a>    <a href="hstore.h.html#LN43"><span class='Ref_to_Typedef'>HStore</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="hstore.h.html#LN153"><span class='Ref_to_Macro'>PG_GETARG_HS</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1388"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1389"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="hstore.h.html#LN60"><span class='Ref_to_Macro'>HS_COUNT</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1387"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1390"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base</span> <span class='Operator'>= </span><a href="hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1387"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1391"></a>    <a href="hstore.h.html#LN17"><span class='Ref_to_Typedef'>HEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>entries</span> <span class='Operator'>= </span><a href="../intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1387"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1392"></a>    <a href="../../src/include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1393"></a>    <a href="../../src/include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1394"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1394"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1392"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="hstore_io.c.html#LN1389"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1402"></a>        <a href="../../src/include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>key</span><span class='Delimiter'>, 
</span><a name="LN1403"></a>                    <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
        <a href="hstore_io.c.html#LN1402"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN1402"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN257"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN80"><span class='Ref_to_Macro'>HSTORE_KEYLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="hstore_io.c.html#LN1402"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN258"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN78"><span class='Ref_to_Macro'>HSTORE_KEY</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1390"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1392"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1402"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN82"><span class='Ref_to_Macro'>HSTORE_VALISNULL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* guess that values of 't' or 'f' are booleans */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                 <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1390"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='String'>'t'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN254"><span class='Ref_to_Member'>boolean</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                 <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1390"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='String'>'f'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Delimiter'>; 
</span>            <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN254"><span class='Ref_to_Member'>boolean</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1394"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1394"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1390"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/utils/jsonapi.h.html#LN132"><span class='Ref_to_Proto'>IsValidJsonNumber</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1394"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1394"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN253"><span class='Ref_to_Member'>numeric</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span> 
                                              <a href="../../src/include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/numeric.c.html#LN557"><span class='Ref_to_Func'>numeric_in</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1394"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN257"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN81"><span class='Ref_to_Macro'>HSTORE_VALLEN</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN259"><span class='Ref_to_Member'>string</span></a><span class='Operator'>.</span><a href="../../src/include/utils/jsonb.h.html#LN258"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="hstore.h.html#LN79"><span class='Ref_to_Macro'>HSTORE_VAL</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1391"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1390"><span class='Ref_To_Local'>base</span></a><span class='Delimiter'>, </span><a href="hstore_io.c.html#LN1388"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1392"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1403"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;i++ &raquo; </span> 
 
    <a href="hstore_io.c.html#LN1393"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hstore_io.c.html#LN1392"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="hstore_io.c.html#LN1393"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hstore_to_jsonb_loose &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>