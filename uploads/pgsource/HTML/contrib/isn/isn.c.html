<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\isn\isn.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\isn\isn.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:25 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * isn.c 
 *    PostgreSQL type definitions for ISNs (ISBN, ISMN, ISSN, EAN13, UPC) 
 * 
 * Author:  German Mendez Bravo (Kronuz) 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    contrib/isn/isn.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"fmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"isn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"EAN13.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"ISBN.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"ISMN.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"ISSN.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"UPC.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<a name="LN28"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAXEAN13LEN</span> <span class='Number'>18</span> 
 
<a name="LN30"></a><span class='Control'>enum</span> <span class='Declare_Enum'>isn_type</span> 
<span class='Delimiter'>{ 
</span><a name="LN32"></a>    <span class='Declare_Enum_Const'>INVALID</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>ANY</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>EAN13</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>ISBN</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>ISMN</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>ISSN</span><span class='Delimiter'>, </span><span class='Declare_Enum_Const'>UPC</span> 
<span class='Delimiter'>}; 
</span> 
<a name="LN35"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>isn_names</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='String'>"EAN13/UPC/ISxN"</span><span class='Delimiter'>, </span><span class='String'>"EAN13/UPC/ISxN"</span><span class='Delimiter'>, </span><span class='String'>"EAN13"</span><span class='Delimiter'>, </span><span class='String'>"ISBN"</span><span class='Delimiter'>, </span><span class='String'>"ISMN"</span><span class='Delimiter'>, </span><span class='String'>"ISSN"</span><span class='Delimiter'>, </span><span class='String'>"UPC"</span><span class='Delimiter'>}; 
</span> 
<a name="LN37"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>g_weak</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>g_initialized</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/*********************************************************************** 
 ** 
 **     Routines for EAN13/UPC/ISxNs. 
 ** 
 ** Note: 
 **  In this code, a normalized string is one that is known to be a valid 
 **  ISxN number containing only digits and hyphens and with enough space 
 **  to hold the full 13 digits plus the maximum of four hyphens. 
 ***********************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/*---------------------------------------------------------- 
 * Debugging routines. 
 *---------------------------------------------------------*/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Check if the table and its index is correct (just for debugging) 
 */ 
</span><span class='Directive'>#ifdef</span> ISN_DEBUG 
<span class='Keyword'>static bool 
</span><a name="LN60"></a><span class='Declare_Function'>check_table</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Declare_Parameter'>TABLE</span><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='Keyword'>const unsigned </span><span class='Declare_Parameter'>TABLE_index</span><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>][</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
<span class='Delimiter'>{ 
</span><a name="LN62"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>aux1</span><span class='Delimiter'>, 
</span><a name="LN63"></a>               <span class='Operator'>*</span><span class='Declare_Local'>aux2</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>a</span><span class='Delimiter'>, 
</span><a name="LN65"></a>                <span class='Declare_Local'>b</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                <span class='Declare_Local'>x</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                <span class='Declare_Local'>y</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN68"></a>                <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN69"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN70"></a>                <span class='Declare_Local'>cnt</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN71"></a>                <span class='Declare_Local'>init</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE_index</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& </span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* must always start with a digit: */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| !</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN124"><span class='Ref_to_Label'>invalidtable</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN64"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= *</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN65"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>= *</span><a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* must always have the same format and length: */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>&& *</span><a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>                  isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>!= *</span><a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>|| *</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>!= </span><span class='String'>'-'</span><span class='Parentheses'>))</span> 
                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN124"><span class='Ref_to_Label'>invalidtable</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN62"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>!= *</span><a href="isn.c.html#LN63"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN124"><span class='Ref_to_Label'>invalidtable</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* found a new range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN64"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>&GT; </span><a href="isn.c.html#LN67"><span class='Ref_To_Local'>y</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* check current range in the index: */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN69"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN66"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>; </span><a href="isn.c.html#LN69"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT;= </span><a href="isn.c.html#LN67"><span class='Ref_To_Local'>y</span></a><span class='Delimiter'>; </span><a href="isn.c.html#LN69"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE_index</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN69"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="isn.c.html#LN71"><span class='Ref_To_Local'>init</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN129"><span class='Ref_to_Label'>invalidindex</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE_index</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN69"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="isn.c.html#LN71"><span class='Ref_To_Local'>init</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN129"><span class='Ref_to_Label'>invalidindex</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="isn.c.html#LN71"><span class='Ref_To_Local'>init</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN66"><span class='Ref_To_Local'>x</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN64"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Always get the new limit */ 
</span>        <a href="isn.c.html#LN67"><span class='Ref_To_Local'>y</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN65"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN67"><span class='Ref_To_Local'>y</span></a> <span class='Operator'>&LT; </span><a href="isn.c.html#LN66"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN124"><span class='Ref_to_Label'>invalidtable</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while TABLE[i][0]&&TABLE[i]... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN124"></a><span class='Label'>invalidtable</span><span class='Operator'>: 
</span>    <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"invalid table near {\"%s\", \"%s\"} (pos: %d)"</span><span class='Delimiter'>, 
</span>         <a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="isn.c.html#LN60"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="isn.c.html#LN68"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN129"></a><span class='Label'>invalidindex</span><span class='Operator'>: 
</span>    <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"index %d is invalid"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN69"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_table &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* ISN_DEBUG */ 
</span> 
<span class='Comment_Multi_Line'>/*---------------------------------------------------------- 
 * Formatting and conversion routines. 
 *---------------------------------------------------------*/ 
</span> 
<span class='Keyword'>static unsigned 
</span><a name="LN140"></a><span class='Declare_Function'>dehyphenate</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>bufO</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>bufI</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN142"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN140"><span class='Ref_to_Parameter'>bufI</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN140"><span class='Ref_to_Parameter'>bufI</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN140"><span class='Ref_to_Parameter'>bufO</span></a><span class='Operator'>++ = *</span><a href="isn.c.html#LN140"><span class='Ref_to_Parameter'>bufI</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN142"><span class='Ref_To_Local'>ret</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="isn.c.html#LN140"><span class='Ref_to_Parameter'>bufI</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="isn.c.html#LN140"><span class='Ref_to_Parameter'>bufO</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="isn.c.html#LN142"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * hyphenate --- Try to hyphenate, in-place, the string starting at bufI 
 *                into bufO using the given hyphenation range TABLE. 
 *                Assumes the input string to be used is of only digits. 
 * 
 * Returns the number of characters actually hyphenated. 
 */ 
</span><span class='Keyword'>static unsigned 
</span><a name="LN165"></a><span class='Declare_Function'>hyphenate</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>bufO</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>bufI</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Declare_Parameter'>TABLE</span><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='Keyword'>const unsigned </span><span class='Declare_Parameter'>TABLE_index</span><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>][</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
<span class='Delimiter'>{ 
</span><a name="LN167"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN168"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>ean_aux1</span><span class='Delimiter'>, 
</span><a name="LN169"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ean_aux2</span><span class='Delimiter'>, 
</span><a name="LN170"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ean_p</span><span class='Delimiter'>; 
</span><a name="LN171"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>firstdig</span><span class='Delimiter'>, 
</span><a name="LN172"></a>               <span class='Operator'>*</span><span class='Declare_Local'>aux1</span><span class='Delimiter'>, 
</span><a name="LN173"></a>               <span class='Operator'>*</span><span class='Declare_Local'>aux2</span><span class='Delimiter'>; 
</span><a name="LN174"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>search</span><span class='Delimiter'>, 
</span><a name="LN175"></a>                <span class='Declare_Local'>upper</span><span class='Delimiter'>, 
</span><a name="LN176"></a>                <span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN177"></a>                <span class='Declare_Local'>step</span><span class='Delimiter'>; 
</span><a name="LN178"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ean_in1</span><span class='Delimiter'>, 
</span><a name="LN179"></a>                <span class='Declare_Local'>ean_in2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* just compress the string if no further hyphenation is required */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE_index</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufI</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufO</span></a><span class='Operator'>++ = *</span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufI</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN167"><span class='Ref_To_Local'>ret</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufO</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN167"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* add remaining hyphenations */ 
</span> 
    <a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= *</span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufI</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN175"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE_index</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="isn.c.html#LN175"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>+= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE_index</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN175"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>- </span><a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a><span class='Delimiter'>; 
</span> 
    <a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufI</span></a><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN178"><span class='Ref_To_Local'>ean_in1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN179"><span class='Ref_To_Local'>ean_in2</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="isn.c.html#LN178"><span class='Ref_To_Local'>ean_in1</span></a> <span class='Operator'>|| *</span><a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>&GT;= *</span><a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="isn.c.html#LN179"><span class='Ref_To_Local'>ean_in2</span></a> <span class='Operator'>|| *</span><a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>&LT;= *</span><a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>&GT; *</span><a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN178"><span class='Ref_To_Local'>ean_in1</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>&LT; *</span><a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN179"><span class='Ref_To_Local'>ean_in2</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN178"><span class='Ref_To_Local'>ean_in1</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN179"><span class='Ref_To_Local'>ean_in2</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a> <span class='Operator'>&& *</span><a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a> <span class='Operator'>&& *</span><a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a><span class='Parentheses'>))</span> 
                <a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * check in what direction we should go and move the pointer 
             * accordingly 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>&LT; *</span><a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a> <span class='Operator'>&& !</span><a href="isn.c.html#LN178"><span class='Ref_To_Local'>ean_in1</span></a><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN175"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>; 
</span> 
            <a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN175"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>- </span><a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN176"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Initialize stuff again: */ 
</span>            <a href="isn.c.html#LN171"><span class='Ref_To_Local'>firstdig</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufI</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN178"><span class='Ref_To_Local'>ean_in1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN179"><span class='Ref_To_Local'>ean_in2</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN168"><span class='Ref_To_Local'>ean_aux1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="isn.c.html#LN169"><span class='Ref_To_Local'>ean_aux2</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN177"><span class='Ref_To_Local'>step</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN172"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufO</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN173"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>bufI</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN170"><span class='Ref_To_Local'>ean_p</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN165"><span class='Ref_to_Parameter'>TABLE</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN174"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN170"><span class='Ref_To_Local'>ean_p</span></a> <span class='Operator'>&& *</span><a href="isn.c.html#LN173"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN170"><span class='Ref_To_Local'>ean_p</span></a><span class='Operator'>++ != </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="isn.c.html#LN172"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = *</span><a href="isn.c.html#LN173"><span class='Ref_To_Local'>aux2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>*</span><a href="isn.c.html#LN172"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN167"><span class='Ref_To_Local'>ret</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="isn.c.html#LN172"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="isn.c.html#LN172"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>= *</span><a href="isn.c.html#LN173"><span class='Ref_To_Local'>aux2</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* add a lookahead char */ 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN167"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="isn.c.html#LN167"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hyphenate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * weight_checkdig -- Receives a buffer with a normalized ISxN string number, 
 *                     and the length to weight. 
 * 
 * Returns the weight of the number (the check digit value, 0-10) 
 */ 
</span><span class='Keyword'>static unsigned 
</span><a name="LN275"></a><span class='Declare_Function'>weight_checkdig</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>isn</span><span class='Delimiter'>, </span><span class='Keyword'>unsigned </span><span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN277"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>weight</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN275"><span class='Ref_to_Parameter'>isn</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN275"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN275"><span class='Ref_to_Parameter'>isn</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+= </span><a href="isn.c.html#LN275"><span class='Ref_to_Parameter'>size</span></a><span class='Operator'>-- * </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN275"><span class='Ref_to_Parameter'>isn</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="isn.c.html#LN275"><span class='Ref_to_Parameter'>isn</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>% </span><span class='Number'>11</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>11</span> <span class='Operator'>- </span><a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="isn.c.html#LN277"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * checkdig --- Receives a buffer with a normalized ISxN string number, 
 *               and the length to check. 
 * 
 * Returns the check digit value (0-9) 
 */ 
</span><span class='Keyword'>static unsigned 
</span><a name="LN301"></a><span class='Declare_Function'>checkdig</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><span class='Keyword'>unsigned </span><span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN303"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>check</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN304"></a>                <span class='Declare_Local'>check3</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN305"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>pos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>num</span></a> <span class='Operator'>== </span><span class='String'>'M'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISMN start with 'M' */ 
</span>        <a href="isn.c.html#LN304"><span class='Ref_To_Local'>check3</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN305"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>num</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN305"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>++ % </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN304"><span class='Ref_To_Local'>check3</span></a> <span class='Operator'>+= *</span><a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>num</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>+= *</span><a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>num</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>size</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="isn.c.html#LN301"><span class='Ref_to_Parameter'>num</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>+ </span><span class='Number'>3</span> <span class='Operator'>* </span><a href="isn.c.html#LN304"><span class='Ref_To_Local'>check3</span></a><span class='Parentheses'>) </span><span class='Operator'>% </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><span class='Number'>10</span> <span class='Operator'>- </span><a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="isn.c.html#LN303"><span class='Ref_To_Local'>check</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end checkdig &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ean2isn --- Try to convert an ean13 number to a UPC/ISxN number. 
 *             This doesn't verify for a valid check digit. 
 * 
 * If errorOK is false, ereport a useful error message if the ean13 is bad. 
 * If errorOK is true, just return "false" for bad input. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN338"></a><span class='Declare_Function'>ean2isn</span><span class='Parentheses'>(</span><a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a> <span class='Declare_Parameter'>ean</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>errorOK</span><span class='Delimiter'>, </span><a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Control'>enum</span> <a href="isn.c.html#LN30"><span class='Ref_to_Enum'>isn_type</span></a> <span class='Declare_Parameter'>accept</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN340"></a>    <span class='Control'>enum</span> <a href="isn.c.html#LN30"><span class='Ref_to_Enum'>isn_type</span></a> <span class='Declare_Local'>type</span> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Delimiter'>; 
</span> 
<a name="LN342"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="isn.c.html#LN28"><span class='Ref_to_Const'>MAXEAN13LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN343"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>aux</span><span class='Delimiter'>; 
</span><a name="LN344"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>digval</span><span class='Delimiter'>; 
</span><a name="LN345"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>search</span><span class='Delimiter'>; 
</span><a name="LN346"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a><span class='Delimiter'>; 
</span> 
    <a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* verify it's in the EAN13 range */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>&GT; </span><a href="../../src/include/c.h.html#LN307"><span class='Ref_to_Macro'>UINT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>9999999999999</span><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN417"><span class='Ref_to_Label'>eantoobig</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* convert the number */ 
</span>    <a href="isn.c.html#LN345"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN343"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>13</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="isn.c.html#LN343"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* terminate string; aux points to last digit */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN344"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned</span><span class='Parentheses'>) (</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>% </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* get the decimal value */ 
</span>        <a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>/= </span><span class='Number'>10</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* get next digit */ 
</span>        <span class='Operator'>*--</span><a href="isn.c.html#LN343"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) (</span><a href="isn.c.html#LN344"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* convert to ascii and store */ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN345"><span class='Ref_To_Local'>search</span></a><span class='Operator'>++ &LT; </span><span class='Number'>12</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN345"><span class='Ref_To_Local'>search</span></a><span class='Operator'>++ &LT; </span><span class='Number'>12</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*--</span><a href="isn.c.html#LN343"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='String'>'0'</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* fill the remaining EAN13 with '0' */ 
</span> 
    <span class='Comment_Multi_Line'>/* find out the data type: */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"978"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISBN */ 
</span>        <a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"977"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISSN */ 
</span>        <a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"9790"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISMN */ 
</span>        <a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"979"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISBN-13 */ 
</span>        <a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>== </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* UPC */ 
</span>        <a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ANY</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN397"><span class='Ref_to_Label'>eanwrongtype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN346"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN397"></a><span class='Label'>eanwrongtype</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot cast EAN13(%s) to %s for number: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot cast %s to %s for number: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN342"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN417"></a><span class='Label'>eantoobig</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN420"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>eanbuf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Format the number separately to keep the machine-dependent format 
         * code out of the translatable message text 
         */ 
</span>        <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN420"><span class='Ref_To_Local'>eanbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="isn.c.html#LN420"><span class='Ref_To_Local'>eanbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="isn.h.html#LN27"><span class='Ref_to_Const'>EAN13_FORMAT</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN338"><span class='Ref_to_Parameter'>ean</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value \"%s\" is out of range for %s type"</span><span class='Delimiter'>, 
</span>                        <a href="isn.c.html#LN420"><span class='Ref_To_Local'>eanbuf</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN340"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ean2isn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ean2UPC/ISxN --- Convert in-place a normalized EAN13 string to the corresponding 
 *                  UPC/ISxN string number. Assumes the input string is normalized. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN440"></a><span class='Declare_Function'>ean2ISBN</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>isn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN442"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>aux</span><span class='Delimiter'>; 
</span><a name="LN443"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>check</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The number should come in this format: 978-0-000-00000-0 or may be an 
     * ISBN-13 number, 979-..., which does not have a short representation. Do 
     * the short output version if possible. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"978-"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN440"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Strip the first part and calculate the new check digit */ 
</span>        <a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN440"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN440"><span class='Ref_to_Parameter'>isn</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN443"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN274"><span class='Ref_to_Func'>weight_checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN440"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN442"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="isn.c.html#LN440"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*--</span><a href="isn.c.html#LN442"><span class='Ref_To_Local'>aux</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN443"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>== </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN442"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='String'>'X'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Operator'>*</span><a href="isn.c.html#LN442"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN443"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ean2ISBN &raquo; </span> 
 
<span class='Keyword'>static inline void 
</span><a name="LN465"></a><span class='Declare_Function'>ean2ISMN</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>isn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* the number should come in this format: 979-0-000-00000-0 */ 
</span>    <span class='Comment_Multi_Line'>/* Just strip the first part and change the first digit ('0') to 'M' */ 
</span>    <a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN465"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN465"><span class='Ref_to_Parameter'>isn</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN465"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'M'</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static inline void 
</span><a name="LN474"></a><span class='Declare_Function'>ean2ISSN</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>isn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN476"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>check</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the number should come in this format: 977-0000-000-00-0 */ 
</span>    <span class='Comment_Multi_Line'>/* Strip the first part, crop, and calculate the new check digit */ 
</span>    <a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN474"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN474"><span class='Ref_to_Parameter'>isn</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN476"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN274"><span class='Ref_to_Func'>weight_checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN474"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN476"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>== </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>        <a href="isn.c.html#LN474"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>[</span><span class='Number'>8</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'X'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="isn.c.html#LN474"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>[</span><span class='Number'>8</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="isn.c.html#LN476"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN474"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>[</span><span class='Number'>9</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static inline void 
</span><a name="LN490"></a><span class='Declare_Function'>ean2UPC</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>isn</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* the number should come in this format: 000-000000000-0 */ 
</span>    <span class='Comment_Multi_Line'>/* Strip the first part, crop, and dehyphenate */ 
</span>    <a href="isn.c.html#LN139"><span class='Ref_to_Func'>dehyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN490"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN490"><span class='Ref_to_Parameter'>isn</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN490"><span class='Ref_to_Parameter'>isn</span></a><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ean2* --- Converts a string of digits into an ean13 number. 
 *            Assumes the input string is a string with only digits 
 *            on it, and that it's within the range of ean13. 
 * 
 * Returns the ean13 value of the string. 
 */ 
</span><span class='Keyword'>static </span><a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a> 
<a name="LN506"></a><span class='Declare_Function'>str2ean</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN508"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>ean</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* current ean */ 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN506"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN506"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span> 
            <a href="isn.c.html#LN508"><span class='Ref_To_Local'>ean</span></a> <span class='Operator'>= </span><span class='Number'>10</span> <span class='Operator'>* </span><a href="isn.c.html#LN508"><span class='Ref_To_Local'>ean</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN506"><span class='Ref_to_Parameter'>num</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN506"><span class='Ref_to_Parameter'>num</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN508"><span class='Ref_To_Local'>ean</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* also give room to a flag */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ean2string --- Try to convert an ean13 number to a hyphenated string. 
 *                Assumes there's enough space in result to hold 
 *                the string (maximum MAXEAN13LEN+1 bytes) 
 *                This doesn't verify for a valid check digit. 
 * 
 * If shortType is true, the returned string is in the old ISxN short format. 
 * If errorOK is false, ereport a useful error message if the string is bad. 
 * If errorOK is true, just return "false" for bad input. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN530"></a><span class='Declare_Function'>ean2string</span><span class='Parentheses'>(</span><a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a> <span class='Declare_Parameter'>ean</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>errorOK</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>shortType</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN532"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Declare_Local'>TABLE</span><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN533"></a>    <span class='Keyword'>const unsigned </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Declare_Local'>TABLE_index</span><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN534"></a>    <span class='Control'>enum</span> <a href="isn.c.html#LN30"><span class='Ref_to_Enum'>isn_type</span></a> <span class='Declare_Local'>type</span> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Delimiter'>; 
</span> 
<a name="LN536"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>aux</span><span class='Delimiter'>; 
</span><a name="LN537"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>digval</span><span class='Delimiter'>; 
</span><a name="LN538"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>search</span><span class='Delimiter'>; 
</span><a name="LN539"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>valid</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>   <span class='Comment_Multi_Line'>/* was the number initially written with a 
                                 * valid check digit? */ 
</span> 
    <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><a href="ISBN.h.html#LN36"><span class='Ref_to_Global_Var'>ISBN_index</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="isn.c.html#LN539"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='String'>'!'</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* verify it's in the EAN13 range */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>&GT; </span><a href="../../src/include/c.h.html#LN307"><span class='Ref_to_Macro'>UINT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>9999999999999</span><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN654"><span class='Ref_to_Label'>eantoobig</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* convert the number */ 
</span>    <a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN536"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN28"><span class='Ref_to_Const'>MAXEAN13LEN</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="isn.c.html#LN536"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* terminate string; aux points to last digit */ 
</span>    <span class='Operator'>*--</span><a href="isn.c.html#LN536"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN539"><span class='Ref_To_Local'>valid</span></a><span class='Delimiter'>;</span>             <span class='Comment_Multi_Line'>/* append '!' for numbers with invalid but 
                                 * corrected check digit */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned</span><span class='Parentheses'>) (</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>% </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* get the decimal value */ 
</span>        <a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>/= </span><span class='Number'>10</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* get next digit */ 
</span>        <span class='Operator'>*--</span><a href="isn.c.html#LN536"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) (</span><a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* convert to ascii and store */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*--</span><a href="isn.c.html#LN536"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='String'>'-'</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* the check digit is always there */ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a><span class='Operator'>++ &LT; </span><span class='Number'>13</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a><span class='Operator'>++ &LT; </span><span class='Number'>13</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*--</span><a href="isn.c.html#LN536"><span class='Ref_To_Local'>aux</span></a> <span class='Operator'>= </span><span class='String'>'0'</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* fill the remaining EAN13 with '0' */ 
</span> 
    <span class='Comment_Multi_Line'>/* The string should be in this form: ???DDDDDDDDDDDD-D" */ 
</span>    <a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="EAN13.h.html#LN25"><span class='Ref_to_Global_Var'>EAN13_range</span></a><span class='Delimiter'>, </span><a href="EAN13.h.html#LN13"><span class='Ref_to_Global_Var'>EAN13_index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* verify it's a logically valid EAN13 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN632"><span class='Ref_to_Label'>okay</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* find out what type of hyphenation is needed: */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"978-"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISBN -13 978-range */ 
</span>        <span class='Comment_Multi_Line'>/* The string should be in this form: 978-??000000000-0" */ 
</span>        <a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a> <span class='Operator'>= </span><a href="ISBN.h.html#LN49"><span class='Ref_to_Global_Var'>ISBN_range</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><a href="ISBN.h.html#LN36"><span class='Ref_to_Global_Var'>ISBN_index</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"977-"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISSN */ 
</span>        <span class='Comment_Multi_Line'>/* The string should be in this form: 977-??000000000-0" */ 
</span>        <a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a> <span class='Operator'>= </span><a href="ISSN.h.html#LN45"><span class='Ref_to_Global_Var'>ISSN_range</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><a href="ISSN.h.html#LN33"><span class='Ref_to_Global_Var'>ISSN_index</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"979-0"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISMN */ 
</span>        <span class='Comment_Multi_Line'>/* The string should be in this form: 979-0?000000000-0" */ 
</span>        <a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a> <span class='Operator'>= </span><a href="ISMN.h.html#LN44"><span class='Ref_to_Global_Var'>ISMN_range</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><a href="ISMN.h.html#LN32"><span class='Ref_to_Global_Var'>ISMN_index</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"979-"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* ISBN-13 979-range */ 
</span>        <span class='Comment_Multi_Line'>/* The string should be in this form: 979-??000000000-0" */ 
</span>        <a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a> <span class='Operator'>= </span><a href="ISBN.h.html#LN982"><span class='Ref_to_Global_Var'>ISBN_range_new</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><a href="ISBN.h.html#LN969"><span class='Ref_to_Global_Var'>ISBN_index_new</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>== </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* UPC */ 
</span>        <span class='Comment_Multi_Line'>/* The string should be in this form: 000-00000000000-0" */ 
</span>        <a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a> <span class='Operator'>= </span><a href="UPC.h.html#LN25"><span class='Ref_to_Global_Var'>UPC_range</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><a href="UPC.h.html#LN13"><span class='Ref_to_Global_Var'>UPC_index</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* verify it's a logically valid EAN13/UPC/ISxN */ 
</span>    <a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="isn.c.html#LN532"><span class='Ref_To_Local'>TABLE</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN533"><span class='Ref_To_Local'>TABLE_index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* verify it's a valid EAN13 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN538"><span class='Ref_To_Local'>search</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN164"><span class='Ref_to_Func'>hyphenate</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>+ </span><a href="isn.c.html#LN537"><span class='Ref_To_Local'>digval</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN632"><span class='Ref_to_Label'>okay</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<a name="LN632"></a><span class='Label'>okay</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* convert to the old short type: */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>shortType</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Operator'>: 
</span>                <a href="isn.c.html#LN439"><span class='Ref_to_Func'>ean2ISBN</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Operator'>: 
</span>                <a href="isn.c.html#LN464"><span class='Ref_to_Func'>ean2ISMN</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Operator'>: 
</span>                <a href="isn.c.html#LN473"><span class='Ref_to_Func'>ean2ISSN</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Operator'>: 
</span>                <a href="isn.c.html#LN489"><span class='Ref_to_Func'>ean2UPC</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN654"></a><span class='Label'>eantoobig</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN657"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>eanbuf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Format the number separately to keep the machine-dependent format 
         * code out of the translatable message text 
         */ 
</span>        <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN657"><span class='Ref_To_Local'>eanbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="isn.c.html#LN657"><span class='Ref_To_Local'>eanbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="isn.h.html#LN27"><span class='Ref_to_Const'>EAN13_FORMAT</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN530"><span class='Ref_to_Parameter'>ean</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value \"%s\" is out of range for %s type"</span><span class='Delimiter'>, 
</span>                        <a href="isn.c.html#LN657"><span class='Ref_To_Local'>eanbuf</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN534"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ean2string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * string2ean --- try to parse a string into an ean13. 
 * 
 * If errorOK is false, ereport a useful error message if the string is bad. 
 * If errorOK is true, just return "false" for bad input. 
 * 
 * if the input string ends with '!' it will always be treated as invalid 
 * (even if the check digit is valid) 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN682"></a><span class='Declare_Function'>string2ean</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>errorOK</span><span class='Delimiter'>, </span><a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN683"></a>           <span class='Control'>enum</span> <a href="isn.c.html#LN30"><span class='Ref_to_Enum'>isn_type</span></a> <span class='Declare_Parameter'>accept</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN685"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>digit</span><span class='Delimiter'>, 
</span><a name="LN686"></a>                <span class='Declare_Local'>last</span><span class='Delimiter'>; 
</span><a name="LN687"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>17</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"                "</span><span class='Delimiter'>; 
</span><a name="LN688"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>aux1</span> <span class='Operator'>= </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* leave space for the first part, in case 
                                 * it's needed */ 
</span><a name="LN690"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>aux2</span> <span class='Operator'>= </span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span><a name="LN691"></a>    <span class='Control'>enum</span> <a href="isn.c.html#LN30"><span class='Ref_to_Enum'>isn_type</span></a> <span class='Declare_Local'>type</span> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Delimiter'>; 
</span><a name="LN692"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>check</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN693"></a>                <span class='Declare_Local'>rcheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned</span><span class='Parentheses'>) </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN694"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>length</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN695"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>magic</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN696"></a>                <span class='Declare_Local'>valid</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* recognize and validate the number: */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>&LT;= </span><span class='Number'>13</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="isn.c.html#LN686"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'!'</span> <span class='Operator'>|| *</span><span class='Parentheses'>(</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* is the last character */ 
</span>        <a href="isn.c.html#LN685"><span class='Ref_To_Local'>digit</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Multi_Line'>/* is current character 
                                                         * a digit? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'?'</span> <span class='Operator'>&& </span><a href="isn.c.html#LN686"><span class='Ref_To_Local'>last</span></a><span class='Parentheses'>)</span>       <span class='Comment_Multi_Line'>/* automagically calculate check digit 
                                         * if it's '?' */ 
</span>            <a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN685"><span class='Ref_To_Local'>digit</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'M'</span> <span class='Operator'>|| *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'m'</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* only ISMN can be here */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = </span><span class='String'>'M'</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>7</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="isn.c.html#LN685"><span class='Ref_To_Local'>digit</span></a> <span class='Operator'>|| *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'X'</span> <span class='Operator'>|| *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'x'</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="isn.c.html#LN686"><span class='Ref_To_Local'>last</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* only ISSN can be here */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>9</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="isn.c.html#LN685"><span class='Ref_To_Local'>digit</span></a> <span class='Operator'>|| *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'X'</span> <span class='Operator'>|| *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'x'</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="isn.c.html#LN686"><span class='Ref_To_Local'>last</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* only ISBN and ISMN can be here */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* ISMN must start with 'M' */ 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = </span>toupper<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>11</span> <span class='Operator'>&& </span><a href="isn.c.html#LN685"><span class='Ref_To_Local'>digit</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN686"><span class='Ref_To_Local'>last</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* only UPC can be here */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>' '</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* skip, we could validate but I think it's worthless */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>== </span><span class='String'>'!'</span> <span class='Operator'>&& *</span><span class='Parentheses'>(</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* the invalid check digit suffix was found, set it */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN685"><span class='Ref_To_Local'>digit</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++ = *</span><a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>&GT; </span><span class='Number'>13</span><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN911"><span class='Ref_to_Label'>eantoobig</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="isn.c.html#LN690"><span class='Ref_To_Local'>aux2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *aux2&&length&LT;=13 &raquo; </span> 
    <span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* terminate the string */ 
</span> 
    <span class='Comment_Multi_Line'>/* find the current check digit value */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>13</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* only EAN13 can be here */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>15</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>12</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* only UPC can be here */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>14</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'X'</span><span class='Parentheses'>) 
</span>            <a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN694"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>== </span><span class='Number'>8</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span>        <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'X'</span><span class='Parentheses'>) 
</span>            <a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>10</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN895"><span class='Ref_to_Label'>eaninvalid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* obtain the real check digit value, validate, and convert to ean13: */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>== </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN903"><span class='Ref_to_Label'>eanwrongtype</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ANY</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN903"><span class='Ref_to_Label'>eanwrongtype</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Operator'>: 
</span>            <a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>&& </span><span class='Parentheses'>((</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN300"><span class='Ref_to_Func'>checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>|| </span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* now get the subtype of EAN13: */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>                <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"977"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"978"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"9790"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><span class='String'>"979"</span><span class='Delimiter'>, </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ANY</span></a> <span class='Operator'>&& </span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN903"><span class='Ref_to_Label'>eanwrongtype</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Operator'>: 
</span>            memcpy<span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"9790"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* this isn't for sure yet, for now 
                                         * ISMN it's only 9790 */ 
</span>            <a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>&& </span><span class='Parentheses'>((</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN300"><span class='Ref_to_Func'>checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>|| </span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Operator'>: 
</span>            memcpy<span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"978"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>&& </span><span class='Parentheses'>((</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN274"><span class='Ref_to_Func'>weight_checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>|| </span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Operator'>: 
</span>            memcpy<span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>10</span><span class='Delimiter'>, </span><span class='String'>"00"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Multi_Line'>/* append 00 as the normal issue 
                                         * publication code */ 
</span>            memcpy<span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"977"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>&& </span><span class='Parentheses'>((</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN274"><span class='Ref_to_Func'>weight_checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>|| </span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Operator'>: 
</span>            <a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>&& </span><span class='Parentheses'>((</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN300"><span class='Ref_to_Func'>checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><a href="isn.c.html#LN692"><span class='Ref_To_Local'>check</span></a> <span class='Operator'>|| </span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch type &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* fix the check digit: */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN687"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>&& *</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a> <span class='Operator'>&LT;= </span><span class='String'>' '</span><span class='Delimiter'>; </span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="isn.c.html#LN300"><span class='Ref_to_Func'>checkdig</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Delimiter'>, </span><span class='Number'>13</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Delimiter'>[</span><span class='Number'>13</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>&& !</span><a href="isn.c.html#LN695"><span class='Ref_To_Local'>magic</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="isn.c.html#LN867"><span class='Ref_to_Label'>eanbadcheck</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN505"><span class='Ref_to_Func'>str2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>|= </span><a href="isn.c.html#LN696"><span class='Ref_To_Local'>valid</span></a> <span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN867"></a><span class='Label'>eanbadcheck</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN37"><span class='Ref_to_Global_Var'>g_weak</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* weak input mode is activated: */ 
</span>        <span class='Comment_Multi_Line'>/* set the "invalid-check-digit-on-input" flag */ 
</span>        <span class='Operator'>*</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="isn.c.html#LN505"><span class='Ref_to_Func'>str2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN688"><span class='Ref_To_Local'>aux1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>|= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned</span><span class='Parentheses'>) </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid %s number: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid check digit for %s number: \"%s\", should be %c"</span><span class='Delimiter'>, 
</span>                   <a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>== </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><span class='String'>'X'</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="isn.c.html#LN693"><span class='Ref_To_Local'>rcheck</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN895"></a><span class='Label'>eaninvalid</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for %s number: \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN903"></a><span class='Label'>eanwrongtype</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot cast %s to %s for number: \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN691"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>], </span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN911"></a><span class='Label'>eantoobig</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>errorOK</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value \"%s\" is out of range for %s type"</span><span class='Delimiter'>, 
</span>                        <a href="isn.c.html#LN682"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN35"><span class='Ref_to_Global_Var'>isn_names</span></a><span class='Delimiter'>[</span><a href="isn.c.html#LN683"><span class='Ref_to_Parameter'>accept</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end string2ean &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*---------------------------------------------------------- 
 * Exported routines. 
 *---------------------------------------------------------*/ 
</span> 
<span class='Keyword'>void 
</span><a name="LN925"></a><span class='Declare_Function'>initialize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> ISN_DEBUG 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN59"><span class='Ref_to_Func'>check_table</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Delimiter'>, </span><a href="EAN13.h.html#LN13"><span class='Ref_to_Global_Var'>EAN13_index</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"EAN13 failed check"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN59"><span class='Ref_to_Func'>check_table</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Delimiter'>, </span><a href="ISBN.h.html#LN36"><span class='Ref_to_Global_Var'>ISBN_index</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"ISBN failed check"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN59"><span class='Ref_to_Func'>check_table</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Delimiter'>, </span><a href="ISMN.h.html#LN32"><span class='Ref_to_Global_Var'>ISMN_index</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"ISMN failed check"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN59"><span class='Ref_to_Func'>check_table</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Delimiter'>, </span><a href="ISSN.h.html#LN33"><span class='Ref_to_Global_Var'>ISSN_index</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"ISSN failed check"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="isn.c.html#LN59"><span class='Ref_to_Func'>check_table</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Delimiter'>, </span><a href="UPC.h.html#LN13"><span class='Ref_to_Global_Var'>UPC_index</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"UPC failed check"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="isn.c.html#LN38"><span class='Ref_to_Global_Var'>g_initialized</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* isn_out 
 */ 
</span><a name="LN944"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN945"><span class='Ref_to_Func'>isn_out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN946"></a><span class='Declare_Function'>isn_out</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN948"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN949"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN950"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="isn.c.html#LN28"><span class='Ref_to_Const'>MAXEAN13LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN529"><span class='Ref_to_Func'>ean2string</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN948"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="isn.c.html#LN950"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.c.html#LN949"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN950"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN949"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ean13_out 
 */ 
</span><a name="LN960"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN961"><span class='Ref_to_Func'>ean13_out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN962"></a><span class='Declare_Function'>ean13_out</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN964"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN965"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN966"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="isn.c.html#LN28"><span class='Ref_to_Const'>MAXEAN13LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN529"><span class='Ref_to_Func'>ean2string</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN964"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="isn.c.html#LN966"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.c.html#LN965"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN966"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN965"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ean13_in 
 */ 
</span><a name="LN976"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN977"><span class='Ref_to_Func'>ean13_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN978"></a><span class='Declare_Function'>ean13_in</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN980"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN981"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN681"><span class='Ref_to_Func'>string2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN980"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN981"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>EAN13</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN981"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* isbn_in 
 */ 
</span><a name="LN989"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN990"><span class='Ref_to_Func'>isbn_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN991"></a><span class='Declare_Function'>isbn_in</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN993"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN994"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN681"><span class='Ref_to_Func'>string2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN993"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN994"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN994"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ismn_in 
 */ 
</span><a name="LN1002"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1003"><span class='Ref_to_Func'>ismn_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1004"></a><span class='Declare_Function'>ismn_in</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1006"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1007"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN681"><span class='Ref_to_Func'>string2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1006"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1007"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1007"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* issn_in 
 */ 
</span><a name="LN1015"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1016"><span class='Ref_to_Func'>issn_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1017"></a><span class='Declare_Function'>issn_in</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1019"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1020"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN681"><span class='Ref_to_Func'>string2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1019"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1020"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1020"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* upc_in 
 */ 
</span><a name="LN1028"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1029"><span class='Ref_to_Func'>upc_in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1030"></a><span class='Declare_Function'>upc_in</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1032"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1033"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN681"><span class='Ref_to_Func'>string2ean</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1032"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1033"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1033"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* casting functions 
*/ 
</span><a name="LN1041"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1042"><span class='Ref_to_Func'>isbn_cast_from_ean13</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1043"></a><span class='Declare_Function'>isbn_cast_from_ean13</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1045"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1046"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN337"><span class='Ref_to_Func'>ean2isn</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1045"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1046"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISBN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1046"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN1053"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1054"><span class='Ref_to_Func'>ismn_cast_from_ean13</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1055"></a><span class='Declare_Function'>ismn_cast_from_ean13</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1057"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1058"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN337"><span class='Ref_to_Func'>ean2isn</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1057"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1058"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISMN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1058"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN1065"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1066"><span class='Ref_to_Func'>issn_cast_from_ean13</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1067"></a><span class='Declare_Function'>issn_cast_from_ean13</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1069"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1070"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN337"><span class='Ref_to_Func'>ean2isn</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1069"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1070"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>ISSN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1070"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN1077"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1078"><span class='Ref_to_Func'>upc_cast_from_ean13</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1079"></a><span class='Declare_Function'>upc_cast_from_ean13</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1081"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1082"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="isn.c.html#LN337"><span class='Ref_to_Func'>ean2isn</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1081"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="isn.c.html#LN1082"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="isn.c.html#LN32"><span class='Ref_to_EnumConst'>UPC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1082"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* is_valid - returns false if the "invalid-check-digit-on-input" is set 
 */ 
</span><a name="LN1092"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1093"><span class='Ref_to_Func'>is_valid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1094"></a><span class='Declare_Function'>is_valid</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1096"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>((</span><a href="isn.c.html#LN1096"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* make_valid - unsets the "invalid-check-digit-on-input" flag 
 */ 
</span><a name="LN1103"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1104"><span class='Ref_to_Func'>make_valid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1105"></a><span class='Declare_Function'>make_valid</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1107"></a>    <a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="isn.h.html#LN29"><span class='Ref_to_Macro'>PG_GETARG_EAN13</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="isn.c.html#LN1107"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>((</span><a href="isn.h.html#LN25"><span class='Ref_to_Typedef'>ean13</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="isn.h.html#LN30"><span class='Ref_to_Macro'>PG_RETURN_EAN13</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN1107"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* this function temporarily sets weak input flag 
 * (to lose the strictness of check digit acceptance) 
 * It's a helper function, not intended to be used!! 
 */ 
</span><a name="LN1117"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1118"><span class='Ref_to_Func'>accept_weak_input</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1119"></a><span class='Declare_Function'>accept_weak_input</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="isn.h.html#LN20"><span class='Ref_to_Const'>ISN_WEAK_MODE</span></a> 
    <a href="isn.c.html#LN37"><span class='Ref_to_Global_Var'>g_weak</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Comment_Multi_Line'>/* function has no effect */ 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* ISN_WEAK_MODE */ 
</span>    <a href="../../src/include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN37"><span class='Ref_to_Global_Var'>g_weak</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN1129"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="isn.c.html#LN1130"><span class='Ref_to_Func'>weak_input_status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1131"></a><span class='Declare_Function'>weak_input_status</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../src/include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="isn.c.html#LN37"><span class='Ref_to_Global_Var'>g_weak</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>