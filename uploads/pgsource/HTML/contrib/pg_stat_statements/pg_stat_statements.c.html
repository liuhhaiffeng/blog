<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\pg_stat_statements\pg_stat_statements.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\pg_stat_statements\pg_stat_statements.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:26 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_stat_statements.c 
 *      Track statement execution times across a whole database cluster. 
 * 
 * Execution costs are totalled for each distinct source query, and kept in 
 * a shared hashtable.  (We track only as many distinct queries as will fit 
 * in the designated amount of shared memory.) 
 * 
 * As of Postgres 9.2, this module normalizes query entries.  Normalization 
 * is a process whereby similar queries, typically differing only in their 
 * constants (though the exact rules are somewhat more subtle than that) are 
 * recognized as equivalent, and are tracked as a single entry.  This is 
 * particularly useful for non-prepared queries. 
 * 
 * Normalization is implemented by fingerprinting queries, selectively 
 * serializing those fields of each query tree's nodes that are judged to be 
 * essential to the query.  This is referred to as a query jumble.  This is 
 * distinct from a regular serialization in that various extraneous 
 * information is ignored as irrelevant or not essential to the query, such 
 * as the collations of Vars and, most notably, the values of constants. 
 * 
 * This jumble is acquired at the end of parse analysis of each query, and 
 * a 32-bit hash of it is stored into the query's Query.queryId field. 
 * The server then copies this value around, making it available in plan 
 * tree(s) generated from the query.  The executor can then use this value 
 * to blame query costs on the proper queryId. 
 * 
 * To facilitate presenting entries to users, we create "representative" query 
 * strings in which constants are replaced with parameter symbols ($n), to 
 * make it clearer what a normalized entry can represent.  To save on shared 
 * memory, and to avoid having to truncate oversized query strings, we store 
 * these strings in a temporary external query-texts file.  Offsets into this 
 * file are kept in shared memory. 
 * 
 * Note about locking issues: to create or delete an entry in the shared 
 * hashtable, one must hold pgss-&GT;lock exclusively.  Modifying any field 
 * in an entry except the counters requires the same.  To look up an entry, 
 * one must hold the lock shared.  To read or update the counters within 
 * an entry, one must hold the lock shared or exclusive (so the entry doesn't 
 * disappear!) and also take the entry's mutex spinlock. 
 * The shared state variable pgss-&GT;extent (the next free spot in the external 
 * query-text file) should be accessed only while holding either the 
 * pgss-&GT;mutex spinlock, or exclusive lock on pgss-&GT;lock.  We use the mutex to 
 * allow reserving file space while holding only shared lock on pgss-&GT;lock. 
 * Rewriting the entire external query-text file, eg for garbage collection, 
 * requires holding pgss-&GT;lock exclusively; this allows individual entries 
 * in the file to be read or written while holding only shared lock. 
 * 
 * 
 * Copyright (c) 2008-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    contrib/pg_stat_statements/pg_stat_statements.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/instrument.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/analyze.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/scanner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/scansup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/fd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/ipc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/spin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Location of permanent stats file (valid when database is shut down) */ 
</span><a name="LN84"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PGSS_DUMP_FILE</span>  <a href="../../src/include/pgstat.h.html#LN28"><span class='Ref_to_Const'>PGSTAT_STAT_PERMANENT_DIRECTORY</span></a> <span class='String'>"/pg_stat_statements.stat"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Location of external query text file.  We don't keep it in the core 
 * system's stats_temp_directory.  The core system can safely use that GUC 
 * setting, because the statistics collector temp file paths are set only once 
 * as part of changing the GUC, but pg_stat_statements has no way of avoiding 
 * race conditions.  Besides, we only expect modest, infrequent I/O for query 
 * strings, so placing the file on a faster filesystem is not compelling. 
 */ 
</span><a name="LN94"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PGSS_TEXT_FILE</span>  <a href="../../src/include/pgstat.h.html#LN33"><span class='Ref_to_Const'>PG_STAT_TMP_DIR</span></a> <span class='String'>"/pgss_query_texts.stat"</span> 
 
<span class='Comment_Multi_Line'>/* Magic number identifying the stats file format */ 
</span><a name="LN97"></a><span class='Keyword'>static const </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Var'>PGSS_FILE_HEADER</span> <span class='Operator'>= </span><span class='Number'>0x20140125</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* PostgreSQL major version number, changes in which invalidate all entries */ 
</span><a name="LN100"></a><span class='Keyword'>static const </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Var'>PGSS_PG_MAJOR_VERSION</span> <span class='Operator'>= </span>PG_VERSION_NUM <span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* XXX: Should USAGE_EXEC reflect execution time and/or buffer usage? */ 
</span><a name="LN103"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>USAGE_EXEC</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>duration</span><span class='Parentheses'>)</span>    <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><a name="LN104"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>USAGE_INIT</span>              <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* including initial planning */ 
</span><a name="LN105"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ASSUMED_MEDIAN_INIT</span>     <span class='Parentheses'>(</span><span class='Number'>10</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* initial assumed median usage */ 
</span><a name="LN106"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ASSUMED_LENGTH_INIT</span>     <span class='Number'>1024</span>    <span class='Comment_Single_Line'>/* initial assumed mean query length */ 
</span><a name="LN107"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>USAGE_DECREASE_FACTOR</span>   <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>99</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* decreased every entry_dealloc */ 
</span><a name="LN108"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>STICKY_DECREASE_FACTOR</span>  <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>50</span><span class='Parentheses'>)</span>  <span class='Comment_Single_Line'>/* factor for sticky entries */ 
</span><a name="LN109"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>USAGE_DEALLOC_PERCENT</span>   <span class='Number'>5</span>       <span class='Comment_Single_Line'>/* free this % of entries at once */ 
</span> 
<a name="LN111"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JUMBLE_SIZE</span>             <span class='Number'>1024</span>    <span class='Comment_Single_Line'>/* query serialization buffer size */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Extension version number, for supporting older extension versions' objects 
 */ 
</span><a name="LN116"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>pgssVersion</span> 
<span class='Delimiter'>{ 
</span><a name="LN118"></a>    <span class='Declare_Enum_Const'>PGSS_V1_0</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN119"></a>    <span class='Declare_Enum_Const'>PGSS_V1_1</span><span class='Delimiter'>, 
</span><a name="LN120"></a>    <span class='Declare_Enum_Const'>PGSS_V1_2</span><span class='Delimiter'>, 
</span><a name="LN121"></a>    <span class='Declare_Enum_Const'>PGSS_V1_3</span> 
<a name="LN122"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pgssVersion</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Hashtable key that defines the identity of a hashtable entry.  We separate 
 * queries by user and by database even if they are otherwise identical. 
 */ 
</span><a name="LN128"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pgssHashKey</span> 
<span class='Delimiter'>{ 
</span><a name="LN130"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>userid</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* user OID */ 
</span><a name="LN131"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>dbid</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* database OID */ 
</span><a name="LN132"></a>    <a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>queryid</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* query identifier */ 
</span><a name="LN133"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pgssHashKey</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The actual stats counters kept within pgssEntry. 
 */ 
</span><a name="LN138"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>Counters</span> 
<span class='Delimiter'>{ 
</span><a name="LN140"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>calls</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* # of times executed */ 
</span><a name="LN141"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>total_time</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* total execution time, in msec */ 
</span><a name="LN142"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>min_time</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* minimum execution time in msec */ 
</span><a name="LN143"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>max_time</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* maximum execution time in msec */ 
</span><a name="LN144"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>mean_time</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* mean execution time in msec */ 
</span><a name="LN145"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>sum_var_time</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* sum of variances in execution time in msec */ 
</span><a name="LN146"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>rows</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* total # of retrieved or affected rows */ 
</span><a name="LN147"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>shared_blks_hit</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* # of shared buffer hits */ 
</span><a name="LN148"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>shared_blks_read</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* # of shared disk blocks read */ 
</span><a name="LN149"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>shared_blks_dirtied</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* # of shared disk blocks dirtied */ 
</span><a name="LN150"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>shared_blks_written</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* # of shared disk blocks written */ 
</span><a name="LN151"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>local_blks_hit</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* # of local buffer hits */ 
</span><a name="LN152"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>local_blks_read</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* # of local disk blocks read */ 
</span><a name="LN153"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>local_blks_dirtied</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # of local disk blocks dirtied */ 
</span><a name="LN154"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>local_blks_written</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # of local disk blocks written */ 
</span><a name="LN155"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>temp_blks_read</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* # of temp blocks read */ 
</span><a name="LN156"></a>    <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>temp_blks_written</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* # of temp blocks written */ 
</span><a name="LN157"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>blk_read_time</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* time spent reading, in msec */ 
</span><a name="LN158"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>blk_write_time</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* time spent writing, in msec */ 
</span><a name="LN159"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>usage</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* usage factor */ 
</span><a name="LN160"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end Counters &raquo; </span> <span class='Declare_Typedef'>Counters</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Statistics per statement 
 * 
 * Note: in event of a failure in garbage collection of the query text file, 
 * we reset query_offset to zero and query_len to -1.  This will be seen as 
 * an invalid state by qtext_fetch(). 
 */ 
</span><a name="LN169"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pgssEntry</span> 
<span class='Delimiter'>{ 
</span><a name="LN171"></a>    <a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Declare_Member'>key</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* hash key of entry - MUST BE FIRST */ 
</span><a name="LN172"></a>    <a href="pg_stat_statements.c.html#LN138"><span class='Ref_to_Struct'>Counters</span></a>    <span class='Declare_Member'>counters</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* the statistics for this query */ 
</span><a name="LN173"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Member'>query_offset</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* query text offset in external file */ 
</span><a name="LN174"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>query_len</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* # of valid bytes in query string, or -1 */ 
</span><a name="LN175"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>encoding</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* query text encoding */ 
</span><a name="LN176"></a>    <a href="../../src/include/storage/s_lock.h.html#LN137"><span class='Ref_to_Typedef'>slock_t</span></a>     <span class='Declare_Member'>mutex</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* protects the counters only */ 
</span><a name="LN177"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pgssEntry</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Global shared state 
 */ 
</span><a name="LN182"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pgssSharedState</span> 
<span class='Delimiter'>{ 
</span><a name="LN184"></a>    <a href="../../src/include/storage/lwlock.h.html#LN31"><span class='Ref_to_Struct'>LWLock</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>lock</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* protects hashtable search/modification */ 
</span><a name="LN185"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>cur_median_usage</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* current median usage in hashtable */ 
</span><a name="LN186"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Member'>mean_query_len</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* current mean entry text length */ 
</span><a name="LN187"></a>    <a href="../../src/include/storage/s_lock.h.html#LN137"><span class='Ref_to_Typedef'>slock_t</span></a>     <span class='Declare_Member'>mutex</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* protects following fields only: */ 
</span><a name="LN188"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Member'>extent</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* current extent of query file */ 
</span><a name="LN189"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>n_writers</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of active writers to query file */ 
</span><a name="LN190"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>gc_count</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* query file garbage collection cycle count */ 
</span><a name="LN191"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pgssSharedState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Struct for tracking locations/lengths of constants during normalization 
 */ 
</span><a name="LN196"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pgssLocationLen</span> 
<span class='Delimiter'>{ 
</span><a name="LN198"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>location</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* start offset in query text */ 
</span><a name="LN199"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>length</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* length in bytes, or -1 to ignore */ 
</span><a name="LN200"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pgssLocationLen</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Working state for computing a query jumble and producing a normalized 
 * query string 
 */ 
</span><a name="LN206"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pgssJumbleState</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Jumble of current query tree */ 
</span><a name="LN209"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Member'>jumble</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Number of bytes used in jumble[] */ 
</span><a name="LN212"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Member'>jumble_len</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Array of locations of constants that should be removed */ 
</span><a name="LN215"></a>    <a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a> <span class='Operator'>*</span><span class='Declare_Member'>clocations</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocated length of clocations array */ 
</span><a name="LN218"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>clocations_buf_size</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Current number of valid entries in clocations array */ 
</span><a name="LN221"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>clocations_count</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* highest Param id we've seen, in order to start normalization correctly */ 
</span><a name="LN224"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>highest_extern_param_id</span><span class='Delimiter'>; 
</span><a name="LN225"></a>}<span class='Auto_Annotations'> &laquo; end pgssJumbleState &raquo; </span> <span class='Declare_Typedef'>pgssJumbleState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/*---- Local variables ----*/ 
</span> 
<span class='Comment_Multi_Line'>/* Current nesting depth of ExecutorRun+ProcessUtility calls */ 
</span><a name="LN230"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>nested_level</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Saved hook values in case of unload */ 
</span><a name="LN233"></a><span class='Keyword'>static </span><a href="../../src/include/storage/ipc.h.html#LN21"><span class='Ref_to_Typedef'>shmem_startup_hook_type</span></a> <span class='Declare_Var'>prev_shmem_startup_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN234"></a><span class='Keyword'>static </span><a href="../../src/include/parser/analyze.h.html#LN19"><span class='Ref_to_Typedef'>post_parse_analyze_hook_type</span></a> <span class='Declare_Var'>prev_post_parse_analyze_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN235"></a><span class='Keyword'>static </span><a href="../../src/include/executor/executor.h.html#LN68"><span class='Ref_to_Typedef'>ExecutorStart_hook_type</span></a> <span class='Declare_Var'>prev_ExecutorStart</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN236"></a><span class='Keyword'>static </span><a href="../../src/include/executor/executor.h.html#LN72"><span class='Ref_to_Typedef'>ExecutorRun_hook_type</span></a> <span class='Declare_Var'>prev_ExecutorRun</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN237"></a><span class='Keyword'>static </span><a href="../../src/include/executor/executor.h.html#LN79"><span class='Ref_to_Typedef'>ExecutorFinish_hook_type</span></a> <span class='Declare_Var'>prev_ExecutorFinish</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN238"></a><span class='Keyword'>static </span><a href="../../src/include/executor/executor.h.html#LN83"><span class='Ref_to_Typedef'>ExecutorEnd_hook_type</span></a> <span class='Declare_Var'>prev_ExecutorEnd</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN239"></a><span class='Keyword'>static </span><a href="../../src/include/tcop/utility.h.html#LN26"><span class='Ref_to_Typedef'>ProcessUtility_hook_type</span></a> <span class='Declare_Var'>prev_ProcessUtility</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Links to shared memory state */ 
</span><a name="LN242"></a><span class='Keyword'>static </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Declare_Var'>pgss</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN243"></a><span class='Keyword'>static </span><a href="../../src/backend/utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Var'>pgss_hash</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/*---- GUC variables ----*/ 
</span> 
<span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN249"></a>    <span class='Declare_Enum_Const'>PGSS_TRACK_NONE</span><span class='Delimiter'>,</span>            <span class='Comment_Single_Line'>/* track no statements */ 
</span><a name="LN250"></a>    <span class='Declare_Enum_Const'>PGSS_TRACK_TOP</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* only top level statements */ 
</span><a name="LN251"></a>    <span class='Declare_Enum_Const'>PGSS_TRACK_ALL</span>              <span class='Comment_Single_Line'>/* all statements, including nested ones */ 
</span><a name="LN252"></a><span class='Delimiter'>}</span>   <span class='Declare_Typedef'>PGSSTrackLevel</span><span class='Delimiter'>; 
</span> 
<a name="LN254"></a><span class='Keyword'>static const </span><span class='Control'>struct</span> <a href="../../src/include/utils/guc.h.html#LN163"><span class='Ref_to_Struct'>config_enum_entry</span></a> <span class='Declare_Var'>track_options</span><span class='Delimiter'>[] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Delimiter'>{</span><span class='String'>"none"</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN249"><span class='Ref_to_EnumConst'>PGSS_TRACK_NONE</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"top"</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN250"><span class='Ref_to_EnumConst'>PGSS_TRACK_TOP</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"all"</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN251"><span class='Ref_to_EnumConst'>PGSS_TRACK_ALL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>} 
}; 
</span> 
<a name="LN262"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>pgss_max</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* max # statements to track */ 
</span><a name="LN263"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>pgss_track</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* tracking level */ 
</span><a name="LN264"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>pgss_track_utility</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* whether to track utility commands */ 
</span><a name="LN265"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>pgss_save</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* whether to save stats across shutdown */ 
</span> 
 
<a name="LN268"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>pgss_enabled</span><span class='Parentheses'>() </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN263"><span class='Ref_to_Global_Var'>pgss_track</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN251"><span class='Ref_to_EnumConst'>PGSS_TRACK_ALL</span></a> <span class='Operator'>|| \ 
</span>    <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN263"><span class='Ref_to_Global_Var'>pgss_track</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN250"><span class='Ref_to_EnumConst'>PGSS_TRACK_TOP</span></a> <span class='Operator'>&& </span><a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
 
<a name="LN272"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>record_gc_qtexts</span><span class='Parentheses'>() </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span>s <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span>s<span class='Operator'>-&GT;</span>mutex<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        s<span class='Operator'>-&GT;</span>gc_count<span class='Operator'>++</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span>s<span class='Operator'>-&GT;</span>mutex<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/*---- Function declarations ----*/ 
</span> 
<a name="LN282"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>_PG_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN283"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>_PG_fini</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN285"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1323"><span class='Ref_to_Func'>pg_stat_statements_reset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN286"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1361"><span class='Ref_to_Func'>pg_stat_statements_1_2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN287"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1351"><span class='Ref_to_Func'>pg_stat_statements_1_3</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN288"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1375"><span class='Ref_to_Func'>pg_stat_statements</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN290"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_shmem_startup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN291"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_shmem_shutdown</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN292"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_post_parse_analyze</span><span class='Parentheses'>(</span><a href="../../src/include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN293"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_ExecutorStart</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN294"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_ExecutorRun</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, 
</span><a name="LN295"></a>                 <a href="../../src/include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, 
</span><a name="LN296"></a>                 <a href="../../src/include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>count</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>execute_once</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN297"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_ExecutorFinish</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN298"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_ExecutorEnd</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN299"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_ProcessUtility</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmt</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>queryString</span><span class='Delimiter'>, 
</span><a name="LN300"></a>                    <a href="../../src/include/tcop/utility.h.html#LN18"><span class='Ref_to_Typedef'>ProcessUtilityContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN301"></a>                    <a href="../../src/backend/utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN302"></a>                    <a href="../../src/include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN303"></a><span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>pgss_hash_fn</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN304"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>pgss_match_fn</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key2</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN305"></a><span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>pgss_hash_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN306"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pgss_store</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>queryId</span><span class='Delimiter'>, 
</span><a name="LN307"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>query_location</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN308"></a>           <span class='Keyword'>double </span><span class='Declare_Parameter'>total_time</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>rows</span><span class='Delimiter'>, 
</span><a name="LN309"></a>           <span class='Keyword'>const </span><a href="../../src/include/executor/instrument.h.html#LN18"><span class='Ref_to_Struct'>BufferUsage</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bufusage</span><span class='Delimiter'>, 
</span><a name="LN310"></a>           <a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN311"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>pg_stat_statements_internal</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN312"></a>                            <a href="pg_stat_statements.c.html#LN116"><span class='Ref_to_Enum'>pgssVersion</span></a> <span class='Declare_Parameter'>api_version</span><span class='Delimiter'>, 
</span><a name="LN313"></a>                            <span class='Keyword'>bool </span><span class='Declare_Parameter'>showtext</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN314"></a><span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Prototype'>pgss_memsize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN315"></a><span class='Keyword'>static </span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>entry_alloc</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>query_offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN316"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>sticky</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN317"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>entry_dealloc</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN318"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>qtext_store</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN319"></a>            <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query_offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>gc_count</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN320"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>qtext_load_file</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buffer_size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>qtext_fetch</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>query_offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN322"></a>            <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>buffer_size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN323"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>need_gc_qtexts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN324"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>gc_qtexts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN325"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>entry_reset</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN326"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AppendJumble</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, 
</span><a name="LN327"></a>             <span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Declare_Parameter'>item</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN328"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>JumbleQuery</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN329"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>JumbleRangeTable</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rtable</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN330"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>JumbleExpr</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>RecordConstLocation</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN332"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>generate_normalized_query</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN333"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>query_loc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_len_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN334"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fill_in_constant_lengths</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN335"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>query_loc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>comp_location</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Module load callback 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN343"></a><span class='Declare_Function'>_PG_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * In order to create our shared memory area, we have to be loaded via 
     * shared_preload_libraries.  If not, fall out without hooking into any of 
     * the main system.  (We don't throw error here because it seems useful to 
     * allow the pg_stat_statements functions to be created even when the 
     * module isn't active.  The functions must protect themselves against 
     * being called then, however.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/backend/utils/init/miscinit.c.html#LN1416"><span class='Ref_to_Global_Var'>process_shared_preload_libraries_in_progress</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Define (or redefine) custom GUC variables. 
     */ 
</span>    <a href="../../src/include/utils/guc.h.html#LN291"><span class='Ref_to_Proto'>DefineCustomIntVariable</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements.max"</span><span class='Delimiter'>, 
</span>      <span class='String'>"Sets the maximum number of statements tracked by pg_stat_statements."</span><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a><span class='Delimiter'>, 
</span>                            <span class='Number'>5000</span><span class='Delimiter'>, 
</span>                            <span class='Number'>100</span><span class='Delimiter'>, 
</span>                            INT_MAX<span class='Delimiter'>, 
</span>                            <a href="../../src/include/utils/guc.h.html#LN70"><span class='Ref_to_EnumConst'>PGC_POSTMASTER</span></a><span class='Delimiter'>, 
</span>                            <span class='Number'>0</span><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                            <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/guc.h.html#LN331"><span class='Ref_to_Proto'>DefineCustomEnumVariable</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements.track"</span><span class='Delimiter'>, 
</span>               <span class='String'>"Selects which statements are tracked by pg_stat_statements."</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN263"><span class='Ref_to_Global_Var'>pgss_track</span></a><span class='Delimiter'>, 
</span>                             <a href="pg_stat_statements.c.html#LN250"><span class='Ref_to_EnumConst'>PGSS_TRACK_TOP</span></a><span class='Delimiter'>, 
</span>                             <a href="pg_stat_statements.c.html#LN254"><span class='Ref_to_Global_Var'>track_options</span></a><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN74"><span class='Ref_to_EnumConst'>PGC_SUSET</span></a><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/guc.h.html#LN279"><span class='Ref_to_Proto'>DefineCustomBoolVariable</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements.track_utility"</span><span class='Delimiter'>, 
</span>       <span class='String'>"Selects whether utility commands are tracked by pg_stat_statements."</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN264"><span class='Ref_to_Global_Var'>pgss_track_utility</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN74"><span class='Ref_to_EnumConst'>PGC_SUSET</span></a><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/guc.h.html#LN279"><span class='Ref_to_Proto'>DefineCustomBoolVariable</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements.save"</span><span class='Delimiter'>, 
</span>               <span class='String'>"Save pg_stat_statements statistics across server shutdowns."</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN265"><span class='Ref_to_Global_Var'>pgss_save</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN71"><span class='Ref_to_EnumConst'>PGC_SIGHUP</span></a><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/guc.h.html#LN344"><span class='Ref_to_Proto'>EmitWarningsOnPlaceholders</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Request additional shared resources.  (These are no-ops if we're not in 
     * the postmaster process.)  We'll allocate or attach to the shared 
     * resources in pgss_shmem_startup(). 
     */ 
</span>    <a href="../../src/include/storage/shmem.h.html#LN48"><span class='Ref_to_Proto'>RequestAddinShmemSpace</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN314"><span class='Ref_to_Proto'>pgss_memsize</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/storage/lwlock.h.html#LN169"><span class='Ref_to_Proto'>RequestNamedLWLockTranche</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements"</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Install hooks. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN233"><span class='Ref_to_Global_Var'>prev_shmem_startup_hook</span></a> <span class='Operator'>= </span><a href="../../src/backend/storage/ipc/ipci.c.html#LN50"><span class='Ref_to_Global_Var'>shmem_startup_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/storage/ipc/ipci.c.html#LN50"><span class='Ref_to_Global_Var'>shmem_startup_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN290"><span class='Ref_to_Proto'>pgss_shmem_startup</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN234"><span class='Ref_to_Global_Var'>prev_post_parse_analyze_hook</span></a> <span class='Operator'>= </span><a href="../../src/backend/parser/analyze.c.html#LN48"><span class='Ref_to_Global_Var'>post_parse_analyze_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/parser/analyze.c.html#LN48"><span class='Ref_to_Global_Var'>post_parse_analyze_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN292"><span class='Ref_to_Proto'>pgss_post_parse_analyze</span></a><span class='Delimiter'>; 
</span>    <a href="../auto_explain/auto_explain.c.html#LN45"><span class='Ref_to_Global_Var'>prev_ExecutorStart</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/execMain.c.html#LN68"><span class='Ref_to_Global_Var'>ExecutorStart_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN68"><span class='Ref_to_Global_Var'>ExecutorStart_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN293"><span class='Ref_to_Proto'>pgss_ExecutorStart</span></a><span class='Delimiter'>; 
</span>    <a href="../auto_explain/auto_explain.c.html#LN46"><span class='Ref_to_Global_Var'>prev_ExecutorRun</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/execMain.c.html#LN69"><span class='Ref_to_Global_Var'>ExecutorRun_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN69"><span class='Ref_to_Global_Var'>ExecutorRun_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN294"><span class='Ref_to_Proto'>pgss_ExecutorRun</span></a><span class='Delimiter'>; 
</span>    <a href="../auto_explain/auto_explain.c.html#LN47"><span class='Ref_to_Global_Var'>prev_ExecutorFinish</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/execMain.c.html#LN70"><span class='Ref_to_Global_Var'>ExecutorFinish_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN70"><span class='Ref_to_Global_Var'>ExecutorFinish_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN297"><span class='Ref_to_Proto'>pgss_ExecutorFinish</span></a><span class='Delimiter'>; 
</span>    <a href="../auto_explain/auto_explain.c.html#LN48"><span class='Ref_to_Global_Var'>prev_ExecutorEnd</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/execMain.c.html#LN71"><span class='Ref_to_Global_Var'>ExecutorEnd_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN71"><span class='Ref_to_Global_Var'>ExecutorEnd_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN298"><span class='Ref_to_Proto'>pgss_ExecutorEnd</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN239"><span class='Ref_to_Global_Var'>prev_ProcessUtility</span></a> <span class='Operator'>= </span><a href="../../src/backend/tcop/utility.c.html#LN72"><span class='Ref_to_Global_Var'>ProcessUtility_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/tcop/utility.c.html#LN72"><span class='Ref_to_Global_Var'>ProcessUtility_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN299"><span class='Ref_to_Proto'>pgss_ProcessUtility</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _PG_init &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Module unload callback 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN439"></a><span class='Declare_Function'>_PG_fini</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Uninstall hooks. */ 
</span>    <a href="../../src/backend/storage/ipc/ipci.c.html#LN50"><span class='Ref_to_Global_Var'>shmem_startup_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN233"><span class='Ref_to_Global_Var'>prev_shmem_startup_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/parser/analyze.c.html#LN48"><span class='Ref_to_Global_Var'>post_parse_analyze_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN234"><span class='Ref_to_Global_Var'>prev_post_parse_analyze_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN68"><span class='Ref_to_Global_Var'>ExecutorStart_hook</span></a> <span class='Operator'>= </span><a href="../auto_explain/auto_explain.c.html#LN45"><span class='Ref_to_Global_Var'>prev_ExecutorStart</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN69"><span class='Ref_to_Global_Var'>ExecutorRun_hook</span></a> <span class='Operator'>= </span><a href="../auto_explain/auto_explain.c.html#LN46"><span class='Ref_to_Global_Var'>prev_ExecutorRun</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN70"><span class='Ref_to_Global_Var'>ExecutorFinish_hook</span></a> <span class='Operator'>= </span><a href="../auto_explain/auto_explain.c.html#LN47"><span class='Ref_to_Global_Var'>prev_ExecutorFinish</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN71"><span class='Ref_to_Global_Var'>ExecutorEnd_hook</span></a> <span class='Operator'>= </span><a href="../auto_explain/auto_explain.c.html#LN48"><span class='Ref_to_Global_Var'>prev_ExecutorEnd</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/tcop/utility.c.html#LN72"><span class='Ref_to_Global_Var'>ProcessUtility_hook</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN239"><span class='Ref_to_Global_Var'>prev_ProcessUtility</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * shmem_startup hook: allocate or attach to shared memory, 
 * then load any pre-existing statistics from file. 
 * Also create and load the query-texts file, which is expected to exist 
 * (even if empty) while the module is enabled. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN458"></a><span class='Declare_Function'>pgss_shmem_startup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN460"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN461"></a>    <a href="../../src/include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>info</span><span class='Delimiter'>; 
</span><a name="LN462"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN463"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>qfile</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN464"></a>    <a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>header</span><span class='Delimiter'>; 
</span><a name="LN465"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span><a name="LN466"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>pgver</span><span class='Delimiter'>; 
</span><a name="LN467"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN468"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>buffer_size</span><span class='Delimiter'>; 
</span><a name="LN469"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buffer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN233"><span class='Ref_to_Global_Var'>prev_shmem_startup_hook</span></a><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN233"><span class='Ref_to_Global_Var'>prev_shmem_startup_hook</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* reset in case this is a restart within the postmaster */ 
</span>    <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create or attach to the shared memory state, including hash table 
     */ 
</span>    <a href="../../src/include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span>AddinShmemInitLock<span class='Delimiter'>, </span><a href="../../src/include/storage/lwlock.h.html#LN133"><span class='Ref_to_EnumConst'>LW_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/shmem.h.html#LN43"><span class='Ref_to_Proto'>ShmemInitStruct</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements"</span><span class='Delimiter'>, 
</span>                           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN460"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN460"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First time through ... */ 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><a href="../../src/include/storage/lwlock.h.html#LN170"><span class='Ref_to_Proto'>GetNamedLWLockTranche</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements"</span><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span><a href="../../src/include/storage/lwlock.h.html#LN78"><span class='Ref_to_Member'>lock</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN185"><span class='Ref_to_Member'>cur_median_usage</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN105"><span class='Ref_to_Const'>ASSUMED_MEDIAN_INIT</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN106"><span class='Ref_to_Const'>ASSUMED_LENGTH_INIT</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/spin.h.html#LN59"><span class='Ref_to_Macro'>SpinLockInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN189"><span class='Ref_to_Member'>n_writers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN190"><span class='Ref_to_Member'>gc_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Operator'>.</span><a href="../../src/include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Operator'>.</span><a href="../../src/include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Operator'>.</span><a href="../../src/include/utils/hsearch.h.html#LN73"><span class='Ref_to_Member'>hash</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN303"><span class='Ref_to_Proto'>pgss_hash_fn</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Operator'>.</span><a href="../../src/include/utils/hsearch.h.html#LN74"><span class='Ref_to_Member'>match</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN304"><span class='Ref_to_Proto'>pgss_match_fn</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/shmem.h.html#LN41"><span class='Ref_to_Proto'>ShmemInitHash</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements hash"</span><span class='Delimiter'>, 
</span>                              <a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN461"><span class='Ref_To_Local'>info</span></a><span class='Delimiter'>, 
</span>                              <a href="../../src/include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../src/include/utils/hsearch.h.html#LN88"><span class='Ref_to_Const'>HASH_FUNCTION</span></a> <span class='Operator'>| </span><a href="../../src/include/utils/hsearch.h.html#LN89"><span class='Ref_to_Const'>HASH_COMPARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span>AddinShmemInitLock<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're in the postmaster (or a standalone backend...), set up a shmem 
     * exit hook to dump the statistics to disk. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/backend/utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/storage/ipc.h.html#LN69"><span class='Ref_to_Proto'>on_shmem_exit</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN291"><span class='Ref_to_Proto'>pgss_shmem_shutdown</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Done if some other process already completed our initialization. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN460"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we don't bother with locks here, because there should be no other 
     * processes running when this code is reached. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Unlink query text file possibly left over from crash */ 
</span>    <a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate new query text temp file */ 
</span>    <a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN651"><span class='Ref_to_Label'>write_error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we were told not to load old statistics, we're done.  (Note we do 
     * not try to unlink any old dump file in this case.  This seems a bit 
     * questionable but it's the historical behavior.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN265"><span class='Ref_to_Global_Var'>pgss_save</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Attempt to load old statistics from the dump file. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a><span class='Delimiter'>, </span><a href="../../src/tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN639"><span class='Ref_to_Label'>read_error</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* No existing persisted stats file, so we're done */ 
</span>        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_stat_statements.c.html#LN468"><span class='Ref_To_Local'>buffer_size</span></a> <span class='Operator'>= </span><span class='Number'>2048</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN468"><span class='Ref_To_Local'>buffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN464"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN466"><span class='Ref_To_Local'>pgver</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN465"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN639"><span class='Ref_to_Label'>read_error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN464"><span class='Ref_To_Local'>header</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN97"><span class='Ref_to_Global_Var'>PGSS_FILE_HEADER</span></a> <span class='Operator'>|| 
</span>        <a href="pg_stat_statements.c.html#LN466"><span class='Ref_To_Local'>pgver</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN100"><span class='Ref_to_Global_Var'>PGSS_PG_MAJOR_VERSION</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN645"><span class='Ref_to_Label'>data_error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN467"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN467"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN465"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN467"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN575"></a>        <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>   <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN576"></a>        <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN577"></a>        <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>query_offset</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN639"><span class='Ref_to_Label'>read_error</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Encoding is the only field we can easily sanity-check */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/mb/pg_wchar.h.html#LN292"><span class='Ref_to_Macro'>PG_VALID_BE_ENCODING</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN175"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN645"><span class='Ref_to_Label'>data_error</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Resize buffer as needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN468"><span class='Ref_To_Local'>buffer_size</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN468"><span class='Ref_To_Local'>buffer_size</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN468"><span class='Ref_To_Local'>buffer_size</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN468"><span class='Ref_To_Local'>buffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>fread<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN639"><span class='Ref_to_Label'>read_error</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should have a trailing null, but let's make sure */ 
</span>        <a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip loading "sticky" entries */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Store the query text */ 
</span>        <a href="pg_stat_statements.c.html#LN577"><span class='Ref_To_Local'>query_offset</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN651"><span class='Ref_to_Label'>write_error</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* make the hashtable entry (discards old entries if too many) */ 
</span>        <a href="pg_stat_statements.c.html#LN576"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN315"><span class='Ref_to_Proto'>entry_alloc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN577"><span class='Ref_To_Local'>query_offset</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a><span class='Delimiter'>, 
</span>                            <a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN175"><span class='Ref_to_Member'>encoding</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* copy in the actual stats */ 
</span>        <a href="pg_stat_statements.c.html#LN576"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN575"><span class='Ref_To_Local'>temp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num;i++ &raquo; </span> 
 
    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Remove the persisted stats file so it's not included in 
     * backups/replication slaves, etc.  A new file will be written on next 
     * shutdown. 
     * 
     * Note: it's okay if the PGSS_TEXT_FILE is included in a basebackup, 
     * because we remove that file on startup; it acts inversely to 
     * PGSS_DUMP_FILE, in that it is only supposed to be around when the 
     * server is running, whereas PGSS_DUMP_FILE is only supposed to be around 
     * when the server is not running.  Leaving the file creates no danger of 
     * a newly restored database having a spurious record of execution costs, 
     * which is what we're really concerned about here. 
     */ 
</span>    <a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
<a name="LN639"></a><span class='Label'>read_error</span><span class='Operator'>: 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                    <a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN656"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span><a name="LN645"></a><span class='Label'>data_error</span><span class='Operator'>: 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ignoring invalid data in pg_stat_statement file \"%s\""</span><span class='Delimiter'>, 
</span>                    <a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN656"><span class='Ref_to_Label'>fail</span></a><span class='Delimiter'>; 
</span><a name="LN651"></a><span class='Label'>write_error</span><span class='Operator'>: 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                    <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span><a name="LN656"></a><span class='Label'>fail</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN469"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN462"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN463"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* If possible, throw away the bogus file; ignore any error */ 
</span>    <a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't unlink PGSS_TEXT_FILE here; it should always be around while the 
     * server is running with pg_stat_statements enabled 
     */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pgss_shmem_startup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * shmem_shutdown hook: Dump statistics into file. 
 * 
 * Note: we don't bother with acquiring lock, because there should be no 
 * other processes running when this is called. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN679"></a><span class='Declare_Function'>pgss_shmem_shutdown</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN681"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span><span class='Delimiter'>; 
</span><a name="LN682"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qbuffer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN683"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>qbuffer_size</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN684"></a>    <a href="../../src/include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>hash_seq</span><span class='Delimiter'>; 
</span><a name="LN685"></a>    <a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>num_entries</span><span class='Delimiter'>; 
</span><a name="LN686"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't try to dump during a crash. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN679"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safety check ... shouldn't get here unless shmem is set up. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>|| !</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't dump if told not to. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN265"><span class='Ref_to_Global_Var'>pgss_save</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a> <span class='String'>".tmp"</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN97"><span class='Ref_to_Global_Var'>PGSS_FILE_HEADER</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN100"><span class='Ref_to_Global_Var'>PGSS_PG_MAJOR_VERSION</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN685"><span class='Ref_To_Local'>num_entries</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN133"><span class='Ref_to_Proto'>hash_get_num_entries</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN685"><span class='Ref_To_Local'>num_entries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN320"><span class='Ref_to_Proto'>qtext_load_file</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN683"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When serializing to disk, we store query texts immediately after their 
     * entry data.  Any orphaned query texts are thereby excluded. 
     */ 
</span>    <a href="../../src/include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN684"><span class='Ref_To_Local'>hash_seq</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_stat_statements.c.html#LN686"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN684"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN723"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN686"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a><span class='Delimiter'>; 
</span><a name="LN724"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qstr</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN321"><span class='Ref_to_Proto'>qtext_fetch</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN686"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN723"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, 
</span>                                       <a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN683"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN724"><span class='Ref_To_Local'>qstr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Ignore any entries with bogus texts */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN686"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            fwrite<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN724"><span class='Ref_To_Local'>qstr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN723"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN723"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* note: we assume hash_seq_term won't change errno */ 
</span>            <a href="../../src/include/utils/hsearch.h.html#LN136"><span class='Ref_to_Proto'>hash_seq_term</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN684"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN758"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Rename file into place, so we atomically replace any old one. 
     */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/common/file_utils.h.html#LN22"><span class='Ref_to_Proto'>durable_rename</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a> <span class='String'>".tmp"</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Unlink query-texts file; it's not needed while shutdown */ 
</span>    <a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
<a name="LN758"></a><span class='Label'>error</span><span class='Operator'>: 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                    <a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a> <span class='String'>".tmp"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN682"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN681"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN84"><span class='Ref_to_Const'>PGSS_DUMP_FILE</span></a> <span class='String'>".tmp"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgss_shmem_shutdown &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Post-parse-analysis hook: mark query with a queryId 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN775"></a><span class='Declare_Function'>pgss_post_parse_analyze</span><span class='Parentheses'>(</span><a href="../../src/include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN777"></a>    <a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Declare_Local'>jstate</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN234"><span class='Ref_to_Global_Var'>prev_post_parse_analyze_hook</span></a><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN234"><span class='Ref_to_Global_Var'>prev_post_parse_analyze_hook</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assert we didn't do this already */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN113"><span class='Ref_to_Member'>queryId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safety check... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>|| !</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Utility statements get queryId zero.  We do this even in cases where 
     * the statement contains an optimizable statement for which a queryId 
     * could be derived (such as EXPLAIN or DECLARE CURSOR).  For such cases, 
     * runtime control will first go through ProcessUtility and then the 
     * executor, and we don't want the executor hooks to do anything, since we 
     * are already measuring the statement's costs at the utility level. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN113"><span class='Ref_to_Member'>queryId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Set up workspace for query jumbling */ 
</span>    <a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN209"><span class='Ref_to_Member'>jumble</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN111"><span class='Ref_to_Const'>JUMBLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN212"><span class='Ref_to_Member'>jumble_len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN218"><span class='Ref_to_Member'>clocations_buf_size</span></a> <span class='Operator'>= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN218"><span class='Ref_to_Member'>clocations_buf_size</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN224"><span class='Ref_to_Member'>highest_extern_param_id</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compute query ID and mark the Query node with it */ 
</span>    <a href="pg_stat_statements.c.html#LN328"><span class='Ref_to_Proto'>JumbleQuery</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN113"><span class='Ref_to_Member'>queryId</span></a> <span class='Operator'>= </span><a href="../../src/backend/access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN209"><span class='Ref_to_Member'>jumble</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN212"><span class='Ref_to_Member'>jumble_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are unlucky enough to get a hash of zero, use 1 instead, to 
     * prevent confusion with the utility-statement case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN113"><span class='Ref_to_Member'>queryId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN113"><span class='Ref_to_Member'>queryId</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we were able to identify any ignorable constants, we immediately 
     * create a hash table entry for the query, so that we can record the 
     * normalized form of the query string.  If there were no such constants, 
     * the normalized string would be the same as the query text anyway, so 
     * there's no need for an early entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN306"><span class='Ref_to_Proto'>pgss_store</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/parser/parse_node.h.html#LN167"><span class='Ref_to_Member'>p_sourcetext</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN113"><span class='Ref_to_Member'>queryId</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN179"><span class='Ref_to_Member'>stmt_location</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN775"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN180"><span class='Ref_to_Member'>stmt_len</span></a><span class='Delimiter'>, 
</span>                   <span class='Number'>0</span><span class='Delimiter'>, 
</span>                   <span class='Number'>0</span><span class='Delimiter'>, 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN777"><span class='Ref_To_Local'>jstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgss_post_parse_analyze &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecutorStart hook: start up tracking if needed 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN845"></a><span class='Declare_Function'>pgss_ExecutorStart</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../auto_explain/auto_explain.c.html#LN45"><span class='Ref_to_Global_Var'>prev_ExecutorStart</span></a><span class='Parentheses'>) 
</span>        <a href="../auto_explain/auto_explain.c.html#LN45"><span class='Ref_to_Global_Var'>prev_ExecutorStart</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../src/backend/executor/execMain.c.html#LN153"><span class='Ref_to_Func'>standard_ExecutorStart</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>eflags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If query has queryId zero, don't track it.  This prevents double 
     * counting of optimizable statements that are directly contained in 
     * utility statements. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN268"><span class='Ref_to_Macro'>pgss_enabled</span></a><span class='Parentheses'>() </span><span class='Operator'>&& </span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN46"><span class='Ref_to_Member'>queryId</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Set up to track total elapsed time in ExecutorRun.  Make sure the 
         * space is allocated in the per-query context so it will go away at 
         * ExecutorEnd. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN866"></a>            <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
            <a href="pg_stat_statements.c.html#LN866"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN845"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/instrument.c.html#LN28"><span class='Ref_to_Func'>InstrAlloc</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../src/include/executor/instrument.h.html#LN40"><span class='Ref_to_EnumConst'>INSTRUMENT_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN866"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pgss_ExecutorStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecutorRun hook: all we need do is track nesting depth 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN879"></a><span class='Declare_Function'>pgss_ExecutorRun</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Delimiter'>, </span><a href="../../src/include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>count</span><span class='Delimiter'>, 
</span><a name="LN880"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>execute_once</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../auto_explain/auto_explain.c.html#LN46"><span class='Ref_to_Global_Var'>prev_ExecutorRun</span></a><span class='Parentheses'>) 
</span>            <a href="../auto_explain/auto_explain.c.html#LN46"><span class='Ref_to_Global_Var'>prev_ExecutorRun</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN879"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN879"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN879"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN880"><span class='Ref_to_Parameter'>execute_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../src/include/executor/executor.h.html#LN171"><span class='Ref_to_Proto'>standard_ExecutorRun</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN879"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN879"><span class='Ref_to_Parameter'>direction</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN879"><span class='Ref_to_Parameter'>count</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN880"><span class='Ref_to_Parameter'>execute_once</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgss_ExecutorRun &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecutorFinish hook: all we need do is track nesting depth 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN903"></a><span class='Declare_Function'>pgss_ExecutorFinish</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../auto_explain/auto_explain.c.html#LN47"><span class='Ref_to_Global_Var'>prev_ExecutorFinish</span></a><span class='Parentheses'>) 
</span>            <a href="../auto_explain/auto_explain.c.html#LN47"><span class='Ref_to_Global_Var'>prev_ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN903"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../src/include/executor/executor.h.html#LN174"><span class='Ref_to_Proto'>standard_ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN903"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ExecutorEnd hook: store results if needed 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN926"></a><span class='Declare_Function'>pgss_ExecutorEnd</span><span class='Parentheses'>(</span><a href="../../src/include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN928"></a>    <a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>queryId</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN46"><span class='Ref_to_Member'>queryId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN928"><span class='Ref_To_Local'>queryId</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a> <span class='Operator'>&& </span><a href="pg_stat_statements.c.html#LN268"><span class='Ref_to_Macro'>pgss_enabled</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Make sure stats accumulation is done.  (Note: it's okay if several 
         * levels of hook all do this.) 
         */ 
</span>        <a href="../../src/include/executor/instrument.h.html#LN77"><span class='Ref_to_Proto'>InstrEndLoop</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN306"><span class='Ref_to_Proto'>pgss_store</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN37"><span class='Ref_to_Member'>sourceText</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN928"><span class='Ref_To_Local'>queryId</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN96"><span class='Ref_to_Member'>stmt_location</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN36"><span class='Ref_to_Member'>plannedstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN97"><span class='Ref_to_Member'>stmt_len</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN57"><span class='Ref_to_Member'>total</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* convert to msec */ 
</span>                   <a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/execdesc.h.html#LN54"><span class='Ref_to_Member'>totaltime</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN62"><span class='Ref_to_Member'>bufusage</span></a><span class='Delimiter'>, 
</span>                   <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../auto_explain/auto_explain.c.html#LN48"><span class='Ref_to_Global_Var'>prev_ExecutorEnd</span></a><span class='Parentheses'>) 
</span>        <a href="../auto_explain/auto_explain.c.html#LN48"><span class='Ref_to_Global_Var'>prev_ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../src/include/executor/executor.h.html#LN176"><span class='Ref_to_Proto'>standard_ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN926"><span class='Ref_to_Parameter'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgss_ExecutorEnd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ProcessUtility hook 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN958"></a><span class='Declare_Function'>pgss_ProcessUtility</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmt</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>queryString</span><span class='Delimiter'>, 
</span><a name="LN959"></a>                    <a href="../../src/include/tcop/utility.h.html#LN18"><span class='Ref_to_Typedef'>ProcessUtilityContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN960"></a>                    <a href="../../src/include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, </span><a href="../../src/backend/utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN961"></a>                    <a href="../../src/include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN963"></a>    <a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's an EXECUTE statement, we don't track it and don't increment the 
     * nesting level.  This allows the cycles to be charged to the underlying 
     * PREPARE instead (by the Executor hooks), which is much more useful. 
     * 
     * We also don't track execution of PREPARE.  If we did, we would get one 
     * hash table entry for the PREPARE (with hash calculated from the query 
     * string), and then a different one with the same query string (but hash 
     * calculated from the query tree) would be used to accumulate costs of 
     * ensuing EXECUTEs.  This would be confusing, and inconsistent with other 
     * cases where planning time is not included at all. 
     * 
     * Likewise, we don't track execution of DEALLOCATE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN264"><span class='Ref_to_Global_Var'>pgss_track_utility</span></a> <span class='Operator'>&& </span><a href="pg_stat_statements.c.html#LN268"><span class='Ref_to_Macro'>pgss_enabled</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN963"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN963"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN3254"><span class='Ref_to_Struct'>PrepareStmt</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN963"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN3280"><span class='Ref_to_Struct'>DeallocateStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN984"></a>        <a href="../../src/include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>start</span><span class='Delimiter'>; 
</span><a name="LN985"></a>        <a href="../../src/include/portability/instr_time.h.html#LN146"><span class='Ref_to_Typedef'>instr_time</span></a>  <span class='Declare_Local'>duration</span><span class='Delimiter'>; 
</span><a name="LN986"></a>        <a href="../../src/include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>rows</span><span class='Delimiter'>; 
</span><a name="LN987"></a>        <a href="../../src/include/executor/instrument.h.html#LN18"><span class='Ref_to_Struct'>BufferUsage</span></a> <span class='Declare_Local'>bufusage_start</span><span class='Delimiter'>, 
</span><a name="LN988"></a>                    <span class='Declare_Local'>bufusage</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN984"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN239"><span class='Ref_to_Global_Var'>prev_ProcessUtility</span></a><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN239"><span class='Ref_to_Global_Var'>prev_ProcessUtility</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                    <a href="pg_stat_statements.c.html#LN959"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                    <a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../src/include/tcop/utility.h.html#LN37"><span class='Ref_to_Proto'>standard_ProcessUtility</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                        <a href="pg_stat_statements.c.html#LN959"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                        <a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN230"><span class='Ref_to_Global_Var'>nested_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/portability/instr_time.h.html#LN88"><span class='Ref_to_Macro'>INSTR_TIME_SET_CURRENT</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN985"><span class='Ref_To_Local'>duration</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN985"><span class='Ref_To_Local'>duration</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN984"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* parse command tag to retrieve the number of affected rows. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a> <span class='Operator'>&& 
</span>            strncmp<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><span class='String'>"COPY "</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="pg_stat_statements.c.html#LN986"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN50"><span class='Ref_to_Proto'>pg_strtouint64</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_stat_statements.c.html#LN986"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* calc differences of buffer counters. */ 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN20"><span class='Ref_to_Member'>shared_blks_hit</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN20"><span class='Ref_to_Member'>shared_blks_hit</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN20"><span class='Ref_to_Member'>shared_blks_hit</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN21"><span class='Ref_to_Member'>shared_blks_read</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN21"><span class='Ref_to_Member'>shared_blks_read</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN21"><span class='Ref_to_Member'>shared_blks_read</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN22"><span class='Ref_to_Member'>shared_blks_dirtied</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN22"><span class='Ref_to_Member'>shared_blks_dirtied</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN22"><span class='Ref_to_Member'>shared_blks_dirtied</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN23"><span class='Ref_to_Member'>shared_blks_written</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN23"><span class='Ref_to_Member'>shared_blks_written</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN23"><span class='Ref_to_Member'>shared_blks_written</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN24"><span class='Ref_to_Member'>local_blks_hit</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN24"><span class='Ref_to_Member'>local_blks_hit</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN24"><span class='Ref_to_Member'>local_blks_hit</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN25"><span class='Ref_to_Member'>local_blks_read</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN25"><span class='Ref_to_Member'>local_blks_read</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN25"><span class='Ref_to_Member'>local_blks_read</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN26"><span class='Ref_to_Member'>local_blks_dirtied</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN26"><span class='Ref_to_Member'>local_blks_dirtied</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN26"><span class='Ref_to_Member'>local_blks_dirtied</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN27"><span class='Ref_to_Member'>local_blks_written</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN27"><span class='Ref_to_Member'>local_blks_written</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN27"><span class='Ref_to_Member'>local_blks_written</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN28"><span class='Ref_to_Member'>temp_blks_read</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN28"><span class='Ref_to_Member'>temp_blks_read</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN28"><span class='Ref_to_Member'>temp_blks_read</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN29"><span class='Ref_to_Member'>temp_blks_written</span></a> <span class='Operator'>= 
</span>            <a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN29"><span class='Ref_to_Member'>temp_blks_written</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN29"><span class='Ref_to_Member'>temp_blks_written</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN30"><span class='Ref_to_Member'>blk_read_time</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN30"><span class='Ref_to_Member'>blk_read_time</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN30"><span class='Ref_to_Member'>blk_read_time</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN30"><span class='Ref_to_Member'>blk_read_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN31"><span class='Ref_to_Member'>blk_write_time</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/instrument.c.html#LN19"><span class='Ref_to_Global_Var'>pgBufferUsage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN31"><span class='Ref_to_Member'>blk_write_time</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/portability/instr_time.h.html#LN102"><span class='Ref_to_Macro'>INSTR_TIME_SUBTRACT</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN31"><span class='Ref_to_Member'>blk_write_time</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN987"><span class='Ref_To_Local'>bufusage_start</span></a><span class='Operator'>.</span><a href="../../src/include/executor/instrument.h.html#LN31"><span class='Ref_to_Member'>blk_write_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN306"><span class='Ref_to_Proto'>pgss_store</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                   <span class='Number'>0</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* signal that it's a utility stmt */ 
</span>                   <a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN96"><span class='Ref_to_Member'>stmt_location</span></a><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN97"><span class='Ref_to_Member'>stmt_len</span></a><span class='Delimiter'>, 
</span>                   <a href="../../src/include/portability/instr_time.h.html#LN134"><span class='Ref_to_Macro'>INSTR_TIME_GET_MILLISEC</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN985"><span class='Ref_To_Local'>duration</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="pg_stat_statements.c.html#LN986"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN988"><span class='Ref_To_Local'>bufusage</span></a><span class='Delimiter'>, 
</span>                   <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pgss_track_utility&&p... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN239"><span class='Ref_to_Global_Var'>prev_ProcessUtility</span></a><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN239"><span class='Ref_to_Global_Var'>prev_ProcessUtility</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_stat_statements.c.html#LN959"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../src/include/tcop/utility.h.html#LN37"><span class='Ref_to_Proto'>standard_ProcessUtility</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN958"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                    <a href="pg_stat_statements.c.html#LN959"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN960"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                    <a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN961"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pgss_ProcessUtility &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate hash value for a key 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN1075"></a><span class='Declare_Function'>pgss_hash_fn</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1077"></a>    <span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Declare_Local'>k</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1075"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../src/include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1077"><span class='Ref_To_Local'>k</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN130"><span class='Ref_to_Member'>userid</span></a><span class='Parentheses'>)</span> <span class='Operator'>^ 
</span>        <a href="../../src/include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1077"><span class='Ref_To_Local'>k</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN131"><span class='Ref_to_Member'>dbid</span></a><span class='Parentheses'>)</span> <span class='Operator'>^ 
</span>        <a href="../../src/include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1077"><span class='Ref_To_Local'>k</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN132"><span class='Ref_to_Member'>queryid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Compare two keys - zero means match 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1088"></a><span class='Declare_Function'>pgss_match_fn</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>key2</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>keysize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1090"></a>    <span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Declare_Local'>k1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1088"><span class='Ref_to_Parameter'>key1</span></a><span class='Delimiter'>; 
</span><a name="LN1091"></a>    <span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Declare_Local'>k2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1088"><span class='Ref_to_Parameter'>key2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1090"><span class='Ref_To_Local'>k1</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN130"><span class='Ref_to_Member'>userid</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN1091"><span class='Ref_To_Local'>k2</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN130"><span class='Ref_to_Member'>userid</span></a> <span class='Operator'>&& 
</span>        <a href="pg_stat_statements.c.html#LN1090"><span class='Ref_To_Local'>k1</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN131"><span class='Ref_to_Member'>dbid</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN1091"><span class='Ref_To_Local'>k2</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN131"><span class='Ref_to_Member'>dbid</span></a> <span class='Operator'>&& 
</span>        <a href="pg_stat_statements.c.html#LN1090"><span class='Ref_To_Local'>k1</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN132"><span class='Ref_to_Member'>queryid</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN1091"><span class='Ref_To_Local'>k2</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN132"><span class='Ref_to_Member'>queryid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given an arbitrarily long query string, produce a hash for the purposes of 
 * identifying the query, without normalizing constants.  Used when hashing 
 * utility statements. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN1107"></a><span class='Declare_Function'>pgss_hash_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../src/backend/access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>((</span><span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1107"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1107"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Store some statistics for a statement. 
 * 
 * If queryId is 0 then this is a utility statement and we should compute 
 * a suitable queryId internally. 
 * 
 * If jstate is not NULL then we're trying to create an entry for which 
 * we have no statistics as yet; we just want to record the normalized 
 * query string.  total_time, rows, bufusage are ignored in this case. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1123"></a><span class='Declare_Function'>pgss_store</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>queryId</span><span class='Delimiter'>, 
</span><a name="LN1124"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>query_location</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN1125"></a>           <span class='Keyword'>double </span><span class='Declare_Parameter'>total_time</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>rows</span><span class='Delimiter'>, 
</span><a name="LN1126"></a>           <span class='Keyword'>const </span><a href="../../src/include/executor/instrument.h.html#LN18"><span class='Ref_to_Struct'>BufferUsage</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bufusage</span><span class='Delimiter'>, 
</span><a name="LN1127"></a>           <a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1129"></a>    <a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN1130"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN1131"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>norm_query</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1132"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span> <span class='Operator'>= </span><a href="../../src/include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safety check... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>|| !</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Confine our attention to the relevant part of the string, if the query 
     * is a portion of a multi-statement source string. 
     * 
     * First apply starting offset, unless it's -1 (unknown). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_location</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_location</span></a> <span class='Operator'>&LT;= </span>strlen<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_location</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Length of 0 (or -1) means "rest of string" */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&LT;= </span>strlen<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If query location is unknown, distrust query_len as well */ 
</span>        <a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_location</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Discard leading and trailing whitespace, too.  Use scanner_isspace() 
     * not libc's isspace(), because we want to match the lexer's behavior. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../src/include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_location</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../src/include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For utility statements, we just hash the query string to get an ID. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>queryId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>queryId</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN305"><span class='Ref_to_Proto'>pgss_hash_string</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up key for hashtable search */ 
</span>    <a href="pg_stat_statements.c.html#LN1129"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN130"><span class='Ref_to_Member'>userid</span></a> <span class='Operator'>= </span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1129"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN131"><span class='Ref_to_Member'>dbid</span></a> <span class='Operator'>= </span><a href="../../src/backend/utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1129"><span class='Ref_To_Local'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN132"><span class='Ref_to_Member'>queryid</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>queryId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lookup the hash table entry with shared lock. */ 
</span>    <a href="../../src/include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lwlock.h.html#LN134"><span class='Ref_to_EnumConst'>LW_SHARED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN1130"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1129"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create new entry, if not present */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN1130"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1191"></a>        <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>query_offset</span><span class='Delimiter'>; 
</span><a name="LN1192"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>gc_count</span><span class='Delimiter'>; 
</span><a name="LN1193"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>stored</span><span class='Delimiter'>; 
</span><a name="LN1194"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>do_gc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Create a new, normalized query string if caller asked.  We don't 
         * need to hold the lock while doing this work.  (Note: in any case, 
         * it's possible that someone else creates a duplicate hashtable entry 
         * in the interval where we don't hold the lock below.  That case is 
         * handled by entry_alloc.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1127"><span class='Ref_to_Parameter'>jstate</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN332"><span class='Ref_to_Proto'>generate_normalized_query</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1127"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, 
</span>                                                   <a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_location</span></a><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Delimiter'>, 
</span>                                                   <a href="pg_stat_statements.c.html#LN1132"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lwlock.h.html#LN134"><span class='Ref_to_EnumConst'>LW_SHARED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Append new query text to file with only shared lock held */ 
</span>        <a href="pg_stat_statements.c.html#LN1193"><span class='Ref_To_Local'>stored</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN318"><span class='Ref_to_Proto'>qtext_store</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>: </span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1191"><span class='Ref_To_Local'>query_offset</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1192"><span class='Ref_To_Local'>gc_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Determine whether we need to garbage collect external query texts 
         * while the shared lock is still held.  This micro-optimization 
         * avoids taking the time to decide this while holding exclusive lock. 
         */ 
</span>        <a href="pg_stat_statements.c.html#LN1194"><span class='Ref_To_Local'>do_gc</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN323"><span class='Ref_to_Proto'>need_gc_qtexts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Need exclusive lock to make a new hashtable entry - promote */ 
</span>        <a href="../../src/include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lwlock.h.html#LN133"><span class='Ref_to_EnumConst'>LW_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A garbage collection may have occurred while we weren't holding the 
         * lock.  In the unlikely event that this happens, the query text we 
         * stored above will have been garbage collected, so write it again. 
         * This should be infrequent enough that doing it while holding 
         * exclusive lock isn't a performance problem. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN1193"><span class='Ref_To_Local'>stored</span></a> <span class='Operator'>|| </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN190"><span class='Ref_to_Member'>gc_count</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1192"><span class='Ref_To_Local'>gc_count</span></a><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1193"><span class='Ref_To_Local'>stored</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN318"><span class='Ref_to_Proto'>qtext_store</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>: </span><a href="pg_stat_statements.c.html#LN1123"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1191"><span class='Ref_To_Local'>query_offset</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If we failed to write to the text file, give up */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN1193"><span class='Ref_To_Local'>stored</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN1312"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* OK to create a new hashtable entry */ 
</span>        <a href="pg_stat_statements.c.html#LN1130"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN315"><span class='Ref_to_Proto'>entry_alloc</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1129"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1191"><span class='Ref_To_Local'>query_offset</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1124"><span class='Ref_to_Parameter'>query_len</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1132"><span class='Ref_To_Local'>encoding</span></a><span class='Delimiter'>, 
</span>                            <a href="pg_stat_statements.c.html#LN1127"><span class='Ref_to_Parameter'>jstate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If needed, perform garbage collection while exclusive lock held */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1194"><span class='Ref_To_Local'>do_gc</span></a><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN324"><span class='Ref_to_Proto'>gc_qtexts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !entry &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Increment the counts, except when jstate is not NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN1127"><span class='Ref_to_Parameter'>jstate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Grab the spinlock while updating the counters (see comment about 
         * locking rules at the head of the file) 
         */ 
</span><a name="LN1259"></a>        <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>e</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1130"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN176"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* "Unstick" entry if it was previously sticky */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN159"><span class='Ref_to_Member'>usage</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN104"><span class='Ref_to_Const'>USAGE_INIT</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN141"><span class='Ref_to_Member'>total_time</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN142"><span class='Ref_to_Member'>min_time</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN143"><span class='Ref_to_Member'>max_time</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN144"><span class='Ref_to_Member'>mean_time</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Welford's method for accurately computing variance. See 
             * &LT;http://www.johndcook.com/blog/standard_deviation/&GT; 
             */ 
</span><a name="LN1281"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>old_mean</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN144"><span class='Ref_to_Member'>mean_time</span></a><span class='Delimiter'>; 
</span> 
            <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN144"><span class='Ref_to_Member'>mean_time</span></a> <span class='Operator'>+= 
</span>                <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN1281"><span class='Ref_To_Local'>old_mean</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN145"><span class='Ref_to_Member'>sum_var_time</span></a> <span class='Operator'>+= 
</span>                <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN1281"><span class='Ref_To_Local'>old_mean</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN144"><span class='Ref_to_Member'>mean_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* calculate min and max time */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN142"><span class='Ref_to_Member'>min_time</span></a> <span class='Operator'>&GT; </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN142"><span class='Ref_to_Member'>min_time</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN143"><span class='Ref_to_Member'>max_time</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN143"><span class='Ref_to_Member'>max_time</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN146"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>rows</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN147"><span class='Ref_to_Member'>shared_blks_hit</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN20"><span class='Ref_to_Member'>shared_blks_hit</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN148"><span class='Ref_to_Member'>shared_blks_read</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN21"><span class='Ref_to_Member'>shared_blks_read</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN149"><span class='Ref_to_Member'>shared_blks_dirtied</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN22"><span class='Ref_to_Member'>shared_blks_dirtied</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN150"><span class='Ref_to_Member'>shared_blks_written</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN23"><span class='Ref_to_Member'>shared_blks_written</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN151"><span class='Ref_to_Member'>local_blks_hit</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN24"><span class='Ref_to_Member'>local_blks_hit</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN152"><span class='Ref_to_Member'>local_blks_read</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN25"><span class='Ref_to_Member'>local_blks_read</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN153"><span class='Ref_to_Member'>local_blks_dirtied</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN26"><span class='Ref_to_Member'>local_blks_dirtied</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN154"><span class='Ref_to_Member'>local_blks_written</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN27"><span class='Ref_to_Member'>local_blks_written</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN155"><span class='Ref_to_Member'>temp_blks_read</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN28"><span class='Ref_to_Member'>temp_blks_read</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN156"><span class='Ref_to_Member'>temp_blks_written</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN29"><span class='Ref_to_Member'>temp_blks_written</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN157"><span class='Ref_to_Member'>blk_read_time</span></a> <span class='Operator'>+= </span><a href="../../src/include/portability/instr_time.h.html#LN134"><span class='Ref_to_Macro'>INSTR_TIME_GET_MILLISEC</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN30"><span class='Ref_to_Member'>blk_read_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN158"><span class='Ref_to_Member'>blk_write_time</span></a> <span class='Operator'>+= </span><a href="../../src/include/portability/instr_time.h.html#LN134"><span class='Ref_to_Macro'>INSTR_TIME_GET_MILLISEC</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1126"><span class='Ref_to_Parameter'>bufusage</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN31"><span class='Ref_to_Member'>blk_write_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN159"><span class='Ref_to_Member'>usage</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN103"><span class='Ref_to_Macro'>USAGE_EXEC</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1125"><span class='Ref_to_Parameter'>total_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1259"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN176"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !jstate &raquo; </span> 
 
<a name="LN1312"></a><span class='Label'>done</span><span class='Operator'>: 
</span>    <a href="../../src/include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We postpone this clean-up until we're out of the lock */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1131"><span class='Ref_To_Local'>norm_query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgss_store &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Reset all statement statistics. 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1324"></a><span class='Declare_Function'>pg_stat_statements_reset</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>|| !</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements must be loaded via shared_preload_libraries"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN325"><span class='Ref_to_Proto'>entry_reset</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Number of output arguments (columns) for various API versions */ 
</span><a name="LN1335"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_STAT_STATEMENTS_COLS_V1_0</span>    <span class='Number'>14</span> 
<a name="LN1336"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_STAT_STATEMENTS_COLS_V1_1</span>    <span class='Number'>18</span> 
<a name="LN1337"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_STAT_STATEMENTS_COLS_V1_2</span>    <span class='Number'>19</span> 
<a name="LN1338"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_STAT_STATEMENTS_COLS_V1_3</span>    <span class='Number'>23</span> 
<a name="LN1339"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_STAT_STATEMENTS_COLS</span>         <span class='Number'>23</span>      <span class='Comment_Single_Line'>/* maximum of above */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Retrieve statement statistics. 
 * 
 * The SQL API of this function has changed multiple times, and will likely 
 * do so again in future.  To support the case where a newer version of this 
 * loadable module is being used with an old SQL declaration of the function, 
 * we continue to support the older API versions.  For 1.2 and later, the 
 * expected API version is identified by embedding it in the C name of the 
 * function.  Unfortunately we weren't bright enough to do that for 1.1. 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1352"></a><span class='Declare_Function'>pg_stat_statements_1_3</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1354"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>showtext</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN311"><span class='Ref_to_Proto'>pg_stat_statements_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN121"><span class='Ref_to_EnumConst'>PGSS_V1_3</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1354"><span class='Ref_To_Local'>showtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1362"></a><span class='Declare_Function'>pg_stat_statements_1_2</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1364"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>showtext</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN311"><span class='Ref_to_Proto'>pg_stat_statements_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN120"><span class='Ref_to_EnumConst'>PGSS_V1_2</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1364"><span class='Ref_To_Local'>showtext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Legacy entry point for pg_stat_statements() API versions 1.0 and 1.1. 
 * This can be removed someday, perhaps. 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1376"></a><span class='Declare_Function'>pg_stat_statements</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* If it's really API 1.1, we'll figure that out below */ 
</span>    <a href="pg_stat_statements.c.html#LN311"><span class='Ref_to_Proto'>pg_stat_statements_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN118"><span class='Ref_to_EnumConst'>PGSS_V1_0</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Common code for all versions of pg_stat_statements() */ 
</span><span class='Keyword'>static void 
</span><a name="LN1386"></a><span class='Declare_Function'>pg_stat_statements_internal</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, 
</span><a name="LN1387"></a>                            <a href="pg_stat_statements.c.html#LN116"><span class='Ref_to_Enum'>pgssVersion</span></a> <span class='Declare_Parameter'>api_version</span><span class='Delimiter'>, 
</span><a name="LN1388"></a>                            <span class='Keyword'>bool </span><span class='Declare_Parameter'>showtext</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1390"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1386"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>; 
</span><a name="LN1391"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1392"></a>    <a href="../../src/backend/utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupstore</span><span class='Delimiter'>; 
</span><a name="LN1393"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_query_ctx</span><span class='Delimiter'>; 
</span><a name="LN1394"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1395"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>userid</span> <span class='Operator'>= </span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_allowed_role</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1397"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qbuffer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1398"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>qbuffer_size</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1399"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>extent</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1400"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>gc_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1401"></a>    <a href="../../src/include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>hash_seq</span><span class='Delimiter'>; 
</span><a name="LN1402"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers or members of pg_read_all_stats members are allowed */ 
</span>    <a href="pg_stat_statements.c.html#LN1396"><span class='Ref_To_Local'>is_allowed_role</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/acl.h.html#LN230"><span class='Ref_to_Proto'>is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../src/include/catalog/pg_authid.h.html#LN107"><span class='Ref_to_Const'>DEFAULT_ROLE_READ_ALL_STATS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* hash table must exist already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a> <span class='Operator'>|| !</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_stat_statements must be loaded via shared_preload_libraries"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../src/include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not "</span> <span class='Operator'>\ 
</span>                        <span class='String'>"allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Switch into long-lived context to construct returned data structures */ 
</span>    <a href="pg_stat_statements.c.html#LN1393"><span class='Ref_To_Local'>per_query_ctx</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1394"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1393"><span class='Ref_To_Local'>per_query_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1386"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1391"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check we have the expected number of output arguments.  Aside from 
     * being a good safety check, we need a kluge here to detect API version 
     * 1.1, which was wedged into the code in an ill-considered way. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1391"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pg_stat_statements.c.html#LN1335"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_0</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN118"><span class='Ref_to_EnumConst'>PGSS_V1_0</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"incorrect number of output arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_stat_statements.c.html#LN1336"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_1</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* pg_stat_statements() should have told us 1.0 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN118"><span class='Ref_to_EnumConst'>PGSS_V1_0</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"incorrect number of output arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN119"><span class='Ref_to_EnumConst'>PGSS_V1_1</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_stat_statements.c.html#LN1337"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_2</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN120"><span class='Ref_to_EnumConst'>PGSS_V1_2</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"incorrect number of output arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="pg_stat_statements.c.html#LN1338"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_3</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN121"><span class='Ref_to_EnumConst'>PGSS_V1_3</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"incorrect number of output arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"incorrect number of output arguments"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tupdesc-&GT;natts &raquo; </span> 
 
    <a href="pg_stat_statements.c.html#LN1392"><span class='Ref_To_Local'>tupstore</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../../src/backend/utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1392"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1390"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1391"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1394"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'd like to load the query text file (if needed) while not holding any 
     * lock on pgss-&GT;lock.  In the worst case we'll have to do this again 
     * after we have the lock, but it's unlikely enough to make this a win 
     * despite occasional duplicated work.  We need to reload if anybody 
     * writes to the file (either a retail qtext_store(), or a garbage 
     * collection) between this point and where we've gotten shared lock.  If 
     * a qtext_store is actually in progress when we look, we might as well 
     * skip the speculative load entirely. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1388"><span class='Ref_to_Parameter'>showtext</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1480"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>n_writers</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Take the mutex so we can examine variables */ 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1484"></a>            <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1484"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1399"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1484"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1480"><span class='Ref_To_Local'>n_writers</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1484"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN189"><span class='Ref_to_Member'>n_writers</span></a><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1400"><span class='Ref_To_Local'>gc_count</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1484"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN190"><span class='Ref_to_Member'>gc_count</span></a><span class='Delimiter'>; 
</span>            <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1484"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* No point in loading file now if there are active writers */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1480"><span class='Ref_To_Local'>n_writers</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN320"><span class='Ref_to_Proto'>qtext_load_file</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1398"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get shared lock, load or reload the query text file if we must, and 
     * iterate over the hashtable entries. 
     * 
     * With a large hash table, we might be holding the lock rather longer 
     * than one could wish.  However, this only blocks creation of new hash 
     * table entries, and the larger the hash table the less likely that is to 
     * be needed.  So we can hope this is okay.  Perhaps someday we'll decide 
     * we need to partition the hash table to limit the time spent holding any 
     * one lock. 
     */ 
</span>    <a href="../../src/include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lwlock.h.html#LN134"><span class='Ref_to_EnumConst'>LW_SHARED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1388"><span class='Ref_to_Parameter'>showtext</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Here it is safe to examine extent and gc_count without taking the 
         * mutex.  Note that although other processes might change 
         * pgss-&GT;extent just after we look at it, the strings they then write 
         * into the file cannot yet be referenced in the hashtable, so we 
         * don't care whether we see them or not. 
         * 
         * If qtext_load_file fails, we just press on; we'll return NULL for 
         * every query text. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1399"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>|| 
</span>            <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN190"><span class='Ref_to_Member'>gc_count</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1400"><span class='Ref_To_Local'>gc_count</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN320"><span class='Ref_to_Proto'>qtext_load_file</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1398"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if showtext &raquo; </span> 
 
    <a href="../../src/include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1401"><span class='Ref_To_Local'>hash_seq</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1401"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1536"></a>        <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1339"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS</span></a><span class='Delimiter'>]; 
</span><a name="LN1537"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1339"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS</span></a><span class='Delimiter'>]; 
</span><a name="LN1538"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1539"></a>        <a href="pg_stat_statements.c.html#LN138"><span class='Ref_to_Struct'>Counters</span></a>    <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN1540"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>stddev</span><span class='Delimiter'>; 
</span><a name="LN1541"></a>        <a href="../../src/include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>queryid</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN132"><span class='Ref_to_Member'>queryid</span></a><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN130"><span class='Ref_to_Member'>userid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN131"><span class='Ref_to_Member'>dbid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1396"><span class='Ref_To_Local'>is_allowed_role</span></a> <span class='Operator'>|| </span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN130"><span class='Ref_to_Member'>userid</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN1395"><span class='Ref_To_Local'>userid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN120"><span class='Ref_to_EnumConst'>PGSS_V1_2</span></a><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1541"><span class='Ref_To_Local'>queryid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1388"><span class='Ref_to_Parameter'>showtext</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1556"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qstr</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN321"><span class='Ref_to_Proto'>qtext_fetch</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a><span class='Delimiter'>, 
</span>                                               <a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a><span class='Delimiter'>, 
</span>                                               <a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a><span class='Delimiter'>, 
</span>                                               <a href="pg_stat_statements.c.html#LN1398"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1556"><span class='Ref_To_Local'>qstr</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1563"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>enc</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_stat_statements.c.html#LN1563"><span class='Ref_To_Local'>enc</span></a> <span class='Operator'>= </span><a href="../../src/include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1556"><span class='Ref_To_Local'>qstr</span></a><span class='Delimiter'>, 
</span>                                           <a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a><span class='Delimiter'>, 
</span>                                           <a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN175"><span class='Ref_to_Member'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1563"><span class='Ref_To_Local'>enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1563"><span class='Ref_To_Local'>enc</span></a> <span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1556"><span class='Ref_To_Local'>qstr</span></a><span class='Parentheses'>) 
</span>                        <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1563"><span class='Ref_To_Local'>enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Just return a null if we fail to find the text */ 
</span>                    <a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if showtext &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Query text not requested */ 
</span>                <a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_allowed_role||entr... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Don't show queryid */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN120"><span class='Ref_to_EnumConst'>PGSS_V1_2</span></a><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Don't show query text, but hint as to the reason for not doing 
             * so if it was requested 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1388"><span class='Ref_to_Parameter'>showtext</span></a><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"&LT;insufficient privilege&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* copy counters to a local variable to keep locking time short */ 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1604"></a>            <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>e</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1402"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1604"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN176"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1604"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Delimiter'>; 
</span>            <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1604"><span class='Ref_To_Local'>e</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN176"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Skip entry if unexecuted (ie, it's a pending "sticky" entry) */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN141"><span class='Ref_to_Member'>total_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN121"><span class='Ref_to_EnumConst'>PGSS_V1_3</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN142"><span class='Ref_to_Member'>min_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN143"><span class='Ref_to_Member'>max_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN144"><span class='Ref_to_Member'>mean_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Note we are calculating the population variance here, not the 
             * sample variance, as we have data for the whole population, so 
             * Bessel's correction is not used, and we don't divide by 
             * tmp.calls - 1. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="pg_stat_statements.c.html#LN1540"><span class='Ref_To_Local'>stddev</span></a> <span class='Operator'>= </span>sqrt<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN145"><span class='Ref_to_Member'>sum_var_time</span></a> <span class='Operator'>/ </span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="pg_stat_statements.c.html#LN1540"><span class='Ref_To_Local'>stddev</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1540"><span class='Ref_To_Local'>stddev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN146"><span class='Ref_to_Member'>rows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN147"><span class='Ref_to_Member'>shared_blks_hit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN148"><span class='Ref_to_Member'>shared_blks_read</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN119"><span class='Ref_to_EnumConst'>PGSS_V1_1</span></a><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN149"><span class='Ref_to_Member'>shared_blks_dirtied</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN150"><span class='Ref_to_Member'>shared_blks_written</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN151"><span class='Ref_to_Member'>local_blks_hit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN152"><span class='Ref_to_Member'>local_blks_read</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN119"><span class='Ref_to_EnumConst'>PGSS_V1_1</span></a><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN153"><span class='Ref_to_Member'>local_blks_dirtied</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN154"><span class='Ref_to_Member'>local_blks_written</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN155"><span class='Ref_to_Member'>temp_blks_read</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN156"><span class='Ref_to_Member'>temp_blks_written</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN119"><span class='Ref_to_EnumConst'>PGSS_V1_1</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN157"><span class='Ref_to_Member'>blk_read_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN778"><span class='Ref_to_Macro'>Float8GetDatumFast</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1539"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN158"><span class='Ref_to_Member'>blk_write_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1538"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN118"><span class='Ref_to_EnumConst'>PGSS_V1_0</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN1335"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_0</span></a> <span class='Operator'>: 
</span>                     <a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN119"><span class='Ref_to_EnumConst'>PGSS_V1_1</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN1336"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_1</span></a> <span class='Operator'>: 
</span>                     <a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN120"><span class='Ref_to_EnumConst'>PGSS_V1_2</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN1337"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_2</span></a> <span class='Operator'>: 
</span>                     <a href="pg_stat_statements.c.html#LN1387"><span class='Ref_to_Parameter'>api_version</span></a> <span class='Operator'>== </span><a href="pg_stat_statements.c.html#LN121"><span class='Ref_to_EnumConst'>PGSS_V1_3</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN1338"><span class='Ref_to_Const'>PG_STAT_STATEMENTS_COLS_V1_3</span></a> <span class='Operator'>: 
</span>                     <span class='Operator'>-</span><span class='Number'>1</span> <span class='Comment_Multi_Line'>/* fail if you forget to update this assert */ </span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1392"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1391"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1536"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1537"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (entry=hash_seq_searc... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* clean up and return the tuplestore */ 
</span>    <a href="../../src/include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1397"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/tuplestore.h.html#LN59"><span class='Ref_to_Macro'>tuplestore_donestoring</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1392"><span class='Ref_To_Local'>tupstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_stat_statements_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate shared memory space needed. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> 
<a name="LN1676"></a><span class='Declare_Function'>pgss_memsize</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1678"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN1678"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="../../src/include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1678"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/shmem.h.html#LN44"><span class='Ref_to_Proto'>add_size</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1678"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/hsearch.h.html#LN138"><span class='Ref_to_Proto'>hash_estimate_size</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_stat_statements.c.html#LN1678"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Allocate a new hashtable entry. 
 * caller must hold an exclusive lock on pgss-&GT;lock 
 * 
 * "query" need not be null-terminated; we rely on query_len instead 
 * 
 * If "sticky" is true, make the new entry artificially sticky so that it will 
 * probably still be there when the query finishes execution.  We do this by 
 * giving it a median usage value rather than the normal value.  (Strictly 
 * speaking, query strings are normalized on a best effort basis, though it 
 * would be difficult to demonstrate this even under artificial conditions.) 
 * 
 * Note: despite needing exclusive lock, it's not an error for the target 
 * entry to already exist.  This is because pgss_store releases and 
 * reacquires lock after failing to find a match; so someone else could 
 * have made the entry while we waited to get exclusive lock. 
 */ 
</span><span class='Keyword'>static </span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>* 
</span><a name="LN1704"></a><span class='Declare_Function'>entry_alloc</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN128"><span class='Ref_to_Struct'>pgssHashKey</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>query_offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Delimiter'>, 
</span><a name="LN1705"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>sticky</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1707"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN1708"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make space if needed */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../src/include/utils/hsearch.h.html#LN133"><span class='Ref_to_Proto'>hash_get_num_entries</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a><span class='Parentheses'>)</span> 
        <a href="pg_stat_statements.c.html#LN317"><span class='Ref_to_Proto'>entry_dealloc</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find or create an entry with desired hash code */ 
</span>    <a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1704"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1708"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN1708"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* New entry, initialize it */ 
</span> 
        <span class='Comment_Multi_Line'>/* reset the statistics */ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN138"><span class='Ref_to_Struct'>Counters</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* set the appropriate initial usage count */ 
</span>        <a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN159"><span class='Ref_to_Member'>usage</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1705"><span class='Ref_to_Parameter'>sticky</span></a> <span class='Operator'>? </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN185"><span class='Ref_to_Member'>cur_median_usage</span></a> <span class='Operator'>: </span><a href="pg_stat_statements.c.html#LN104"><span class='Ref_to_Const'>USAGE_INIT</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* re-initialize the mutex each time ... we assume no one using it */ 
</span>        <a href="../../src/include/storage/spin.h.html#LN59"><span class='Ref_to_Macro'>SpinLockInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN176"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* ... and don't forget the query text metadata */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1704"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1704"><span class='Ref_to_Parameter'>query_offset</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1704"><span class='Ref_to_Parameter'>query_len</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN175"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1704"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_stat_statements.c.html#LN1707"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end entry_alloc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * qsort comparator for sorting into increasing usage order 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1741"></a><span class='Declare_Function'>entry_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>lhs</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>rhs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1743"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>l_usage</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1741"><span class='Ref_to_Parameter'>lhs</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>counters<span class='Operator'>.</span>usage<span class='Delimiter'>; 
</span><a name="LN1744"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>r_usage</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN1741"><span class='Ref_to_Parameter'>rhs</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>counters<span class='Operator'>.</span>usage<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1743"><span class='Ref_To_Local'>l_usage</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN1744"><span class='Ref_To_Local'>r_usage</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1743"><span class='Ref_To_Local'>l_usage</span></a> <span class='Operator'>&GT; </span><a href="pg_stat_statements.c.html#LN1744"><span class='Ref_To_Local'>r_usage</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>+</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Deallocate least-used entries. 
 * 
 * Caller must hold an exclusive lock on pgss-&GT;lock. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1760"></a><span class='Declare_Function'>entry_dealloc</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1762"></a>    <a href="../../src/include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>hash_seq</span><span class='Delimiter'>; 
</span><a name="LN1763"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>**</span><span class='Declare_Local'>entries</span><span class='Delimiter'>; 
</span><a name="LN1764"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN1765"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nvictims</span><span class='Delimiter'>; 
</span><a name="LN1766"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1767"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tottextlen</span><span class='Delimiter'>; 
</span><a name="LN1768"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nvalidtexts</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sort entries by usage and deallocate USAGE_DEALLOC_PERCENT of them. 
     * While we're scanning the table, apply the decay factor to the usage 
     * values, and update the mean query length. 
     * 
     * Note that the mean query length is almost immediately obsolete, since 
     * we compute it before not after discarding the least-used entries. 
     * Hopefully, that doesn't affect the mean too much; it doesn't seem worth 
     * making two passes to get a more current result.  Likewise, the new 
     * cur_median_usage includes the entries we're about to zap. 
     */ 
</span> 
    <a href="pg_stat_statements.c.html#LN1763"><span class='Ref_To_Local'>entries</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/hsearch.h.html#LN133"><span class='Ref_to_Proto'>hash_get_num_entries</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1767"><span class='Ref_To_Local'>tottextlen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1768"><span class='Ref_To_Local'>nvalidtexts</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1762"><span class='Ref_To_Local'>hash_seq</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1762"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_stat_statements.c.html#LN1763"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* "Sticky" entries get a different usage decay rate. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN140"><span class='Ref_to_Member'>calls</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN159"><span class='Ref_to_Member'>usage</span></a> <span class='Operator'>*= </span><a href="pg_stat_statements.c.html#LN108"><span class='Ref_to_Const'>STICKY_DECREASE_FACTOR</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN159"><span class='Ref_to_Member'>usage</span></a> <span class='Operator'>*= </span><a href="pg_stat_statements.c.html#LN107"><span class='Ref_to_Const'>USAGE_DECREASE_FACTOR</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* In the mean length computation, ignore dropped texts. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN1767"><span class='Ref_To_Local'>tottextlen</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1764"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN1768"><span class='Ref_To_Local'>nvalidtexts</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Sort into increasing order by usage */ 
</span>    <a href="../../src/include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1763"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1740"><span class='Ref_to_Func'>entry_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Record the (approximate) median usage */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN185"><span class='Ref_to_Member'>cur_median_usage</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1763"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN172"><span class='Ref_to_Member'>counters</span></a><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN159"><span class='Ref_to_Member'>usage</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Record the mean query length */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1768"><span class='Ref_To_Local'>nvalidtexts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1767"><span class='Ref_To_Local'>tottextlen</span></a> <span class='Operator'>/ </span><a href="pg_stat_statements.c.html#LN1768"><span class='Ref_To_Local'>nvalidtexts</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN106"><span class='Ref_to_Const'>ASSUMED_LENGTH_INIT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now zap an appropriate fraction of lowest-usage entries */ 
</span>    <a href="pg_stat_statements.c.html#LN1765"><span class='Ref_To_Local'>nvictims</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><span class='Number'>10</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><a href="pg_stat_statements.c.html#LN109"><span class='Ref_to_Const'>USAGE_DEALLOC_PERCENT</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN1765"><span class='Ref_To_Local'>nvictims</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1765"><span class='Ref_To_Local'>nvictims</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN1765"><span class='Ref_To_Local'>nvictims</span></a><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1763"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN1766"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/hsearch.h.html#LN106"><span class='Ref_to_EnumConst'>HASH_REMOVE</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1763"><span class='Ref_To_Local'>entries</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end entry_dealloc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a query string (not necessarily null-terminated), allocate a new 
 * entry in the external query text file and store the string there. 
 * 
 * If successful, returns true, and stores the new entry's offset in the file 
 * into *query_offset.  Also, if gc_count isn't NULL, *gc_count is set to the 
 * number of garbage collections that have occurred so far. 
 * 
 * On failure, returns false. 
 * 
 * At least a shared lock on pgss-&GT;lock must be held by the caller, so as 
 * to prevent a concurrent garbage collection.  Share-lock-holding callers 
 * should pass a gc_count pointer to obtain the number of garbage collections, 
 * so that they can recheck the count after obtaining exclusive lock to 
 * detect whether a garbage collection occurred (and removed this entry). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1846"></a><span class='Declare_Function'>qtext_store</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN1847"></a>            <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query_offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>gc_count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1849"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>off</span><span class='Delimiter'>; 
</span><a name="LN1850"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use a spinlock to protect extent/n_writers/gc_count, so that 
     * multiple processes may execute this function concurrently. 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1857"></a>        <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1857"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1849"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1857"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1857"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN1846"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1857"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN189"><span class='Ref_to_Member'>n_writers</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1847"><span class='Ref_to_Parameter'>gc_count</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="pg_stat_statements.c.html#LN1847"><span class='Ref_to_Parameter'>gc_count</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1857"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN190"><span class='Ref_to_Member'>gc_count</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1857"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="pg_stat_statements.c.html#LN1847"><span class='Ref_to_Parameter'>query_offset</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1849"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now write the data into the successfully-reserved part of the file */ 
</span>    <a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN96"><span class='Ref_to_Proto'>OpenTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Delimiter'>, </span>O_RDWR <span class='Operator'>| </span>O_CREAT <span class='Operator'>| </span><a href="../../src/include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, 
</span>                           <a href="../../src/include/port/win32.h.html#LN424"><span class='Ref_to_Const'>S_IRUSR</span></a> <span class='Operator'>| </span><a href="../../src/include/port/win32.h.html#LN425"><span class='Ref_to_Const'>S_IWUSR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN1897"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>lseek<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1849"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span>SEEK_SET<span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1849"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN1897"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1846"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1846"><span class='Ref_to_Parameter'>query_len</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1846"><span class='Ref_to_Parameter'>query_len</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN1897"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/win32.h.html#LN13"><span class='Ref_to_Macro'>write</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><span class='String'>"\0"</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN1897"><span class='Ref_to_Label'>error</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/storage/fd.h.html#LN97"><span class='Ref_to_Proto'>CloseTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark our write complete */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1888"></a>        <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1888"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1888"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN189"><span class='Ref_to_Member'>n_writers</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1888"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
<a name="LN1897"></a><span class='Label'>error</span><span class='Operator'>: 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                    <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/storage/fd.h.html#LN97"><span class='Ref_to_Proto'>CloseTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1850"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark our write complete */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1908"></a>        <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1908"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN1908"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN189"><span class='Ref_to_Member'>n_writers</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1908"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end qtext_store &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the external query text file into a malloc'd buffer. 
 * 
 * Returns NULL (without throwing an error) if unable to read, eg 
 * file not there or insufficient memory. 
 * 
 * On success, the buffer size is also returned into *buffer_size. 
 * 
 * This can be called without any lock on pgss-&GT;lock, but in that case 
 * the caller is responsible for verifying that the result is sane. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1930"></a><span class='Declare_Function'>qtext_load_file</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buffer_size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1932"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1933"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fd</span><span class='Delimiter'>; 
</span><a name="LN1934"></a>    <span class='Control'>struct</span> <a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a> <span class='Declare_Local'>stat</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN96"><span class='Ref_to_Proto'>OpenTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Delimiter'>, </span>O_RDONLY <span class='Operator'>| </span><a href="../../src/include/c.h.html#LN1032"><span class='Ref_to_Const'>PG_BINARY</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span>ENOENT<span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                   <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                          <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get file length */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fstat<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/fd.h.html#LN97"><span class='Ref_to_Proto'>CloseTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate buffer; beware that off_t might be wider than size_t */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>.</span>st_size <span class='Operator'>&LT;= </span><a href="../../src/include/utils/memutils.h.html#LN43"><span class='Ref_to_Const'>MaxAllocHugeSize</span></a><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN1932"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>.</span>st_size<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_stat_statements.c.html#LN1932"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1932"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Could not allocate enough memory to read pg_stat_statement file \"%s\"."</span><span class='Delimiter'>, 
</span>                           <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/fd.h.html#LN97"><span class='Ref_to_Proto'>CloseTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, slurp in the file.  If we get a short read and errno doesn't get 
     * set, the reason is probably that garbage collection truncated the file 
     * since we did the fstat(), so we don't log a complaint --- but we don't 
     * return the data, either, since it's most likely corrupt due to 
     * concurrent writes from garbage collection. 
     */ 
</span>    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/win32.h.html#LN12"><span class='Ref_to_Macro'>read</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1932"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>.</span>st_size<span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>.</span>st_size<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno<span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                   <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                          <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1932"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/fd.h.html#LN97"><span class='Ref_to_Proto'>CloseTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/include/storage/fd.h.html#LN97"><span class='Ref_to_Proto'>CloseTransientFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN1933"><span class='Ref_To_Local'>fd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pg_stat_statements.c.html#LN1930"><span class='Ref_to_Parameter'>buffer_size</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN1934"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>.</span>st_size<span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_stat_statements.c.html#LN1932"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end qtext_load_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Locate a query text in the file image previously read by qtext_load_file(). 
 * 
 * We validate the given offset/length, and return NULL if bogus.  Otherwise, 
 * the result points to a null-terminated string within the buffer. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2007"></a><span class='Declare_Function'>qtext_fetch</span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>query_offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>query_len</span><span class='Delimiter'>, 
</span><a name="LN2008"></a>            <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>buffer_size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* File read failed? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2008"><span class='Ref_to_Parameter'>buffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Bogus offset/length? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2007"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="pg_stat_statements.c.html#LN2007"><span class='Ref_to_Parameter'>query_offset</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2007"><span class='Ref_to_Parameter'>query_len</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN2008"><span class='Ref_to_Parameter'>buffer_size</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* As a further sanity check, make sure there's a trailing null */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2008"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN2007"><span class='Ref_to_Parameter'>query_offset</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2007"><span class='Ref_to_Parameter'>query_len</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Looks OK */ 
</span>    <span class='Control'>return</span> <a href="pg_stat_statements.c.html#LN2008"><span class='Ref_to_Parameter'>buffer</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2007"><span class='Ref_to_Parameter'>query_offset</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Do we need to garbage-collect the external query text file? 
 * 
 * Caller should hold at least a shared lock on pgss-&GT;lock. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2030"></a><span class='Declare_Function'>need_gc_qtexts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2032"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>extent</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Read shared extent pointer */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2036"></a>        <span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>volatile </span><a href="pg_stat_statements.c.html#LN182"><span class='Ref_to_Struct'>pgssSharedState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/storage/spin.h.html#LN61"><span class='Ref_to_Macro'>SpinLockAcquire</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2036"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2032"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2036"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/storage/spin.h.html#LN63"><span class='Ref_to_Macro'>SpinLockRelease</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2036"><span class='Ref_To_Local'>s</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN187"><span class='Ref_to_Member'>mutex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Don't proceed if file does not exceed 512 bytes per possible entry */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2032"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>&LT; </span><span class='Number'>512</span> <span class='Operator'>* </span><a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Don't proceed if file is less than about 50% bloat.  Nothing can or 
     * should be done in the event of unusually large query texts accounting 
     * for file's large size.  We go to the trouble of maintaining the mean 
     * query length in order to prevent garbage collection from thrashing 
     * uselessly. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2032"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>* </span><a href="pg_stat_statements.c.html#LN262"><span class='Ref_to_Global_Var'>pgss_max</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end need_gc_qtexts &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Garbage-collect orphaned query texts in external file. 
 * 
 * This won't be called often in the typical case, since it's likely that 
 * there won't be too much churn, and besides, a similar compaction process 
 * occurs when serializing to disk at shutdown or as part of resetting. 
 * Despite this, it seems prudent to plan for the edge case where the file 
 * becomes unreasonably large, with no other method of compaction likely to 
 * occur in the foreseeable future. 
 * 
 * The caller must hold an exclusive lock on pgss-&GT;lock. 
 * 
 * At the first sign of trouble we unlink the query text file to get a clean 
 * slate (although existing statistics are retained), rather than risk 
 * thrashing by allowing the same problem case to recur indefinitely. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2077"></a><span class='Declare_Function'>gc_qtexts</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2079"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qbuffer</span><span class='Delimiter'>; 
</span><a name="LN2080"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>qbuffer_size</span><span class='Delimiter'>; 
</span><a name="LN2081"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>qfile</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2082"></a>    <a href="../../src/include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>hash_seq</span><span class='Delimiter'>; 
</span><a name="LN2083"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN2084"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>extent</span><span class='Delimiter'>; 
</span><a name="LN2085"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nentries</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When called from pgss_store, some other session might have proceeded 
     * with garbage collection in the no-lock-held interim of lock strength 
     * escalation.  Check once more that this is actually necessary. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_stat_statements.c.html#LN323"><span class='Ref_to_Proto'>need_gc_qtexts</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Load the old texts file.  If we fail (out of memory, for instance), 
     * invalidate query texts.  Hopefully this is rare.  It might seem better 
     * to leave things alone on an OOM failure, but the problem is that the 
     * file is only going to get bigger; hoping for a future non-OOM result is 
     * risky and can easily lead to complete denial of service. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN2079"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN320"><span class='Ref_to_Proto'>qtext_load_file</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2080"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2079"><span class='Ref_To_Local'>qbuffer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN2206"><span class='Ref_to_Label'>gc_fail</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We overwrite the query texts file in place, so as to reduce the risk of 
     * an out-of-disk-space failure.  Since the file is guaranteed not to get 
     * larger, this should always work on traditional filesystems; though we 
     * could still lose on copy-on-write filesystems. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN2206"><span class='Ref_to_Label'>gc_fail</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN2085"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2082"><span class='Ref_To_Local'>hash_seq</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2082"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2128"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>query_len</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a><span class='Delimiter'>; 
</span><a name="LN2129"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qry</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN321"><span class='Ref_to_Proto'>qtext_fetch</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a><span class='Delimiter'>, 
</span>                                      <a href="pg_stat_statements.c.html#LN2128"><span class='Ref_To_Local'>query_len</span></a><span class='Delimiter'>, 
</span>                                      <a href="pg_stat_statements.c.html#LN2079"><span class='Ref_To_Local'>qbuffer</span></a><span class='Delimiter'>, 
</span>                                      <a href="pg_stat_statements.c.html#LN2080"><span class='Ref_To_Local'>qbuffer_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2129"><span class='Ref_To_Local'>qry</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Trouble ... drop the text */ 
</span>            <a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* entry will not be counted in mean query length computation */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2129"><span class='Ref_To_Local'>qry</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2128"><span class='Ref_To_Local'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_stat_statements.c.html#LN2128"><span class='Ref_To_Local'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                  <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                         <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/utils/hsearch.h.html#LN136"><span class='Ref_to_Proto'>hash_seq_term</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2082"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN2206"><span class='Ref_to_Label'>gc_fail</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN2128"><span class='Ref_To_Local'>query_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2085"><span class='Ref_To_Local'>nentries</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (entry=hash_seq_searc... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Truncate away any now-unused space.  If this fails for some odd reason, 
     * we log it, but there's no need to fail. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/port/win32.h.html#LN58"><span class='Ref_to_Macro'>ftruncate</span></a><span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>               <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not truncate pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                      <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN2206"><span class='Ref_to_Label'>gc_fail</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"pgss gc of queries file shrunk size from %zu to %zu"</span><span class='Delimiter'>, 
</span>         <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset the shared extent pointer */ 
</span>    <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also update the mean query length, to be sure that need_gc_qtexts() 
     * won't still think we have a problem. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2085"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2084"><span class='Ref_To_Local'>extent</span></a> <span class='Operator'>/ </span><a href="pg_stat_statements.c.html#LN2085"><span class='Ref_To_Local'>nentries</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN106"><span class='Ref_to_Const'>ASSUMED_LENGTH_INIT</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2079"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, count a garbage collection cycle.  (Note: even though we have 
     * exclusive lock on pgss-&GT;lock, we must take pgss-&GT;mutex for this, since 
     * other processes may examine gc_count while holding only the mutex. 
     * Also, we have to advance the count *after* we've rewritten the file, 
     * else other processes might not realize they read a stale file.) 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN272"><span class='Ref_to_Macro'>record_gc_qtexts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
<a name="LN2206"></a><span class='Label'>gc_fail</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* clean up resources */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2079"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2079"><span class='Ref_To_Local'>qbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since the contents of the external file are now uncertain, mark all 
     * hashtable entries as having invalid texts. 
     */ 
</span>    <a href="../../src/include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2082"><span class='Ref_To_Local'>hash_seq</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2082"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN173"><span class='Ref_to_Member'>query_offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2083"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN174"><span class='Ref_to_Member'>query_len</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Destroy the query text file and create a new, empty one 
     */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/timezone/private.h.html#LN59"><span class='Ref_to_Proto'>unlink</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>              <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write new pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                     <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2081"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset the shared extent pointer */ 
</span>    <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reset mean_query_len to match the new state */ 
</span>    <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN186"><span class='Ref_to_Member'>mean_query_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN106"><span class='Ref_to_Const'>ASSUMED_LENGTH_INIT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Bump the GC count even though we failed. 
     * 
     * This is needed to make concurrent readers of file without any lock on 
     * pgss-&GT;lock notice existence of new version of file.  Once readers 
     * subsequently observe a change in GC count with pgss-&GT;lock held, that 
     * forces a safe reopen of file.  Writers also require that we bump here, 
     * of course.  (As required by locking protocol, readers and writers don't 
     * trust earlier file contents until gc_count is found unchanged after 
     * pgss-&GT;lock acquired in shared or exclusive mode respectively.) 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN272"><span class='Ref_to_Macro'>record_gc_qtexts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gc_qtexts &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Release all entries. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2261"></a><span class='Declare_Function'>entry_reset</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2263"></a>    <a href="../../src/include/utils/hsearch.h.html#LN111"><span class='Ref_to_Typedef'>HASH_SEQ_STATUS</span></a> <span class='Declare_Local'>hash_seq</span><span class='Delimiter'>; 
</span><a name="LN2264"></a>    <a href="pg_stat_statements.c.html#LN169"><span class='Ref_to_Struct'>pgssEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN2265"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>qfile</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/storage/lwlock.h.html#LN145"><span class='Ref_to_Proto'>LWLockAcquire</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lwlock.h.html#LN133"><span class='Ref_to_EnumConst'>LW_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/hsearch.h.html#LN134"><span class='Ref_to_Proto'>hash_seq_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2263"><span class='Ref_To_Local'>hash_seq</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_stat_statements.c.html#LN2264"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/hsearch.h.html#LN135"><span class='Ref_to_Proto'>hash_seq_search</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2263"><span class='Ref_To_Local'>hash_seq</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN243"><span class='Ref_to_Global_Var'>pgss_hash</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2264"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN171"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/hsearch.h.html#LN106"><span class='Ref_to_EnumConst'>HASH_REMOVE</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Write new empty query file, perhaps even creating a new one to recover 
     * if the file was missing. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN2265"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>= </span><a href="../../src/include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2265"><span class='Ref_To_Local'>qfile</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not create pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pg_stat_statements.c.html#LN2298"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If ftruncate fails, log it, but it's not a fatal problem */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/port/win32.h.html#LN58"><span class='Ref_to_Macro'>ftruncate</span></a><span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2265"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>               <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not truncate pg_stat_statement file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                      <a href="pg_stat_statements.c.html#LN94"><span class='Ref_to_Const'>PGSS_TEXT_FILE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2265"><span class='Ref_To_Local'>qfile</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN2298"></a><span class='Label'>done</span><span class='Operator'>: 
</span>    <a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN188"><span class='Ref_to_Member'>extent</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* This counts as a query text garbage collection for our purposes */ 
</span>    <a href="pg_stat_statements.c.html#LN272"><span class='Ref_to_Macro'>record_gc_qtexts</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/storage/lwlock.h.html#LN148"><span class='Ref_to_Proto'>LWLockRelease</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN242"><span class='Ref_to_Global_Var'>pgss</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN184"><span class='Ref_to_Member'>lock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end entry_reset &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * AppendJumble: Append a value that is substantive in a given query to 
 * the current jumble. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2311"></a><span class='Declare_Function'>AppendJumble</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Declare_Parameter'>item</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2313"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Local'>jumble</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN209"><span class='Ref_to_Member'>jumble</span></a><span class='Delimiter'>; 
</span><a name="LN2314"></a>    <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>jumble_len</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN212"><span class='Ref_to_Member'>jumble_len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Whenever the jumble buffer is full, we hash the current contents and 
     * reset the buffer to contain just that hash value, thus relying on the 
     * hash to summarize everything so far. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2323"></a>        <a href="../../src/include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>part_size</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2314"><span class='Ref_To_Local'>jumble_len</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN111"><span class='Ref_to_Const'>JUMBLE_SIZE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2327"></a>            <a href="../../src/include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>start_hash</span> <span class='Operator'>= </span><a href="../../src/backend/access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2313"><span class='Ref_To_Local'>jumble</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN111"><span class='Ref_to_Const'>JUMBLE_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2313"><span class='Ref_To_Local'>jumble</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN2327"><span class='Ref_To_Local'>start_hash</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2327"><span class='Ref_To_Local'>start_hash</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN2314"><span class='Ref_To_Local'>jumble_len</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2327"><span class='Ref_To_Local'>start_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_stat_statements.c.html#LN2323"><span class='Ref_To_Local'>part_size</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>size</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN111"><span class='Ref_to_Const'>JUMBLE_SIZE</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN2314"><span class='Ref_To_Local'>jumble_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2313"><span class='Ref_To_Local'>jumble</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2314"><span class='Ref_To_Local'>jumble_len</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>item</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2323"><span class='Ref_To_Local'>part_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2314"><span class='Ref_To_Local'>jumble_len</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN2323"><span class='Ref_To_Local'>part_size</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>item</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN2323"><span class='Ref_To_Local'>part_size</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>size</span></a> <span class='Operator'>-= </span><a href="pg_stat_statements.c.html#LN2323"><span class='Ref_To_Local'>part_size</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pg_stat_statements.c.html#LN2311"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN212"><span class='Ref_to_Member'>jumble_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2314"><span class='Ref_To_Local'>jumble_len</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AppendJumble &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Wrappers around AppendJumble to encapsulate details of serialization 
 * of individual local variable elements. 
 */ 
</span><a name="LN2345"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>APP_JUMB</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>item</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="pg_stat_statements.c.html#LN326"><span class='Ref_to_Proto'>AppendJumble</span></a><span class='Parentheses'>(</span>jstate<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>))</span> 
<a name="LN2347"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>APP_JUMB_STRING</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="pg_stat_statements.c.html#LN326"><span class='Ref_to_Proto'>AppendJumble</span></a><span class='Parentheses'>(</span>jstate<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="pg_stat_statements.c.html#LN2347"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2347"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * JumbleQuery: Selectively serialize the query tree, appending significant 
 * data to the "query jumble" while ignoring nonsignificant data. 
 * 
 * Rule of thumb for what to include is that we should ignore anything not 
 * semantically significant (such as alias names) as well as anything that can 
 * be deduced from child nodes (else we'd just be double-hashing that piece 
 * of information). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2360"></a><span class='Declare_Function'>JumbleQuery</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* resultRelation is usually predictable from commandType */ 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN132"><span class='Ref_to_Member'>cteList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN329"><span class='Ref_to_Proto'>JumbleRangeTable</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN135"><span class='Ref_to_Member'>jointree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN141"><span class='Ref_to_Member'>onConflict</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN147"><span class='Ref_to_Member'>groupingSets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN151"><span class='Ref_to_Member'>windowClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN153"><span class='Ref_to_Member'>distinctClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN155"><span class='Ref_to_Member'>sortClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN157"><span class='Ref_to_Member'>limitOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN158"><span class='Ref_to_Member'>limitCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we ignore rowMarks */ 
</span>    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2360"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN162"><span class='Ref_to_Member'>setOperations</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end JumbleQuery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Jumble a range table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2389"></a><span class='Declare_Function'>JumbleRangeTable</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rtable</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2391"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2391"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2389"><span class='Ref_to_Parameter'>rtable</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2395"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2391"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2389"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN949"><span class='Ref_to_Member'>tablesample</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN923"><span class='Ref_to_EnumConst'>RTE_SUBQUERY</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN328"><span class='Ref_to_Proto'>JumbleQuery</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2389"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN954"><span class='Ref_to_Member'>subquery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN924"><span class='Ref_to_EnumConst'>RTE_JOIN</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN974"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN925"><span class='Ref_to_EnumConst'>RTE_FUNCTION</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2389"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN985"><span class='Ref_to_Member'>functions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN926"><span class='Ref_to_EnumConst'>RTE_TABLEFUNC</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2389"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN991"><span class='Ref_to_Member'>tablefunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN927"><span class='Ref_to_EnumConst'>RTE_VALUES</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2389"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN996"><span class='Ref_to_Member'>values_lists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN928"><span class='Ref_to_EnumConst'>RTE_CTE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Depending on the CTE name here isn't ideal, but it's the 
                 * only info we have to identify the referenced WITH item. 
                 */ 
</span>                <a href="pg_stat_statements.c.html#LN2347"><span class='Ref_to_Macro'>APP_JUMB_STRING</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1001"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1002"><span class='Ref_to_Member'>ctelevelsup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/parsenodes.h.html#LN929"><span class='Ref_to_EnumConst'>RTE_NAMEDTUPLESTORE</span></a><span class='Operator'>: 
</span>                <a href="pg_stat_statements.c.html#LN2347"><span class='Ref_to_Macro'>APP_JUMB_STRING</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1016"><span class='Ref_to_Member'>enrname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized RTE kind: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2395"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch rte-&GT;rtekind &raquo; </span> 
    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end JumbleRangeTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Jumble an expression tree 
 * 
 * In general this function should handle all the same node types that 
 * expression_tree_walker() does, and therefore it's coded to be as parallel 
 * to that function as possible.  However, since we are only invoked on 
 * queries immediately post-parse-analysis, we need not handle node types 
 * that only appear in planning. 
 * 
 * Note: the reason we don't simply use expression_tree_walker() is that the 
 * point of that function is to support tree walkers that don't care about 
 * most tree node types, but here we care about all types.  We should complain 
 * about any unrecognized node type. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2453"></a><span class='Declare_Function'>JumbleExpr</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2455"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Guard against stack overflow due to overly complex expressions */ 
</span>    <a href="../../src/include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We always emit the node's NodeTag, then any additional fields that are 
     * considered significant, and then we recurse to any child nodes. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../ltree/ltxtquery_io.c.html#LN28"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN145"><span class='Ref_to_EnumConst'>T_Var</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2473"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2473"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2473"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2473"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN172"><span class='Ref_to_Member'>varlevelsup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN146"><span class='Ref_to_EnumConst'>T_Const</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2482"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>c</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* We jumble only the constant's type, not its value */ 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2482"><span class='Ref_To_Local'>c</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN191"><span class='Ref_to_Member'>consttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Also, record its parse location for query normalization */ 
</span>                <a href="pg_stat_statements.c.html#LN331"><span class='Ref_to_Proto'>RecordConstLocation</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2482"><span class='Ref_To_Local'>c</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN202"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN147"><span class='Ref_to_EnumConst'>T_Param</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2492"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN240"><span class='Ref_to_Struct'>Param</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN245"><span class='Ref_to_Member'>paramtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Also, track the highest external Param id */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN243"><span class='Ref_to_Member'>paramkind</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/primnodes.h.html#LN234"><span class='Ref_to_EnumConst'>PARAM_EXTERN</span></a> <span class='Operator'>&& 
</span>                    <a href="pg_stat_statements.c.html#LN2492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a> <span class='Operator'>&GT; </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN224"><span class='Ref_to_Member'>highest_extern_param_id</span></a><span class='Parentheses'>) 
</span>                    <a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN224"><span class='Ref_to_Member'>highest_extern_param_id</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2492"><span class='Ref_To_Local'>p</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN244"><span class='Ref_to_Member'>paramid</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN148"><span class='Ref_to_EnumConst'>T_Aggref</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2505"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2505"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN293"><span class='Ref_to_Member'>aggfnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2505"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN299"><span class='Ref_to_Member'>aggdirectargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2505"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN300"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2505"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN301"><span class='Ref_to_Member'>aggorder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2505"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN302"><span class='Ref_to_Member'>aggdistinct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2505"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN303"><span class='Ref_to_Member'>aggfilter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN149"><span class='Ref_to_EnumConst'>T_GroupingFunc</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2517"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>grpnode</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN337"><span class='Ref_to_Struct'>GroupingFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2517"><span class='Ref_To_Local'>grpnode</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN342"><span class='Ref_to_Member'>refs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN150"><span class='Ref_to_EnumConst'>T_WindowFunc</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2524"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN351"><span class='Ref_to_Struct'>WindowFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2524"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN354"><span class='Ref_to_Member'>winfnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2524"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN360"><span class='Ref_to_Member'>winref</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2524"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN358"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2524"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN359"><span class='Ref_to_Member'>aggfilter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN151"><span class='Ref_to_EnumConst'>T_ArrayRef</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2534"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN395"><span class='Ref_to_Struct'>ArrayRef</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>aref</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN395"><span class='Ref_to_Struct'>ArrayRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2534"><span class='Ref_To_Local'>aref</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN402"><span class='Ref_to_Member'>refupperindexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2534"><span class='Ref_To_Local'>aref</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN404"><span class='Ref_to_Member'>reflowerindexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2534"><span class='Ref_To_Local'>aref</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN406"><span class='Ref_to_Member'>refexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2534"><span class='Ref_To_Local'>aref</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN408"><span class='Ref_to_Member'>refassgnexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN152"><span class='Ref_to_EnumConst'>T_FuncExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2544"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2544"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN447"><span class='Ref_to_Member'>funcid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2544"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN153"><span class='Ref_to_EnumConst'>T_NamedArgExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2552"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN473"><span class='Ref_to_Struct'>NamedArgExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nae</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN473"><span class='Ref_to_Struct'>NamedArgExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2552"><span class='Ref_To_Local'>nae</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN478"><span class='Ref_to_Member'>argnumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2552"><span class='Ref_To_Local'>nae</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN476"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN154"><span class='Ref_to_EnumConst'>T_OpExpr</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN155"><span class='Ref_to_EnumConst'>T_DistinctExpr</span></a><span class='Operator'>:</span>    <span class='Comment_Single_Line'>/* struct-equivalent to OpExpr */ 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN156"><span class='Ref_to_EnumConst'>T_NullIfExpr</span></a><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* struct-equivalent to OpExpr */ 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2562"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN491"><span class='Ref_to_Struct'>OpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2562"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN494"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2562"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN500"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN157"><span class='Ref_to_EnumConst'>T_ScalarArrayOpExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2570"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2570"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN537"><span class='Ref_to_Member'>opno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2570"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN539"><span class='Ref_to_Member'>useOr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2570"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN541"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN158"><span class='Ref_to_EnumConst'>T_BoolExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2579"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN557"><span class='Ref_to_Struct'>BoolExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2579"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN560"><span class='Ref_to_Member'>boolop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2579"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN561"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN159"><span class='Ref_to_EnumConst'>T_SubLink</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2587"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>sublink</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN629"><span class='Ref_to_Struct'>SubLink</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2587"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN632"><span class='Ref_to_Member'>subLinkType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2587"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN633"><span class='Ref_to_Member'>subLinkId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2587"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN634"><span class='Ref_to_Member'>testexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN328"><span class='Ref_to_Proto'>JumbleQuery</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2587"><span class='Ref_To_Local'>sublink</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN636"><span class='Ref_to_Member'>subselect</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN162"><span class='Ref_to_EnumConst'>T_FieldSelect</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2597"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN737"><span class='Ref_to_Struct'>FieldSelect</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fs</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN737"><span class='Ref_to_Struct'>FieldSelect</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2597"><span class='Ref_To_Local'>fs</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN741"><span class='Ref_to_Member'>fieldnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2597"><span class='Ref_To_Local'>fs</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN740"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN163"><span class='Ref_to_EnumConst'>T_FieldStore</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2605"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN763"><span class='Ref_to_Struct'>FieldStore</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fstore</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN763"><span class='Ref_to_Struct'>FieldStore</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2605"><span class='Ref_To_Local'>fstore</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN766"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2605"><span class='Ref_To_Local'>fstore</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN767"><span class='Ref_to_Member'>newvals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN164"><span class='Ref_to_EnumConst'>T_RelabelType</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2613"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN786"><span class='Ref_to_Struct'>RelabelType</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2613"><span class='Ref_To_Local'>rt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN790"><span class='Ref_to_Member'>resulttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2613"><span class='Ref_To_Local'>rt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN789"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN165"><span class='Ref_to_EnumConst'>T_CoerceViaIO</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2621"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN806"><span class='Ref_to_Struct'>CoerceViaIO</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cio</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN806"><span class='Ref_to_Struct'>CoerceViaIO</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2621"><span class='Ref_To_Local'>cio</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN810"><span class='Ref_to_Member'>resulttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2621"><span class='Ref_To_Local'>cio</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN809"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN166"><span class='Ref_to_EnumConst'>T_ArrayCoerceExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2629"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN829"><span class='Ref_to_Struct'>ArrayCoerceExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>acexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN829"><span class='Ref_to_Struct'>ArrayCoerceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2629"><span class='Ref_To_Local'>acexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN834"><span class='Ref_to_Member'>resulttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2629"><span class='Ref_To_Local'>acexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN832"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN167"><span class='Ref_to_EnumConst'>T_ConvertRowtypeExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2637"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN854"><span class='Ref_to_Struct'>ConvertRowtypeExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>crexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN854"><span class='Ref_to_Struct'>ConvertRowtypeExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2637"><span class='Ref_To_Local'>crexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN858"><span class='Ref_to_Member'>resulttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2637"><span class='Ref_To_Local'>crexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN857"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN168"><span class='Ref_to_EnumConst'>T_CollateExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2645"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN871"><span class='Ref_to_Struct'>CollateExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ce</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN871"><span class='Ref_to_Struct'>CollateExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2645"><span class='Ref_To_Local'>ce</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN875"><span class='Ref_to_Member'>collOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2645"><span class='Ref_To_Local'>ce</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN874"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN169"><span class='Ref_to_EnumConst'>T_CaseExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2653"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN901"><span class='Ref_to_Struct'>CaseExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>caseexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN901"><span class='Ref_to_Struct'>CaseExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2653"><span class='Ref_To_Local'>caseexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN906"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2653"><span class='Ref_To_Local'>caseexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN907"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2658"></a>                    <a href="../../src/include/nodes/primnodes.h.html#LN915"><span class='Ref_to_Struct'>CaseWhen</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>when</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN915"><span class='Ref_to_Struct'>CaseWhen</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2455"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2658"><span class='Ref_To_Local'>when</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN918"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2658"><span class='Ref_To_Local'>when</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN919"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2653"><span class='Ref_To_Local'>caseexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN908"><span class='Ref_to_Member'>defresult</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN171"><span class='Ref_to_EnumConst'>T_CaseTestExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2668"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN931"><span class='Ref_to_Struct'>CaseTestExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN931"><span class='Ref_to_Struct'>CaseTestExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2668"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN934"><span class='Ref_to_Member'>typeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN172"><span class='Ref_to_EnumConst'>T_ArrayExpr</span></a><span class='Operator'>: 
</span>            <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../src/include/nodes/primnodes.h.html#LN947"><span class='Ref_to_Struct'>ArrayExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>elements<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN173"><span class='Ref_to_EnumConst'>T_RowExpr</span></a><span class='Operator'>: 
</span>            <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../src/include/nodes/primnodes.h.html#LN981"><span class='Ref_to_Struct'>RowExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN174"><span class='Ref_to_EnumConst'>T_RowCompareExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2681"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rcexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1026"><span class='Ref_to_Struct'>RowCompareExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2681"><span class='Ref_To_Local'>rcexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1029"><span class='Ref_to_Member'>rctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2681"><span class='Ref_To_Local'>rcexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1033"><span class='Ref_to_Member'>largs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2681"><span class='Ref_To_Local'>rcexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1034"><span class='Ref_to_Member'>rargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN175"><span class='Ref_to_EnumConst'>T_CoalesceExpr</span></a><span class='Operator'>: 
</span>            <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../src/include/nodes/primnodes.h.html#LN1040"><span class='Ref_to_Struct'>CoalesceExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>args<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN176"><span class='Ref_to_EnumConst'>T_MinMaxExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2693"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1058"><span class='Ref_to_Struct'>MinMaxExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mmexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1058"><span class='Ref_to_Struct'>MinMaxExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2693"><span class='Ref_To_Local'>mmexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1064"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2693"><span class='Ref_To_Local'>mmexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1065"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN177"><span class='Ref_to_EnumConst'>T_SQLValueFunction</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2701"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1099"><span class='Ref_to_Struct'>SQLValueFunction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>svf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1099"><span class='Ref_to_Struct'>SQLValueFunction</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2701"><span class='Ref_To_Local'>svf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1102"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* type is fully determined by op */ 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2701"><span class='Ref_To_Local'>svf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1104"><span class='Ref_to_Member'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN178"><span class='Ref_to_EnumConst'>T_XmlExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2710"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1137"><span class='Ref_to_Struct'>XmlExpr</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>xexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1137"><span class='Ref_to_Struct'>XmlExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2710"><span class='Ref_To_Local'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1140"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2710"><span class='Ref_To_Local'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1142"><span class='Ref_to_Member'>named_args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2710"><span class='Ref_To_Local'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1144"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN179"><span class='Ref_to_EnumConst'>T_NullTest</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2719"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2719"><span class='Ref_To_Local'>nt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1179"><span class='Ref_to_Member'>nulltesttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2719"><span class='Ref_To_Local'>nt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN180"><span class='Ref_to_EnumConst'>T_BooleanTest</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2727"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1198"><span class='Ref_to_Struct'>BooleanTest</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2727"><span class='Ref_To_Local'>bt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1202"><span class='Ref_to_Member'>booltesttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2727"><span class='Ref_To_Local'>bt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1201"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN181"><span class='Ref_to_EnumConst'>T_CoerceToDomain</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2735"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1215"><span class='Ref_to_Struct'>CoerceToDomain</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2735"><span class='Ref_To_Local'>cd</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1219"><span class='Ref_to_Member'>resulttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2735"><span class='Ref_To_Local'>cd</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1218"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN182"><span class='Ref_to_EnumConst'>T_CoerceToDomainValue</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2743"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1235"><span class='Ref_to_Struct'>CoerceToDomainValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cdv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1235"><span class='Ref_to_Struct'>CoerceToDomainValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2743"><span class='Ref_To_Local'>cdv</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1238"><span class='Ref_to_Member'>typeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN183"><span class='Ref_to_EnumConst'>T_SetToDefault</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2750"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1251"><span class='Ref_to_Struct'>SetToDefault</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sd</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1251"><span class='Ref_to_Struct'>SetToDefault</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2750"><span class='Ref_To_Local'>sd</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1254"><span class='Ref_to_Member'>typeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN184"><span class='Ref_to_EnumConst'>T_CurrentOfExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2757"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ce</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1272"><span class='Ref_to_Struct'>CurrentOfExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2757"><span class='Ref_To_Local'>ce</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1275"><span class='Ref_to_Member'>cvarno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2757"><span class='Ref_To_Local'>ce</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1276"><span class='Ref_to_Member'>cursor_name</span></a><span class='Parentheses'>) 
</span>                    <a href="pg_stat_statements.c.html#LN2347"><span class='Ref_to_Macro'>APP_JUMB_STRING</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2757"><span class='Ref_To_Local'>ce</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1276"><span class='Ref_to_Member'>cursor_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2757"><span class='Ref_To_Local'>ce</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1277"><span class='Ref_to_Member'>cursor_param</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN185"><span class='Ref_to_EnumConst'>T_InferenceElem</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2767"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ie</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1287"><span class='Ref_to_Struct'>InferenceElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2767"><span class='Ref_To_Local'>ie</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1291"><span class='Ref_to_Member'>infercollid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2767"><span class='Ref_To_Local'>ie</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1292"><span class='Ref_to_Member'>inferopclass</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2767"><span class='Ref_To_Local'>ie</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1290"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN186"><span class='Ref_to_EnumConst'>T_TargetEntry</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2776"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2776"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1367"><span class='Ref_to_Member'>resno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2776"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1369"><span class='Ref_to_Member'>ressortgroupref</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2776"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN187"><span class='Ref_to_EnumConst'>T_RangeTblRef</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2785"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1415"><span class='Ref_to_Struct'>RangeTblRef</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2785"><span class='Ref_To_Local'>rtr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1418"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN188"><span class='Ref_to_EnumConst'>T_JoinExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2792"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>join</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1444"><span class='Ref_to_Struct'>JoinExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2792"><span class='Ref_To_Local'>join</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1447"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2792"><span class='Ref_To_Local'>join</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1448"><span class='Ref_to_Member'>isNatural</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2792"><span class='Ref_To_Local'>join</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1454"><span class='Ref_to_Member'>rtindex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2792"><span class='Ref_To_Local'>join</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1449"><span class='Ref_to_Member'>larg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2792"><span class='Ref_To_Local'>join</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1450"><span class='Ref_to_Member'>rarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2792"><span class='Ref_To_Local'>join</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1452"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN189"><span class='Ref_to_EnumConst'>T_FromExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2804"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>from</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1466"><span class='Ref_to_Struct'>FromExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2804"><span class='Ref_To_Local'>from</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1469"><span class='Ref_to_Member'>fromlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2804"><span class='Ref_To_Local'>from</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1470"><span class='Ref_to_Member'>quals</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN190"><span class='Ref_to_EnumConst'>T_OnConflictExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2812"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN1482"><span class='Ref_to_Struct'>OnConflictExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>conf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1482"><span class='Ref_to_Struct'>OnConflictExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1485"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1488"><span class='Ref_to_Member'>arbiterElems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1490"><span class='Ref_to_Member'>arbiterWhere</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1494"><span class='Ref_to_Member'>onConflictSet</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1495"><span class='Ref_to_Member'>onConflictWhere</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1491"><span class='Ref_to_Member'>constraint</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1496"><span class='Ref_to_Member'>exclRelIndex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2812"><span class='Ref_To_Local'>conf</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1497"><span class='Ref_to_Member'>exclRelTlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN290"><span class='Ref_to_EnumConst'>T_List</span></a><span class='Operator'>: 
</span>            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2455"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN291"><span class='Ref_to_EnumConst'>T_IntList</span></a><span class='Operator'>: 
</span>            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2455"><span class='Ref_To_Local'>temp</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2455"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN448"><span class='Ref_to_EnumConst'>T_SortGroupClause</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2838"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1161"><span class='Ref_to_Struct'>SortGroupClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sgc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1161"><span class='Ref_to_Struct'>SortGroupClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2838"><span class='Ref_To_Local'>sgc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1164"><span class='Ref_to_Member'>tleSortGroupRef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2838"><span class='Ref_To_Local'>sgc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1165"><span class='Ref_to_Member'>eqop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2838"><span class='Ref_To_Local'>sgc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1166"><span class='Ref_to_Member'>sortop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2838"><span class='Ref_To_Local'>sgc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1167"><span class='Ref_to_Member'>nulls_first</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN449"><span class='Ref_to_EnumConst'>T_GroupingSet</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2848"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1230"><span class='Ref_to_Struct'>GroupingSet</span></a> <span class='Operator'>*</span><span class='Declare_Local'>gsnode</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1230"><span class='Ref_to_Struct'>GroupingSet</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2848"><span class='Ref_To_Local'>gsnode</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1234"><span class='Ref_to_Member'>content</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN450"><span class='Ref_to_EnumConst'>T_WindowClause</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2855"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1252"><span class='Ref_to_Struct'>WindowClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1252"><span class='Ref_to_Struct'>WindowClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2855"><span class='Ref_To_Local'>wc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1262"><span class='Ref_to_Member'>winref</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2855"><span class='Ref_To_Local'>wc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1259"><span class='Ref_to_Member'>frameOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2855"><span class='Ref_To_Local'>wc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1257"><span class='Ref_to_Member'>partitionClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2855"><span class='Ref_To_Local'>wc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1258"><span class='Ref_to_Member'>orderClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2855"><span class='Ref_To_Local'>wc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1260"><span class='Ref_to_Member'>startOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2855"><span class='Ref_To_Local'>wc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1261"><span class='Ref_to_Member'>endOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN462"><span class='Ref_to_EnumConst'>T_CommonTableExpr</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2867"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cte</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1339"><span class='Ref_to_Struct'>CommonTableExpr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* we store the string name because RTE_CTE RTEs need it */ 
</span>                <a href="pg_stat_statements.c.html#LN2347"><span class='Ref_to_Macro'>APP_JUMB_STRING</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2867"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1342"><span class='Ref_to_Member'>ctename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN328"><span class='Ref_to_Proto'>JumbleQuery</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2867"><span class='Ref_To_Local'>cte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1345"><span class='Ref_to_Member'>ctequery</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN312"><span class='Ref_to_EnumConst'>T_SetOperationStmt</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2876"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>setop</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1545"><span class='Ref_to_Struct'>SetOperationStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2876"><span class='Ref_To_Local'>setop</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1548"><span class='Ref_to_Member'>op</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2876"><span class='Ref_To_Local'>setop</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1549"><span class='Ref_to_Member'>all</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2876"><span class='Ref_To_Local'>setop</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1550"><span class='Ref_to_Member'>larg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2876"><span class='Ref_To_Local'>setop</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1551"><span class='Ref_to_Member'>rarg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN445"><span class='Ref_to_EnumConst'>T_RangeTblFunction</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2886"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1051"><span class='Ref_to_Struct'>RangeTblFunction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rtfunc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1051"><span class='Ref_to_Struct'>RangeTblFunction</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2886"><span class='Ref_To_Local'>rtfunc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1055"><span class='Ref_to_Member'>funcexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN143"><span class='Ref_to_EnumConst'>T_TableFunc</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2893"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN78"><span class='Ref_to_Struct'>TableFunc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tablefunc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN78"><span class='Ref_to_Struct'>TableFunc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2893"><span class='Ref_To_Local'>tablefunc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN83"><span class='Ref_to_Member'>docexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2893"><span class='Ref_To_Local'>tablefunc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN84"><span class='Ref_to_Member'>rowexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2893"><span class='Ref_To_Local'>tablefunc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN89"><span class='Ref_to_Member'>colexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN446"><span class='Ref_to_EnumConst'>T_TableSampleClause</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2902"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN1071"><span class='Ref_to_Struct'>TableSampleClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tsc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN1071"><span class='Ref_to_Struct'>TableSampleClause</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
                <a href="pg_stat_statements.c.html#LN2345"><span class='Ref_to_Macro'>APP_JUMB</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2902"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1074"><span class='Ref_to_Member'>tsmhandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2902"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1075"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_stat_statements.c.html#LN330"><span class='Ref_to_Proto'>JumbleExpr</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN2902"><span class='Ref_To_Local'>tsc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1076"><span class='Ref_to_Member'>repeatable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Only a warning, since we can stumble along anyway */ 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized node type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2453"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nodeTag(node) &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end JumbleExpr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Record location of constant within query string of query tree 
 * that is currently being walked. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2922"></a><span class='Declare_Function'>RecordConstLocation</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>location</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* -1 indicates unknown or undefined location */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>location</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* enlarge array if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN218"><span class='Ref_to_Member'>clocations_buf_size</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN218"><span class='Ref_to_Member'>clocations_buf_size</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                <a href="../../src/include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>, 
</span>                         <a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN218"><span class='Ref_to_Member'>clocations_buf_size</span></a> <span class='Operator'>* 
</span>                         <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN198"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>location</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* initialize lengths to -1 to simplify fill_in_constant_lengths */ 
</span>        <a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN199"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2922"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RecordConstLocation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generate a normalized version of the query string that will be used to 
 * represent all similar queries. 
 * 
 * Note that the normalized representation may well vary depending on 
 * just which "equivalent" query is used to create the hashtable entry. 
 * We assume this is OK. 
 * 
 * If query_loc &GT; 0, then "query" has been advanced by that much compared to 
 * the original string start, so we need to translate the provided locations 
 * to compensate.  (This lets us avoid re-scanning statements before the one 
 * of interest, so it's worth doing.) 
 * 
 * *query_len_p contains the input string length, and is updated with 
 * the result string length on exit.  The resulting string might be longer 
 * or shorter depending on what happens with replacement of constants. 
 * 
 * Returns a palloc'd string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2963"></a><span class='Declare_Function'>generate_normalized_query</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN2964"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>query_loc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>query_len_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2966"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>norm_query</span><span class='Delimiter'>; 
</span><a name="LN2967"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>query_len</span> <span class='Operator'>= *</span><a href="pg_stat_statements.c.html#LN2964"><span class='Ref_to_Parameter'>query_len_p</span></a><span class='Delimiter'>; 
</span><a name="LN2968"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2969"></a>                <span class='Declare_Local'>norm_query_buflen</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* Space allowed for norm_query */ 
</span><a name="LN2970"></a>                <span class='Declare_Local'>len_to_wrt</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* Length (in bytes) to write */ 
</span><a name="LN2971"></a>                <span class='Declare_Local'>quer_loc</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* Source query byte location */ 
</span><a name="LN2972"></a>                <span class='Declare_Local'>n_quer_loc</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* Normalized query byte location */ 
</span><a name="LN2973"></a>                <span class='Declare_Local'>last_off</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* Offset from start for previous tok */ 
</span><a name="LN2974"></a>                <span class='Declare_Local'>last_tok_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Length (in bytes) of that tok */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get constants' lengths (core system only gives us locations).  Note 
     * this also ensures the items are sorted by location. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN334"><span class='Ref_to_Proto'>fill_in_constant_lengths</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>jstate</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2964"><span class='Ref_to_Parameter'>query_loc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allow for $n symbols to be longer than the constants they replace. 
     * Constants must take at least one byte in text form, while a $n symbol 
     * certainly isn't more than 11 bytes, even if n reaches INT_MAX.  We 
     * could refine that limit based on the max value of n for the current 
     * query, but it hardly seems worth any extra effort to do so. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN2969"><span class='Ref_To_Local'>norm_query_buflen</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2967"><span class='Ref_To_Local'>query_len</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate result buffer */ 
</span>    <a href="pg_stat_statements.c.html#LN2966"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2969"><span class='Ref_To_Local'>norm_query_buflen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2968"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN2968"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN2968"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2996"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>off</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* Offset from start for cur tok */ 
</span><a name="LN2997"></a>                    <span class='Declare_Local'>tok_len</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Length (in bytes) of that tok */ 
</span> 
        <a href="pg_stat_statements.c.html#LN2996"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN2968"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN198"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Adjust recorded location if we're dealing with partial string */ 
</span>        <a href="pg_stat_statements.c.html#LN2996"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>-= </span><a href="pg_stat_statements.c.html#LN2964"><span class='Ref_to_Parameter'>query_loc</span></a><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN2997"><span class='Ref_To_Local'>tok_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN2968"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN199"><span class='Ref_to_Member'>length</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2997"><span class='Ref_To_Local'>tok_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore any duplicates */ 
</span> 
        <span class='Comment_Multi_Line'>/* Copy next chunk (what precedes the next constant) */ 
</span>        <a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2996"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN2973"><span class='Ref_To_Local'>last_off</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a> <span class='Operator'>-= </span><a href="pg_stat_statements.c.html#LN2974"><span class='Ref_To_Local'>last_tok_len</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2966"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>query</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2971"><span class='Ref_To_Local'>quer_loc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And insert a param symbol in place of the constant token */ 
</span>        <a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a> <span class='Operator'>+= </span><a href="../../src/include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2966"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a><span class='Delimiter'>, </span><span class='String'>"$%d"</span><span class='Delimiter'>, 
</span>                              <a href="pg_stat_statements.c.html#LN2968"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN224"><span class='Ref_to_Member'>highest_extern_param_id</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN2971"><span class='Ref_To_Local'>quer_loc</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2996"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2997"><span class='Ref_To_Local'>tok_len</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2973"><span class='Ref_To_Local'>last_off</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2996"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>        <a href="pg_stat_statements.c.html#LN2974"><span class='Ref_To_Local'>last_tok_len</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2997"><span class='Ref_To_Local'>tok_len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;jstate-&GT;clocati... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We've copied up until the last ignorable constant.  Copy over the 
     * remaining bytes of the original query string. 
     */ 
</span>    <a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2967"><span class='Ref_To_Local'>query_len</span></a> <span class='Operator'>- </span><a href="pg_stat_statements.c.html#LN2971"><span class='Ref_To_Local'>quer_loc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2966"><span class='Ref_To_Local'>norm_query</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2963"><span class='Ref_to_Parameter'>query</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN2971"><span class='Ref_To_Local'>quer_loc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a> <span class='Operator'>+= </span><a href="pg_stat_statements.c.html#LN2970"><span class='Ref_To_Local'>len_to_wrt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a> <span class='Operator'>&LT;= </span><a href="pg_stat_statements.c.html#LN2969"><span class='Ref_To_Local'>norm_query_buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN2966"><span class='Ref_To_Local'>norm_query</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pg_stat_statements.c.html#LN2964"><span class='Ref_to_Parameter'>query_len_p</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN2972"><span class='Ref_To_Local'>n_quer_loc</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_stat_statements.c.html#LN2966"><span class='Ref_To_Local'>norm_query</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_normalized_query &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a valid SQL string and an array of constant-location records, 
 * fill in the textual lengths of those constants. 
 * 
 * The constants may use any allowed constant syntax, such as float literals, 
 * bit-strings, single-quoted strings and dollar-quoted strings.  This is 
 * accomplished by using the public API for the core scanner. 
 * 
 * It is the caller's job to ensure that the string is a valid SQL statement 
 * with constants at the indicated locations.  Since in practice the string 
 * has already been parsed, and the locations that the caller provides will 
 * have originated from within the authoritative parser, this should not be 
 * a problem. 
 * 
 * Duplicate constant pointers are possible, and will have their lengths 
 * marked as '-1', so that they are later ignored.  (Actually, we assume the 
 * lengths were initialized as -1 to start with, and don't change them here.) 
 * 
 * If query_loc &GT; 0, then "query" has been advanced by that much compared to 
 * the original string start, so we need to translate the provided locations 
 * to compensate.  (This lets us avoid re-scanning statements before the one 
 * of interest, so it's worth doing.) 
 * 
 * N.B. There is an assumption that a '-' character at a Const location begins 
 * a negative numeric constant.  This precludes there ever being another 
 * reason for a constant to start with a '-'. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3070"></a><span class='Declare_Function'>fill_in_constant_lengths</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN206"><span class='Ref_to_Struct'>pgssJumbleState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN3071"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>query_loc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3073"></a>    <a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a> <span class='Operator'>*</span><span class='Declare_Local'>locs</span><span class='Delimiter'>; 
</span><a name="LN3074"></a>    <a href="../../src/include/parser/scanner.h.html#LN115"><span class='Ref_to_Typedef'>core_yyscan_t</span></a> <span class='Declare_Local'>yyscanner</span><span class='Delimiter'>; 
</span><a name="LN3075"></a>    <a href="../../src/include/parser/scanner.h.html#LN65"><span class='Ref_to_Struct'>core_yy_extra_type</span></a> <span class='Declare_Local'>yyextra</span><span class='Delimiter'>; 
</span><a name="LN3076"></a>    <a href="../../src/include/parser/scanner.h.html#LN28"><span class='Ref_to_Union'>core_YYSTYPE</span></a> <span class='Declare_Local'>yylval</span><span class='Delimiter'>; 
</span><a name="LN3077"></a>    <a href="../../src/include/parser/scanner.h.html#LN43"><span class='Ref_to_Const'>YYLTYPE</span></a>     <span class='Declare_Local'>yylloc</span><span class='Delimiter'>; 
</span><a name="LN3078"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>last_loc</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN3079"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sort the records by location so that we can process them in order while 
     * scanning the query text. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../src/include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a><span class='Delimiter'>, 
</span>              <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN336"><span class='Ref_to_Proto'>comp_location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_stat_statements.c.html#LN3073"><span class='Ref_To_Local'>locs</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN215"><span class='Ref_to_Member'>clocations</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize the flex scanner --- should match raw_parser() */ 
</span>    <a href="pg_stat_statements.c.html#LN3074"><span class='Ref_To_Local'>yyscanner</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/scanner.h.html#LN119"><span class='Ref_to_Proto'>scanner_init</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN3075"><span class='Ref_To_Local'>yyextra</span></a><span class='Delimiter'>, 
</span>                             <a href="../../src/common/keywords.c.html#LN40"><span class='Ref_to_Global_Var'>ScanKeywords</span></a><span class='Delimiter'>, 
</span>                             <a href="../../src/common/keywords.c.html#LN44"><span class='Ref_to_Global_Var'>NumScanKeywords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we don't want to re-emit any escape string warnings */ 
</span>    <a href="pg_stat_statements.c.html#LN3075"><span class='Ref_To_Local'>yyextra</span></a><span class='Operator'>.</span><a href="../../src/include/parser/scanner.h.html#LN87"><span class='Ref_to_Member'>escape_string_warning</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Search for each constant, in sequence */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3079"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN3079"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>jstate</span></a><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN221"><span class='Ref_to_Member'>clocations_count</span></a><span class='Delimiter'>; </span><a href="pg_stat_statements.c.html#LN3079"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3102"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>loc</span> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN3073"><span class='Ref_To_Local'>locs</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN3079"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN198"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span><a name="LN3103"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Adjust recorded location if we're dealing with partial string */ 
</span>        <a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a> <span class='Operator'>-= </span><a href="pg_stat_statements.c.html#LN3071"><span class='Ref_to_Parameter'>query_loc</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a> <span class='Operator'>&LT;= </span><a href="pg_stat_statements.c.html#LN3078"><span class='Ref_To_Local'>last_loc</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* Duplicate constant, ignore */ 
</span> 
        <span class='Comment_Multi_Line'>/* Lex tokens until we find the desired constant */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_stat_statements.c.html#LN3103"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/scanner.h.html#LN124"><span class='Ref_to_Proto'>core_yylex</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN3076"><span class='Ref_To_Local'>yylval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN3077"><span class='Ref_To_Local'>yylloc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN3074"><span class='Ref_To_Local'>yyscanner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We should not hit end-of-string, but if we do, behave sanely */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3103"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* out of inner for-loop */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We should find the token position exactly, but if we somehow 
             * run past it, work with that. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3077"><span class='Ref_To_Local'>yylloc</span></a> <span class='Operator'>&GT;= </span><a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3070"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * It's a negative value - this is the one and only case 
                     * where we replace more than a single token. 
                     * 
                     * Do not compensate for the core system's special-case 
                     * adjustment of location to that of the leading '-' 
                     * operator in the event of a negative constant.  It is 
                     * also useful for our purposes to start from the minus 
                     * symbol.  In this way, queries like "select * from foo 
                     * where bar = 1" and "select * from foo where bar = -2" 
                     * will have identical normalized query strings. 
                     */ 
</span>                    <a href="pg_stat_statements.c.html#LN3103"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/scanner.h.html#LN124"><span class='Ref_to_Proto'>core_yylex</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN3076"><span class='Ref_To_Local'>yylval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_stat_statements.c.html#LN3077"><span class='Ref_To_Local'>yylloc</span></a><span class='Delimiter'>, </span><a href="pg_stat_statements.c.html#LN3074"><span class='Ref_To_Local'>yyscanner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3103"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* out of inner for-loop */ 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We now rely on the assumption that flex has placed a zero 
                 * byte after the text of the current token in scanbuf. 
                 */ 
</span>                <a href="pg_stat_statements.c.html#LN3073"><span class='Ref_To_Local'>locs</span></a><span class='Delimiter'>[</span><a href="pg_stat_statements.c.html#LN3079"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="pg_stat_statements.c.html#LN199"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3075"><span class='Ref_To_Local'>yyextra</span></a><span class='Operator'>.</span><a href="../../src/include/parser/scanner.h.html#LN71"><span class='Ref_to_Member'>scanbuf</span></a> <span class='Operator'>+ </span><a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* out of inner for-loop */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if yylloc&GT;=loc &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* If we hit end-of-string, give up, leaving remaining lengths -1 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3103"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="pg_stat_statements.c.html#LN3078"><span class='Ref_To_Local'>last_loc</span></a> <span class='Operator'>= </span><a href="pg_stat_statements.c.html#LN3102"><span class='Ref_To_Local'>loc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;jstate-&GT;clocati... &raquo; </span> 
 
    <a href="../../src/include/parser/scanner.h.html#LN123"><span class='Ref_to_Proto'>scanner_finish</span></a><span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3074"><span class='Ref_To_Local'>yyscanner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fill_in_constant_lengths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * comp_location: comparator for qsorting pgssLocationLen structs by location 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3170"></a><span class='Declare_Function'>comp_location</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3172"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>l</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN3170"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN198"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span><a name="LN3173"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="pg_stat_statements.c.html#LN196"><span class='Ref_to_Struct'>pgssLocationLen</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pg_stat_statements.c.html#LN3170"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="pg_stat_statements.c.html#LN198"><span class='Ref_to_Member'>location</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3172"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>&LT; </span><a href="pg_stat_statements.c.html#LN3173"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_stat_statements.c.html#LN3172"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>&GT; </span><a href="pg_stat_statements.c.html#LN3173"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>+</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>