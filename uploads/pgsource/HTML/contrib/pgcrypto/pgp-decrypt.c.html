<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\pgcrypto\pgp-decrypt.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\pgcrypto\pgp-decrypt.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:26 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 * pgp-decrypt.c 
 *    OpenPGP decrypt. 
 * 
 * Copyright (c) 2005 Marko Kreen 
 * All rights reserved. 
 * 
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions 
 * are met: 
 * 1. Redistributions of source code must retain the above copyright 
 *    notice, this list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright 
 *    notice, this list of conditions and the following disclaimer in the 
 *    documentation and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND 
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE 
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS 
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) 
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT 
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY 
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF 
 * SUCH DAMAGE. 
 * 
 * contrib/pgcrypto/pgp-decrypt.c 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"px.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mbuf.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgp.h"</span> 
 
<a name="LN37"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NO_CTX_SIZE</span>     <span class='Number'>0</span> 
<a name="LN38"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ALLOW_CTX_SIZE</span>  <span class='Number'>1</span> 
<a name="LN39"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NO_COMPR</span>        <span class='Number'>0</span> 
<a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ALLOW_COMPR</span>     <span class='Number'>1</span> 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NO_MDC</span>          <span class='Number'>0</span> 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NEED_MDC</span>        <span class='Number'>1</span> 
 
<a name="LN44"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PKT_NORMAL</span> <span class='Number'>1</span> 
<a name="LN45"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PKT_STREAM</span> <span class='Number'>2</span> 
<a name="LN46"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PKT_CONTEXT</span> <span class='Number'>3</span> 
 
<a name="LN48"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_CHUNK</span> <span class='Parentheses'>(</span><span class='Number'>16</span><span class='Operator'>*</span><span class='Number'>1024</span><span class='Operator'>*</span><span class='Number'>1024</span><span class='Parentheses'>) 
</span> 
<span class='Keyword'>static int 
</span><a name="LN51"></a><span class='Declare_Function'>parse_new_len</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>len_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN53"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>b</span><span class='Delimiter'>; 
</span><a name="LN54"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pkttype</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN44"><span class='Ref_to_Const'>PKT_NORMAL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>&LT;= </span><span class='Number'>191</span><span class='Parentheses'>) 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>&GT;= </span><span class='Number'>192</span> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>&LT;= </span><span class='Number'>223</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>unsigned</span><span class='Parentheses'>) (</span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>192</span><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>192</span> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>== </span><span class='Number'>255</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN53"><span class='Ref_To_Local'>b</span></a> <span class='Operator'>& </span><span class='Number'>0x1F</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN55"><span class='Ref_To_Local'>pkttype</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN45"><span class='Ref_to_Const'>PKT_STREAM</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><a href="pgp-decrypt.c.html#LN48"><span class='Ref_to_Const'>MAX_CHUNK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_new_len: weird length"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN51"><span class='Ref_to_Parameter'>len_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN54"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN55"><span class='Ref_To_Local'>pkttype</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_new_len &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN94"></a><span class='Declare_Function'>parse_old_len</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>len_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN96"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>b</span><span class='Delimiter'>; 
</span><a name="LN97"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>lentype</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>lentype</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>        <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="pgp-decrypt.c.html#LN96"><span class='Ref_To_Local'>b</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><a href="pgp-decrypt.c.html#LN48"><span class='Ref_to_Const'>MAX_CHUNK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_old_len: weird length"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN94"><span class='Ref_to_Parameter'>len_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN97"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN44"><span class='Ref_to_Const'>PKT_NORMAL</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_old_len &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* returns pkttype or 0 on eof */ 
</span><span class='Keyword'>int 
</span><a name="LN128"></a><span class='Declare_Function'>pgp_parse_pkt_hdr</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>len_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>allow_ctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN130"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lentype</span><span class='Delimiter'>; 
</span><a name="LN131"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN132"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* EOF is normal here, thus we dont use GETBYTE */ 
</span>    <a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN132"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN132"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>& </span><span class='Number'>0x80</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_parse_pkt_hdr: not pkt hdr"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN132"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>& </span><span class='Number'>0x40</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>tag</span></a> <span class='Operator'>= *</span><a href="pgp-decrypt.c.html#LN132"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>& </span><span class='Number'>0x3f</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN50"><span class='Ref_to_Func'>parse_new_len</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>len_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN130"><span class='Ref_To_Local'>lentype</span></a> <span class='Operator'>= *</span><a href="pgp-decrypt.c.html#LN132"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>& </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>tag</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN132"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0x0F</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN130"><span class='Ref_To_Local'>lentype</span></a> <span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>            <a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>allow_ctx</span></a> <span class='Operator'>? </span><a href="pgp-decrypt.c.html#LN46"><span class='Ref_to_Const'>PKT_CONTEXT</span></a> <span class='Operator'>: </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN93"><span class='Ref_to_Func'>parse_old_len</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN128"><span class='Ref_to_Parameter'>len_p</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN130"><span class='Ref_To_Local'>lentype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN131"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_parse_pkt_hdr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Packet reader 
 */ 
</span><a name="LN167"></a><span class='Control'>struct</span> <span class='Declare_Struct'>PktData</span> 
<span class='Delimiter'>{ 
</span><a name="LN169"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>type</span><span class='Delimiter'>; 
</span><a name="LN170"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>len</span><span class='Delimiter'>; 
}; 
</span> 
<span class='Keyword'>static int 
</span><a name="LN174"></a><span class='Declare_Function'>pktreader_pull</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, 
</span><a name="LN175"></a>               <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>data_p</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN177"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN178"></a>    <span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN167"><span class='Ref_to_Struct'>PktData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pkt</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* PKT_CONTEXT means: whatever there is */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN169"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgp-decrypt.c.html#LN46"><span class='Ref_to_Const'>PKT_CONTEXT</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN175"><span class='Ref_to_Parameter'>data_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN170"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* this was last chunk in stream */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN169"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="pgp-decrypt.c.html#LN44"><span class='Ref_to_Const'>PKT_NORMAL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* next chunk in stream */ 
</span>        <a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN50"><span class='Ref_to_Func'>parse_new_len</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN170"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN169"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN170"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN170"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN174"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN175"><span class='Ref_to_Parameter'>data_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pgp-decrypt.c.html#LN178"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN170"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>-= </span><a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN177"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pktreader_pull &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN208"></a><span class='Declare_Function'>pktreader_free</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN210"></a>    <span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN167"><span class='Ref_to_Struct'>PktData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pkt</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN208"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span> 
    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN210"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN210"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="px.h.html#LN45"><span class='Ref_to_Macro'>px_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN210"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN216"></a><span class='Keyword'>static </span><span class='Control'>struct</span> <a href="mbuf.h.html#LN58"><span class='Ref_to_Struct'>PullFilterOps</span></a> <span class='Declare_Var'>pktreader_filter</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN173"><span class='Ref_to_Func'>pktreader_pull</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN207"><span class='Ref_to_Func'>pktreader_free</span></a> 
<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* needs helper function to pass several parameters */ 
</span><span class='Keyword'>int 
</span><a name="LN222"></a><span class='Declare_Function'>pgp_create_pkt_reader</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pf_p</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, 
</span><a name="LN223"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>pkttype</span><span class='Delimiter'>, </span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN225"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN226"></a>    <span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN167"><span class='Ref_to_Struct'>PktData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pkt</span> <span class='Operator'>= </span><a href="px.h.html#LN43"><span class='Ref_to_Macro'>px_alloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN226"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN226"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN169"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN223"><span class='Ref_to_Parameter'>pkttype</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN226"><span class='Ref_To_Local'>pkt</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN170"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN222"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN225"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN222"><span class='Ref_to_Parameter'>pf_p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN216"><span class='Ref_to_Global_Var'>pktreader_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN226"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN222"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN225"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="px.h.html#LN45"><span class='Ref_to_Macro'>px_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN226"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN225"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Prefix check filter 
 * https://tools.ietf.org/html/rfc4880#section-5.7 
 * https://tools.ietf.org/html/rfc4880#section-5.13 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN243"></a><span class='Declare_Function'>prefix_init</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>priv_p</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN245"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN243"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN246"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN247"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmpbuf</span><span class='Delimiter'>[</span><a href="pgp.h.html#LN112"><span class='Ref_to_Const'>PGP_MAX_BLOCK</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN156"><span class='Ref_to_Func'>pgp_get_cipher_block_size</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN143"><span class='Ref_to_Member'>cipher_algo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN249"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="px.h.html#LN72"><span class='Ref_to_Const'>PXE_BUG</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN247"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN107"><span class='Ref_to_Proto'>pullf_read_max</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN243"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN248"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN249"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN247"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN247"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN247"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"prefix_init: short read"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN249"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN249"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN248"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="pgp-decrypt.c.html#LN248"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN248"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="pgp-decrypt.c.html#LN248"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><a href="pgp-decrypt.c.html#LN246"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"prefix_init: corrupt prefix"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* report error in pgp_decrypt() */ 
</span>        <a href="pgp-decrypt.c.html#LN245"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN156"><span class='Ref_to_Member'>corrupt_prefix</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN249"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN249"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prefix_init &raquo; </span> 
 
<a name="LN275"></a><span class='Keyword'>static </span><span class='Control'>struct</span> <a href="mbuf.h.html#LN58"><span class='Ref_to_Struct'>PullFilterOps</span></a> <span class='Declare_Var'>prefix_filter</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <a href="pgp-decrypt.c.html#LN242"><span class='Ref_to_Func'>prefix_init</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL 
</span><span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Decrypt filter 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN285"></a><span class='Declare_Function'>decrypt_init</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>priv_p</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN287"></a>    <a href="pgp-cfb.c.html#LN38"><span class='Ref_to_Struct'>PGP_CFB</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cfb</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN285"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN285"><span class='Ref_to_Parameter'>priv_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN287"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we need to write somewhere, so ask for a buffer */ 
</span>    <span class='Control'>return</span> <span class='Number'>4096</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN296"></a><span class='Declare_Function'>decrypt_read</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, 
</span><a name="LN297"></a>             <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>data_p</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN299"></a>    <a href="pgp-cfb.c.html#LN38"><span class='Ref_to_Struct'>PGP_CFB</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cfb</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN296"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span><a name="LN300"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN301"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN301"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN296"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN296"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN300"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN301"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-cfb.c.html#LN257"><span class='Ref_to_Func'>pgp_cfb_decrypt</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN299"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN300"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN301"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN297"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN297"><span class='Ref_to_Parameter'>data_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN297"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN301"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<a name="LN312"></a><span class='Control'>struct</span> <a href="mbuf.h.html#LN58"><span class='Ref_to_Struct'>PullFilterOps</span></a> <span class='Declare_Var'>pgp_decrypt_filter</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <a href="pgp-decrypt.c.html#LN284"><span class='Ref_to_Func'>decrypt_init</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN295"><span class='Ref_to_Func'>decrypt_read</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL 
</span><span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * MDC hasher filter 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN322"></a><span class='Declare_Function'>mdc_init</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>priv_p</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN324"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN322"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN322"><span class='Ref_to_Parameter'>priv_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN324"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp.c.html#LN182"><span class='Ref_to_Func'>pgp_load_digest</span></a><span class='Parentheses'>(</span><a href="pgp.h.html#LN100"><span class='Ref_to_EnumConst'>PGP_DIGEST_SHA1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN324"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN331"></a><span class='Declare_Function'>mdc_free</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN333"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN331"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN333"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN160"><span class='Ref_to_Member'>use_mdcbuf_filter</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="px.h.html#LN209"><span class='Ref_to_Macro'>px_md_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN333"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN333"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN342"></a><span class='Declare_Function'>mdc_finish</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN344"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN345"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>hash</span><span class='Delimiter'>[</span><span class='Number'>20</span><span class='Delimiter'>]; 
</span><a name="LN346"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmpbuf</span><span class='Delimiter'>[</span><span class='Number'>20</span><span class='Delimiter'>]; 
</span><a name="LN347"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* should not happen */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN160"><span class='Ref_to_Member'>use_mdcbuf_filter</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN72"><span class='Ref_to_Const'>PXE_BUG</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's SHA1 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>!= </span><span class='Number'>20</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* mdc_read should not call md_update */ 
</span>    <a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN159"><span class='Ref_to_Member'>in_mdc_pkt</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read data */ 
</span>    <a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN107"><span class='Ref_to_Proto'>pullf_read_max</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN347"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN346"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"no mdc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* is the packet sane? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Number'>20</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"mdc_finish: read failed, res=%d"</span><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ok, we got the hash, now check 
     */ 
</span>    <a href="px.h.html#LN208"><span class='Ref_to_Macro'>px_md_finish</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN345"><span class='Ref_To_Local'>hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN345"><span class='Ref_To_Local'>hash</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN347"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN345"><span class='Ref_To_Local'>hash</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN346"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN346"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN344"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"mdc_finish: mdc failed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pgp-decrypt.c.html#LN342"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN155"><span class='Ref_to_Member'>mdc_checked</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mdc_finish &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN394"></a><span class='Declare_Function'>mdc_read</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, 
</span><a name="LN395"></a>         <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>data_p</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN398"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN394"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* skip this filter? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN398"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN160"><span class='Ref_to_Member'>use_mdcbuf_filter</span></a> <span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN398"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN159"><span class='Ref_to_Member'>in_mdc_pkt</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN394"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN394"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN395"><span class='Ref_to_Parameter'>data_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN397"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN394"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN394"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN395"><span class='Ref_to_Parameter'>data_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN397"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN397"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN397"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"mdc_read: unexpected eof"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="px.h.html#LN207"><span class='Ref_to_Macro'>px_md_update</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN398"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN395"><span class='Ref_to_Parameter'>data_p</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN397"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN397"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mdc_read &raquo; </span> 
 
<a name="LN417"></a><span class='Keyword'>static </span><span class='Control'>struct</span> <a href="mbuf.h.html#LN58"><span class='Ref_to_Struct'>PullFilterOps</span></a> <span class='Declare_Var'>mdc_filter</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <a href="pgp-encrypt.c.html#LN93"><span class='Ref_to_Func'>mdc_init</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN393"><span class='Ref_to_Func'>mdc_read</span></a><span class='Delimiter'>, </span><a href="pgp-encrypt.c.html#LN136"><span class='Ref_to_Func'>mdc_free</span></a> 
<span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Combined Pkt reader and MDC hasher. 
 * 
 * For the case of SYMENCRYPTED_MDC packet, where 
 * the data part has 'context length', which means 
 * that data packet ends 22 bytes before end of parent 
 * packet, which is silly. 
 */ 
</span><a name="LN430"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MDCBUF_LEN</span> <span class='Number'>8192</span> 
<a name="LN431"></a><span class='Control'>struct</span> <span class='Declare_Struct'>MDCBufData</span> 
<span class='Delimiter'>{ 
</span><a name="LN433"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Member'>ctx</span><span class='Delimiter'>; 
</span><a name="LN434"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>eof</span><span class='Delimiter'>; 
</span><a name="LN435"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>buflen</span><span class='Delimiter'>; 
</span><a name="LN436"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>avail</span><span class='Delimiter'>; 
</span><a name="LN437"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>pos</span><span class='Delimiter'>; 
</span><a name="LN438"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>mdc_avail</span><span class='Delimiter'>; 
</span><a name="LN439"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Member'>mdc_buf</span><span class='Delimiter'>[</span><span class='Number'>22</span><span class='Delimiter'>]; 
</span><a name="LN440"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Member'>buf</span><span class='Delimiter'>[</span><a href="pgp-decrypt.c.html#LN430"><span class='Ref_to_Const'>MDCBUF_LEN</span></a><span class='Delimiter'>]; 
}; 
</span> 
<span class='Keyword'>static int 
</span><a name="LN444"></a><span class='Declare_Function'>mdcbuf_init</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Declare_Parameter'>priv_p</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN446"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN444"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN447"></a>    <span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><a href="px.h.html#LN43"><span class='Ref_to_Macro'>px_alloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN435"><span class='Ref_to_Member'>buflen</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN440"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN433"><span class='Ref_to_Member'>ctx</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN446"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN444"><span class='Ref_to_Parameter'>priv_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN447"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* take over the work of mdc_filter */ 
</span>    <a href="pgp-decrypt.c.html#LN446"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN160"><span class='Ref_to_Member'>use_mdcbuf_filter</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN462"></a><span class='Declare_Function'>mdcbuf_finish</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>st</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN464"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>hash</span><span class='Delimiter'>[</span><span class='Number'>20</span><span class='Delimiter'>]; 
</span><a name="LN465"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN434"><span class='Ref_to_Member'>eof</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0xD3</span> <span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0x14</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"mdcbuf_finish: bad MDC pkt hdr"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="px.h.html#LN207"><span class='Ref_to_Macro'>px_md_update</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN433"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="px.h.html#LN208"><span class='Ref_to_Macro'>px_md_finish</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN433"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN464"><span class='Ref_To_Local'>hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN465"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN464"><span class='Ref_To_Local'>hash</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN462"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN464"><span class='Ref_To_Local'>hash</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>20</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN465"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"mdcbuf_finish: MDC does not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN465"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN465"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mdcbuf_finish &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN487"></a><span class='Declare_Function'>mdcbuf_load_data</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN489"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dst</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN437"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN489"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="px.h.html#LN207"><span class='Ref_to_Macro'>px_md_update</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN433"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a> <span class='Operator'>+= </span><a href="pgp-decrypt.c.html#LN487"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN497"></a><span class='Declare_Function'>mdcbuf_load_mdc</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../src/include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN497"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN497"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN497"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN497"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN497"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a> <span class='Operator'>+= </span><a href="pgp-decrypt.c.html#LN497"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN504"></a><span class='Declare_Function'>mdcbuf_refill</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN506"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN507"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN508"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>need</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* put avail data in start */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN437"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>!= </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN440"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN440"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN437"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN437"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN440"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read new data */ 
</span>    <a href="pgp-decrypt.c.html#LN508"><span class='Ref_To_Local'>need</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN435"><span class='Ref_to_Member'>buflen</span></a> <span class='Operator'>+ </span><span class='Number'>22</span> <span class='Operator'>- </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a> <span class='Operator'>- </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN508"><span class='Ref_To_Local'>need</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN506"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN461"><span class='Ref_to_Func'>mdcbuf_finish</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* add to buffer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;= </span><span class='Number'>22</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN486"><span class='Ref_to_Func'>mdcbuf_load_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-decrypt.c.html#LN486"><span class='Ref_to_Func'>mdcbuf_load_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN506"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>- </span><span class='Number'>22</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN496"><span class='Ref_to_Func'>mdcbuf_load_mdc</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN506"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>- </span><span class='Number'>22</span><span class='Delimiter'>, </span><span class='Number'>22</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN534"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>canmove</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>- </span><span class='Number'>22</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN534"><span class='Ref_To_Local'>canmove</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgp-decrypt.c.html#LN486"><span class='Ref_to_Func'>mdcbuf_load_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN534"><span class='Ref_To_Local'>canmove</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a> <span class='Operator'>-= </span><a href="pgp-decrypt.c.html#LN534"><span class='Ref_To_Local'>canmove</span></a><span class='Delimiter'>; 
</span>            <a href="../../src/include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN439"><span class='Ref_to_Member'>mdc_buf</span></a> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN534"><span class='Ref_To_Local'>canmove</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN438"><span class='Ref_to_Member'>mdc_avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgp-decrypt.c.html#LN496"><span class='Ref_to_Func'>mdcbuf_load_mdc</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN504"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN506"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN507"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mdcbuf_refill &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN548"></a><span class='Declare_Function'>mdcbuf_read</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, 
</span><a name="LN549"></a>            <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>data_p</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>buflen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN551"></a>    <span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span><a name="LN552"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN434"><span class='Ref_to_Member'>eof</span></a> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN503"><span class='Ref_to_Func'>mdcbuf_refill</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN552"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN549"><span class='Ref_to_Parameter'>data_p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN437"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN437"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+= </span><a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN551"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN436"><span class='Ref_to_Member'>avail</span></a> <span class='Operator'>-= </span><a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN548"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mdcbuf_read &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN571"></a><span class='Declare_Function'>mdcbuf_free</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>priv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN573"></a>    <span class='Control'>struct</span> <a href="pgp-decrypt.c.html#LN431"><span class='Ref_to_Struct'>MDCBufData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN571"><span class='Ref_to_Parameter'>priv</span></a><span class='Delimiter'>; 
</span> 
    <a href="px.h.html#LN209"><span class='Ref_to_Macro'>px_md_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN573"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN433"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN573"><span class='Ref_To_Local'>st</span></a><span class='Operator'>-&GT;</span><a href="pgp-decrypt.c.html#LN433"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN161"><span class='Ref_to_Member'>mdc_ctx</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN573"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN573"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="px.h.html#LN45"><span class='Ref_to_Macro'>px_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN573"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN581"></a><span class='Keyword'>static </span><span class='Control'>struct</span> <a href="mbuf.h.html#LN58"><span class='Ref_to_Struct'>PullFilterOps</span></a> <span class='Declare_Var'>mdcbuf_filter</span> <span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <a href="pgp-decrypt.c.html#LN443"><span class='Ref_to_Func'>mdcbuf_init</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN547"><span class='Ref_to_Func'>mdcbuf_read</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN570"><span class='Ref_to_Func'>mdcbuf_free</span></a> 
<span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Decrypt separate session key 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN590"></a><span class='Declare_Function'>decrypt_key</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN592"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN593"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>algo</span><span class='Delimiter'>; 
</span><a name="LN594"></a>    <a href="pgp-cfb.c.html#LN38"><span class='Ref_to_Struct'>PGP_CFB</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cfb</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN592"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-cfb.c.html#LN50"><span class='Ref_to_Func'>pgp_cfb_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN594"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN142"><span class='Ref_to_Member'>s2k_cipher_algo</span></a><span class='Delimiter'>, 
</span>                         <a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN128"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN129"><span class='Ref_to_Member'>key_len</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN592"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN592"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-cfb.c.html#LN257"><span class='Ref_to_Func'>pgp_cfb_decrypt</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN594"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN593"><span class='Ref_To_Local'>algo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-cfb.c.html#LN257"><span class='Ref_to_Func'>pgp_cfb_decrypt</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN594"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN170"><span class='Ref_to_Member'>sess_key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-cfb.c.html#LN82"><span class='Ref_to_Func'>pgp_cfb_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN594"><span class='Ref_To_Local'>cfb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN171"><span class='Ref_to_Member'>sess_key_len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN143"><span class='Ref_to_Member'>cipher_algo</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN593"><span class='Ref_To_Local'>algo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp.c.html#LN146"><span class='Ref_to_Func'>pgp_get_cipher_key_size</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN593"><span class='Ref_To_Local'>algo</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"sesskey bad len: algo=%d, expected=%d, got=%d"</span><span class='Delimiter'>, 
</span>                 <a href="pgp-decrypt.c.html#LN593"><span class='Ref_To_Local'>algo</span></a><span class='Delimiter'>, </span><a href="pgp.c.html#LN146"><span class='Ref_to_Func'>pgp_get_cipher_key_size</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN593"><span class='Ref_To_Local'>algo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN590"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end decrypt_key &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Handle key packet 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN623"></a><span class='Declare_Function'>parse_symenc_sesskey</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN625"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN626"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN627"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmpbuf</span><span class='Delimiter'>[</span><a href="pgp.h.html#LN111"><span class='Ref_to_Const'>PGP_MAX_KEY</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN628"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>ver</span><span class='Delimiter'>; 
</span> 
    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN628"><span class='Ref_To_Local'>ver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN142"><span class='Ref_to_Member'>s2k_cipher_algo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN628"><span class='Ref_To_Local'>ver</span></a> <span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"bad key pkt ver"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * read S2K info 
     */ 
</span>    <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-s2k.c.html#LN253"><span class='Ref_to_Func'>pgp_s2k_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN139"><span class='Ref_to_Member'>s2k_mode</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN123"><span class='Ref_to_Member'>mode</span></a><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN140"><span class='Ref_to_Member'>s2k_count</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN175"><span class='Ref_to_Macro'>s2k_decode_count</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN126"><span class='Ref_to_Member'>iter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN141"><span class='Ref_to_Member'>s2k_digest_algo</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN124"><span class='Ref_to_Member'>digest_algo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * generate key from password 
     */ 
</span>    <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN277"><span class='Ref_to_Proto'>pgp_s2k_process</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN142"><span class='Ref_to_Member'>s2k_cipher_algo</span></a><span class='Delimiter'>, 
</span>                          <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN164"><span class='Ref_to_Member'>sym_key</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN165"><span class='Ref_to_Member'>sym_key_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * do we have separate session key? 
     */ 
</span>    <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN107"><span class='Ref_to_Proto'>pullf_read_max</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp.h.html#LN111"><span class='Ref_to_Const'>PGP_MAX_KEY</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN625"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN627"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * no, s2k key is session key 
         */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN170"><span class='Ref_to_Member'>sess_key</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN128"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN129"><span class='Ref_to_Member'>key_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN171"><span class='Ref_to_Member'>sess_key_len</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN138"><span class='Ref_to_Member'>s2k</span></a><span class='Operator'>.</span><a href="pgp.h.html#LN129"><span class='Ref_to_Member'>key_len</span></a><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN143"><span class='Ref_to_Member'>cipher_algo</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN142"><span class='Ref_to_Member'>s2k_cipher_algo</span></a><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN147"><span class='Ref_to_Member'>use_sess_key</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * yes, decrypt it 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>17</span> <span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT; </span><a href="pgp.h.html#LN111"><span class='Ref_to_Const'>PGP_MAX_KEY</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"expect key, but bad data"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN147"><span class='Ref_to_Member'>use_sess_key</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN589"><span class='Ref_to_Func'>decrypt_key</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN623"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN625"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN627"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN627"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN626"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_symenc_sesskey &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN693"></a><span class='Declare_Function'>copy_crlf</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>got_cr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN695"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data_end</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+ </span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span><a name="LN696"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmpbuf</span><span class='Delimiter'>[</span><span class='Number'>1024</span><span class='Delimiter'>]; 
</span><a name="LN697"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tmp_end</span> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN698"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN699"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>got_cr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = </span><span class='String'>'\r'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>got_cr</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>&LT; </span><a href="pgp-decrypt.c.html#LN695"><span class='Ref_To_Local'>data_end</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="pgp-decrypt.c.html#LN695"><span class='Ref_To_Local'>data_end</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span> 
                    <a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>got_cr</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ = *</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT;= </span><a href="pgp-decrypt.c.html#LN697"><span class='Ref_To_Local'>tmp_end</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgp-decrypt.c.html#LN699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN85"><span class='Ref_to_Proto'>mbuf_append</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN699"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>            <a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while data&LT;data_end &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN85"><span class='Ref_to_Proto'>mbuf_append</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN693"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN699"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN699"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN696"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end copy_crlf &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN743"></a><span class='Declare_Function'>parse_literal_data</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pkt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN745"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN746"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>name_len</span><span class='Delimiter'>; 
</span><a name="LN747"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN748"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN749"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmpbuf</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN750"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>got_cr</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN745"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN746"><span class='Ref_To_Local'>name_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* skip name */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN746"><span class='Ref_To_Local'>name_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN746"><span class='Ref_To_Local'>name_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN748"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN746"><span class='Ref_To_Local'>name_len</span></a> <span class='Operator'>-= </span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN746"><span class='Ref_To_Local'>name_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_literal_data: unexpected eof"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* skip date */ 
</span>    <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN107"><span class='Ref_to_Proto'>pullf_read_max</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN748"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN749"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_literal_data: unexpected eof"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN749"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If called from an SQL function that returns text, pgp_decrypt() rejects 
     * inputs not self-identifying as text. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN148"><span class='Ref_to_Member'>text_mode</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN745"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><span class='String'>'t'</span> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN745"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>!= </span><span class='String'>'u'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_literal_data: data type=%c"</span><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN745"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN158"><span class='Ref_to_Member'>unexpected_binary</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
    <a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN150"><span class='Ref_to_Member'>unicode_mode</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN745"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><span class='String'>'u'</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read data */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><span class='Number'>32</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN748"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN148"><span class='Ref_to_Member'>text_mode</span></a> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN149"><span class='Ref_to_Member'>convert_crlf</span></a><span class='Parentheses'>) 
</span>            <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN692"><span class='Ref_to_Func'>copy_crlf</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN748"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN750"><span class='Ref_To_Local'>got_cr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN85"><span class='Ref_to_Proto'>mbuf_append</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN748"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN750"><span class='Ref_To_Local'>got_cr</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN85"><span class='Ref_to_Proto'>mbuf_append</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN743"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"\r"</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN747"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_literal_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* process_data_packets and parse_compressed_data call each other */ 
</span><a name="LN813"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>process_data_packets</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, 
</span><a name="LN814"></a>                     <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>allow_compr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>need_mdc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static int 
</span><a name="LN817"></a><span class='Declare_Function'>parse_compressed_data</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pkt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN819"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN820"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN821"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pf_decompr</span><span class='Delimiter'>; 
</span><a name="LN822"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>discard_buf</span><span class='Delimiter'>; 
</span> 
    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN820"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN144"><span class='Ref_to_Member'>compress_algo</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN820"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN820"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="pgp.h.html#LN91"><span class='Ref_to_EnumConst'>PGP_COMPR_NONE</span></a><span class='Operator'>: 
</span>            <a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN813"><span class='Ref_to_Proto'>process_data_packets</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN39"><span class='Ref_to_Const'>NO_COMPR</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN41"><span class='Ref_to_Const'>NO_MDC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pgp.h.html#LN92"><span class='Ref_to_EnumConst'>PGP_COMPR_ZIP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="pgp.h.html#LN93"><span class='Ref_to_EnumConst'>PGP_COMPR_ZLIB</span></a><span class='Operator'>: 
</span>            <a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN293"><span class='Ref_to_Proto'>pgp_decompress_filter</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN821"><span class='Ref_To_Local'>pf_decompr</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN813"><span class='Ref_to_Proto'>process_data_packets</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN821"><span class='Ref_To_Local'>pf_decompr</span></a><span class='Delimiter'>, 
</span>                                           <a href="pgp-decrypt.c.html#LN39"><span class='Ref_to_Const'>NO_COMPR</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN41"><span class='Ref_to_Const'>NO_MDC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN821"><span class='Ref_To_Local'>pf_decompr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="pgp.h.html#LN94"><span class='Ref_to_EnumConst'>PGP_COMPR_BZIP2</span></a><span class='Operator'>: 
</span>            <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_compressed_data: bzip2 unsupported"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* report error in pgp_decrypt() */ 
</span>            <a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN157"><span class='Ref_to_Member'>unsupported_compr</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Discard the compressed data, allowing it to first affect any 
             * MDC digest computation. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN817"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><span class='Number'>32</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN822"><span class='Ref_To_Local'>discard_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_compressed_data: unknown compr type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch type &raquo; </span> 
 
    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN819"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_compressed_data &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN871"></a><span class='Declare_Function'>process_data_packets</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, 
</span><a name="LN872"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>allow_compr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>need_mdc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN874"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tag</span><span class='Delimiter'>; 
</span><a name="LN875"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>, 
</span><a name="LN876"></a>                <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN877"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>got_data</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN878"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>got_mdc</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN879"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pkt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN127"><span class='Ref_to_Func'>pgp_parse_pkt_hdr</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN874"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN875"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN38"><span class='Ref_to_Const'>ALLOW_CTX_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
 
        <span class='Comment_Multi_Line'>/* mdc packet should be last */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN878"><span class='Ref_To_Local'>got_mdc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: data after mdc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* context length inside SYMENC_MDC needs special handling */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN872"><span class='Ref_to_Parameter'>need_mdc</span></a> <span class='Operator'>&& </span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><a href="pgp-decrypt.c.html#LN46"><span class='Ref_to_Const'>PKT_CONTEXT</span></a><span class='Parentheses'>) 
</span>            <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN581"><span class='Ref_to_Global_Var'>mdcbuf_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN221"><span class='Ref_to_Func'>pgp_create_pkt_reader</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN875"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN874"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN55"><span class='Ref_to_EnumConst'>PGP_PKT_LITERAL_DATA</span></a><span class='Operator'>: 
</span>                <a href="pgp-decrypt.c.html#LN877"><span class='Ref_To_Local'>got_data</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN742"><span class='Ref_to_Func'>parse_literal_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN52"><span class='Ref_to_EnumConst'>PGP_PKT_COMPRESSED_DATA</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN872"><span class='Ref_to_Parameter'>allow_compr</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: unexpected compression"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN877"><span class='Ref_To_Local'>got_data</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * compr data must be alone 
                     */ 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: only one cmpr pkt allowed"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgp-decrypt.c.html#LN877"><span class='Ref_To_Local'>got_data</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN816"><span class='Ref_to_Func'>parse_compressed_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN61"><span class='Ref_to_EnumConst'>PGP_PKT_MDC</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN872"><span class='Ref_to_Parameter'>need_mdc</span></a> <span class='Operator'>== </span><a href="pgp-decrypt.c.html#LN41"><span class='Ref_to_Const'>NO_MDC</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: unexpected MDC"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN341"><span class='Ref_to_Func'>mdc_finish</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN875"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="pgp-decrypt.c.html#LN878"><span class='Ref_To_Local'>got_mdc</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: unexpected pkt tag=%d"</span><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN874"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tag &raquo; </span> 
 
        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while 1 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN879"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-decrypt.c.html#LN877"><span class='Ref_To_Local'>got_data</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: no data"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN872"><span class='Ref_to_Parameter'>need_mdc</span></a> <span class='Operator'>&& !</span><a href="pgp-decrypt.c.html#LN878"><span class='Ref_To_Local'>got_mdc</span></a> <span class='Operator'>&& !</span><a href="pgp-decrypt.c.html#LN871"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN160"><span class='Ref_to_Member'>use_mdcbuf_filter</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"process_data_packets: got no mdc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN876"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_data_packets &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN974"></a><span class='Declare_Function'>parse_symenc_data</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pkt</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN976"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN977"></a>    <a href="pgp-cfb.c.html#LN38"><span class='Ref_to_Struct'>PGP_CFB</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cfb</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN978"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pf_decrypt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN979"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pf_prefix</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-cfb.c.html#LN50"><span class='Ref_to_Func'>pgp_cfb_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN977"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN143"><span class='Ref_to_Member'>cipher_algo</span></a><span class='Delimiter'>, 
</span>                         <a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN170"><span class='Ref_to_Member'>sess_key</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN171"><span class='Ref_to_Member'>sess_key_len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN996"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN978"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN312"><span class='Ref_to_Global_Var'>pgp_decrypt_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN977"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN996"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN979"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN275"><span class='Ref_to_Global_Var'>prefix_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN978"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN996"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN813"><span class='Ref_to_Proto'>process_data_packets</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN974"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN979"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN40"><span class='Ref_to_Const'>ALLOW_COMPR</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN41"><span class='Ref_to_Const'>NO_MDC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN996"></a><span class='Label'>out</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN979"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN979"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN978"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN978"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN977"><span class='Ref_To_Local'>cfb</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-cfb.c.html#LN82"><span class='Ref_to_Func'>pgp_cfb_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN977"><span class='Ref_To_Local'>cfb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN976"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_symenc_data &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN1008"></a><span class='Declare_Function'>parse_symenc_mdc_data</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pkt</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1010"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1011"></a>    <a href="pgp-cfb.c.html#LN38"><span class='Ref_to_Struct'>PGP_CFB</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cfb</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1012"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pf_decrypt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1013"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pf_prefix</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1014"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pf_mdc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1015"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>ver</span><span class='Delimiter'>; 
</span> 
    <a href="../hstore/hstore_gist.c.html#LN31"><span class='Ref_to_Macro'>GETBYTE</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1015"><span class='Ref_To_Local'>ver</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1015"><span class='Ref_To_Local'>ver</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"parse_symenc_mdc_data: pkt ver != 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-cfb.c.html#LN50"><span class='Ref_to_Func'>pgp_cfb_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1011"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN143"><span class='Ref_to_Member'>cipher_algo</span></a><span class='Delimiter'>, 
</span>                         <a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN170"><span class='Ref_to_Member'>sess_key</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN171"><span class='Ref_to_Member'>sess_key_len</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN1043"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1012"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN312"><span class='Ref_to_Global_Var'>pgp_decrypt_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1011"><span class='Ref_To_Local'>cfb</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN1043"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1014"><span class='Ref_To_Local'>pf_mdc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-encrypt.c.html#LN144"><span class='Ref_to_Global_Var'>mdc_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1012"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN1043"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN104"><span class='Ref_to_Proto'>pullf_create</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1013"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN275"><span class='Ref_to_Global_Var'>prefix_filter</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1014"><span class='Ref_To_Local'>pf_mdc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="pgp-decrypt.c.html#LN1043"><span class='Ref_to_Label'>out</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN813"><span class='Ref_to_Proto'>process_data_packets</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1008"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1013"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN40"><span class='Ref_to_Const'>ALLOW_COMPR</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN42"><span class='Ref_to_Const'>NEED_MDC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN1043"></a><span class='Label'>out</span><span class='Operator'>: 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1013"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1013"><span class='Ref_To_Local'>pf_prefix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1014"><span class='Ref_To_Local'>pf_mdc</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1014"><span class='Ref_To_Local'>pf_mdc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1012"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1012"><span class='Ref_To_Local'>pf_decrypt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1011"><span class='Ref_To_Local'>cfb</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-cfb.c.html#LN82"><span class='Ref_to_Func'>pgp_cfb_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1011"><span class='Ref_To_Local'>cfb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN1010"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_symenc_mdc_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * skip over packet contents 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1060"></a><span class='Declare_Function'>pgp_skip_packet</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pkt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1062"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1063"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1062"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pgp-decrypt.c.html#LN1062"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1060"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><span class='Number'>32</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1063"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN1062"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * expect to be at packet end, any data is error 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1074"></a><span class='Declare_Function'>pgp_expect_packet_end</span><span class='Parentheses'>(</span><a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pkt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1076"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1077"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN1076"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN106"><span class='Ref_to_Proto'>pullf_read</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1074"><span class='Ref_to_Parameter'>pkt</span></a><span class='Delimiter'>, </span><span class='Number'>32</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1077"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1076"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_expect_packet_end: got data"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN1076"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>int 
</span><a name="LN1089"></a><span class='Declare_Function'>pgp_decrypt</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>msrc</span><span class='Delimiter'>, </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mdst</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1091"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1092"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1093"></a>    <a href="mbuf.c.html#LN194"><span class='Ref_to_Struct'>PullFilter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pkt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1094"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tag</span><span class='Delimiter'>; 
</span><a name="LN1095"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1096"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>got_key</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1097"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>got_data</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN112"><span class='Ref_to_Proto'>pullf_create_mbuf_reader</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1092"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>msrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN127"><span class='Ref_to_Func'>pgp_parse_pkt_hdr</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1092"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1094"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1095"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN37"><span class='Ref_to_Const'>NO_CTX_SIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN221"><span class='Ref_to_Func'>pgp_create_pkt_reader</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1092"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1095"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1094"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN54"><span class='Ref_to_EnumConst'>PGP_PKT_MARKER</span></a><span class='Operator'>: 
</span>                <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN305"><span class='Ref_to_Proto'>pgp_skip_packet</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN46"><span class='Ref_to_EnumConst'>PGP_PKT_PUBENCRYPTED_SESSKEY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* fixme: skip those */ 
</span>                <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pubdec.c.html#LN148"><span class='Ref_to_Func'>pgp_parse_pubenc_sesskey</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pgp-decrypt.c.html#LN1096"><span class='Ref_To_Local'>got_key</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN48"><span class='Ref_to_EnumConst'>PGP_PKT_SYMENCRYPTED_SESSKEY</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1096"><span class='Ref_To_Local'>got_key</span></a><span class='Parentheses'>) 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Theoretically, there could be several keys, both public 
                     * and symmetric, all of which encrypt same session key. 
                     * Decrypt should try with each one, before failing. 
                     */ 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_decrypt: using first of several keys"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgp-decrypt.c.html#LN1096"><span class='Ref_To_Local'>got_key</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN622"><span class='Ref_to_Func'>parse_symenc_sesskey</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN53"><span class='Ref_to_EnumConst'>PGP_PKT_SYMENCRYPTED_DATA</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-decrypt.c.html#LN1096"><span class='Ref_To_Local'>got_key</span></a><span class='Parentheses'>) 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_decrypt: have data but no key"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1097"><span class='Ref_To_Local'>got_data</span></a><span class='Parentheses'>) 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_decrypt: got second data packet"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgp-decrypt.c.html#LN1097"><span class='Ref_To_Local'>got_data</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN146"><span class='Ref_to_Member'>disable_mdc</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN973"><span class='Ref_to_Func'>parse_symenc_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>mdst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="pgp.h.html#LN60"><span class='Ref_to_EnumConst'>PGP_PKT_SYMENCRYPTED_DATA_MDC</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-decrypt.c.html#LN1096"><span class='Ref_To_Local'>got_key</span></a><span class='Parentheses'>) 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_decrypt: have data but no key"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1097"><span class='Ref_To_Local'>got_data</span></a><span class='Parentheses'>) 
</span>                    <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_decrypt: several data pkts not supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="pgp-decrypt.c.html#LN1097"><span class='Ref_To_Local'>got_data</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN146"><span class='Ref_to_Member'>disable_mdc</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-decrypt.c.html#LN1007"><span class='Ref_to_Func'>parse_symenc_mdc_data</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>mdst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="px.c.html#LN158"><span class='Ref_to_Func'>px_debug</span></a><span class='Parentheses'>(</span><span class='String'>"pgp_decrypt: unknown tag: 0x%02x"</span><span class='Delimiter'>, </span><a href="pgp-decrypt.c.html#LN1094"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tag &raquo; </span> 
        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while res&GT;=0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1093"><span class='Ref_To_Local'>pkt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1092"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>) 
</span>        <a href="mbuf.h.html#LN109"><span class='Ref_to_Proto'>pullf_free</span></a><span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1092"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Report a failure of the prefix_init() "quick check" now, rather than 
     * upon detection, to hinder timing attacks.  pgcrypto is not generally 
     * secure against timing attacks, but this helps. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-decrypt.c.html#LN1097"><span class='Ref_To_Local'>got_data</span></a> <span class='Operator'>|| </span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN156"><span class='Ref_to_Member'>corrupt_prefix</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN80"><span class='Ref_to_Const'>PXE_PGP_CORRUPT_DATA</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Code interpreting purportedly-decrypted data prior to this stage shall 
     * report no error other than PXE_PGP_CORRUPT_DATA.  (PXE_BUG is okay so 
     * long as it remains unreachable.)  This ensures that an attacker able to 
     * choose a ciphertext and receive a corresponding decryption error 
     * message cannot use that oracle to gather clues about the decryption 
     * key.  See "An Attack on CFB Mode Encryption As Used By OpenPGP" by 
     * Serge Mister and Robert Zuccherato. 
     * 
     * A problematic value in the first octet of a Literal Data or Compressed 
     * Data packet may indicate a simple user error, such as the need to call 
     * pgp_sym_decrypt_bytea instead of pgp_sym_decrypt.  Occasionally, 
     * though, it is the first symptom of the encryption key not matching the 
     * decryption key.  When this was the only problem encountered, report a 
     * specific error to guide the user; otherwise, we will have reported 
     * PXE_PGP_CORRUPT_DATA before now.  A key mismatch makes the other errors 
     * into red herrings, and this avoids leaking clues to attackers. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN157"><span class='Ref_to_Member'>unsupported_compr</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN82"><span class='Ref_to_Const'>PXE_PGP_UNSUPPORTED_COMPR</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-decrypt.c.html#LN1089"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN158"><span class='Ref_to_Member'>unexpected_binary</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="px.h.html#LN86"><span class='Ref_to_Const'>PXE_PGP_NOT_TEXT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-decrypt.c.html#LN1091"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_decrypt &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>