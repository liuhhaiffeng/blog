<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\pgcrypto\pgp-pgsql.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\pgcrypto\pgp-pgsql.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:26 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/* 
 * pgp-pgsql.c 
 *      PostgreSQL wrappers for pgp. 
 * 
 * Copyright (c) 2005 Marko Kreen 
 * All rights reserved. 
 * 
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions 
 * are met: 
 * 1. Redistributions of source code must retain the above copyright 
 *    notice, this list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright 
 *    notice, this list of conditions and the following disclaimer in the 
 *    documentation and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND 
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE 
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL 
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS 
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) 
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT 
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY 
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF 
 * SUCH DAMAGE. 
 * 
 * contrib/pgcrypto/pgp-pgsql.c 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"mbuf.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"px.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgp.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * public functions 
 */ 
</span><a name="LN47"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN565"><span class='Ref_to_Func'>pgp_sym_encrypt_bytea</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN587"><span class='Ref_to_Func'>pgp_sym_encrypt_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN610"><span class='Ref_to_Func'>pgp_sym_decrypt_bytea</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN632"><span class='Ref_to_Func'>pgp_sym_decrypt_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN52"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN658"><span class='Ref_to_Func'>pgp_pub_encrypt_bytea</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN680"><span class='Ref_to_Func'>pgp_pub_encrypt_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN703"><span class='Ref_to_Func'>pgp_pub_decrypt_bytea</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN730"><span class='Ref_to_Func'>pgp_pub_decrypt_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN57"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN998"><span class='Ref_to_Func'>pgp_key_id_w</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN59"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN856"><span class='Ref_to_Func'>pg_armor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN894"><span class='Ref_to_Func'>pg_dearmor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN61"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN928"><span class='Ref_to_Func'>pgp_armor_headers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * returns src in case of no conversion or error 
 */ 
</span><span class='Keyword'>static </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN67"></a><span class='Declare_Function'>convert_charset</span><span class='Parentheses'>(</span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cset_from</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cset_to</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN69"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>src_len</span> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN67"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Local'>dst</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Local'>csrc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN67"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN70"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><a href="../../src/backend/utils/mb/mbutils.c.html#LN335"><span class='Ref_to_Func'>pg_do_encoding_conversion</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN71"><span class='Ref_To_Local'>csrc</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN69"><span class='Ref_To_Local'>src_len</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN67"><span class='Ref_to_Parameter'>cset_from</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN67"><span class='Ref_to_Parameter'>cset_to</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN70"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>== </span><a href="pgp-pgsql.c.html#LN71"><span class='Ref_To_Local'>csrc</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN67"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN72"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgp-pgsql.c.html#LN70"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN70"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN72"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN84"></a><span class='Declare_Function'>convert_from_utf8</span><span class='Parentheses'>(</span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN66"><span class='Ref_to_Func'>convert_charset</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN84"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="../../src/fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Delimiter'>, </span><a href="../../src/include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN90"></a><span class='Declare_Function'>convert_to_utf8</span><span class='Parentheses'>(</span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN66"><span class='Ref_to_Func'>convert_charset</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN90"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="../../src/include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../src/fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN96"></a><span class='Declare_Function'>string_is_ascii</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN98"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN98"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN96"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN98"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="pgp-pgsql.c.html#LN98"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN98"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN109"></a><span class='Declare_Function'>clear_and_pfree</span><span class='Parentheses'>(</span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="px.c.html#LN132"><span class='Ref_to_Func'>px_memset</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN109"><span class='Ref_to_Parameter'>p</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../src/include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN109"><span class='Ref_to_Parameter'>p</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN109"><span class='Ref_to_Parameter'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * expect-* arguments storage 
 */ 
</span><a name="LN118"></a><span class='Control'>struct</span> <span class='Declare_Struct'>debug_expect</span> 
<span class='Delimiter'>{ 
</span><a name="LN120"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>debug</span><span class='Delimiter'>; 
</span><a name="LN121"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>expect</span><span class='Delimiter'>; 
</span><a name="LN122"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>cipher_algo</span><span class='Delimiter'>; 
</span><a name="LN123"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>s2k_mode</span><span class='Delimiter'>; 
</span><a name="LN124"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>s2k_count</span><span class='Delimiter'>; 
</span><a name="LN125"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>s2k_cipher_algo</span><span class='Delimiter'>; 
</span><a name="LN126"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>s2k_digest_algo</span><span class='Delimiter'>; 
</span><a name="LN127"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>compress_algo</span><span class='Delimiter'>; 
</span><a name="LN128"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>use_sess_key</span><span class='Delimiter'>; 
</span><a name="LN129"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>disable_mdc</span><span class='Delimiter'>; 
</span><a name="LN130"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>unicode_mode</span><span class='Delimiter'>; 
}; 
</span> 
<span class='Keyword'>static void 
</span><a name="LN134"></a><span class='Declare_Function'>fill_expect</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>ex</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>text_mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN120"><span class='Ref_to_Member'>debug</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN122"><span class='Ref_to_Member'>cipher_algo</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN123"><span class='Ref_to_Member'>s2k_mode</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN124"><span class='Ref_to_Member'>s2k_count</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN125"><span class='Ref_to_Member'>s2k_cipher_algo</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN126"><span class='Ref_to_Member'>s2k_digest_algo</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN127"><span class='Ref_to_Member'>compress_algo</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN128"><span class='Ref_to_Member'>use_sess_key</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN129"><span class='Ref_to_Member'>disable_mdc</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN134"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN130"><span class='Ref_to_Member'>unicode_mode</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN149"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>EX_MSG</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span> <span class='Operator'>\ 
</span>        <span class='String'>"pgp_decrypt: unexpected %s: expected %d got %d"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>        <a href="../../src/include/c.h.html#LN160"><span class='Ref_to_Macro'>CppAsString</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN149"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>ex<span class='Operator'>-&GT;</span>arg<span class='Delimiter'>, </span>ctx<span class='Operator'>-&GT;</span>arg<span class='Parentheses'>)))</span> 
 
<a name="LN154"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>EX_CHECK</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) </span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>ex<span class='Operator'>-&GT;</span>arg <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span>ex<span class='Operator'>-&GT;</span>arg <span class='Operator'>!= </span>ctx<span class='Operator'>-&GT;</span>arg<span class='Parentheses'>) </span><a href="pgp-pgsql.c.html#LN149"><span class='Ref_to_Macro'>EX_MSG</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Keyword'>static void 
</span><a name="LN159"></a><span class='Declare_Function'>check_expect</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>ex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>cipher_algo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>s2k_mode<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>s2k_count<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>s2k_digest_algo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>use_sess_key<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN159"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="pgp.h.html#LN147"><span class='Ref_to_Member'>use_sess_key</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>s2k_cipher_algo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>disable_mdc<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>compress_algo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN154"><span class='Ref_to_Macro'>EX_CHECK</span></a><span class='Parentheses'>(</span>unicode_mode<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN174"></a><span class='Declare_Function'>show_debug</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"dbg: %s"</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN174"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN180"></a><span class='Declare_Function'>set_arg</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, 
</span><a name="LN181"></a>        <span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>ex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN183"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"cipher-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN248"><span class='Ref_to_Proto'>pgp_set_cipher_algo</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"disable-mdc"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN233"><span class='Ref_to_Func'>pgp_disable_mdc</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"sess-key"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN240"><span class='Ref_to_Func'>pgp_set_sess_key</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"s2k-mode"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN249"><span class='Ref_to_Proto'>pgp_set_s2k_mode</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"s2k-count"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN250"><span class='Ref_to_Proto'>pgp_set_s2k_count</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"s2k-digest-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN252"><span class='Ref_to_Proto'>pgp_set_s2k_digest_algo</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"s2k-cipher-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN251"><span class='Ref_to_Proto'>pgp_set_s2k_cipher_algo</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"compress-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN256"><span class='Ref_to_Proto'>pgp_set_compress_algo</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"compress-level"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN257"><span class='Ref_to_Proto'>pgp_set_compress_level</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"convert-crlf"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN247"><span class='Ref_to_Func'>pgp_set_convert_crlf</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"unicode-mode"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN259"><span class='Ref_to_Proto'>pgp_set_unicode_mode</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The remaining options are for debugging/testing and are therefore not 
     * documented in the user-facing docs. 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"debug"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN120"><span class='Ref_to_Member'>debug</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-cipher-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN122"><span class='Ref_to_Member'>cipher_algo</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN114"><span class='Ref_to_Func'>pgp_get_cipher_code</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-disable-mdc"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN129"><span class='Ref_to_Member'>disable_mdc</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-sess-key"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN128"><span class='Ref_to_Member'>use_sess_key</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-s2k-mode"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN123"><span class='Ref_to_Member'>s2k_mode</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-s2k-count"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN124"><span class='Ref_to_Member'>s2k_count</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-s2k-digest-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN126"><span class='Ref_to_Member'>s2k_digest_algo</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN103"><span class='Ref_to_Func'>pgp_get_digest_code</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-s2k-cipher-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN125"><span class='Ref_to_Member'>s2k_cipher_algo</span></a> <span class='Operator'>= </span><a href="pgp.c.html#LN114"><span class='Ref_to_Func'>pgp_get_cipher_code</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-compress-algo"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN127"><span class='Ref_to_Member'>compress_algo</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='String'>"expect-unicode-mode"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN181"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN130"><span class='Ref_to_Member'>unicode_mode</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN180"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN73"><span class='Ref_to_Const'>PXE_ARGUMENT_ERROR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN183"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_arg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find next word.  Handle ',' and '=' as words.  Skip whitespace. 
 * Put word info into res_p, res_len. 
 * Returns ptr to next word. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN271"></a><span class='Declare_Function'>getword</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>res_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>res_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* whitespace at start */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>))</span> 
        <a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* word data */ 
</span>    <span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>res_p</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'='</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>','</span><span class='Parentheses'>) 
</span>        <a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>&& !</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> 
                       <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'='</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>','</span><span class='Parentheses'>))</span> 
            <a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* word end */ 
</span>    <span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>res_len</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>- *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>res_p</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* whitespace at end */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>))</span> 
        <a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN271"><span class='Ref_to_Parameter'>p</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getword &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert to lowercase asciiz string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN300"></a><span class='Declare_Function'>downcase_convert</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN302"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>c</span><span class='Delimiter'>, 
</span><a name="LN303"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN304"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN300"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN303"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgp-pgsql.c.html#LN303"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgp-pgsql.c.html#LN300"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; </span><a href="pgp-pgsql.c.html#LN303"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN302"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN300"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN303"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN302"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>&GT;= </span><span class='String'>'A'</span> <span class='Operator'>&& </span><a href="pgp-pgsql.c.html#LN302"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>&LT;= </span><span class='String'>'Z'</span><span class='Parentheses'>) 
</span>            <a href="pgp-pgsql.c.html#LN302"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>+= </span><span class='String'>'a'</span> <span class='Operator'>- </span><span class='String'>'A'</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN304"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN303"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN302"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="pgp-pgsql.c.html#LN304"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN300"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN304"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN318"></a><span class='Declare_Function'>parse_args</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>arg_len</span><span class='Delimiter'>, 
</span><a name="LN319"></a>           <span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>ex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN321"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN299"><span class='Ref_to_Func'>downcase_convert</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN318"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN318"><span class='Ref_to_Parameter'>arg_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN322"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>, 
</span><a name="LN323"></a>               <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN324"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>key_len</span><span class='Delimiter'>, 
</span><a name="LN325"></a>                <span class='Declare_Local'>val_len</span><span class='Delimiter'>; 
</span><a name="LN326"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN327"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN321"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN326"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="px.h.html#LN73"><span class='Ref_to_Const'>PXE_ARGUMENT_ERROR</span></a><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN270"><span class='Ref_to_Func'>getword</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN322"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN324"><span class='Ref_To_Local'>key_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ != </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN270"><span class='Ref_to_Func'>getword</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN323"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN325"><span class='Ref_To_Local'>val_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN327"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++ != </span><span class='String'>','</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN322"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| *</span><a href="pgp-pgsql.c.html#LN323"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pgp-pgsql.c.html#LN325"><span class='Ref_To_Local'>val_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN322"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN324"><span class='Ref_To_Local'>key_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN323"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN325"><span class='Ref_To_Local'>val_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN326"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN179"><span class='Ref_to_Func'>set_arg</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN318"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN322"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN323"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN319"><span class='Ref_to_Parameter'>ex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN326"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *p &raquo; </span> 
    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN321"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN326"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_args &raquo; </span> 
 
<span class='Keyword'>static </span><a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a> <span class='Operator'>* 
</span><a name="LN356"></a><span class='Declare_Function'>create_mbuf_from_vardata</span><span class='Parentheses'>(</span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="mbuf.h.html#LN79"><span class='Ref_to_Proto'>mbuf_create_from_data</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN356"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN356"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN363"></a><span class='Declare_Function'>init_work</span><span class='Parentheses'>(</span><a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>ctx_p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>is_text</span><span class='Delimiter'>, 
</span><a name="LN364"></a>          <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>ex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN366"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span> <span class='Operator'>= </span><a href="pgp.c.html#LN198"><span class='Ref_to_Func'>pgp_init</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN363"><span class='Ref_to_Parameter'>ctx_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN133"><span class='Ref_to_Func'>fill_expect</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN364"><span class='Ref_to_Parameter'>ex</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN363"><span class='Ref_to_Parameter'>is_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN366"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="pgp-pgsql.c.html#LN364"><span class='Ref_to_Parameter'>args</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pgp-pgsql.c.html#LN366"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN317"><span class='Ref_to_Func'>parse_args</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN363"><span class='Ref_to_Parameter'>ctx_p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN364"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN364"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN364"><span class='Ref_to_Parameter'>ex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN366"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>) 
</span>        <a href="px.c.html#LN94"><span class='Ref_to_Func'>px_THROW_ERROR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN366"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN364"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN120"><span class='Ref_to_Member'>debug</span></a><span class='Parentheses'>) 
</span>        <a href="px.c.html#LN152"><span class='Ref_to_Func'>px_set_debug_handler</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN173"><span class='Ref_to_Func'>show_debug</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp.h.html#LN258"><span class='Ref_to_Proto'>pgp_set_text_mode</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN363"><span class='Ref_to_Parameter'>ctx_p</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN363"><span class='Ref_to_Parameter'>is_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end init_work &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN384"></a><span class='Declare_Function'>encrypt_internal</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>is_pubenc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>is_text</span><span class='Delimiter'>, 
</span><a name="LN385"></a>                 <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN387"></a>    <a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src</span><span class='Delimiter'>, 
</span><a name="LN388"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dst</span><span class='Delimiter'>; 
</span><a name="LN389"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmp</span><span class='Delimiter'>[</span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>]; 
</span><a name="LN390"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>restmp</span><span class='Delimiter'>; 
</span><a name="LN391"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN392"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_len</span><span class='Delimiter'>; 
</span><a name="LN393"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span><span class='Delimiter'>; 
</span><a name="LN394"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span><span class='Delimiter'>; 
</span><a name="LN395"></a>    <span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Declare_Local'>ex</span><span class='Delimiter'>; 
</span><a name="LN396"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tmp_data</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN362"><span class='Ref_to_Func'>init_work</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN384"><span class='Ref_to_Parameter'>is_text</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN395"><span class='Ref_To_Local'>ex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN384"><span class='Ref_to_Parameter'>is_text</span></a> <span class='Operator'>&& </span><a href="pgp.h.html#LN260"><span class='Ref_to_Proto'>pgp_get_unicode_mode</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN89"><span class='Ref_to_Func'>convert_to_utf8</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a> <span class='Operator'>== </span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>            <a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pgp-pgsql.c.html#LN387"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN355"><span class='Ref_to_Func'>create_mbuf_from_vardata</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN388"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN78"><span class='Ref_to_Proto'>mbuf_create</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>128</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * reserve room for header 
     */ 
</span>    <a href="mbuf.h.html#LN85"><span class='Ref_to_Proto'>mbuf_append</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN388"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN389"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * set key 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN384"><span class='Ref_to_Parameter'>is_pubenc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN422"></a>        <a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>kbuf</span> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN355"><span class='Ref_to_Func'>create_mbuf_from_vardata</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN394"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN263"><span class='Ref_to_Proto'>pgp_set_pubkey</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN422"><span class='Ref_To_Local'>kbuf</span></a><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN422"><span class='Ref_To_Local'>kbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgp-pgsql.c.html#LN394"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN262"><span class='Ref_to_Proto'>pgp_set_symkey</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN385"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * encrypt 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN394"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="pgp-pgsql.c.html#LN394"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN239"><span class='Ref_to_Proto'>pgp_encrypt</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN387"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN388"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * check for error 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN394"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN395"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>.</span><a href="pgp-pgsql.c.html#LN120"><span class='Ref_to_Member'>debug</span></a><span class='Parentheses'>) 
</span>            <a href="px.c.html#LN152"><span class='Ref_to_Func'>px_set_debug_handler</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a><span class='Parentheses'>) 
</span>            <a href="pgp-pgsql.c.html#LN108"><span class='Ref_to_Func'>clear_and_pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp.c.html#LN223"><span class='Ref_to_Func'>pgp_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN387"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN388"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="px.c.html#LN94"><span class='Ref_to_Func'>px_THROW_ERROR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN394"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* res_len includes VARHDRSZ */ 
</span>    <a href="pgp-pgsql.c.html#LN392"><span class='Ref_To_Local'>res_len</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN84"><span class='Ref_to_Proto'>mbuf_steal_data</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN388"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN390"><span class='Ref_To_Local'>restmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN391"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgp-pgsql.c.html#LN390"><span class='Ref_To_Local'>restmp</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN391"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN392"><span class='Ref_To_Local'>res_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a><span class='Parentheses'>) 
</span>        <a href="pgp-pgsql.c.html#LN108"><span class='Ref_to_Func'>clear_and_pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN396"><span class='Ref_To_Local'>tmp_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp.c.html#LN223"><span class='Ref_to_Func'>pgp_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN393"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN387"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN388"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="px.c.html#LN152"><span class='Ref_to_Func'>px_set_debug_handler</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN391"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end encrypt_internal &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN470"></a><span class='Declare_Function'>decrypt_internal</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>is_pubenc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>need_text</span><span class='Delimiter'>, </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, 
</span><a name="LN471"></a>                 <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>keypsw</span><span class='Delimiter'>, </span><a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN473"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>err</span><span class='Delimiter'>; 
</span><a name="LN474"></a>    <a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN475"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dst</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN476"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>tmp</span><span class='Delimiter'>[</span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>]; 
</span><a name="LN477"></a>    <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>restmp</span><span class='Delimiter'>; 
</span><a name="LN478"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN479"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_len</span><span class='Delimiter'>; 
</span><a name="LN480"></a>    <a href="pgp.h.html#LN133"><span class='Ref_to_Struct'>PGP_Context</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN481"></a>    <span class='Control'>struct</span> <a href="pgp-pgsql.c.html#LN118"><span class='Ref_to_Struct'>debug_expect</span></a> <span class='Declare_Local'>ex</span><span class='Delimiter'>; 
</span><a name="LN482"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>got_unicode</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
 
    <a href="pgp-pgsql.c.html#LN362"><span class='Ref_to_Func'>init_work</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN470"><span class='Ref_to_Parameter'>need_text</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>args</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN481"><span class='Ref_To_Local'>ex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN474"><span class='Ref_To_Local'>src</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN79"><span class='Ref_to_Proto'>mbuf_create_from_data</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN470"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN470"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN475"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN78"><span class='Ref_to_Proto'>mbuf_create</span></a><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN470"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>2048</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * reserve room for header 
     */ 
</span>    <a href="mbuf.h.html#LN85"><span class='Ref_to_Proto'>mbuf_append</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN475"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN476"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * set key 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN470"><span class='Ref_to_Parameter'>is_pubenc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN501"></a>        <a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>psw</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN502"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>psw_len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN503"></a>        <a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>kbuf</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>keypsw</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgp-pgsql.c.html#LN501"><span class='Ref_To_Local'>psw</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>keypsw</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgp-pgsql.c.html#LN502"><span class='Ref_To_Local'>psw_len</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>keypsw</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pgp-pgsql.c.html#LN503"><span class='Ref_To_Local'>kbuf</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN355"><span class='Ref_to_Func'>create_mbuf_from_vardata</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN473"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN263"><span class='Ref_to_Proto'>pgp_set_pubkey</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN503"><span class='Ref_To_Local'>kbuf</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN501"><span class='Ref_To_Local'>psw</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN502"><span class='Ref_To_Local'>psw_len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN503"><span class='Ref_To_Local'>kbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pgp-pgsql.c.html#LN473"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN262"><span class='Ref_to_Proto'>pgp_set_symkey</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN471"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* decrypt */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN473"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN473"><span class='Ref_To_Local'>err</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN240"><span class='Ref_to_Proto'>pgp_decrypt</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN474"><span class='Ref_To_Local'>src</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN475"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN481"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>.</span><a href="pgp-pgsql.c.html#LN121"><span class='Ref_to_Member'>expect</span></a><span class='Parentheses'>) 
</span>            <a href="pgp-pgsql.c.html#LN158"><span class='Ref_to_Func'>check_expect</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN481"><span class='Ref_To_Local'>ex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* remember the setting */ 
</span>        <a href="pgp-pgsql.c.html#LN482"><span class='Ref_To_Local'>got_unicode</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN260"><span class='Ref_to_Proto'>pgp_get_unicode_mode</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN474"><span class='Ref_To_Local'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp.c.html#LN223"><span class='Ref_to_Func'>pgp_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN480"><span class='Ref_To_Local'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN473"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="px.c.html#LN152"><span class='Ref_to_Func'>px_set_debug_handler</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN475"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="px.c.html#LN94"><span class='Ref_to_Func'>px_THROW_ERROR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN473"><span class='Ref_To_Local'>err</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pgp-pgsql.c.html#LN479"><span class='Ref_To_Local'>res_len</span></a> <span class='Operator'>= </span><a href="mbuf.h.html#LN84"><span class='Ref_to_Proto'>mbuf_steal_data</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN475"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN477"><span class='Ref_To_Local'>restmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN475"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* res_len includes VARHDRSZ */ 
</span>    <a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgp-pgsql.c.html#LN477"><span class='Ref_To_Local'>restmp</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN479"><span class='Ref_To_Local'>res_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN470"><span class='Ref_to_Parameter'>need_text</span></a> <span class='Operator'>&& </span><a href="pgp-pgsql.c.html#LN482"><span class='Ref_To_Local'>got_unicode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN549"></a>        <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>utf</span> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN83"><span class='Ref_to_Func'>convert_from_utf8</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN549"><span class='Ref_To_Local'>utf</span></a> <span class='Operator'>!= </span><a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pgp-pgsql.c.html#LN108"><span class='Ref_to_Func'>clear_and_pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN549"><span class='Ref_To_Local'>utf</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="px.c.html#LN152"><span class='Ref_to_Func'>px_set_debug_handler</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN478"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end decrypt_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Wrappers for symmetric-key functions 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN566"></a><span class='Declare_Function'>pgp_sym_encrypt_bytea</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN568"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN569"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN570"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN571"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN568"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN569"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN570"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN571"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN383"><span class='Ref_to_Func'>encrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN568"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN569"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN570"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN568"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN569"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN570"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN571"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_sym_encrypt_bytea &raquo; </span> 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN588"></a><span class='Declare_Function'>pgp_sym_encrypt_text</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN590"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN591"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN592"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN593"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN590"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN591"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN592"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN593"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN383"><span class='Ref_to_Func'>encrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN590"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN591"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN592"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN590"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN591"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN592"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN593"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_sym_encrypt_text &raquo; </span> 
 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN611"></a><span class='Declare_Function'>pgp_sym_decrypt_bytea</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN613"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN614"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN615"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN616"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN613"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN614"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN615"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN616"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN469"><span class='Ref_to_Func'>decrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN613"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN614"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN615"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN613"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN614"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN615"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN616"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_sym_decrypt_bytea &raquo; </span> 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN633"></a><span class='Declare_Function'>pgp_sym_decrypt_text</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN635"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN636"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN637"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN635"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN636"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN637"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN638"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN469"><span class='Ref_to_Func'>decrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN635"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN636"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN637"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN635"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN636"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN637"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN638"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_sym_decrypt_text &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Wrappers for public-key functions 
 */ 
</span> 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN659"></a><span class='Declare_Function'>pgp_pub_encrypt_bytea</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN661"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN662"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN663"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN664"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN661"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN662"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN663"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN664"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN383"><span class='Ref_to_Func'>encrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN661"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN662"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN663"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN661"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN662"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN663"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN664"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_pub_encrypt_bytea &raquo; </span> 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN681"></a><span class='Declare_Function'>pgp_pub_encrypt_text</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN683"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN684"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN685"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN686"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN683"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN684"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN685"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN686"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN383"><span class='Ref_to_Func'>encrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN683"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN684"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN685"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN683"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN684"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN685"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN686"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_pub_encrypt_text &raquo; </span> 
 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN704"></a><span class='Declare_Function'>pgp_pub_decrypt_bytea</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN706"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN707"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN708"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>psw</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN709"></a>               <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN710"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN706"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN707"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN708"><span class='Ref_To_Local'>psw</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN709"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN710"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN469"><span class='Ref_to_Func'>decrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN706"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN707"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN708"><span class='Ref_To_Local'>psw</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN709"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN706"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN707"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN708"><span class='Ref_To_Local'>psw</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN709"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN710"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_pub_decrypt_bytea &raquo; </span> 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN731"></a><span class='Declare_Function'>pgp_pub_decrypt_text</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN733"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN734"></a>               <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN735"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>psw</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN736"></a>               <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN737"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN733"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN734"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN735"><span class='Ref_To_Local'>psw</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN736"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN737"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN469"><span class='Ref_to_Func'>decrypt_internal</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN733"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN734"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN735"><span class='Ref_To_Local'>psw</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN736"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN733"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN734"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN735"><span class='Ref_To_Local'>psw</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN736"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN737"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_pub_decrypt_text &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Wrappers for PGP ascii armor 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Helper function for pgp_armor. Converts arrays of keys and values into 
 * plain C arrays, and checks that they don't contain invalid characters. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN767"></a><span class='Declare_Function'>parse_key_value_arrays</span><span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key_array</span><span class='Delimiter'>, </span><a href="../../src/include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val_array</span><span class='Delimiter'>, 
</span><a name="LN768"></a>                       <span class='Keyword'>char </span><span class='Operator'>***</span><span class='Declare_Parameter'>p_keys</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>***</span><span class='Declare_Parameter'>p_values</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN770"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkdims</span> <span class='Operator'>= </span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN767"><span class='Ref_to_Parameter'>key_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN771"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nvdims</span> <span class='Operator'>= </span><a href="../../src/include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN767"><span class='Ref_to_Parameter'>val_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN772"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>keys</span><span class='Delimiter'>, 
</span><a name="LN773"></a>              <span class='Operator'>**</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN774"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>key_datums</span><span class='Delimiter'>, 
</span><a name="LN775"></a>               <span class='Operator'>*</span><span class='Declare_Local'>val_datums</span><span class='Delimiter'>; 
</span><a name="LN776"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>key_nulls</span><span class='Delimiter'>, 
</span><a name="LN777"></a>               <span class='Operator'>*</span><span class='Declare_Local'>val_nulls</span><span class='Delimiter'>; 
</span><a name="LN778"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>key_count</span><span class='Delimiter'>, 
</span><a name="LN779"></a>                <span class='Declare_Local'>val_count</span><span class='Delimiter'>; 
</span><a name="LN780"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN770"><span class='Ref_To_Local'>nkdims</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="pgp-pgsql.c.html#LN770"><span class='Ref_To_Local'>nkdims</span></a> <span class='Operator'>!= </span><a href="pgp-pgsql.c.html#LN771"><span class='Ref_To_Local'>nvdims</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN770"><span class='Ref_To_Local'>nkdims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN767"><span class='Ref_to_Parameter'>key_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN774"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN776"><span class='Ref_To_Local'>key_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN778"><span class='Ref_To_Local'>key_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN767"><span class='Ref_to_Parameter'>val_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN775"><span class='Ref_To_Local'>val_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN777"><span class='Ref_To_Local'>val_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN779"><span class='Ref_To_Local'>val_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN778"><span class='Ref_To_Local'>key_count</span></a> <span class='Operator'>!= </span><a href="pgp-pgsql.c.html#LN779"><span class='Ref_To_Local'>val_count</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"mismatched array dimensions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN772"><span class='Ref_To_Local'>keys</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgp-pgsql.c.html#LN778"><span class='Ref_To_Local'>key_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN773"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="pgp-pgsql.c.html#LN779"><span class='Ref_To_Local'>val_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pgp-pgsql.c.html#LN778"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>; </span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN807"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check that the key doesn't contain anything funny */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN776"><span class='Ref_To_Local'>key_nulls</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for header key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN774"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-pgsql.c.html#LN95"><span class='Ref_to_Func'>string_is_ascii</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"header key must not contain non-ASCII characters"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='String'>": "</span><span class='Parentheses'>))</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"header key must not contain \": \""</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>))</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"header key must not contain newlines"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN772"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And the same for the value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN777"><span class='Ref_To_Local'>val_nulls</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for header value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN775"><span class='Ref_To_Local'>val_datums</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pgp-pgsql.c.html#LN95"><span class='Ref_to_Func'>string_is_ascii</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"header value must not contain non-ASCII characters"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>))</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"header value must not contain newlines"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN773"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN780"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN807"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key_count;i++ &raquo; </span> 
 
    <span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN768"><span class='Ref_to_Parameter'>p_keys</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN772"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pgp-pgsql.c.html#LN768"><span class='Ref_to_Parameter'>p_values</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN773"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pgp-pgsql.c.html#LN778"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_key_value_arrays &raquo; </span> 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN857"></a><span class='Declare_Function'>pg_armor</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN859"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN860"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN861"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>data_len</span><span class='Delimiter'>; 
</span><a name="LN862"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN863"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_headers</span><span class='Delimiter'>; 
</span><a name="LN864"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>keys</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN865"></a>              <span class='Operator'>**</span><span class='Declare_Local'>values</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN859"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN861"><span class='Ref_To_Local'>data_len</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN859"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pgp-pgsql.c.html#LN863"><span class='Ref_To_Local'>num_headers</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN766"><span class='Ref_to_Func'>parse_key_value_arrays</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../src/include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN864"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN865"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="pgp-pgsql.c.html#LN863"><span class='Ref_To_Local'>num_headers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected number of arguments %d"</span><span class='Delimiter'>, </span><a href="../../src/include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-armor.c.html#LN205"><span class='Ref_to_Func'>pgp_armor_encode</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN859"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN861"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                     <a href="pgp-pgsql.c.html#LN863"><span class='Ref_To_Local'>num_headers</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN864"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN865"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN860"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN860"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN860"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN862"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN859"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN860"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_armor &raquo; </span> 
 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN895"></a><span class='Declare_Function'>pg_dearmor</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN897"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN898"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN899"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>data_len</span><span class='Delimiter'>; 
</span><a name="LN900"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span><a name="LN901"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN897"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN899"><span class='Ref_To_Local'>data_len</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN897"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN900"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN288"><span class='Ref_to_Proto'>pgp_armor_decode</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN897"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN899"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN900"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="px.c.html#LN94"><span class='Ref_to_Func'>px_THROW_ERROR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN900"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN898"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN898"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN898"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN901"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN897"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN898"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_dearmor &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* cross-call state for pgp_armor_headers */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN923"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nheaders</span><span class='Delimiter'>; 
</span><a name="LN924"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Member'>keys</span><span class='Delimiter'>; 
</span><a name="LN925"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Member'>values</span><span class='Delimiter'>; 
</span><a name="LN926"></a>} <span class='Declare_Typedef'>pgp_armor_headers_state</span><span class='Delimiter'>; 
</span> 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN929"></a><span class='Declare_Function'>pgp_armor_headers</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN931"></a>    <a href="../../src/include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN932"></a>    <a href="pgp-pgsql.c.html#LN921"><span class='Ref_to_Typedef'>pgp_armor_headers_state</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN933"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>utf8key</span><span class='Delimiter'>; 
</span><a name="LN934"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>utf8val</span><span class='Delimiter'>; 
</span><a name="LN935"></a>    <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN936"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN937"></a>    <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attinmeta</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN941"></a>        <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN942"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN943"></a>        <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* we need the state allocated in the multi call context */ 
</span>        <a href="pgp-pgsql.c.html#LN943"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN936"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN937"><span class='Ref_To_Local'>attinmeta</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN230"><span class='Ref_to_Proto'>TupleDescGetAttInMetadata</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN936"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN98"><span class='Ref_to_Member'>attinmeta</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN937"><span class='Ref_To_Local'>attinmeta</span></a><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN921"><span class='Ref_to_Typedef'>pgp_armor_headers_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN921"><span class='Ref_to_Typedef'>pgp_armor_headers_state</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pgp-pgsql.c.html#LN942"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="pgp.h.html#LN289"><span class='Ref_to_Proto'>pgp_extract_armor_headers</span></a><span class='Parentheses'>((</span><a href="../../src/include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN941"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../src/include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN941"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN923"><span class='Ref_to_Member'>nheaders</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN924"><span class='Ref_to_Member'>keys</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN925"><span class='Ref_to_Member'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN942"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="px.c.html#LN94"><span class='Ref_to_Func'>px_THROW_ERROR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN942"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN943"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN921"><span class='Ref_to_Typedef'>pgp_armor_headers_state</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN64"><span class='Ref_to_Member'>call_cntr</span></a> <span class='Operator'>&GT;= </span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN923"><span class='Ref_to_Member'>nheaders</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN977"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* we assume that the keys (and values) are in UTF-8. */ 
</span>        <a href="pgp-pgsql.c.html#LN933"><span class='Ref_To_Local'>utf8key</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN924"><span class='Ref_to_Member'>keys</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN64"><span class='Ref_to_Member'>call_cntr</span></a><span class='Delimiter'>]; 
</span>        <a href="pgp-pgsql.c.html#LN934"><span class='Ref_To_Local'>utf8val</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN932"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="pgp-pgsql.c.html#LN925"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN64"><span class='Ref_to_Member'>call_cntr</span></a><span class='Delimiter'>]; 
</span> 
        <a href="pgp-pgsql.c.html#LN977"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN933"><span class='Ref_To_Local'>utf8key</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN933"><span class='Ref_To_Local'>utf8key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../src/fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pgp-pgsql.c.html#LN977"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN934"><span class='Ref_To_Local'>utf8val</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN934"><span class='Ref_To_Local'>utf8val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../src/fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* build a tuple */ 
</span>        <a href="pgp-pgsql.c.html#LN935"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN231"><span class='Ref_to_Proto'>BuildTupleFromCStrings</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN98"><span class='Ref_to_Member'>attinmeta</span></a><span class='Delimiter'>, </span><a href="pgp-pgsql.c.html#LN977"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN931"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../src/include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN935"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end pgp_armor_headers &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * Wrappers for PGP key id 
 */ 
</span> 
<a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN999"></a><span class='Declare_Function'>pgp_key_id_w</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1001"></a>    <a href="../../src/include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN1002"></a>    <a href="../seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1003"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_len</span><span class='Delimiter'>; 
</span><a name="LN1004"></a>    <a href="mbuf.c.html#LN38"><span class='Ref_to_Struct'>MBuf</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN1001"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN1004"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="pgp-pgsql.c.html#LN355"><span class='Ref_to_Func'>create_mbuf_from_vardata</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1001"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pgp-pgsql.c.html#LN1002"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Number'>17</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pgp-pgsql.c.html#LN1003"><span class='Ref_To_Local'>res_len</span></a> <span class='Operator'>= </span><a href="pgp-info.c.html#LN110"><span class='Ref_to_Func'>pgp_get_keyid</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1004"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../src/include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1002"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="mbuf.c.html#LN66"><span class='Ref_to_Func'>mbuf_free</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1004"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1003"><span class='Ref_To_Local'>res_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="px.c.html#LN94"><span class='Ref_to_Func'>px_THROW_ERROR</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1003"><span class='Ref_To_Local'>res_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1002"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../../src/include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="pgp-pgsql.c.html#LN1003"><span class='Ref_To_Local'>res_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1001"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="pgp-pgsql.c.html#LN1002"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pgp_key_id_w &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>