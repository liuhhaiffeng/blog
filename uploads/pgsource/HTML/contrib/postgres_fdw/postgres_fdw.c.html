<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\postgres_fdw\postgres_fdw.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\postgres_fdw\postgres_fdw.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:26 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * postgres_fdw.c 
 *        Foreign-data wrapper for remote PostgreSQL servers 
 * 
 * Portions Copyright (c) 2012-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *        contrib/postgres_fdw/postgres_fdw.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"postgres_fdw.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/explain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/vacuum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/fdwapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/cost.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/pathnode.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/paths.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/restrictinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/tlist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parsetree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/sampling.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/selfuncs.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Default CPU cost to start up a foreign query. */ 
</span><a name="LN47"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_FDW_STARTUP_COST</span>    <span class='Number'>100</span><span class='Operator'>.</span><span class='Number'>0</span> 
 
<span class='Comment_Multi_Line'>/* Default CPU cost to process 1 row (above and beyond cpu_tuple_cost). */ 
</span><a name="LN50"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_FDW_TUPLE_COST</span>      <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span> 
 
<span class='Comment_Multi_Line'>/* If no remote estimates, assume a sort costs 20% extra */ 
</span><a name="LN53"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_FDW_SORT_MULTIPLIER</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>2</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Indexes of FDW-private information stored in fdw_private lists. 
 * 
 * These items are indexed with the enum FdwScanPrivateIndex, so an item 
 * can be fetched with list_nth().  For example, to get the SELECT statement: 
 *      sql = strVal(list_nth(fdw_private, FdwScanPrivateSelectSql)); 
 */ 
</span><a name="LN62"></a><span class='Control'>enum</span> <span class='Declare_Enum'>FdwScanPrivateIndex</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* SQL statement to execute remotely (as a String node) */ 
</span><a name="LN65"></a>    <span class='Declare_Enum_Const'>FdwScanPrivateSelectSql</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* Integer list of attribute numbers retrieved by the SELECT */ 
</span><a name="LN67"></a>    <span class='Declare_Enum_Const'>FdwScanPrivateRetrievedAttrs</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* Integer representing the desired fetch_size */ 
</span><a name="LN69"></a>    <span class='Declare_Enum_Const'>FdwScanPrivateFetchSize</span><span class='Delimiter'>, 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * String describing join i.e. names of relations being joined and types 
     * of join, added when the scan is join 
     */ 
</span><a name="LN75"></a>    <span class='Declare_Enum_Const'>FdwScanPrivateRelations</span> 
<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Similarly, this enum describes what's kept in the fdw_private list for 
 * a ModifyTable node referencing a postgres_fdw foreign table.  We store: 
 * 
 * 1) INSERT/UPDATE/DELETE statement text to be sent to the remote server 
 * 2) Integer list of target attribute numbers for INSERT/UPDATE 
 *    (NIL for a DELETE) 
 * 3) Boolean flag showing if the remote query has a RETURNING clause 
 * 4) Integer list of attribute numbers retrieved by RETURNING, if any 
 */ 
</span><a name="LN88"></a><span class='Control'>enum</span> <span class='Declare_Enum'>FdwModifyPrivateIndex</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* SQL statement to execute remotely (as a String node) */ 
</span><a name="LN91"></a>    <span class='Declare_Enum_Const'>FdwModifyPrivateUpdateSql</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* Integer list of target attribute numbers for INSERT/UPDATE */ 
</span><a name="LN93"></a>    <span class='Declare_Enum_Const'>FdwModifyPrivateTargetAttnums</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* has-returning flag (as an integer Value node) */ 
</span><a name="LN95"></a>    <span class='Declare_Enum_Const'>FdwModifyPrivateHasReturning</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* Integer list of attribute numbers retrieved by RETURNING */ 
</span><a name="LN97"></a>    <span class='Declare_Enum_Const'>FdwModifyPrivateRetrievedAttrs</span> 
<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Similarly, this enum describes what's kept in the fdw_private list for 
 * a ForeignScan node that modifies a foreign table directly.  We store: 
 * 
 * 1) UPDATE/DELETE statement text to be sent to the remote server 
 * 2) Boolean flag showing if the remote query has a RETURNING clause 
 * 3) Integer list of attribute numbers retrieved by RETURNING, if any 
 * 4) Boolean flag showing if we set the command es_processed 
 */ 
</span><a name="LN109"></a><span class='Control'>enum</span> <span class='Declare_Enum'>FdwDirectModifyPrivateIndex</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* SQL statement to execute remotely (as a String node) */ 
</span><a name="LN112"></a>    <span class='Declare_Enum_Const'>FdwDirectModifyPrivateUpdateSql</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* has-returning flag (as an integer Value node) */ 
</span><a name="LN114"></a>    <span class='Declare_Enum_Const'>FdwDirectModifyPrivateHasReturning</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* Integer list of attribute numbers retrieved by RETURNING */ 
</span><a name="LN116"></a>    <span class='Declare_Enum_Const'>FdwDirectModifyPrivateRetrievedAttrs</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* set-processed flag (as an integer Value node) */ 
</span><a name="LN118"></a>    <span class='Declare_Enum_Const'>FdwDirectModifyPrivateSetProcessed</span> 
<span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Execution state of a foreign scan using postgres_fdw. 
 */ 
</span><a name="LN124"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PgFdwScanState</span> 
<span class='Delimiter'>{ 
</span><a name="LN126"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Multi_Line'>/* relcache entry for the foreign table. NULL 
                                 * for a foreign join scan. */ 
</span><a name="LN128"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>tupdesc</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* tuple descriptor of scan */ 
</span><a name="LN129"></a>    <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Member'>attinmeta</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* attribute datatype conversion metadata */ 
</span> 
    <span class='Comment_Multi_Line'>/* extracted fdw_private data */ 
</span><a name="LN132"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>query</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* text of SELECT command */ 
</span><a name="LN133"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>retrieved_attrs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* list of retrieved attribute numbers */ 
</span> 
    <span class='Comment_Multi_Line'>/* for remote query execution */ 
</span><a name="LN136"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>conn</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* connection for the scan */ 
</span><a name="LN137"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Member'>cursor_number</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* quasi-unique ID for my cursor */ 
</span><a name="LN138"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>cursor_exists</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* have we created the cursor? */ 
</span><a name="LN139"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numParams</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of parameters passed to query */ 
</span><a name="LN140"></a>    <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>param_flinfo</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* output conversion functions for them */ 
</span><a name="LN141"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>param_exprs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* executable expressions for param values */ 
</span><a name="LN142"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Member'>param_values</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* textual values of query parameters */ 
</span> 
    <span class='Comment_Multi_Line'>/* for storing result tuples */ 
</span><a name="LN145"></a>    <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>tuples</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* array of currently-retrieved tuples */ 
</span><a name="LN146"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_tuples</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # of tuples in array */ 
</span><a name="LN147"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>next_tuple</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* index of next one to return */ 
</span> 
    <span class='Comment_Multi_Line'>/* batch-level state, for optimizing rewinds and avoiding useless fetch */ 
</span><a name="LN150"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>fetch_ct_2</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Min(# of fetches done, 2) */ 
</span><a name="LN151"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>eof_reached</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* true if last fetch reached EOF */ 
</span> 
    <span class='Comment_Multi_Line'>/* working memory contexts */ 
</span><a name="LN154"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>batch_cxt</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* context holding current batch of tuples */ 
</span><a name="LN155"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>temp_cxt</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* context for per-tuple temporary data */ 
</span> 
<a name="LN157"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>fetch_size</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* number of tuples per fetch */ 
</span><a name="LN158"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PgFdwScanState &raquo; </span> <span class='Declare_Typedef'>PgFdwScanState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Execution state of a foreign insert/update/delete operation. 
 */ 
</span><a name="LN163"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PgFdwModifyState</span> 
<span class='Delimiter'>{ 
</span><a name="LN165"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* relcache entry for the foreign table */ 
</span><a name="LN166"></a>    <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Member'>attinmeta</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* attribute datatype conversion metadata */ 
</span> 
    <span class='Comment_Multi_Line'>/* for remote query execution */ 
</span><a name="LN169"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>conn</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* connection for the scan */ 
</span><a name="LN170"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>p_name</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* name of prepared statement, if created */ 
</span> 
    <span class='Comment_Multi_Line'>/* extracted fdw_private data */ 
</span><a name="LN173"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>query</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* text of INSERT/UPDATE/DELETE command */ 
</span><a name="LN174"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>target_attrs</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* list of target attribute numbers */ 
</span><a name="LN175"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>has_returning</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* is there a RETURNING clause? */ 
</span><a name="LN176"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>retrieved_attrs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* attr numbers retrieved by RETURNING */ 
</span> 
    <span class='Comment_Multi_Line'>/* info about parameters for prepared statement */ 
</span><a name="LN179"></a>    <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Member'>ctidAttno</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* attnum of input resjunk ctid column */ 
</span><a name="LN180"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>p_nums</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* number of parameters to transmit */ 
</span><a name="LN181"></a>    <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>p_flinfo</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* output conversion functions for them */ 
</span> 
    <span class='Comment_Multi_Line'>/* working memory context */ 
</span><a name="LN184"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>temp_cxt</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* context for per-tuple temporary data */ 
</span><a name="LN185"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PgFdwModifyState &raquo; </span> <span class='Declare_Typedef'>PgFdwModifyState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Execution state of a foreign scan that modifies a foreign table directly. 
 */ 
</span><a name="LN190"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PgFdwDirectModifyState</span> 
<span class='Delimiter'>{ 
</span><a name="LN192"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* relcache entry for the foreign table */ 
</span><a name="LN193"></a>    <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Member'>attinmeta</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* attribute datatype conversion metadata */ 
</span> 
    <span class='Comment_Multi_Line'>/* extracted fdw_private data */ 
</span><a name="LN196"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>query</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* text of UPDATE/DELETE command */ 
</span><a name="LN197"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>has_returning</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* is there a RETURNING clause? */ 
</span><a name="LN198"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>retrieved_attrs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* attr numbers retrieved by RETURNING */ 
</span><a name="LN199"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>set_processed</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* do we set the command es_processed? */ 
</span> 
    <span class='Comment_Multi_Line'>/* for remote query execution */ 
</span><a name="LN202"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Member'>conn</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* connection for the update */ 
</span><a name="LN203"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numParams</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of parameters passed to query */ 
</span><a name="LN204"></a>    <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>param_flinfo</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* output conversion functions for them */ 
</span><a name="LN205"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>param_exprs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* executable expressions for param values */ 
</span><a name="LN206"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Member'>param_values</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* textual values of query parameters */ 
</span> 
    <span class='Comment_Multi_Line'>/* for storing result tuples */ 
</span><a name="LN209"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>result</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* result for query */ 
</span><a name="LN210"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_tuples</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # of result tuples */ 
</span><a name="LN211"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>next_tuple</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* index of next one to return */ 
</span> 
    <span class='Comment_Multi_Line'>/* working memory context */ 
</span><a name="LN214"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>temp_cxt</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* context for per-tuple temporary data */ 
</span><a name="LN215"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PgFdwDirectModifyState &raquo; </span> <span class='Declare_Typedef'>PgFdwDirectModifyState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Workspace for analyzing a foreign table. 
 */ 
</span><a name="LN220"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PgFdwAnalyzeState</span> 
<span class='Delimiter'>{ 
</span><a name="LN222"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* relcache entry for the foreign table */ 
</span><a name="LN223"></a>    <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Member'>attinmeta</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* attribute datatype conversion metadata */ 
</span><a name="LN224"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>retrieved_attrs</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* attr numbers retrieved by query */ 
</span> 
    <span class='Comment_Multi_Line'>/* collected sample rows */ 
</span><a name="LN227"></a>    <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>rows</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* array of size targrows */ 
</span><a name="LN228"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>targrows</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* target # of sample rows */ 
</span><a name="LN229"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>numrows</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* # of sample rows collected */ 
</span> 
    <span class='Comment_Multi_Line'>/* for random sampling */ 
</span><a name="LN232"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>samplerows</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # of rows fetched */ 
</span><a name="LN233"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>rowstoskip</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* # of rows to skip before next sample */ 
</span><a name="LN234"></a>    <a href="../../src/include/utils/sampling.h.html#LN46"><span class='Ref_to_Typedef'>ReservoirStateData</span></a> <span class='Declare_Member'>rstate</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* state for reservoir sampling */ 
</span> 
    <span class='Comment_Multi_Line'>/* working memory contexts */ 
</span><a name="LN237"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>anl_cxt</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* context for per-analyze lifespan data */ 
</span><a name="LN238"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>temp_cxt</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* context for per-tuple temporary data */ 
</span><a name="LN239"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end PgFdwAnalyzeState &raquo; </span> <span class='Declare_Typedef'>PgFdwAnalyzeState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Identify the attribute where data conversion fails. 
 */ 
</span><a name="LN244"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ConversionLocation</span> 
<span class='Delimiter'>{ 
</span><a name="LN246"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* foreign table's relcache entry. */ 
</span><a name="LN247"></a>    <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Member'>cur_attno</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* attribute number being processed, or 0 */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In case of foreign join push down, fdw_scan_tlist is used to identify 
     * the Var node corresponding to the error location and 
     * fsstate-&GT;ss.ps.state gives access to the RTEs of corresponding relation 
     * to get the relation name and attribute name. 
     */ 
</span><a name="LN255"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>fsstate</span><span class='Delimiter'>; 
</span><a name="LN256"></a>} <span class='Declare_Typedef'>ConversionLocation</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Callback argument for ec_member_matches_foreign */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN261"></a>    <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>current</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* current expr, or NULL if not yet found */ 
</span><a name="LN262"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>already_used</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* expressions already dealt with */ 
</span><a name="LN263"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ec_member_foreign_arg</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL functions 
 */ 
</span><a name="LN268"></a><span class='Declare_Prototype'>PG_FUNCTION_INFO_V1</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN427"><span class='Ref_to_Func'>postgres_fdw_handler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * FDW callback routines 
 */ 
</span><a name="LN273"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresGetForeignRelSize</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN274"></a>                          <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN275"></a>                          <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN276"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresGetForeignPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN277"></a>                        <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN278"></a>                        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN279"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresGetForeignPlan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN280"></a>                       <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN281"></a>                       <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN282"></a>                       <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>best_path</span><span class='Delimiter'>, 
</span><a name="LN283"></a>                       <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN284"></a>                       <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scan_clauses</span><span class='Delimiter'>, 
</span><a name="LN285"></a>                       <a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outer_plan</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN286"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresBeginForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN287"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresIterateForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN288"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresReScanForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN289"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresEndForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN290"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresAddForeignUpdateTargets</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN291"></a>                                <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target_rte</span><span class='Delimiter'>, 
</span><a name="LN292"></a>                                <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>target_relation</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN293"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresPlanForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN294"></a>                          <a href="../../src/include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN295"></a>                          <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelation</span><span class='Delimiter'>, 
</span><a name="LN296"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN297"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresBeginForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN298"></a>                           <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN299"></a>                           <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Delimiter'>, 
</span><a name="LN300"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Delimiter'>, 
</span><a name="LN301"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN302"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresExecForeignInsert</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN303"></a>                          <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN304"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN305"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN306"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresExecForeignUpdate</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN307"></a>                          <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN308"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN309"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN310"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresExecForeignDelete</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN311"></a>                          <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN312"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN313"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN314"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresEndForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN315"></a>                         <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN316"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>postgresIsForeignRelUpdatable</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN317"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>postgresPlanDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN318"></a>                         <a href="../../src/include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN319"></a>                         <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelation</span><span class='Delimiter'>, 
</span><a name="LN320"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresBeginDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN322"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresIterateDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN323"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresEndDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN324"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresExplainForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN325"></a>                           <a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN326"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresExplainForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN327"></a>                             <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN328"></a>                             <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Delimiter'>, 
</span><a name="LN329"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Delimiter'>, 
</span><a name="LN330"></a>                             <a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresExplainDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN332"></a>                            <a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN333"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>postgresAnalyzeForeignTable</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN334"></a>                            <a href="../../src/include/foreign/fdwapi.h.html#LN133"><span class='Ref_to_Typedef'>AcquireSampleRowsFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN335"></a>                            <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>totalpages</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>postgresImportForeignSchema</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN2265"><span class='Ref_to_Struct'>ImportForeignSchemaStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN337"></a>                            <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>serverOid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN338"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresGetForeignJoinPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN339"></a>                            <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>joinrel</span><span class='Delimiter'>, 
</span><a name="LN340"></a>                            <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outerrel</span><span class='Delimiter'>, 
</span><a name="LN341"></a>                            <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>innerrel</span><span class='Delimiter'>, 
</span><a name="LN342"></a>                            <a href="../../src/include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, 
</span><a name="LN343"></a>                            <a href="../../src/include/nodes/relation.h.html#LN2177"><span class='Ref_to_Struct'>JoinPathExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN344"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>postgresRecheckForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN345"></a>                           <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN346"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>postgresGetForeignUpperPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN347"></a>                             <a href="../../src/include/nodes/relation.h.html#LN70"><span class='Ref_to_Enum'>UpperRelationKind</span></a> <span class='Declare_Parameter'>stage</span><span class='Delimiter'>, 
</span><a name="LN348"></a>                             <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_rel</span><span class='Delimiter'>, 
</span><a name="LN349"></a>                             <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>output_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Helper functions 
 */ 
</span><a name="LN354"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>estimate_path_cost_size</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN355"></a>                        <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN356"></a>                        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>join_conds</span><span class='Delimiter'>, 
</span><a name="LN357"></a>                        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pathkeys</span><span class='Delimiter'>, 
</span><a name="LN358"></a>                        <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>p_rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>p_width</span><span class='Delimiter'>, 
</span><a name="LN359"></a>                        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_startup_cost</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_total_cost</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN360"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_remote_estimate</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Delimiter'>, 
</span><a name="LN361"></a>                    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, 
</span><a name="LN362"></a>                    <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>rows</span><span class='Delimiter'>, 
</span><a name="LN363"></a>                    <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>width</span><span class='Delimiter'>, 
</span><a name="LN364"></a>                    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>startup_cost</span><span class='Delimiter'>, 
</span><a name="LN365"></a>                    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>total_cost</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN366"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>ec_member_matches_foreign</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN367"></a>                          <a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>em</span><span class='Delimiter'>, 
</span><a name="LN368"></a>                          <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN369"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>create_cursor</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN370"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fetch_more_data</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN371"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>close_cursor</span><span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>unsigned int </span><span class='Declare_Parameter'>cursor_number</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN372"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>prepare_foreign_modify</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fmstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN373"></a><span class='Keyword'>static const char </span><span class='Operator'>**</span><span class='Declare_Prototype'>convert_prep_stmt_params</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fmstate</span><span class='Delimiter'>, 
</span><a name="LN374"></a>                         <a href="../../src/include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN375"></a>                         <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN376"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>store_returning_result</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fmstate</span><span class='Delimiter'>, 
</span><a name="LN377"></a>                       <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN378"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>execute_dml_stmt</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN379"></a><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_returning_data</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN380"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>prepare_query_params</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN381"></a>                     <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_exprs</span><span class='Delimiter'>, 
</span><a name="LN382"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>numParams</span><span class='Delimiter'>, 
</span><a name="LN383"></a>                     <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>param_flinfo</span><span class='Delimiter'>, 
</span><a name="LN384"></a>                     <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>param_exprs</span><span class='Delimiter'>, 
</span><a name="LN385"></a>                     <span class='Keyword'>const char </span><span class='Operator'>***</span><span class='Declare_Parameter'>param_values</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN386"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>process_query_params</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>econtext</span><span class='Delimiter'>, 
</span><a name="LN387"></a>                     <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>param_flinfo</span><span class='Delimiter'>, 
</span><a name="LN388"></a>                     <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>param_exprs</span><span class='Delimiter'>, 
</span><a name="LN389"></a>                     <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>param_values</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN390"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>postgresAcquireSampleRowsFunc</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, 
</span><a name="LN391"></a>                              <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>targrows</span><span class='Delimiter'>, 
</span><a name="LN392"></a>                              <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totalrows</span><span class='Delimiter'>, 
</span><a name="LN393"></a>                              <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totaldeadrows</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN394"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>analyze_row_processor</span><span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN395"></a>                      <a href="postgres_fdw.c.html#LN220"><span class='Ref_to_Struct'>PgFdwAnalyzeState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN396"></a><span class='Keyword'>static </span><a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>make_tuple_from_result_row</span><span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Delimiter'>, 
</span><a name="LN397"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN398"></a>                           <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN399"></a>                           <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attinmeta</span><span class='Delimiter'>, 
</span><a name="LN400"></a>                           <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>retrieved_attrs</span><span class='Delimiter'>, 
</span><a name="LN401"></a>                           <a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsstate</span><span class='Delimiter'>, 
</span><a name="LN402"></a>                           <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>temp_context</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN403"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>conversion_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN404"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>foreign_join_ok</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>joinrel</span><span class='Delimiter'>, 
</span><a name="LN405"></a>                <a href="../../src/include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outerrel</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>innerrel</span><span class='Delimiter'>, 
</span><a name="LN406"></a>                <a href="../../src/include/nodes/relation.h.html#LN2177"><span class='Ref_to_Struct'>JoinPathExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN407"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>foreign_grouping_ok</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grouped_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN408"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_useful_pathkeys_for_relation</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN409"></a>                                 <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN410"></a><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_useful_ecs_for_relation</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN411"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_paths_with_pathkeys_for_rel</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN412"></a>                                <a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epq_path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN413"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_foreign_grouping_paths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN414"></a>                           <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_rel</span><span class='Delimiter'>, 
</span><a name="LN415"></a>                           <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grouped_rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN416"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>apply_server_options</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN417"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>apply_table_options</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN418"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>merge_fdw_options</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo</span><span class='Delimiter'>, 
</span><a name="LN419"></a>                  <span class='Keyword'>const </span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo_o</span><span class='Delimiter'>, 
</span><a name="LN420"></a>                  <span class='Keyword'>const </span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo_i</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Foreign-data wrapper handler function: return a struct with pointers 
 * to my callback routines. 
 */ 
</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN428"></a><span class='Declare_Function'>postgres_fdw_handler</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN430"></a>    <a href="../../src/include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>routine</span> <span class='Operator'>= </span><a href="../../src/include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../src/include/foreign/fdwapi.h.html#LN168"><span class='Ref_to_Struct'>FdwRoutine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Functions for scanning foreign tables */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN173"><span class='Ref_to_Member'>GetForeignRelSize</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN273"><span class='Ref_to_Proto'>postgresGetForeignRelSize</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN174"><span class='Ref_to_Member'>GetForeignPaths</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN276"><span class='Ref_to_Proto'>postgresGetForeignPaths</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN175"><span class='Ref_to_Member'>GetForeignPlan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN279"><span class='Ref_to_Proto'>postgresGetForeignPlan</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN176"><span class='Ref_to_Member'>BeginForeignScan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN286"><span class='Ref_to_Proto'>postgresBeginForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN177"><span class='Ref_to_Member'>IterateForeignScan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN287"><span class='Ref_to_Proto'>postgresIterateForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN178"><span class='Ref_to_Member'>ReScanForeignScan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN288"><span class='Ref_to_Proto'>postgresReScanForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN179"><span class='Ref_to_Member'>EndForeignScan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN289"><span class='Ref_to_Proto'>postgresEndForeignScan</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Functions for updating foreign tables */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN193"><span class='Ref_to_Member'>AddForeignUpdateTargets</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN290"><span class='Ref_to_Proto'>postgresAddForeignUpdateTargets</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN194"><span class='Ref_to_Member'>PlanForeignModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN293"><span class='Ref_to_Proto'>postgresPlanForeignModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN195"><span class='Ref_to_Member'>BeginForeignModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN297"><span class='Ref_to_Proto'>postgresBeginForeignModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN196"><span class='Ref_to_Member'>ExecForeignInsert</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN302"><span class='Ref_to_Proto'>postgresExecForeignInsert</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN197"><span class='Ref_to_Member'>ExecForeignUpdate</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN306"><span class='Ref_to_Proto'>postgresExecForeignUpdate</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN198"><span class='Ref_to_Member'>ExecForeignDelete</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN310"><span class='Ref_to_Proto'>postgresExecForeignDelete</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN199"><span class='Ref_to_Member'>EndForeignModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN314"><span class='Ref_to_Proto'>postgresEndForeignModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN200"><span class='Ref_to_Member'>IsForeignRelUpdatable</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN316"><span class='Ref_to_Proto'>postgresIsForeignRelUpdatable</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN201"><span class='Ref_to_Member'>PlanDirectModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN317"><span class='Ref_to_Proto'>postgresPlanDirectModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN202"><span class='Ref_to_Member'>BeginDirectModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN321"><span class='Ref_to_Proto'>postgresBeginDirectModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN203"><span class='Ref_to_Member'>IterateDirectModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN322"><span class='Ref_to_Proto'>postgresIterateDirectModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN204"><span class='Ref_to_Member'>EndDirectModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN323"><span class='Ref_to_Proto'>postgresEndDirectModify</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Function for EvalPlanQual rechecks */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN209"><span class='Ref_to_Member'>RecheckForeignScan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN344"><span class='Ref_to_Proto'>postgresRecheckForeignScan</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Support functions for EXPLAIN */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN212"><span class='Ref_to_Member'>ExplainForeignScan</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN324"><span class='Ref_to_Proto'>postgresExplainForeignScan</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN213"><span class='Ref_to_Member'>ExplainForeignModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN326"><span class='Ref_to_Proto'>postgresExplainForeignModify</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN214"><span class='Ref_to_Member'>ExplainDirectModify</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN331"><span class='Ref_to_Proto'>postgresExplainDirectModify</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Support functions for ANALYZE */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN217"><span class='Ref_to_Member'>AnalyzeForeignTable</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN333"><span class='Ref_to_Proto'>postgresAnalyzeForeignTable</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Support functions for IMPORT FOREIGN SCHEMA */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN220"><span class='Ref_to_Member'>ImportForeignSchema</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN336"><span class='Ref_to_Proto'>postgresImportForeignSchema</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Support functions for join push-down */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN187"><span class='Ref_to_Member'>GetForeignJoinPaths</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN338"><span class='Ref_to_Proto'>postgresGetForeignJoinPaths</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Support functions for upper relation push-down */ 
</span>    <a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/fdwapi.h.html#LN190"><span class='Ref_to_Member'>GetForeignUpperPaths</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN346"><span class='Ref_to_Proto'>postgresGetForeignUpperPaths</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN430"><span class='Ref_To_Local'>routine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgres_fdw_handler &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresGetForeignRelSize 
 *      Estimate # of rows and width of the result of the scan 
 * 
 * We should consider the effect of all baserestrictinfo clauses here, but 
 * not any join clauses. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN485"></a><span class='Declare_Function'>postgresGetForeignRelSize</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN486"></a>                          <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN487"></a>                          <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN489"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span><span class='Delimiter'>; 
</span><a name="LN490"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../src/include/nodes/relation.h.html#LN324"><span class='Ref_to_Macro'>planner_rt_fetch</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN492"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>namespace</span><span class='Delimiter'>; 
</span><a name="LN493"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>relname</span><span class='Delimiter'>; 
</span><a name="LN494"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>refname</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use PgFdwRelationInfo to pass various information to subsequent 
     * functions. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Base foreign tables need to be pushed down always. */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up foreign-table catalog info. */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN74"><span class='Ref_to_Member'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN487"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN74"><span class='Ref_to_Member'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract user-settable option values.  Note that per-table setting of 
     * use_remote_estimate overrides per-server setting. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN69"><span class='Ref_to_Member'>fdw_startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN47"><span class='Ref_to_Const'>DEFAULT_FDW_STARTUP_COST</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN70"><span class='Ref_to_Member'>fdw_tuple_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN50"><span class='Ref_to_Const'>DEFAULT_FDW_TUPLE_COST</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN71"><span class='Ref_to_Member'>shippable_extensions</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a> <span class='Operator'>= </span><span class='Number'>100</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN416"><span class='Ref_to_Proto'>apply_server_options</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN417"><span class='Ref_to_Proto'>apply_table_options</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the table or the server is configured to use remote estimates, 
     * identify which user to do remote access as during planning.  This 
     * should match what ExecCheckRTEPerms() does.  If we fail due to lack of 
     * permissions, the query would have failed at runtime anyway. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN531"></a>        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>userid</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN491"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>? </span><a href="postgres_fdw.c.html#LN491"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>: </span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN531"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify which baserestrictinfo clauses can be sent to the remote 
     * server and which can't. 
     */ 
</span>    <a href="postgres_fdw.h.html#LN134"><span class='Ref_to_Proto'>classifyConditions</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN583"><span class='Ref_to_Member'>baserestrictinfo</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify which attributes will need to be retrieved from the remote 
     * server.  These include all attrs needed for joins or final output, plus 
     * all attrs used in the local_conds.  (Note: if we end up using a 
     * parameterized scan, it's possible that some of the join clauses will be 
     * sent to the remote and thus we wouldn't really need to retrieve the 
     * columns used in them.  Doesn't seem worth detecting that case though.) 
     */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN49"><span class='Ref_to_Member'>attrs_used</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN882"><span class='Ref_to_Member'>exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN49"><span class='Ref_to_Member'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN490"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN558"></a>        <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN490"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/optimizer/var.h.html#LN31"><span class='Ref_to_Proto'>pull_varattnos</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN558"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN49"><span class='Ref_to_Member'>attrs_used</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute the selectivity and cost of the local_conds, so we don't have 
     * to do it over again for each path.  The best we can do for these 
     * conditions is to estimate selectivity on the basis of local statistics. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN53"><span class='Ref_to_Member'>local_conds_sel</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/clausesel.c.html#LN97"><span class='Ref_to_Func'>clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                     <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, 
</span>                                                     <a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/optimizer/cost.h.html#LN157"><span class='Ref_to_Proto'>cost_qual_eval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN52"><span class='Ref_to_Member'>local_conds_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set cached relation costs to some negative value, so that we can detect 
     * when they are set to some sensible costs during one (usually the first) 
     * of the calls to estimate_path_cost_size(). 
     */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the table or the server is configured to use remote estimates, 
     * connect to the foreign server and execute EXPLAIN to estimate the 
     * number of rows selected by the restriction clauses, as well as the 
     * average row width.  Otherwise, estimate using whatever statistics we 
     * have locally, in a way similar to ordinary tables. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Get cost/size estimates with help of remote server.  Save the 
         * values in fpinfo so we don't need to do it again to generate the 
         * basic foreign path. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN354"><span class='Ref_to_Proto'>estimate_path_cost_size</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN60"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN61"><span class='Ref_to_Member'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN62"><span class='Ref_to_Member'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Report estimated baserel size to planner. */ 
</span>        <a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN60"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If the foreign table has never been ANALYZEd, it will have relpages 
         * and reltuples equal to zero, which most likely has nothing to do 
         * with reality.  We can't do a whole lot about that if we're not 
         * allowed to consult the remote server, but we can use a hack similar 
         * to plancat.c's treatment of empty relations: use a minimum size 
         * estimate of 10 pages, and divide by the column-datatype-based width 
         * estimate to get the corresponding number of tuples. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN563"><span class='Ref_to_Member'>pages</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN563"><span class='Ref_to_Member'>pages</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><span class='Number'>10</span> <span class='Operator'>* </span>BLCKSZ<span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>+ 
</span>                                 <a href="../../src/include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="../../src/include/access/htup_details.h.html#LN169"><span class='Ref_to_Const'>SizeofHeapTupleHeader</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Estimate baserel size as best we can with local statistics. */ 
</span>        <a href="../../src/include/optimizer/cost.h.html#LN166"><span class='Ref_to_Proto'>set_baserel_size_estimates</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fill in basically-bogus cost estimates for use later. */ 
</span>        <a href="postgres_fdw.c.html#LN354"><span class='Ref_to_Proto'>estimate_path_cost_size</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN485"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN60"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN61"><span class='Ref_to_Member'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN62"><span class='Ref_to_Member'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Set the name of relation in fpinfo, while we are constructing it here. 
     * It will be used to build the string describing the join relation in 
     * EXPLAIN output. We can't know whether VERBOSE option is specified or 
     * not, so always schema-qualify the foreign table name. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a> <span class='Operator'>= </span><a href="../../src/backend/lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>namespace</span> <span class='Operator'>= </span><a href="../../src/include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/lsyscache.h.html#LN125"><span class='Ref_to_Proto'>get_rel_namespace</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN487"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN493"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN487"><span class='Ref_to_Parameter'>foreigntableid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN494"><span class='Ref_To_Local'>refname</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN491"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1023"><span class='Ref_to_Member'>eref</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN41"><span class='Ref_to_Member'>aliasname</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Delimiter'>, </span><span class='String'>"%s.%s"</span><span class='Delimiter'>, 
</span>                     <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><span class='Control'>namespace</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN493"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postgres_fdw.c.html#LN494"><span class='Ref_To_Local'>refname</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN494"><span class='Ref_To_Local'>refname</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN493"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Delimiter'>, </span><span class='String'>" %s"</span><span class='Delimiter'>, 
</span>                         <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN491"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1023"><span class='Ref_to_Member'>eref</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN41"><span class='Ref_to_Member'>aliasname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* No outer and inner relations. */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN98"><span class='Ref_to_Member'>make_outerrel_subquery</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN100"><span class='Ref_to_Member'>make_innerrel_subquery</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Set the relation index. */ 
</span>    <a href="postgres_fdw.c.html#LN489"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN109"><span class='Ref_to_Member'>relation_index</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN486"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresGetForeignRelSize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_useful_ecs_for_relation 
 *      Determine which EquivalenceClasses might be involved in useful 
 *      orderings of this relation. 
 * 
 * This function is in some respects a mirror image of the core function 
 * pathkeys_useful_for_merging: for a regular table, we know what indexes 
 * we have and want to test whether any of them are useful.  For a foreign 
 * table, we don't know what indexes are present on the remote side but 
 * want to speculate about which ones we'd like to use if they existed. 
 * 
 * This function returns a list of potentially-useful equivalence classes, 
 * but it does not guarantee that an EquivalenceMember exists which contains 
 * Vars only from the given relation.  For example, given ft1 JOIN t1 ON 
 * ft1.x + t1.x = 0, this function will say that the equivalence class 
 * containing ft1.x + t1.x is potentially useful.  Supposing ft1 is remote and 
 * t1 is local (or on a different server), it will turn out that no useful 
 * ORDER BY clause can be generated.  It's not our job to figure that out 
 * here; we're only interested in identifying relevant ECs. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN681"></a><span class='Declare_Function'>get_useful_ecs_for_relation</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN683"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>useful_eclass_list</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN684"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN685"></a>    <a href="../../src/include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>relids</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, consider whether any active EC is potentially useful for a merge 
     * join against this relation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN590"><span class='Ref_to_Member'>has_eclass_joins</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN684"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN234"><span class='Ref_to_Member'>eq_classes</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN695"></a>            <a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN684"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/optimizer/paths.h.html#LN165"><span class='Ref_to_Proto'>eclass_useful_for_merging</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN695"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
                <a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN695"><span class='Ref_To_Local'>cur_ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Next, consider whether there are any non-EC derivable join clauses that 
     * are merge-joinable.  If the joininfo list is empty, we can exit 
     * quickly. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN588"><span class='Ref_to_Member'>joininfo</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If this is a child rel, we must use the topmost parent rel to search. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN515"><span class='Ref_to_Macro'>IS_OTHER_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN593"><span class='Ref_to_Member'>top_parent_relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN685"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN593"><span class='Ref_to_Member'>top_parent_relids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN685"><span class='Ref_To_Local'>relids</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check each join clause in turn. */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN684"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN588"><span class='Ref_to_Member'>joininfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN722"></a>        <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>restrictinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN684"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Consider only mergejoinable clauses */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN722"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1791"><span class='Ref_to_Member'>mergeopfamilies</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make sure we've got canonical ECs. */ 
</span>        <a href="../../src/include/optimizer/paths.h.html#LN210"><span class='Ref_to_Proto'>update_mergeclause_eclasses</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN681"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN722"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * restrictinfo-&GT;mergeopfamilies != NIL is sufficient to guarantee 
         * that left_ec and right_ec will be initialized, per comments in 
         * distribute_qual_to_rels. 
         * 
         * We want to identify which side of this merge-joinable clause 
         * contains columns from the relation produced by this RelOptInfo. We 
         * test for overlap, not containment, because there could be extra 
         * relations on either side.  For example, suppose we've got something 
         * like ((A JOIN B ON A.x = B.x) JOIN C ON A.y = C.y) LEFT JOIN D ON 
         * A.y = D.y.  The input rel might be the joinrel between A and B, and 
         * we'll consider the join clause A.y = D.y. relids contains a 
         * relation not involved in the join class (B) and the equivalence 
         * class for the left-hand side of the clause contains a relation not 
         * involved in the input rel (C).  Despite the fact that we have only 
         * overlap and not containment in either direction, A.y is potentially 
         * useful as a sort column. 
         * 
         * Note that it's even possible that relids overlaps neither side of 
         * the join clause.  For example, consider A LEFT JOIN B ON A.x = B.x 
         * AND A.x = 1.  The clause A.x = 1 will appear in B's joininfo list, 
         * but overlaps neither side of B.  In that case, we just skip this 
         * join clause, since it doesn't suggest a useful sort order for this 
         * relation. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN685"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN722"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>))</span> 
            <a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN256"><span class='Ref_to_Proto'>list_append_unique_ptr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a><span class='Delimiter'>, 
</span>                                                     <a href="postgres_fdw.c.html#LN722"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1795"><span class='Ref_to_Member'>right_ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN76"><span class='Ref_to_Proto'>bms_overlap</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN685"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN722"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN775"><span class='Ref_to_Member'>ec_relids</span></a><span class='Parentheses'>))</span> 
            <a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN256"><span class='Ref_to_Proto'>list_append_unique_ptr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a><span class='Delimiter'>, 
</span>                                                      <a href="postgres_fdw.c.html#LN722"><span class='Ref_To_Local'>restrictinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1794"><span class='Ref_to_Member'>left_ec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN683"><span class='Ref_To_Local'>useful_eclass_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_useful_ecs_for_relation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_useful_pathkeys_for_relation 
 *      Determine which orderings of a relation might be useful. 
 * 
 * Getting data in sorted order can be useful either because the requested 
 * order matches the final output ordering for the overall query we're 
 * planning, or because it enables an efficient merge join.  Here, we try 
 * to figure out which pathkeys to consider. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN777"></a><span class='Declare_Function'>get_useful_pathkeys_for_relation</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN779"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>useful_pathkeys_list</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN780"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>useful_eclass_list</span><span class='Delimiter'>; 
</span><a name="LN781"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN782"></a>    <a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>query_ec</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN783"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pushing the query_pathkeys to the remote server is always worth 
     * considering, because it might let us avoid a local sort. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN791"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>query_pathkeys_ok</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN783"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN795"></a>            <a href="../../src/include/nodes/relation.h.html#LN845"><span class='Ref_to_Struct'>PathKey</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>pathkey</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN845"><span class='Ref_to_Struct'>PathKey</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN783"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN796"></a>            <a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pathkey_ec</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN795"><span class='Ref_To_Local'>pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN849"><span class='Ref_to_Member'>pk_eclass</span></a><span class='Delimiter'>; 
</span><a name="LN797"></a>            <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>em_expr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The planner and executor don't have any clever strategy for 
             * taking data sorted by a prefix of the query's pathkeys and 
             * getting it to be sorted by all of those pathkeys. We'll just 
             * end up resorting the entire data set.  So, unless we can push 
             * down all of the query pathkeys, forget it. 
             * 
             * is_foreign_expr would detect volatile expressions as well, but 
             * checking ec_has_volatile here saves some cycles. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN796"><span class='Ref_To_Local'>pathkey_ec</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN778"><span class='Ref_to_Member'>ec_has_volatile</span></a> <span class='Operator'>|| 
</span>                <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN797"><span class='Ref_To_Local'>em_expr</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN172"><span class='Ref_to_Proto'>find_em_expr_for_rel</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN796"><span class='Ref_To_Local'>pathkey_ec</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>                <span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN797"><span class='Ref_To_Local'>em_expr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="postgres_fdw.c.html#LN791"><span class='Ref_To_Local'>query_pathkeys_ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN791"><span class='Ref_To_Local'>query_pathkeys_ok</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN779"><span class='Ref_To_Local'>useful_pathkeys_list</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if root-&GT;query_pathkeys &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Even if we're not using remote estimates, having the remote side do the 
     * sort generally won't be any worse than doing it locally, and it might 
     * be much better if the remote side can generate data in the right order 
     * without needing a sort at all.  However, what we're going to do next is 
     * try to generate pathkeys that seem promising for possible merge joins, 
     * and that's more speculative.  A wrong choice might hurt quite a bit, so 
     * bail out if we can't use remote estimates. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN781"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN779"><span class='Ref_To_Local'>useful_pathkeys_list</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the list of interesting EquivalenceClasses. */ 
</span>    <a href="postgres_fdw.c.html#LN780"><span class='Ref_To_Local'>useful_eclass_list</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN410"><span class='Ref_to_Proto'>get_useful_ecs_for_relation</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract unique EC for query, if any, so we don't consider it again. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN840"></a>        <a href="../../src/include/nodes/relation.h.html#LN845"><span class='Ref_to_Struct'>PathKey</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>query_pathkey</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN261"><span class='Ref_to_Member'>query_pathkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN782"><span class='Ref_To_Local'>query_ec</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN840"><span class='Ref_To_Local'>query_pathkey</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN849"><span class='Ref_to_Member'>pk_eclass</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * As a heuristic, the only pathkeys we consider here are those of length 
     * one.  It's surely possible to consider more, but since each one we 
     * choose to consider will generate a round-trip to the remote side, we 
     * need to be a bit cautious here.  It would sure be nice to have a local 
     * cache of information about remote index definitions... 
     */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN783"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN780"><span class='Ref_To_Local'>useful_eclass_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN854"></a>        <a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur_ec</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN783"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN855"></a>        <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>em_expr</span><span class='Delimiter'>; 
</span><a name="LN856"></a>        <a href="../../src/include/nodes/relation.h.html#LN845"><span class='Ref_to_Struct'>PathKey</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>pathkey</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If redundant with what we did above, skip it. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN854"><span class='Ref_To_Local'>cur_ec</span></a> <span class='Operator'>== </span><a href="postgres_fdw.c.html#LN782"><span class='Ref_To_Local'>query_ec</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If no pushable expression for this rel, skip it. */ 
</span>        <a href="postgres_fdw.c.html#LN855"><span class='Ref_To_Local'>em_expr</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN172"><span class='Ref_to_Proto'>find_em_expr_for_rel</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN854"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN855"><span class='Ref_To_Local'>em_expr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN855"><span class='Ref_To_Local'>em_expr</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Looks like we can generate a pathkey, so let's do it. */ 
</span>        <a href="postgres_fdw.c.html#LN856"><span class='Ref_To_Local'>pathkey</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/pathkeys.c.html#LN49"><span class='Ref_to_Func'>make_canonical_pathkey</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN777"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN854"><span class='Ref_To_Local'>cur_ec</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../src/include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN854"><span class='Ref_To_Local'>cur_ec</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN770"><span class='Ref_to_Member'>ec_opfamilies</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="../../src/include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN779"><span class='Ref_To_Local'>useful_pathkeys_list</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN779"><span class='Ref_To_Local'>useful_pathkeys_list</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN856"><span class='Ref_To_Local'>pathkey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN779"><span class='Ref_To_Local'>useful_pathkeys_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_useful_pathkeys_for_relation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresGetForeignPaths 
 *      Create possible scan paths for a scan on the foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN884"></a><span class='Declare_Function'>postgresGetForeignPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN885"></a>                        <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>baserel</span><span class='Delimiter'>, 
</span><a name="LN886"></a>                        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN888"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN889"></a>    <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span><a name="LN890"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ppi_list</span><span class='Delimiter'>; 
</span><a name="LN891"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create simplest ForeignScan path node and add it to baserel.  This path 
     * corresponds to SeqScan path of regular tables (though depending on what 
     * baserestrict conditions we were able to send to remote, there might 
     * actually be an indexscan happening there).  We already did all the work 
     * to estimate cost and size of this path. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN889"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/pathnode.h.html#LN106"><span class='Ref_to_Proto'>create_foreignscan_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* default pathtarget */ 
</span>                                   <a href="postgres_fdw.c.html#LN888"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN888"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN61"><span class='Ref_to_Member'>startup_cost</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN888"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN62"><span class='Ref_to_Member'>total_cost</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* no pathkeys */ 
</span>                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* no outer rel either */ 
</span>                                   <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* no extra plan */ 
</span>                                   <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* no fdw_private list */ 
</span>    <a href="../../src/include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN889"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add paths with pathkeys */ 
</span>    <a href="postgres_fdw.c.html#LN411"><span class='Ref_to_Proto'>add_paths_with_pathkeys_for_rel</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're not using remote estimates, stop here.  We have no way to 
     * estimate whether any join clauses would be worth sending across, so 
     * don't bother building parameterized paths. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN888"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Thumb through all join clauses for the rel to identify which outer 
     * relations could supply one or more safe-to-send-to-remote join clauses. 
     * We'll build a parameterized path for each such outer relation. 
     * 
     * It's convenient to manage this by representing each candidate outer 
     * relation by the ParamPathInfo node for it.  We can then use the 
     * ppi_clauses list in the ParamPathInfo node directly as a list of the 
     * interesting join clauses for that rel.  This takes care of the 
     * possibility that there are multiple safe join clauses for such a rel, 
     * and also ensures that we account for unsafe join clauses that we'll 
     * still have to enforce locally (since the parameterized-path machinery 
     * insists that we handle all movable clauses). 
     */ 
</span>    <a href="postgres_fdw.c.html#LN890"><span class='Ref_To_Local'>ppi_list</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN891"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN588"><span class='Ref_to_Member'>joininfo</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN939"></a>        <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN891"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN940"></a>        <a href="../../src/include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>required_outer</span><span class='Delimiter'>; 
</span><a name="LN941"></a>        <a href="../../src/include/nodes/relation.h.html#LN907"><span class='Ref_to_Struct'>ParamPathInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>param_info</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check if clause can be moved to this rel */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/optimizer/restrictinfo.h.html#LN40"><span class='Ref_to_Proto'>join_clause_is_movable_to</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN939"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* See if it is safe to send to remote */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN939"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Calculate required outer rels for the resulting path */ 
</span>        <a href="postgres_fdw.c.html#LN940"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN939"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN549"><span class='Ref_to_Member'>lateral_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* We do not want the foreign rel itself listed in required_outer */ 
</span>        <a href="postgres_fdw.c.html#LN940"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN940"><span class='Ref_To_Local'>required_outer</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * required_outer probably can't be empty here, but if it were, we 
         * couldn't make a parameterized path. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN940"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the ParamPathInfo */ 
</span>        <a href="postgres_fdw.c.html#LN941"><span class='Ref_To_Local'>param_info</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/pathnode.h.html#LN275"><span class='Ref_to_Proto'>get_baserel_parampathinfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                               <a href="postgres_fdw.c.html#LN940"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN941"><span class='Ref_To_Local'>param_info</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add it to list unless we already have it.  Testing pointer equality 
         * is OK since get_baserel_parampathinfo won't make duplicates. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN890"><span class='Ref_To_Local'>ppi_list</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN256"><span class='Ref_to_Proto'>list_append_unique_ptr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN890"><span class='Ref_To_Local'>ppi_list</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN941"><span class='Ref_To_Local'>param_info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The above scan examined only "generic" join clauses, not those that 
     * were absorbed into EquivalenceClauses.  See if we can make anything out 
     * of EquivalenceClauses. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN590"><span class='Ref_to_Member'>has_eclass_joins</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We repeatedly scan the eclass list looking for column references 
         * (or expressions) belonging to the foreign rel.  Each time we find 
         * one, we generate a list of equivalence joinclauses for it, and then 
         * see if any are safe to send to the remote.  Repeat till there are 
         * no more candidate EC members. 
         */ 
</span><a name="LN990"></a>        <a href="postgres_fdw.c.html#LN259"><span class='Ref_to_Typedef'>ec_member_foreign_arg</span></a> <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN262"><span class='Ref_to_Member'>already_used</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN995"></a>            <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>clauses</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Make clauses, skipping any that join to lateral_referencers */ 
</span>            <a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN261"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN995"><span class='Ref_To_Local'>clauses</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/paths.h.html#LN156"><span class='Ref_to_Proto'>generate_implied_equalities_for_column</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                             <a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                                   <a href="postgres_fdw.c.html#LN366"><span class='Ref_to_Proto'>ec_member_matches_foreign</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, 
</span>                                               <a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN560"><span class='Ref_to_Member'>lateral_referencers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Done if there are no more expressions in the foreign rel */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN261"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN995"><span class='Ref_To_Local'>clauses</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Scan the extracted join clauses */ 
</span>            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN891"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN995"><span class='Ref_To_Local'>clauses</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1015"></a>                <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN891"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1016"></a>                <a href="../../src/include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>required_outer</span><span class='Delimiter'>; 
</span><a name="LN1017"></a>                <a href="../../src/include/nodes/relation.h.html#LN907"><span class='Ref_to_Struct'>ParamPathInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>param_info</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Check if clause can be moved to this rel */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/optimizer/restrictinfo.h.html#LN40"><span class='Ref_to_Proto'>join_clause_is_movable_to</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1015"><span class='Ref_To_Local'>rinfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* See if it is safe to send to remote */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1015"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Calculate required outer rels for the resulting path */ 
</span>                <a href="postgres_fdw.c.html#LN1016"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1015"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1761"><span class='Ref_to_Member'>clause_relids</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN549"><span class='Ref_to_Member'>lateral_relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN1016"><span class='Ref_To_Local'>required_outer</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN90"><span class='Ref_to_Proto'>bms_del_member</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1016"><span class='Ref_To_Local'>required_outer</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN85"><span class='Ref_to_Proto'>bms_is_empty</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1016"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Get the ParamPathInfo */ 
</span>                <a href="postgres_fdw.c.html#LN1017"><span class='Ref_To_Local'>param_info</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/pathnode.h.html#LN275"><span class='Ref_to_Proto'>get_baserel_parampathinfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                                       <a href="postgres_fdw.c.html#LN1016"><span class='Ref_To_Local'>required_outer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1017"><span class='Ref_To_Local'>param_info</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Add it to list unless we already have it */ 
</span>                <a href="postgres_fdw.c.html#LN890"><span class='Ref_To_Local'>ppi_list</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN256"><span class='Ref_to_Proto'>list_append_unique_ptr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN890"><span class='Ref_To_Local'>ppi_list</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1017"><span class='Ref_To_Local'>param_info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Try again, now ignoring the expression we found this time */ 
</span>            <a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN262"><span class='Ref_to_Member'>already_used</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN262"><span class='Ref_to_Member'>already_used</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN990"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN261"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if baserel-&GT;has_eclass_j... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now build a path for each useful outer relation. 
     */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN891"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN890"><span class='Ref_To_Local'>ppi_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1053"></a>        <a href="../../src/include/nodes/relation.h.html#LN907"><span class='Ref_to_Struct'>ParamPathInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>param_info</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN907"><span class='Ref_to_Struct'>ParamPathInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN891"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1054"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>rows</span><span class='Delimiter'>; 
</span><a name="LN1055"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>width</span><span class='Delimiter'>; 
</span><a name="LN1056"></a>        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>startup_cost</span><span class='Delimiter'>; 
</span><a name="LN1057"></a>        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>total_cost</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get a cost estimate from the remote */ 
</span>        <a href="postgres_fdw.c.html#LN354"><span class='Ref_to_Proto'>estimate_path_cost_size</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                <a href="postgres_fdw.c.html#LN1053"><span class='Ref_To_Local'>param_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN913"><span class='Ref_to_Member'>ppi_clauses</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1054"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1055"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1056"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1057"><span class='Ref_To_Local'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * ppi_rows currently won't get looked at by anything, but still we 
         * may as well ensure that it matches our idea of the rowcount. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN1053"><span class='Ref_To_Local'>param_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN912"><span class='Ref_to_Member'>ppi_rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1054"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make the path */ 
</span>        <a href="postgres_fdw.c.html#LN889"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/pathnode.h.html#LN106"><span class='Ref_to_Proto'>create_foreignscan_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN884"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* default pathtarget */ 
</span>                                       <a href="postgres_fdw.c.html#LN1054"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres_fdw.c.html#LN1056"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres_fdw.c.html#LN1057"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no pathkeys */ 
</span>                                       <a href="postgres_fdw.c.html#LN1053"><span class='Ref_To_Local'>param_info</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN911"><span class='Ref_to_Member'>ppi_req_outer</span></a><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* no fdw_private list */ 
</span>        <a href="../../src/include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN885"><span class='Ref_to_Parameter'>baserel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN889"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end postgresGetForeignPaths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresGetForeignPlan 
 *      Create ForeignScan plan node which implements selected best path 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>* 
</span><a name="LN1090"></a><span class='Declare_Function'>postgresGetForeignPlan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1091"></a>                       <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>foreignrel</span><span class='Delimiter'>, 
</span><a name="LN1092"></a>                       <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>foreigntableid</span><span class='Delimiter'>, 
</span><a name="LN1093"></a>                       <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>best_path</span><span class='Delimiter'>, 
</span><a name="LN1094"></a>                       <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, 
</span><a name="LN1095"></a>                       <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scan_clauses</span><span class='Delimiter'>, 
</span><a name="LN1096"></a>                       <a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outer_plan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1098"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN1099"></a>    <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>scan_relid</span><span class='Delimiter'>; 
</span><a name="LN1100"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_private</span><span class='Delimiter'>; 
</span><a name="LN1101"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>remote_exprs</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1102"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>local_exprs</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1103"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>params_list</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1104"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_scan_tlist</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1105"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_recheck_quals</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1106"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>retrieved_attrs</span><span class='Delimiter'>; 
</span><a name="LN1107"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN1108"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN504"><span class='Ref_to_Macro'>IS_SIMPLE_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For base relations, set scan_relid as the relid of the relation. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN1099"><span class='Ref_To_Local'>scan_relid</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In a base-relation scan, we must apply the given scan_clauses. 
         * 
         * Separate the scan_clauses into those that can be executed remotely 
         * and those that can't.  baserestrictinfo clauses that were 
         * previously determined to be safe or unsafe by classifyConditions 
         * are found in fpinfo-&GT;remote_conds and fpinfo-&GT;local_conds. Anything 
         * else in the scan_clauses list will be a join clause, which we have 
         * to check for remote-safety. 
         * 
         * Note: the join clauses we see here should be the exact same ones 
         * previously examined by postgresGetForeignPaths.  Possibly it'd be 
         * worth passing forward the classification work done then, rather 
         * than repeating it here. 
         * 
         * This code must match "extract_actual_clauses(scan_clauses, false)" 
         * except for the additional decision about remote versus local 
         * execution. 
         */ 
</span>        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1108"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1095"><span class='Ref_to_Parameter'>scan_clauses</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1138"></a>            <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1108"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Ignore any pseudoconstants, they're dealt with elsewhere */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1754"><span class='Ref_to_Member'>pseudoconstant</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN229"><span class='Ref_to_Proto'>list_member_ptr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>))</span> 
                <a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN229"><span class='Ref_to_Proto'>list_member_ptr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>))</span> 
                <a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1090"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>))</span> 
                <a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1138"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For a base-relation scan, we have to support EPQ recheck, which 
         * should recheck all the remote quals. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN1105"><span class='Ref_To_Local'>fdw_recheck_quals</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IS_SIMPLE_REL(foreign... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Join relation or upper relation - set scan_relid to 0. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN1099"><span class='Ref_To_Local'>scan_relid</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For a join rel, baserestrictinfo is NIL and we are not considering 
         * parameterization right now, so there should be no scan_clauses for 
         * a joinrel or an upper rel either. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1095"><span class='Ref_to_Parameter'>scan_clauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Instead we get the conditions to apply from the fdw_private 
         * structure. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/restrictinfo.h.html#LN35"><span class='Ref_to_Proto'>extract_actual_clauses</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/restrictinfo.h.html#LN35"><span class='Ref_to_Proto'>extract_actual_clauses</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We leave fdw_recheck_quals empty in this case, since we never need 
         * to apply EPQ recheck clauses.  In the case of a joinrel, EPQ 
         * recheck is handled elsewhere --- see postgresGetForeignJoinPaths(). 
         * If we're planning an upperrel (ie, remote grouping or aggregation) 
         * then there's no EPQ to do because SELECT FOR UPDATE wouldn't be 
         * allowed, and indeed we *can't* put the remote clauses into 
         * fdw_recheck_quals because the unaggregated Vars won't be available 
         * locally. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* Build the list of columns to be fetched from the foreign server. */ 
</span>        <a href="postgres_fdw.c.html#LN1104"><span class='Ref_To_Local'>fdw_scan_tlist</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN173"><span class='Ref_to_Proto'>build_tlist_to_deparse</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ensure that the outer plan produces a tuple whose descriptor 
         * matches our scan tuple slot. This is safe because all scans and 
         * joins support projection, so we never need to insert a Result node. 
         * Also, remove the local conditions from outer plan's quals, lest 
         * they will be evaluated twice, once by the local plan and once by 
         * the scan. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1096"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1205"></a>            <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Right now, we only consider grouping and aggregation beyond 
             * joins. Queries involving aggregates or grouping do not require 
             * EPQ mechanism, hence should not have an outer plan here. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/nodes/relation.h.html#LN512"><span class='Ref_to_Macro'>IS_UPPER_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN1096"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1104"><span class='Ref_To_Local'>fdw_scan_tlist</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1205"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1218"></a>                <a href="../../src/include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>join_plan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN665"><span class='Ref_to_Struct'>Join</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1096"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Delimiter'>; 
</span><a name="LN1219"></a>                <a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>qual</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1205"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="postgres_fdw.c.html#LN1096"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN233"><span class='Ref_to_Proto'>list_delete</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1096"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1219"><span class='Ref_To_Local'>qual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * For an inner join the local conditions of foreign scan plan 
                 * can be part of the joinquals as well. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1218"><span class='Ref_To_Local'>join_plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN668"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres_fdw.c.html#LN1218"><span class='Ref_To_Local'>join_plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN670"><span class='Ref_to_Member'>joinqual</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN233"><span class='Ref_to_Proto'>list_delete</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1218"><span class='Ref_To_Local'>join_plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN670"><span class='Ref_to_Member'>joinqual</span></a><span class='Delimiter'>, 
</span>                                                      <a href="postgres_fdw.c.html#LN1219"><span class='Ref_To_Local'>qual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if outer_plan &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Build the query string to be sent for execution, and identify 
     * expressions to be sent as parameters. 
     */ 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1107"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.h.html#LN174"><span class='Ref_to_Proto'>deparseSelectStmtForRel</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1107"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1090"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1104"><span class='Ref_To_Local'>fdw_scan_tlist</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1093"><span class='Ref_to_Parameter'>best_path</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1129"><span class='Ref_to_Member'>path</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN967"><span class='Ref_to_Member'>pathkeys</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1106"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1103"><span class='Ref_To_Local'>params_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember remote_exprs for possible use by postgresPlanDirectModify */ 
</span>    <a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN46"><span class='Ref_to_Member'>final_remote_exprs</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1101"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build the fdw_private list that will be available to the executor. 
     * Items in the list must match order in enum FdwScanPrivateIndex. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1100"><span class='Ref_To_Local'>fdw_private</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN140"><span class='Ref_to_Macro'>list_make3</span></a><span class='Parentheses'>(</span><a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1107"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1106"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Delimiter'>, 
</span>                             <a href="../../src/backend/nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN509"><span class='Ref_to_Macro'>IS_JOIN_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../src/include/nodes/relation.h.html#LN512"><span class='Ref_to_Macro'>IS_UPPER_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1091"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.c.html#LN1100"><span class='Ref_To_Local'>fdw_private</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1100"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, 
</span>                              <a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1098"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the ForeignScan node for the given relation. 
     * 
     * Note that the remote parameter expressions are stored in the fdw_exprs 
     * field of the finished plan node; we can't keep them in private state 
     * because then they wouldn't be subject to later planner processing. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../src/include/optimizer/planmain.h.html#LN50"><span class='Ref_to_Proto'>make_foreignscan</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1094"><span class='Ref_to_Parameter'>tlist</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1102"><span class='Ref_To_Local'>local_exprs</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1099"><span class='Ref_To_Local'>scan_relid</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1103"><span class='Ref_To_Local'>params_list</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1100"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1104"><span class='Ref_To_Local'>fdw_scan_tlist</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1105"><span class='Ref_To_Local'>fdw_recheck_quals</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN1096"><span class='Ref_to_Parameter'>outer_plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresGetForeignPlan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresBeginForeignScan 
 *      Initiate an executor scan of a foreign PostgreSQL table. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1279"></a><span class='Declare_Function'>postgresBeginForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1281"></a>    <a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN1282"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1283"></a>    <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span><span class='Delimiter'>; 
</span><a name="LN1284"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN1285"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>userid</span><span class='Delimiter'>; 
</span><a name="LN1286"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN1287"></a>    <a href="../../src/include/foreign/foreign.h.html#LN55"><span class='Ref_to_Struct'>UserMapping</span></a> <span class='Operator'>*</span><span class='Declare_Local'>user</span><span class='Delimiter'>; 
</span><a name="LN1288"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rtindex</span><span class='Delimiter'>; 
</span><a name="LN1289"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numParams</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do nothing in EXPLAIN (no ANALYZE) case.  node-&GT;fdw_state stays NULL. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><a href="../../src/include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll save private state in node-&GT;fdw_state. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify which user to do the remote access as.  This should match what 
     * ExecCheckRTEPerms() does.  In case of a join or aggregate, use the 
     * lowest-numbered member RTE as a representative; we would get the same 
     * result from any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN1288"><span class='Ref_To_Local'>rtindex</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN1288"><span class='Ref_To_Local'>rtindex</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN604"><span class='Ref_to_Member'>fs_relids</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1284"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1288"><span class='Ref_To_Local'>rtindex</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1282"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1285"><span class='Ref_To_Local'>userid</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1284"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>? </span><a href="postgres_fdw.c.html#LN1284"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>: </span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get info about foreign table. */ 
</span>    <a href="postgres_fdw.c.html#LN1286"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1284"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1287"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1285"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1286"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get connection to the foreign server.  Connection manager will 
     * establish new connection if necessary. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1287"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assign a unique ID for my cursor */ 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN137"><span class='Ref_to_Member'>cursor_number</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN119"><span class='Ref_to_Proto'>GetCursorNumber</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN138"><span class='Ref_to_Member'>cursor_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get private info created by planner functions. */ 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN132"><span class='Ref_to_Member'>query</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                     <a href="postgres_fdw.c.html#LN65"><span class='Ref_to_EnumConst'>FdwScanPrivateSelectSql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN133"><span class='Ref_to_Member'>retrieved_attrs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                               <a href="postgres_fdw.c.html#LN67"><span class='Ref_to_EnumConst'>FdwScanPrivateRetrievedAttrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN157"><span class='Ref_to_Member'>fetch_size</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                          <a href="postgres_fdw.c.html#LN69"><span class='Ref_to_EnumConst'>FdwScanPrivateFetchSize</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create contexts for batches of tuples and per-tuple temp workspace. */ 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN154"><span class='Ref_to_Member'>batch_cxt</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1282"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Delimiter'>, 
</span>                                               <span class='String'>"postgres_fdw tuple data"</span><span class='Delimiter'>, 
</span>                                               <a href="../../src/include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN155"><span class='Ref_to_Member'>temp_cxt</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1282"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Delimiter'>, 
</span>                                              <span class='String'>"postgres_fdw temporary data"</span><span class='Delimiter'>, 
</span>                                              <a href="../../src/include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get info we'll need for converting data fetched from the foreign server 
     * into local representation and error reporting during that process. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN126"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN128"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN126"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN126"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN128"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN129"><span class='Ref_to_Member'>attinmeta</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN230"><span class='Ref_to_Proto'>TupleDescGetAttInMetadata</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN128"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare for processing of parameters used in remote query, if any. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1289"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN139"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1289"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1289"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN380"><span class='Ref_to_Proto'>prepare_query_params</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1279"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1281"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1289"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN140"><span class='Ref_to_Member'>param_flinfo</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN141"><span class='Ref_to_Member'>param_exprs</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1283"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN142"><span class='Ref_to_Member'>param_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresBeginForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresIterateForeignScan 
 *      Retrieve next row from the result set, or clear tuple slot to indicate 
 *      EOF. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN1383"></a><span class='Declare_Function'>postgresIterateForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1385"></a>    <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1383"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN1386"></a>    <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1383"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this is the first call after Begin or ReScan, we need to create the 
     * cursor on the remote side. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN138"><span class='Ref_to_Member'>cursor_exists</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN369"><span class='Ref_to_Proto'>create_cursor</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1383"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get some more tuples, if we've run out. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>&GT;= </span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN146"><span class='Ref_to_Member'>num_tuples</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No point in another fetch if we already detected EOF, though. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN151"><span class='Ref_to_Member'>eof_reached</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN370"><span class='Ref_to_Proto'>fetch_more_data</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1383"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If we didn't get any tuples, must be end of data. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>&GT;= </span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN146"><span class='Ref_to_Member'>num_tuples</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../src/include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1386"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the next tuple. 
     */ 
</span>    <a href="../../src/include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN145"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN1385"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a><span class='Operator'>++</span><span class='Delimiter'>], 
</span>                   <a href="postgres_fdw.c.html#LN1386"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                   <a href="../../src/include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, 
</span>                   <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN1386"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresIterateForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresReScanForeignScan 
 *      Restart the scan. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1424"></a><span class='Declare_Function'>postgresReScanForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1426"></a>    <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1424"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN1427"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sql</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN1428"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we haven't created the cursor yet, nothing to do. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN138"><span class='Ref_to_Member'>cursor_exists</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If any internal parameters affecting this node have changed, we'd 
     * better destroy and recreate the cursor.  Otherwise, rewinding it should 
     * be good enough.  If we've only fetched zero or one batch, we needn't 
     * even rewind the cursor, just rescan what we have. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1424"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN836"><span class='Ref_to_Member'>chgParam</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN138"><span class='Ref_to_Member'>cursor_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1427"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1427"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"CLOSE c%u"</span><span class='Delimiter'>, 
</span>                 <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN137"><span class='Ref_to_Member'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN150"><span class='Ref_to_Member'>fetch_ct_2</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1427"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1427"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"MOVE BACKWARD ALL IN c%u"</span><span class='Delimiter'>, 
</span>                 <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN137"><span class='Ref_to_Member'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Easy: just rescan what we already have in memory, if anything */ 
</span>        <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1428"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1427"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1428"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1428"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1427"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1428"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now force a fresh FETCH. */ 
</span>    <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN145"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN146"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN150"><span class='Ref_to_Member'>fetch_ct_2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1426"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN151"><span class='Ref_to_Member'>eof_reached</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresReScanForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresEndForeignScan 
 *      Finish scanning foreign table and dispose objects used for this scan 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1480"></a><span class='Declare_Function'>postgresEndForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1482"></a>    <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1480"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if fsstate is NULL, we are in EXPLAIN; nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1482"><span class='Ref_To_Local'>fsstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Close the cursor if open, to prevent accumulation of cursors */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1482"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN138"><span class='Ref_to_Member'>cursor_exists</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN371"><span class='Ref_to_Proto'>close_cursor</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1482"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1482"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN137"><span class='Ref_to_Member'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release remote connection */ 
</span>    <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1482"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1482"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* MemoryContexts will be deleted automatically. */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * postgresAddForeignUpdateTargets 
 *      Add resjunk column(s) needed for update/delete on a foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1504"></a><span class='Declare_Function'>postgresAddForeignUpdateTargets</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN1505"></a>                                <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>target_rte</span><span class='Delimiter'>, 
</span><a name="LN1506"></a>                                <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>target_relation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1508"></a>    <a href="../../src/include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span><a name="LN1509"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>attrname</span><span class='Delimiter'>; 
</span><a name="LN1510"></a>    <a href="../../src/include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In postgres_fdw, what we need is the ctid, same as for a regular table. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Make a Var representing the desired value */ 
</span>    <a href="postgres_fdw.c.html#LN1508"><span class='Ref_To_Local'>var</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1504"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN119"><span class='Ref_to_Member'>resultRelation</span></a><span class='Delimiter'>, 
</span>                  <a href="../../src/include/access/sysattr.h.html#LN20"><span class='Ref_to_Const'>SelfItemPointerAttributeNumber</span></a><span class='Delimiter'>, 
</span>                  <a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN28"><span class='Ref_to_Const'>TIDOID</span></a><span class='Delimiter'>, 
</span>                  <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                  <a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                  <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Wrap it in a resjunk TLE with the right name ... */ 
</span>    <a href="postgres_fdw.c.html#LN1509"><span class='Ref_To_Local'>attrname</span></a> <span class='Operator'>= </span><span class='String'>"ctid"</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN1510"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/makefuncs.h.html#LN40"><span class='Ref_to_Proto'>makeTargetEntry</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1508"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, 
</span>                          <a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1504"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                          <a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1509"><span class='Ref_To_Local'>attrname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ... and add it to the query's targetlist */ 
</span>    <a href="postgres_fdw.c.html#LN1504"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1504"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1510"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresAddForeignUpdateTargets &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresPlanForeignModify 
 *      Plan an insert/update/delete operation on a foreign table 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1541"></a><span class='Declare_Function'>postgresPlanForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN1542"></a>                          <a href="../../src/include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN1543"></a>                          <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelation</span><span class='Delimiter'>, 
</span><a name="LN1544"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1546"></a>    <a href="../../src/include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1542"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN216"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN1547"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span> <span class='Operator'>= </span><a href="../../src/include/nodes/relation.h.html#LN324"><span class='Ref_to_Macro'>planner_rt_fetch</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1543"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1541"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1548"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1549"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN1550"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targetAttrs</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1551"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>returningList</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1552"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>retrieved_attrs</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1553"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>doNothing</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1549"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Core code already has some lock on each rel being planned, so we can 
     * use NoLock here. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../src/include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1547"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In an INSERT, we transmit all columns that are defined in the foreign 
     * table.  In an UPDATE, we transmit only columns that were explicitly 
     * targets of the UPDATE, so as to avoid unnecessary data transmission. 
     * (We can't do that for INSERT since we would miss sending default values 
     * for columns not listed in the source statement.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1546"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1572"></a>        <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1573"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1573"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN1573"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="postgres_fdw.c.html#LN1572"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN1573"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1577"></a>            <a href="../../src/include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1572"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN1573"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1577"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1573"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1546"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1585"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>col</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN1585"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="postgres_fdw.c.html#LN1585"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1547"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1031"><span class='Ref_to_Member'>updatedCols</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1585"><span class='Ref_To_Local'>col</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* bit numbers are offset by FirstLowInvalidHeapAttributeNumber */ 
</span><a name="LN1591"></a>            <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1585"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>+ </span><a href="../../src/include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1591"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&LT;= </span><a href="../../src/include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"system-column update is not supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1591"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract the relevant RETURNING list if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1542"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN1551"><span class='Ref_To_Local'>returningList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1542"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1544"><span class='Ref_to_Parameter'>subplan_index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ON CONFLICT DO UPDATE and DO NOTHING case with inference specification 
     * should have already been rejected in the optimizer, as presently there 
     * is no way to recognize an arbiter index on a foreign table.  Only DO 
     * NOTHING is supported without an inference specification. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1542"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN231"><span class='Ref_to_Member'>onConflictAction</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN800"><span class='Ref_to_EnumConst'>ONCONFLICT_NOTHING</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN1553"><span class='Ref_To_Local'>doNothing</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1542"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN231"><span class='Ref_to_Member'>onConflictAction</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN799"><span class='Ref_to_EnumConst'>ONCONFLICT_NONE</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected ON CONFLICT specification: %d"</span><span class='Delimiter'>, 
</span>             <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1542"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN231"><span class='Ref_to_Member'>onConflictAction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct the SQL command string. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1546"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.h.html#LN142"><span class='Ref_to_Proto'>deparseInsertSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1549"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1541"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1543"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1553"><span class='Ref_To_Local'>doNothing</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1551"><span class='Ref_To_Local'>returningList</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1552"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.h.html#LN146"><span class='Ref_to_Proto'>deparseUpdateSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1549"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1541"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1543"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1551"><span class='Ref_To_Local'>returningList</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1552"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.h.html#LN158"><span class='Ref_to_Proto'>deparseDeleteSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1549"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1541"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1543"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1551"><span class='Ref_To_Local'>returningList</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1552"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected operation: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1546"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operation &raquo; </span> 
 
    <a href="../../src/include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1548"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build the fdw_private list that will be available to the executor. 
     * Items in the list must match enum FdwModifyPrivateIndex, above. 
     */ 
</span>    <span class='Control'>return</span> <a href="../../src/include/nodes/pg_list.h.html#LN141"><span class='Ref_to_Macro'>list_make4</span></a><span class='Parentheses'>(</span><a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1549"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="postgres_fdw.c.html#LN1550"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, 
</span>                      <a href="../../src/backend/nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>((</span><a href="postgres_fdw.c.html#LN1552"><span class='Ref_To_Local'>retrieved_attrs</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                      <a href="postgres_fdw.c.html#LN1552"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresPlanForeignModify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresBeginForeignModify 
 *      Begin an insert/update/delete operation on a foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1659"></a><span class='Declare_Function'>postgresBeginForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN1660"></a>                           <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1661"></a>                           <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Delimiter'>, 
</span><a name="LN1662"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Delimiter'>, 
</span><a name="LN1663"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1665"></a>    <a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fmstate</span><span class='Delimiter'>; 
</span><a name="LN1666"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1659"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN918"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1667"></a>    <a href="../../src/include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1659"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN919"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN1668"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1660"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span><a name="LN1669"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN1670"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>userid</span><span class='Delimiter'>; 
</span><a name="LN1671"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>    <a href="../../src/include/foreign/foreign.h.html#LN55"><span class='Ref_to_Struct'>UserMapping</span></a> <span class='Operator'>*</span><span class='Declare_Local'>user</span><span class='Delimiter'>; 
</span><a name="LN1673"></a>    <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>n_params</span><span class='Delimiter'>; 
</span><a name="LN1674"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typefnoid</span><span class='Delimiter'>; 
</span><a name="LN1675"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isvarlena</span><span class='Delimiter'>; 
</span><a name="LN1676"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do nothing in EXPLAIN (no ANALYZE) case.  resultRelInfo-&GT;ri_FdwState 
     * stays NULL. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1663"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><a href="../../src/include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Begin constructing PgFdwModifyState. */ 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN165"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1668"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify which user to do the remote access as.  This should match what 
     * ExecCheckRTEPerms() does. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1669"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1660"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN372"><span class='Ref_to_Member'>ri_RangeTableIndex</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1666"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1670"><span class='Ref_To_Local'>userid</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1669"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>? </span><a href="postgres_fdw.c.html#LN1669"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>: </span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get info about foreign table. */ 
</span>    <a href="postgres_fdw.c.html#LN1671"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1668"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1672"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1670"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1671"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open connection; report that we'll create a prepared statement. */ 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1672"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* prepared statement not made yet */ 
</span> 
    <span class='Comment_Multi_Line'>/* Deconstruct fdw_private data. */ 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1661"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                     <a href="postgres_fdw.c.html#LN91"><span class='Ref_to_EnumConst'>FdwModifyPrivateUpdateSql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN174"><span class='Ref_to_Member'>target_attrs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1661"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                              <a href="postgres_fdw.c.html#LN93"><span class='Ref_to_EnumConst'>FdwModifyPrivateTargetAttnums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1661"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                             <a href="postgres_fdw.c.html#LN95"><span class='Ref_to_EnumConst'>FdwModifyPrivateHasReturning</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN176"><span class='Ref_to_Member'>retrieved_attrs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1661"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                             <a href="postgres_fdw.c.html#LN97"><span class='Ref_to_EnumConst'>FdwModifyPrivateRetrievedAttrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create context for per-tuple temp workspace. */ 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN184"><span class='Ref_to_Member'>temp_cxt</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1666"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Delimiter'>, 
</span>                                              <span class='String'>"postgres_fdw temporary data"</span><span class='Delimiter'>, 
</span>                                              <a href="../../src/include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare for input conversion of RETURNING results. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN166"><span class='Ref_to_Member'>attinmeta</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN230"><span class='Ref_to_Proto'>TupleDescGetAttInMetadata</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1668"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare for output conversion of parameters used in prepared stmt. */ 
</span>    <a href="postgres_fdw.c.html#LN1673"><span class='Ref_To_Local'>n_params</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN174"><span class='Ref_to_Member'>target_attrs</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN181"><span class='Ref_to_Member'>p_flinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="postgres_fdw.c.html#LN1673"><span class='Ref_To_Local'>n_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1667"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| </span><a href="postgres_fdw.c.html#LN1667"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Find the ctid resjunk column in the subplan's result */ 
</span><a name="LN1731"></a>        <a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1659"><span class='Ref_to_Parameter'>mtstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN922"><span class='Ref_to_Member'>mt_plans</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN1662"><span class='Ref_to_Parameter'>subplan_index</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN179"><span class='Ref_to_Member'>ctidAttno</span></a> <span class='Operator'>= </span><a href="../../src/include/executor/executor.h.html#LN156"><span class='Ref_to_Proto'>ExecFindJunkAttributeInTlist</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1731"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, 
</span>                                                          <span class='String'>"ctid"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/access/attnum.h.html#LN33"><span class='Ref_to_Macro'>AttributeNumberIsValid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN179"><span class='Ref_to_Member'>ctidAttno</span></a><span class='Parentheses'>))</span> 
            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find junk ctid column"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* First transmittable parameter will be ctid */ 
</span>        <a href="../../src/include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="../../src/interfaces/ecpg/ecpglib/pg_type.h.html#LN28"><span class='Ref_to_Const'>TIDOID</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1674"><span class='Ref_To_Local'>typefnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1675"><span class='Ref_To_Local'>isvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1674"><span class='Ref_To_Local'>typefnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN181"><span class='Ref_to_Member'>p_flinfo</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1667"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>|| </span><a href="postgres_fdw.c.html#LN1667"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Set up for remaining transmittable parameters */ 
</span>        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1676"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN174"><span class='Ref_to_Member'>target_attrs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1749"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1676"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1750"></a>            <a href="../../src/include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1668"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>attrs<span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN1749"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1750"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1750"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1674"><span class='Ref_To_Local'>typefnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1675"><span class='Ref_To_Local'>isvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1674"><span class='Ref_To_Local'>typefnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN181"><span class='Ref_to_Member'>p_flinfo</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a> <span class='Operator'>&LT;= </span><a href="postgres_fdw.c.html#LN1673"><span class='Ref_To_Local'>n_params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN1660"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN382"><span class='Ref_to_Member'>ri_FdwState</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN1665"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresBeginForeignModify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresExecForeignInsert 
 *      Insert one row into a foreign table 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN1770"></a><span class='Declare_Function'>postgresExecForeignInsert</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1771"></a>                          <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1772"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN1773"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1775"></a>    <a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1771"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN382"><span class='Ref_to_Member'>ri_FdwState</span></a><span class='Delimiter'>; 
</span><a name="LN1776"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>p_values</span><span class='Delimiter'>; 
</span><a name="LN1777"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1778"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n_rows</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up the prepared statement on the remote server, if we didn't yet */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN372"><span class='Ref_to_Proto'>prepare_foreign_modify</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert parameters needed by prepared statement to text form */ 
</span>    <a href="postgres_fdw.c.html#LN1776"><span class='Ref_To_Local'>p_values</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN373"><span class='Ref_to_Proto'>convert_prep_stmt_params</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1772"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the prepared statement. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN413"><span class='Ref_to_Proto'>PQsendQueryPrepared</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1776"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the result, and check for success. 
     * 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN121"><span class='Ref_to_Proto'>pgfdw_get_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= 
</span>        <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a> <span class='Operator'>? </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a> <span class='Operator'>: </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check number of rows affected, and fetch RETURNING tuple if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN1778"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1778"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN376"><span class='Ref_to_Proto'>store_returning_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1772"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN1778"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN487"><span class='Ref_to_Proto'>PQcmdTuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And clean up */ 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1777"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1775"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN184"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return NULL if nothing was inserted on the remote end */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1778"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="postgres_fdw.c.html#LN1772"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresExecForeignInsert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresExecForeignUpdate 
 *      Update one row in a foreign table 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN1834"></a><span class='Declare_Function'>postgresExecForeignUpdate</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1835"></a>                          <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1836"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN1837"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1839"></a>    <a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1835"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN382"><span class='Ref_to_Member'>ri_FdwState</span></a><span class='Delimiter'>; 
</span><a name="LN1840"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1841"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN1842"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>p_values</span><span class='Delimiter'>; 
</span><a name="LN1843"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1844"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n_rows</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up the prepared statement on the remote server, if we didn't yet */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN372"><span class='Ref_to_Proto'>prepare_foreign_modify</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the ctid that was passed up as a resjunk column */ 
</span>    <a href="postgres_fdw.c.html#LN1840"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../src/include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1837"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Delimiter'>, 
</span>                                 <a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN179"><span class='Ref_to_Member'>ctidAttno</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1841"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* shouldn't ever get a null result... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1841"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ctid is NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert parameters needed by prepared statement to text form */ 
</span>    <a href="postgres_fdw.c.html#LN1842"><span class='Ref_To_Local'>p_values</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN373"><span class='Ref_to_Proto'>convert_prep_stmt_params</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span><a href="../../src/include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1840"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN1836"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the prepared statement. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN413"><span class='Ref_to_Proto'>PQsendQueryPrepared</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1842"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the result, and check for success. 
     * 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN121"><span class='Ref_to_Proto'>pgfdw_get_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= 
</span>        <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a> <span class='Operator'>? </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a> <span class='Operator'>: </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check number of rows affected, and fetch RETURNING tuple if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN1844"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1844"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN376"><span class='Ref_to_Proto'>store_returning_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1836"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN1844"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN487"><span class='Ref_to_Proto'>PQcmdTuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And clean up */ 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1843"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1839"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN184"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return NULL if nothing was updated on the remote end */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1844"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="postgres_fdw.c.html#LN1836"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresExecForeignUpdate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresExecForeignDelete 
 *      Delete one row from a foreign table 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN1910"></a><span class='Declare_Function'>postgresExecForeignDelete</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1911"></a>                          <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN1912"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN1913"></a>                          <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>planSlot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1915"></a>    <a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1911"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN382"><span class='Ref_to_Member'>ri_FdwState</span></a><span class='Delimiter'>; 
</span><a name="LN1916"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1917"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN1918"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>p_values</span><span class='Delimiter'>; 
</span><a name="LN1919"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1920"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n_rows</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up the prepared statement on the remote server, if we didn't yet */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN372"><span class='Ref_to_Proto'>prepare_foreign_modify</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the ctid that was passed up as a resjunk column */ 
</span>    <a href="postgres_fdw.c.html#LN1916"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../src/include/executor/executor.h.html#LN158"><span class='Ref_to_Proto'>ExecGetJunkAttribute</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1913"><span class='Ref_to_Parameter'>planSlot</span></a><span class='Delimiter'>, 
</span>                                 <a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN179"><span class='Ref_to_Member'>ctidAttno</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN1917"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* shouldn't ever get a null result... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1917"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"ctid is NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert parameters needed by prepared statement to text form */ 
</span>    <a href="postgres_fdw.c.html#LN1918"><span class='Ref_To_Local'>p_values</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN373"><span class='Ref_to_Proto'>convert_prep_stmt_params</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span><a href="../../src/include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1916"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the prepared statement. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN413"><span class='Ref_to_Proto'>PQsendQueryPrepared</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN1918"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the result, and check for success. 
     * 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN121"><span class='Ref_to_Proto'>pgfdw_get_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= 
</span>        <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a> <span class='Operator'>? </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a> <span class='Operator'>: </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check number of rows affected, and fetch RETURNING tuple if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN175"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN1920"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1920"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN376"><span class='Ref_to_Proto'>store_returning_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1912"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN1920"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN487"><span class='Ref_to_Proto'>PQcmdTuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And clean up */ 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1919"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1915"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN184"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return NULL if nothing was deleted on the remote end */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1920"><span class='Ref_To_Local'>n_rows</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="postgres_fdw.c.html#LN1912"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresExecForeignDelete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresEndForeignModify 
 *      Finish an insert/update/delete operation on a foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1986"></a><span class='Declare_Function'>postgresEndForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1987"></a>                         <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1989"></a>    <a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN1987"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN382"><span class='Ref_to_Member'>ri_FdwState</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If fmstate is NULL, we are in EXPLAIN; nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we created a prepared statement, destroy it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1998"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sql</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN1999"></a>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1998"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1998"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"DEALLOCATE %s"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't use a PG_TRY block here, so be careful not to throw error 
         * without releasing the PGresult. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN1999"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1998"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1999"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1999"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN1998"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1999"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Release remote connection */ 
</span>    <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN1989"><span class='Ref_To_Local'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresEndForeignModify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresIsForeignRelUpdatable 
 *      Determine whether a foreign table supports INSERT, UPDATE and/or 
 *      DELETE. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2025"></a><span class='Declare_Function'>postgresIsForeignRelUpdatable</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2027"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>updatable</span><span class='Delimiter'>; 
</span><a name="LN2028"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN2029"></a>    <a href="../../src/include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN2030"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * By default, all postgres_fdw foreign tables are assumed updatable. This 
     * can be overridden by a per-server setting, which in turn can be 
     * overridden by a per-table setting. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2027"><span class='Ref_To_Local'>updatable</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN2028"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2025"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2029"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2028"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2030"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2029"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN52"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2044"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2030"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2044"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"updatable"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN2027"><span class='Ref_To_Local'>updatable</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2044"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2030"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2028"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN67"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2051"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2030"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2051"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"updatable"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN2027"><span class='Ref_To_Local'>updatable</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2051"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently "updatable" means support for INSERT, UPDATE and DELETE. 
     */ 
</span>    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN2027"><span class='Ref_To_Local'>updatable</span></a> <span class='Operator'>? 
</span>        <span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../src/include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../src/include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresIsForeignRelUpdatable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresRecheckForeignScan 
 *      Execute a local join execution plan for a foreign join 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2069"></a><span class='Declare_Function'>postgresRecheckForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2071"></a>    <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>scanrelid</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../src/include/nodes/plannodes.h.html#LN325"><span class='Ref_to_Struct'>Scan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2069"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>scanrelid<span class='Delimiter'>; 
</span><a name="LN2072"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>outerPlan</span> <span class='Operator'>= </span><a href="../../src/include/nodes/execnodes.h.html#LN854"><span class='Ref_to_Macro'>outerPlanState</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2069"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2073"></a>    <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* For base foreign relations, it suffices to set fdw_recheck_quals */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2071"><span class='Ref_To_Local'>scanrelid</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2072"><span class='Ref_To_Local'>outerPlan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Execute a local join execution plan */ 
</span>    <a href="postgres_fdw.c.html#LN2073"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../src/include/executor/executor.h.html#LN229"><span class='Ref_to_Proto'>ExecProcNode</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2072"><span class='Ref_To_Local'>outerPlan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/executor/tuptable.h.html#LN137"><span class='Ref_to_Macro'>TupIsNull</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2073"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store result in the given slot */ 
</span>    <a href="../../src/include/executor/tuptable.h.html#LN163"><span class='Ref_to_Proto'>ExecCopySlot</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2069"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2073"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresRecheckForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresPlanDirectModify 
 *      Consider a direct foreign table modification 
 * 
 * Decide whether it is safe to modify a foreign table directly, and if so, 
 * rewrite subplan accordingly. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2100"></a><span class='Declare_Function'>postgresPlanDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2101"></a>                         <a href="../../src/include/nodes/plannodes.h.html#LN213"><span class='Ref_to_Struct'>ModifyTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>plan</span><span class='Delimiter'>, 
</span><a name="LN2102"></a>                         <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>resultRelation</span><span class='Delimiter'>, 
</span><a name="LN2103"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2105"></a>    <a href="../../src/include/nodes/nodes.h.html#LN647"><span class='Ref_to_Enum'>CmdType</span></a>     <span class='Declare_Local'>operation</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2101"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN216"><span class='Ref_to_Member'>operation</span></a><span class='Delimiter'>; 
</span><a name="LN2106"></a>    <a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>subplan</span><span class='Delimiter'>; 
</span><a name="LN2107"></a>    <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>foreignrel</span><span class='Delimiter'>; 
</span><a name="LN2108"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN2109"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span><span class='Delimiter'>; 
</span><a name="LN2110"></a>    <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN2111"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN2112"></a>    <a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fscan</span><span class='Delimiter'>; 
</span><a name="LN2113"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targetAttrs</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2114"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>remote_exprs</span><span class='Delimiter'>; 
</span><a name="LN2115"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>params_list</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2116"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>returningList</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2117"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>retrieved_attrs</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Decide whether it is safe to modify a foreign table directly. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The table modification must be an UPDATE or DELETE. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2105"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN2105"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's unsafe to modify a foreign table directly if there are any local 
     * joins needed. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2106"><span class='Ref_To_Local'>subplan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2101"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN224"><span class='Ref_to_Member'>plans</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2103"><span class='Ref_to_Parameter'>subplan_index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2106"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2112"><span class='Ref_To_Local'>fscan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2106"><span class='Ref_To_Local'>subplan</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's unsafe to modify a foreign table directly if there are any quals 
     * that should be evaluated locally. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2106"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN144"><span class='Ref_to_Member'>qual</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can't handle an UPDATE or DELETE on a foreign join for now. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2112"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safe to fetch data about the target foreign rel */ 
</span>    <a href="postgres_fdw.c.html#LN2107"><span class='Ref_To_Local'>foreignrel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2100"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN178"><span class='Ref_to_Member'>simple_rel_array</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN2102"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>]; 
</span>    <a href="postgres_fdw.c.html#LN2108"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2100"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN187"><span class='Ref_to_Member'>simple_rte_array</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN2102"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>]; 
</span>    <a href="postgres_fdw.c.html#LN2109"><span class='Ref_To_Local'>fpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2107"><span class='Ref_To_Local'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's unsafe to update a foreign table directly, if any expressions to 
     * assign to the target columns are unsafe to evaluate remotely. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2105"><span class='Ref_To_Local'>operation</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2162"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>col</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We transmit only columns that were explicitly targets of the 
         * UPDATE, so as to avoid unnecessary data transmission. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN2162"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="postgres_fdw.c.html#LN2162"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN98"><span class='Ref_to_Proto'>bms_next_member</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2108"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1031"><span class='Ref_to_Member'>updatedCols</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2162"><span class='Ref_To_Local'>col</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* bit numbers are offset by FirstLowInvalidHeapAttributeNumber */ 
</span><a name="LN2172"></a>            <a href="../../src/include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2162"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>+ </span><a href="../../src/include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span><a name="LN2173"></a>            <a href="../../src/include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2172"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&LT;= </span><a href="../../src/include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"system-column update is not supported"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN2173"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/parsetree.h.html#LN69"><span class='Ref_to_Proto'>get_tle_by_resno</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2106"><span class='Ref_To_Local'>subplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN143"><span class='Ref_to_Member'>targetlist</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2172"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN2173"><span class='Ref_To_Local'>tle</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"attribute number %d not found in subplan targetlist"</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN2172"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2100"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2107"><span class='Ref_To_Local'>foreignrel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2173"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN2113"><span class='Ref_To_Local'>targetAttrs</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2113"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2172"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (col=bms_next_member(... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operation==CMD_UPDATE &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Ok, rewrite subplan so as to modify the foreign table directly. 
     */ 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2111"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Core code already has some lock on each rel being planned, so we can 
     * use NoLock here. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2110"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../src/include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2108"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Recall the qual clauses that must be evaluated remotely.  (These are 
     * bare clauses not RestrictInfos, but deparse.c's appendConditions() 
     * doesn't care.) 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2114"><span class='Ref_To_Local'>remote_exprs</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2109"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN46"><span class='Ref_to_Member'>final_remote_exprs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract the relevant RETURNING list if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2101"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN2116"><span class='Ref_To_Local'>returningList</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2101"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN226"><span class='Ref_to_Member'>returningLists</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2103"><span class='Ref_to_Parameter'>subplan_index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct the SQL command string. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2105"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.h.html#LN150"><span class='Ref_to_Proto'>deparseDirectUpdateSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2111"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2100"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2102"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2110"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                   <span class='Parentheses'>((</span><a href="../../src/include/nodes/plannodes.h.html#LN117"><span class='Ref_to_Struct'>Plan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2112"><span class='Ref_To_Local'>fscan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>targetlist<span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN2113"><span class='Ref_To_Local'>targetAttrs</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN2114"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2115"><span class='Ref_To_Local'>params_list</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN2116"><span class='Ref_To_Local'>returningList</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2117"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.h.html#LN162"><span class='Ref_to_Proto'>deparseDirectDeleteSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2111"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2100"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2102"><span class='Ref_to_Parameter'>resultRelation</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2110"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN2114"><span class='Ref_To_Local'>remote_exprs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2115"><span class='Ref_To_Local'>params_list</span></a><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN2116"><span class='Ref_To_Local'>returningList</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2117"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected operation: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2105"><span class='Ref_To_Local'>operation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update the operation info. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2112"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN597"><span class='Ref_to_Member'>operation</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2105"><span class='Ref_To_Local'>operation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update the fdw_exprs list that will be available to the executor. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2112"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2115"><span class='Ref_To_Local'>params_list</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update the fdw_private list that will be available to the executor. 
     * Items in the list must match enum FdwDirectModifyPrivateIndex, above. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2112"><span class='Ref_To_Local'>fscan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN141"><span class='Ref_to_Macro'>list_make4</span></a><span class='Parentheses'>(</span><a href="../../src/backend/nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2111"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../src/backend/nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>((</span><a href="postgres_fdw.c.html#LN2117"><span class='Ref_To_Local'>retrieved_attrs</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                    <a href="postgres_fdw.c.html#LN2117"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../src/backend/nodes/value.c.html#LN21"><span class='Ref_to_Func'>makeInteger</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2101"><span class='Ref_to_Parameter'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN217"><span class='Ref_to_Member'>canSetTag</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2110"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresPlanDirectModify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresBeginDirectModify 
 *      Prepare a direct foreign table modification 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2265"></a><span class='Declare_Function'>postgresBeginDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>eflags</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2267"></a>    <a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsplan</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2265"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>; 
</span><a name="LN2268"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2265"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN2269"></a>    <a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dmstate</span><span class='Delimiter'>; 
</span><a name="LN2270"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN2271"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>userid</span><span class='Delimiter'>; 
</span><a name="LN2272"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN2273"></a>    <a href="../../src/include/foreign/foreign.h.html#LN55"><span class='Ref_to_Struct'>UserMapping</span></a> <span class='Operator'>*</span><span class='Declare_Local'>user</span><span class='Delimiter'>; 
</span><a name="LN2274"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numParams</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do nothing in EXPLAIN (no ANALYZE) case.  node-&GT;fdw_state stays NULL. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2265"><span class='Ref_to_Parameter'>eflags</span></a> <span class='Operator'>& </span><a href="../../src/include/executor/executor.h.html#LN57"><span class='Ref_to_Const'>EXEC_FLAG_EXPLAIN_ONLY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll save private state in node-&GT;fdw_state. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2265"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify which user to do the remote access as.  This should match what 
     * ExecCheckRTEPerms() does. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2270"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN596"><span class='Ref_to_Member'>scan</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/plannodes.h.html#LN328"><span class='Ref_to_Member'>scanrelid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2268"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2271"><span class='Ref_To_Local'>userid</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2270"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>? </span><a href="postgres_fdw.c.html#LN2270"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN1028"><span class='Ref_to_Member'>checkAsUser</span></a> <span class='Operator'>: </span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get info about foreign table. */ 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN192"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2265"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1058"><span class='Ref_to_Member'>ss_currentRelation</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2272"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN192"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2273"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2271"><span class='Ref_To_Local'>userid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2272"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get connection to the foreign server.  Connection manager will 
     * establish new connection if necessary. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2273"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize state variable */ 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* -1 means not set yet */ 
</span> 
    <span class='Comment_Multi_Line'>/* Get private info created by planner functions. */ 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN196"><span class='Ref_to_Member'>query</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                     <a href="postgres_fdw.c.html#LN112"><span class='Ref_to_EnumConst'>FdwDirectModifyPrivateUpdateSql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN197"><span class='Ref_to_Member'>has_returning</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN114"><span class='Ref_to_EnumConst'>FdwDirectModifyPrivateHasReturning</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN198"><span class='Ref_to_Member'>retrieved_attrs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres_fdw.c.html#LN116"><span class='Ref_to_EnumConst'>FdwDirectModifyPrivateRetrievedAttrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN199"><span class='Ref_to_Member'>set_processed</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN51"><span class='Ref_to_Macro'>intVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN600"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN118"><span class='Ref_to_EnumConst'>FdwDirectModifyPrivateSetProcessed</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create context for per-tuple temp workspace. */ 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN214"><span class='Ref_to_Member'>temp_cxt</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2268"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Delimiter'>, 
</span>                                              <span class='String'>"postgres_fdw temporary data"</span><span class='Delimiter'>, 
</span>                                              <a href="../../src/include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare for input conversion of RETURNING results. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN197"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN193"><span class='Ref_to_Member'>attinmeta</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN230"><span class='Ref_to_Proto'>TupleDescGetAttInMetadata</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN192"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare for processing of parameters used in remote query, if any. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2274"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN203"><span class='Ref_to_Member'>numParams</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2274"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2274"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN380"><span class='Ref_to_Proto'>prepare_query_params</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2265"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN2267"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN599"><span class='Ref_to_Member'>fdw_exprs</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN2274"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN204"><span class='Ref_to_Member'>param_flinfo</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN205"><span class='Ref_to_Member'>param_exprs</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2269"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN206"><span class='Ref_to_Member'>param_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresBeginDirectModify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresIterateDirectModify 
 *      Execute a direct foreign table modification 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN2347"></a><span class='Declare_Function'>postgresIterateDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2349"></a>    <a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2347"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN2350"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2347"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN2351"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2350"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If this is the first call after Begin, execute the statement. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2349"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN378"><span class='Ref_to_Proto'>execute_dml_stmt</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2347"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the local query doesn't specify RETURNING, just clear tuple slot. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN2351"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2364"></a>        <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2347"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span><a name="LN2365"></a>        <a href="../../src/include/executor/instrument.h.html#LN43"><span class='Ref_to_Struct'>Instrumentation</span></a> <span class='Operator'>*</span><span class='Declare_Local'>instr</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2347"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN818"><span class='Ref_to_Member'>instrument</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN2349"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN197"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Increment the command es_processed count if necessary. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2349"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN199"><span class='Ref_to_Member'>set_processed</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN2350"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2349"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Increment the tuple count for EXPLAIN ANALYZE if necessary. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2365"><span class='Ref_To_Local'>instr</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN2365"><span class='Ref_To_Local'>instr</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/executor/instrument.h.html#LN53"><span class='Ref_to_Member'>tuplecount</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2349"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="../../src/include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2364"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the next RETURNING tuple. 
     */ 
</span>    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN379"><span class='Ref_to_Proto'>get_returning_data</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2347"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresIterateDirectModify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresEndDirectModify 
 *      Finish a direct foreign table modification 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2391"></a><span class='Declare_Function'>postgresEndDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2393"></a>    <a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2391"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if dmstate is NULL, we are in EXPLAIN; nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2393"><span class='Ref_To_Local'>dmstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release PGresult */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2393"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2393"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release remote connection */ 
</span>    <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2393"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2393"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* MemoryContext will be deleted automatically. */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * postgresExplainForeignScan 
 *      Produce extra output for EXPLAIN of a ForeignScan on a foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2415"></a><span class='Declare_Function'>postgresExplainForeignScan</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2417"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_private</span><span class='Delimiter'>; 
</span><a name="LN2418"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN2419"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>relations</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN2417"><span class='Ref_To_Local'>fdw_private</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2415"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>fdw_private<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add names of relation handled by the foreign scan when the scan is a 
     * join 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2417"><span class='Ref_To_Local'>fdw_private</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="postgres_fdw.c.html#LN75"><span class='Ref_to_EnumConst'>FdwScanPrivateRelations</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN2419"><span class='Ref_To_Local'>relations</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2417"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN75"><span class='Ref_to_EnumConst'>FdwScanPrivateRelations</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/commands/explain.h.html#LN92"><span class='Ref_to_Proto'>ExplainPropertyText</span></a><span class='Parentheses'>(</span><span class='String'>"Relations"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2419"><span class='Ref_To_Local'>relations</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2415"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add remote query, when VERBOSE option is specified. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2415"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/commands/explain.h.html#LN31"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN2418"><span class='Ref_To_Local'>sql</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2417"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN65"><span class='Ref_to_EnumConst'>FdwScanPrivateSelectSql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/commands/explain.h.html#LN92"><span class='Ref_to_Proto'>ExplainPropertyText</span></a><span class='Parentheses'>(</span><span class='String'>"Remote SQL"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2418"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2415"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end postgresExplainForeignScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresExplainForeignModify 
 *      Produce extra output for EXPLAIN of a ModifyTable on a foreign table 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2448"></a><span class='Declare_Function'>postgresExplainForeignModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN916"><span class='Ref_to_Struct'>ModifyTableState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mtstate</span><span class='Delimiter'>, 
</span><a name="LN2449"></a>                             <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rinfo</span><span class='Delimiter'>, 
</span><a name="LN2450"></a>                             <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_private</span><span class='Delimiter'>, 
</span><a name="LN2451"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>subplan_index</span><span class='Delimiter'>, 
</span><a name="LN2452"></a>                             <a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2452"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/commands/explain.h.html#LN31"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2456"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sql</span> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2450"><span class='Ref_to_Parameter'>fdw_private</span></a><span class='Delimiter'>, 
</span>                                          <a href="postgres_fdw.c.html#LN91"><span class='Ref_to_EnumConst'>FdwModifyPrivateUpdateSql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/commands/explain.h.html#LN92"><span class='Ref_to_Proto'>ExplainPropertyText</span></a><span class='Parentheses'>(</span><span class='String'>"Remote SQL"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2456"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2452"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * postgresExplainDirectModify 
 *      Produce extra output for EXPLAIN of a ForeignScan that modifies a 
 *      foreign table directly 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2469"></a><span class='Declare_Function'>postgresExplainDirectModify</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../src/include/commands/explain.h.html#LN27"><span class='Ref_to_Struct'>ExplainState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>es</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2471"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_private</span><span class='Delimiter'>; 
</span><a name="LN2472"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2469"><span class='Ref_to_Parameter'>es</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/commands/explain.h.html#LN31"><span class='Ref_to_Member'>verbose</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN2471"><span class='Ref_To_Local'>fdw_private</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2469"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>fdw_private<span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2472"><span class='Ref_To_Local'>sql</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN223"><span class='Ref_to_Proto'>list_nth</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2471"><span class='Ref_To_Local'>fdw_private</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN112"><span class='Ref_to_EnumConst'>FdwDirectModifyPrivateUpdateSql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/commands/explain.h.html#LN92"><span class='Ref_to_Proto'>ExplainPropertyText</span></a><span class='Parentheses'>(</span><span class='String'>"Remote SQL"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2472"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2469"><span class='Ref_to_Parameter'>es</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * estimate_path_cost_size 
 *      Get cost and size estimates for a foreign scan on given foreign relation 
 *      either a base relation or a join between foreign relations or an upper 
 *      relation containing foreign relations. 
 * 
 * param_join_conds are the parameterization clauses with outer relations. 
 * pathkeys specify the expected sort order if any for given path being costed. 
 * 
 * The function returns the cost and size estimates in p_row, p_width, 
 * p_startup_cost and p_total_cost variables. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2496"></a><span class='Declare_Function'>estimate_path_cost_size</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN2497"></a>                        <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>foreignrel</span><span class='Delimiter'>, 
</span><a name="LN2498"></a>                        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>param_join_conds</span><span class='Delimiter'>, 
</span><a name="LN2499"></a>                        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pathkeys</span><span class='Delimiter'>, 
</span><a name="LN2500"></a>                        <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>p_rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>p_width</span><span class='Delimiter'>, 
</span><a name="LN2501"></a>                        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_startup_cost</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>p_total_cost</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2503"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN2504"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rows</span><span class='Delimiter'>; 
</span><a name="LN2505"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>retrieved_rows</span><span class='Delimiter'>; 
</span><a name="LN2506"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>width</span><span class='Delimiter'>; 
</span><a name="LN2507"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>startup_cost</span><span class='Delimiter'>; 
</span><a name="LN2508"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>total_cost</span><span class='Delimiter'>; 
</span><a name="LN2509"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>cpu_per_tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the table or the server is configured to use remote estimates, 
     * connect to the foreign server and execute EXPLAIN to estimate the 
     * number of rows selected by the restriction+join clauses.  Otherwise, 
     * estimate rows using whatever statistics we have locally, in a way 
     * similar to ordinary tables. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2520"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>remote_param_join_conds</span><span class='Delimiter'>; 
</span><a name="LN2521"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>local_param_join_conds</span><span class='Delimiter'>; 
</span><a name="LN2522"></a>        <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN2523"></a>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN2524"></a>        <a href="../../src/include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>local_sel</span><span class='Delimiter'>; 
</span><a name="LN2525"></a>        <a href="../../src/include/nodes/relation.h.html#LN42"><span class='Ref_to_Struct'>QualCost</span></a>    <span class='Declare_Local'>local_cost</span><span class='Delimiter'>; 
</span><a name="LN2526"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fdw_scan_tlist</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN2527"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>remote_conds</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Required only to be passed to deparseSelectStmtForRel */ 
</span><a name="LN2530"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>retrieved_attrs</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * param_join_conds might contain both clauses that are safe to send 
         * across, and clauses that aren't. 
         */ 
</span>        <a href="postgres_fdw.h.html#LN134"><span class='Ref_to_Proto'>classifyConditions</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2498"><span class='Ref_to_Parameter'>param_join_conds</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2520"><span class='Ref_To_Local'>remote_param_join_conds</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2521"><span class='Ref_To_Local'>local_param_join_conds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Build the list of columns to be fetched from the foreign server. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN509"><span class='Ref_to_Macro'>IS_JOIN_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../src/include/nodes/relation.h.html#LN512"><span class='Ref_to_Macro'>IS_UPPER_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>))</span> 
            <a href="postgres_fdw.c.html#LN2526"><span class='Ref_To_Local'>fdw_scan_tlist</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN173"><span class='Ref_to_Proto'>build_tlist_to_deparse</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres_fdw.c.html#LN2526"><span class='Ref_To_Local'>fdw_scan_tlist</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The complete list of remote conditions includes everything from 
         * baserestrictinfo plus any extra join_conds relevant to this 
         * particular path. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN2527"><span class='Ref_To_Local'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2520"><span class='Ref_To_Local'>remote_param_join_conds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Construct EXPLAIN query including the desired SELECT, FROM, and 
         * WHERE clauses. Params and other-relation Vars are replaced by dummy 
         * values, so don't request params_list. 
         */ 
</span>        <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2522"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2522"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='String'>"EXPLAIN "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.h.html#LN174"><span class='Ref_to_Proto'>deparseSelectStmtForRel</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2522"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2526"><span class='Ref_To_Local'>fdw_scan_tlist</span></a><span class='Delimiter'>, 
</span>                                <a href="postgres_fdw.c.html#LN2527"><span class='Ref_To_Local'>remote_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2499"><span class='Ref_to_Parameter'>pathkeys</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2530"><span class='Ref_To_Local'>retrieved_attrs</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the remote estimate */ 
</span>        <a href="postgres_fdw.c.html#LN2523"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN360"><span class='Ref_to_Proto'>get_remote_estimate</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2522"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2523"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2506"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2523"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Factor in the selectivity of the locally-checked quals */ 
</span>        <a href="postgres_fdw.c.html#LN2524"><span class='Ref_To_Local'>local_sel</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/clausesel.c.html#LN97"><span class='Ref_to_Func'>clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2521"><span class='Ref_To_Local'>local_param_join_conds</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN552"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2524"><span class='Ref_To_Local'>local_sel</span></a> <span class='Operator'>*= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN53"><span class='Ref_to_Member'>local_conds_sel</span></a><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/cost.h.html#LN71"><span class='Ref_to_Proto'>clamp_row_est</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2524"><span class='Ref_To_Local'>local_sel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add in the eval cost of the locally-checked quals */ 
</span>        <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN52"><span class='Ref_to_Member'>local_conds_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN52"><span class='Ref_to_Member'>local_conds_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/optimizer/cost.h.html#LN157"><span class='Ref_to_Proto'>cost_qual_eval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2525"><span class='Ref_To_Local'>local_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2521"><span class='Ref_To_Local'>local_param_join_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2525"><span class='Ref_To_Local'>local_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2525"><span class='Ref_To_Local'>local_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fpinfo-&GT;use_remote_es... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2591"></a>        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>run_cost</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't support join conditions in this mode (hence, no 
         * parameterized paths can be made). 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2498"><span class='Ref_to_Parameter'>param_join_conds</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Use rows/width estimates made by set_baserel_size_estimates() for 
         * base foreign relations and set_joinrel_size_estimates() for join 
         * between foreign relations. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2506"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Back into an estimate of the number of retrieved rows. */ 
</span>        <a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/cost.h.html#LN71"><span class='Ref_to_Proto'>clamp_row_est</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>/ </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN53"><span class='Ref_to_Member'>local_conds_sel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We will come here again and again with different set of pathkeys 
         * that caller wants to cost. We don't need to calculate the cost of 
         * bare scan each time. Instead, use the costs if we have cached them 
         * already. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>- </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN509"><span class='Ref_to_Macro'>IS_JOIN_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2623"></a>            <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo_i</span><span class='Delimiter'>; 
</span><a name="LN2624"></a>            <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo_o</span><span class='Delimiter'>; 
</span><a name="LN2625"></a>            <a href="../../src/include/nodes/relation.h.html#LN42"><span class='Ref_to_Struct'>QualCost</span></a>    <span class='Declare_Local'>join_cost</span><span class='Delimiter'>; 
</span><a name="LN2626"></a>            <a href="../../src/include/nodes/relation.h.html#LN42"><span class='Ref_to_Struct'>QualCost</span></a>    <span class='Declare_Local'>remote_conds_cost</span><span class='Delimiter'>; 
</span><a name="LN2627"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>nrows</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* For join we expect inner and outer relations set */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN89"><span class='Ref_to_Member'>innerrel</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN88"><span class='Ref_to_Member'>outerrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN2623"><span class='Ref_To_Local'>fpinfo_i</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN89"><span class='Ref_to_Member'>innerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2624"><span class='Ref_To_Local'>fpinfo_o</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN88"><span class='Ref_to_Member'>outerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Estimate of number of rows in cross product */ 
</span>            <a href="postgres_fdw.c.html#LN2627"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2623"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2624"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Clamp retrieved rows estimate to at most size of cross product */ 
</span>            <a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2627"><span class='Ref_To_Local'>nrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The cost of foreign join is estimated as cost of generating 
             * rows for the joining relations + cost for applying quals on the 
             * rows. 
             */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Calculate the cost of clauses pushed down to the foreign server 
             */ 
</span>            <a href="../../src/include/optimizer/cost.h.html#LN157"><span class='Ref_to_Proto'>cost_qual_eval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2626"><span class='Ref_To_Local'>remote_conds_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Calculate the cost of applying join clauses */ 
</span>            <a href="../../src/include/optimizer/cost.h.html#LN157"><span class='Ref_to_Proto'>cost_qual_eval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2625"><span class='Ref_To_Local'>join_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Startup cost includes startup cost of joining relations and the 
             * startup cost for join and other clauses. We do not include the 
             * startup cost specific to join strategy (e.g. setting up hash 
             * tables) since we do not know what strategy the foreign server 
             * is going to use. 
             */ 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2623"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a> <span class='Operator'>+ </span><a href="postgres_fdw.c.html#LN2624"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2625"><span class='Ref_To_Local'>join_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2626"><span class='Ref_To_Local'>remote_conds_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN52"><span class='Ref_to_Member'>local_conds_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Run time cost includes: 
             * 
             * 1. Run time cost (total_cost - startup_cost) of relations being 
             * joined 
             * 
             * 2. Run time cost of applying join clauses on the cross product 
             * of the joining relations. 
             * 
             * 3. Run time cost of applying pushed down other clauses on the 
             * result of join 
             * 
             * 4. Run time cost of applying nonpushable other clauses locally 
             * on the result fetched from the foreign server. 
             */ 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2623"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>- </span><a href="postgres_fdw.c.html#LN2623"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2624"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>- </span><a href="postgres_fdw.c.html#LN2624"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2627"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2625"><span class='Ref_To_Local'>join_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2627"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/cost.h.html#LN71"><span class='Ref_to_Proto'>clamp_row_est</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2627"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN56"><span class='Ref_to_Member'>joinclause_sel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2627"><span class='Ref_To_Local'>nrows</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2626"><span class='Ref_To_Local'>remote_conds_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN52"><span class='Ref_to_Member'>local_conds_cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IS_JOIN_REL(foreignre... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN512"><span class='Ref_to_Macro'>IS_UPPER_REL</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2689"></a>            <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ofpinfo</span><span class='Delimiter'>; 
</span><a name="LN2690"></a>            <a href="../../src/include/nodes/relation.h.html#LN879"><span class='Ref_to_Struct'>PathTarget</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptarget</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN274"><span class='Ref_to_Member'>upper_targets</span></a><span class='Delimiter'>[</span><a href="../../src/include/nodes/relation.h.html#LN73"><span class='Ref_to_EnumConst'>UPPERREL_GROUP_AGG</span></a><span class='Delimiter'>]; 
</span><a name="LN2691"></a>            <a href="../../src/include/nodes/relation.h.html#LN55"><span class='Ref_to_Struct'>AggClauseCosts</span></a> <span class='Declare_Local'>aggcosts</span><span class='Delimiter'>; 
</span><a name="LN2692"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>input_rows</span><span class='Delimiter'>; 
</span><a name="LN2693"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>numGroupCols</span><span class='Delimiter'>; 
</span><a name="LN2694"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>numGroups</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * This cost model is mixture of costing done for sorted and 
             * hashed aggregates in cost_agg().  We are not sure which 
             * strategy will be considered at remote side, thus for 
             * simplicity, we put all startup related costs in startup_cost 
             * and all finalization and run cost are added in total_cost. 
             * 
             * Also, core does not care about costing HAVING expressions and 
             * adding that to the costs.  So similarly, here too we are not 
             * considering remote and local conditions for costing. 
             */ 
</span> 
            <a href="postgres_fdw.c.html#LN2689"><span class='Ref_To_Local'>ofpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN88"><span class='Ref_to_Member'>outerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get rows and width from input rel */ 
</span>            <a href="postgres_fdw.c.html#LN2692"><span class='Ref_To_Local'>input_rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2689"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2506"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2689"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN60"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Collect statistics about aggregates for estimating costs. */ 
</span>            <a href="../../src/include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2691"><span class='Ref_To_Local'>aggcosts</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN55"><span class='Ref_to_Struct'>AggClauseCosts</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../src/include/optimizer/clauses.h.html#LN49"><span class='Ref_to_Proto'>get_agg_clause_costs</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN95"><span class='Ref_to_Member'>grouped_tlist</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../src/include/nodes/nodes.h.html#LN758"><span class='Ref_to_EnumConst'>AGGSPLIT_SIMPLE</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2691"><span class='Ref_To_Local'>aggcosts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../src/include/optimizer/clauses.h.html#LN49"><span class='Ref_to_Proto'>get_agg_clause_costs</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../src/include/nodes/nodes.h.html#LN758"><span class='Ref_to_EnumConst'>AGGSPLIT_SIMPLE</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2691"><span class='Ref_To_Local'>aggcosts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Get number of grouping columns and possible number of groups */ 
</span>            <a href="postgres_fdw.c.html#LN2693"><span class='Ref_To_Local'>numGroupCols</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2694"><span class='Ref_To_Local'>numGroups</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/selfuncs.h.html#LN205"><span class='Ref_to_Proto'>estimate_num_groups</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                            <a href="../../src/include/optimizer/tlist.h.html#LN41"><span class='Ref_to_Proto'>get_sortgrouplist_exprs</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2496"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a><span class='Delimiter'>, 
</span>                                                    <a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN95"><span class='Ref_to_Member'>grouped_tlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="postgres_fdw.c.html#LN2692"><span class='Ref_To_Local'>input_rows</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Number of rows expected from foreign server will be same as 
             * that of number of groups. 
             */ 
</span>            <a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2694"><span class='Ref_To_Local'>numGroups</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/*----- 
             * Startup cost includes: 
             *    1. Startup cost for underneath input * relation 
             *    2. Cost of performing aggregation, per cost_agg() 
             *    3. Startup cost for PathTarget eval 
             *----- 
             */ 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2689"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2691"><span class='Ref_To_Local'>aggcosts</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN61"><span class='Ref_to_Member'>transCost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2691"><span class='Ref_To_Local'>aggcosts</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN61"><span class='Ref_to_Member'>transCost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2692"><span class='Ref_To_Local'>input_rows</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="../../src/backend/optimizer/path/costsize.c.html#LN107"><span class='Ref_to_Global_Var'>cpu_operator_cost</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2693"><span class='Ref_To_Local'>numGroupCols</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2692"><span class='Ref_To_Local'>input_rows</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2690"><span class='Ref_To_Local'>ptarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN884"><span class='Ref_to_Member'>cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/*----- 
             * Run time cost includes: 
             *    1. Run time cost of underneath input relation 
             *    2. Run time cost of performing aggregation, per cost_agg() 
             *    3. PathTarget eval cost for each output row 
             *----- 
             */ 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2689"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>- </span><a href="postgres_fdw.c.html#LN2689"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2691"><span class='Ref_To_Local'>aggcosts</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN62"><span class='Ref_to_Member'>finalCost</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2694"><span class='Ref_To_Local'>numGroups</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="../../src/backend/optimizer/path/costsize.c.html#LN105"><span class='Ref_to_Global_Var'>cpu_tuple_cost</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2694"><span class='Ref_To_Local'>numGroups</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2690"><span class='Ref_To_Local'>ptarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN884"><span class='Ref_to_Member'>cost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2694"><span class='Ref_To_Local'>numGroups</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IS_UPPER_REL(foreignr... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Clamp retrieved rows estimates to at most foreignrel-&GT;tuples. */ 
</span>            <a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Cost as though this were a seqscan, which is pessimistic.  We 
             * effectively imagine the local_conds are being evaluated 
             * remotely, too. 
             */ 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="../../src/backend/optimizer/path/costsize.c.html#LN103"><span class='Ref_to_Global_Var'>seq_page_cost</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN563"><span class='Ref_to_Member'>pages</span></a><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN585"><span class='Ref_to_Member'>baserestrictcost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN44"><span class='Ref_to_Member'>startup</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2509"><span class='Ref_To_Local'>cpu_per_tuple</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/costsize.c.html#LN105"><span class='Ref_to_Global_Var'>cpu_tuple_cost</span></a> <span class='Operator'>+ </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN585"><span class='Ref_to_Member'>baserestrictcost</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/relation.h.html#LN45"><span class='Ref_to_Member'>per_tuple</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2509"><span class='Ref_To_Local'>cpu_per_tuple</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2497"><span class='Ref_to_Parameter'>foreignrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN564"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Without remote estimates, we have no real way to estimate the cost 
         * of generating sorted output.  It could be free if the query plan 
         * the remote side would have chosen generates properly-sorted output 
         * anyway, but in most cases it will cost something.  Estimate a value 
         * high enough that we won't pick the sorted path when the ordering 
         * isn't locally useful, but low enough that we'll err on the side of 
         * pushing down the ORDER BY clause when it's useful to do so. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2499"><span class='Ref_to_Parameter'>pathkeys</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>*= </span><a href="postgres_fdw.c.html#LN53"><span class='Ref_to_Const'>DEFAULT_FDW_SORT_MULTIPLIER</span></a><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a> <span class='Operator'>*= </span><a href="postgres_fdw.c.html#LN53"><span class='Ref_to_Const'>DEFAULT_FDW_SORT_MULTIPLIER</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+ </span><a href="postgres_fdw.c.html#LN2591"><span class='Ref_To_Local'>run_cost</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Cache the costs for scans without any pathkeys or parameterization 
     * before adding the costs for transferring data from the foreign server. 
     * These costs are useful for costing the join between this relation and 
     * another foreign relation or to calculate the costs of paths with 
     * pathkeys for this relation, when the costs can not be obtained from the 
     * foreign server. This function will be called at least once for every 
     * foreign relation without pathkeys and parameterization. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2499"><span class='Ref_to_Parameter'>pathkeys</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN2498"><span class='Ref_to_Parameter'>param_join_conds</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add some additional cost factors to account for connection overhead 
     * (fdw_startup_cost), transferring data across the network 
     * (fdw_tuple_cost per retrieved row), and local manipulation of the data 
     * (cpu_tuple_cost per retrieved row). 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN69"><span class='Ref_to_Member'>fdw_startup_cost</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN69"><span class='Ref_to_Member'>fdw_startup_cost</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a> <span class='Operator'>+= </span><a href="postgres_fdw.c.html#LN2503"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN70"><span class='Ref_to_Member'>fdw_tuple_cost</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a> <span class='Operator'>+= </span><a href="../../src/backend/optimizer/path/costsize.c.html#LN105"><span class='Ref_to_Global_Var'>cpu_tuple_cost</span></a> <span class='Operator'>* </span><a href="postgres_fdw.c.html#LN2505"><span class='Ref_To_Local'>retrieved_rows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return results. */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN2500"><span class='Ref_to_Parameter'>p_rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2504"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN2500"><span class='Ref_to_Parameter'>p_width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2506"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN2501"><span class='Ref_to_Parameter'>p_startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2507"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN2501"><span class='Ref_to_Parameter'>p_total_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2508"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end estimate_path_cost_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate costs of executing a SQL statement remotely. 
 * The given "sql" must be an EXPLAIN command. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2837"></a><span class='Declare_Function'>get_remote_estimate</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Delimiter'>, </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, 
</span><a name="LN2838"></a>                    <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>width</span><span class='Delimiter'>, 
</span><a name="LN2839"></a>                    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>startup_cost</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>total_cost</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2841"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* PGresult must be released before leaving this function. */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2846"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>line</span><span class='Delimiter'>; 
</span><a name="LN2847"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN2848"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Execute EXPLAIN remotely. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2837"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2837"><span class='Ref_to_Parameter'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2837"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2837"><span class='Ref_to_Parameter'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Extract cost numbers for topmost plan node.  Note we search for a 
         * left paren from the end of the line to avoid being confused by 
         * other uses of parentheses. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN2846"><span class='Ref_To_Local'>line</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2847"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2846"><span class='Ref_To_Local'>line</span></a><span class='Delimiter'>, </span><span class='String'>'('</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2847"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not interpret EXPLAIN output: \"%s\""</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2846"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2848"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span>sscanf<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2847"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>"(cost=%lf..%lf rows=%lf width=%d)"</span><span class='Delimiter'>, 
</span>                   <a href="postgres_fdw.c.html#LN2839"><span class='Ref_to_Parameter'>startup_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2839"><span class='Ref_to_Parameter'>total_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2838"><span class='Ref_to_Parameter'>rows</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2838"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2848"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>!= </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not interpret EXPLAIN output: \"%s\""</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2846"><span class='Ref_To_Local'>line</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2841"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_remote_estimate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Detect whether we want to process an EquivalenceClass member. 
 * 
 * This is a callback for use by generate_implied_equalities_for_column. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2889"></a><span class='Declare_Function'>ec_member_matches_foreign</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN2890"></a>                          <a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>em</span><span class='Delimiter'>, 
</span><a name="LN2891"></a>                          <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2893"></a>    <a href="postgres_fdw.c.html#LN259"><span class='Ref_to_Typedef'>ec_member_foreign_arg</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN259"><span class='Ref_to_Typedef'>ec_member_foreign_arg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2891"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN2894"></a>    <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2890"><span class='Ref_to_Parameter'>em</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we've identified what we're processing in the current scan, we only 
     * want to match that expression. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2893"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN261"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../src/include/nodes/nodes.h.html#LN626"><span class='Ref_to_Proto'>equal</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2894"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2893"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN261"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, ignore anything we've already processed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN228"><span class='Ref_to_Proto'>list_member</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2893"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN262"><span class='Ref_to_Member'>already_used</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2894"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This is the new target to process. */ 
</span>    <a href="postgres_fdw.c.html#LN2893"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN261"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2894"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ec_member_matches_foreign &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create cursor for node's query with current parameter values. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2918"></a><span class='Declare_Function'>create_cursor</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2920"></a>    <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2918"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN2921"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2918"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span><a name="LN2922"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numParams</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN139"><span class='Ref_to_Member'>numParams</span></a><span class='Delimiter'>; 
</span><a name="LN2923"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>values</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN142"><span class='Ref_to_Member'>param_values</span></a><span class='Delimiter'>; 
</span><a name="LN2924"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>; 
</span><a name="LN2925"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2926"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct array of query parameter values in text format.  We do the 
     * conversions in the short-lived per-tuple context, so as not to cause a 
     * memory leak over repeated scans. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2922"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2935"></a>        <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN2935"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2921"><span class='Ref_To_Local'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN386"><span class='Ref_to_Proto'>process_query_params</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2921"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN140"><span class='Ref_to_Member'>param_flinfo</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN141"><span class='Ref_to_Member'>param_exprs</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN2923"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2935"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Construct the DECLARE CURSOR command */ 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2925"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN2925"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"DECLARE c%u CURSOR FOR\n%s"</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN137"><span class='Ref_to_Member'>cursor_number</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN132"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Notice that we pass NULL for paramTypes, thus forcing the remote server 
     * to infer types for all parameters.  Since we explicitly cast every 
     * parameter (see deparse.c), the "inference" is trivial and will produce 
     * the desired result.  This allows us to avoid assuming that the remote 
     * server has the same OIDs we do for the parameters' types. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN402"><span class='Ref_to_Proto'>PQsendQueryParams</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2924"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2925"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2922"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>, 
</span>                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2923"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2924"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2925"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the result, and check for success. 
     * 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2926"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN121"><span class='Ref_to_Proto'>pgfdw_get_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2924"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2925"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2926"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2926"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2924"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN132"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2926"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark the cursor as created, and show no tuples have been retrieved */ 
</span>    <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN138"><span class='Ref_to_Member'>cursor_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN145"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN146"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN150"><span class='Ref_to_Member'>fetch_ct_2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2920"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN151"><span class='Ref_to_Member'>eof_reached</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2925"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end create_cursor &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fetch some more rows from the node's cursor. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2990"></a><span class='Declare_Function'>fetch_more_data</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2992"></a>    <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN2990"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN2993"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2994"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll store the tuples in the batch_cxt.  First, flush the previous 
     * batch. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN145"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN154"><span class='Ref_to_Member'>batch_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN2994"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN154"><span class='Ref_to_Member'>batch_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* PGresult must be released before leaving this function. */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3007"></a>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN136"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>; 
</span><a name="LN3008"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>sql</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN3009"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>numrows</span><span class='Delimiter'>; 
</span><a name="LN3010"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3008"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3008"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"FETCH %d FROM c%u"</span><span class='Delimiter'>, 
</span>                 <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN157"><span class='Ref_to_Member'>fetch_size</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN137"><span class='Ref_to_Member'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3007"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3008"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* On error, report the original query, not the FETCH. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3007"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN132"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Convert the data into HeapTuples */ 
</span>        <a href="postgres_fdw.c.html#LN3009"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN145"><span class='Ref_to_Member'>tuples</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3009"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN146"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3009"><span class='Ref_To_Local'>numrows</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN147"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3010"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN3010"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3009"><span class='Ref_To_Local'>numrows</span></a><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN3010"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2990"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN145"><span class='Ref_to_Member'>tuples</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3010"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="postgres_fdw.c.html#LN396"><span class='Ref_to_Proto'>make_tuple_from_result_row</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3010"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN126"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN129"><span class='Ref_to_Member'>attinmeta</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN133"><span class='Ref_to_Member'>retrieved_attrs</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2990"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, 
</span>                                           <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN155"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Update fetch_ct_2 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN150"><span class='Ref_to_Member'>fetch_ct_2</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN150"><span class='Ref_to_Member'>fetch_ct_2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Must be EOF if we didn't get as many tuples as we asked for. */ 
</span>        <a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN151"><span class='Ref_to_Member'>eof_reached</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3009"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN2992"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN157"><span class='Ref_to_Member'>fetch_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2993"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN2994"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fetch_more_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Force assorted GUC parameters to settings that ensure that we'll output 
 * data values in a form that is unambiguous to the remote server. 
 * 
 * This is rather expensive and annoying to do once per row, but there's 
 * little choice if we want to be sure values are transmitted accurately; 
 * we can't leave the settings in place between rows for fear of affecting 
 * user-visible computations. 
 * 
 * We use the equivalent of a function SET option to allow the settings to 
 * persist only until the caller calls reset_transmission_modes().  If an 
 * error is thrown in between, guc.c will take care of undoing the settings. 
 * 
 * The return value is the nestlevel that must be passed to 
 * reset_transmission_modes() to undo things. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3077"></a><span class='Declare_Function'>set_transmission_modes</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3079"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nestlevel</span> <span class='Operator'>= </span><a href="../../src/include/utils/guc.h.html#LN354"><span class='Ref_to_Proto'>NewGUCNestLevel</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The values set here should match what pg_dump does.  See also 
     * configure_remote_session in connection.c. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/backend/utils/init/globals.c.html#LN106"><span class='Ref_to_Global_Var'>DateStyle</span></a> <span class='Operator'>!= </span><a href="../../src/interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"datestyle"</span><span class='Delimiter'>, </span><span class='String'>"ISO"</span><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/guc.h.html#LN75"><span class='Ref_to_EnumConst'>PGC_USERSET</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/guc.h.html#LN119"><span class='Ref_to_EnumConst'>PGC_S_SESSION</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/guc.h.html#LN195"><span class='Ref_to_EnumConst'>GUC_ACTION_SAVE</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/backend/utils/init/globals.c.html#LN108"><span class='Ref_to_Global_Var'>IntervalStyle</span></a> <span class='Operator'>!= </span><a href="../../src/interfaces/ecpg/pgtypeslib/dt.h.html#LN16"><span class='Ref_to_Const'>INTSTYLE_POSTGRES</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"intervalstyle"</span><span class='Delimiter'>, </span><span class='String'>"postgres"</span><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/guc.h.html#LN75"><span class='Ref_to_EnumConst'>PGC_USERSET</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/guc.h.html#LN119"><span class='Ref_to_EnumConst'>PGC_S_SESSION</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/guc.h.html#LN195"><span class='Ref_to_EnumConst'>GUC_ACTION_SAVE</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/float.c.html#LN67"><span class='Ref_to_Global_Var'>extra_float_digits</span></a> <span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../src/include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"extra_float_digits"</span><span class='Delimiter'>, </span><span class='String'>"3"</span><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/guc.h.html#LN75"><span class='Ref_to_EnumConst'>PGC_USERSET</span></a><span class='Delimiter'>, </span><a href="../../src/include/utils/guc.h.html#LN119"><span class='Ref_to_EnumConst'>PGC_S_SESSION</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/guc.h.html#LN195"><span class='Ref_to_EnumConst'>GUC_ACTION_SAVE</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN3079"><span class='Ref_To_Local'>nestlevel</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_transmission_modes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Undo the effects of set_transmission_modes(). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3105"></a><span class='Declare_Function'>reset_transmission_modes</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>nestlevel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../src/include/utils/guc.h.html#LN355"><span class='Ref_to_Proto'>AtEOXact_GUC</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3105"><span class='Ref_to_Parameter'>nestlevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Utility routine to close a cursor. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3114"></a><span class='Declare_Function'>close_cursor</span><span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>conn</span><span class='Delimiter'>, </span><span class='Keyword'>unsigned int </span><span class='Declare_Parameter'>cursor_number</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3116"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sql</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN3117"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3116"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3116"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"CLOSE c%u"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3114"><span class='Ref_to_Parameter'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3117"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3114"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3116"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3117"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3117"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3114"><span class='Ref_to_Parameter'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3116"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3117"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * prepare_foreign_modify 
 *      Establish a prepared statement for execution of INSERT/UPDATE/DELETE 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3136"></a><span class='Declare_Function'>prepare_foreign_modify</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fmstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3138"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>prep_name</span><span class='Delimiter'>[</span><a href="../../src/interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN3139"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p_name</span><span class='Delimiter'>; 
</span><a name="LN3140"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct name we'll use for the prepared statement. */ 
</span>    <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3138"><span class='Ref_To_Local'>prep_name</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3138"><span class='Ref_To_Local'>prep_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"pgsql_fdw_prep_%u"</span><span class='Delimiter'>, 
</span>             <a href="postgres_fdw.h.html#LN120"><span class='Ref_to_Proto'>GetPrepStmtNumber</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3139"><span class='Ref_To_Local'>p_name</span></a> <span class='Operator'>= </span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3138"><span class='Ref_To_Local'>prep_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We intentionally do not specify parameter types here, but leave the 
     * remote server to derive them by default.  This avoids possible problems 
     * with the remote server using different type OIDs than we do.  All of 
     * the prepared statements we use in this module are simple enough that 
     * the remote server will make the right choices. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN410"><span class='Ref_to_Proto'>PQsendPrepare</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, 
</span>                       <a href="postgres_fdw.c.html#LN3139"><span class='Ref_To_Local'>p_name</span></a><span class='Delimiter'>, 
</span>                       <a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, 
</span>                       <span class='Number'>0</span><span class='Delimiter'>, 
</span>                       <span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the result, and check for success. 
     * 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3140"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN121"><span class='Ref_to_Proto'>pgfdw_get_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3140"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3140"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN169"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN173"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3140"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This action shows that the prepare has been done. */ 
</span>    <a href="postgres_fdw.c.html#LN3136"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN170"><span class='Ref_to_Member'>p_name</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3139"><span class='Ref_To_Local'>p_name</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prepare_foreign_modify &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * convert_prep_stmt_params 
 *      Create array of text strings representing parameter values 
 * 
 * tupleid is ctid to send, or NULL if none 
 * slot is slot to get remaining parameters from, or NULL if none 
 * 
 * Data is constructed in temp_cxt; caller should reset that after use. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>** 
</span><a name="LN3186"></a><span class='Declare_Function'>convert_prep_stmt_params</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fmstate</span><span class='Delimiter'>, 
</span><a name="LN3187"></a>                         <a href="../../src/include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Parameter'>tupleid</span><span class='Delimiter'>, 
</span><a name="LN3188"></a>                         <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3190"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>p_values</span><span class='Delimiter'>; 
</span><a name="LN3191"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pindex</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3192"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN3192"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN184"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN3190"><span class='Ref_To_Local'>p_values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 1st parameter should be ctid, if it's in use */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3187"><span class='Ref_to_Parameter'>tupleid</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* don't need set_transmission_modes for TID output */ 
</span>        <a href="postgres_fdw.c.html#LN3190"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN181"><span class='Ref_to_Member'>p_flinfo</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>], 
</span>                                              <a href="../../src/include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3187"><span class='Ref_to_Parameter'>tupleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* get following parameters from slot */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3188"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN174"><span class='Ref_to_Member'>target_attrs</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3210"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nestlevel</span><span class='Delimiter'>; 
</span><a name="LN3211"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN3210"><span class='Ref_To_Local'>nestlevel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN113"><span class='Ref_to_Proto'>set_transmission_modes</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3211"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN174"><span class='Ref_to_Member'>target_attrs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3217"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3211"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3218"></a>            <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN3219"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../src/include/executor/tuptable.h.html#LN167"><span class='Ref_to_Proto'>slot_getattr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3188"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3217"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3219"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3219"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="postgres_fdw.c.html#LN3190"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="postgres_fdw.c.html#LN3190"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN181"><span class='Ref_to_Member'>p_flinfo</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>], 
</span>                                                      <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="postgres_fdw.h.html#LN114"><span class='Ref_to_Proto'>reset_transmission_modes</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3210"><span class='Ref_To_Local'>nestlevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if slot!=NULL&&fmstate-&GT;... &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3191"><span class='Ref_To_Local'>pindex</span></a> <span class='Operator'>== </span><a href="postgres_fdw.c.html#LN3186"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN180"><span class='Ref_to_Member'>p_nums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3192"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN3190"><span class='Ref_To_Local'>p_values</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_prep_stmt_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * store_returning_result 
 *      Store the result of a RETURNING clause 
 * 
 * On error, be sure to release the PGresult on the way out.  Callers do not 
 * have PG_TRY blocks to ensure this happens. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3248"></a><span class='Declare_Function'>store_returning_result</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN163"><span class='Ref_to_Struct'>PgFdwModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fmstate</span><span class='Delimiter'>, 
</span><a name="LN3249"></a>                       <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3253"></a>        <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN3253"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN396"><span class='Ref_to_Proto'>make_tuple_from_result_row</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3249"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                            <a href="postgres_fdw.c.html#LN3248"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN165"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                                            <a href="postgres_fdw.c.html#LN3248"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN166"><span class='Ref_to_Member'>attinmeta</span></a><span class='Delimiter'>, 
</span>                                            <a href="postgres_fdw.c.html#LN3248"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN176"><span class='Ref_to_Member'>retrieved_attrs</span></a><span class='Delimiter'>, 
</span>                                            <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                            <a href="postgres_fdw.c.html#LN3248"><span class='Ref_to_Parameter'>fmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN184"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* tuple will be deleted when it is cleared from the slot */ 
</span>        <a href="../../src/include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3253"><span class='Ref_To_Local'>newtup</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3249"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3249"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3249"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end store_returning_result &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute a direct UPDATE/DELETE statement. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3277"></a><span class='Declare_Function'>execute_dml_stmt</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3279"></a>    <a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN3277"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN3280"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3277"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN842"><span class='Ref_to_Member'>ps_ExprContext</span></a><span class='Delimiter'>; 
</span><a name="LN3281"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numParams</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN203"><span class='Ref_to_Member'>numParams</span></a><span class='Delimiter'>; 
</span><a name="LN3282"></a>    <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Local'>values</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN206"><span class='Ref_to_Member'>param_values</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct array of query parameter values in text format. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3281"><span class='Ref_To_Local'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN386"><span class='Ref_to_Proto'>process_query_params</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3280"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN204"><span class='Ref_to_Member'>param_flinfo</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN205"><span class='Ref_to_Member'>param_exprs</span></a><span class='Delimiter'>, 
</span>                             <a href="postgres_fdw.c.html#LN3282"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Notice that we pass NULL for paramTypes, thus forcing the remote server 
     * to infer types for all parameters.  Since we explicitly cast every 
     * parameter (see deparse.c), the "inference" is trivial and will produce 
     * the desired result.  This allows us to avoid assuming that the remote 
     * server has the same OIDs we do for the parameters' types. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN402"><span class='Ref_to_Proto'>PQsendQueryParams</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN196"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3281"><span class='Ref_To_Local'>numParams</span></a><span class='Delimiter'>, 
</span>                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3282"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN196"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the result, and check for success. 
     * 
     * We don't use a PG_TRY block here, so be careful not to throw error 
     * without releasing the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN121"><span class='Ref_to_Proto'>pgfdw_get_result</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN196"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= 
</span>        <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN197"><span class='Ref_to_Member'>has_returning</span></a> <span class='Operator'>? </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a> <span class='Operator'>: </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>))</span> 
        <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN202"><span class='Ref_to_Member'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                           <a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN196"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the number of rows affected. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN197"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN487"><span class='Ref_to_Proto'>PQcmdTuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3279"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end execute_dml_stmt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the result of a RETURNING clause. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>* 
</span><a name="LN3327"></a><span class='Declare_Function'>get_returning_data</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3329"></a>    <a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dmstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN190"><span class='Ref_to_Struct'>PgFdwDirectModifyState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN3327"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span><a name="LN3330"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3327"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN3331"></a>    <a href="../../src/include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3330"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a><span class='Delimiter'>; 
</span><a name="LN3332"></a>    <a href="../../src/include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3327"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1060"><span class='Ref_to_Member'>ss_ScanTupleSlot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3331"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we didn't get any tuples, must be end of data. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN211"><span class='Ref_to_Member'>next_tuple</span></a> <span class='Operator'>&GT;= </span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN210"><span class='Ref_to_Member'>num_tuples</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../src/include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3332"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Increment the command es_processed count if necessary. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN199"><span class='Ref_to_Member'>set_processed</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN3330"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Store a RETURNING tuple.  If has_returning is false, just emit a dummy 
     * tuple.  (has_returning is false when the local query is of the form 
     * "UPDATE/DELETE .. RETURNING 1" for example.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN197"><span class='Ref_to_Member'>has_returning</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/executor/tuptable.h.html#LN156"><span class='Ref_to_Proto'>ExecStoreAllNullTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3332"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * On error, be sure to release the PGresult on the way out.  Callers 
         * do not have PG_TRY blocks to ensure this happens. 
         */ 
</span>        <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3359"></a>            <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtup</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN3359"><span class='Ref_To_Local'>newtup</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN396"><span class='Ref_to_Proto'>make_tuple_from_result_row</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>, 
</span>                                                <a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN211"><span class='Ref_to_Member'>next_tuple</span></a><span class='Delimiter'>, 
</span>                                                <a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN192"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                                                <a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN193"><span class='Ref_to_Member'>attinmeta</span></a><span class='Delimiter'>, 
</span>                                                <a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN198"><span class='Ref_to_Member'>retrieved_attrs</span></a><span class='Delimiter'>, 
</span>                                                <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                <a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN214"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3359"><span class='Ref_To_Local'>newtup</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3332"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../src/include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN209"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="postgres_fdw.c.html#LN3329"><span class='Ref_To_Local'>dmstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN211"><span class='Ref_to_Member'>next_tuple</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make slot available for evaluation of the local query RETURNING list. */ 
</span>    <a href="postgres_fdw.c.html#LN3331"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN388"><span class='Ref_to_Member'>ri_projectReturning</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN297"><span class='Ref_to_Member'>pi_exprContext</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3332"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN3332"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_returning_data &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Prepare for processing of parameters used in remote query. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3390"></a><span class='Declare_Function'>prepare_query_params</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN808"><span class='Ref_to_Struct'>PlanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, 
</span><a name="LN3391"></a>                     <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fdw_exprs</span><span class='Delimiter'>, 
</span><a name="LN3392"></a>                     <span class='Keyword'>int </span><span class='Declare_Parameter'>numParams</span><span class='Delimiter'>, 
</span><a name="LN3393"></a>                     <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>param_flinfo</span><span class='Delimiter'>, 
</span><a name="LN3394"></a>                     <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>param_exprs</span><span class='Delimiter'>, 
</span><a name="LN3395"></a>                     <span class='Keyword'>const char </span><span class='Operator'>***</span><span class='Declare_Parameter'>param_values</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3398"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3392"><span class='Ref_to_Parameter'>numParams</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare for output conversion of parameters used in remote query. */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3393"><span class='Ref_to_Parameter'>param_flinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="postgres_fdw.c.html#LN3392"><span class='Ref_to_Parameter'>numParams</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN3397"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3398"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3391"><span class='Ref_to_Parameter'>fdw_exprs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3408"></a>        <a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>param_expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3398"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3409"></a>        <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typefnoid</span><span class='Delimiter'>; 
</span><a name="LN3410"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isvarlena</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3408"><span class='Ref_To_Local'>param_expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3409"><span class='Ref_To_Local'>typefnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3410"><span class='Ref_To_Local'>isvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3409"><span class='Ref_To_Local'>typefnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3393"><span class='Ref_to_Parameter'>param_flinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3397"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN3397"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare remote-parameter expressions for evaluation.  (Note: in 
     * practice, we expect that all these expressions will be just Params, so 
     * we could possibly do something more efficient than using the full 
     * expression-eval machinery for this.  But probably there would be little 
     * benefit, and it'd require postgres_fdw to know more than is desirable 
     * about Param evaluation.) 
     */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3394"><span class='Ref_to_Parameter'>param_exprs</span></a> <span class='Operator'>= </span><a href="../../src/include/executor/executor.h.html#LN240"><span class='Ref_to_Proto'>ExecInitExprList</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3391"><span class='Ref_to_Parameter'>fdw_exprs</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3390"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate buffer for text form of query parameters. */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3395"><span class='Ref_to_Parameter'>param_values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3392"><span class='Ref_to_Parameter'>numParams</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prepare_query_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Construct array of query parameter values in text format. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3435"></a><span class='Declare_Function'>process_query_params</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>econtext</span><span class='Delimiter'>, 
</span><a name="LN3436"></a>                     <a href="../../src/include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>param_flinfo</span><span class='Delimiter'>, 
</span><a name="LN3437"></a>                     <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>param_exprs</span><span class='Delimiter'>, 
</span><a name="LN3438"></a>                     <span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>param_values</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3440"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nestlevel</span><span class='Delimiter'>; 
</span><a name="LN3441"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3442"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN3440"><span class='Ref_To_Local'>nestlevel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN113"><span class='Ref_to_Proto'>set_transmission_modes</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN3441"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3442"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3437"><span class='Ref_to_Parameter'>param_exprs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3449"></a>        <a href="../../src/include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>expr_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3442"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3450"></a>        <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>expr_value</span><span class='Delimiter'>; 
</span><a name="LN3451"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Evaluate the parameter expression */ 
</span>        <a href="postgres_fdw.c.html#LN3450"><span class='Ref_To_Local'>expr_value</span></a> <span class='Operator'>= </span><a href="../../src/include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3449"><span class='Ref_To_Local'>expr_state</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3435"><span class='Ref_to_Parameter'>econtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3451"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get string representation of each parameter value by invoking 
         * type-specific output function, unless the value is null. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3451"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN3438"><span class='Ref_to_Parameter'>param_values</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres_fdw.c.html#LN3438"><span class='Ref_to_Parameter'>param_values</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3436"><span class='Ref_to_Parameter'>param_flinfo</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3441"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="postgres_fdw.c.html#LN3450"><span class='Ref_To_Local'>expr_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN3441"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="postgres_fdw.h.html#LN114"><span class='Ref_to_Proto'>reset_transmission_modes</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3440"><span class='Ref_To_Local'>nestlevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end process_query_params &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresAnalyzeForeignTable 
 *      Test whether analyzing this foreign table is supported 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3476"></a><span class='Declare_Function'>postgresAnalyzeForeignTable</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN3477"></a>                            <a href="../../src/include/foreign/fdwapi.h.html#LN133"><span class='Ref_to_Typedef'>AcquireSampleRowsFunc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>func</span><span class='Delimiter'>, 
</span><a name="LN3478"></a>                            <a href="../../src/include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>totalpages</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3480"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN3481"></a>    <a href="../../src/include/foreign/foreign.h.html#LN55"><span class='Ref_to_Struct'>UserMapping</span></a> <span class='Operator'>*</span><span class='Declare_Local'>user</span><span class='Delimiter'>; 
</span><a name="LN3482"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN3483"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN3484"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return the row-analysis function pointer */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3477"><span class='Ref_to_Parameter'>func</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN390"><span class='Ref_to_Proto'>postgresAcquireSampleRowsFunc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we have to get the number of pages.  It's annoying that the ANALYZE 
     * API requires us to return that now, because it forces some duplication 
     * of effort between this routine and postgresAcquireSampleRowsFunc.  But 
     * it's probably not worth redefining that API at this point. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the connection to use.  We do the remote access as the table's 
     * owner, even if the ANALYZE was started by some other user. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3480"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3476"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3481"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3476"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3480"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3482"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3481"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct command to get page count for relation. 
     */ 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3483"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.h.html#LN168"><span class='Ref_to_Proto'>deparseAnalyzeSizeSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3483"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3476"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* In what follows, do not risk leaking any PGresults. */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3482"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3483"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3482"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3483"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected result from deparseAnalyzeSizeSql query"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3478"><span class='Ref_to_Parameter'>totalpages</span></a> <span class='Operator'>= </span>strtoul<span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3484"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3482"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresAnalyzeForeignTable &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Acquire a random sample of rows from foreign table managed by postgres_fdw. 
 * 
 * We fetch the whole table from the remote side and pick out some sample rows. 
 * 
 * Selected rows are returned in the caller-allocated array rows[], 
 * which must have at least targrows entries. 
 * The actual number of rows selected is returned as the function result. 
 * We also count the total number of rows in the table and return it into 
 * *totalrows.  Note that *totaldeadrows is always set to 0. 
 * 
 * Note that the returned list of rows is not always in order by physical 
 * position in the table.  Therefore, correlation estimates derived later 
 * may be meaningless, but it's OK because we don't use the estimates 
 * currently (the planner only pays attention to correlation for indexscans). 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3554"></a><span class='Declare_Function'>postgresAcquireSampleRowsFunc</span><span class='Parentheses'>(</span><a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>elevel</span><span class='Delimiter'>, 
</span><a name="LN3555"></a>                              <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rows</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>targrows</span><span class='Delimiter'>, 
</span><a name="LN3556"></a>                              <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totalrows</span><span class='Delimiter'>, 
</span><a name="LN3557"></a>                              <span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>totaldeadrows</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3559"></a>    <a href="postgres_fdw.c.html#LN220"><span class='Ref_to_Struct'>PgFdwAnalyzeState</span></a> <span class='Declare_Local'>astate</span><span class='Delimiter'>; 
</span><a name="LN3560"></a>    <a href="../../src/include/foreign/foreign.h.html#LN63"><span class='Ref_to_Struct'>ForeignTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>table</span><span class='Delimiter'>; 
</span><a name="LN3561"></a>    <a href="../../src/include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN3562"></a>    <a href="../../src/include/foreign/foreign.h.html#LN55"><span class='Ref_to_Struct'>UserMapping</span></a> <span class='Operator'>*</span><span class='Declare_Local'>user</span><span class='Delimiter'>; 
</span><a name="LN3563"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN3564"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>cursor_number</span><span class='Delimiter'>; 
</span><a name="LN3565"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>sql</span><span class='Delimiter'>; 
</span><a name="LN3566"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize workspace state */ 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN222"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN223"><span class='Ref_to_Member'>attinmeta</span></a> <span class='Operator'>= </span><a href="../../src/include/funcapi.h.html#LN230"><span class='Ref_to_Proto'>TupleDescGetAttInMetadata</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN227"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3555"><span class='Ref_to_Parameter'>rows</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN228"><span class='Ref_to_Member'>targrows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3555"><span class='Ref_to_Parameter'>targrows</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN229"><span class='Ref_to_Member'>numrows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN232"><span class='Ref_to_Member'>samplerows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN233"><span class='Ref_to_Member'>rowstoskip</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* -1 means not set yet */ 
</span>    <a href="../../src/include/utils/sampling.h.html#LN54"><span class='Ref_to_Proto'>reservoir_init_selection_state</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN234"><span class='Ref_to_Member'>rstate</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3555"><span class='Ref_to_Parameter'>targrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember ANALYZE context, and create a per-tuple temp context */ 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN237"><span class='Ref_to_Member'>anl_cxt</span></a> <span class='Operator'>= </span><a href="../../src/backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN238"><span class='Ref_to_Member'>temp_cxt</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                            <span class='String'>"postgres_fdw temporary data"</span><span class='Delimiter'>, 
</span>                                            <a href="../../src/include/utils/memutils.h.html#LN174"><span class='Ref_to_Const'>ALLOCSET_SMALL_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the connection to use.  We do the remote access as the table's 
     * owner, even if the ANALYZE was started by some other user. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3560"><span class='Ref_To_Local'>table</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN77"><span class='Ref_to_Proto'>GetForeignTable</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3561"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3560"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3562"><span class='Ref_To_Local'>user</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>relation</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3560"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN66"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3562"><span class='Ref_To_Local'>user</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct cursor that retrieves whole rows from remote. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3564"><span class='Ref_To_Local'>cursor_number</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN119"><span class='Ref_to_Proto'>GetCursorNumber</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3565"><span class='Ref_To_Local'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3565"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><span class='String'>"DECLARE c%u CURSOR FOR "</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3564"><span class='Ref_To_Local'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.h.html#LN169"><span class='Ref_to_Proto'>deparseAnalyzeSql</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3565"><span class='Ref_To_Local'>sql</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN224"><span class='Ref_to_Member'>retrieved_attrs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* In what follows, do not risk leaking any PGresults. */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3565"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN84"><span class='Ref_to_EnumConst'>PGRES_COMMAND_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3565"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Retrieve and process rows a batch at a time. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3614"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>fetch_sql</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN3615"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>fetch_size</span><span class='Delimiter'>; 
</span><a name="LN3616"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>numrows</span><span class='Delimiter'>; 
</span><a name="LN3617"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3618"></a>            <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Allow users to cancel long query */ 
</span>            <a href="../../src/include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * XXX possible future improvement: if rowstoskip is large, we 
             * could issue a MOVE rather than physically fetching the rows, 
             * then just adjust rowstoskip and samplerows appropriately. 
             */ 
</span> 
            <span class='Comment_Multi_Line'>/* The fetch size is arbitrary, but shouldn't be enormous. */ 
</span>            <a href="postgres_fdw.c.html#LN3615"><span class='Ref_To_Local'>fetch_size</span></a> <span class='Operator'>= </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3618"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3561"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN52"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3633"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3618"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3633"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"fetch_size"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="postgres_fdw.c.html#LN3615"><span class='Ref_To_Local'>fetch_size</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3633"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3618"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3560"><span class='Ref_To_Local'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN67"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3643"></a>                <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3618"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3643"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"fetch_size"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="postgres_fdw.c.html#LN3615"><span class='Ref_To_Local'>fetch_size</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3643"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Fetch some rows */ 
</span>            <a href="../../src/pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3614"><span class='Ref_To_Local'>fetch_sql</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3614"><span class='Ref_To_Local'>fetch_sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"FETCH %d FROM c%u"</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN3615"><span class='Ref_To_Local'>fetch_size</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3564"><span class='Ref_To_Local'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3614"><span class='Ref_To_Local'>fetch_sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* On error, report the original query, not the FETCH. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
                <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3565"><span class='Ref_To_Local'>sql</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Process whatever we got. */ 
</span>            <a href="postgres_fdw.c.html#LN3616"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3617"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN3617"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3616"><span class='Ref_To_Local'>numrows</span></a><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN3617"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="postgres_fdw.c.html#LN394"><span class='Ref_to_Proto'>analyze_row_processor</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3617"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Must be EOF if we didn't get all the rows requested. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3616"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3615"><span class='Ref_To_Local'>fetch_size</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Close the cursor, just to be tidy. */ 
</span>        <a href="postgres_fdw.c.html#LN371"><span class='Ref_to_Proto'>close_cursor</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3564"><span class='Ref_To_Local'>cursor_number</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3563"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume that we have no dead tuple. */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3557"><span class='Ref_to_Parameter'>totaldeadrows</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We've retrieved all living tuples from foreign server. */ 
</span>    <span class='Operator'>*</span><a href="postgres_fdw.c.html#LN3556"><span class='Ref_to_Parameter'>totalrows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN232"><span class='Ref_to_Member'>samplerows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Emit some interesting relation info 
     */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>elevel</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\": table contains %.0f rows, %d rows in sample"</span><span class='Delimiter'>, 
</span>                    <a href="../../src/include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3554"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN232"><span class='Ref_to_Member'>samplerows</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN229"><span class='Ref_to_Member'>numrows</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN3559"><span class='Ref_To_Local'>astate</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN229"><span class='Ref_to_Member'>numrows</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresAcquireSampleRowsFunc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Collect sample rows from the result of query. 
 *   - Use all tuples in sample until target # of samples are collected. 
 *   - Subsequently, replace already-sampled tuples randomly. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3710"></a><span class='Declare_Function'>analyze_row_processor</span><span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN220"><span class='Ref_to_Struct'>PgFdwAnalyzeState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3712"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>targrows</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN228"><span class='Ref_to_Member'>targrows</span></a><span class='Delimiter'>; 
</span><a name="LN3713"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pos</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* array index to store tuple in */ 
</span><a name="LN3714"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Always increment sample row counter. */ 
</span>    <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN232"><span class='Ref_to_Member'>samplerows</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the slot where this sample row should be stored.  Set pos to 
     * negative value to indicate the row should be skipped. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN229"><span class='Ref_to_Member'>numrows</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3712"><span class='Ref_To_Local'>targrows</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* First targrows rows are always included into the sample */ 
</span>        <a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN229"><span class='Ref_to_Member'>numrows</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Now we start replacing tuples in the sample until we reach the end 
         * of the relation.  Same algorithm as in acquire_sample_rows in 
         * analyze.c; see Jeff Vitter's paper. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN233"><span class='Ref_to_Member'>rowstoskip</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN233"><span class='Ref_to_Member'>rowstoskip</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/sampling.h.html#LN55"><span class='Ref_to_Proto'>reservoir_get_next_S</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN234"><span class='Ref_to_Member'>rstate</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN232"><span class='Ref_to_Member'>samplerows</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3712"><span class='Ref_To_Local'>targrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN233"><span class='Ref_to_Member'>rowstoskip</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Choose a random reservoir element to replace. */ 
</span>            <a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="postgres_fdw.c.html#LN3712"><span class='Ref_To_Local'>targrows</span></a> <span class='Operator'>* </span><a href="../../src/include/utils/sampling.h.html#LN23"><span class='Ref_to_Proto'>sampler_random_fract</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN234"><span class='Ref_to_Member'>rstate</span></a><span class='Operator'>.</span><a href="../../src/include/utils/sampling.h.html#LN49"><span class='Ref_to_Member'>randstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3712"><span class='Ref_To_Local'>targrows</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN227"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Skip this tuple. */ 
</span>            <a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN233"><span class='Ref_to_Member'>rowstoskip</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Create sample tuple from current result row, and store it in the 
         * position determined above.  The tuple has to be created in anl_cxt. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN3714"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN237"><span class='Ref_to_Member'>anl_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN227"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN3713"><span class='Ref_To_Local'>pos</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="postgres_fdw.c.html#LN396"><span class='Ref_to_Proto'>make_tuple_from_result_row</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>row</span></a><span class='Delimiter'>, 
</span>                                                       <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN222"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                                                       <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN223"><span class='Ref_to_Member'>attinmeta</span></a><span class='Delimiter'>, 
</span>                                                     <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN224"><span class='Ref_to_Member'>retrieved_attrs</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                       <a href="postgres_fdw.c.html#LN3710"><span class='Ref_to_Parameter'>astate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN238"><span class='Ref_to_Member'>temp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3714"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end analyze_row_processor &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Import a foreign schema 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN3777"></a><span class='Declare_Function'>postgresImportForeignSchema</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN2265"><span class='Ref_to_Struct'>ImportForeignSchemaStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>serverOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3779"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>commands</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN3780"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>import_collate</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3781"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>import_default</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3782"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>import_not_null</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3783"></a>    <a href="../../src/include/foreign/foreign.h.html#LN44"><span class='Ref_to_Struct'>ForeignServer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>server</span><span class='Delimiter'>; 
</span><a name="LN3784"></a>    <a href="../../src/include/foreign/foreign.h.html#LN55"><span class='Ref_to_Struct'>UserMapping</span></a> <span class='Operator'>*</span><span class='Declare_Local'>mapping</span><span class='Delimiter'>; 
</span><a name="LN3785"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN139"><span class='Ref_to_Typedef'>PGconn</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>conn</span><span class='Delimiter'>; 
</span><a name="LN3786"></a>    <a href="../../src/include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3787"></a>    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a>   <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3788"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numrows</span><span class='Delimiter'>, 
</span><a name="LN3789"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3790"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse statement options */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3790"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2273"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3795"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3790"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"import_collate"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN3780"><span class='Ref_To_Local'>import_collate</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"import_default"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN3781"><span class='Ref_To_Local'>import_default</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"import_not_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN3782"><span class='Ref_To_Local'>import_not_null</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FDW_INVALID_OPTION_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid option \"%s\""</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3795"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get connection to the foreign server.  Connection manager will 
     * establish new connection if necessary. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN3783"><span class='Ref_To_Local'>server</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN71"><span class='Ref_to_Proto'>GetForeignServer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>serverOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3784"><span class='Ref_To_Local'>mapping</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/foreign.h.html#LN73"><span class='Ref_to_Proto'>GetUserMapping</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3783"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a> <span class='Operator'>= </span><a href="../../src/bin/pg_basebackup/streamutil.h.html#LN30"><span class='Ref_to_Proto'>GetConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3784"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't attempt to import collation if remote server hasn't got it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN322"><span class='Ref_to_Proto'>PQserverVersion</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>90100</span><span class='Parentheses'>)</span> 
        <a href="postgres_fdw.c.html#LN3780"><span class='Ref_To_Local'>import_collate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create workspace for strings */ 
</span>    <a href="../../src/backend/lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* In what follows, do not risk leaking any PGresults. */ 
</span>    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check that the schema really exists */ 
</span>        <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT 1 FROM pg_catalog.pg_namespace WHERE nspname = "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.h.html#LN171"><span class='Ref_to_Proto'>deparseStringLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2269"><span class='Ref_to_Member'>remote_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FDW_SCHEMA_NOT_FOUND<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"schema \"%s\" is not present on foreign server \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2269"><span class='Ref_to_Member'>remote_schema</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3783"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN49"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fetch all table data from this schema, possibly restricted by 
         * EXCEPT or LIMIT TO.  (We don't actually need to pay any attention 
         * to EXCEPT/LIMIT TO here, because the core code will filter the 
         * statements we return according to those lists anyway.  But it 
         * should save a few cycles to not process excluded tables in the 
         * first place.) 
         * 
         * Ignore table data for partitions and only include the definitions 
         * of the root partitioned tables to allow access to the complete 
         * remote data set locally in the schema imported. 
         * 
         * Note: because we run the connection with search_path restricted to 
         * pg_catalog, the format_type() and pg_get_expr() outputs will always 
         * include a schema name for types/functions in other schemas, which 
         * is what we want. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3780"><span class='Ref_To_Local'>import_collate</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                                   <span class='String'>"SELECT relname, "</span> 
                                   <span class='String'>"  attname, "</span> 
                                   <span class='String'>"  format_type(atttypid, atttypmod), "</span> 
                                   <span class='String'>"  attnotnull, "</span> 
                                   <span class='String'>"  pg_get_expr(adbin, adrelid), "</span> 
                                   <span class='String'>"  collname, "</span> 
                                   <span class='String'>"  collnsp.nspname "</span> 
                                   <span class='String'>"FROM pg_class c "</span> 
                                   <span class='String'>"  JOIN pg_namespace n ON "</span> 
                                   <span class='String'>"    relnamespace = n.oid "</span> 
                                   <span class='String'>"  LEFT JOIN pg_attribute a ON "</span> 
                                   <span class='String'>"    attrelid = c.oid AND attnum &GT; 0 "</span> 
                                   <span class='String'>"      AND NOT attisdropped "</span> 
                                   <span class='String'>"  LEFT JOIN pg_attrdef ad ON "</span> 
                                   <span class='String'>"    adrelid = c.oid AND adnum = attnum "</span> 
                                   <span class='String'>"  LEFT JOIN pg_collation coll ON "</span> 
                                   <span class='String'>"    coll.oid = attcollation "</span> 
                                   <span class='String'>"  LEFT JOIN pg_namespace collnsp ON "</span> 
                                   <span class='String'>"    collnsp.oid = collnamespace "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                                   <span class='String'>"SELECT relname, "</span> 
                                   <span class='String'>"  attname, "</span> 
                                   <span class='String'>"  format_type(atttypid, atttypmod), "</span> 
                                   <span class='String'>"  attnotnull, "</span> 
                                   <span class='String'>"  pg_get_expr(adbin, adrelid), "</span> 
                                   <span class='String'>"  NULL, NULL "</span> 
                                   <span class='String'>"FROM pg_class c "</span> 
                                   <span class='String'>"  JOIN pg_namespace n ON "</span> 
                                   <span class='String'>"    relnamespace = n.oid "</span> 
                                   <span class='String'>"  LEFT JOIN pg_attribute a ON "</span> 
                                   <span class='String'>"    attrelid = c.oid AND attnum &GT; 0 "</span> 
                                   <span class='String'>"      AND NOT attisdropped "</span> 
                                   <span class='String'>"  LEFT JOIN pg_attrdef ad ON "</span> 
                                   <span class='String'>"    adrelid = c.oid AND adnum = attnum "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"WHERE c.relkind IN ("</span> 
                               <a href="../../src/include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../src/include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                               <a href="../../src/include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../src/include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                               <a href="../../src/include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../src/include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                               <a href="../../src/include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../src/include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                               <a href="../../src/include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../src/include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) </span><span class='String'>") "</span> 
                               <span class='String'>"  AND n.nspname = "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.h.html#LN171"><span class='Ref_to_Proto'>deparseStringLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2269"><span class='Ref_to_Member'>remote_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Partitions are supported since Postgres 10 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN322"><span class='Ref_to_Proto'>PQserverVersion</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>100000</span><span class='Parentheses'>)</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" AND NOT c.relispartition "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Apply restrictions for LIMIT TO and EXCEPT */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2271"><span class='Ref_to_Member'>list_type</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/parsenodes.h.html#LN2261"><span class='Ref_to_EnumConst'>FDW_IMPORT_SCHEMA_LIMIT_TO</span></a> <span class='Operator'>|| 
</span>            <a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2271"><span class='Ref_to_Member'>list_type</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/parsenodes.h.html#LN2262"><span class='Ref_to_EnumConst'>FDW_IMPORT_SCHEMA_EXCEPT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3918"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>first_item</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" AND c.relname "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2271"><span class='Ref_to_Member'>list_type</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/parsenodes.h.html#LN2262"><span class='Ref_to_EnumConst'>FDW_IMPORT_SCHEMA_EXCEPT</span></a><span class='Parentheses'>) 
</span>                <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"NOT "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"IN ("</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Append list of table names within IN clause */ 
</span>            <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3790"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2272"><span class='Ref_to_Member'>table_list</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3928"></a>                <a href="../../src/include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rv</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3790"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3918"><span class='Ref_To_Local'>first_item</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres_fdw.c.html#LN3918"><span class='Ref_To_Local'>first_item</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.h.html#LN171"><span class='Ref_to_Proto'>deparseStringLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3928"><span class='Ref_To_Local'>rv</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../src/backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;list_type==FDW_... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Append ORDER BY at the end of query to ensure output ordering */ 
</span>        <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" ORDER BY c.relname, a.attnum"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch the data */ 
</span>        <a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN122"><span class='Ref_to_Proto'>pgfdw_exec_query</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN466"><span class='Ref_to_Proto'>PQresultStatus</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN87"><span class='Ref_to_EnumConst'>PGRES_TUPLES_OK</span></a><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.h.html#LN123"><span class='Ref_to_Proto'>pgfdw_report_error</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Process results */ 
</span>        <a href="postgres_fdw.c.html#LN3788"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* note: incrementation of i happens in inner loop's while() test */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3788"><span class='Ref_To_Local'>numrows</span></a><span class='Delimiter'>;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3952"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3953"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>first_item</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/backend/lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE FOREIGN TABLE %s (\n"</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3952"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Scan all rows for this table */ 
</span>            <span class='Control'>do</span> 
            <span class='Delimiter'>{ 
</span><a name="LN3962"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span><span class='Delimiter'>; 
</span><a name="LN3963"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>typename</span><span class='Delimiter'>; 
</span><a name="LN3964"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attnotnull</span><span class='Delimiter'>; 
</span><a name="LN3965"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attdefault</span><span class='Delimiter'>; 
</span><a name="LN3966"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collname</span><span class='Delimiter'>; 
</span><a name="LN3967"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collnamespace</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* If table has no columns, we'll see nulls here */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="postgres_fdw.c.html#LN3962"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Keyword'>typename </span><span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN3964"><span class='Ref_To_Local'>attnotnull</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN3965"><span class='Ref_To_Local'>attdefault</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>                    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN3966"><span class='Ref_To_Local'>collname</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>                    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN3967"><span class='Ref_To_Local'>collnamespace</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>                    <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3953"><span class='Ref_To_Local'>first_item</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres_fdw.c.html#LN3953"><span class='Ref_To_Local'>first_item</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>",\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Print column name and type */ 
</span>                <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"  %s %s"</span><span class='Delimiter'>, 
</span>                                 <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3962"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Add column_name option so that renaming the foreign table's 
                 * column doesn't break the association to the underlying 
                 * column. 
                 */ 
</span>                <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" OPTIONS (column_name "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.h.html#LN171"><span class='Ref_to_Proto'>deparseStringLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3962"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../src/backend/replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Add COLLATE if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3780"><span class='Ref_To_Local'>import_collate</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN3966"><span class='Ref_To_Local'>collname</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN3967"><span class='Ref_To_Local'>collnamespace</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" COLLATE %s.%s"</span><span class='Delimiter'>, 
</span>                                     <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3967"><span class='Ref_To_Local'>collnamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3966"><span class='Ref_To_Local'>collname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Add DEFAULT if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3781"><span class='Ref_To_Local'>import_default</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN3965"><span class='Ref_To_Local'>attdefault</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" DEFAULT %s"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3965"><span class='Ref_To_Local'>attdefault</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Add NOT NULL if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3782"><span class='Ref_To_Local'>import_not_null</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN3964"><span class='Ref_To_Local'>attnotnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'t'</span><span class='Parentheses'>) 
</span>                    <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" NOT NULL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="postgres_fdw.c.html#LN3788"><span class='Ref_To_Local'>numrows</span></a> <span class='Operator'>&& 
</span>                   strcmp<span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3952"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Add server name and table-level options.  We specify remote 
             * schema and table name as options (the latter to ensure that 
             * renaming the foreign table doesn't break the association). 
             */ 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\n) SERVER %s\nOPTIONS ("</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3783"><span class='Ref_To_Local'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN49"><span class='Ref_to_Member'>servername</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"schema_name "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.h.html#LN171"><span class='Ref_to_Proto'>deparseStringLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3777"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN2269"><span class='Ref_to_Member'>remote_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>", table_name "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.h.html#LN171"><span class='Ref_to_Proto'>deparseStringLiteral</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN3952"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../src/bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>");"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN3779"><span class='Ref_To_Local'>commands</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3779"><span class='Ref_To_Local'>commands</span></a><span class='Delimiter'>, </span><a href="../../src/include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3786"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numrows; &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Clean up */ 
</span>        <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/interfaces/libpq/libpq-fe.h.html#LN501"><span class='Ref_to_Proto'>PQclear</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3787"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.h.html#LN118"><span class='Ref_to_Proto'>ReleaseConnection</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN3785"><span class='Ref_To_Local'>conn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN3779"><span class='Ref_To_Local'>commands</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresImportForeignSchema &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Assess whether the join between inner and outer relations can be pushed down 
 * to the foreign server. As a side effect, save information we obtain in this 
 * function to PgFdwRelationInfo passed in. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4060"></a><span class='Declare_Function'>foreign_join_ok</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>joinrel</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, 
</span><a name="LN4061"></a>                <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outerrel</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>innerrel</span><span class='Delimiter'>, 
</span><a name="LN4062"></a>                <a href="../../src/include/nodes/relation.h.html#LN2177"><span class='Ref_to_Struct'>JoinPathExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4064"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span><span class='Delimiter'>; 
</span><a name="LN4065"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo_o</span><span class='Delimiter'>; 
</span><a name="LN4066"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo_i</span><span class='Delimiter'>; 
</span><a name="LN4067"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN4068"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>joinclauses</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We support pushing down INNER, LEFT, RIGHT and FULL OUTER joins. 
     * Constructing queries representing SEMI and ANTI joins is hard, hence 
     * not considered right now. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a> <span class='Operator'>&& 
</span>        <a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If either of the joining relations is marked as unsafe to pushdown, the 
     * join can not be pushed down. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>outerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>innerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a> <span class='Operator'>|| !</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a> <span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a> <span class='Operator'>|| !</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If joining relations have local conditions, those conditions are 
     * required to be applied before joining the relations. Hence the join can 
     * not be pushed down. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a> <span class='Operator'>|| </span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Merge FDW options.  We might be tempted to do this after we have deemed 
     * the foreign join to be OK.  But we must do this beforehand so that we 
     * know which quals can be evaluated on the foreign server, which might 
     * depend on shippable_extensions. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN418"><span class='Ref_to_Proto'>merge_fdw_options</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Separate restrict list into join quals and pushed-down (other) quals. 
     * 
     * Join quals belonging to an outer join must all be shippable, else we 
     * cannot execute the join remotely.  Add such quals to 'joinclauses'. 
     * 
     * Add other quals to fpinfo-&GT;remote_conds if they are shippable, else to 
     * fpinfo-&GT;local_conds.  In an inner join it's okay to execute conditions 
     * either locally or remotely; the same is true for pushed-down conditions 
     * at an outer join. 
     * 
     * Note we might return failure after having already scribbled on 
     * fpinfo-&GT;remote_conds and fpinfo-&GT;local_conds.  That's okay because we 
     * won't consult those lists again if we deem the join unshippable. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4068"><span class='Ref_To_Local'>joinclauses</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4067"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4062"><span class='Ref_to_Parameter'>extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN2179"><span class='Ref_to_Member'>restrictlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4125"></a>        <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4067"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4126"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_remote_clause</span> <span class='Operator'>= </span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Delimiter'>, 
</span>                                                       <a href="postgres_fdw.c.html#LN4125"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN720"><span class='Ref_to_Macro'>IS_OUTER_JOIN</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="postgres_fdw.c.html#LN4125"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1748"><span class='Ref_to_Member'>is_pushed_down</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4126"><span class='Ref_To_Local'>is_remote_clause</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN4068"><span class='Ref_To_Local'>joinclauses</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4068"><span class='Ref_To_Local'>joinclauses</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4125"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4126"><span class='Ref_To_Local'>is_remote_clause</span></a><span class='Parentheses'>) 
</span>                <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4125"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4125"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * deparseExplicitTargetList() isn't smart enough to handle anything other 
     * than a Var.  In particular, if there's some PlaceHolderVar that would 
     * need to be evaluated within this join tree (because there's an upper 
     * reference to a quantity that may go to NULL as a result of an outer 
     * join), then we can't try to push the join down because we'll fail when 
     * we get to deparseExplicitTargetList().  However, a PlaceHolderVar that 
     * needs to be evaluated *at the top* of this join tree is OK, because we 
     * can do that locally after fetching the results from the remote side. 
     */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4067"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN257"><span class='Ref_to_Member'>placeholder_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4156"></a>        <a href="../../src/include/nodes/relation.h.html#LN2057"><span class='Ref_to_Struct'>PlaceHolderInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>phinfo</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4067"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4157"></a>        <a href="../../src/include/nodes/relation.h.html#LN27"><span class='Ref_to_Typedef'>Relids</span></a>      <span class='Declare_Local'>relids</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4156"><span class='Ref_To_Local'>phinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN2063"><span class='Ref_to_Member'>ph_eval_at</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4157"><span class='Ref_To_Local'>relids</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../src/include/nodes/bitmapset.h.html#LN78"><span class='Ref_to_Proto'>bms_nonempty_difference</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4157"><span class='Ref_To_Local'>relids</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4156"><span class='Ref_To_Local'>phinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN2063"><span class='Ref_to_Member'>ph_eval_at</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Save the join clauses, for later use. */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4068"><span class='Ref_To_Local'>joinclauses</span></a><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN88"><span class='Ref_to_Member'>outerrel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>outerrel</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN89"><span class='Ref_to_Member'>innerrel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>innerrel</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN90"><span class='Ref_to_Member'>jointype</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * By default, both the input relations are not required to be deparsed as 
     * subqueries, but there might be some relations covered by the input 
     * relations that are required to be deparsed as subqueries, so save the 
     * relids of those relations for later use by the deparser. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN98"><span class='Ref_to_Member'>make_outerrel_subquery</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN100"><span class='Ref_to_Member'>make_innerrel_subquery</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>outerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>innerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/bitmapset.h.html#LN70"><span class='Ref_to_Proto'>bms_union</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a><span class='Delimiter'>, 
</span>                                            <a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pull the other remote conditions from the joining relations into join 
     * clauses or other remote clauses (remote_conds) of this relation 
     * wherever possible. This avoids building subqueries at every join step. 
     * 
     * For an inner join, clauses from both the relations are added to the 
     * other remote clauses. For LEFT and RIGHT OUTER join, the clauses from 
     * the outer side are added to remote_conds since those can be evaluated 
     * after the join is evaluated. The clauses from inner side are added to 
     * the joinclauses, since they need to be evaluated while constructing the 
     * join. 
     * 
     * For a FULL OUTER JOIN, the other clauses from either relation can not 
     * be added to the joinclauses or remote_conds, since each relation acts 
     * as an outer relation for the other. 
     * 
     * The joining sides can not have local conditions, thus no need to test 
     * shippability of the clauses being pulled up. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN680"><span class='Ref_to_EnumConst'>JOIN_RIGHT</span></a><span class='Operator'>: 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In this case, if any of the input relations has conditions, we 
             * need to deparse that relation as a subquery so that the 
             * conditions can be evaluated before the join.  Remember it in 
             * the fpinfo of this relation so that the deparser can take 
             * appropriate action.  Also, save the relids of base relations 
             * covered by that relation for later use by the deparser. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN98"><span class='Ref_to_Member'>make_outerrel_subquery</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a> <span class='Operator'>= 
</span>                    <a href="../../src/include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a><span class='Delimiter'>, 
</span>                                    <a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>outerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN100"><span class='Ref_to_Member'>make_innerrel_subquery</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a> <span class='Operator'>= 
</span>                    <a href="../../src/include/nodes/bitmapset.h.html#LN91"><span class='Ref_to_Proto'>bms_add_members</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN102"><span class='Ref_to_Member'>lower_subquery_rels</span></a><span class='Delimiter'>, 
</span>                                    <a href="postgres_fdw.c.html#LN4061"><span class='Ref_to_Parameter'>innerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Should not happen, we have just check this above */ 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported join type %d"</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch jointype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * For an inner join, all restrictions can be treated alike. Treating the 
     * pushed down conditions as join conditions allows a top level full outer 
     * join to be deparsed without requiring subqueries. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>jointype</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Mark that this join can be pushed down safely */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get user mapping */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set cached relation costs to some negative value, so that we can detect 
     * when they are set to some sensible costs, during one (usually the 
     * first) of the calls to estimate_path_cost_size(). 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the string describing this join relation to be used in EXPLAIN 
     * output of corresponding ForeignScan. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a> <span class='Operator'>= </span><a href="../../src/backend/lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Delimiter'>, </span><span class='String'>"(%s) %s JOIN (%s)"</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN4065"><span class='Ref_To_Local'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.h.html#LN182"><span class='Ref_to_Proto'>get_jointype_name</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN90"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN4066"><span class='Ref_To_Local'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the relation index.  This is defined as the position of this 
     * joinrel in the join_rel_list list plus the length of the rtable list. 
     * Note that since this joinrel is at the end of the join_rel_list list 
     * when we are called, we can get the position by list_length. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN109"><span class='Ref_to_Member'>relation_index</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* shouldn't be set yet */ 
</span>    <a href="postgres_fdw.c.html#LN4064"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN109"><span class='Ref_to_Member'>relation_index</span></a> <span class='Operator'>= 
</span>        <a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN134"><span class='Ref_to_Member'>rtable</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../src/include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4060"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN214"><span class='Ref_to_Member'>join_rel_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end foreign_join_ok &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN4315"></a><span class='Declare_Function'>add_paths_with_pathkeys_for_rel</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN4316"></a>                                <a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>epq_path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4318"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>useful_pathkeys_list</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* List of all pathkeys */ 
</span><a name="LN4319"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN4318"><span class='Ref_To_Local'>useful_pathkeys_list</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN408"><span class='Ref_to_Proto'>get_useful_pathkeys_for_relation</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create one path for each set of pathkeys we found above. */ 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4319"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4318"><span class='Ref_To_Local'>useful_pathkeys_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4326"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>rows</span><span class='Delimiter'>; 
</span><a name="LN4327"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>width</span><span class='Delimiter'>; 
</span><a name="LN4328"></a>        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>startup_cost</span><span class='Delimiter'>; 
</span><a name="LN4329"></a>        <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>total_cost</span><span class='Delimiter'>; 
</span><a name="LN4330"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>useful_pathkeys</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4319"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN354"><span class='Ref_to_Proto'>estimate_path_cost_size</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4330"><span class='Ref_To_Local'>useful_pathkeys</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4326"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4327"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4328"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4329"><span class='Ref_To_Local'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                 <a href="../../src/include/optimizer/pathnode.h.html#LN106"><span class='Ref_to_Proto'>create_foreignscan_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4315"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                         <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                         <a href="postgres_fdw.c.html#LN4326"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                                         <a href="postgres_fdw.c.html#LN4328"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, 
</span>                                         <a href="postgres_fdw.c.html#LN4329"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>, 
</span>                                         <a href="postgres_fdw.c.html#LN4330"><span class='Ref_To_Local'>useful_pathkeys</span></a><span class='Delimiter'>, 
</span>                                         <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                         <a href="postgres_fdw.c.html#LN4316"><span class='Ref_to_Parameter'>epq_path</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end add_paths_with_pathkeys_for_rel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse options from foreign server and apply them to fpinfo. 
 * 
 * New options might also require tweaking merge_fdw_options(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4354"></a><span class='Declare_Function'>apply_server_options</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4356"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4356"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4354"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN52"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4360"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4356"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"use_remote_estimate"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4354"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"fdw_startup_cost"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4354"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN69"><span class='Ref_to_Member'>fdw_startup_cost</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"fdw_tuple_cost"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4354"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN70"><span class='Ref_to_Member'>fdw_tuple_cost</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"extensions"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4354"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN71"><span class='Ref_to_Member'>shippable_extensions</span></a> <span class='Operator'>= 
</span>                <a href="postgres_fdw.h.html#LN130"><span class='Ref_to_Proto'>ExtractExtensionList</span></a><span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"fetch_size"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4354"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4360"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end apply_server_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse options from foreign table and apply them to fpinfo. 
 * 
 * New options might also require tweaking merge_fdw_options(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4382"></a><span class='Declare_Function'>apply_table_options</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4384"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4384"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4382"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN74"><span class='Ref_to_Member'>table</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN67"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4388"></a>        <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4384"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4388"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"use_remote_estimate"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4382"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a> <span class='Operator'>= </span><a href="../../src/backend/commands/define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4388"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4388"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"fetch_size"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="postgres_fdw.c.html#LN4382"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="../../src/backend/commands/define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4388"><span class='Ref_To_Local'>def</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Merge FDW options from input relations into a new set of options for a join 
 * or an upper rel. 
 * 
 * For a join relation, FDW-specific information about the inner and outer 
 * relations is provided using fpinfo_i and fpinfo_o.  For an upper relation, 
 * fpinfo_o provides the information for the input relation; fpinfo_i is 
 * expected to NULL. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4407"></a><span class='Declare_Function'>merge_fdw_options</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo</span><span class='Delimiter'>, 
</span><a name="LN4408"></a>                  <span class='Keyword'>const </span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo_o</span><span class='Delimiter'>, 
</span><a name="LN4409"></a>                  <span class='Keyword'>const </span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fpinfo_i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We must always have fpinfo_o. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fpinfo_i may be NULL, but if present the servers must both match. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4409"><span class='Ref_to_Parameter'>fpinfo_i</span></a> <span class='Operator'>|| 
</span>           <a href="postgres_fdw.c.html#LN4409"><span class='Ref_to_Parameter'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a> <span class='Operator'>== </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/foreign/foreign.h.html#LN46"><span class='Ref_to_Member'>serverid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the server specific FDW options.  (For a join, both relations come 
     * from the same server, so the server options should have the same value 
     * for both relations.) 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN69"><span class='Ref_to_Member'>fdw_startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN69"><span class='Ref_to_Member'>fdw_startup_cost</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN70"><span class='Ref_to_Member'>fdw_tuple_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN70"><span class='Ref_to_Member'>fdw_tuple_cost</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN71"><span class='Ref_to_Member'>shippable_extensions</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN71"><span class='Ref_to_Member'>shippable_extensions</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Merge the table level options from either side of the join. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4409"><span class='Ref_to_Parameter'>fpinfo_i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We'll prefer to use remote estimates for this join if any table 
         * from either side of the join is using remote estimates.  This is 
         * most likely going to be preferred since they're already willing to 
         * pay the price of a round trip to get the remote EXPLAIN.  In any 
         * case it's not entirely clear how we might otherwise handle this 
         * best. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a> <span class='Operator'>|| 
</span>            <a href="postgres_fdw.c.html#LN4409"><span class='Ref_to_Parameter'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set fetch size to maximum of the joining sides, since we are 
         * expecting the rows returned by the join to be proportional to the 
         * relation sizes. 
         */ 
</span>        <a href="postgres_fdw.c.html#LN4407"><span class='Ref_to_Parameter'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4408"><span class='Ref_to_Parameter'>fpinfo_o</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4409"><span class='Ref_to_Parameter'>fpinfo_i</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN78"><span class='Ref_to_Member'>fetch_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fpinfo_i &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end merge_fdw_options &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresGetForeignJoinPaths 
 *      Add possible ForeignPath to joinrel, if join is safe to push down. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4457"></a><span class='Declare_Function'>postgresGetForeignJoinPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, 
</span><a name="LN4458"></a>                            <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>joinrel</span><span class='Delimiter'>, 
</span><a name="LN4459"></a>                            <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outerrel</span><span class='Delimiter'>, 
</span><a name="LN4460"></a>                            <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>innerrel</span><span class='Delimiter'>, 
</span><a name="LN4461"></a>                            <a href="../../src/include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a> <span class='Declare_Parameter'>jointype</span><span class='Delimiter'>, 
</span><a name="LN4462"></a>                            <a href="../../src/include/nodes/relation.h.html#LN2177"><span class='Ref_to_Struct'>JoinPathExtraData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>extra</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4464"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span><span class='Delimiter'>; 
</span><a name="LN4465"></a>    <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>joinpath</span><span class='Delimiter'>; 
</span><a name="LN4466"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rows</span><span class='Delimiter'>; 
</span><a name="LN4467"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>width</span><span class='Delimiter'>; 
</span><a name="LN4468"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>startup_cost</span><span class='Delimiter'>; 
</span><a name="LN4469"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>total_cost</span><span class='Delimiter'>; 
</span><a name="LN4470"></a>    <a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>epq_path</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* Path to create plan to be executed when 
                                 * EvalPlanQual gets triggered. */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Skip if this join combination has been considered already. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create unfinished PgFdwRelationInfo entry which is used to indicate 
     * that the join relation is already considered, so that we won't waste 
     * time in judging safety of join pushdown and adding the same paths again 
     * if found safe. Once we know that this join can be pushed down, we fill 
     * the entry. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* attrs_used is only for base relations. */ 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN49"><span class='Ref_to_Member'>attrs_used</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there is a possibility that EvalPlanQual will be executed, we need 
     * to be able to reconstruct the row using scans of the base relations. 
     * GetExistingLocalJoinPath will find a suitable path for this purpose in 
     * the path list of the joinrel, if one exists.  We must be careful to 
     * call it before adding any ForeignPath, since the ForeignPath might 
     * dominate the only suitable local path available.  We also do it before 
     * reconstruct the row for EvalPlanQual(). Find an alternative local path 
     * calling foreign_join_ok(), since that function updates fpinfo and marks 
     * it as pushable if the join is found to be pushable. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a> <span class='Operator'>|| 
</span>        <a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../src/include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| 
</span>        <a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN255"><span class='Ref_to_Member'>rowMarks</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a> <span class='Operator'>= </span><a href="../../src/include/foreign/fdwapi.h.html#LN239"><span class='Ref_to_Proto'>GetExistingLocalJoinPath</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN22"><span class='Ref_to_Const'>DEBUG3</span></a><span class='Delimiter'>, </span><span class='String'>"could not push down foreign join because a local path suitable for EPQ checks was not found"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN404"><span class='Ref_to_Proto'>foreign_join_ok</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4461"><span class='Ref_to_Parameter'>jointype</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4459"><span class='Ref_to_Parameter'>outerrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4460"><span class='Ref_to_Parameter'>innerrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4462"><span class='Ref_to_Parameter'>extra</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Free path required for EPQ if we copied one; we don't need it now */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a><span class='Parentheses'>) 
</span>            <a href="../../src/include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute the selectivity and cost of the local_conds, so we don't have 
     * to do it over again for each path. The best we can do for these 
     * conditions is to estimate selectivity on the basis of local statistics. 
     * The local conditions are applied after the join has been computed on 
     * the remote side like quals in WHERE clause, so pass jointype as 
     * JOIN_INNER. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN53"><span class='Ref_to_Member'>local_conds_sel</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/clausesel.c.html#LN97"><span class='Ref_to_Func'>clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                                     <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                     <a href="../../src/include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/optimizer/cost.h.html#LN157"><span class='Ref_to_Proto'>cost_qual_eval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN52"><span class='Ref_to_Member'>local_conds_cost</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are going to estimate costs locally, estimate the join clause 
     * selectivity here while we have special join info. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN68"><span class='Ref_to_Member'>use_remote_estimate</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN56"><span class='Ref_to_Member'>joinclause_sel</span></a> <span class='Operator'>= </span><a href="../../src/backend/optimizer/path/clausesel.c.html#LN97"><span class='Ref_to_Func'>clauselist_selectivity</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN92"><span class='Ref_to_Member'>joinclauses</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Number'>0</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN90"><span class='Ref_to_Member'>jointype</span></a><span class='Delimiter'>, 
</span>                                                        <a href="postgres_fdw.c.html#LN4462"><span class='Ref_to_Parameter'>extra</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN2182"><span class='Ref_to_Member'>sjinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimate costs for bare join relation */ 
</span>    <a href="postgres_fdw.c.html#LN354"><span class='Ref_to_Proto'>estimate_path_cost_size</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4466"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4467"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4468"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4469"><span class='Ref_To_Local'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Now update this information in the joinrel */ 
</span>    <a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4466"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN535"><span class='Ref_to_Member'>reltarget</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN885"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4467"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4466"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN60"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4467"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN61"><span class='Ref_to_Member'>startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4468"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4464"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN62"><span class='Ref_to_Member'>total_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4469"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a new join path and add it to the joinrel which represents a 
     * join between foreign tables. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4465"><span class='Ref_To_Local'>joinpath</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/pathnode.h.html#LN106"><span class='Ref_to_Proto'>create_foreignscan_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Delimiter'>, 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* default pathtarget */ 
</span>                                       <a href="postgres_fdw.c.html#LN4466"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres_fdw.c.html#LN4468"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, 
</span>                                       <a href="postgres_fdw.c.html#LN4469"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* no pathkeys */ 
</span>                                       <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* no required_outer */ 
</span>                                       <a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* no fdw_private */ 
</span> 
    <span class='Comment_Multi_Line'>/* Add generated path into joinrel by add_path(). */ 
</span>    <a href="../../src/include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4465"><span class='Ref_To_Local'>joinpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Consider pathkeys for the join relation */ 
</span>    <a href="postgres_fdw.c.html#LN411"><span class='Ref_to_Proto'>add_paths_with_pathkeys_for_rel</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4457"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4458"><span class='Ref_to_Parameter'>joinrel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4470"><span class='Ref_To_Local'>epq_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX Consider parameterized paths for the join relation */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end postgresGetForeignJoinPaths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Assess whether the aggregation, grouping and having operations can be pushed 
 * down to the foreign server.  As a side effect, save information we obtain in 
 * this function to PgFdwRelationInfo of the input relation. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4590"></a><span class='Declare_Function'>foreign_grouping_ok</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grouped_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4592"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN4593"></a>    <a href="../../src/include/nodes/relation.h.html#LN879"><span class='Ref_to_Struct'>PathTarget</span></a> <span class='Operator'>*</span><span class='Declare_Local'>grouping_target</span><span class='Delimiter'>; 
</span><a name="LN4594"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN4595"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ofpinfo</span><span class='Delimiter'>; 
</span><a name="LN4596"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>aggvars</span><span class='Delimiter'>; 
</span><a name="LN4597"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN4598"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4599"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlist</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Grouping Sets are not pushable */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4592"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN147"><span class='Ref_to_Member'>groupingSets</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the fpinfo of the underlying scan relation. */ 
</span>    <a href="postgres_fdw.c.html#LN4595"><span class='Ref_To_Local'>ofpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN88"><span class='Ref_to_Member'>outerrel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If underneath input relation has any local conditions, those conditions 
     * are required to be applied before performing aggregation.  Hence the 
     * aggregate cannot be pushed down. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4595"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The targetlist expected from this node and the targetlist pushed down 
     * to the foreign server may be different. The latter requires 
     * sortgrouprefs to be set to push down GROUP BY clause, but should not 
     * have those arising from ORDER BY clause. These sortgrouprefs may be 
     * different from those in the plan's targetlist. Use a copy of path 
     * target to record the new sortgrouprefs. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4593"><span class='Ref_To_Local'>grouping_target</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/tlist.h.html#LN56"><span class='Ref_to_Proto'>copy_pathtarget</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN274"><span class='Ref_to_Member'>upper_targets</span></a><span class='Delimiter'>[</span><a href="../../src/include/nodes/relation.h.html#LN73"><span class='Ref_to_EnumConst'>UPPERREL_GROUP_AGG</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Evaluate grouping targets and check whether they are safe to push down 
     * to the foreign side.  All GROUP BY expressions will be part of the 
     * grouping target and thus there is no need to evaluate it separately. 
     * While doing so, add required expressions into target list which can 
     * then be used to pass to foreign server. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4598"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4597"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4593"><span class='Ref_To_Local'>grouping_target</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN882"><span class='Ref_to_Member'>exprs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4636"></a>        <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4597"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4637"></a>        <a href="../../src/include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>sgref</span> <span class='Operator'>= </span><a href="../../src/include/nodes/relation.h.html#LN889"><span class='Ref_to_Macro'>get_pathtarget_sortgroupref</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4593"><span class='Ref_To_Local'>grouping_target</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4598"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4638"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check whether this expression is part of GROUP BY clause */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4637"><span class='Ref_To_Local'>sgref</span></a> <span class='Operator'>&& </span><a href="../../src/include/optimizer/tlist.h.html#LN46"><span class='Ref_to_Proto'>get_sortgroupref_clause_noerr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4637"><span class='Ref_To_Local'>sgref</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4592"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If any of the GROUP BY expression is not shippable we can not 
             * push down aggregation to the foreign server. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4636"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Pushable, add to tlist */ 
</span>            <a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/tlist.h.html#LN22"><span class='Ref_to_Proto'>add_to_flat_tlist</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4636"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Check entire expression whether it is pushable or not */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4636"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Pushable, add to tlist */ 
</span>                <a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/tlist.h.html#LN22"><span class='Ref_to_Proto'>add_to_flat_tlist</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4636"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If we have sortgroupref set, then it means that we have an 
                 * ORDER BY entry pointing to this expression.  Since we are 
                 * not pushing ORDER BY with GROUP BY, clear it. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4637"><span class='Ref_To_Local'>sgref</span></a><span class='Parentheses'>) 
</span>                    <a href="postgres_fdw.c.html#LN4593"><span class='Ref_To_Local'>grouping_target</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN883"><span class='Ref_to_Member'>sortgrouprefs</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN4598"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Not matched exactly, pull the var with aggregates then */ 
</span>                <a href="postgres_fdw.c.html#LN4596"><span class='Ref_To_Local'>aggvars</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/var.h.html#LN36"><span class='Ref_to_Proto'>pull_var_clause</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4636"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../src/include/optimizer/var.h.html#LN19"><span class='Ref_to_Const'>PVC_INCLUDE_AGGREGATES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4596"><span class='Ref_To_Local'>aggvars</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Add aggregates, if any, into the targetlist.  Plain var 
                 * nodes should be either same as some GROUP BY expression or 
                 * part of some GROUP BY expression. In later case, the query 
                 * cannot refer plain var nodes without the surrounding 
                 * expression.  In both the cases, they are already part of 
                 * the targetlist and thus no need to add them again.  In fact 
                 * adding pulled plain var nodes in SELECT clause will cause 
                 * an error on the foreign server if they are not same as some 
                 * GROUP BY expression. 
                 */ 
</span>                <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4638"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4596"><span class='Ref_To_Local'>aggvars</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN4691"></a>                    <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4638"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4691"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
                        <a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/tlist.h.html#LN22"><span class='Ref_to_Proto'>add_to_flat_tlist</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4691"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="postgres_fdw.c.html#LN4598"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Classify the pushable and non-pushable having clauses and save them in 
     * remote_conds and local_conds of the grouped rel's fpinfo. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN301"><span class='Ref_to_Member'>hasHavingQual</span></a> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN4592"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4708"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4708"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4592"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN149"><span class='Ref_to_Member'>havingQual</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4712"></a>            <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4708"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4713"></a>            <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Currently, the core code doesn't wrap havingQuals in 
             * RestrictInfos, so we must make our own. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4712"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN4713"><span class='Ref_To_Local'>rinfo</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/restrictinfo.h.html#LN23"><span class='Ref_to_Proto'>make_restrictinfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4712"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                      <a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN293"><span class='Ref_to_Member'>qual_security_level</span></a><span class='Delimiter'>, 
</span>                                      <a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4712"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
                <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN42"><span class='Ref_to_Member'>remote_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4713"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a> <span class='Operator'>= </span><a href="../../src/backend/nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4713"><span class='Ref_To_Local'>rinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if root-&GT;hasHavingQual&&... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If there are any local conditions, pull Vars and aggregates from it and 
     * check whether they are safe to pushdown or not. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4741"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>aggvars</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN4742"></a>        <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4742"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN43"><span class='Ref_to_Member'>local_conds</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4746"></a>            <a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rinfo</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN1742"><span class='Ref_to_Struct'>RestrictInfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4742"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN4741"><span class='Ref_To_Local'>aggvars</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4741"><span class='Ref_To_Local'>aggvars</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../src/include/optimizer/var.h.html#LN36"><span class='Ref_to_Proto'>pull_var_clause</span></a><span class='Parentheses'>((</span><a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4746"><span class='Ref_To_Local'>rinfo</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN1746"><span class='Ref_to_Member'>clause</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../src/include/optimizer/var.h.html#LN19"><span class='Ref_to_Const'>PVC_INCLUDE_AGGREGATES</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4742"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4741"><span class='Ref_To_Local'>aggvars</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4755"></a>            <a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4742"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If aggregates within local conditions are not safe to push 
             * down, then we cannot push down the query.  Vars are already 
             * part of GROUP BY clause which are checked above, so no need to 
             * access them again here. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4755"><span class='Ref_To_Local'>expr</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/primnodes.h.html#LN290"><span class='Ref_to_Struct'>Aggref</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.h.html#LN139"><span class='Ref_to_Proto'>is_foreign_expr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4590"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4755"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/tlist.h.html#LN22"><span class='Ref_to_Proto'>add_to_flat_tlist</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4755"><span class='Ref_To_Local'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fpinfo-&GT;local_conds &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Transfer any sortgroupref data to the replacement tlist */ 
</span>    <a href="../../src/include/optimizer/tlist.h.html#LN62"><span class='Ref_to_Proto'>apply_pathtarget_labeling_to_tlist</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4593"><span class='Ref_To_Local'>grouping_target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Store generated targetlist */ 
</span>    <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN95"><span class='Ref_to_Member'>grouped_tlist</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4599"><span class='Ref_To_Local'>tlist</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safe to pushdown */ 
</span>    <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set cached relation costs to some negative value, so that we can detect 
     * when they are set to some sensible costs, during one (usually the 
     * first) of the calls to estimate_path_cost_size(). 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN64"><span class='Ref_to_Member'>rel_startup_cost</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN65"><span class='Ref_to_Member'>rel_total_cost</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the string describing this grouped relation to be used in EXPLAIN 
     * output of corresponding ForeignScan. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a> <span class='Operator'>= </span><a href="../../src/backend/lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../src/bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4594"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Delimiter'>, </span><span class='String'>"Aggregate on (%s)"</span><span class='Delimiter'>, 
</span>                     <a href="postgres_fdw.c.html#LN4595"><span class='Ref_To_Local'>ofpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN85"><span class='Ref_to_Member'>relation_name</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end foreign_grouping_ok &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * postgresGetForeignUpperPaths 
 *      Add paths for post-join operations like aggregation, grouping etc. if 
 *      corresponding operations are safe to push down. 
 * 
 * Right now, we only support aggregate, grouping and having clause pushdown. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4809"></a><span class='Declare_Function'>postgresGetForeignUpperPaths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN70"><span class='Ref_to_Enum'>UpperRelationKind</span></a> <span class='Declare_Parameter'>stage</span><span class='Delimiter'>, 
</span><a name="LN4810"></a>                             <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_rel</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>output_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4812"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If input rel is not safe to pushdown, then simply return as we cannot 
     * perform any post-join operations on the foreign server. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4810"><span class='Ref_to_Parameter'>input_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a> <span class='Operator'>|| 
</span>        <span class='Operator'>!</span><span class='Parentheses'>((</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4810"><span class='Ref_to_Parameter'>input_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pushdown_safe<span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ignore stages we don't support; and skip any duplicate calls. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4809"><span class='Ref_to_Parameter'>stage</span></a> <span class='Operator'>!= </span><a href="../../src/include/nodes/relation.h.html#LN73"><span class='Ref_to_EnumConst'>UPPERREL_GROUP_AGG</span></a> <span class='Operator'>|| </span><a href="postgres_fdw.c.html#LN4810"><span class='Ref_to_Parameter'>output_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN4812"><span class='Ref_To_Local'>fpinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4812"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN35"><span class='Ref_to_Member'>pushdown_safe</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4810"><span class='Ref_to_Parameter'>output_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4812"><span class='Ref_To_Local'>fpinfo</span></a><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN413"><span class='Ref_to_Proto'>add_foreign_grouping_paths</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4809"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4810"><span class='Ref_to_Parameter'>input_rel</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4810"><span class='Ref_to_Parameter'>output_rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end postgresGetForeignUpperPaths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * add_foreign_grouping_paths 
 *      Add foreign path for grouping and/or aggregation. 
 * 
 * Given input_rel represents the underlying scan.  The paths are added to the 
 * given grouped_rel. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4841"></a><span class='Declare_Function'>add_foreign_grouping_paths</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>input_rel</span><span class='Delimiter'>, 
</span><a name="LN4842"></a>                           <a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grouped_rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4844"></a>    <a href="../../src/include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>parse</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN154"><span class='Ref_to_Member'>parse</span></a><span class='Delimiter'>; 
</span><a name="LN4845"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ifpinfo</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>input_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN4846"></a>    <a href="postgres_fdw.h.html#LN29"><span class='Ref_to_Struct'>PgFdwRelationInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fpinfo</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4842"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN576"><span class='Ref_to_Member'>fdw_private</span></a><span class='Delimiter'>; 
</span><a name="LN4847"></a>    <a href="../../src/include/nodes/relation.h.html#LN1127"><span class='Ref_to_Struct'>ForeignPath</span></a> <span class='Operator'>*</span><span class='Declare_Local'>grouppath</span><span class='Delimiter'>; 
</span><a name="LN4848"></a>    <a href="../../src/include/nodes/relation.h.html#LN879"><span class='Ref_to_Struct'>PathTarget</span></a> <span class='Operator'>*</span><span class='Declare_Local'>grouping_target</span><span class='Delimiter'>; 
</span><a name="LN4849"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>rows</span><span class='Delimiter'>; 
</span><a name="LN4850"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>width</span><span class='Delimiter'>; 
</span><a name="LN4851"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>startup_cost</span><span class='Delimiter'>; 
</span><a name="LN4852"></a>    <a href="../../src/include/nodes/nodes.h.html#LN638"><span class='Ref_to_Typedef'>Cost</span></a>        <span class='Declare_Local'>total_cost</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nothing to be done, if there is no grouping or aggregation required. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4844"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN145"><span class='Ref_to_Member'>groupClause</span></a> <span class='Operator'>&& !</span><a href="postgres_fdw.c.html#LN4844"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN147"><span class='Ref_to_Member'>groupingSets</span></a> <span class='Operator'>&& !</span><a href="postgres_fdw.c.html#LN4844"><span class='Ref_To_Local'>parse</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN122"><span class='Ref_to_Member'>hasAggs</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN301"><span class='Ref_to_Member'>hasHavingQual</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN4848"><span class='Ref_To_Local'>grouping_target</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN274"><span class='Ref_to_Member'>upper_targets</span></a><span class='Delimiter'>[</span><a href="../../src/include/nodes/relation.h.html#LN73"><span class='Ref_to_EnumConst'>UPPERREL_GROUP_AGG</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* save the input_rel as outerrel in fpinfo */ 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN88"><span class='Ref_to_Member'>outerrel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>input_rel</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy foreign table, foreign server, user mapping, FDW options etc. 
     * details from the input relation's fpinfo. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN74"><span class='Ref_to_Member'>table</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4845"><span class='Ref_To_Local'>ifpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN74"><span class='Ref_to_Member'>table</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4845"><span class='Ref_To_Local'>ifpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN75"><span class='Ref_to_Member'>server</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4845"><span class='Ref_To_Local'>ifpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN76"><span class='Ref_to_Member'>user</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN418"><span class='Ref_to_Proto'>merge_fdw_options</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4845"><span class='Ref_To_Local'>ifpinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assess if it is safe to push down aggregation and grouping. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="postgres_fdw.c.html#LN407"><span class='Ref_to_Proto'>foreign_grouping_ok</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4842"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimate the cost of push down */ 
</span>    <a href="postgres_fdw.c.html#LN354"><span class='Ref_to_Proto'>estimate_path_cost_size</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4842"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4849"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4850"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4851"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4852"><span class='Ref_To_Local'>total_cost</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now update this information in the fpinfo */ 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN59"><span class='Ref_to_Member'>rows</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4849"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN60"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4850"><span class='Ref_To_Local'>width</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN61"><span class='Ref_to_Member'>startup_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4851"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4846"><span class='Ref_To_Local'>fpinfo</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.h.html#LN62"><span class='Ref_to_Member'>total_cost</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4852"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create and add foreign path to the grouping relation. */ 
</span>    <a href="postgres_fdw.c.html#LN4847"><span class='Ref_To_Local'>grouppath</span></a> <span class='Operator'>= </span><a href="../../src/include/optimizer/pathnode.h.html#LN106"><span class='Ref_to_Proto'>create_foreignscan_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4841"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN4842"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN4848"><span class='Ref_To_Local'>grouping_target</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN4849"><span class='Ref_To_Local'>rows</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN4851"><span class='Ref_To_Local'>startup_cost</span></a><span class='Delimiter'>, 
</span>                                        <a href="postgres_fdw.c.html#LN4852"><span class='Ref_To_Local'>total_cost</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* no pathkeys */ 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* no required_outer */ 
</span>                                        <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                        <a href="../../src/include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* no fdw_private */ 
</span> 
    <span class='Comment_Multi_Line'>/* Add generated path into grouped_rel by add_path(). */ 
</span>    <a href="../../src/include/optimizer/pathnode.h.html#LN27"><span class='Ref_to_Proto'>add_path</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4842"><span class='Ref_to_Parameter'>grouped_rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN946"><span class='Ref_to_Struct'>Path</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4847"><span class='Ref_To_Local'>grouppath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_foreign_grouping_paths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create a tuple from the specified row of the PGresult. 
 * 
 * rel is the local representation of the foreign table, attinmeta is 
 * conversion data for the rel's tupdesc, and retrieved_attrs is an 
 * integer list of the table column numbers present in the PGresult. 
 * temp_context is a working context that can be reset after each tuple. 
 */ 
</span><span class='Keyword'>static </span><a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN4912"></a><span class='Declare_Function'>make_tuple_from_result_row</span><span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN146"><span class='Ref_to_Typedef'>PGresult</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>res</span><span class='Delimiter'>, 
</span><a name="LN4913"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>row</span><span class='Delimiter'>, 
</span><a name="LN4914"></a>                           <a href="../../src/include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN4915"></a>                           <a href="../../src/include/funcapi.h.html#LN34"><span class='Ref_to_Struct'>AttInMetadata</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attinmeta</span><span class='Delimiter'>, 
</span><a name="LN4916"></a>                           <a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>retrieved_attrs</span><span class='Delimiter'>, 
</span><a name="LN4917"></a>                           <a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsstate</span><span class='Delimiter'>, 
</span><a name="LN4918"></a>                           <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>temp_context</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4920"></a>    <a href="../../src/include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4921"></a>    <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN4922"></a>    <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN4923"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN4924"></a>    <a href="../../src/include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Local'>ctid</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4925"></a>    <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span> <span class='Operator'>= </span><a href="../../src/include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4926"></a>    <a href="postgres_fdw.c.html#LN244"><span class='Ref_to_Struct'>ConversionLocation</span></a> <span class='Declare_Local'>errpos</span><span class='Delimiter'>; 
</span><a name="LN4927"></a>    ErrorContextCallback <span class='Declare_Local'>errcallback</span><span class='Delimiter'>; 
</span><a name="LN4928"></a>    <a href="../../src/include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN4929"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN4930"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4913"><span class='Ref_to_Parameter'>row</span></a> <span class='Operator'>&LT; </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN473"><span class='Ref_to_Proto'>PQntuples</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4912"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do the following work in a temp context that we reset after each tuple. 
     * This cleans up not only the data we have direct access to, but any 
     * cruft the I/O functions might leak. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4928"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4918"><span class='Ref_to_Parameter'>temp_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4914"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4914"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4945"></a>        <a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fdw_sstate</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4917"><span class='Ref_to_Parameter'>fsstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN4945"><span class='Ref_To_Local'>fdw_sstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN124"><span class='Ref_to_Struct'>PgFdwScanState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN4917"><span class='Ref_to_Parameter'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1506"><span class='Ref_to_Member'>fdw_state</span></a><span class='Delimiter'>; 
</span>        <a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4945"><span class='Ref_To_Local'>fdw_sstate</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN128"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="postgres_fdw.c.html#LN4922"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4923"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Initialize to nulls for any columns not present in result */ 
</span>    memset<span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4923"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up and install callback to report where conversion error occurs. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4926"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN246"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4914"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4926"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4926"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN255"><span class='Ref_to_Member'>fsstate</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4917"><span class='Ref_to_Parameter'>fsstate</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4927"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN403"><span class='Ref_to_Proto'>conversion_error_callback</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4927"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4926"><span class='Ref_To_Local'>errpos</span></a><span class='Delimiter'>; 
</span>    <a href="postgres_fdw.c.html#LN4927"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="postgres_fdw.c.html#LN4927"><span class='Ref_To_Local'>errcallback</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * i indexes columns in the relation, j indexes columns in the PGresult. 
     */ 
</span>    <a href="postgres_fdw.c.html#LN4930"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4929"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4916"><span class='Ref_to_Parameter'>retrieved_attrs</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4974"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4929"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4975"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>valstr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* fetch next column's textual value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN490"><span class='Ref_to_Proto'>PQgetisnull</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4912"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4913"><span class='Ref_to_Parameter'>row</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4930"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>))</span> 
            <a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a> <span class='Operator'>= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN488"><span class='Ref_to_Proto'>PQgetvalue</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4912"><span class='Ref_to_Parameter'>res</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4913"><span class='Ref_to_Parameter'>row</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4930"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * convert value to internal representation 
         * 
         * Note: we ignore system columns other than ctid and oid in result 
         */ 
</span>        <a href="postgres_fdw.c.html#LN4926"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ordinary column */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="postgres_fdw.c.html#LN4923"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Apply the input function even to nulls, to support domains */ 
</span>            <a href="postgres_fdw.c.html#LN4922"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="postgres_fdw.c.html#LN4915"><span class='Ref_to_Parameter'>attinmeta</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN40"><span class='Ref_to_Member'>attinfuncs</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                              <a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a><span class='Delimiter'>, 
</span>                                              <a href="postgres_fdw.c.html#LN4915"><span class='Ref_to_Parameter'>attinmeta</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN43"><span class='Ref_to_Member'>attioparams</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                              <a href="postgres_fdw.c.html#LN4915"><span class='Ref_to_Parameter'>attinmeta</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/funcapi.h.html#LN46"><span class='Ref_to_Member'>atttypmods</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="../../src/include/access/sysattr.h.html#LN20"><span class='Ref_to_Const'>SelfItemPointerAttributeNumber</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ctid */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5005"></a>                <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span> 
                <a href="postgres_fdw.c.html#LN5005"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/tid.c.html#LN51"><span class='Ref_to_Func'>tidin</span></a><span class='Delimiter'>, </span><a href="../../src/include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN4924"><span class='Ref_To_Local'>ctid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a><span class='Parentheses'>) </span><a href="../../src/include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5005"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4974"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="../../src/include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* oid */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5016"></a>                <a href="../../src/include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span> 
                <a href="postgres_fdw.c.html#LN5016"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../src/include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../src/backend/utils/adt/oid.c.html#LN115"><span class='Ref_to_Func'>oidin</span></a><span class='Delimiter'>, </span><a href="../../src/include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4975"><span class='Ref_To_Local'>valstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="postgres_fdw.c.html#LN4925"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../src/include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5016"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="postgres_fdw.c.html#LN4926"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>.</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN4930"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Uninstall error context callback. */ 
</span>    <a href="../../src/backend/utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4927"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check we got the expected number of columns.  Note: j == 0 and 
     * PQnfields == 1 is expected, since deparse emits a NULL if no columns. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4930"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN4930"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>!= </span><a href="../../src/interfaces/libpq/libpq-fe.h.html#LN474"><span class='Ref_to_Proto'>PQnfields</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4912"><span class='Ref_to_Parameter'>res</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"remote query result does not match the foreign table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build the result tuple in caller's memory context. 
     */ 
</span>    <a href="../../src/include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4928"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../src/backend/access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4921"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4922"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4923"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have a CTID to return, install it in both t_self and t_ctid. 
     * t_self is the normal place, but if the tuple is converted to a 
     * composite Datum, t_self will be lost; setting t_ctid allows CTID to be 
     * preserved during EvalPlanQual re-evaluations (see ROW_MARK_COPY code). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4924"><span class='Ref_To_Local'>ctid</span></a><span class='Parentheses'>) 
</span>        <a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a> <span class='Operator'>= *</span><a href="postgres_fdw.c.html#LN4924"><span class='Ref_To_Local'>ctid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Stomp on the xmin, xmax, and cmin fields from the tuple created by 
     * heap_form_tuple.  heap_form_tuple actually creates the tuple with 
     * DatumTupleFields, not HeapTupleFields, but the executor expects 
     * HeapTupleFields and will happily extract system columns on that 
     * assumption.  If we don't do this then, for example, the tuple length 
     * ends up in the xmin field, which isn't what we want. 
     */ 
</span>    <a href="../../src/include/access/htup_details.h.html#LN373"><span class='Ref_to_Macro'>HeapTupleHeaderSetXmax</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../src/include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/access/htup_details.h.html#LN312"><span class='Ref_to_Macro'>HeapTupleHeaderSetXmin</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../src/include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../src/include/access/htup_details.h.html#LN390"><span class='Ref_to_Macro'>HeapTupleHeaderSetCmin</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="../../src/include/access/transam.h.html#LN30"><span class='Ref_to_Const'>InvalidTransactionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have an OID to return, install it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4925"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>))</span> 
        <a href="../../src/include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN4925"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up */ 
</span>    <a href="../../src/include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN4918"><span class='Ref_to_Parameter'>temp_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN4920"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_tuple_from_result_row &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Callback function which is called when error occurs during column value 
 * conversion.  Print names of column and relation. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5082"></a><span class='Declare_Function'>conversion_error_callback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5084"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>attname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5085"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>relname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5086"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_wholerow</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5087"></a>    <a href="postgres_fdw.c.html#LN244"><span class='Ref_to_Struct'>ConversionLocation</span></a> <span class='Operator'>*</span><span class='Declare_Local'>errpos</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN244"><span class='Ref_to_Struct'>ConversionLocation</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN5082"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN246"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* error occurred in a scan against a foreign table */ 
</span><a name="LN5092"></a>        <a href="../../src/include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN246"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>&LT;= </span><a href="postgres_fdw.c.html#LN5092"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN5084"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><a href="../../src/include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5092"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>== </span><a href="../../src/include/access/sysattr.h.html#LN20"><span class='Ref_to_Const'>SelfItemPointerAttributeNumber</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN5084"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><span class='String'>"ctid"</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>== </span><a href="../../src/include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>            <a href="postgres_fdw.c.html#LN5084"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><span class='String'>"oid"</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN5085"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN246"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* error occurred in a scan against a foreign join */ 
</span><a name="LN5106"></a>        <a href="../../src/include/nodes/execnodes.h.html#LN1499"><span class='Ref_to_Struct'>ForeignScanState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsstate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN255"><span class='Ref_to_Member'>fsstate</span></a><span class='Delimiter'>; 
</span><a name="LN5107"></a>        <a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fsplan</span> <span class='Operator'>= </span><a href="../../src/include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN594"><span class='Ref_to_Struct'>ForeignScan</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5106"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN812"><span class='Ref_to_Member'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5108"></a>        <a href="../../src/include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="postgres_fdw.c.html#LN5106"><span class='Ref_To_Local'>fsstate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN1501"><span class='Ref_to_Member'>ss</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN1057"><span class='Ref_to_Member'>ps</span></a><span class='Operator'>.</span><a href="../../src/include/nodes/execnodes.h.html#LN814"><span class='Ref_to_Member'>state</span></a><span class='Delimiter'>; 
</span><a name="LN5109"></a>        <a href="../../src/include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span><span class='Delimiter'>; 
</span> 
        <a href="postgres_fdw.c.html#LN5109"><span class='Ref_To_Local'>tle</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN226"><span class='Ref_to_Macro'>list_nth_node</span></a><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5107"><span class='Ref_To_Local'>fsplan</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN601"><span class='Ref_to_Member'>fdw_scan_tlist</span></a><span class='Delimiter'>, 
</span>                            <a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Target list can have Vars and expressions.  For Vars, we can get 
         * it's relation, however for expressions we can't.  Thus for 
         * expressions, just show generic context message. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5109"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>, </span><a href="../../src/include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN5121"></a>            <a href="../../src/include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN5122"></a>            <a href="../../src/include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>var</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/primnodes.h.html#LN162"><span class='Ref_to_Struct'>Var</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="postgres_fdw.c.html#LN5109"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN5121"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../src/include/parser/parsetree.h.html#LN30"><span class='Ref_to_Macro'>rt_fetch</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5122"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN165"><span class='Ref_to_Member'>varno</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5108"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5122"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="postgres_fdw.c.html#LN5086"><span class='Ref_To_Local'>is_wholerow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="postgres_fdw.c.html#LN5084"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/lsyscache.h.html#LN86"><span class='Ref_to_Proto'>get_relid_attribute_name</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5121"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5122"><span class='Ref_To_Local'>var</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/primnodes.h.html#LN167"><span class='Ref_to_Member'>varattno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="postgres_fdw.c.html#LN5085"><span class='Ref_To_Local'>relname</span></a> <span class='Operator'>= </span><a href="../../src/include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5121"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            errcontext<span class='Parentheses'>(</span><span class='String'>"processing expression at position %d in select list"</span><span class='Delimiter'>, 
</span>                       <a href="postgres_fdw.c.html#LN5087"><span class='Ref_To_Local'>errpos</span></a><span class='Operator'>-&GT;</span><a href="postgres_fdw.c.html#LN247"><span class='Ref_to_Member'>cur_attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5085"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5086"><span class='Ref_To_Local'>is_wholerow</span></a><span class='Parentheses'>) 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"whole-row reference to foreign table \"%s\""</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5085"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5084"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>) 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"column \"%s\" of foreign table \"%s\""</span><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5084"><span class='Ref_To_Local'>attname</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5085"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end conversion_error_callback &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find an equivalence class member expression, all of whose Vars, come from 
 * the indicated relation. 
 */ 
</span><span class='Keyword'>extern </span><a href="../../src/include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN5152"></a><span class='Declare_Function'>find_em_expr_for_rel</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/relation.h.html#LN766"><span class='Ref_to_Struct'>EquivalenceClass</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ec</span><span class='Delimiter'>, </span><a href="../../src/include/nodes/relation.h.html#LN517"><span class='Ref_to_Struct'>RelOptInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5154"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc_em</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5154"><span class='Ref_To_Local'>lc_em</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5152"><span class='Ref_to_Parameter'>ec</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN772"><span class='Ref_to_Member'>ec_members</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5158"></a>        <a href="../../src/include/nodes/relation.h.html#LN816"><span class='Ref_to_Struct'>EquivalenceMember</span></a> <span class='Operator'>*</span><span class='Declare_Local'>em</span> <span class='Operator'>= </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5154"><span class='Ref_To_Local'>lc_em</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/bitmapset.h.html#LN73"><span class='Ref_to_Proto'>bms_is_subset</span></a><span class='Parentheses'>(</span><a href="postgres_fdw.c.html#LN5158"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN821"><span class='Ref_to_Member'>em_relids</span></a><span class='Delimiter'>, </span><a href="postgres_fdw.c.html#LN5152"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN524"><span class='Ref_to_Member'>relids</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If there is more than one equivalence member whose Vars are 
             * taken entirely from this relation, we'll be content to choose 
             * any one of those. 
             */ 
</span>            <span class='Control'>return</span> <a href="postgres_fdw.c.html#LN5158"><span class='Ref_To_Local'>em</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/relation.h.html#LN820"><span class='Ref_to_Member'>em_expr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* We didn't find any suitable equivalence class expression */ 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_em_expr_for_rel &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>