<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>contrib\sepgsql\hooks.c</title>
<LINK REL=StyleSheet HREF="../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>contrib\sepgsql\hooks.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:27 2017
</td></tr>
<tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* ------------------------------------------------------------------------- 
 * 
 * contrib/sepgsql/hooks.c 
 * 
 * Entrypoints of the hooks in PostgreSQL, and dispatches the callbacks. 
 * 
 * Copyright (c) 2010-2017, PostgreSQL Global Development Group 
 * 
 * ------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_database.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/seclabel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/queryenvironment.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"sepgsql.h"</span> 
 
<a href="../../src/include/fmgr.h.html#LN442"><span class='Ref_to_Const'>PG_MODULE_MAGIC</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Declarations 
 */ 
</span><a name="LN33"></a><span class='Keyword'>void</span>        <span class='Declare_Prototype'>_PG_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Saved hook entries (if stacked) 
 */ 
</span><a name="LN38"></a><span class='Keyword'>static </span><a href="../../src/include/catalog/objectaccess.h.html#LN119"><span class='Ref_to_Typedef'>object_access_hook_type</span></a> <span class='Declare_Var'>next_object_access_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static </span><a href="../../src/include/executor/executor.h.html#LN87"><span class='Ref_to_Typedef'>ExecutorCheckPerms_hook_type</span></a> <span class='Declare_Var'>next_exec_check_perms_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static </span><a href="../../src/include/tcop/utility.h.html#LN26"><span class='Ref_to_Typedef'>ProcessUtility_hook_type</span></a> <span class='Declare_Var'>next_ProcessUtility_hook</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Contextual information on DDL commands 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN47"></a>    <a href="../../src/include/nodes/nodes.h.html#LN25"><span class='Ref_to_Enum'>NodeTag</span></a>     <span class='Declare_Member'>cmdtype</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Name of the template database given by users on CREATE DATABASE 
     * command. Elsewhere (including the case of default) NULL. 
     */ 
</span><a name="LN53"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>createdb_dtemplate</span><span class='Delimiter'>; 
</span><a name="LN54"></a>}   <span class='Declare_Typedef'>sepgsql_context_info_t</span><span class='Delimiter'>; 
</span> 
<a name="LN56"></a><span class='Keyword'>static </span><a href="hooks.c.html#LN45"><span class='Ref_to_Typedef'>sepgsql_context_info_t</span></a> <span class='Declare_Var'>sepgsql_context_info</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GUC: sepgsql.permissive = (on|off) 
 */ 
</span><a name="LN61"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>sepgsql_permissive</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>bool 
</span><a name="LN64"></a><span class='Declare_Function'>sepgsql_get_permissive</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="hooks.c.html#LN61"><span class='Ref_to_Global_Var'>sepgsql_permissive</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GUC: sepgsql.debug_audit = (on|off) 
 */ 
</span><a name="LN72"></a><span class='Keyword'>static bool </span><span class='Declare_Var'>sepgsql_debug_audit</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>bool 
</span><a name="LN75"></a><span class='Declare_Function'>sepgsql_get_debug_audit</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="hooks.c.html#LN72"><span class='Ref_to_Global_Var'>sepgsql_debug_audit</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sepgsql_object_access 
 * 
 * Entrypoint of the object_access_hook. This routine performs as 
 * a dispatcher of invocation based on access type and object classes. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN87"></a><span class='Declare_Function'>sepgsql_object_access</span><span class='Parentheses'>(</span><a href="../../src/include/catalog/objectaccess.h.html#LN41"><span class='Ref_to_Enum'>ObjectAccessType</span></a> <span class='Declare_Parameter'>access</span><span class='Delimiter'>, 
</span><a name="LN88"></a>                      <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classId</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                      <a href="../../src/include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, 
</span><a name="LN90"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>subId</span><span class='Delimiter'>, 
</span><a name="LN91"></a>                      <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN38"><span class='Ref_to_Global_Var'>next_object_access_hook</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hooks.c.html#LN38"><span class='Ref_to_Global_Var'>next_object_access_hook</span></a><span class='Parentheses'>) (</span><a href="hooks.c.html#LN87"><span class='Ref_to_Parameter'>access</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN88"><span class='Ref_to_Parameter'>classId</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN91"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN87"><span class='Ref_to_Parameter'>access</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../src/include/catalog/objectaccess.h.html#LN43"><span class='Ref_to_EnumConst'>OAT_POST_CREATE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN100"></a>                <a href="../../src/include/catalog/objectaccess.h.html#LN53"><span class='Ref_to_Typedef'>ObjectAccessPostCreate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pc_arg</span> <span class='Operator'>= </span><a href="hooks.c.html#LN91"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN101"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_internal</span><span class='Delimiter'>; 
</span> 
                <a href="hooks.c.html#LN101"><span class='Ref_To_Local'>is_internal</span></a> <span class='Operator'>= </span><a href="hooks.c.html#LN100"><span class='Ref_To_Local'>pc_arg</span></a> <span class='Operator'>? </span><a href="hooks.c.html#LN100"><span class='Ref_To_Local'>pc_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN60"><span class='Ref_to_Member'>is_internal</span></a> <span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN88"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN101"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="database.c.html#LN32"><span class='Ref_to_Func'>sepgsql_database_post_create</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, 
</span>                                    <a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a><span class='Operator'>.</span><a href="hooks.c.html#LN53"><span class='Ref_to_Member'>createdb_dtemplate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN101"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="schema.c.html#LN36"><span class='Ref_to_Func'>sepgsql_schema_post_create</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * The cases in which we want to apply permission 
                             * checks on creation of a new relation correspond 
                             * to direct user invocation.  For internal uses, 
                             * that is creation of toast tables, index rebuild 
                             * or ALTER TABLE commands, we need neither 
                             * assignment of security labels nor permission 
                             * checks. 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN101"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <a href="relation.c.html#LN240"><span class='Ref_to_Func'>sepgsql_relation_post_create</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                            <a href="relation.c.html#LN43"><span class='Ref_to_Func'>sepgsql_attribute_post_create</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN101"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="proc.c.html#LN37"><span class='Ref_to_Func'>sepgsql_proc_post_create</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Ignore unsupported object classes */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch classId &raquo; </span> 
            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/catalog/objectaccess.h.html#LN44"><span class='Ref_to_EnumConst'>OAT_DROP</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN153"></a>                <a href="../../src/include/catalog/objectaccess.h.html#LN66"><span class='Ref_to_Typedef'>ObjectAccessDrop</span></a> <span class='Operator'>*</span><span class='Declare_Local'>drop_arg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/catalog/objectaccess.h.html#LN66"><span class='Ref_to_Typedef'>ObjectAccessDrop</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hooks.c.html#LN91"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * No need to apply permission checks on object deletion due 
                 * to internal cleanups; such as removal of temporary database 
                 * object on session closed. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="hooks.c.html#LN153"><span class='Ref_To_Local'>drop_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN72"><span class='Ref_to_Member'>dropflags</span></a> <span class='Operator'>& </span><a href="../../src/include/catalog/dependency.h.html#LN173"><span class='Ref_to_Const'>PERFORM_DELETION_INTERNAL</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN88"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Operator'>: 
</span>                        <a href="database.c.html#LN132"><span class='Ref_to_Func'>sepgsql_database_drop</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Operator'>: 
</span>                        <a href="schema.c.html#LN114"><span class='Ref_to_Func'>sepgsql_schema_drop</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="sepgsql.h.html#LN313"><span class='Ref_to_Proto'>sepgsql_relation_drop</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="relation.c.html#LN133"><span class='Ref_to_Func'>sepgsql_attribute_drop</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Operator'>: 
</span>                        <a href="proc.c.html#LN155"><span class='Ref_to_Func'>sepgsql_proc_drop</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Ignore unsupported object classes */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch classId &raquo; </span> 
            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/catalog/objectaccess.h.html#LN45"><span class='Ref_to_EnumConst'>OAT_POST_ALTER</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN193"></a>                <a href="../../src/include/catalog/objectaccess.h.html#LN78"><span class='Ref_to_Typedef'>ObjectAccessPostAlter</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pa_arg</span> <span class='Operator'>= </span><a href="hooks.c.html#LN91"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN194"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_internal</span> <span class='Operator'>= </span><a href="hooks.c.html#LN193"><span class='Ref_To_Local'>pa_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN94"><span class='Ref_to_Member'>is_internal</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN88"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN194"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="database.c.html#LN159"><span class='Ref_to_Func'>sepgsql_database_setattr</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN194"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="schema.c.html#LN202"><span class='Ref_to_Func'>sepgsql_schema_setattr</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * A case when we don't want to apply permission 
                             * check is that relation is internally altered 
                             * without user's intention. E.g, no need to check 
                             * on toast table/index to be renamed at end of 
                             * the table rewrites. 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN194"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <a href="sepgsql.h.html#LN315"><span class='Ref_to_Proto'>sepgsql_relation_setattr</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                            <a href="relation.c.html#LN209"><span class='Ref_to_Func'>sepgsql_attribute_setattr</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN90"><span class='Ref_to_Parameter'>subId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../src/include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Operator'>: 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN194"><span class='Ref_To_Local'>is_internal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="proc.c.html#LN235"><span class='Ref_to_Func'>sepgsql_proc_setattr</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Ignore unsupported object classes */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch classId &raquo; </span> 
            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/catalog/objectaccess.h.html#LN46"><span class='Ref_to_EnumConst'>OAT_NAMESPACE_SEARCH</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN241"></a>                <a href="../../src/include/catalog/objectaccess.h.html#LN100"><span class='Ref_to_Typedef'>ObjectAccessNamespaceSearch</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ns_arg</span> <span class='Operator'>= </span><a href="hooks.c.html#LN91"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If stacked extension already decided not to allow users to 
                 * search this schema, we just stick with that decision. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="hooks.c.html#LN241"><span class='Ref_To_Local'>ns_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN115"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hooks.c.html#LN88"><span class='Ref_to_Parameter'>classId</span></a> <span class='Operator'>== </span><a href="../../src/include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hooks.c.html#LN241"><span class='Ref_To_Local'>ns_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN115"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="hooks.c.html#LN241"><span class='Ref_To_Local'>ns_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN115"><span class='Ref_to_Member'>result</span></a> 
                    <span class='Operator'>= </span><a href="schema.c.html#LN209"><span class='Ref_to_Func'>sepgsql_schema_search</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, 
</span>                                            <a href="hooks.c.html#LN241"><span class='Ref_To_Local'>ns_arg</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/catalog/objectaccess.h.html#LN106"><span class='Ref_to_Member'>ereport_on_violation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../src/include/catalog/objectaccess.h.html#LN47"><span class='Ref_to_EnumConst'>OAT_FUNCTION_EXECUTE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="hooks.c.html#LN88"><span class='Ref_to_Parameter'>classId</span></a> <span class='Operator'>== </span><a href="../../src/include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="proc.c.html#LN315"><span class='Ref_to_Func'>sepgsql_proc_execute</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN89"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../src/backend/bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected object access type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="hooks.c.html#LN87"><span class='Ref_to_Parameter'>access</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch access &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end sepgsql_object_access &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * sepgsql_exec_check_perms 
 * 
 * Entrypoint of DML permissions 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN277"></a><span class='Declare_Function'>sepgsql_exec_check_perms</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rangeTabls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>abort</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If security provider is stacking and one of them replied 'false' at 
     * least, we don't need to check any more. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN39"><span class='Ref_to_Global_Var'>next_exec_check_perms_hook</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hooks.c.html#LN39"><span class='Ref_to_Global_Var'>next_exec_check_perms_hook</span></a><span class='Parentheses'>) (</span><a href="hooks.c.html#LN277"><span class='Ref_to_Parameter'>rangeTabls</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN277"><span class='Ref_to_Parameter'>abort</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="sepgsql.h.html#LN281"><span class='Ref_to_Proto'>sepgsql_dml_privileges</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN277"><span class='Ref_to_Parameter'>rangeTabls</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN277"><span class='Ref_to_Parameter'>abort</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * sepgsql_utility_command 
 * 
 * It tries to rough-grained control on utility commands; some of them can 
 * break whole of the things if nefarious user would use. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN300"></a><span class='Declare_Function'>sepgsql_utility_command</span><span class='Parentheses'>(</span><a href="../../src/include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstmt</span><span class='Delimiter'>, 
</span><a name="LN301"></a>                        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>queryString</span><span class='Delimiter'>, 
</span><a name="LN302"></a>                        <a href="../../src/include/tcop/utility.h.html#LN18"><span class='Ref_to_Typedef'>ProcessUtilityContext</span></a> <span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN303"></a>                        <a href="../../src/include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, 
</span><a name="LN304"></a>                        <a href="../../src/backend/utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN305"></a>                        <a href="../../src/include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Delimiter'>, 
</span><a name="LN306"></a>                        <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN308"></a>    <a href="../../src/include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="hooks.c.html#LN300"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>; 
</span><a name="LN309"></a>    <a href="hooks.c.html#LN45"><span class='Ref_to_Typedef'>sepgsql_context_info_t</span></a> <span class='Declare_Local'>saved_context_info</span> <span class='Operator'>= </span><a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a><span class='Delimiter'>; 
</span><a name="LN310"></a>    <a href="../../src/include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="../../src/include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check command tag to avoid nefarious operations, and save the 
         * current contextual information to determine whether we should apply 
         * permission checks here, or not. 
         */ 
</span>        <a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a><span class='Operator'>.</span><a href="hooks.c.html#LN47"><span class='Ref_to_Member'>cmdtype</span></a> <span class='Operator'>= </span><a href="../../src/include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN308"><span class='Ref_To_Local'>parsetree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../src/include/nodes/nodes.h.html#LN513"><span class='Ref_to_Macro'>nodeTag</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN308"><span class='Ref_To_Local'>parsetree</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN338"><span class='Ref_to_EnumConst'>T_CreatedbStmt</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We hope to reference name of the source database, but it 
                 * does not appear in system catalog. So, we save it here. 
                 */ 
</span>                <a href="../../src/include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN310"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><span class='Parentheses'>((</span><a href="../../src/include/nodes/parsenodes.h.html#LN2994"><span class='Ref_to_Struct'>CreatedbStmt</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="hooks.c.html#LN308"><span class='Ref_To_Local'>parsetree</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>options<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN331"></a>                    <a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../src/include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../src/include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN310"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="hooks.c.html#LN331"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"template"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a><span class='Operator'>.</span><a href="hooks.c.html#LN53"><span class='Ref_to_Member'>createdb_dtemplate</span></a> 
                            <span class='Operator'>= </span><a href="../../src/include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN331"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../src/include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../src/include/nodes/nodes.h.html#LN336"><span class='Ref_to_EnumConst'>T_LoadStmt</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We reject LOAD command across the board on enforcing mode, 
                 * because a binary module can arbitrarily override hooks. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="sepgsql.h.html#LN225"><span class='Ref_to_Proto'>sepgsql_getenforce</span></a><span class='Parentheses'>())</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"SELinux: LOAD is not permitted"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Right now we don't check any other utility commands, 
                 * because it needs more detailed information to make access 
                 * control decision here, but we don't want to have two parse 
                 * and analyze routines individually. 
                 */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nodeTag(parsetree) &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="hooks.c.html#LN40"><span class='Ref_to_Global_Var'>next_ProcessUtility_hook</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="hooks.c.html#LN40"><span class='Ref_to_Global_Var'>next_ProcessUtility_hook</span></a><span class='Parentheses'>) (</span><a href="hooks.c.html#LN300"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN301"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                         <a href="hooks.c.html#LN302"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN303"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN304"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                         <a href="hooks.c.html#LN305"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN306"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../src/include/tcop/utility.h.html#LN37"><span class='Ref_to_Proto'>standard_ProcessUtility</span></a><span class='Parentheses'>(</span><a href="hooks.c.html#LN300"><span class='Ref_to_Parameter'>pstmt</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN301"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                    <a href="hooks.c.html#LN302"><span class='Ref_to_Parameter'>context</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN303"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN304"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, 
</span>                                    <a href="hooks.c.html#LN305"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="hooks.c.html#LN306"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a> <span class='Operator'>= </span><a href="hooks.c.html#LN309"><span class='Ref_To_Local'>saved_context_info</span></a><span class='Delimiter'>; 
</span>        <a href="../../src/include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../src/include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a> <span class='Operator'>= </span><a href="hooks.c.html#LN309"><span class='Ref_To_Local'>saved_context_info</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sepgsql_utility_command &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Module load/unload callback 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN388"></a><span class='Declare_Function'>_PG_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * We allow to load the SE-PostgreSQL module on single-user-mode or 
     * shared_preload_libraries settings only. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../src/backend/utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <a href="../../src/include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../src/include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../src/include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../../src/backend/utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sepgsql must be loaded via shared_preload_libraries"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check availability of SELinux on the platform. If disabled, we cannot 
     * activate any SE-PostgreSQL features, and we have to skip rest of 
     * initialization. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>is_selinux_enabled<span class='Parentheses'>() </span><span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="sepgsql.h.html#LN224"><span class='Ref_to_Proto'>sepgsql_set_mode</span></a><span class='Parentheses'>(</span><a href="sepgsql.h.html#LN30"><span class='Ref_to_Const'>SEPGSQL_MODE_DISABLED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * sepgsql.permissive = (on|off) 
     * 
     * This variable controls performing mode of SE-PostgreSQL on user's 
     * session. 
     */ 
</span>    <a href="../../src/include/utils/guc.h.html#LN279"><span class='Ref_to_Proto'>DefineCustomBoolVariable</span></a><span class='Parentheses'>(</span><span class='String'>"sepgsql.permissive"</span><span class='Delimiter'>, 
</span>                             <span class='String'>"Turn on/off permissive mode in SE-PostgreSQL"</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="hooks.c.html#LN61"><span class='Ref_to_Global_Var'>sepgsql_permissive</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN71"><span class='Ref_to_EnumConst'>PGC_SIGHUP</span></a><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN208"><span class='Ref_to_Const'>GUC_NOT_IN_SAMPLE</span></a><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * sepgsql.debug_audit = (on|off) 
     * 
     * This variable allows users to turn on/off audit logs on access control 
     * decisions, independent from auditallow/auditdeny setting in the 
     * security policy. We intend to use this option for debugging purpose. 
     */ 
</span>    <a href="../../src/include/utils/guc.h.html#LN279"><span class='Ref_to_Proto'>DefineCustomBoolVariable</span></a><span class='Parentheses'>(</span><span class='String'>"sepgsql.debug_audit"</span><span class='Delimiter'>, 
</span>                             <span class='String'>"Turn on/off debug audit messages"</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="hooks.c.html#LN72"><span class='Ref_to_Global_Var'>sepgsql_debug_audit</span></a><span class='Delimiter'>, 
</span>                             <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN75"><span class='Ref_to_EnumConst'>PGC_USERSET</span></a><span class='Delimiter'>, 
</span>                             <a href="../../src/include/utils/guc.h.html#LN208"><span class='Ref_to_Const'>GUC_NOT_IN_SAMPLE</span></a><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                             <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize userspace access vector cache */ 
</span>    <a href="sepgsql.h.html#LN266"><span class='Ref_to_Proto'>sepgsql_avc_init</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize security label of the client and related stuff */ 
</span>    <a href="sepgsql.h.html#LN272"><span class='Ref_to_Proto'>sepgsql_init_client_label</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Security label provider hook */ 
</span>    <a href="../../src/include/commands/seclabel.h.html#LN30"><span class='Ref_to_Proto'>register_label_provider</span></a><span class='Parentheses'>(</span><a href="sepgsql.h.html#LN22"><span class='Ref_to_Const'>SEPGSQL_LABEL_TAG</span></a><span class='Delimiter'>, 
</span>                            <a href="sepgsql.h.html#LN275"><span class='Ref_to_Proto'>sepgsql_object_relabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Object access hook */ 
</span>    <a href="hooks.c.html#LN38"><span class='Ref_to_Global_Var'>next_object_access_hook</span></a> <span class='Operator'>= </span><a href="../../src/backend/catalog/objectaccess.c.html#LN20"><span class='Ref_to_Global_Var'>object_access_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/catalog/objectaccess.c.html#LN20"><span class='Ref_to_Global_Var'>object_access_hook</span></a> <span class='Operator'>= </span><a href="hooks.c.html#LN86"><span class='Ref_to_Func'>sepgsql_object_access</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* DML permission check */ 
</span>    <a href="hooks.c.html#LN39"><span class='Ref_to_Global_Var'>next_exec_check_perms_hook</span></a> <span class='Operator'>= </span><a href="../../src/backend/executor/execMain.c.html#LN74"><span class='Ref_to_Global_Var'>ExecutorCheckPerms_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/executor/execMain.c.html#LN74"><span class='Ref_to_Global_Var'>ExecutorCheckPerms_hook</span></a> <span class='Operator'>= </span><a href="hooks.c.html#LN276"><span class='Ref_to_Func'>sepgsql_exec_check_perms</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ProcessUtility hook */ 
</span>    <a href="hooks.c.html#LN40"><span class='Ref_to_Global_Var'>next_ProcessUtility_hook</span></a> <span class='Operator'>= </span><a href="../../src/backend/tcop/utility.c.html#LN72"><span class='Ref_to_Global_Var'>ProcessUtility_hook</span></a><span class='Delimiter'>; 
</span>    <a href="../../src/backend/tcop/utility.c.html#LN72"><span class='Ref_to_Global_Var'>ProcessUtility_hook</span></a> <span class='Operator'>= </span><a href="hooks.c.html#LN299"><span class='Ref_to_Func'>sepgsql_utility_command</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* init contextual info */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="hooks.c.html#LN56"><span class='Ref_to_Global_Var'>sepgsql_context_info</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _PG_init &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>