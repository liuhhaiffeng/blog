<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\brin\brin_minmax.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\brin\brin_minmax.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:27 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 * brin_minmax.c 
 *      Implementation of Min/Max opclass for BRIN 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/access/brin/brin_minmax.c 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/brin_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/brin_tuple.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/stratnum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_amop.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<a name="LN25"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>MinmaxOpaque</span> 
<span class='Delimiter'>{ 
</span><a name="LN27"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>cached_subtype</span><span class='Delimiter'>; 
</span><a name="LN28"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>strategy_procinfos</span><span class='Delimiter'>[</span><a href="../../../include/access/stratnum.h.html#LN34"><span class='Ref_to_Const'>BTMaxStrategyNumber</span></a><span class='Delimiter'>]; 
</span><a name="LN29"></a>} <span class='Declare_Typedef'>MinmaxOpaque</span><span class='Delimiter'>; 
</span> 
<a name="LN31"></a><span class='Keyword'>static </span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>minmax_get_strategy_procinfo</span><span class='Parentheses'>(</span><a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bdesc</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>attno</span><span class='Delimiter'>, 
</span><a name="LN32"></a>                             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>strategynum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN36"></a><span class='Declare_Function'>brin_minmax_opcinfo</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN38"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a>    <a href="../../../include/access/brin_internal.h.html#LN24"><span class='Ref_to_Struct'>BrinOpcInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * opaque-&GT;strategy_procinfos is initialized lazily; here it is set to 
     * all-uninitialized by palloc0 which sets fn_oid to InvalidOid. 
     */ 
</span> 
    <a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="../../../include/access/brin_internal.h.html#LN37"><span class='Ref_to_Macro'>SizeofBrinOpcInfo</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> <span class='Operator'>+ 
</span>                     <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN25"><span class='Ref_to_Struct'>MinmaxOpaque</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN27"><span class='Ref_to_Member'>oi_nstored</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN30"><span class='Ref_to_Member'>oi_opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN25"><span class='Ref_to_Struct'>MinmaxOpaque</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+ </span><a href="../../../include/access/brin_internal.h.html#LN37"><span class='Ref_to_Macro'>SizeofBrinOpcInfo</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN33"><span class='Ref_to_Member'>oi_typcache</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN33"><span class='Ref_to_Member'>oi_typcache</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN38"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN39"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end brin_minmax_opcinfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Examine the given index tuple (which contains partial status of a certain 
 * page range) by comparing it to the given value that comes from another heap 
 * tuple.  If the new value is outside the min/max range specified by the 
 * existing tuple values, update the index tuple and return true.  Otherwise, 
 * return false and do not modify in this case. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN65"></a><span class='Declare_Function'>brin_minmax_add_value</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN67"></a>    <a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>bdesc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a>    <a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN69"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colloid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN72"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cmpFn</span><span class='Delimiter'>; 
</span><a name="LN73"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>compar</span><span class='Delimiter'>; 
</span><a name="LN74"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>updated</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN75"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN76"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the new value is null, we record that we saw it if it's the first 
     * one; otherwise, there's nothing to do. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN70"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN26"><span class='Ref_to_Member'>bv_hasnulls</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN26"><span class='Ref_to_Member'>bv_hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="brin_minmax.c.html#LN76"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN25"><span class='Ref_to_Member'>bv_attno</span></a><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN67"><span class='Ref_To_Local'>bdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN49"><span class='Ref_to_Member'>bd_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN76"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the recorded value is null, store the new value (which we know to be 
     * not null) as both minimum and maximum, and we're done. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN69"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN69"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, need to compare the new value with the existing boundaries 
     * and update them accordingly.  First check if it's less than the 
     * existing minimum. 
     */ 
</span>    <a href="brin_minmax.c.html#LN72"><span class='Ref_To_Local'>cmpFn</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN67"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN76"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN73"><span class='Ref_To_Local'>compar</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN72"><span class='Ref_To_Local'>cmpFn</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN71"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN69"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN73"><span class='Ref_To_Local'>compar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN69"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN74"><span class='Ref_To_Local'>updated</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And now compare it to the existing maximum. 
     */ 
</span>    <a href="brin_minmax.c.html#LN72"><span class='Ref_To_Local'>cmpFn</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN67"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN76"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN73"><span class='Ref_To_Local'>compar</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN72"><span class='Ref_To_Local'>cmpFn</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN71"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN69"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN73"><span class='Ref_To_Local'>compar</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN68"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN69"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN75"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN74"><span class='Ref_To_Local'>updated</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN74"><span class='Ref_To_Local'>updated</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end brin_minmax_add_value &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given an index tuple corresponding to a certain page range and a scan key, 
 * return whether the scan key is consistent with the index tuple's min/max 
 * values.  Return true if so, false otherwise. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN145"></a><span class='Declare_Function'>brin_minmax_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN147"></a>    <a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>bdesc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN148"></a>    <a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Declare_Local'>column</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN149"></a>    <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>key</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colloid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span><a name="LN151"></a>                <span class='Declare_Local'>subtype</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span><a name="LN153"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN154"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>matches</span><span class='Delimiter'>; 
</span><a name="LN155"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>finfo</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>== </span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN25"><span class='Ref_to_Member'>bv_attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* handle IS NULL/IS NOT NULL tests */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN120"><span class='Ref_to_Const'>SK_SEARCHNULL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a> <span class='Operator'>|| </span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN26"><span class='Ref_to_Member'>bv_hasnulls</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For IS NOT NULL, we can only skip ranges that are known to have 
         * only nulls. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN121"><span class='Ref_to_Const'>SK_SEARCHNOTNULL</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Neither IS NULL nor IS NOT NULL was used; assume all indexable 
         * operators are strict and return false. 
         */ 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if key-&GT;sk_flags&SK_ISNU... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* if the range is all empty, it cannot possibly be consistent */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="brin_minmax.c.html#LN152"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN151"><span class='Ref_To_Local'>subtype</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Delimiter'>; 
</span>    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN147"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN152"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN151"><span class='Ref_To_Local'>subtype</span></a><span class='Delimiter'>, 
</span>                                                 <a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN150"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                        <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In the equality case (WHERE col = someval), we want to return 
             * the current page range if the minimum value in the range &LT;= 
             * scan key, and the maximum value &GT;= scan key. 
             */ 
</span>            <a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN147"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN152"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN151"><span class='Ref_To_Local'>subtype</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN150"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                        <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* max() &GT;= scankey */ 
</span>            <a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN147"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN152"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN151"><span class='Ref_To_Local'>subtype</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN150"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                        <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN147"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN152"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN151"><span class='Ref_To_Local'>subtype</span></a><span class='Delimiter'>, 
</span>                                                 <a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN155"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN150"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN148"><span class='Ref_To_Local'>column</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                        <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* shouldn't happen */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid strategy number %d"</span><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN149"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch key-&GT;sk_strategy &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN154"><span class='Ref_To_Local'>matches</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end brin_minmax_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given two BrinValues, update the first of them as a union of the summary 
 * values contained in both.  The second one is untouched. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN240"></a><span class='Declare_Function'>brin_minmax_union</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN242"></a>    <a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>bdesc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN243"></a>    <a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Declare_Local'>col_a</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Declare_Local'>col_b</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/brin_tuple.h.html#LN23"><span class='Ref_to_Struct'>BrinValues</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN245"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>colloid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN246"></a>    <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span><a name="LN247"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>finfo</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needsadj</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN25"><span class='Ref_to_Member'>bv_attno</span></a> <span class='Operator'>== </span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN25"><span class='Ref_to_Member'>bv_attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust "hasnulls" */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN26"><span class='Ref_to_Member'>bv_hasnulls</span></a> <span class='Operator'>&& </span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN26"><span class='Ref_to_Member'>bv_hasnulls</span></a><span class='Parentheses'>) 
</span>        <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN26"><span class='Ref_to_Member'>bv_hasnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there are no values in B, there's nothing left to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="brin_minmax.c.html#LN246"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN25"><span class='Ref_to_Member'>bv_attno</span></a><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN242"><span class='Ref_To_Local'>bdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN49"><span class='Ref_to_Member'>bd_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN246"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Adjust "allnulls".  If A doesn't have values, just copy the values from 
     * B into A, and we're done.  We cannot run the operators in this case, 
     * because values in A might contain garbage.  Note we already established 
     * that B contains values. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN27"><span class='Ref_to_Member'>bv_allnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                        <a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                        <a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust minimum, if B's min is less than A's min */ 
</span>    <a href="brin_minmax.c.html#LN248"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN242"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN246"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN249"><span class='Ref_To_Local'>needsadj</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN248"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN245"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                 <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN249"><span class='Ref_To_Local'>needsadj</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                        <a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust maximum, if B's max is greater than A's max */ 
</span>    <a href="brin_minmax.c.html#LN248"><span class='Ref_To_Local'>finfo</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN31"><span class='Ref_to_Proto'>minmax_get_strategy_procinfo</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN242"><span class='Ref_To_Local'>bdesc</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN246"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="brin_minmax.c.html#LN249"><span class='Ref_To_Local'>needsadj</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN248"><span class='Ref_To_Local'>finfo</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN245"><span class='Ref_To_Local'>colloid</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                 <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN249"><span class='Ref_To_Local'>needsadj</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN243"><span class='Ref_To_Local'>col_a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN244"><span class='Ref_To_Local'>col_b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_tuple.h.html#LN28"><span class='Ref_to_Member'>bv_values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                        <a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN247"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end brin_minmax_union &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Cache and return the procedure for the given strategy. 
 * 
 * Note: this function mirrors inclusion_get_strategy_procinfo; see notes 
 * there.  If changes are made here, see that function too. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>* 
</span><a name="LN316"></a><span class='Declare_Function'>minmax_get_strategy_procinfo</span><span class='Parentheses'>(</span><a href="../../../include/access/brin_internal.h.html#LN40"><span class='Ref_to_Struct'>BrinDesc</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bdesc</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>attno</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subtype</span><span class='Delimiter'>, 
</span><a name="LN317"></a>                             <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>strategynum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN319"></a>    <a href="brin_minmax.c.html#LN25"><span class='Ref_to_Struct'>MinmaxOpaque</span></a> <span class='Operator'>*</span><span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>           <a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/access/stratnum.h.html#LN34"><span class='Ref_to_Const'>BTMaxStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN25"><span class='Ref_to_Struct'>MinmaxOpaque</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN58"><span class='Ref_to_Member'>bd_info</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN30"><span class='Ref_to_Member'>oi_opaque</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We cache the procedures for the previous subtype in the opaque struct, 
     * to avoid repetitive syscache lookups.  If the subtype changed, 
     * invalidate all the cached entries. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="brin_minmax.c.html#LN27"><span class='Ref_to_Member'>cached_subtype</span></a> <span class='Operator'>!= </span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>subtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN333"></a>        <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN333"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="brin_minmax.c.html#LN333"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/access/stratnum.h.html#LN34"><span class='Ref_to_Const'>BTMaxStrategyNumber</span></a><span class='Delimiter'>; </span><a href="brin_minmax.c.html#LN333"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="brin_minmax.c.html#LN28"><span class='Ref_to_Member'>strategy_procinfos</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN333"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="brin_minmax.c.html#LN27"><span class='Ref_to_Member'>cached_subtype</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="brin_minmax.c.html#LN28"><span class='Ref_to_Member'>strategy_procinfos</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN342"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN343"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN344"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>opfamily</span><span class='Delimiter'>, 
</span><a name="LN345"></a>                    <span class='Declare_Local'>oprid</span><span class='Delimiter'>; 
</span><a name="LN346"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="brin_minmax.c.html#LN344"><span class='Ref_To_Local'>opfamily</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN46"><span class='Ref_to_Member'>bd_index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="brin_minmax.c.html#LN342"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN49"><span class='Ref_to_Member'>bd_tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="brin_minmax.c.html#LN343"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN161"><span class='Ref_to_Macro'>SearchSysCache4</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN37"><span class='Ref_to_EnumConst'>AMOPSTRATEGY</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN344"><span class='Ref_To_Local'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN342"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN343"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"missing operator %d(%u,%u) in opfamily %u"</span><span class='Delimiter'>, 
</span>                 <a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN342"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>subtype</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN344"><span class='Ref_To_Local'>opfamily</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="brin_minmax.c.html#LN345"><span class='Ref_To_Local'>oprid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN37"><span class='Ref_to_EnumConst'>AMOPSTRATEGY</span></a><span class='Delimiter'>, </span><a href="brin_minmax.c.html#LN343"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/catalog/pg_amop.h.html#LN88"><span class='Ref_to_Const'>Anum_pg_amop_amopopr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="brin_minmax.c.html#LN346"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN343"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="brin_minmax.c.html#LN346"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>&& </span><a href="../../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN345"><span class='Ref_To_Local'>oprid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="brin_minmax.c.html#LN345"><span class='Ref_To_Local'>oprid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="brin_minmax.c.html#LN28"><span class='Ref_to_Member'>strategy_procinfos</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                      <a href="brin_minmax.c.html#LN316"><span class='Ref_to_Parameter'>bdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/brin_internal.h.html#LN43"><span class='Ref_to_Member'>bd_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if opaque-&GT;strategy_proc... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Operator'>&</span><a href="brin_minmax.c.html#LN319"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="brin_minmax.c.html#LN28"><span class='Ref_to_Member'>strategy_procinfos</span></a><span class='Delimiter'>[</span><a href="brin_minmax.c.html#LN317"><span class='Ref_to_Parameter'>strategynum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
}</span><span class='Auto_Annotations'> &laquo; end minmax_get_strategy_procinfo &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>