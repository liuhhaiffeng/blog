<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\common\heaptuple.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\common\heaptuple.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:27 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * heaptuple.c 
 *    This file contains heap tuple accessor and mutator routines, as well 
 *    as various tuple utilities. 
 * 
 * Some notes about varlenas and this code: 
 * 
 * Before Postgres 8.3 varlenas always had a 4-byte length header, and 
 * therefore always needed 4-byte alignment (at least).  This wasted space 
 * for short varlenas, for example CHAR(1) took 5 bytes and could need up to 
 * 3 additional padding bytes for alignment. 
 * 
 * Now, a short varlena (up to 126 data bytes) is reduced to a 1-byte header 
 * and we don't align it.  To hide this from datatype-specific functions that 
 * don't want to deal with it, such a datum is considered "toasted" and will 
 * be expanded back to the normal 4-byte-header format by pg_detoast_datum. 
 * (In performance-critical code paths we can use pg_detoast_datum_packed 
 * and the appropriate access macros to avoid that overhead.)  Note that this 
 * conversion is performed directly in heap_form_tuple, without invoking 
 * tuptoaster.c. 
 * 
 * This change will break any code that assumes it needn't detoast values 
 * that have been put into a tuple but never sent to disk.  Hopefully there 
 * are few such places. 
 * 
 * Varlenas still have alignment 'i' (or 'd') in pg_type/pg_attribute, since 
 * that's the normal requirement for the untoasted format.  But we ignore that 
 * for the 1-byte-header format.  This means that the actual start position 
 * of a varlena datum may vary depending on which format it has.  To determine 
 * what is stored, we have to require that alignment padding bytes be zero. 
 * (Postgres actually has always zeroed them, but now it's required!)  Since 
 * the first byte of a 1-byte-header varlena can never be zero, we can examine 
 * the first byte after the previous datum to tell if it's a pad byte or the 
 * start of a 1-byte-header varlena. 
 * 
 * Note that while formerly we could rely on the first varlena column of a 
 * system catalog to be at the offset suggested by the C struct for the 
 * catalog, this is now risky: it's only safe if the preceding field is 
 * word-aligned, so that there will never be any padding. 
 * 
 * We don't pack varlenas whose attstorage is 'p', since the data type 
 * isn't expecting to have to detoast values.  This is used in particular 
 * by oidvector and int2vector, which are used in the system catalogs 
 * and we'd like to still refer to them via C struct offsets. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/access/common/heaptuple.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tuptoaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/tuptable.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/expandeddatum.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Does att's datatype allow packing into the 1-byte-header varlena format? */ 
</span><a name="LN66"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ATT_IS_PACKABLE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>att</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="heaptuple.c.html#LN66"><span class='Ref_to_Parameter'>att</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN66"><span class='Ref_to_Parameter'>att</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>attstorage <span class='Operator'>!= </span><span class='String'>'p'</span><span class='Parentheses'>)</span> 
<span class='Comment_Multi_Line'>/* Use this if it's already known varlena */ 
</span><a name="LN69"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>VARLENA_ATT_IS_PACKABLE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>att</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="heaptuple.c.html#LN69"><span class='Ref_to_Parameter'>att</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>attstorage <span class='Operator'>!= </span><span class='String'>'p'</span><span class='Parentheses'>)</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *                      misc support routines 
 * ---------------------------------------------------------------- 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_compute_data_size 
 *      Determine size of the data area of a tuple to be constructed 
 */ 
</span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> 
<a name="LN84"></a><span class='Declare_Function'>heap_compute_data_size</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Delimiter'>, 
</span><a name="LN85"></a>                       <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN86"></a>                       <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN88"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>data_length</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN89"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN90"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN84"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN91"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN84"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN89"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN89"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN90"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN89"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN95"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN96"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>atti</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN86"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN89"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN85"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN89"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN91"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN89"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN66"><span class='Ref_to_Macro'>ATT_IS_PACKABLE</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="../../../include/postgres.h.html#LN270"><span class='Ref_to_Macro'>VARATT_CAN_MAKE_SHORT</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * we're anticipating converting to a short varlena header, so 
             * adjust length and don't count any alignment 
             */ 
</span>            <a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>+= </span><a href="../../../include/postgres.h.html#LN273"><span class='Ref_to_Macro'>VARATT_CONVERTED_SHORT_SIZE</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                 <a href="../../../include/postgres.h.html#LN322"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * we want to flatten the expanded value so that the constructed 
             * tuple doesn't depend on it 
             */ 
</span>            <a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>+= </span><a href="../../utils/adt/expandeddatum.c.html#LN73"><span class='Ref_to_Func'>EOH_get_flat_size</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN100"><span class='Ref_to_Macro'>att_align_datum</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a><span class='Operator'>-&GT;</span>attalign<span class='Delimiter'>, 
</span>                                          <a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>, </span><a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN159"><span class='Ref_to_Macro'>att_addlength_datum</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN96"><span class='Ref_To_Local'>atti</span></a><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>, 
</span>                                              <a href="heaptuple.c.html#LN95"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numberOfAttribu... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="heaptuple.c.html#LN88"><span class='Ref_To_Local'>data_length</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_compute_data_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_fill_tuple 
 *      Load data portion of a tuple from values/isnull arrays 
 * 
 * We also fill the null bitmap (if any) and set the infomask bits 
 * that reflect the tuple's data contents. 
 * 
 * NOTE: it is now REQUIRED that the caller have pre-zeroed the data area. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN145"></a><span class='Declare_Function'>heap_fill_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Delimiter'>, 
</span><a name="LN146"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>data_size</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>infomask</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN150"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitP</span><span class='Delimiter'>; 
</span><a name="LN151"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN153"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN145"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN154"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN145"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_ASSERT_CHECKING 
<a name="LN157"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>bit</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="heaptuple.c.html#LN150"><span class='Ref_To_Local'>bitP</span></a> <span class='Operator'>= &</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>bit</span></a><span class='Delimiter'>[</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="heaptuple.c.html#LN151"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN971"><span class='Ref_to_Const'>HIGHBIT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* just to keep compiler quiet */ 
</span>        <a href="heaptuple.c.html#LN150"><span class='Ref_To_Local'>bitP</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN151"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>infomask</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN174"><span class='Ref_to_Const'>HEAP_HASNULL</span></a> <span class='Operator'>| </span><a href="../../../include/access/htup_details.h.html#LN175"><span class='Ref_to_Const'>HEAP_HASVARWIDTH</span></a> <span class='Operator'>| </span><a href="../../../include/access/htup_details.h.html#LN176"><span class='Ref_to_Const'>HEAP_HASEXTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN153"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN176"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>data_length</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>bit</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN151"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>!= </span><a href="../../../include/c.h.html#LN971"><span class='Ref_to_Const'>HIGHBIT</span></a><span class='Parentheses'>) 
</span>                <a href="heaptuple.c.html#LN151"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="heaptuple.c.html#LN150"><span class='Ref_To_Local'>bitP</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="heaptuple.c.html#LN150"><span class='Ref_To_Local'>bitP</span></a> <span class='Operator'>= </span><span class='Number'>0x0</span><span class='Delimiter'>; 
</span>                <a href="heaptuple.c.html#LN151"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>infomask</span></a> <span class='Operator'>|= </span><a href="../../../include/access/htup_details.h.html#LN174"><span class='Ref_to_Const'>HEAP_HASNULL</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Operator'>*</span><a href="heaptuple.c.html#LN150"><span class='Ref_To_Local'>bitP</span></a> <span class='Operator'>|= </span><a href="heaptuple.c.html#LN151"><span class='Ref_To_Local'>bitmask</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * XXX we use the att_align macros on the pointer value itself, not on 
         * an offset.  This is a bit of a hack. 
         */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attbyval<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* pass-by-value */ 
</span>            <a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/tupmacs.h.html#LN197"><span class='Ref_to_Macro'>store_att_byval</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* varlena */ 
</span><a name="LN213"></a>            <a href="../../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a>     <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>infomask</span></a> <span class='Operator'>|= </span><a href="../../../include/access/htup_details.h.html#LN175"><span class='Ref_to_Const'>HEAP_HASVARWIDTH</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN313"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN322"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL_EXPANDED</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * we want to flatten the expanded value so that the 
                     * constructed tuple doesn't depend on it 
                     */ 
</span><a name="LN224"></a>                    <a href="../../../include/utils/expandeddatum.h.html#LN97"><span class='Ref_to_Struct'>ExpandedObjectHeader</span></a> <span class='Operator'>*</span><span class='Declare_Local'>eoh</span> <span class='Operator'>= </span><a href="../../utils/adt/expandeddatum.c.html#LN27"><span class='Ref_to_Func'>DatumGetEOHP</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, 
</span>                                                      <a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../utils/adt/expandeddatum.c.html#LN73"><span class='Ref_to_Func'>EOH_get_flat_size</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN224"><span class='Ref_To_Local'>eoh</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../utils/adt/expandeddatum.c.html#LN79"><span class='Ref_to_Func'>EOH_flatten_into</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN224"><span class='Ref_To_Local'>eoh</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>infomask</span></a> <span class='Operator'>|= </span><a href="../../../include/access/htup_details.h.html#LN176"><span class='Ref_to_Const'>HEAP_HASEXTERNAL</span></a><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* no alignment, since it's short by definition */ 
</span>                    <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN309"><span class='Ref_to_Macro'>VARSIZE_EXTERNAL</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if VARATT_IS_EXTERNAL(va... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN324"><span class='Ref_to_Macro'>VARATT_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* no alignment for short varlenas */ 
</span>                <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN305"><span class='Ref_to_Macro'>VARSIZE_SHORT</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN69"><span class='Ref_to_Macro'>VARLENA_ATT_IS_PACKABLE</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                     <a href="../../../include/postgres.h.html#LN270"><span class='Ref_to_Macro'>VARATT_CAN_MAKE_SHORT</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* convert to short varlena -- no alignment */ 
</span>                <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN273"><span class='Ref_to_Macro'>VARATT_CONVERTED_SHORT_SIZE</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/postgres.h.html#LN328"><span class='Ref_to_Macro'>SET_VARSIZE_SHORT</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* full 4-byte header varlena */ 
</span>                <a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, 
</span>                                                  <a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN213"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if att[i]-&GT;attlen==-1 &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* cstring ... never needs alignment */ 
</span>            <span class='Operator'>*</span><a href="heaptuple.c.html#LN148"><span class='Ref_to_Parameter'>infomask</span></a> <span class='Operator'>|= </span><a href="../../../include/access/htup_details.h.html#LN175"><span class='Ref_to_Const'>HEAP_HASVARWIDTH</span></a><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign <span class='Operator'>== </span><span class='String'>'c'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fixed-length pass-by-reference */ 
</span>            <a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN154"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN146"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN152"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>+= </span><a href="heaptuple.c.html#LN176"><span class='Ref_To_Local'>data_length</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numberOfAttribu... &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>- </span><a href="heaptuple.c.html#LN157"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="heaptuple.c.html#LN147"><span class='Ref_to_Parameter'>data_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_fill_tuple &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *                      heap tuple interface 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      heap_attisnull  - returns TRUE iff tuple attribute is not present 
 * ---------------- 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN296"></a><span class='Declare_Function'>heap_attisnull</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN531"><span class='Ref_to_Macro'>HeapTupleHeaderGetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN664"><span class='Ref_to_Macro'>HeapTupleNoNulls</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/access/tupmacs.h.html#LN20"><span class='Ref_to_Macro'>att_isnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN162"><span class='Ref_to_Member'>t_bits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN26"><span class='Ref_to_Const'>TableOidAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN20"><span class='Ref_to_Const'>SelfItemPointerAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN22"><span class='Ref_to_Const'>MinTransactionIdAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN23"><span class='Ref_to_Const'>MinCommandIdAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN24"><span class='Ref_to_Const'>MaxTransactionIdAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN25"><span class='Ref_to_Const'>MaxCommandIdAttributeNumber</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* these are never null */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid attnum: %d"</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN296"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_attisnull &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      nocachegetattr 
 * 
 *      This only gets called from fastgetattr() macro, in cases where 
 *      we can't use a cacheoffset and the value is not null. 
 * 
 *      This caches attribute offsets in the attribute descriptor. 
 * 
 *      An alternative way to speed things up would be to cache offsets 
 *      with the tuple, but that seems more difficult unless you take 
 *      the storage hit of actually putting those offsets into the 
 *      tuple you send to disk.  Yuck. 
 * 
 *      This scheme will be slightly slower than that, but should 
 *      perform well for queries which hit large #'s of tuples.  After 
 *      you cache the offsets once, examining all the other tuples using 
 *      the same attribute descriptor will go much quicker. -cim 5/4/91 
 * 
 *      NOTE: if you need to change this code, see also heap_deform_tuple. 
 *      Also see nocache_index_getattr, which is the same code for index 
 *      tuples. 
 * ---------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN351"></a><span class='Declare_Function'>nocachegetattr</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN352"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN353"></a>               <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN355"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tup</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN351"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span><a name="LN356"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN353"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span><a name="LN357"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* ptr to data part of tuple */ 
</span><a name="LN358"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bp</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN355"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN162"><span class='Ref_to_Member'>t_bits</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ptr to null bitmap in tuple */ 
</span><a name="LN359"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>slow</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* do we have to walk attrs? */ 
</span><a name="LN360"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>off</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* current offset within data */ 
</span> 
    <span class='Comment_Multi_Line'>/* ---------------- 
     *   Three cases: 
     * 
     *   1: No nulls and no variable-width attributes. 
     *   2: Has a null or a var-width AFTER att. 
     *   3: Has nulls or var-widths BEFORE att. 
     * ---------------- 
     */ 
</span> 
    <a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup_details.h.html#LN664"><span class='Ref_to_Macro'>HeapTupleNoNulls</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN351"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * there's a null somewhere in the tuple 
         * 
         * check to see if any preceding bits are null... 
         */ 
</span><a name="LN380"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>byte</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>3</span><span class='Delimiter'>; 
</span><a name="LN381"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>finalbit</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>& </span><span class='Number'>0x07</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check for nulls "before" final bit of last byte */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>~</span><a href="heaptuple.c.html#LN358"><span class='Ref_To_Local'>bp</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN380"><span class='Ref_To_Local'>byte</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Parentheses'>((</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="heaptuple.c.html#LN381"><span class='Ref_To_Local'>finalbit</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="heaptuple.c.html#LN359"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* check for nulls in any "earlier" bytes */ 
</span><a name="LN389"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN389"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN389"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN380"><span class='Ref_To_Local'>byte</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN389"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN358"><span class='Ref_To_Local'>bp</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN389"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0xFF</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="heaptuple.c.html#LN359"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleNoNulls(tup... &raquo; </span> 
 
    <a href="heaptuple.c.html#LN357"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN355"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN355"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN158"><span class='Ref_to_Member'>t_hoff</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN359"><span class='Ref_To_Local'>slow</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we get here, there are no nulls up to and including the target 
         * attribute.  If we have a cached offset, we can use it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>return</span> <a href="../../../include/access/tupmacs.h.html#LN36"><span class='Ref_to_Macro'>fetchatt</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>], 
</span>                            <a href="heaptuple.c.html#LN357"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Otherwise, check for non-fixed-length attrs up to and including 
         * target.  If there aren't any, it's safe to cheaply initialize the 
         * cached offsets for these attrs. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN667"><span class='Ref_to_Macro'>HeapTupleHasVarWidth</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN351"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN423"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN423"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN423"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT;= </span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN423"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN423"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="heaptuple.c.html#LN359"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !slow &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN359"><span class='Ref_To_Local'>slow</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN438"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN353"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN439"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we get here, we have a tuple with no nulls or var-widths up to 
         * and including the target attribute, so we can use the cached offset 
         * ... only we don't have it yet, or we'd not have got here.  Since 
         * it's cheap to compute offsets for fixed-width columns, we take the 
         * opportunity to initialize the cached offsets for *all* the leading 
         * fixed-width columns, in hope of avoiding future visits to this 
         * routine. 
         */ 
</span>        <a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* we might have set some offsets in the slow path previously */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN438"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>&& </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>+ </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN438"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span> 
            <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>+= </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN439"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&GT; </span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !slow &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN476"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>usecache</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN477"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now we know that we have to walk the tuple CAREFULLY.  But we still 
         * might be able to cache some offsets for next time. 
         * 
         * Note - This loop is a little tricky.  For each non-null attribute, 
         * we have to first account for alignment padding before the attr, 
         * then advance over the attr based on its length.  Nulls have no 
         * storage and no alignment padding either.  We can use/set 
         * attcacheoff until we reach either a null or a var-width attribute. 
         */ 
</span>        <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;; </span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* loop exit is at "break" */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN661"><span class='Ref_to_Macro'>HeapTupleHasNulls</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN351"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/access/tupmacs.h.html#LN20"><span class='Ref_to_Macro'>att_isnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN358"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* this cannot be the target att */ 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* If we know the next offset, we can skip the rest */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a> <span class='Operator'>&& </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff<span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We can only cache the offset for a varlena attribute if the 
                 * offset is already suitably aligned, so that there would be 
                 * no pad bytes in any case: then the offset will be valid for 
                 * either an aligned or unaligned value. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a> <span class='Operator'>&& 
</span>                    <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>== </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>))</span> 
                    <a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN121"><span class='Ref_to_Macro'>att_align_pointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                            <a href="heaptuple.c.html#LN357"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* not varlena, so safe to use att_align_nominal */ 
</span>                <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a><span class='Parentheses'>) 
</span>                    <a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>, </span><a href="heaptuple.c.html#LN357"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a> <span class='Operator'>&& </span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN477"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attlen <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="heaptuple.c.html#LN476"><span class='Ref_To_Local'>usecache</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="../../../include/access/tupmacs.h.html#LN36"><span class='Ref_to_Macro'>fetchatt</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN356"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN352"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>], </span><a href="heaptuple.c.html#LN357"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN360"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end nocachegetattr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      heap_getsysattr 
 * 
 *      Fetch the value of a system attribute for a tuple. 
 * 
 * This is a support routine for the heap_getattr macro.  The macro 
 * has already determined that the attnum refers to a system attribute. 
 * ---------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN551"></a><span class='Declare_Function'>heap_getsysattr</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN553"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Currently, no sys attribute ever reads as NULL. */ 
</span>    <span class='Operator'>*</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN20"><span class='Ref_to_Const'>SelfItemPointerAttributeNumber</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* pass-by-reference datatype */ 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Operator'>: 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN22"><span class='Ref_to_Const'>MinTransactionIdAttributeNumber</span></a><span class='Operator'>: 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN526"><span class='Ref_to_Macro'>TransactionIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN301"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmin</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN24"><span class='Ref_to_Const'>MaxTransactionIdAttributeNumber</span></a><span class='Operator'>: 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN526"><span class='Ref_to_Macro'>TransactionIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN368"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawXmax</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN23"><span class='Ref_to_Const'>MinCommandIdAttributeNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN25"><span class='Ref_to_Const'>MaxCommandIdAttributeNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * cmin and cmax are now both aliases for the same field, which 
             * can in fact also be a combo command id.  XXX perhaps we should 
             * return the "real" cmin or cmax if possible, that is if we are 
             * inside the originating transaction? 
             */ 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN547"><span class='Ref_to_Macro'>CommandIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN384"><span class='Ref_to_Macro'>HeapTupleHeaderGetRawCommandId</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/sysattr.h.html#LN26"><span class='Ref_to_Const'>TableOidAttributeNumber</span></a><span class='Operator'>: 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid attnum: %d"</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN551"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch attnum &raquo; </span> 
    <span class='Control'>return</span> <a href="heaptuple.c.html#LN553"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_getsysattr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      heap_copytuple 
 * 
 *      returns a copy of an entire tuple 
 * 
 * The HeapTuple struct, tuple header, and tuple data are all allocated 
 * as a single palloc() block. 
 * ---------------- 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN607"></a><span class='Declare_Function'>heap_copytuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN609"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newTuple</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN607"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="heaptuple.c.html#LN609"><span class='Ref_To_Local'>newTuple</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      heap_copytuple_with_tuple 
 * 
 *      copy a tuple into a caller-supplied HeapTuple management struct 
 * 
 * Note that after calling this function, the "dest" HeapTuple will not be 
 * allocated as a single palloc() block (unlike with heap_copytuple()). 
 * ---------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN633"></a><span class='Declare_Function'>heap_copytuple_with_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN633"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      heap_copy_tuple_as_datum 
 * 
 *      copy a tuple as a composite-type Datum 
 * ---------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN655"></a><span class='Declare_Function'>heap_copy_tuple_as_datum</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN657"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the tuple contains any external TOAST pointers, we have to inline 
     * those fields to meet the conventions for composite-type Datums. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN673"><span class='Ref_to_Macro'>HeapTupleHasExternal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/access/tuptoaster.h.html#LN191"><span class='Ref_to_Proto'>toast_flatten_tuple_to_datum</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, 
</span>                                            <a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>, 
</span>                                            <a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fast path for easy case: just make a palloc'd copy and insert the 
     * correct composite-Datum header fields (since those may not be set if 
     * the given tuple came from disk, rather than from heap_form_tuple). 
     */ 
</span>    <a href="heaptuple.c.html#LN657"><span class='Ref_To_Local'>td</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN657"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/htup_details.h.html#LN441"><span class='Ref_to_Macro'>HeapTupleHeaderSetDatumLength</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN657"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/htup_details.h.html#LN449"><span class='Ref_to_Macro'>HeapTupleHeaderSetTypeId</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN657"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/htup_details.h.html#LN459"><span class='Ref_to_Macro'>HeapTupleHeaderSetTypMod</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN657"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN655"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN657"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_copy_tuple_as_datum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_form_tuple 
 *      construct a tuple from the given values[] and isnull[] arrays, 
 *      which are of the length indicated by tupleDescriptor-&GT;natts 
 * 
 * The result is allocated in the current memory context. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN691"></a><span class='Declare_Function'>heap_form_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDescriptor</span><span class='Delimiter'>, 
</span><a name="LN692"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN693"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN695"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* return tuple */ 
</span><a name="LN696"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* tuple data */ 
</span><a name="LN697"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len</span><span class='Delimiter'>, 
</span><a name="LN698"></a>                <span class='Declare_Local'>data_len</span><span class='Delimiter'>; 
</span><a name="LN699"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hoff</span><span class='Delimiter'>; 
</span><a name="LN700"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnull</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN701"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN702"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN701"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>&GT; </span><a href="../../../include/access/htup_details.h.html#LN32"><span class='Ref_to_Const'>MaxTupleAttributeNumber</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of columns (%d) exceeds limit (%d)"</span><span class='Delimiter'>, 
</span>                        <a href="heaptuple.c.html#LN701"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN32"><span class='Ref_to_Const'>MaxTupleAttributeNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for nulls 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN702"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN702"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN701"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN702"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN693"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN702"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="heaptuple.c.html#LN700"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine total space needed 
     */ 
</span>    <a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN141"><span class='Ref_to_Struct'>HeapTupleHeaderData</span></a><span class='Delimiter'>, </span>t_bits<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN700"><span class='Ref_To_Local'>hasnull</span></a><span class='Parentheses'>) 
</span>        <a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="../../../include/access/htup_details.h.html#LN547"><span class='Ref_to_Macro'>BITMAPLEN</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN701"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>        <a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN699"><span class='Ref_To_Local'>hoff</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* align user data safely */ 
</span> 
    <a href="heaptuple.c.html#LN698"><span class='Ref_To_Local'>data_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN83"><span class='Ref_to_Func'>heap_compute_data_size</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN692"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN693"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="heaptuple.c.html#LN698"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate and zero the space needed.  Note that the tuple body and 
     * HeapTupleData management structure are allocated in one chunk. 
     */ 
</span>    <a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And fill in the information.  Note we fill the Datum fields even though 
     * this tuple may never become a Datum.  This lets HeapTupleHeaderGetDatum 
     * identify the tuple type if needed. 
     */ 
</span>    <a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/htup_details.h.html#LN441"><span class='Ref_to_Macro'>HeapTupleHeaderSetDatumLength</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN697"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/htup_details.h.html#LN449"><span class='Ref_to_Macro'>HeapTupleHeaderSetTypeId</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/htup_details.h.html#LN459"><span class='Ref_to_Macro'>HeapTupleHeaderSetTypMod</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* We also make sure that t_ctid is invalid unless explicitly set */ 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/htup_details.h.html#LN534"><span class='Ref_to_Macro'>HeapTupleHeaderSetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN701"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN158"><span class='Ref_to_Member'>t_hoff</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN699"><span class='Ref_To_Local'>hoff</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* else leave infomask = 0 */ 
</span>        <a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN177"><span class='Ref_to_Const'>HEAP_HASOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN144"><span class='Ref_to_Func'>heap_fill_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN691"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Delimiter'>, 
</span>                    <a href="heaptuple.c.html#LN692"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, 
</span>                    <a href="heaptuple.c.html#LN693"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN699"><span class='Ref_To_Local'>hoff</span></a><span class='Delimiter'>, 
</span>                    <a href="heaptuple.c.html#LN698"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN156"><span class='Ref_to_Member'>t_infomask</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN700"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>? </span><a href="heaptuple.c.html#LN696"><span class='Ref_To_Local'>td</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN162"><span class='Ref_to_Member'>t_bits</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="heaptuple.c.html#LN695"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_form_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_modify_tuple 
 *      form a new tuple from an old tuple and a set of replacement values. 
 * 
 * The replValues, replIsnull, and doReplace arrays must be of the length 
 * indicated by tupleDesc-&GT;natts.  The new tuple is constructed using the data 
 * from replValues/replIsnull at columns where doReplace is true, and using 
 * the data from the old tuple at columns where doReplace is false. 
 * 
 * The result is allocated in the current memory context. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN790"></a><span class='Declare_Function'>heap_modify_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN791"></a>                  <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Delimiter'>, 
</span><a name="LN792"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>replValues</span><span class='Delimiter'>, 
</span><a name="LN793"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>replIsnull</span><span class='Delimiter'>, 
</span><a name="LN794"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>doReplace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN796"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN791"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN797"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attoff</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN799"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newTuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate and fill values and isnull arrays from either the tuple or the 
     * repl information, as appropriate. 
     * 
     * NOTE: it's debatable whether to use heap_deform_tuple() here or just 
     * heap_getattr() only the non-replaced columns.  The latter could win if 
     * there are many replaced columns and few non-replaced ones. However, 
     * heap_deform_tuple costs only O(N) while the heap_getattr way would cost 
     * O(N^2) if there are many non-replaced columns, so it seems better to 
     * err on the side of linear cost. 
     */ 
</span>    <a href="heaptuple.c.html#LN798"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN796"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN799"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN796"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN790"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN791"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN798"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN799"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN796"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN794"><span class='Ref_to_Parameter'>doReplace</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="heaptuple.c.html#LN798"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="heaptuple.c.html#LN792"><span class='Ref_to_Parameter'>replValues</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a><span class='Delimiter'>]; 
</span>            <a href="heaptuple.c.html#LN799"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="heaptuple.c.html#LN793"><span class='Ref_to_Parameter'>replIsnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN797"><span class='Ref_To_Local'>attoff</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create a new tuple from the values and isnull arrays 
     */ 
</span>    <a href="heaptuple.c.html#LN800"><span class='Ref_To_Local'>newTuple</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN791"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN798"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN799"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN798"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN799"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * copy the identification info of the old tuple: t_ctid, t_self, and OID 
     * (if any) 
     */ 
</span>    <a href="heaptuple.c.html#LN800"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN790"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN800"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN790"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN800"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN790"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN791"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN800"><span class='Ref_To_Local'>newTuple</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN790"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="heaptuple.c.html#LN800"><span class='Ref_To_Local'>newTuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_modify_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_modify_tuple_by_cols 
 *      form a new tuple from an old tuple and a set of replacement values. 
 * 
 * This is like heap_modify_tuple, except that instead of specifying which 
 * column(s) to replace by a boolean map, an array of target column numbers 
 * is used.  This is often more convenient when a fixed number of columns 
 * are to be replaced.  The replCols, replValues, and replIsnull arrays must 
 * be of length nCols.  Target column numbers are indexed from 1. 
 * 
 * The result is allocated in the current memory context. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN861"></a><span class='Declare_Function'>heap_modify_tuple_by_cols</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN862"></a>                          <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Delimiter'>, 
</span><a name="LN863"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>nCols</span><span class='Delimiter'>, 
</span><a name="LN864"></a>                          <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>replCols</span><span class='Delimiter'>, 
</span><a name="LN865"></a>                          <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>replValues</span><span class='Delimiter'>, 
</span><a name="LN866"></a>                          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>replIsnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN868"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN862"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN869"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN870"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN871"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newTuple</span><span class='Delimiter'>; 
</span><a name="LN872"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate and fill values and isnull arrays from the tuple, then replace 
     * selected columns from the input arrays. 
     */ 
</span>    <a href="heaptuple.c.html#LN869"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN868"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN870"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN868"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN861"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN862"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN869"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN870"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN872"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN872"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN863"><span class='Ref_to_Parameter'>nCols</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN872"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN885"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN864"><span class='Ref_to_Parameter'>replCols</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN872"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN885"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="heaptuple.c.html#LN885"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&GT; </span><a href="heaptuple.c.html#LN868"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid column number %d"</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN885"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN869"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN885"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="heaptuple.c.html#LN865"><span class='Ref_to_Parameter'>replValues</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN872"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="heaptuple.c.html#LN870"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN885"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="heaptuple.c.html#LN866"><span class='Ref_to_Parameter'>replIsnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN872"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create a new tuple from the values and isnull arrays 
     */ 
</span>    <a href="heaptuple.c.html#LN871"><span class='Ref_To_Local'>newTuple</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN862"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN869"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN870"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN869"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN870"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * copy the identification info of the old tuple: t_ctid, t_self, and OID 
     * (if any) 
     */ 
</span>    <a href="heaptuple.c.html#LN871"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN861"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN149"><span class='Ref_to_Member'>t_ctid</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN871"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN861"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN871"><span class='Ref_To_Local'>newTuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN861"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN862"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN871"><span class='Ref_To_Local'>newTuple</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN861"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="heaptuple.c.html#LN871"><span class='Ref_To_Local'>newTuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_modify_tuple_by_cols &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_deform_tuple 
 *      Given a tuple, extract data into values/isnull arrays; this is 
 *      the inverse of heap_form_tuple. 
 * 
 *      Storage for the values/isnull arrays is provided by the caller; 
 *      it should be sized according to tupleDesc-&GT;natts not 
 *      HeapTupleHeaderGetNatts(tuple-&GT;t_data). 
 * 
 *      Note that for pass-by-reference datatypes, the pointer placed 
 *      in the Datum will point into the given tuple. 
 * 
 *      When all or most of a tuple's fields need to be extracted, 
 *      this routine will be significantly quicker than a loop around 
 *      heap_getattr; the loop will become O(N^2) as soon as any 
 *      noncacheable attribute offsets are involved. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN932"></a><span class='Declare_Function'>heap_deform_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDesc</span><span class='Delimiter'>, 
</span><a name="LN933"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN935"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tup</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN932"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span><a name="LN936"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN661"><span class='Ref_to_Macro'>HeapTupleHasNulls</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN932"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN937"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN932"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span><a name="LN938"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tdesc_natts</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN932"><span class='Ref_to_Parameter'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN939"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* number of atts to extract */ 
</span><a name="LN940"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN941"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* ptr to tuple data */ 
</span><a name="LN942"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>off</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* offset in tuple data */ 
</span><a name="LN943"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bp</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN935"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN162"><span class='Ref_to_Member'>t_bits</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ptr to null bitmap in tuple */ 
</span><a name="LN944"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>slow</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* can we use/set attcacheoff? */ 
</span> 
    <a href="heaptuple.c.html#LN939"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN531"><span class='Ref_to_Macro'>HeapTupleHeaderGetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN935"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In inheritance situations, it is possible that the given tuple actually 
     * has more fields than the caller is expecting.  Don't run off the end of 
     * the caller's arrays. 
     */ 
</span>    <a href="heaptuple.c.html#LN939"><span class='Ref_To_Local'>natts</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN939"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN938"><span class='Ref_To_Local'>tdesc_natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN941"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN935"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN935"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN158"><span class='Ref_to_Member'>t_hoff</span></a><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN939"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN961"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>thisatt</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN937"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN936"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>&& </span><a href="../../../include/access/tupmacs.h.html#LN20"><span class='Ref_to_Macro'>att_isnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN943"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="heaptuple.c.html#LN933"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN933"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN944"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* can't use attcacheoff anymore */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="heaptuple.c.html#LN933"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN944"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>&& </span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We can only cache the offset for a varlena attribute if the 
             * offset is already suitably aligned, so that there would be no 
             * pad bytes in any case: then the offset will be valid for either 
             * an aligned or unaligned value. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN944"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>&& 
</span>                <a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>== </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>))</span> 
                <a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN121"><span class='Ref_to_Macro'>att_align_pointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attalign<span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="heaptuple.c.html#LN941"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="heaptuple.c.html#LN944"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* not varlena, so safe to use att_align_nominal */ 
</span>            <a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN944"><span class='Ref_To_Local'>slow</span></a><span class='Parentheses'>) 
</span>                <a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="heaptuple.c.html#LN933"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN36"><span class='Ref_to_Macro'>fetchatt</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN941"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>, </span><a href="heaptuple.c.html#LN941"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN942"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN961"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attlen <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="heaptuple.c.html#LN944"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* can't use attcacheoff anymore */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attnum=0;attnum&LT;natts... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If tuple doesn't have all the atts indicated by tupleDesc, read the 
     * rest as null 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN938"><span class='Ref_To_Local'>tdesc_natts</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="heaptuple.c.html#LN933"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN933"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN940"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end heap_deform_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * slot_deform_tuple 
 *      Given a TupleTableSlot, extract data from the slot's physical tuple 
 *      into its Datum/isnull arrays.  Data is extracted up through the 
 *      natts'th column (caller must ensure this is a legal column number). 
 * 
 *      This is essentially an incremental version of heap_deform_tuple: 
 *      on each call we extract attributes up to the one needed, without 
 *      re-computing information about previously extracted attributes. 
 *      slot-&GT;tts_nvalid is the number of attributes already extracted. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1033"></a><span class='Declare_Function'>slot_deform_tuple</span><span class='Parentheses'>(</span><a href="../../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1035"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN119"><span class='Ref_to_Member'>tts_tuple</span></a><span class='Delimiter'>; 
</span><a name="LN1036"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Delimiter'>; 
</span><a name="LN1037"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>; 
</span><a name="LN1038"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>isnull</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>; 
</span><a name="LN1039"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tup</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1035"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span><a name="LN1040"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnulls</span> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN661"><span class='Ref_to_Macro'>HeapTupleHasNulls</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1035"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1041"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1036"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span><a name="LN1042"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN1043"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* ptr to tuple data */ 
</span><a name="LN1044"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>off</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* offset in tuple data */ 
</span><a name="LN1045"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bp</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1039"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN162"><span class='Ref_to_Member'>t_bits</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* ptr to null bitmap in tuple */ 
</span><a name="LN1046"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>slow</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* can we use/set attcacheoff? */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check whether the first call for this tuple, and initialize or restore 
     * loop state. 
     */ 
</span>    <a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Start from the first attribute */ 
</span>        <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Restore state from previous execution */ 
</span>        <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN128"><span class='Ref_to_Member'>tts_off</span></a><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN118"><span class='Ref_to_Member'>tts_slow</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="heaptuple.c.html#LN1043"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN1039"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN1039"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN158"><span class='Ref_to_Member'>t_hoff</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1070"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>thisatt</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1041"><span class='Ref_To_Local'>att</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1040"><span class='Ref_To_Local'>hasnulls</span></a> <span class='Operator'>&& </span><a href="../../../include/access/tupmacs.h.html#LN20"><span class='Ref_to_Macro'>att_isnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1045"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="heaptuple.c.html#LN1037"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN1038"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* can't use attcacheoff anymore */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="heaptuple.c.html#LN1038"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>&& </span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We can only cache the offset for a varlena attribute if the 
             * offset is already suitably aligned, so that there would be no 
             * pad bytes in any case: then the offset will be valid for either 
             * an aligned or unaligned value. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>&& 
</span>                <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>== </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>))</span> 
                <a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN121"><span class='Ref_to_Macro'>att_align_pointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attalign<span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="heaptuple.c.html#LN1043"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* not varlena, so safe to use att_align_nominal */ 
</span>            <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attalign<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a><span class='Parentheses'>) 
</span>                <a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attcacheoff <span class='Operator'>= </span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="heaptuple.c.html#LN1037"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN36"><span class='Ref_to_Macro'>fetchatt</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1043"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attlen<span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1043"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1070"><span class='Ref_To_Local'>thisatt</span></a><span class='Operator'>-&GT;</span>attlen <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* can't use attcacheoff anymore */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;attnum&LT;natts;attnum+... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Save state for next execution 
     */ 
</span>    <a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1042"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN128"><span class='Ref_to_Member'>tts_off</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1044"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1033"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN118"><span class='Ref_to_Member'>tts_slow</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1046"><span class='Ref_To_Local'>slow</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end slot_deform_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * slot_getattr 
 *      This function fetches an attribute of the slot's current tuple. 
 *      It is functionally equivalent to heap_getattr, but fetches of 
 *      multiple attributes of the same tuple will be optimized better, 
 *      because we avoid O(N^2) behavior from multiple calls of 
 *      nocachegetattr(), even when attcacheoff isn't usable. 
 * 
 *      A difference from raw heap_getattr is that attnums beyond the 
 *      slot's tupdesc's last attribute will be considered NULL even 
 *      when the physical tuple is longer than the tupdesc. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1140"></a><span class='Declare_Function'>slot_getattr</span><span class='Parentheses'>(</span><a href="../../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1142"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN119"><span class='Ref_to_Member'>tts_tuple</span></a><span class='Delimiter'>; 
</span><a name="LN1143"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Delimiter'>; 
</span><a name="LN1144"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * system attributes are handled by heap_getsysattr 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1142"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* internal error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract system attribute from virtual tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1142"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== &</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN127"><span class='Ref_to_Member'>tts_minhdr</span></a><span class='Parentheses'>))</span>       <span class='Comment_Single_Line'>/* internal error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract system attribute from minimal tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="heaptuple.c.html#LN550"><span class='Ref_to_Func'>heap_getsysattr</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1142"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1143"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * fast path if desired attribute already cached 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <span class='Control'>return</span> <a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * return NULL if attnum is out of range according to the tupdesc 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><a href="heaptuple.c.html#LN1143"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * otherwise we had better have a physical tuple (tts_nvalid should equal 
     * natts in all virtual-tuple cases) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1142"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract attribute from empty tuple slot"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * return NULL if attnum is out of range according to the tuple 
     * 
     * (We have to check this separately because of various inheritance and 
     * table-alteration scenarios: the tuple could be either longer or shorter 
     * than the tupdesc.) 
     */ 
</span>    <a href="heaptuple.c.html#LN1144"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1142"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><a href="../../../include/access/htup_details.h.html#LN531"><span class='Ref_to_Macro'>HeapTupleHeaderGetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1144"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * check if target attribute is null: no point in groveling through tuple 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN661"><span class='Ref_to_Macro'>HeapTupleHasNulls</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1142"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/access/tupmacs.h.html#LN20"><span class='Ref_to_Macro'>att_isnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1144"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN162"><span class='Ref_to_Member'>t_bits</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the attribute's column has been dropped, we force a NULL result. 
     * This case should not happen in normal use, but it could happen if we 
     * are executing a plan cached before the column was dropped. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1143"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Extract the attribute, along with any preceding attributes. 
     */ 
</span>    <a href="heaptuple.c.html#LN1032"><span class='Ref_to_Func'>slot_deform_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The result is acquired from tts_values array. 
     */ 
</span>    <span class='Operator'>*</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <span class='Control'>return</span> <a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1140"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
}</span><span class='Auto_Annotations'> &laquo; end slot_getattr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * slot_getallattrs 
 *      This function forces all the entries of the slot's Datum/isnull 
 *      arrays to be valid.  The caller may then extract data directly 
 *      from those arrays instead of using slot_getattr. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1236"></a><span class='Declare_Function'>slot_getallattrs</span><span class='Parentheses'>(</span><a href="../../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1238"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tdesc_natts</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN1239"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN1240"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick out if we have 'em all already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a> <span class='Operator'>== </span><a href="heaptuple.c.html#LN1238"><span class='Ref_To_Local'>tdesc_natts</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * otherwise we had better have a physical tuple (tts_nvalid should equal 
     * natts in all virtual-tuple cases) 
     */ 
</span>    <a href="heaptuple.c.html#LN1240"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN119"><span class='Ref_to_Member'>tts_tuple</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1240"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract attribute from empty tuple slot"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * load up any slots available from physical tuple 
     */ 
</span>    <a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN531"><span class='Ref_to_Macro'>HeapTupleHeaderGetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1240"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1238"><span class='Ref_To_Local'>tdesc_natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN1032"><span class='Ref_to_Func'>slot_deform_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If tuple doesn't have all the atts indicated by tupleDesc, read the 
     * rest as null 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN1238"><span class='Ref_To_Local'>tdesc_natts</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1239"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="heaptuple.c.html#LN1236"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1238"><span class='Ref_To_Local'>tdesc_natts</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end slot_getallattrs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * slot_getsomeattrs 
 *      This function forces the entries of the slot's Datum/isnull 
 *      arrays to be valid at least up through the attnum'th entry. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1280"></a><span class='Declare_Function'>slot_getsomeattrs</span><span class='Parentheses'>(</span><a href="../../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1282"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1283"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick out if we have 'em all already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a> <span class='Operator'>&GT;= </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for caller error */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid attribute number %d"</span><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * otherwise we had better have a physical tuple (tts_nvalid should equal 
     * natts in all virtual-tuple cases) 
     */ 
</span>    <a href="heaptuple.c.html#LN1282"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN119"><span class='Ref_to_Member'>tts_tuple</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1282"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract attribute from empty tuple slot"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * load up any slots available from physical tuple 
     */ 
</span>    <a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN531"><span class='Ref_to_Macro'>HeapTupleHeaderGetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1282"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN1032"><span class='Ref_to_Func'>slot_deform_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If tuple doesn't have all the atts indicated by tupleDesc, read the 
     * rest as null 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1283"><span class='Ref_To_Local'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1280"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end slot_getsomeattrs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * slot_attisnull 
 *      Detect whether an attribute of the slot is null, without 
 *      actually fetching it. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1327"></a><span class='Declare_Function'>slot_attisnull</span><span class='Parentheses'>(</span><a href="../../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1329"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN119"><span class='Ref_to_Member'>tts_tuple</span></a><span class='Delimiter'>; 
</span><a name="LN1330"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupleDesc</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN120"><span class='Ref_to_Member'>tts_tupleDescriptor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * system attributes are handled by heap_attisnull 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1329"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* internal error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract system attribute from virtual tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1329"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== &</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN127"><span class='Ref_to_Member'>tts_minhdr</span></a><span class='Parentheses'>))</span>       <span class='Comment_Single_Line'>/* internal error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract system attribute from minimal tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1329"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * fast path if desired attribute already cached 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN123"><span class='Ref_to_Member'>tts_nvalid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * return NULL if attnum is out of range according to the tupdesc 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>&GT; </span><a href="heaptuple.c.html#LN1330"><span class='Ref_To_Local'>tupleDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * otherwise we had better have a physical tuple (tts_nvalid should equal 
     * natts in all virtual-tuple cases) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1329"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>          <span class='Comment_Single_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot extract attribute from empty tuple slot"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and let the tuple tell it */ 
</span>    <span class='Control'>return</span> <a href="heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1329"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1327"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end slot_attisnull &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_freetuple 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1371"></a><span class='Declare_Function'>heap_freetuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1371"><span class='Ref_to_Parameter'>htup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_form_minimal_tuple 
 *      construct a MinimalTuple from the given values[] and isnull[] arrays, 
 *      which are of the length indicated by tupleDescriptor-&GT;natts 
 * 
 * This is exactly like heap_form_tuple() except that the result is a 
 * "minimal" tuple lacking a HeapTupleData header as well as room for system 
 * columns. 
 * 
 * The result is allocated in the current memory context. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> 
<a name="LN1389"></a><span class='Declare_Function'>heap_form_minimal_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupleDescriptor</span><span class='Delimiter'>, 
</span><a name="LN1390"></a>                        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN1391"></a>                        <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1393"></a>    <a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* return tuple */ 
</span><a name="LN1394"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len</span><span class='Delimiter'>, 
</span><a name="LN1395"></a>                <span class='Declare_Local'>data_len</span><span class='Delimiter'>; 
</span><a name="LN1396"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hoff</span><span class='Delimiter'>; 
</span><a name="LN1397"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasnull</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1398"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numberOfAttributes</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1389"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN1399"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1398"><span class='Ref_To_Local'>numberOfAttributes</span></a> <span class='Operator'>&GT; </span><a href="../../../include/access/htup_details.h.html#LN32"><span class='Ref_to_Const'>MaxTupleAttributeNumber</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_TOO_MANY_COLUMNS<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of columns (%d) exceeds limit (%d)"</span><span class='Delimiter'>, 
</span>                        <a href="heaptuple.c.html#LN1398"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>, </span><a href="../../../include/access/htup_details.h.html#LN32"><span class='Ref_to_Const'>MaxTupleAttributeNumber</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for nulls 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1399"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1399"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="heaptuple.c.html#LN1398"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Delimiter'>; </span><a href="heaptuple.c.html#LN1399"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1391"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="heaptuple.c.html#LN1399"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="heaptuple.c.html#LN1397"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine total space needed 
     */ 
</span>    <a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN649"><span class='Ref_to_Const'>SizeofMinimalTupleHeader</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1397"><span class='Ref_To_Local'>hasnull</span></a><span class='Parentheses'>) 
</span>        <a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="../../../include/access/htup_details.h.html#LN547"><span class='Ref_to_Macro'>BITMAPLEN</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1398"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1389"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>) 
</span>        <a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN1396"><span class='Ref_To_Local'>hoff</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* align user data safely */ 
</span> 
    <a href="heaptuple.c.html#LN1395"><span class='Ref_To_Local'>data_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN83"><span class='Ref_to_Func'>heap_compute_data_size</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1389"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1390"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1391"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="heaptuple.c.html#LN1395"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate and zero the space needed. 
     */ 
</span>    <a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * And fill in the information. 
     */ 
</span>    <a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1394"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/access/htup_details.h.html#LN534"><span class='Ref_to_Macro'>HeapTupleHeaderSetNatts</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1398"><span class='Ref_To_Local'>numberOfAttributes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN638"><span class='Ref_to_Member'>t_hoff</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1396"><span class='Ref_To_Local'>hoff</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN619"><span class='Ref_to_Const'>MINIMAL_TUPLE_OFFSET</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1389"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN78"><span class='Ref_to_Member'>tdhasoid</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* else leave infomask = 0 */ 
</span>        <a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN636"><span class='Ref_to_Member'>t_infomask</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN177"><span class='Ref_to_Const'>HEAP_HASOID</span></a><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN144"><span class='Ref_to_Func'>heap_fill_tuple</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1389"><span class='Ref_to_Parameter'>tupleDescriptor</span></a><span class='Delimiter'>, 
</span>                    <a href="heaptuple.c.html#LN1390"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, 
</span>                    <a href="heaptuple.c.html#LN1391"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN1396"><span class='Ref_To_Local'>hoff</span></a><span class='Delimiter'>, 
</span>                    <a href="heaptuple.c.html#LN1395"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>, 
</span>                    <span class='Operator'>&</span><a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN636"><span class='Ref_to_Member'>t_infomask</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1397"><span class='Ref_To_Local'>hasnull</span></a> <span class='Operator'>? </span><a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN642"><span class='Ref_to_Member'>t_bits</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="heaptuple.c.html#LN1393"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end heap_form_minimal_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * heap_free_minimal_tuple 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1466"></a><span class='Declare_Function'>heap_free_minimal_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Parameter'>mtup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1466"><span class='Ref_to_Parameter'>mtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * heap_copy_minimal_tuple 
 *      copy a MinimalTuple 
 * 
 * The result is allocated in the current memory context. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> 
<a name="LN1478"></a><span class='Declare_Function'>heap_copy_minimal_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Parameter'>mtup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1480"></a>    <a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN1480"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1478"><span class='Ref_to_Parameter'>mtup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1480"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1478"><span class='Ref_to_Parameter'>mtup</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1478"><span class='Ref_to_Parameter'>mtup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="heaptuple.c.html#LN1480"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * heap_tuple_from_minimal_tuple 
 *      create a HeapTuple by copying from a MinimalTuple; 
 *      system columns are filled with zeroes 
 * 
 * The result is allocated in the current memory context. 
 * The HeapTuple struct, tuple header, and tuple data are all allocated 
 * as a single palloc() block. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN1497"></a><span class='Declare_Function'>heap_tuple_from_minimal_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Parameter'>mtup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1499"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1500"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1497"><span class='Ref_to_Parameter'>mtup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN619"><span class='Ref_to_Const'>MINIMAL_TUPLE_OFFSET</span></a><span class='Delimiter'>; 
</span> 
    <a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a> <span class='Operator'>+ </span><a href="heaptuple.c.html#LN1500"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1500"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup.h.html#LN71"><span class='Ref_to_Const'>HEAPTUPLESIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN619"><span class='Ref_to_Const'>MINIMAL_TUPLE_OFFSET</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1497"><span class='Ref_to_Parameter'>mtup</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1497"><span class='Ref_to_Parameter'>mtup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN141"><span class='Ref_to_Struct'>HeapTupleHeaderData</span></a><span class='Delimiter'>, </span>t_infomask2<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="heaptuple.c.html#LN1499"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * minimal_tuple_from_heap_tuple 
 *      create a MinimalTuple by copying from a HeapTuple 
 * 
 * The result is allocated in the current memory context. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> 
<a name="LN1519"></a><span class='Declare_Function'>minimal_tuple_from_heap_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>htup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1521"></a>    <a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1522"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1519"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>&GT; </span><a href="../../../include/access/htup_details.h.html#LN619"><span class='Ref_to_Const'>MINIMAL_TUPLE_OFFSET</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1522"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1519"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>- </span><a href="../../../include/access/htup_details.h.html#LN619"><span class='Ref_to_Const'>MINIMAL_TUPLE_OFFSET</span></a><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1521"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN26"><span class='Ref_to_Typedef'>MinimalTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1522"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="heaptuple.c.html#LN1521"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="heaptuple.c.html#LN1519"><span class='Ref_to_Parameter'>htup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>+ </span><a href="../../../include/access/htup_details.h.html#LN619"><span class='Ref_to_Const'>MINIMAL_TUPLE_OFFSET</span></a><span class='Delimiter'>, </span><a href="heaptuple.c.html#LN1522"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="heaptuple.c.html#LN1521"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup_details.h.html#LN628"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="heaptuple.c.html#LN1522"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="heaptuple.c.html#LN1521"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>