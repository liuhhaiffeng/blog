<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\gin\ginget.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\gin\ginget.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:28 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * ginget.c 
 *    fetch tuples from a GIN scan. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *          src/backend/access/gin/ginget.c 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/gin_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
<span class='Comment_Multi_Line'>/* GUC parameter */ 
</span><a name="LN23"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>GinFuzzySearchLimit</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<a name="LN25"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pendingPosition</span> 
<span class='Delimiter'>{ 
</span><a name="LN27"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Member'>pendingBuffer</span><span class='Delimiter'>; 
</span><a name="LN28"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Member'>firstOffset</span><span class='Delimiter'>; 
</span><a name="LN29"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Member'>lastOffset</span><span class='Delimiter'>; 
</span><a name="LN30"></a>    <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Member'>item</span><span class='Delimiter'>; 
</span><a name="LN31"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>hasMatchKey</span><span class='Delimiter'>; 
</span><a name="LN32"></a>} <span class='Declare_Typedef'>pendingPosition</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Goes to the next page if current offset is outside of bounds 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN39"></a><span class='Declare_Function'>moveRightIfItNeeded</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN142"><span class='Ref_to_Struct'>GinBtreeData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>btree</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN121"><span class='Ref_to_Struct'>GinBtreeStack</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stack</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN41"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a> <span class='Operator'>&GT; </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN41"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We scanned the whole page, so we should take right page 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN127"><span class='Ref_to_Macro'>GinPageRightMost</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN41"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* no more pages */ 
</span> 
        <a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="ginbtree.c.html#LN163"><span class='Ref_to_Func'>ginStepRight</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN159"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN123"><span class='Ref_to_Member'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN39"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end moveRightIfItNeeded &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Scan all pages of a posting tree and save all its heap ItemPointers 
 * in scanEntry-&GT;matchBitmap 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN64"></a><span class='Declare_Function'>scanPostingTree</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Parameter'>scanEntry</span><span class='Delimiter'>, 
</span><a name="LN65"></a>                <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>rootPostingTree</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN67"></a>    <a href="../../../include/access/gin_private.h.html#LN142"><span class='Ref_to_Struct'>GinBtreeData</span></a> <span class='Declare_Local'>btree</span><span class='Delimiter'>; 
</span><a name="LN68"></a>    <a href="../../../include/access/gin_private.h.html#LN121"><span class='Ref_to_Struct'>GinBtreeStack</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stack</span><span class='Delimiter'>; 
</span><a name="LN69"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Descend to the leftmost leaf page */ 
</span>    <a href="ginget.c.html#LN68"><span class='Ref_To_Local'>stack</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN225"><span class='Ref_to_Proto'>ginScanBeginPostingTree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN67"><span class='Ref_To_Local'>btree</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN64"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN65"><span class='Ref_to_Parameter'>rootPostingTree</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN65"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN69"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN68"><span class='Ref_To_Local'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN177"><span class='Ref_to_Proto'>IncrBufferRefCount</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN69"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* prevent unpin in freeGinBtreeStack */ 
</span> 
    <a href="ginbtree.c.html#LN191"><span class='Ref_to_Func'>freeGinBtreeStack</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN68"><span class='Ref_To_Local'>stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop iterates through all leaf pages of posting tree 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN70"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN69"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/access/ginblock.h.html#LN108"><span class='Ref_to_Macro'>GinPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN70"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>flags <span class='Operator'>& </span><a href="../../../include/access/ginblock.h.html#LN40"><span class='Ref_to_Const'>GIN_DELETED</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN87"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="gindatapage.c.html#LN179"><span class='Ref_to_Func'>GinDataLeafPageGetItemsToTbm</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN70"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN64"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="ginget.c.html#LN64"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>+= </span><a href="ginget.c.html#LN87"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN127"><span class='Ref_to_Macro'>GinPageRightMost</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN70"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no more pages */ 
</span> 
        <a href="ginget.c.html#LN69"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="ginbtree.c.html#LN163"><span class='Ref_to_Func'>ginStepRight</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN69"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN64"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN69"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end scanPostingTree &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Collects TIDs into scanEntry-&GT;matchBitmap for all heap tuples that 
 * match the search entry.  This supports three different match modes: 
 * 
 * 1. Partial-match support: scan from current point until the 
 *    comparePartialFn says we're done. 
 * 2. SEARCH_MODE_ALL: scan from current point (which should be first 
 *    key for the current attnum) until we hit null items or end of attnum 
 * 3. SEARCH_MODE_EVERYTHING: scan from current point (which should be first 
 *    key for the current attnum) until we hit end of attnum 
 * 
 * Returns true if done, false if it's necessary to restart scan from scratch 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN115"></a><span class='Declare_Function'>collectMatchBitmap</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN142"><span class='Ref_to_Struct'>GinBtreeData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>btree</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN121"><span class='Ref_to_Struct'>GinBtreeStack</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stack</span><span class='Delimiter'>, 
</span><a name="LN116"></a>                   <a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Parameter'>scanEntry</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN118"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize empty bitmap result */ 
</span>    <a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/tidbitmap.h.html#LN50"><span class='Ref_to_Proto'>tbm_create</span></a><span class='Parentheses'>(</span><a href="../../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a> <span class='Operator'>* </span><span class='Number'>1024L</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Null query cannot partial-match anything */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN318"><span class='Ref_to_Member'>isPartialMatch</span></a> <span class='Operator'>&& 
</span>        <a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN317"><span class='Ref_to_Member'>queryCategory</span></a> <span class='Operator'>!= </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Locate tupdesc entry for key column (for attbyval/attlen data) */ 
</span>    <a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN119"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN66"><span class='Ref_to_Member'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN135"></a>        <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN136"></a>        <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN137"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>idatum</span><span class='Delimiter'>; 
</span><a name="LN138"></a>        <a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Local'>icategory</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * stack-&GT;off points to the interested entry, buffer is already locked 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN38"><span class='Ref_to_Func'>moveRightIfItNeeded</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN159"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If tuple stores another attribute then stop scan 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN102"><span class='Ref_to_Proto'>gintuple_get_attrnum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Safe to fetch attribute value */ 
</span>        <a href="ginget.c.html#LN137"><span class='Ref_To_Local'>idatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN103"><span class='Ref_to_Proto'>gintuple_get_key</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN138"><span class='Ref_To_Local'>icategory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check for appropriate scan stop conditions 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN318"><span class='Ref_to_Member'>isPartialMatch</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN164"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In partial match, stop scan at any null (including 
             * placeholders); partial matches never match nulls 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN138"><span class='Ref_To_Local'>icategory</span></a> <span class='Operator'>!= </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/*---------- 
             * Check of partial match. 
             * case cmp == 0 =&GT; match 
             * case cmp &GT; 0 =&GT; not match and finish scan 
             * case cmp &LT; 0 =&GT; not match and continue scan 
             *---------- 
             */ 
</span>            <a href="ginget.c.html#LN164"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN517"><span class='Ref_to_Proto'>FunctionCall4Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN77"><span class='Ref_to_Member'>comparePartialFn</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                               <a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                                  <a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN316"><span class='Ref_to_Member'>queryKey</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN137"><span class='Ref_To_Local'>idatum</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/postgres.h.html#LN470"><span class='Ref_to_Macro'>UInt16GetDatum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN320"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN319"><span class='Ref_to_Member'>extra_data</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN164"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN164"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if scanEntry-&GT;isPartialM... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN321"><span class='Ref_to_Member'>searchMode</span></a> <span class='Operator'>== </span><a href="../../../include/access/gin.h.html#LN34"><span class='Ref_to_Const'>GIN_SEARCH_MODE_ALL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * In ALL mode, we are not interested in null items, so we can 
             * stop if we get to a null-item placeholder (which will be the 
             * last entry for a given attnum).  We do want to include NULL_KEY 
             * and EMPTY_ITEM entries, though. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN138"><span class='Ref_To_Local'>icategory</span></a> <span class='Operator'>== </span><a href="../../../include/access/ginblock.h.html#LN201"><span class='Ref_to_Const'>GIN_CAT_NULL_ITEM</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * OK, we want to return the TIDs listed in this entry. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN221"><span class='Ref_to_Macro'>GinIsPostingTree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN212"></a>            <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>rootPostingTree</span> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN223"><span class='Ref_to_Macro'>GinGetPostingTree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We should unlock current page (but not unpin) during tree scan 
             * to prevent deadlock with vacuum processes. 
             * 
             * We save current entry value (idatum) to be able to re-find our 
             * tuple after re-locking 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN138"><span class='Ref_To_Local'>icategory</span></a> <span class='Operator'>== </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Parentheses'>) 
</span>                <a href="ginget.c.html#LN137"><span class='Ref_To_Local'>idatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN137"><span class='Ref_To_Local'>idatum</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN119"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Delimiter'>, </span><a href="ginget.c.html#LN119"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attlen<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Collect all the TIDs in this entry's posting tree */ 
</span>            <a href="ginget.c.html#LN63"><span class='Ref_to_Func'>scanPostingTree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN159"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN212"><span class='Ref_To_Local'>rootPostingTree</span></a><span class='Delimiter'>, 
</span>                            <a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We lock again the entry page and while it was unlocked insert 
             * might have occurred, so we need to re-find our position. 
             */ 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/ginblock.h.html#LN110"><span class='Ref_to_Macro'>GinPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Root page becomes non-leaf while we unlock it. We will 
                 * start again, this situation doesn't occur often - root can 
                 * became a non-leaf only once per life of index. 
                 */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Search forward to re-find idatum */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN249"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newDatum</span><span class='Delimiter'>; 
</span><a name="LN250"></a>                <a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Local'>newCategory</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN38"><span class='Ref_to_Func'>moveRightIfItNeeded</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"lost saved point in index"</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* must not happen !!! */ 
</span> 
                <a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN135"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN102"><span class='Ref_to_Proto'>gintuple_get_attrnum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"lost saved point in index"</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* must not happen !!! */ 
</span>                <a href="ginget.c.html#LN249"><span class='Ref_To_Local'>newDatum</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN103"><span class='Ref_to_Proto'>gintuple_get_key</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="ginget.c.html#LN250"><span class='Ref_To_Local'>newCategory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN92"><span class='Ref_to_Proto'>ginCompareEntries</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN118"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, 
</span>                                      <a href="ginget.c.html#LN249"><span class='Ref_To_Local'>newDatum</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN250"><span class='Ref_To_Local'>newCategory</span></a><span class='Delimiter'>, 
</span>                                      <a href="ginget.c.html#LN137"><span class='Ref_To_Local'>idatum</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN138"><span class='Ref_To_Local'>icategory</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Found! */ 
</span> 
                <a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN138"><span class='Ref_To_Local'>icategory</span></a> <span class='Operator'>== </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a> <span class='Operator'>&& !</span><a href="ginget.c.html#LN119"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attbyval<span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN137"><span class='Ref_To_Local'>idatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if GinIsPostingTree(itup... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN276"></a>            <a href="../../../include/storage/itemptr.h.html#LN47"><span class='Ref_to_Typedef'>ItemPointer</span></a> <span class='Declare_Local'>ipd</span><span class='Delimiter'>; 
</span><a name="LN277"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nipd</span><span class='Delimiter'>; 
</span> 
            <a href="ginget.c.html#LN276"><span class='Ref_To_Local'>ipd</span></a> <span class='Operator'>= </span><a href="ginentrypage.c.html#LN161"><span class='Ref_to_Func'>ginReadTuple</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>btree</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN161"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN277"><span class='Ref_To_Local'>nipd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/nodes/tidbitmap.h.html#LN54"><span class='Ref_to_Proto'>tbm_add_tuples</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN276"><span class='Ref_To_Local'>ipd</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN277"><span class='Ref_To_Local'>nipd</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN116"><span class='Ref_to_Parameter'>scanEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>+= </span><a href="../../../include/access/ginblock.h.html#LN218"><span class='Ref_to_Macro'>GinGetNPosting</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN136"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN276"><span class='Ref_To_Local'>ipd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Done with this entry, go to the next 
         */ 
</span>        <a href="ginget.c.html#LN115"><span class='Ref_to_Parameter'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end collectMatchBitmap &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Start* functions setup beginning state of searches: finds correct buffer and pins it. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN296"></a><span class='Declare_Function'>startScanEntry</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Parameter'>entry</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN298"></a>    <a href="../../../include/access/gin_private.h.html#LN142"><span class='Ref_to_Struct'>GinBtreeData</span></a> <span class='Declare_Local'>btreeEntry</span><span class='Delimiter'>; 
</span><a name="LN299"></a>    <a href="../../../include/access/gin_private.h.html#LN121"><span class='Ref_to_Struct'>GinBtreeStack</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stackEntry</span><span class='Delimiter'>; 
</span><a name="LN300"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN301"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needUnlock</span><span class='Delimiter'>; 
</span> 
<a name="LN303"></a><span class='Label'>restartScanEntry</span><span class='Operator'>: 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/access/ginblock.h.html#LN156"><span class='Ref_to_Macro'>ItemPointerSetMin</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN341"><span class='Ref_to_Member'>reduceResult</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we should find entry, and begin scan of posting tree or just store 
     * posting list in memory 
     */ 
</span>    <a href="../../../include/access/gin_private.h.html#LN207"><span class='Ref_to_Proto'>ginPrepareEntryScan</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a><span class='Delimiter'>, 
</span>                        <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN316"><span class='Ref_to_Member'>queryKey</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN317"><span class='Ref_to_Member'>queryCategory</span></a><span class='Delimiter'>, 
</span>                        <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a> <span class='Operator'>= </span><a href="ginbtree.c.html#LN74"><span class='Ref_to_Func'>ginFindLeafPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN300"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ginFindLeafPage() will have already checked snapshot age. */ 
</span>    <a href="ginget.c.html#LN301"><span class='Ref_To_Local'>needUnlock</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
    <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN318"><span class='Ref_to_Member'>isPartialMatch</span></a> <span class='Operator'>|| 
</span>        <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN317"><span class='Ref_to_Member'>queryCategory</span></a> <span class='Operator'>== </span><a href="../../../include/access/ginblock.h.html#LN202"><span class='Ref_to_Const'>GIN_CAT_EMPTY_QUERY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * btreeEntry.findItem locates the first item &GT;= given search key. 
         * (For GIN_CAT_EMPTY_QUERY, it will find the leftmost index item 
         * because of the way the GIN_CAT_EMPTY_QUERY category code is 
         * assigned.)  We scan forward from there and collect all TIDs needed 
         * for the entry type. 
         */ 
</span>        <a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Operator'>.</span><a href="../../../include/access/gin_private.h.html#LN148"><span class='Ref_to_Member'>findItem</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN114"><span class='Ref_to_Func'>collectMatchBitmap</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * GIN tree was seriously restructured, so we will cleanup all 
             * found data and rescan. See comments near 'return false' in 
             * collectMatchBitmap() 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="../../../include/nodes/tidbitmap.h.html#LN51"><span class='Ref_to_Proto'>tbm_free</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginbtree.c.html#LN191"><span class='Ref_to_Func'>freeGinBtreeStack</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="ginget.c.html#LN303"><span class='Ref_to_Label'>restartScanEntry</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if collectMatchBitmap(&b... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a> <span class='Operator'>&& !</span><a href="../../../include/nodes/tidbitmap.h.html#LN62"><span class='Ref_to_Proto'>tbm_is_empty</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/tidbitmap.h.html#LN64"><span class='Ref_to_Proto'>tbm_begin_iterate</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if entry-&GT;isPartialMatch... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Operator'>.</span><a href="../../../include/access/gin_private.h.html#LN148"><span class='Ref_to_Member'>findItem</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN298"><span class='Ref_To_Local'>btreeEntry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN370"></a>        <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN300"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN300"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN125"><span class='Ref_to_Member'>off</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN221"><span class='Ref_to_Macro'>GinIsPostingTree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN370"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN374"></a>            <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>rootPostingTree</span> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN223"><span class='Ref_to_Macro'>GinGetPostingTree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN370"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN375"></a>            <a href="../../../include/access/gin_private.h.html#LN121"><span class='Ref_to_Struct'>GinBtreeStack</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stack</span><span class='Delimiter'>; 
</span><a name="LN376"></a>            <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN377"></a>            <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>minItem</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We should unlock entry page before touching posting tree to 
             * prevent deadlocks with vacuum processes. Because entry is never 
             * deleted from page and posting tree is never reduced to the 
             * posting list, we can unlock page after getting BlockNumber of 
             * root of posting tree. 
             */ 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN301"><span class='Ref_To_Local'>needUnlock</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span> 
            <a href="ginget.c.html#LN375"><span class='Ref_To_Local'>stack</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN225"><span class='Ref_to_Proto'>ginScanBeginPostingTree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN343"><span class='Ref_to_Member'>btree</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN52"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>, 
</span>                                            <a href="ginget.c.html#LN374"><span class='Ref_To_Local'>rootPostingTree</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN375"><span class='Ref_To_Local'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We keep buffer pinned because we need to prevent deletion of 
             * page during scan. See GIN's vacuum implementation. RefCount is 
             * increased to keep buffer pinned after freeGinBtreeStack() call. 
             */ 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN177"><span class='Ref_to_Proto'>IncrBufferRefCount</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="ginget.c.html#LN376"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Load the first page into memory. 
             */ 
</span>            <a href="../../../include/access/ginblock.h.html#LN156"><span class='Ref_to_Macro'>ItemPointerSetMin</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN377"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a> <span class='Operator'>= </span><a href="gindatapage.c.html#LN132"><span class='Ref_to_Func'>GinDataLeafPageGetItems</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN376"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN377"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN375"><span class='Ref_To_Local'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN128"><span class='Ref_to_Member'>predictNumber</span></a> <span class='Operator'>* </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginbtree.c.html#LN191"><span class='Ref_to_Func'>freeGinBtreeStack</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN375"><span class='Ref_To_Local'>stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if GinIsPostingTree(itup... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN218"><span class='Ref_to_Macro'>GinGetNPosting</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN370"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a> <span class='Operator'>= </span><a href="ginentrypage.c.html#LN161"><span class='Ref_to_Func'>ginReadTuple</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN370"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Delimiter'>; 
</span> 
            <a href="ginget.c.html#LN296"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if btreeEntry.findItem(&... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN301"><span class='Ref_To_Local'>needUnlock</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginbtree.c.html#LN191"><span class='Ref_to_Func'>freeGinBtreeStack</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN299"><span class='Ref_To_Local'>stackEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end startScanEntry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Comparison function for scan entry indexes. Sorts by predictNumberResult, 
 * least frequent items first. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN434"></a><span class='Declare_Function'>entryIndexByFrequencyCmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a2</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN436"></a>    <span class='Keyword'>const </span><a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a><span class='Parentheses'>) </span><a href="ginget.c.html#LN434"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN437"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i1</span> <span class='Operator'>= *</span><span class='Parentheses'>(</span><span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginget.c.html#LN434"><span class='Ref_to_Parameter'>a1</span></a><span class='Delimiter'>; 
</span><a name="LN438"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i2</span> <span class='Operator'>= *</span><span class='Parentheses'>(</span><span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginget.c.html#LN434"><span class='Ref_to_Parameter'>a2</span></a><span class='Delimiter'>; 
</span><a name="LN439"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>n1</span> <span class='Operator'>= </span><a href="ginget.c.html#LN436"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN437"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a><span class='Delimiter'>; 
</span><a name="LN440"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>n2</span> <span class='Operator'>= </span><a href="ginget.c.html#LN436"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN438"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN439"><span class='Ref_To_Local'>n1</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN440"><span class='Ref_To_Local'>n2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN439"><span class='Ref_To_Local'>n1</span></a> <span class='Operator'>== </span><a href="ginget.c.html#LN440"><span class='Ref_To_Local'>n2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN451"></a><span class='Declare_Function'>startScanKey</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a> <span class='Declare_Parameter'>so</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a> <span class='Declare_Parameter'>key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN453"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCtx</span> <span class='Operator'>= </span><a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span><a name="LN454"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN455"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN456"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>entryIndexes</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/ginblock.h.html#LN156"><span class='Ref_to_Macro'>ItemPointerSetMin</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN309"><span class='Ref_to_Member'>recheckCurItem</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN310"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Divide the entries into two distinct sets: required and additional. 
     * Additional entries are not enough for a match alone, without any items 
     * from the required set, but are needed by the consistent function to 
     * decide if an item matches. When scanning, we can skip over items from 
     * additional entries that have no corresponding matches in any of the 
     * required entries. That speeds up queries like "frequent & rare" 
     * considerably, if the frequent term can be put in the additional set. 
     * 
     * There can be many legal ways to divide them entries into these two 
     * sets. A conservative division is to just put everything in the required 
     * set, but the more you can put in the additional set, the more you can 
     * skip during the scan. To maximize skipping, we try to put as many 
     * frequent items as possible into additional, and less frequent ones into 
     * required. To do that, sort the entries by frequency 
     * (predictNumberResult), and put entries into the required set in that 
     * order, until the consistent function says that none of the remaining 
     * entries can form a match, without any items from the required set. The 
     * rest go to the additional set. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN348"><span class='Ref_to_Member'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="ginget.c.html#LN433"><span class='Ref_to_Func'>entryIndexByFrequencyCmp</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Pass all entries &LT;= i as FALSE, and the rest as MAYBE */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT;= </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN60"><span class='Ref_to_Const'>GIN_MAYBE</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN285"><span class='Ref_to_Member'>triConsistentFn</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* i is now the last required entry. */ 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN358"><span class='Ref_to_Member'>keyCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN278"><span class='Ref_to_Member'>nrequired</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN280"><span class='Ref_to_Member'>nadditional</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a> <span class='Operator'>- </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN278"><span class='Ref_to_Member'>nrequired</span></a><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN277"><span class='Ref_to_Member'>requiredEntries</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN278"><span class='Ref_to_Member'>nrequired</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN279"><span class='Ref_to_Member'>additionalEntries</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN280"><span class='Ref_to_Member'>nadditional</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN278"><span class='Ref_to_Member'>nrequired</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN277"><span class='Ref_to_Member'>requiredEntries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>]]; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN280"><span class='Ref_to_Member'>nadditional</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN279"><span class='Ref_to_Member'>additionalEntries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN454"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN456"><span class='Ref_To_Local'>entryIndexes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN455"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>]]; 
</span> 
        <span class='Comment_Multi_Line'>/* clean up after consistentFn calls (also frees entryIndexes) */ 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN348"><span class='Ref_to_Member'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if key-&GT;nentries&GT;1 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN358"><span class='Ref_to_Member'>keyCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN278"><span class='Ref_to_Member'>nrequired</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN280"><span class='Ref_to_Member'>nadditional</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN277"><span class='Ref_to_Member'>requiredEntries</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN277"><span class='Ref_to_Member'>requiredEntries</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginget.c.html#LN451"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN453"><span class='Ref_To_Local'>oldCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end startScanKey &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN535"></a><span class='Declare_Function'>startScan</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN537"></a>    <a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a><span class='Parentheses'>) </span><a href="ginget.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN538"></a>    <a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ginstate</span> <span class='Operator'>= &</span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>; 
</span><a name="LN539"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN355"><span class='Ref_to_Member'>totalentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="ginget.c.html#LN295"><span class='Ref_to_Func'>startScanEntry</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN538"><span class='Ref_To_Local'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN354"><span class='Ref_to_Member'>entries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="ginget.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN23"><span class='Ref_to_Global_Var'>GinFuzzySearchLimit</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If all of keys more than threshold we will try to reduce result, we 
         * hope (and only hope, for intersection operation of array our 
         * supposition isn't true), that total result will not more than 
         * minimal predictNumberResult. 
         */ 
</span><a name="LN552"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>reduce</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN355"><span class='Ref_to_Member'>totalentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN354"><span class='Ref_to_Member'>entries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>&LT;= </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN355"><span class='Ref_to_Member'>totalentries</span></a> <span class='Operator'>* </span><a href="ginget.c.html#LN23"><span class='Ref_to_Global_Var'>GinFuzzySearchLimit</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN552"><span class='Ref_To_Local'>reduce</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN552"><span class='Ref_To_Local'>reduce</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN355"><span class='Ref_to_Member'>totalentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN354"><span class='Ref_to_Member'>entries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN342"><span class='Ref_to_Member'>predictNumberResult</span></a> <span class='Operator'>/= </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN355"><span class='Ref_to_Member'>totalentries</span></a><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN354"><span class='Ref_to_Member'>entries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN341"><span class='Ref_to_Member'>reduceResult</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if GinFuzzySearchLimit&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now that we have the estimates for the entry frequencies, finish 
     * initializing the scan keys. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="ginget.c.html#LN450"><span class='Ref_to_Func'>startScanKey</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN538"><span class='Ref_To_Local'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN537"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN351"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN539"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end startScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Load the next batch of item pointers from a posting tree. 
 * 
 * Note that we copy the page into GinScanEntry-&GT;list array and unlock it, but 
 * keep it pinned to prevent interference with vacuum. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN587"></a><span class='Declare_Function'>entryLoadMoreItems</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Parameter'>entry</span><span class='Delimiter'>, 
</span><a name="LN588"></a>                   <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Parameter'>advancePast</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN590"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN591"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN592"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>stepright</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have two strategies for finding the correct page: step right from 
     * the current page, or descend the tree again from the root. If 
     * advancePast equals the current item, the next matching item should be 
     * on the next page, so we step right. Otherwise, descend from root. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN592"><span class='Ref_To_Local'>stepright</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN613"></a>        <a href="../../../include/access/gin_private.h.html#LN121"><span class='Ref_to_Struct'>GinBtreeStack</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stack</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set the search key, and find the correct leaf page. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN343"><span class='Ref_to_Member'>btree</span></a><span class='Operator'>.</span><a href="../../../include/access/gin_private.h.html#LN171"><span class='Ref_to_Member'>itemptr</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN343"><span class='Ref_to_Member'>btree</span></a><span class='Operator'>.</span><a href="../../../include/access/gin_private.h.html#LN171"><span class='Ref_to_Member'>itemptr</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN343"><span class='Ref_to_Member'>btree</span></a><span class='Operator'>.</span><a href="../../../include/access/gin_private.h.html#LN162"><span class='Ref_to_Member'>fullScan</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN613"><span class='Ref_To_Local'>stack</span></a> <span class='Operator'>= </span><a href="ginbtree.c.html#LN74"><span class='Ref_to_Func'>ginFindLeafPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN343"><span class='Ref_to_Member'>btree</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* we don't need the stack, just the buffer. */ 
</span>        <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN613"><span class='Ref_To_Local'>stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN124"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN177"><span class='Ref_to_Proto'>IncrBufferRefCount</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginbtree.c.html#LN191"><span class='Ref_to_Func'>freeGinBtreeStack</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN613"><span class='Ref_To_Local'>stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN592"><span class='Ref_To_Local'>stepright</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"entryLoadMoreItems, %u/%u, skip: %d"</span><span class='Delimiter'>, 
</span>         <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <span class='Operator'>!</span><a href="ginget.c.html#LN592"><span class='Ref_To_Local'>stepright</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN592"><span class='Ref_To_Local'>stepright</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We've processed all the entries on this page. If it was the 
             * last page in the tree, we're done. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN127"><span class='Ref_to_Macro'>GinPageRightMost</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Step to next page, following the right link. then find the 
             * first ItemPointer greater than advancePast. 
             */ 
</span>            <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="ginbtree.c.html#LN163"><span class='Ref_to_Func'>ginStepRight</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, 
</span>                                         <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN52"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stepright &raquo; </span> 
        <a href="ginget.c.html#LN592"><span class='Ref_To_Local'>stepright</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN108"><span class='Ref_to_Macro'>GinPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>flags <span class='Operator'>& </span><a href="../../../include/access/ginblock.h.html#LN40"><span class='Ref_to_Const'>GIN_DELETED</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* page was deleted by concurrent vacuum */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The first item &GT; advancePast might not be on this page, but 
         * somewhere to the right, if the page was split, or a non-match from 
         * another key in the query allowed us to skip some items from this 
         * entry. Keep following the right-links until we re-find the correct 
         * page. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/ginblock.h.html#LN127"><span class='Ref_to_Macro'>GinPageRightMost</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN278"><span class='Ref_to_Macro'>GinDataPageGetRightBound</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * the item we're looking is &GT; the right bound of the page, so it 
             * can't be on this page. 
             */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a> <span class='Operator'>= </span><a href="gindatapage.c.html#LN132"><span class='Ref_to_Func'>GinDataLeafPageGetItems</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN591"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN591"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN591"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN588"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN591"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN591"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN127"><span class='Ref_to_Macro'>GinPageRightMost</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN590"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* after processing the copied items, we're done. */ 
</span>                    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN587"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end entryLoadMoreItems &raquo; </span> 
 
<a name="LN725"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>gin_rand</span><span class='Parentheses'>() (((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../port/random.c.html#LN20"><span class='Ref_to_Func'>random</span></a><span class='Parentheses'>())</span> <span class='Operator'>/ </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/pg_config_manual.h.html#LN199"><span class='Ref_to_Const'>MAX_RANDOM_VALUE</span></a><span class='Parentheses'>))</span> 
<a name="LN726"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>dropItem</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>e</span><span class='Parentheses'>) (</span> <a href="ginget.c.html#LN725"><span class='Ref_to_Macro'>gin_rand</span></a><span class='Parentheses'>()</span> <span class='Operator'>&GT; </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>)</span><a href="ginget.c.html#LN23"><span class='Ref_to_Global_Var'>GinFuzzySearchLimit</span></a><span class='Parentheses'>)</span><span class='Operator'>/</span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>)((</span><a href="ginget.c.html#LN726"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>predictNumberResult<span class='Parentheses'>))</span> <span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Sets entry-&GT;curItem to next heap item pointer &GT; advancePast, for one entry 
 * of one scan key, or sets entry-&GT;isFinished to TRUE if there are no more. 
 * 
 * Item pointers are returned in ascending order. 
 * 
 * Note: this can return a "lossy page" item pointer, indicating that the 
 * entry potentially matches all items on that heap page.  However, it is 
 * not allowed to return both a lossy page pointer and exact (regular) 
 * item pointers for the same page.  (Doing so would break the key-combination 
 * logic in keyGetItem and scanGetItem; see comment in scanGetItem.)  In the 
 * current implementation this is guaranteed by the behavior of tidbitmaps. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN742"></a><span class='Declare_Function'>entryGetItem</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Parameter'>entry</span><span class='Delimiter'>, 
</span><a name="LN743"></a>             <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Parameter'>advancePast</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/itemptr.h.html#LN58"><span class='Ref_to_Macro'>ItemPointerIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>           <a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN331"><span class='Ref_to_Member'>matchBitmap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* A bitmap result */ 
</span><a name="LN753"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>advancePastBlk</span> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN754"></a>        <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>advancePastOff</span> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN755"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>gotitem</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>do</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we've exhausted all items on this block, move to next block 
             * in the bitmap. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>                   <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                    <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>&GT;= </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                   <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN753"><span class='Ref_To_Local'>advancePastBlk</span></a> <span class='Operator'>|| 
</span>                   <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                    <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a> <span class='Operator'>== </span><a href="ginget.c.html#LN753"><span class='Ref_To_Local'>advancePastBlk</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/tidbitmap.h.html#LN66"><span class='Ref_to_Proto'>tbm_iterate</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/nodes/tidbitmap.h.html#LN68"><span class='Ref_to_Proto'>tbm_end_iterate</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN332"><span class='Ref_to_Member'>matchIterator</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset counter to the beginning of entry-&GT;matchResult. Note: 
                 * entry-&GT;offset is still greater than matchResult-&GT;ntuples if 
                 * matchResult is lossy.  So, on next call we will get next 
                 * result from TIDBitmap. 
                 */ 
</span>                <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while entry-&GT;matchResult==N... &raquo; </span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We're now on the first page after advancePast which has any 
             * items on it. If it's a lossy result, return that. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/ginblock.h.html#LN166"><span class='Ref_to_Macro'>ItemPointerSetLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, 
</span>                                        <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We might as well fall out of the loop; we could not 
                 * estimate number of results on this page to support correct 
                 * reducing of result even if it's enabled. 
                 */ 
</span>                <a href="ginget.c.html#LN755"><span class='Ref_To_Local'>gotitem</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Not a lossy page. Skip over any offsets &LT;= advancePast, and 
             * return that. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a> <span class='Operator'>== </span><a href="ginget.c.html#LN753"><span class='Ref_To_Local'>advancePastBlk</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * First, do a quick check against the last offset on the 
                 * page. If that's &GT; advancePast, so are all the other 
                 * offsets. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN45"><span class='Ref_to_Member'>offsets</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><a href="ginget.c.html#LN754"><span class='Ref_To_Local'>advancePastOff</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN42"><span class='Ref_to_Member'>ntuples</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* Otherwise scan to find the first item &GT; advancePast */ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN45"><span class='Ref_to_Member'>offsets</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><a href="ginget.c.html#LN754"><span class='Ref_To_Local'>advancePastOff</span></a><span class='Parentheses'>) 
</span>                    <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, 
</span>                           <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN41"><span class='Ref_to_Member'>blockno</span></a><span class='Delimiter'>, 
</span>                           <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN333"><span class='Ref_to_Member'>matchResult</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/tidbitmap.h.html#LN45"><span class='Ref_to_Member'>offsets</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN755"><span class='Ref_To_Local'>gotitem</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN755"><span class='Ref_To_Local'>gotitem</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN341"><span class='Ref_to_Member'>reduceResult</span></a> <span class='Operator'>== </span><span class='Boolean'>TRUE </span><span class='Operator'>&& </span><a href="ginget.c.html#LN726"><span class='Ref_to_Macro'>dropItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if entry-&GT;matchBitmap &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN325"><span class='Ref_to_Member'>buffer</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * A posting list from an entry tuple, or the last page of a posting 
         * tree. 
         */ 
</span>        <span class='Control'>do</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>&GT;= </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* XXX: shouldn't we apply the fuzzy search limit here? */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* A posting tree */ 
</span>        <span class='Control'>do</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* If we've processed the current batch, load more items */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a> <span class='Operator'>&GT;= </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN337"><span class='Ref_to_Member'>nlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN586"><span class='Ref_to_Func'>entryLoadMoreItems</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN336"><span class='Ref_to_Member'>list</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN338"><span class='Ref_to_Member'>offset</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN743"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 <span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN341"><span class='Ref_to_Member'>reduceResult</span></a> <span class='Operator'>== </span><span class='Boolean'>TRUE </span><span class='Operator'>&& </span><a href="ginget.c.html#LN726"><span class='Ref_to_Macro'>dropItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN742"><span class='Ref_to_Parameter'>entry</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end entryGetItem &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Identify the "current" item among the input entry streams for this scan key 
 * that is greater than advancePast, and test whether it passes the scan key 
 * qual condition. 
 * 
 * The current item is the smallest curItem among the inputs.  key-&GT;curItem 
 * is set to that value.  key-&GT;curItemMatches is set to indicate whether that 
 * TID passes the consistentFn test.  If so, key-&GT;recheckCurItem is set true 
 * iff recheck is needed for this item pointer (including the case where the 
 * item pointer is a lossy page pointer). 
 * 
 * If all entry streams are exhausted, sets key-&GT;isFinished to TRUE. 
 * 
 * Item pointers must be returned in ascending order. 
 * 
 * Note: this can return a "lossy page" item pointer, indicating that the 
 * key potentially matches all items on that heap page.  However, it is 
 * not allowed to return both a lossy page pointer and exact (regular) 
 * item pointers for the same page.  (Doing so would break the key-combination 
 * logic in scanGetItem.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN904"></a><span class='Declare_Function'>keyGetItem</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>tempCtx</span><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN905"></a>           <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Parameter'>advancePast</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN907"></a>    <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>minItem</span><span class='Delimiter'>; 
</span><a name="LN908"></a>    <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>curPageLossy</span><span class='Delimiter'>; 
</span><a name="LN909"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN910"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>haveLossyEntry</span><span class='Delimiter'>; 
</span><a name="LN911"></a>    <a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN912"></a>    <a href="../../../include/access/gin.h.html#LN56"><span class='Ref_to_Typedef'>GinTernaryValue</span></a> <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN913"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCtx</span><span class='Delimiter'>; 
</span><a name="LN914"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>allFinished</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN310"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We might have already tested this item; if so, no need to repeat work. 
     * (Note: the "&GT;" case can happen, if advancePast is exact but we 
     * previously had to set curItem to a lossy-page pointer.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the minimum item &GT; advancePast among the active entry streams. 
     * 
     * Note: a lossy-page entry is encoded by a ItemPointer with max value for 
     * offset (0xffff), so that it will sort after any exact entries for the 
     * same page.  So we'll prefer to return exact pointers not lossy 
     * pointers, which is good. 
     */ 
</span>    <a href="../../../include/access/ginblock.h.html#LN161"><span class='Ref_to_Macro'>ItemPointerSetMax</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN914"><span class='Ref_To_Local'>allFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN278"><span class='Ref_to_Member'>nrequired</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN277"><span class='Ref_to_Member'>requiredEntries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Advance this stream if necessary. 
         * 
         * In particular, since entry-&GT;curItem was initialized with 
         * ItemPointerSetMin, this ensures we fetch the first item for each 
         * entry on the first call. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginget.c.html#LN741"><span class='Ref_to_Func'>entryGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="ginget.c.html#LN914"><span class='Ref_To_Local'>allFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key-&GT;nrequired;... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN914"><span class='Ref_To_Local'>allFinished</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* all entries are finished */ 
</span>        <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN310"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ok, we now know that there are no matches &LT; minItem. 
     * 
     * If minItem is lossy, it means that there were no exact items on the 
     * page among requiredEntries, because lossy pointers sort after exact 
     * items. However, there might be exact items for the same page among 
     * additionalEntries, so we mustn't advance past them. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; 
</span>            <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../../../include/storage/off.h.html#LN54"><span class='Ref_to_Macro'>OffsetNumberPrev</span></a><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We might not have loaded all the entry streams for this TID yet. We 
     * could call the consistent function, passing MAYBE for those entries, to 
     * see if it can decide if this TID matches based on the information we 
     * have. But if the consistent-function is expensive, and cannot in fact 
     * decide with partial information, that could be a big loss. So, load all 
     * the additional entries, before calling the consistent function. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN280"><span class='Ref_to_Member'>nadditional</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN279"><span class='Ref_to_Member'>additionalEntries</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginget.c.html#LN741"><span class='Ref_to_Func'>entryGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN905"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Normally, none of the items in additionalEntries can have a curItem 
         * larger than minItem. But if minItem is a lossy page, then there 
         * might be exact items on the same page among additionalEntries. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key-&GT;nadditiona... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Ok, we've advanced all the entries up to minItem now. Set key-&GT;curItem, 
     * and perform consistentFn test. 
     * 
     * Lossy-page entries pose a problem, since we don't know the correct 
     * entryRes state to pass to the consistentFn, and we also don't know what 
     * its combining logic will be (could be AND, OR, or even NOT). If the 
     * logic is OR then the consistentFn might succeed for all items in the 
     * lossy page even when none of the other entries match. 
     * 
     * Our strategy is to call the tri-state consistent function, with the 
     * lossy-page entries set to MAYBE, and all the other entries FALSE. If it 
     * returns FALSE, none of the lossy items alone are enough for a match, so 
     * we don't need to return a lossy-page pointer. Otherwise, return a 
     * lossy-page pointer to indicate that the whole heap page must be 
     * checked.  (On subsequent calls, we'll do nothing until minItem is past 
     * the page altogether, thus ensuring that we never return both regular 
     * and lossy pointers for the same page.) 
     * 
     * An exception is that it doesn't matter what we pass for lossy pointers 
     * in "hidden" entries, because the consistentFn's result can't depend on 
     * them. We could pass them as MAYBE as well, but if we're using the 
     * "shim" implementation of a tri-state consistent function (see 
     * ginlogic.c), it's better to pass as few MAYBEs as possible. So pass 
     * them as TRUE. 
     * 
     * Note that only lossy-page entries pointing to the current item's page 
     * should trigger this processing; we might have future lossy pages in the 
     * entry array, but they aren't relevant yet. 
     */ 
</span>    <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/access/ginblock.h.html#LN166"><span class='Ref_to_Macro'>ItemPointerSetLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN908"><span class='Ref_To_Local'>curPageLossy</span></a><span class='Delimiter'>, 
</span>                            <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN910"><span class='Ref_To_Local'>haveLossyEntry</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a> <span class='Operator'>== </span><span class='Boolean'>FALSE </span><span class='Operator'>&& 
</span>            <a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN908"><span class='Ref_To_Local'>curPageLossy</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN264"><span class='Ref_to_Member'>nuserentries</span></a><span class='Parentheses'>) 
</span>                <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN60"><span class='Ref_to_Const'>GIN_MAYBE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN59"><span class='Ref_to_Const'>GIN_TRUE</span></a><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN910"><span class='Ref_To_Local'>haveLossyEntry</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* prepare for calling consistentFn in temp context */ 
</span>    <a href="ginget.c.html#LN913"><span class='Ref_To_Local'>oldCtx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN910"><span class='Ref_To_Local'>haveLossyEntry</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Have lossy-page entries, so see if whole page matches */ 
</span>        <a href="ginget.c.html#LN912"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN285"><span class='Ref_to_Member'>triConsistentFn</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN912"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><a href="../../../include/access/gin.h.html#LN59"><span class='Ref_to_Const'>GIN_TRUE</span></a> <span class='Operator'>|| </span><a href="ginget.c.html#LN912"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><a href="../../../include/access/gin.h.html#LN60"><span class='Ref_to_Const'>GIN_MAYBE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Yes, so clean up ... */ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN913"><span class='Ref_To_Local'>oldCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* and return lossy pointer for whole page */ 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN908"><span class='Ref_To_Local'>curPageLossy</span></a><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN309"><span class='Ref_to_Member'>recheckCurItem</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * At this point we know that we don't need to return a lossy whole-page 
     * pointer, but we might have matches for individual exact item pointers, 
     * possibly in combination with a lossy pointer. Pass lossy pointers as 
     * MAYBE to the ternary consistent function, to let it decide if this 
     * tuple satisfies the overall key, even though we don't know if the lossy 
     * entries match. 
     * 
     * Prepare entryRes array to be passed to consistentFn. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN340"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'> 
        /* 
         * This case can't currently happen, because we loaded all the entries 
         * for this item earlier. 
         */ 
        else if (ginCompareItemPointers(&entry-&GT;curItem, &advancePast) &LT;= 0) 
            key-&GT;entryRes[i] = GIN_MAYBE; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN908"><span class='Ref_To_Local'>curPageLossy</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN60"><span class='Ref_to_Const'>GIN_MAYBE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN911"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN328"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN907"><span class='Ref_To_Local'>minItem</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN59"><span class='Ref_to_Const'>GIN_TRUE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN909"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key-&GT;nentries;i... &raquo; </span> 
 
    <a href="ginget.c.html#LN912"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN285"><span class='Ref_to_Member'>triConsistentFn</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN912"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/gin.h.html#LN59"><span class='Ref_to_Const'>GIN_TRUE</span></a><span class='Operator'>: 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* triConsistentFn set recheckCurItem */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Operator'>: 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/gin.h.html#LN60"><span class='Ref_to_Const'>GIN_MAYBE</span></a><span class='Operator'>: 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN309"><span class='Ref_to_Member'>recheckCurItem</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * the 'default' case shouldn't happen, but if the consistent 
             * function returns something bogus, this is the safe result 
             */ 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN309"><span class='Ref_to_Member'>recheckCurItem</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch res &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We have a tuple, and we know if it matches or not. If it's a non-match, 
     * we could continue to find the next matching tuple, but let's break out 
     * and give scanGetItem a chance to advance the other keys. They might be 
     * able to skip past to a much higher TID, allowing us to save work. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* clean up after consistentFn calls */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN913"><span class='Ref_To_Local'>oldCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN904"><span class='Ref_to_Parameter'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end keyGetItem &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get next heap item pointer (after advancePast) from scan. 
 * Returns true if anything found. 
 * On success, *item and *recheck are set. 
 * 
 * Note: this is very nearly the same logic as in keyGetItem(), except 
 * that we know the keys are to be combined with AND logic, whereas in 
 * keyGetItem() the combination logic is known only to the consistentFn. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1184"></a><span class='Declare_Function'>scanGetItem</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Parameter'>advancePast</span><span class='Delimiter'>, 
</span><a name="LN1185"></a>            <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>item</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>recheck</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1187"></a>    <a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a><span class='Parentheses'>) </span><a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1188"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1189"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Advance the scan keys in lock-step, until we find an item that matches 
     * all the keys. If any key reports isFinished, meaning its subset of the 
     * entries is exhausted, we can stop.  Otherwise, set *item to the next 
     * matching item. 
     * 
     * This logic works only if a keyGetItem stream can never contain both 
     * exact and lossy pointers for the same page.  Else we could have a 
     * case like 
     * 
     *      stream 1        stream 2 
     *      ...             ... 
     *      42/6            42/7 
     *      50/1            42/0xffff 
     *      ...             ... 
     * 
     * We would conclude that 42/6 is not a match and advance stream 1, 
     * thus never detecting the match to the lossy pointer in stream 2. 
     * (keyGetItem has a similar problem versus entryGetItem.) 
     *---------- 
     */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/access/ginblock.h.html#LN156"><span class='Ref_to_Macro'>ItemPointerSetMin</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN1189"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1187"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>&& </span><a href="ginget.c.html#LN1189"><span class='Ref_To_Local'>match</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1218"></a>            <a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a>  <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1187"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN351"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Fetch the next item for this key that is &GT; advancePast. */ 
</span>            <a href="ginget.c.html#LN903"><span class='Ref_to_Func'>keyGetItem</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1187"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1187"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN348"><span class='Ref_to_Member'>tempCtx</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, 
</span>                       <a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN310"><span class='Ref_to_Member'>isFinished</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If it's not a match, we can immediately conclude that nothing 
             * &LT;= this item matches, without checking the rest of the keys. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN308"><span class='Ref_to_Member'>curItemMatches</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>advancePast</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN1189"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * It's a match. We can conclude that nothing &LT; matches, so the 
             * other key streams can skip to this item. 
             * 
             * Beware of lossy pointers, though; from a lossy pointer, we can 
             * only conclude that nothing smaller than this *block* matches. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; 
</span>                    <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/storage/itemptr.h.html#LN103"><span class='Ref_to_Macro'>ItemPointerSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1184"><span class='Ref_to_Parameter'>advancePast</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/storage/off.h.html#LN54"><span class='Ref_to_Macro'>OffsetNumberPrev</span></a><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN136"><span class='Ref_to_Macro'>GinItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this is the first key, remember this location as a potential 
             * match, and proceed to check the rest of the keys. 
             * 
             * Otherwise, check if this is the same item that we checked the 
             * previous keys for (or a lossy pointer for the same page). If 
             * not, loop back to check the previous keys for this item (we 
             * will check this key again too, but keyGetItem returns quickly 
             * for that) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                    <a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="ginget.c.html#LN1189"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Parentheses'>) </span><span class='Operator'>== 
</span>                             <a href="../../../include/access/ginblock.h.html#LN133"><span class='Ref_to_Macro'>GinItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="ginget.c.html#LN1189"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN459"><span class='Ref_to_Func'>ginCompareItemPointers</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1218"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN307"><span class='Ref_to_Member'>curItem</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;so-&GT;nkeys&&matc... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN1189"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/ginblock.h.html#LN158"><span class='Ref_to_Macro'>ItemPointerIsMin</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now *item contains the first ItemPointer after previous result that 
     * satisfied all the keys for that exact TID, or a lossy reference to the 
     * same page. 
     * 
     * We must return recheck = true if any of the keys are marked recheck. 
     */ 
</span>    <span class='Operator'>*</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1187"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1307"></a>        <a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a>  <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1187"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN351"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN1188"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1307"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN309"><span class='Ref_to_Member'>recheckCurItem</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="ginget.c.html#LN1185"><span class='Ref_to_Parameter'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>TRUE</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end scanGetItem &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Functions for scanning the pending list 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get ItemPointer of next heap row to be checked from pending list. 
 * Returns false if there are no more. On pages with several heap rows 
 * it returns each row separately, on page with part of heap row returns 
 * per page data.  pos-&GT;firstOffset and pos-&GT;lastOffset are set to identify 
 * the range of pending-list tuples belonging to this heap row. 
 * 
 * The pendingBuffer is presumed pinned and share-locked on entry, and is 
 * pinned and share-locked on success exit.  On failure exit it's released. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1336"></a><span class='Declare_Function'>scanGetCandidate</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN25"><span class='Ref_to_Struct'>pendingPosition</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1338"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN1339"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1340"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN30"><span class='Ref_to_Member'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN1338"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a> <span class='Operator'>&GT; </span><a href="ginget.c.html#LN1338"><span class='Ref_To_Local'>maxoff</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1351"></a>            <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN108"><span class='Ref_to_Macro'>GinPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rightlink<span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1351"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Here we must prevent deletion of next page by insertcleanup 
                 * process, which may be trying to obtain exclusive lock on 
                 * current page.  So, we lock next page before releasing the 
                 * current one 
                 */ 
</span><a name="LN1368"></a>                <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>tmpbuf</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1351"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1368"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1368"><span class='Ref_To_Local'>tmpbuf</span></a><span class='Delimiter'>; 
</span>                <a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pos-&GT;firstOffset&GT;maxo... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginget.c.html#LN1340"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN30"><span class='Ref_to_Member'>item</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1340"><span class='Ref_To_Local'>itup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN117"><span class='Ref_to_Macro'>GinPageHasFullRow</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * find itempointer to the next row 
                 */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a> <span class='Operator'>&LT;= </span><a href="ginget.c.html#LN1338"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="ginget.c.html#LN1340"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1339"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN30"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1340"><span class='Ref_To_Local'>itup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Parentheses'>))</span> 
                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * All itempointers are the same on this page 
                 */ 
</span>                <a href="ginget.c.html#LN1336"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1338"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Now pos-&GT;firstOffset points to the first tuple of current heap 
             * row, pos-&GT;lastOffset points to the first tuple of next heap row 
             * (or to the end of page) 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end scanGetCandidate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Scan pending-list page from current tuple (off) up till the first of: 
 * - match is found (then returns true) 
 * - no later match is possible 
 * - tuple's attribute number is not equal to entry's attrnum 
 * - reach end of page 
 * 
 * datum[]/category[]/datumExtracted[] arrays are used to cache the results 
 * of gintuple_get_key() on the current page. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1424"></a><span class='Declare_Function'>matchPartialInPendingList</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a> <span class='Declare_Parameter'>page</span><span class='Delimiter'>, 
</span><a name="LN1425"></a>                          <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>off</span><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>maxoff</span><span class='Delimiter'>, 
</span><a name="LN1426"></a>                          <a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Parameter'>entry</span><span class='Delimiter'>, 
</span><a name="LN1427"></a>                          <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datum</span><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>category</span><span class='Delimiter'>, 
</span><a name="LN1428"></a>                          <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>datumExtracted</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1430"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN1431"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Partial match to a null is not possible */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN317"><span class='Ref_to_Member'>queryCategory</span></a> <span class='Operator'>!= </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>maxoff</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="ginget.c.html#LN1430"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1424"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1424"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN102"><span class='Ref_to_Proto'>gintuple_get_attrnum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1424"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1430"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1428"><span class='Ref_to_Parameter'>datumExtracted</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="ginget.c.html#LN1427"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN103"><span class='Ref_to_Proto'>gintuple_get_key</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1424"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1430"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="ginget.c.html#LN1427"><span class='Ref_to_Parameter'>category</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginget.c.html#LN1428"><span class='Ref_to_Parameter'>datumExtracted</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Once we hit nulls, no further match is possible */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1427"><span class='Ref_to_Parameter'>category</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/*---------- 
         * Check partial match. 
         * case cmp == 0 =&GT; match 
         * case cmp &GT; 0 =&GT; not match and end scan (no later match possible) 
         * case cmp &LT; 0 =&GT; not match and continue scan 
         *---------- 
         */ 
</span>        <a href="ginget.c.html#LN1431"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN517"><span class='Ref_to_Proto'>FunctionCall4Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1424"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN77"><span class='Ref_to_Member'>comparePartialFn</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                               <a href="ginget.c.html#LN1424"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                              <a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN316"><span class='Ref_to_Member'>queryKey</span></a><span class='Delimiter'>, 
</span>                                              <a href="ginget.c.html#LN1427"><span class='Ref_to_Parameter'>datum</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                              <a href="../../../include/postgres.h.html#LN470"><span class='Ref_to_Macro'>UInt16GetDatum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN320"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1426"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN319"><span class='Ref_to_Member'>extra_data</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1431"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1431"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN1425"><span class='Ref_to_Parameter'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while off&LT;maxoff &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end matchPartialInPendingList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set up the entryRes array for each key by looking at 
 * every entry for current heap row in pending list. 
 * 
 * Returns true if each scan key has at least one entryRes match. 
 * This corresponds to the situations where the normal index search will 
 * try to apply the key's consistentFn.  (A tuple not meeting that requirement 
 * cannot be returned by the normal search since no entry stream will 
 * source its TID.) 
 * 
 * The pendingBuffer is presumed pinned and share-locked on entry. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1492"></a><span class='Declare_Function'>collectMatchesForHeapRow</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN25"><span class='Ref_to_Struct'>pendingPosition</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1494"></a>    <a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a><span class='Parentheses'>) </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1495"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>attrnum</span><span class='Delimiter'>; 
</span><a name="LN1496"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1497"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN1498"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1499"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reset all entryRes and hasMatchKey flags 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1506"></a>        <a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a>  <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN351"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="ginget.c.html#LN1506"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN58"><span class='Ref_to_Const'>GIN_FALSE</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1506"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    memset<span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN31"><span class='Ref_to_Member'>hasMatchKey</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Outer loop iterates over multiple pending-list pages when a single heap 
     * row has entries spanning those pages. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1518"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>[</span>BLCKSZ <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN34"><span class='Ref_to_Struct'>IndexTupleData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]; 
</span><a name="LN1519"></a>        <a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Local'>category</span><span class='Delimiter'>[</span>BLCKSZ <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN34"><span class='Ref_to_Struct'>IndexTupleData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]; 
</span><a name="LN1520"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>datumExtracted</span><span class='Delimiter'>[</span>BLCKSZ <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN34"><span class='Ref_to_Struct'>IndexTupleData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a> <span class='Operator'>&GT; </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="ginget.c.html#LN1520"><span class='Ref_To_Local'>datumExtracted</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a> <span class='Operator'>- </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1531"></a>            <a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a>  <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN351"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN262"><span class='Ref_to_Member'>nentries</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1535"></a>                <a href="../../../include/access/gin_private.h.html#LN257"><span class='Ref_to_Typedef'>GinScanEntry</span></a> <span class='Declare_Local'>entry</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN267"><span class='Ref_to_Member'>scanEntry</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span><a name="LN1536"></a>                <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>StopLow</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a><span class='Delimiter'>, 
</span><a name="LN1537"></a>                            <span class='Declare_Local'>StopHigh</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a><span class='Delimiter'>, 
</span><a name="LN1538"></a>                            <span class='Declare_Local'>StopMiddle</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* If already matched on earlier page, do no extra work */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Interesting tuples are from pos-&GT;firstOffset to 
                 * pos-&GT;lastOffset and they are ordered by (attnum, Datum) as 
                 * it's done in entry tree.  So we can use binary search to 
                 * avoid linear scanning. 
                 */ 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1536"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1537"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1552"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
                    <a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1536"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="ginget.c.html#LN1537"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>- </span><a href="ginget.c.html#LN1536"><span class='Ref_To_Local'>StopLow</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="ginget.c.html#LN1497"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="ginget.c.html#LN1495"><span class='Ref_To_Local'>attrnum</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN102"><span class='Ref_to_Proto'>gintuple_get_attrnum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1497"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN298"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1495"><span class='Ref_To_Local'>attrnum</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="ginget.c.html#LN1537"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN298"><span class='Ref_to_Member'>attnum</span></a> <span class='Operator'>&GT; </span><a href="ginget.c.html#LN1495"><span class='Ref_To_Local'>attrnum</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="ginget.c.html#LN1536"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1520"><span class='Ref_To_Local'>datumExtracted</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="ginget.c.html#LN1518"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                            <a href="../../../include/access/gin_private.h.html#LN103"><span class='Ref_to_Proto'>gintuple_get_key</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1497"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="ginget.c.html#LN1519"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="ginget.c.html#LN1520"><span class='Ref_To_Local'>datumExtracted</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN317"><span class='Ref_to_Member'>queryCategory</span></a> <span class='Operator'>== </span><a href="../../../include/access/ginblock.h.html#LN202"><span class='Ref_to_Const'>GIN_CAT_EMPTY_QUERY</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* special behavior depending on searchMode */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN321"><span class='Ref_to_Member'>searchMode</span></a> <span class='Operator'>== </span><a href="../../../include/access/gin.h.html#LN34"><span class='Ref_to_Const'>GIN_SEARCH_MODE_ALL</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* match anything except NULL_ITEM */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1519"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/ginblock.h.html#LN201"><span class='Ref_to_Const'>GIN_CAT_NULL_ITEM</span></a><span class='Parentheses'>) 
</span>                                <a href="ginget.c.html#LN1552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="ginget.c.html#LN1552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* match everything */ 
</span>                            <a href="ginget.c.html#LN1552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="ginget.c.html#LN1552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN92"><span class='Ref_to_Proto'>ginCompareEntries</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, 
</span>                                                <a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN322"><span class='Ref_to_Member'>attnum</span></a><span class='Delimiter'>, 
</span>                                                <a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN316"><span class='Ref_to_Member'>queryKey</span></a><span class='Delimiter'>, 
</span>                                                <a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN317"><span class='Ref_to_Member'>queryCategory</span></a><span class='Delimiter'>, 
</span>                                                <a href="ginget.c.html#LN1518"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                                <a href="ginget.c.html#LN1519"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Found exact match (there can be only one, except in 
                         * EMPTY_QUERY mode). 
                         * 
                         * If doing partial match, scan forward from here to 
                         * end of page to check for matches. 
                         * 
                         * See comment above about tuple's ordering. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN318"><span class='Ref_to_Member'>isPartialMatch</span></a><span class='Parentheses'>) 
</span>                            <a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                                <a href="ginget.c.html#LN1423"><span class='Ref_to_Func'>matchPartialInPendingList</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1518"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1519"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>, 
</span>                                                          <a href="ginget.c.html#LN1520"><span class='Ref_To_Local'>datumExtracted</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* done with binary search */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if res==0 &raquo; </span> 
                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1552"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="ginget.c.html#LN1537"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="ginget.c.html#LN1536"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1538"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while StopLow&LT;StopHigh &raquo; </span> 
 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1536"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>&GT;= </span><a href="ginget.c.html#LN1537"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>&& </span><a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN318"><span class='Ref_to_Member'>isPartialMatch</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * No exact match on this page.  If doing partial match, 
                     * scan from the first tuple greater than target value to 
                     * end of page.  Note that since we don't remember whether 
                     * the comparePartialFn told us to stop early on a 
                     * previous page, we will uselessly apply comparePartialFn 
                     * to the first tuple on each subsequent page. 
                     */ 
</span>                    <a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                        <a href="ginget.c.html#LN1423"><span class='Ref_to_Func'>matchPartialInPendingList</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN349"><span class='Ref_to_Member'>ginstate</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1537"><span class='Ref_To_Local'>StopHigh</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1535"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1518"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1519"><span class='Ref_To_Local'>category</span></a><span class='Delimiter'>, 
</span>                                                  <a href="ginget.c.html#LN1520"><span class='Ref_To_Local'>datumExtracted</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if StopLow&GT;=StopHigh&&en... &raquo; </span> 
 
                <a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN31"><span class='Ref_to_Member'>hasMatchKey</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|= </span><a href="ginget.c.html#LN1531"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN283"><span class='Ref_to_Member'>entryRes</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1499"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;key-&GT;nentries;j... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;so-&GT;nkeys;i++ &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Advance firstOffset over the scanned tuples */ 
</span>        <a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a> <span class='Operator'>= </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN29"><span class='Ref_to_Member'>lastOffset</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN117"><span class='Ref_to_Macro'>GinPageHasFullRow</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1496"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We have examined all pending entries for the current heap row. 
             * Break out of loop over pages. 
             */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Advance to next page of pending entries for the current heap 
             * row.  Complain if there isn't one. 
             */ 
</span><a name="LN1681"></a>            <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN30"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1335"><span class='Ref_to_Func'>scanGetCandidate</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Boolean'>false </span><span class='Operator'>|| 
</span>                <span class='Operator'>!</span><a href="../../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN30"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1681"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find additional pending pages for same heap tuple"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now return "true" if all scan keys have at least one matching datum 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1494"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1492"><span class='Ref_to_Parameter'>pos</span></a><span class='Operator'>-&GT;</span><a href="ginget.c.html#LN31"><span class='Ref_to_Member'>hasMatchKey</span></a><span class='Delimiter'>[</span><a href="ginget.c.html#LN1498"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end collectMatchesForHeapRow &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Collect all matched rows from pending list into bitmap 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1705"></a><span class='Declare_Function'>scanPendingInsert</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbm</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ntids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1707"></a>    <a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a><span class='Parentheses'>) </span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1708"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCtx</span><span class='Delimiter'>; 
</span><a name="LN1709"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>recheck</span><span class='Delimiter'>, 
</span><a name="LN1710"></a>                <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN1711"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1712"></a>    <a href="ginget.c.html#LN25"><span class='Ref_to_Struct'>pendingPosition</span></a> <span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span><a name="LN1713"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>metabuffer</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN49"><span class='Ref_to_Const'>GIN_METAPAGE_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1714"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1715"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>ntids</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1713"><span class='Ref_To_Local'>metabuffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN1714"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1713"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1714"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN1715"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN102"><span class='Ref_to_Macro'>GinPageGetMeta</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1714"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>head<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * fetch head of list before unlocking metapage. head page must be pinned 
     * to prevent deletion by vacuum process 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1715"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No pending list, so proceed with normal scan */ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1713"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>.</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1715"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>.</span><a href="ginget.c.html#LN27"><span class='Ref_to_Member'>pendingBuffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>.</span><a href="ginget.c.html#LN28"><span class='Ref_to_Member'>firstOffset</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1713"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>.</span><a href="ginget.c.html#LN31"><span class='Ref_to_Member'>hasMatchKey</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="ginget.c.html#LN1707"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * loop for each heap row. scanGetCandidate returns full row or row's 
     * tuples from first page. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1335"><span class='Ref_to_Func'>scanGetCandidate</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check entries in tuple and set up entryRes array. 
         * 
         * If pending tuples belonging to the current heap row are spread 
         * across several pages, collectMatchesForHeapRow will read all of 
         * those pages. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN1491"><span class='Ref_to_Func'>collectMatchesForHeapRow</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Matching of entries of one row is finished, so check row using 
         * consistent functions. 
         */ 
</span>        <a href="ginget.c.html#LN1708"><span class='Ref_To_Local'>oldCtx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1707"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN348"><span class='Ref_to_Member'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN1709"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN1710"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1711"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginget.c.html#LN1711"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginget.c.html#LN1707"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN352"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="ginget.c.html#LN1711"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1767"></a>            <a href="../../../include/access/gin_private.h.html#LN255"><span class='Ref_to_Typedef'>GinScanKey</span></a>  <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="ginget.c.html#LN1707"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN351"><span class='Ref_to_Member'>keys</span></a> <span class='Operator'>+ </span><a href="ginget.c.html#LN1711"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN1767"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN284"><span class='Ref_to_Member'>boolConsistentFn</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1767"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="ginget.c.html#LN1710"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="ginget.c.html#LN1709"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>|= </span><a href="ginget.c.html#LN1767"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN309"><span class='Ref_to_Member'>recheckCurItem</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1708"><span class='Ref_To_Local'>oldCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1707"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN348"><span class='Ref_to_Member'>tempCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1710"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/nodes/tidbitmap.h.html#LN54"><span class='Ref_to_Proto'>tbm_add_tuples</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>.</span><a href="ginget.c.html#LN30"><span class='Ref_to_Member'>item</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN1709"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ginget.c.html#LN1705"><span class='Ref_to_Parameter'>ntids</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while scanGetCandidate(scan... &raquo; </span> 
 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1712"><span class='Ref_To_Local'>pos</span></a><span class='Operator'>.</span><a href="ginget.c.html#LN31"><span class='Ref_to_Member'>hasMatchKey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end scanPendingInsert &raquo; </span> 
 
 
<a name="LN1791"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>GinIsVoidRes</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>)</span>     <span class='Parentheses'>(</span> <span class='Parentheses'>((</span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a><span class='Parentheses'>) </span>scan<span class='Operator'>-&GT;</span>opaque<span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>isVoidRes <span class='Parentheses'>)</span> 
 
<a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN1794"></a><span class='Declare_Function'>gingetbitmap</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1796"></a>    <a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN363"><span class='Ref_to_Typedef'>GinScanOpaque</span></a><span class='Parentheses'>) </span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1797"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>ntids</span><span class='Delimiter'>; 
</span><a name="LN1798"></a>    <a href="../../../include/storage/itemptr.h.html#LN35"><span class='Ref_to_Struct'>ItemPointerData</span></a> <span class='Declare_Local'>iptr</span><span class='Delimiter'>; 
</span><a name="LN1799"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>recheck</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up the scan keys, and check for unsatisfiable query. 
     */ 
</span>    <a href="ginscan.c.html#LN230"><span class='Ref_to_Func'>ginFreeScanKeys</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1796"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* there should be no keys yet, but just to be 
                                 * sure */ 
</span>    <a href="ginscan.c.html#LN260"><span class='Ref_to_Func'>ginNewScanKey</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginget.c.html#LN1791"><span class='Ref_to_Macro'>GinIsVoidRes</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="ginget.c.html#LN1797"><span class='Ref_To_Local'>ntids</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, scan the pending list and collect any matching entries into the 
     * bitmap.  After we scan a pending item, some other backend could post it 
     * into the main index, and so we might visit it a second time during the 
     * main scan.  This is okay because we'll just re-set the same bit in the 
     * bitmap.  (The possibility of duplicate visits is a major reason why GIN 
     * can't support the amgettuple API, however.) Note that it would not do 
     * to scan the main index before the pending list, since concurrent 
     * cleanup could then make us miss entries entirely. 
     */ 
</span>    <a href="ginget.c.html#LN1704"><span class='Ref_to_Func'>scanPendingInsert</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1797"><span class='Ref_To_Local'>ntids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now scan the main index. 
     */ 
</span>    <a href="ginget.c.html#LN534"><span class='Ref_to_Func'>startScan</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/ginblock.h.html#LN156"><span class='Ref_to_Macro'>ItemPointerSetMin</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1798"><span class='Ref_To_Local'>iptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginget.c.html#LN1183"><span class='Ref_to_Func'>scanGetItem</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="ginget.c.html#LN1798"><span class='Ref_To_Local'>iptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1798"><span class='Ref_To_Local'>iptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1799"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN168"><span class='Ref_to_Macro'>ItemPointerIsLossyPage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1798"><span class='Ref_To_Local'>iptr</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/nodes/tidbitmap.h.html#LN57"><span class='Ref_to_Proto'>tbm_add_page</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/itemptr.h.html#LN74"><span class='Ref_to_Macro'>ItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginget.c.html#LN1798"><span class='Ref_To_Local'>iptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/nodes/tidbitmap.h.html#LN54"><span class='Ref_to_Proto'>tbm_add_tuples</span></a><span class='Parentheses'>(</span><a href="ginget.c.html#LN1794"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="ginget.c.html#LN1798"><span class='Ref_To_Local'>iptr</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="ginget.c.html#LN1799"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="ginget.c.html#LN1797"><span class='Ref_To_Local'>ntids</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="ginget.c.html#LN1797"><span class='Ref_To_Local'>ntids</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gingetbitmap &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>