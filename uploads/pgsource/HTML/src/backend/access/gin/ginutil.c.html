<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\gin\ginutil.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\gin\ginutil.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:28 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * ginutil.c 
 *    Utility routines for the Postgres inverted index access method. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *          src/backend/access/gin/ginutil.c 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/gin_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/ginxlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/reloptions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xloginsert.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/indexfsm.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/index_selfuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * GIN handler function: return IndexAmRoutine with access method parameters 
 * and callbacks. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN35"></a><span class='Declare_Function'>ginhandler</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN37"></a>    <a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a> <span class='Operator'>*</span><span class='Declare_Local'>amroutine</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../../include/access/amapi.h.html#LN158"><span class='Ref_to_Struct'>IndexAmRoutine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN166"><span class='Ref_to_Member'>amstrategies</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN168"><span class='Ref_to_Member'>amsupport</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin.h.html#LN27"><span class='Ref_to_Const'>GINNProcs</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN170"><span class='Ref_to_Member'>amcanorder</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN172"><span class='Ref_to_Member'>amcanorderbyop</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN174"><span class='Ref_to_Member'>amcanbackward</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN176"><span class='Ref_to_Member'>amcanunique</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN178"><span class='Ref_to_Member'>amcanmulticol</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN180"><span class='Ref_to_Member'>amoptionalkey</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN182"><span class='Ref_to_Member'>amsearcharray</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN184"><span class='Ref_to_Member'>amsearchnulls</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN186"><span class='Ref_to_Member'>amstorage</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN188"><span class='Ref_to_Member'>amclusterable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN190"><span class='Ref_to_Member'>ampredlocks</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN192"><span class='Ref_to_Member'>amcanparallel</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN194"><span class='Ref_to_Member'>amkeytype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN197"><span class='Ref_to_Member'>ambuild</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN107"><span class='Ref_to_Proto'>ginbuild</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN198"><span class='Ref_to_Member'>ambuildempty</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN109"><span class='Ref_to_Proto'>ginbuildempty</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN199"><span class='Ref_to_Member'>aminsert</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN110"><span class='Ref_to_Proto'>gininsert</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN200"><span class='Ref_to_Member'>ambulkdelete</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN379"><span class='Ref_to_Proto'>ginbulkdelete</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN201"><span class='Ref_to_Member'>amvacuumcleanup</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN383"><span class='Ref_to_Proto'>ginvacuumcleanup</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN202"><span class='Ref_to_Member'>amcanreturn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN203"><span class='Ref_to_Member'>amcostestimate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/index_selfuncs.h.html#LN64"><span class='Ref_to_Proto'>gincostestimate</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN204"><span class='Ref_to_Member'>amoptions</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN86"><span class='Ref_to_Proto'>ginoptions</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN205"><span class='Ref_to_Member'>amproperty</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN206"><span class='Ref_to_Member'>amvalidate</span></a> <span class='Operator'>= </span><a href="ginvalidate.c.html#LN32"><span class='Ref_to_Func'>ginvalidate</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN207"><span class='Ref_to_Member'>ambeginscan</span></a> <span class='Operator'>= </span><a href="ginscan.c.html#LN23"><span class='Ref_to_Func'>ginbeginscan</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN208"><span class='Ref_to_Member'>amrescan</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN367"><span class='Ref_to_Proto'>ginrescan</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN209"><span class='Ref_to_Member'>amgettuple</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN210"><span class='Ref_to_Member'>amgetbitmap</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN373"><span class='Ref_to_Proto'>gingetbitmap</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN211"><span class='Ref_to_Member'>amendscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN366"><span class='Ref_to_Proto'>ginendscan</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN212"><span class='Ref_to_Member'>ammarkpos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN213"><span class='Ref_to_Member'>amrestrpos</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN216"><span class='Ref_to_Member'>amestimateparallelscan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN217"><span class='Ref_to_Member'>aminitparallelscan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/amapi.h.html#LN218"><span class='Ref_to_Member'>amparallelrescan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN37"><span class='Ref_To_Local'>amroutine</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ginhandler &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * initGinState: fill in an empty GinState struct to describe the index 
 * 
 * Note: assorted subsidiary data is allocated in the CurrentMemoryContext. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN85"></a><span class='Declare_Function'>initGinState</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN87"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>origTupdesc</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN52"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN53"><span class='Ref_to_Member'>oneCol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN66"><span class='Ref_to_Member'>origTupdesc</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN53"><span class='Ref_to_Member'>oneCol</span></a><span class='Parentheses'>) 
</span>            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN66"><span class='Ref_to_Member'>origTupdesc</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                               <a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                               <a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attndims<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/tupdesc.h.html#LN128"><span class='Ref_to_Proto'>TupleDescInitEntryCollation</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                                        <a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the compare proc isn't specified in the opclass definition, look 
         * up the index key type's default btree comparator. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN172"><span class='Ref_to_Proto'>index_getprocid</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN21"><span class='Ref_to_Const'>GIN_COMPARE_PROC</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN72"><span class='Ref_to_Member'>compareFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN21"><span class='Ref_to_Const'>GIN_COMPARE_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN126"></a>            <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typentry</span><span class='Delimiter'>; 
</span> 
            <a href="ginutil.c.html#LN126"><span class='Ref_To_Local'>typentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN142"><span class='Ref_to_Proto'>lookup_type_cache</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                         <a href="../../../include/utils/typcache.h.html#LN115"><span class='Ref_to_Const'>TYPECACHE_CMP_PROC_FINFO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN126"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not identify a comparison function for type %s"</span><span class='Delimiter'>, 
</span>                       <a href="../../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN87"><span class='Ref_To_Local'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN72"><span class='Ref_to_Member'>compareFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN126"><span class='Ref_To_Local'>typentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN67"><span class='Ref_to_Member'>cmp_proc_finfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Opclass must always provide extract procs */ 
</span>        <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN73"><span class='Ref_to_Member'>extractValueFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN22"><span class='Ref_to_Const'>GIN_EXTRACTVALUE_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN74"><span class='Ref_to_Member'>extractQueryFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN23"><span class='Ref_to_Const'>GIN_EXTRACTQUERY_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check opclass capability to do tri-state or binary logic consistent 
         * check. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN172"><span class='Ref_to_Proto'>index_getprocid</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN26"><span class='Ref_to_Const'>GIN_TRICONSISTENT_PROC</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN76"><span class='Ref_to_Member'>triConsistentFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN26"><span class='Ref_to_Const'>GIN_TRICONSISTENT_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN172"><span class='Ref_to_Proto'>index_getprocid</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN24"><span class='Ref_to_Const'>GIN_CONSISTENT_PROC</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN75"><span class='Ref_to_Member'>consistentFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN24"><span class='Ref_to_Const'>GIN_CONSISTENT_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN75"><span class='Ref_to_Member'>consistentFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& 
</span>            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN76"><span class='Ref_to_Member'>triConsistentFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"missing GIN support function (%d or %d) for attribute %d of index \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/access/gin.h.html#LN24"><span class='Ref_to_Const'>GIN_CONSISTENT_PROC</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN26"><span class='Ref_to_Const'>GIN_TRICONSISTENT_PROC</span></a><span class='Delimiter'>, 
</span>                 <a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check opclass capability to do partial match. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN172"><span class='Ref_to_Proto'>index_getprocid</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN25"><span class='Ref_to_Const'>GIN_COMPARE_PARTIAL_PROC</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/fmgr.h.html#LN109"><span class='Ref_to_Proto'>fmgr_info_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN77"><span class='Ref_to_Member'>comparePartialFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN25"><span class='Ref_to_Const'>GIN_COMPARE_PARTIAL_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN79"><span class='Ref_to_Member'>canPartialMatch</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN79"><span class='Ref_to_Member'>canPartialMatch</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the index column has a specified collation, we should honor that 
         * while doing comparisons.  However, we may have a collatable storage 
         * type for a noncollatable indexed data type (for instance, hstore 
         * uses text index entries).  If there's no index collation then 
         * specify default collation in case the support functions need 
         * collation.  This is harmless if the support functions don't care 
         * about collation, so we just do it unconditionally.  (We could 
         * alternatively call get_typcollation, but that seems like expensive 
         * overkill --- there aren't going to be any cases where a GIN storage 
         * type has a nondefault collation.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN192"><span class='Ref_to_Member'>rd_indcollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>else</span> 
            <a href="ginutil.c.html#LN85"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN88"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;origTupdesc-&GT;na... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end initGinState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract attribute (column) number of stored entry from GIN tuple 
 */ 
</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> 
<a name="LN212"></a><span class='Declare_Function'>gintuple_get_attrnum</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN214"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>colN</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN212"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN53"><span class='Ref_to_Member'>oneCol</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* column number is not stored explicitly */ 
</span>        <a href="ginutil.c.html#LN214"><span class='Ref_To_Local'>colN</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN223"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN224"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * First attribute is always int16, so we can safely use any tuple 
         * descriptor to obtain first attribute of tuple 
         */ 
</span>        <a href="ginutil.c.html#LN223"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN212"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN212"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                            <span class='Operator'>&</span><a href="ginutil.c.html#LN224"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="ginutil.c.html#LN224"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginutil.c.html#LN214"><span class='Ref_To_Local'>colN</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN463"><span class='Ref_to_Macro'>DatumGetUInt16</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN223"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN214"><span class='Ref_To_Local'>colN</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>&& </span><a href="ginutil.c.html#LN214"><span class='Ref_To_Local'>colN</span></a> <span class='Operator'>&LT;= </span><a href="ginutil.c.html#LN212"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN66"><span class='Ref_to_Member'>origTupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="ginutil.c.html#LN214"><span class='Ref_To_Local'>colN</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gintuple_get_attrnum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract stored datum (and possible null category) from GIN tuple 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN245"></a><span class='Declare_Function'>gintuple_get_key</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN246"></a>                 <a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>category</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN248"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN249"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN53"><span class='Ref_to_Member'>oneCol</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Single column index doesn't store attribute numbers in tuples 
         */ 
</span>        <a href="ginutil.c.html#LN248"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN66"><span class='Ref_to_Member'>origTupdesc</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="ginutil.c.html#LN249"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Since the datum type depends on which index column it's from, we 
         * must be careful to use the right tuple descriptor here. 
         */ 
</span><a name="LN265"></a>        <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>colN</span> <span class='Operator'>= </span><a href="../../../include/access/gin_private.h.html#LN102"><span class='Ref_to_Proto'>gintuple_get_attrnum</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginutil.c.html#LN248"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN67"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN265"><span class='Ref_To_Local'>colN</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                            <span class='Operator'>&</span><a href="ginutil.c.html#LN249"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN249"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="ginutil.c.html#LN246"><span class='Ref_to_Parameter'>category</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN210"><span class='Ref_to_Macro'>GinGetNullCategory</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN245"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="ginutil.c.html#LN246"><span class='Ref_to_Parameter'>category</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="ginutil.c.html#LN248"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gintuple_get_key &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Allocate a new page (either by recycling, or by extending the index file) 
 * The returned buffer is already pinned and exclusive-locked 
 * Caller is responsible for initializing the page by calling GinInitBuffer 
 */ 
</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> 
<a name="LN286"></a><span class='Declare_Function'>GinNewBuffer</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN288"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN289"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needLock</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* First, try to get a page from FSM */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN294"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span> <span class='Operator'>= </span><a href="../../../include/storage/indexfsm.h.html#LN19"><span class='Ref_to_Proto'>GetFreeIndexPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN286"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN294"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN286"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN294"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We have to guard against the possibility that someone else already 
         * recycled this page; the buffer may be locked if so. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN215"><span class='Ref_to_Proto'>ConditionalLockBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN307"></a>            <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN225"><span class='Ref_to_Macro'>PageIsNew</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN307"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* OK to use, if never initialized */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN122"><span class='Ref_to_Macro'>GinPageIsDeleted</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN307"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* OK to use */ 
</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN42"><span class='Ref_to_Const'>GIN_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Can't use it, so release buffer and try again */ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Must extend the file */ 
</span>    <a href="ginutil.c.html#LN289"><span class='Ref_To_Local'>needLock</span></a> <span class='Operator'>= !</span><a href="../../../include/utils/rel.h.html#LN523"><span class='Ref_to_Macro'>RELATION_IS_LOCAL</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN286"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN289"><span class='Ref_To_Local'>needLock</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/storage/lmgr.h.html#LN53"><span class='Ref_to_Proto'>LockRelationForExtension</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN286"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN43"><span class='Ref_to_Const'>ExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN286"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN81"><span class='Ref_to_Const'>P_NEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN44"><span class='Ref_to_Const'>GIN_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN289"><span class='Ref_To_Local'>needLock</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/storage/lmgr.h.html#LN54"><span class='Ref_to_Proto'>UnlockRelationForExtension</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN286"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN43"><span class='Ref_to_Const'>ExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="ginutil.c.html#LN288"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GinNewBuffer &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN337"></a><span class='Declare_Function'>GinInitPage</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a> <span class='Declare_Parameter'>page</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>f</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a> <span class='Declare_Parameter'>pageSize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN339"></a>    <a href="../../../include/access/ginblock.h.html#LN36"><span class='Ref_to_Typedef'>GinPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span> 
    <a href="../../storage/page/bufpage.c.html#LN39"><span class='Ref_to_Func'>PageInit</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN337"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN337"><span class='Ref_to_Parameter'>pageSize</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN27"><span class='Ref_to_Struct'>GinPageOpaqueData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN339"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN108"><span class='Ref_to_Macro'>GinPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN337"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="ginutil.c.html#LN339"><span class='Ref_To_Local'>opaque</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN27"><span class='Ref_to_Struct'>GinPageOpaqueData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN339"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN33"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN337"><span class='Ref_to_Parameter'>f</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN339"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN29"><span class='Ref_to_Member'>rightlink</span></a> <span class='Operator'>= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN350"></a><span class='Declare_Function'>GinInitBuffer</span><span class='Parentheses'>(</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>f</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/access/gin_private.h.html#LN90"><span class='Ref_to_Proto'>GinInitPage</span></a><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN350"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="ginutil.c.html#LN350"><span class='Ref_to_Parameter'>f</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN146"><span class='Ref_to_Macro'>BufferGetPageSize</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN350"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN356"></a><span class='Declare_Function'>GinInitMetabuffer</span><span class='Parentheses'>(</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN358"></a>    <a href="../../../include/access/ginblock.h.html#LN52"><span class='Ref_to_Struct'>GinMetaPageData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>metadata</span><span class='Delimiter'>; 
</span><a name="LN359"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN356"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/gin_private.h.html#LN90"><span class='Ref_to_Proto'>GinInitPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN359"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN41"><span class='Ref_to_Const'>GIN_META</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN146"><span class='Ref_to_Macro'>BufferGetPageSize</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN356"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN102"><span class='Ref_to_Macro'>GinPageGetMeta</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN359"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN59"><span class='Ref_to_Member'>head</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN60"><span class='Ref_to_Member'>tail</span></a> <span class='Operator'>= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN65"><span class='Ref_to_Member'>tailFreeSize</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN71"><span class='Ref_to_Member'>nPendingPages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN72"><span class='Ref_to_Member'>nPendingHeapTuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN77"><span class='Ref_to_Member'>nTotalPages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN78"><span class='Ref_to_Member'>nEntryPages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN79"><span class='Ref_to_Member'>nDataPages</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN80"><span class='Ref_to_Member'>nEntries</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN358"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN97"><span class='Ref_to_Member'>ginVersion</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN100"><span class='Ref_to_Const'>GIN_CURRENT_VERSION</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GinInitMetabuffer &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compare two keys of the same index column 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN380"></a><span class='Declare_Function'>ginCompareEntries</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN381"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Parameter'>categorya</span><span class='Delimiter'>, 
</span><a name="LN382"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Parameter'>categoryb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* if not of same null category, sort by that first */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN381"><span class='Ref_to_Parameter'>categorya</span></a> <span class='Operator'>!= </span><a href="ginutil.c.html#LN382"><span class='Ref_to_Parameter'>categoryb</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN381"><span class='Ref_to_Parameter'>categorya</span></a> <span class='Operator'>&LT; </span><a href="ginutil.c.html#LN382"><span class='Ref_to_Parameter'>categoryb</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* all null items in same category are equal */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN381"><span class='Ref_to_Parameter'>categorya</span></a> <span class='Operator'>!= </span><a href="../../../include/access/ginblock.h.html#LN198"><span class='Ref_to_Const'>GIN_CAT_NORM_KEY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* both not null, so safe to call the compareFn */ 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginutil.c.html#LN380"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN72"><span class='Ref_to_Member'>compareFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN380"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                      <a href="ginutil.c.html#LN380"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN380"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                           <a href="ginutil.c.html#LN381"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN382"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Compare two keys of possibly different index columns 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN402"></a><span class='Declare_Function'>ginCompareAttEntries</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, 
</span><a name="LN403"></a>                     <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>attnuma</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Parameter'>categorya</span><span class='Delimiter'>, 
</span><a name="LN404"></a>                     <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>attnumb</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Declare_Parameter'>categoryb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* attribute number is the first sort key */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN403"><span class='Ref_to_Parameter'>attnuma</span></a> <span class='Operator'>!= </span><a href="ginutil.c.html#LN404"><span class='Ref_to_Parameter'>attnumb</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN403"><span class='Ref_to_Parameter'>attnuma</span></a> <span class='Operator'>&LT; </span><a href="ginutil.c.html#LN404"><span class='Ref_to_Parameter'>attnumb</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/access/gin_private.h.html#LN92"><span class='Ref_to_Proto'>ginCompareEntries</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN402"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN403"><span class='Ref_to_Parameter'>attnuma</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN403"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN403"><span class='Ref_to_Parameter'>categorya</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN404"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN404"><span class='Ref_to_Parameter'>categoryb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Support for sorting key datums in ginExtractEntries 
 * 
 * Note: we only have to worry about null and not-null keys here; 
 * ginExtractEntries never generates more than one placeholder null, 
 * so it doesn't have to sort those. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN423"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>datum</span><span class='Delimiter'>; 
</span><a name="LN424"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>isnull</span><span class='Delimiter'>; 
</span><a name="LN425"></a>} <span class='Declare_Typedef'>keyEntryData</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN429"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>cmpDatumFunc</span><span class='Delimiter'>; 
</span><a name="LN430"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>collation</span><span class='Delimiter'>; 
</span><a name="LN431"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>haveDups</span><span class='Delimiter'>; 
</span><a name="LN432"></a>} <span class='Declare_Typedef'>cmpEntriesArg</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static int 
</span><a name="LN435"></a><span class='Declare_Function'>cmpEntries</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN437"></a>    <span class='Keyword'>const </span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>aa</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginutil.c.html#LN435"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN438"></a>    <span class='Keyword'>const </span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginutil.c.html#LN435"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN439"></a>    <a href="ginutil.c.html#LN427"><span class='Ref_to_Typedef'>cmpEntriesArg</span></a> <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN427"><span class='Ref_to_Typedef'>cmpEntriesArg</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginutil.c.html#LN435"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span><a name="LN440"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN437"><span class='Ref_To_Local'>aa</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN438"><span class='Ref_To_Local'>bb</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="ginutil.c.html#LN440"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* NULL "=" NULL */ 
</span>        <span class='Control'>else</span> 
            <a href="ginutil.c.html#LN440"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* NULL "&GT;" not-NULL */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN438"><span class='Ref_To_Local'>bb</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="ginutil.c.html#LN440"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* not-NULL "&LT;" NULL */ 
</span>    <span class='Control'>else</span> 
        <a href="ginutil.c.html#LN440"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN439"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN429"><span class='Ref_to_Member'>cmpDatumFunc</span></a><span class='Delimiter'>, 
</span>                                              <a href="ginutil.c.html#LN439"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN430"><span class='Ref_to_Member'>collation</span></a><span class='Delimiter'>, 
</span>                                              <a href="ginutil.c.html#LN437"><span class='Ref_To_Local'>aa</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN423"><span class='Ref_to_Member'>datum</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN438"><span class='Ref_To_Local'>bb</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN423"><span class='Ref_to_Member'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Detect if we have any duplicates.  If there are equal keys, qsort must 
     * compare them at some point, else it wouldn't know whether one should go 
     * before or after the other. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN440"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="ginutil.c.html#LN439"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="ginutil.c.html#LN431"><span class='Ref_to_Member'>haveDups</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="ginutil.c.html#LN440"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cmpEntries &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Extract the index key values from an indexable item 
 * 
 * The resulting key values are sorted, and any duplicates are removed. 
 * This avoids generating redundant index entries. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>* 
</span><a name="LN475"></a><span class='Declare_Function'>ginExtractEntries</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN50"><span class='Ref_to_Struct'>GinState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ginstate</span><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN476"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN477"></a>                  <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nentries</span><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>categories</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN479"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>entries</span><span class='Delimiter'>; 
</span><a name="LN480"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nullFlags</span><span class='Delimiter'>; 
</span><a name="LN481"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't call the extractValueFn on a null item.  Instead generate a 
     * placeholder. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN476"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>categories</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>categories</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN201"><span class='Ref_to_Const'>GIN_CAT_NULL_ITEM</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, call the opclass's extractValueFn */ 
</span>    <a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* in case extractValue doesn't set it */ 
</span>    <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN514"><span class='Ref_to_Proto'>FunctionCall3Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN73"><span class='Ref_to_Member'>extractValueFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                      <a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                          <span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate a placeholder if the item contained no keys. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| *</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>categories</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>categories</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN200"><span class='Ref_to_Const'>GIN_CAT_EMPTY_ITEM</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the extractValueFn didn't create a nullFlags array, create one, 
     * assuming that everything's non-null.  Otherwise, run through the array 
     * and make sure each value is exactly 0 or 1; this ensures binary 
     * compatibility with the GinNullCategory representation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; *</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* now we can use the nullFlags as category codes */ 
</span>    <span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>categories</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN196"><span class='Ref_to_Typedef'>GinNullCategory</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there's more than one key, sort and unique-ify. 
     * 
     * XXX Using qsort here is notationally painful, and the overhead is 
     * pretty bad too.  For small numbers of keys it'd likely be better to use 
     * a simple insertion sort. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN544"></a>        <a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>keydata</span><span class='Delimiter'>; 
</span><a name="LN545"></a>        <a href="ginutil.c.html#LN427"><span class='Ref_to_Typedef'>cmpEntriesArg</span></a> <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
        <a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; *</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN423"><span class='Ref_to_Member'>datum</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="ginutil.c.html#LN545"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="ginutil.c.html#LN429"><span class='Ref_to_Member'>cmpDatumFunc</span></a> <span class='Operator'>= &</span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN72"><span class='Ref_to_Member'>compareFn</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="ginutil.c.html#LN545"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="ginutil.c.html#LN430"><span class='Ref_to_Member'>collation</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>ginstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin_private.h.html#LN81"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN475"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="ginutil.c.html#LN545"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="ginutil.c.html#LN431"><span class='Ref_to_Member'>haveDups</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="ginutil.c.html#LN421"><span class='Ref_to_Typedef'>keyEntryData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="ginutil.c.html#LN434"><span class='Ref_to_Func'>cmpEntries</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="ginutil.c.html#LN545"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN545"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="ginutil.c.html#LN431"><span class='Ref_to_Member'>haveDups</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* there are duplicates, must get rid of 'em */ 
</span><a name="LN563"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN423"><span class='Ref_to_Member'>datum</span></a><span class='Delimiter'>; 
</span>            <a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>            <a href="ginutil.c.html#LN563"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; *</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN434"><span class='Ref_to_Func'>cmpEntries</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="ginutil.c.html#LN545"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN423"><span class='Ref_to_Member'>datum</span></a><span class='Delimiter'>; 
</span>                    <a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>                    <a href="ginutil.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* easy, no duplicates */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; *</span><a href="ginutil.c.html#LN477"><span class='Ref_to_Parameter'>nentries</span></a><span class='Delimiter'>; </span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN423"><span class='Ref_to_Member'>datum</span></a><span class='Delimiter'>; 
</span>                <a href="ginutil.c.html#LN480"><span class='Ref_To_Local'>nullFlags</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Delimiter'>[</span><a href="ginutil.c.html#LN481"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="ginutil.c.html#LN424"><span class='Ref_to_Member'>isnull</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN544"><span class='Ref_To_Local'>keydata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *nentries&GT;1 &raquo; </span> 
 
    <span class='Control'>return</span> <a href="ginutil.c.html#LN479"><span class='Ref_To_Local'>entries</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ginExtractEntries &raquo; </span> 
 
<a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN596"></a><span class='Declare_Function'>ginoptions</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>reloptions</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>validate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN598"></a>    <a href="../../../include/access/reloptions.h.html#LN73"><span class='Ref_to_Struct'>relopt_value</span></a> <span class='Operator'>*</span><span class='Declare_Local'>options</span><span class='Delimiter'>; 
</span><a name="LN599"></a>    <a href="../../../include/access/gin_private.h.html#LN23"><span class='Ref_to_Struct'>GinOptions</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rdopts</span><span class='Delimiter'>; 
</span><a name="LN600"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numoptions</span><span class='Delimiter'>; 
</span><a name="LN601"></a>    <span class='Keyword'>static const </span><a href="../../../include/access/reloptions.h.html#LN122"><span class='Ref_to_Typedef'>relopt_parse_elt</span></a> <span class='Declare_Local'>tab</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <span class='Delimiter'>{</span><span class='String'>"fastupdate"</span><span class='Delimiter'>, </span><a href="../../../include/access/reloptions.h.html#LN30"><span class='Ref_to_EnumConst'>RELOPT_TYPE_BOOL</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN23"><span class='Ref_to_Struct'>GinOptions</span></a><span class='Delimiter'>, </span>useFastUpdate<span class='Parentheses'>)</span><span class='Delimiter'>}, 
</span>        <span class='Delimiter'>{</span><span class='String'>"gin_pending_list_limit"</span><span class='Delimiter'>, </span><a href="../../../include/access/reloptions.h.html#LN31"><span class='Ref_to_EnumConst'>RELOPT_TYPE_INT</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN23"><span class='Ref_to_Struct'>GinOptions</span></a><span class='Delimiter'>, 
</span>                                                     pendingListCleanupSize<span class='Parentheses'>)</span><span class='Delimiter'>} 
</span>    <span class='Delimiter'>}; 
</span> 
    <a href="ginutil.c.html#LN598"><span class='Ref_To_Local'>options</span></a> <span class='Operator'>= </span><a href="../../../include/access/reloptions.h.html#LN263"><span class='Ref_to_Proto'>parseRelOptions</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN596"><span class='Ref_to_Parameter'>reloptions</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN596"><span class='Ref_to_Parameter'>validate</span></a><span class='Delimiter'>, </span><a href="../../../include/access/reloptions.h.html#LN43"><span class='Ref_to_EnumConst'>RELOPT_KIND_GIN</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="ginutil.c.html#LN600"><span class='Ref_To_Local'>numoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if none set, we're done */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="ginutil.c.html#LN600"><span class='Ref_To_Local'>numoptions</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN599"><span class='Ref_To_Local'>rdopts</span></a> <span class='Operator'>= </span><a href="../../../include/access/reloptions.h.html#LN265"><span class='Ref_to_Proto'>allocateReloptStruct</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN23"><span class='Ref_to_Struct'>GinOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="ginutil.c.html#LN598"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN600"><span class='Ref_To_Local'>numoptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/reloptions.h.html#LN267"><span class='Ref_to_Proto'>fillRelOptions</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginutil.c.html#LN599"><span class='Ref_To_Local'>rdopts</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gin_private.h.html#LN23"><span class='Ref_to_Struct'>GinOptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="ginutil.c.html#LN598"><span class='Ref_To_Local'>options</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN600"><span class='Ref_To_Local'>numoptions</span></a><span class='Delimiter'>, 
</span>                   <a href="ginutil.c.html#LN596"><span class='Ref_to_Parameter'>validate</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN601"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN561"><span class='Ref_to_Macro'>lengthof</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN601"><span class='Ref_To_Local'>tab</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN598"><span class='Ref_To_Local'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="ginutil.c.html#LN599"><span class='Ref_To_Local'>rdopts</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ginoptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fetch index's statistical data into *stats 
 * 
 * Note: in the result, nPendingPages can be trusted to be up-to-date, 
 * as can ginVersion; but the other fields are as of the last VACUUM. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN631"></a><span class='Declare_Function'>ginGetStats</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="../../../include/access/gin.h.html#LN40"><span class='Ref_to_Struct'>GinStatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN633"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>metabuffer</span><span class='Delimiter'>; 
</span><a name="LN634"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>metapage</span><span class='Delimiter'>; 
</span><a name="LN635"></a>    <a href="../../../include/access/ginblock.h.html#LN52"><span class='Ref_to_Struct'>GinMetaPageData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>metadata</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN633"><span class='Ref_To_Local'>metabuffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN49"><span class='Ref_to_Const'>GIN_METAPAGE_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN633"><span class='Ref_To_Local'>metabuffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN43"><span class='Ref_to_Const'>GIN_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN634"><span class='Ref_To_Local'>metapage</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN633"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN102"><span class='Ref_to_Macro'>GinPageGetMeta</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN634"><span class='Ref_To_Local'>metapage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN42"><span class='Ref_to_Member'>nPendingPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN71"><span class='Ref_to_Member'>nPendingPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN43"><span class='Ref_to_Member'>nTotalPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN77"><span class='Ref_to_Member'>nTotalPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN44"><span class='Ref_to_Member'>nEntryPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN78"><span class='Ref_to_Member'>nEntryPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN45"><span class='Ref_to_Member'>nDataPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN79"><span class='Ref_to_Member'>nDataPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN46"><span class='Ref_to_Member'>nEntries</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN80"><span class='Ref_to_Member'>nEntries</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN631"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN47"><span class='Ref_to_Member'>ginVersion</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN635"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN97"><span class='Ref_to_Member'>ginVersion</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN633"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ginGetStats &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write the given statistics to the index's metapage 
 * 
 * Note: nPendingPages and ginVersion are *not* copied over 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN658"></a><span class='Declare_Function'>ginUpdateStats</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/access/gin.h.html#LN40"><span class='Ref_to_Struct'>GinStatsData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stats</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN660"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>metabuffer</span><span class='Delimiter'>; 
</span><a name="LN661"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>metapage</span><span class='Delimiter'>; 
</span><a name="LN662"></a>    <a href="../../../include/access/ginblock.h.html#LN52"><span class='Ref_to_Struct'>GinMetaPageData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>metadata</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN660"><span class='Ref_To_Local'>metabuffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="../../../include/access/ginblock.h.html#LN49"><span class='Ref_to_Const'>GIN_METAPAGE_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN660"><span class='Ref_To_Local'>metabuffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gin_private.h.html#LN44"><span class='Ref_to_Const'>GIN_EXCLUSIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN661"><span class='Ref_To_Local'>metapage</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN660"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN662"><span class='Ref_To_Local'>metadata</span></a> <span class='Operator'>= </span><a href="../../../include/access/ginblock.h.html#LN102"><span class='Ref_to_Macro'>GinPageGetMeta</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN661"><span class='Ref_To_Local'>metapage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN132"><span class='Ref_to_Macro'>START_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="ginutil.c.html#LN662"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN77"><span class='Ref_to_Member'>nTotalPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN43"><span class='Ref_to_Member'>nTotalPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN662"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN78"><span class='Ref_to_Member'>nEntryPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN44"><span class='Ref_to_Member'>nEntryPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN662"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN79"><span class='Ref_to_Member'>nDataPages</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN45"><span class='Ref_to_Member'>nDataPages</span></a><span class='Delimiter'>; 
</span>    <a href="ginutil.c.html#LN662"><span class='Ref_To_Local'>metadata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/ginblock.h.html#LN80"><span class='Ref_to_Member'>nEntries</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>stats</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gin.h.html#LN46"><span class='Ref_to_Member'>nEntries</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN660"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN680"></a>        <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span><a name="LN681"></a>        <a href="../../../include/access/ginxlog.h.html#LN168"><span class='Ref_to_Struct'>ginxlogUpdateMeta</span></a> <span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span> 
        <a href="ginutil.c.html#LN681"><span class='Ref_To_Local'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/ginxlog.h.html#LN170"><span class='Ref_to_Member'>node</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN658"><span class='Ref_to_Parameter'>index</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Delimiter'>; 
</span>        <a href="ginutil.c.html#LN681"><span class='Ref_To_Local'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/ginxlog.h.html#LN174"><span class='Ref_to_Member'>ntuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="ginutil.c.html#LN681"><span class='Ref_To_Local'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/ginxlog.h.html#LN173"><span class='Ref_to_Member'>newRightlink</span></a> <span class='Operator'>= </span><a href="ginutil.c.html#LN681"><span class='Ref_To_Local'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/ginxlog.h.html#LN172"><span class='Ref_to_Member'>prevTail</span></a> <span class='Operator'>= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="ginutil.c.html#LN681"><span class='Ref_To_Local'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/ginxlog.h.html#LN171"><span class='Ref_to_Member'>metadata</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN662"><span class='Ref_To_Local'>metadata</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/ginblock.h.html#LN52"><span class='Ref_to_Struct'>GinMetaPageData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/xloginsert.h.html#LN41"><span class='Ref_to_Proto'>XLogBeginInsert</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="ginutil.c.html#LN681"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/ginxlog.h.html#LN168"><span class='Ref_to_Struct'>ginxlogUpdateMeta</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="ginutil.c.html#LN660"><span class='Ref_To_Local'>metabuffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xloginsert.h.html#LN31"><span class='Ref_to_Const'>REGBUF_WILL_INIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="ginutil.c.html#LN680"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/xloginsert.h.html#LN43"><span class='Ref_to_Proto'>XLogInsert</span></a><span class='Parentheses'>(</span>RM_GIN_ID<span class='Delimiter'>, </span><a href="../../../include/access/ginxlog.h.html#LN162"><span class='Ref_to_Const'>XLOG_GIN_UPDATE_META_PAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN661"><span class='Ref_To_Local'>metapage</span></a><span class='Delimiter'>, </span><a href="ginutil.c.html#LN680"><span class='Ref_To_Local'>recptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="ginutil.c.html#LN660"><span class='Ref_To_Local'>metabuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN134"><span class='Ref_to_Macro'>END_CRIT_SECTION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ginUpdateStats &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>