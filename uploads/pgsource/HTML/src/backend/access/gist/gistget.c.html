<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\gist\gistget.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\gist\gistget.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:28 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * gistget.c 
 *    fetch tuples from a GiST scan. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/access/gist/gistget.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/gist_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/pairingheap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * gistkillitems() -- set LP_DEAD state for items an indexscan caller has 
 * told us were killed. 
 * 
 * We re-read page here, so it's important to check page LSN. If the page 
 * has been modified since the last read (as determined by LSN), we cannot 
 * flag any entries because it is possible that the old entry was vacuumed 
 * away and the TID was re-used by a completely different heap tuple. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN36"></a><span class='Declare_Function'>gistkillitems</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN38"></a>    <a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN36"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN39"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN40"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN41"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span><span class='Delimiter'>; 
</span><a name="LN42"></a>    <a href="../../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>iid</span><span class='Delimiter'>; 
</span><a name="LN43"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN44"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>killedsomething</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN165"><span class='Ref_to_Member'>curBlkno</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xlogdefs.h.html#LN28"><span class='Ref_to_Macro'>XLogRecPtrIsInvalid</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN166"><span class='Ref_to_Member'>curPageLSN</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN36"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN165"><span class='Ref_to_Member'>curBlkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN42"><span class='Ref_to_Const'>GIST_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/gist_private.h.html#LN443"><span class='Ref_to_Proto'>gistcheckpage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN36"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN40"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If page LSN differs it means that the page was modified since the last 
     * read. killedItems could be not valid so LP_DEAD hints applying is not 
     * safe. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN362"><span class='Ref_to_Macro'>PageGetLSN</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN166"><span class='Ref_to_Member'>curPageLSN</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* reset counter */ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark all killedItems as dead. We need no additional recheck, because, 
     * if page was modified, pageLSN must have changed. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN43"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistget.c.html#LN43"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a><span class='Delimiter'>; </span><a href="gistget.c.html#LN43"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="gistget.c.html#LN41"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN43"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="gistget.c.html#LN42"><span class='Ref_To_Local'>iid</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN41"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/itemid.h.html#LN177"><span class='Ref_to_Macro'>ItemIdMarkDead</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN42"><span class='Ref_To_Local'>iid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN44"><span class='Ref_To_Local'>killedsomething</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN44"><span class='Ref_To_Local'>killedsomething</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/access/gist.h.html#LN143"><span class='Ref_to_Macro'>GistMarkPageHasGarbage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN211"><span class='Ref_to_Proto'>MarkBufferDirtyHint</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Always reset the scan state, so we don't look for same items on other 
     * pages. 
     */ 
</span>    <a href="gistget.c.html#LN38"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistkillitems &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * gistindex_keytest() -- does this index tuple satisfy the scan key(s)? 
 * 
 * The index tuple might represent either a heap tuple or a lower index page, 
 * depending on whether the containing page is a leaf page or not. 
 * 
 * On success return for a heap tuple, *recheck_p is set to indicate whether 
 * the quals need to be rechecked.  We recheck if any of the consistent() 
 * functions request it.  recheck is not interesting when examining a non-leaf 
 * entry, since we must visit the lower index page if there's any doubt. 
 * Similarly, *recheck_distances_p is set to indicate whether the distances 
 * need to be rechecked, and it is also ignored for non-leaf entries. 
 * 
 * If we are doing an ordered scan, so-&GT;distances[] is filled with distance 
 * data from the distance() functions before returning success. 
 * 
 * We must decompress the key in the IndexTuple before passing it to the 
 * sk_funcs (which actually are the opclass Consistent or Distance methods). 
 * 
 * Note that this function is always invoked in a short-lived memory context, 
 * so we don't need to worry about cleaning up allocated memory, either here 
 * or in the implementation of any Consistent or Distance methods. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN123"></a><span class='Declare_Function'>gistindex_keytest</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, 
</span><a name="LN124"></a>                  <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN125"></a>                  <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a> <span class='Declare_Parameter'>page</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                  <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offset</span><span class='Delimiter'>, 
</span><a name="LN127"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>recheck_p</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>recheck_distances_p</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN130"></a>    <a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN131"></a>    <a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>giststate</span> <span class='Operator'>= </span><a href="gistget.c.html#LN130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN151"><span class='Ref_to_Member'>giststate</span></a><span class='Delimiter'>; 
</span><a name="LN132"></a>    <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN92"><span class='Ref_to_Member'>keyData</span></a><span class='Delimiter'>; 
</span><a name="LN133"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>keySize</span> <span class='Operator'>= </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN90"><span class='Ref_to_Member'>numberOfKeys</span></a><span class='Delimiter'>; 
</span><a name="LN134"></a>    <span class='Keyword'>double</span>     <span class='Operator'>*</span><span class='Declare_Local'>distance_p</span><span class='Delimiter'>; 
</span><a name="LN135"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="gistget.c.html#LN127"><span class='Ref_to_Parameter'>recheck_p</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="gistget.c.html#LN128"><span class='Ref_to_Parameter'>recheck_distances_p</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If it's a leftover invalid tuple from pre-9.1, treat it as a match with 
     * minimum possible distances.  This means we'll always follow it to the 
     * referenced page. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN274"><span class='Ref_to_Macro'>GistTupleIsInvalid</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN124"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN147"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN125"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>))</span>       <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid GiST tuple found on leaf page"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN147"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistget.c.html#LN147"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Delimiter'>; </span><a href="gistget.c.html#LN147"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="gistget.c.html#LN130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN160"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN147"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check whether it matches according to the Consistent functions */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN133"><span class='Ref_To_Local'>keySize</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN159"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN160"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN159"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN124"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                              <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, 
</span>                              <a href="gistget.c.html#LN131"><span class='Ref_To_Local'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="gistget.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * On non-leaf page we can't conclude that child hasn't NULL 
             * values because of assumption in GiST: union (VAL, NULL) is VAL. 
             * But if on non-leaf page key IS NULL, then all children are 
             * NULL. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN120"><span class='Ref_to_Const'>SK_SEARCHNULL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN125"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="gistget.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN121"><span class='Ref_to_Const'>SK_SEARCHNOTNULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if key-&GT;sk_flags&SK_ISNU... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN193"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>test</span><span class='Delimiter'>; 
</span><a name="LN194"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>recheck</span><span class='Delimiter'>; 
</span><a name="LN195"></a>            <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>   <span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/access/gist_private.h.html#LN467"><span class='Ref_to_Proto'>gistdentryinit</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN131"><span class='Ref_To_Local'>giststate</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN195"><span class='Ref_To_Local'>de</span></a><span class='Delimiter'>, 
</span>                           <a href="gistget.c.html#LN159"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN135"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN125"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN126"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>, 
</span>                           <span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="gistget.c.html#LN160"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Call the Consistent function to evaluate the test.  The 
             * arguments are the index datum (as a GISTENTRY*), the comparison 
             * datum, the comparison operator's strategy number and subtype 
             * from pg_amop, and the recheck flag. 
             * 
             * (Presently there's no need to pass the subtype since it'll 
             * always be zero, but might as well pass it for possible future 
             * use.) 
             * 
             * We initialize the recheck flag to true (the safest assumption) 
             * in case the Consistent function forgets to set it. 
             */ 
</span>            <a href="gistget.c.html#LN194"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="gistget.c.html#LN193"><span class='Ref_To_Local'>test</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN520"><span class='Ref_to_Proto'>FunctionCall5Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN70"><span class='Ref_to_Member'>sk_func</span></a><span class='Delimiter'>, 
</span>                                     <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN69"><span class='Ref_to_Member'>sk_collation</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN195"><span class='Ref_To_Local'>de</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN194"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN193"><span class='Ref_To_Local'>test</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="gistget.c.html#LN127"><span class='Ref_to_Parameter'>recheck_p</span></a> <span class='Operator'>|= </span><a href="gistget.c.html#LN194"><span class='Ref_To_Local'>recheck</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN133"><span class='Ref_To_Local'>keySize</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while keySize&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* OK, it passes --- now let's compute the distances */ 
</span>    <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN93"><span class='Ref_to_Member'>orderByData</span></a><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN134"><span class='Ref_To_Local'>distance_p</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN160"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN133"><span class='Ref_To_Local'>keySize</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN123"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN133"><span class='Ref_To_Local'>keySize</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN239"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN240"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN239"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN124"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                              <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, 
</span>                              <a href="gistget.c.html#LN131"><span class='Ref_To_Local'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="gistget.c.html#LN240"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="gistget.c.html#LN240"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Assume distance computes as null and sorts to the end */ 
</span>            <span class='Operator'>*</span><a href="gistget.c.html#LN134"><span class='Ref_To_Local'>distance_p</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN254"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>dist</span><span class='Delimiter'>; 
</span><a name="LN255"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>recheck</span><span class='Delimiter'>; 
</span><a name="LN256"></a>            <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>   <span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/access/gist_private.h.html#LN467"><span class='Ref_to_Proto'>gistdentryinit</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN131"><span class='Ref_To_Local'>giststate</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN256"><span class='Ref_To_Local'>de</span></a><span class='Delimiter'>, 
</span>                           <a href="gistget.c.html#LN239"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN135"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN125"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN126"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>, 
</span>                           <span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="gistget.c.html#LN240"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Call the Distance function to evaluate the distance.  The 
             * arguments are the index datum (as a GISTENTRY*), the comparison 
             * datum, the ordering operator's strategy number and subtype from 
             * pg_amop, and the recheck flag. 
             * 
             * (Presently there's no need to pass the subtype since it'll 
             * always be zero, but might as well pass it for possible future 
             * use.) 
             * 
             * If the function sets the recheck flag, the returned distance is 
             * a lower bound on the true distance and needs to be rechecked. 
             * We initialize the flag to 'false'.  This flag was added in 
             * version 9.5; distance functions written before that won't know 
             * about the flag, but are expected to never be lossy. 
             */ 
</span>            <a href="gistget.c.html#LN255"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="gistget.c.html#LN254"><span class='Ref_To_Local'>dist</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN520"><span class='Ref_to_Proto'>FunctionCall5Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN70"><span class='Ref_to_Member'>sk_func</span></a><span class='Delimiter'>, 
</span>                                     <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN69"><span class='Ref_to_Member'>sk_collation</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN256"><span class='Ref_To_Local'>de</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN255"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="gistget.c.html#LN128"><span class='Ref_to_Parameter'>recheck_distances_p</span></a> <span class='Operator'>|= </span><a href="gistget.c.html#LN255"><span class='Ref_To_Local'>recheck</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="gistget.c.html#LN134"><span class='Ref_To_Local'>distance_p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN254"><span class='Ref_To_Local'>dist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="gistget.c.html#LN132"><span class='Ref_To_Local'>key</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN134"><span class='Ref_To_Local'>distance_p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN133"><span class='Ref_To_Local'>keySize</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while keySize&GT;0 &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistindex_keytest &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Scan all items on the GiST index page identified by *pageItem, and insert 
 * them into the queue (or directly to output areas) 
 * 
 * scan: index scan we are executing 
 * pageItem: search queue item identifying an index page to scan 
 * myDistances: distances array associated with pageItem, or NULL at the root 
 * tbm: if not NULL, gistgetbitmap's output bitmap 
 * ntids: if not NULL, gistgetbitmap's output tuple counter 
 * 
 * If tbm/ntids aren't NULL, we are doing an amgetbitmap scan, and heap 
 * tuples should be reported directly into the bitmap.  If they are NULL, 
 * we're doing a plain or ordered indexscan.  For a plain indexscan, heap 
 * tuple TIDs are returned into so-&GT;pageData[].  For an ordered indexscan, 
 * heap tuple TIDs are pushed into individual search queue items.  In an 
 * index-only scan, reconstructed index tuples are returned along with the 
 * TIDs. 
 * 
 * If we detect that the index page has split since we saw its downlink 
 * in the parent, we push its new right sibling onto the queue so the 
 * sibling will be processed next. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN321"></a><span class='Declare_Function'>gistScanPage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pageItem</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>myDistances</span><span class='Delimiter'>, 
</span><a name="LN322"></a>             <a href="../../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbm</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ntids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN324"></a>    <a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN325"></a>    <a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>giststate</span> <span class='Operator'>= </span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN151"><span class='Ref_to_Member'>giststate</span></a><span class='Delimiter'>; 
</span><a name="LN326"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>; 
</span><a name="LN327"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN328"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN329"></a>    <a href="../../../include/access/gist.h.html#LN65"><span class='Ref_to_Typedef'>GISTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN330"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN331"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN332"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/gist_private.h.html#LN142"><span class='Ref_to_Macro'>GISTSearchItemIsHeap</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>pageItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="gistget.c.html#LN327"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN167"><span class='Ref_to_Proto'>ReadBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>pageItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN327"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN42"><span class='Ref_to_Const'>GIST_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/gist_private.h.html#LN443"><span class='Ref_to_Proto'>gistcheckpage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN327"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN327"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN326"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist.h.html#LN129"><span class='Ref_to_Macro'>GistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check if we need to follow the rightlink. We need to follow it if the 
     * page was concurrently split since we visited the parent (in which case 
     * parentlsn &LT; nsn), or if the system crashed after a page split but 
     * before the downlink was inserted into the parent. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xlogdefs.h.html#LN28"><span class='Ref_to_Macro'>XLogRecPtrIsInvalid</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>pageItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN146"><span class='Ref_to_Macro'>GistFollowRight</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>         <a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>pageItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a> <span class='Operator'>&LT; </span><a href="../../../include/access/gist.h.html#LN150"><span class='Ref_to_Macro'>GistPageGetNSN</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <a href="gistget.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN60"><span class='Ref_to_Member'>rightlink</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a> <span class='Comment_Multi_Line'>/* sanity check */ </span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* There was a page split, follow right link to add pages */ 
</span><a name="LN355"></a>        <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* This can't happen when starting at the root */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>myDistances</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN155"><span class='Ref_to_Member'>queueCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create new GISTSearchItem for the right sibling index page */ 
</span>        <a href="gistget.c.html#LN355"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN144"><span class='Ref_to_Macro'>SizeOfGISTSearchItem</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN355"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN60"><span class='Ref_to_Member'>rightlink</span></a><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN355"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>pageItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Insert it into the queue using same distances as for this page */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="gistget.c.html#LN355"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>myDistances</span></a><span class='Delimiter'>, 
</span>               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/lib/pairingheap.h.html#LN80"><span class='Ref_to_Proto'>pairingheap_add</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN154"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN355"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN130"><span class='Ref_to_Member'>phNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !XLogRecPtrIsInvalid(... &raquo; </span> 
 
    <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* might point into pageDataCxt */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We save the LSN of the page as we read it, so that we know whether it 
     * safe to apply LP_DEAD hints to the page later. This allows us to drop 
     * the pin for MVCC scans, which allows vacuum to avoid blocking. 
     */ 
</span>    <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN166"><span class='Ref_to_Member'>curPageLSN</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN362"><span class='Ref_to_Macro'>PageGetLSN</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * check all tuples on page 
     */ 
</span>    <a href="gistget.c.html#LN330"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistget.c.html#LN330"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN394"></a>        <a href="../../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>iid</span> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN395"></a>        <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN396"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span><a name="LN397"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>recheck</span><span class='Delimiter'>; 
</span><a name="LN398"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>recheck_distances</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the scan specifies not to return killed tuples, then we treat a 
         * killed tuple as not passing the qual. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN99"><span class='Ref_to_Member'>ignore_killed_tuples</span></a> <span class='Operator'>&& </span><a href="../../../include/storage/itemid.h.html#LN111"><span class='Ref_to_Macro'>ItemIdIsDead</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN394"><span class='Ref_To_Local'>iid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN394"><span class='Ref_To_Local'>iid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Must call gistindex_keytest in tempCxt, and clean up any leftover 
         * junk afterward. 
         */ 
</span>        <a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN151"><span class='Ref_to_Member'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN78"><span class='Ref_to_Member'>tempCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN396"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN122"><span class='Ref_to_Func'>gistindex_keytest</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="gistget.c.html#LN397"><span class='Ref_To_Local'>recheck</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN398"><span class='Ref_To_Local'>recheck_distances</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN151"><span class='Ref_to_Member'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN78"><span class='Ref_to_Member'>tempCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore tuple if it doesn't match */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN396"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN322"><span class='Ref_to_Parameter'>tbm</span></a> <span class='Operator'>&& </span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * getbitmap scan, so just push heap tuple TIDs into the bitmap 
             * without worrying about ordering 
             */ 
</span>            <a href="../../../include/nodes/tidbitmap.h.html#LN54"><span class='Ref_to_Proto'>tbm_add_tuples</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN322"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="gistget.c.html#LN397"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistget.c.html#LN322"><span class='Ref_to_Parameter'>ntids</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Non-ordered scan, so report tuples in so-&GT;pageData[] 
             */ 
</span>            <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN118"><span class='Ref_to_Member'>heapPtr</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Delimiter'>; 
</span>            <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN119"><span class='Ref_to_Member'>recheck</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN397"><span class='Ref_To_Local'>recheck</span></a><span class='Delimiter'>; 
</span>            <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN123"><span class='Ref_to_Member'>offnum</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN331"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In an index-only scan, also fetch the data from the tuple.  The 
             * reconstructed tuples are stored in pageDataCxt. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN121"><span class='Ref_to_Member'>recontup</span></a> <span class='Operator'>= 
</span>                    <a href="../../../include/access/gist_private.h.html#LN479"><span class='Ref_to_Proto'>gistFetchTuple</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN325"><span class='Ref_To_Local'>giststate</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN326"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if scan-&GT;numberOfOrderBy... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Must push item into search queue.  We get here for any lower 
             * index page, and also for heap tuples if doing an ordered 
             * search. 
             */ 
</span><a name="LN463"></a>            <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
            <a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN155"><span class='Ref_to_Member'>queueCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Create new GISTSearchItem for this item */ 
</span>            <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN144"><span class='Ref_to_Macro'>SizeOfGISTSearchItem</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Creating heap-tuple GISTSearchItem */ 
</span>                <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
</span>                <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN118"><span class='Ref_to_Member'>heapPtr</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Delimiter'>; 
</span>                <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN119"><span class='Ref_to_Member'>recheck</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN397"><span class='Ref_To_Local'>recheck</span></a><span class='Delimiter'>; 
</span>                <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN120"><span class='Ref_to_Member'>recheckDistances</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN398"><span class='Ref_To_Local'>recheck_distances</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * In an index-only scan, also fetch the data from the tuple. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>                    <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN121"><span class='Ref_to_Member'>recontup</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN479"><span class='Ref_to_Proto'>gistFetchTuple</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN325"><span class='Ref_To_Local'>giststate</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN326"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Creating index-page GISTSearchItem */ 
</span>                <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/storage/itemptr.h.html#LN74"><span class='Ref_to_Macro'>ItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN395"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * LSN of current page is lsn of parent page for child. We 
                 * only have a shared lock, so we need to get the LSN 
                 * atomically. 
                 */ 
</span>                <a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN202"><span class='Ref_to_Proto'>BufferGetLSNAtomic</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN327"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Insert it into the queue using new distance data */ 
</span>            memcpy<span class='Parentheses'>(</span><a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN160"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>, 
</span>                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistget.c.html#LN321"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/lib/pairingheap.h.html#LN80"><span class='Ref_to_Proto'>pairingheap_add</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN324"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN154"><span class='Ref_to_Member'>queue</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN463"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN130"><span class='Ref_to_Member'>phNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN332"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=FirstOffsetNumber;i... &raquo; </span> 
 
    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN327"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistScanPage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract next item (in order) from search queue 
 * 
 * Returns a GISTSearchItem or NULL.  Caller must pfree item when done with it. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>* 
</span><a name="LN516"></a><span class='Declare_Function'>getNextGISTSearchItem</span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Parameter'>so</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN518"></a>    <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/lib/pairingheap.h.html#LN95"><span class='Ref_to_Macro'>pairingheap_is_empty</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN516"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN154"><span class='Ref_to_Member'>queue</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="gistget.c.html#LN518"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/lib/pairingheap.h.html#LN82"><span class='Ref_to_Proto'>pairingheap_remove_first</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN516"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN154"><span class='Ref_to_Member'>queue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Done when both heaps are empty */ 
</span>        <a href="gistget.c.html#LN518"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Return item; caller is responsible to pfree it */ 
</span>    <span class='Control'>return</span> <a href="gistget.c.html#LN518"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch next heap tuple in an ordered search 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN538"></a><span class='Declare_Function'>getNextNearest</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN540"></a>    <a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN541"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN542"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* free previously returned tuple */ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span><a name="LN553"></a>        <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="gistget.c.html#LN515"><span class='Ref_to_Func'>getNextGISTSearchItem</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN540"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN142"><span class='Ref_to_Macro'>GISTSearchItemIsHeap</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* found a heap item at currently minimal distance */ 
</span>            <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN118"><span class='Ref_to_Member'>heapPtr</span></a><span class='Delimiter'>; 
</span>            <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN121"><span class='Ref_to_Member'>xs_recheck</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN119"><span class='Ref_to_Member'>recheck</span></a><span class='Delimiter'>; 
</span>            <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN132"><span class='Ref_to_Member'>xs_recheckorderby</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN120"><span class='Ref_to_Member'>recheckDistances</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a><span class='Delimiter'>; </span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN540"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN152"><span class='Ref_to_Member'>orderByTypes</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><span class='Directive'>#ifndef</span> USE_FLOAT8_BYVAL 
                    <span class='Comment_Multi_Line'>/* must free any old value to avoid memory leakage */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN131"><span class='Ref_to_Member'>xs_orderbynulls</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN130"><span class='Ref_to_Member'>xs_orderbyvals</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                    <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN130"><span class='Ref_to_Member'>xs_orderbyvals</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN745"><span class='Ref_to_Func'>Float8GetDatum</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN131"><span class='Ref_to_Member'>xs_orderbynulls</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN540"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN152"><span class='Ref_to_Member'>orderByTypes</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN38"><span class='Ref_to_Const'>FLOAT4OID</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* convert distance function's result to ORDER BY type */ 
</span><span class='Directive'>#ifndef</span> USE_FLOAT4_BYVAL 
                    <span class='Comment_Multi_Line'>/* must free any old value to avoid memory leakage */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN131"><span class='Ref_to_Member'>xs_orderbynulls</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN130"><span class='Ref_to_Member'>xs_orderbyvals</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
                    <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN130"><span class='Ref_to_Member'>xs_orderbyvals</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN696"><span class='Ref_to_Func'>Float4GetDatum</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN131"><span class='Ref_to_Member'>xs_orderbynulls</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * If the ordering operator's return value is anything 
                     * else, we don't know how to convert the float8 bound 
                     * calculated by the distance function to that.  The 
                     * executor won't actually need the order by values we 
                     * return here, if there are no lossy results, so only 
                     * insist on converting if the *recheck flag is set. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN132"><span class='Ref_to_Member'>xs_recheckorderby</span></a><span class='Parentheses'>) 
</span>                        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"GiST operator family's FOR ORDER BY operator must return float8 or float4 if the distance function is lossy"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN131"><span class='Ref_to_Member'>xs_orderbynulls</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;scan-&GT;numberOfO... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* in an index-only scan, also return the reconstructed tuple. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>                <a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN136"><span class='Ref_to_Member'>heap</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN121"><span class='Ref_to_Member'>recontup</span></a><span class='Delimiter'>; 
</span>            <a href="gistget.c.html#LN541"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if GISTSearchItemIsHeap(... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* visit an index page, extract its items into queue */ 
</span>            <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="gistget.c.html#LN320"><span class='Ref_to_Func'>gistScanPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN538"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN553"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN541"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="gistget.c.html#LN541"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getNextNearest &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * gistgettuple() -- Get the next tuple in the scan 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN626"></a><span class='Declare_Function'>gistgettuple</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN628"></a>    <a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>dir</span></a> <span class='Operator'>!= </span><a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"GiST only supports forward scan direction"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN156"><span class='Ref_to_Member'>qual_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN157"><span class='Ref_to_Member'>firstCall</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Begin the scan by processing the root page */ 
</span><a name="LN639"></a>        <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Declare_Local'>fakeItem</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/pgstat.h.html#LN1262"><span class='Ref_to_Macro'>pgstat_count_index_scan</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN157"><span class='Ref_to_Member'>firstCall</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN639"><span class='Ref_To_Local'>fakeItem</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN248"><span class='Ref_to_Const'>GIST_ROOT_BLKNO</span></a><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN639"><span class='Ref_To_Local'>fakeItem</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN49"><span class='Ref_to_Typedef'>GistNSN</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="gistget.c.html#LN320"><span class='Ref_to_Func'>gistScanPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN639"><span class='Ref_To_Local'>fakeItem</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must fetch tuples in strict distance order */ 
</span>        <span class='Control'>return</span> <a href="gistget.c.html#LN537"><span class='Ref_to_Func'>getNextNearest</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Fetch tuples index-page-at-a-time */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>&LT; </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN98"><span class='Ref_to_Member'>kill_prior_tuple</span></a> <span class='Operator'>&& </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN671"></a>                        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span> <span class='Operator'>= 
</span>                        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN151"><span class='Ref_to_Member'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN77"><span class='Ref_to_Member'>scanCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a> <span class='Operator'>= 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a> 
                                                    <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN671"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>&LT; </span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a><span class='Parentheses'>) 
</span>                        <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                            <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN123"><span class='Ref_to_Member'>offnum</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* continuing to return tuples from a leaf page */ 
</span>                <a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN118"><span class='Ref_to_Member'>heapPtr</span></a><span class='Delimiter'>; 
</span>                <a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN121"><span class='Ref_to_Member'>xs_recheck</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN119"><span class='Ref_to_Member'>recheck</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* in an index-only scan, also return the reconstructed tuple */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>                    <a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN121"><span class='Ref_to_Member'>recontup</span></a><span class='Delimiter'>; 
</span> 
                <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if so-&GT;curPageData&LT;so-&GT;n... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Check the last returned tuple and add it to killitems if 
             * necessary 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN98"><span class='Ref_to_Member'>kill_prior_tuple</span></a> 
                <span class='Operator'>&& </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> 
                <span class='Operator'>&& </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>== </span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN708"></a>                    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span> <span class='Operator'>= 
</span>                    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN151"><span class='Ref_to_Member'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN77"><span class='Ref_to_Member'>scanCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a> <span class='Operator'>= 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a> 
                                                <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN708"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>&LT; </span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a><span class='Parentheses'>) 
</span>                    <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN163"><span class='Ref_to_Member'>killedItems</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                        <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN169"><span class='Ref_to_Member'>pageData</span></a><span class='Delimiter'>[</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN123"><span class='Ref_to_Member'>offnum</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if scan-&GT;kill_prior_tupl... &raquo; </span> 
            <span class='Comment_Multi_Line'>/* find and process the next index page */ 
</span>            <span class='Control'>do</span> 
            <span class='Delimiter'>{ 
</span><a name="LN724"></a>                <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN165"><span class='Ref_to_Member'>curBlkno</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN164"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                    <a href="gistget.c.html#LN35"><span class='Ref_to_Func'>gistkillitems</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="gistget.c.html#LN724"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN515"><span class='Ref_to_Func'>getNextGISTSearchItem</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN724"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* save current item BlockNumber for next gistkillitems() call */ 
</span>                <a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN165"><span class='Ref_to_Member'>curBlkno</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN724"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * While scanning a leaf page, ItemPointers of matching heap 
                 * tuples are stored in so-&GT;pageData.  If there are any on 
                 * this page, we fall out of the inner "do" and loop around to 
                 * return them. 
                 */ 
</span>                <a href="gistget.c.html#LN320"><span class='Ref_to_Func'>gistScanPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN626"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN724"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN724"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN724"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN628"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end gistgettuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * gistgetbitmap() -- Get a bitmap of all heap tuple locations 
 */ 
</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN757"></a><span class='Declare_Function'>gistgetbitmap</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../nodes/tidbitmap.c.html#LN146"><span class='Ref_to_Struct'>TIDBitmap</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN759"></a>    <a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN176"><span class='Ref_to_Typedef'>GISTScanOpaque</span></a><span class='Parentheses'>) </span><a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN760"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>ntids</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN761"></a>    <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Declare_Local'>fakeItem</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN759"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN156"><span class='Ref_to_Member'>qual_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/pgstat.h.html#LN1262"><span class='Ref_to_Macro'>pgstat_count_index_scan</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Begin the scan by processing the root page */ 
</span>    <a href="gistget.c.html#LN759"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN171"><span class='Ref_to_Member'>curPageData</span></a> <span class='Operator'>= </span><a href="gistget.c.html#LN759"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN170"><span class='Ref_to_Member'>nPageData</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistget.c.html#LN759"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN759"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN172"><span class='Ref_to_Member'>pageDataCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistget.c.html#LN761"><span class='Ref_To_Local'>fakeItem</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN131"><span class='Ref_to_Member'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN248"><span class='Ref_to_Const'>GIST_ROOT_BLKNO</span></a><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistget.c.html#LN761"><span class='Ref_To_Local'>fakeItem</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN137"><span class='Ref_to_Member'>data</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN134"><span class='Ref_to_Member'>parentlsn</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN49"><span class='Ref_to_Typedef'>GistNSN</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistget.c.html#LN320"><span class='Ref_to_Func'>gistScanPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN761"><span class='Ref_To_Local'>fakeItem</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN760"><span class='Ref_To_Local'>ntids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * While scanning a leaf page, ItemPointers of matching heap tuples will 
     * be stored directly into tbm, so we don't need to deal with them here. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN784"></a>        <a href="../../../include/access/gist_private.h.html#LN128"><span class='Ref_to_Struct'>GISTSearchItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="gistget.c.html#LN515"><span class='Ref_to_Func'>getNextGISTSearchItem</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN759"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="gistget.c.html#LN784"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="gistget.c.html#LN320"><span class='Ref_to_Func'>gistScanPage</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN784"><span class='Ref_To_Local'>item</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN784"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN138"><span class='Ref_to_Member'>distances</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN757"><span class='Ref_to_Parameter'>tbm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistget.c.html#LN760"><span class='Ref_To_Local'>ntids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN784"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="gistget.c.html#LN760"><span class='Ref_To_Local'>ntids</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistgetbitmap &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Can we do index-only scans on the given index column? 
 * 
 * Opclasses that implement a fetch function support index-only scans. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN805"></a><span class='Declare_Function'>gistcanreturn</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN172"><span class='Ref_to_Proto'>index_getprocid</span></a><span class='Parentheses'>(</span><a href="gistget.c.html#LN805"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>, </span><a href="gistget.c.html#LN805"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN35"><span class='Ref_to_Const'>GIST_FETCH_PROC</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>