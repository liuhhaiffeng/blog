<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\gist\gistproc.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\gist\gistproc.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:28 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * gistproc.c 
 *    Support procedures for GiSTs over 2-D objects (boxes, polygons, circles, 
 *    points). 
 * 
 * This gives R-tree behavior, with Guttman's poly-time split algorithm. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *  src/backend/access/gist/gistproc.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/gist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/stratnum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/geo_decls.h"</span> 
 
 
<a name="LN28"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>gist_box_leaf_consistent</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN29"></a>                         <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN30"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>rtree_internal_consistent</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN31"></a>                          <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Minimum accepted ratio of split */ 
</span><a name="LN34"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LIMIT_RATIO</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>3</span> 
 
<span class='Comment_Multi_Line'>/* Convenience macros for NaN-aware comparisons */ 
</span><a name="LN37"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_EQ</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN37"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN37"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN38"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_LT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN38"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN38"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN39"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_LE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN39"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN39"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_GT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN40"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN40"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_GE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN41"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN41"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_MAX</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="gistproc.c.html#LN40"><span class='Ref_to_Macro'>FLOAT8_GT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN42"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN42"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN42"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN42"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span> 
<a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>FLOAT8_MIN</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(</span><a href="gistproc.c.html#LN38"><span class='Ref_to_Macro'>FLOAT8_LT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN43"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN43"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN43"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN43"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span> 
 
 
<span class='Comment_Multi_Line'>/************************************************** 
 * Box ops 
 **************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Calculates union of two boxes, a and b. The result is stored in *n. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN54"></a><span class='Declare_Function'>rt_box_union</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>n</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN42"><span class='Ref_to_Macro'>FLOAT8_MAX</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN42"><span class='Ref_to_Macro'>FLOAT8_MAX</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN43"><span class='Ref_to_Macro'>FLOAT8_MIN</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN43"><span class='Ref_to_Macro'>FLOAT8_MIN</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN54"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Size of a BOX for penalty-calculation purposes. 
 * The result can be +Infinity, but not NaN. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN67"></a><span class='Declare_Function'>size_box</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>box</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Check for zero-width cases.  Note that we define the size of a zero- 
     * by-infinity box as zero.  It's important to special-case this somehow, 
     * as naively multiplying infinity by zero will produce NaN. 
     * 
     * The less-than cases should not happen, but if they do, say "zero". 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN39"><span class='Ref_to_Macro'>FLOAT8_LE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="gistproc.c.html#LN39"><span class='Ref_to_Macro'>FLOAT8_LE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We treat NaN as larger than +Infinity, so any distance involving a NaN 
     * and a non-NaN is infinite.  Note the previous check eliminated the 
     * possibility that the low fields are NaNs. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN67"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end size_box &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return amount by which the union of the two boxes is larger than 
 * the original BOX's area.  The result can be +Infinity, but not NaN. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN95"></a><span class='Declare_Function'>box_penalty</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>original</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN97"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>         <span class='Declare_Local'>unionbox</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN53"><span class='Ref_to_Func'>rt_box_union</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN97"><span class='Ref_To_Local'>unionbox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN95"><span class='Ref_to_Parameter'>original</span></a><span class='Delimiter'>, </span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="gistproc.c.html#LN66"><span class='Ref_to_Func'>size_box</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN97"><span class='Ref_To_Local'>unionbox</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="gistproc.c.html#LN66"><span class='Ref_to_Func'>size_box</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN95"><span class='Ref_to_Parameter'>original</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The GiST Consistent method for boxes 
 * 
 * Should return false if for all data items x below entry, 
 * the predicate x op query must be FALSE, where op is the oper 
 * corresponding to strategy in the pg_amop table. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN111"></a><span class='Declare_Function'>gist_box_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN113"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN160"><span class='Ref_to_Macro'>PG_GETARG_BOX_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Oid      subtype = PG_GETARG_OID(3); */ 
</span><a name="LN118"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* All cases served by this function are exact */ 
</span>    <span class='Operator'>*</span><a href="gistproc.c.html#LN118"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN113"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="gistproc.c.html#LN114"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if entry is not leaf, use rtree_internal_consistent, else use 
     * gist_box_leaf_consistent 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN132"><span class='Ref_to_Macro'>GIST_LEAF</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN113"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN28"><span class='Ref_to_Proto'>gist_box_leaf_consistent</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN113"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="gistproc.c.html#LN114"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, 
</span>                                                <a href="gistproc.c.html#LN115"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN30"><span class='Ref_to_Proto'>rtree_internal_consistent</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN113"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="gistproc.c.html#LN114"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, 
</span>                                                 <a href="gistproc.c.html#LN115"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_box_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Increase BOX b to include addon. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN144"></a><span class='Declare_Function'>adjustBox</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>addon</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN38"><span class='Ref_to_Macro'>FLOAT8_LT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>))</span> 
        <a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN40"><span class='Ref_to_Macro'>FLOAT8_GT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>))</span> 
        <a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN38"><span class='Ref_to_Macro'>FLOAT8_LT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span> 
        <a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN40"><span class='Ref_to_Macro'>FLOAT8_GT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span> 
        <a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN144"><span class='Ref_to_Parameter'>addon</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The GiST Union method for boxes 
 * 
 * returns the minimal bounding box that encloses all the entries in entryvec 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN162"></a><span class='Declare_Function'>gist_box_union</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN164"></a>    <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entryvec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN165"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>sizep</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN166"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numranges</span><span class='Delimiter'>, 
</span><a name="LN167"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN168"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>, 
</span><a name="LN169"></a>               <span class='Operator'>*</span><span class='Declare_Local'>pageunion</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN166"><span class='Ref_To_Local'>numranges</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN164"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN169"><span class='Ref_To_Local'>pageunion</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN168"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN164"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN169"><span class='Ref_To_Local'>pageunion</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN168"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN167"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="gistproc.c.html#LN167"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN166"><span class='Ref_To_Local'>numranges</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN167"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="gistproc.c.html#LN168"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN164"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN167"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN143"><span class='Ref_to_Func'>adjustBox</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN169"><span class='Ref_To_Local'>pageunion</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN168"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="gistproc.c.html#LN165"><span class='Ref_To_Local'>sizep</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN169"><span class='Ref_To_Local'>pageunion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_box_union &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GiST Compress methods for boxes 
 * 
 * do not do anything. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN192"></a><span class='Declare_Function'>gist_box_compress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GiST DeCompress method for boxes (also used for points, polygons 
 * and circles) 
 * 
 * do not do anything --- we just use the stored box as is. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN204"></a><span class='Declare_Function'>gist_box_decompress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GiST Fetch method for boxes 
 * do not do anything --- we just return the stored box as is. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN214"></a><span class='Declare_Function'>gist_box_fetch</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The GiST Penalty method for boxes (also used for points) 
 * 
 * As in the R-tree paper, we use change in area as our penalty metric 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN225"></a><span class='Declare_Function'>gist_box_penalty</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN227"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>origentry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN228"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newentry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN229"></a>    <span class='Keyword'>float</span>      <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>float </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN230"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>origbox</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN227"><span class='Ref_To_Local'>origentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN231"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newbox</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN228"><span class='Ref_To_Local'>newentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="gistproc.c.html#LN229"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>float</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN94"><span class='Ref_to_Func'>box_penalty</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN230"><span class='Ref_To_Local'>origbox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN231"><span class='Ref_To_Local'>newbox</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN229"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Trivial split: half of entries will be placed on one page 
 * and another half - to another 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN242"></a><span class='Declare_Function'>fallbackSplit</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN244"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN245"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN246"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>unionL</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN247"></a>               <span class='Operator'>*</span><span class='Declare_Local'>unionR</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN245"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN248"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN245"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN248"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN248"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN245"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN259"></a>        <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>cur</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN245"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN246"><span class='Ref_To_Local'>unionL</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="gistproc.c.html#LN246"><span class='Ref_To_Local'>unionL</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="gistproc.c.html#LN246"><span class='Ref_To_Local'>unionL</span></a> <span class='Operator'>= *</span><a href="gistproc.c.html#LN259"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="gistproc.c.html#LN143"><span class='Ref_to_Func'>adjustBox</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN246"><span class='Ref_To_Local'>unionL</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN259"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistproc.c.html#LN244"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN247"><span class='Ref_To_Local'>unionR</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="gistproc.c.html#LN247"><span class='Ref_To_Local'>unionR</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="gistproc.c.html#LN247"><span class='Ref_To_Local'>unionR</span></a> <span class='Operator'>= *</span><a href="gistproc.c.html#LN259"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="gistproc.c.html#LN143"><span class='Ref_to_Func'>adjustBox</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN247"><span class='Ref_To_Local'>unionR</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN259"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=FirstOffsetNumber;i... &raquo; </span> 
 
    <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN159"><span class='Ref_to_Macro'>BoxPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN246"><span class='Ref_To_Local'>unionL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN242"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN159"><span class='Ref_to_Macro'>BoxPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN247"><span class='Ref_To_Local'>unionR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end fallbackSplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Represents information about an entry that can be placed to either group 
 * without affecting overlap over selected axis ("common entry"). 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Index of entry in the initial array */ 
</span><a name="LN300"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>index</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Delta between penalties of entry insertion into different groups */ 
</span><a name="LN302"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>delta</span><span class='Delimiter'>; 
</span><a name="LN303"></a>} <span class='Declare_Typedef'>CommonEntry</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Context for g_box_consider_split. Contains information about currently 
 * selected split and some general information. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN311"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>entriesCount</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* total number of entries being split */ 
</span><a name="LN312"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>         <span class='Declare_Member'>boundingBox</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* minimum bounding box across all entries */ 
</span> 
    <span class='Comment_Multi_Line'>/* Information about currently selected split follows */ 
</span> 
<a name="LN316"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>first</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* true if no split was selected yet */ 
</span> 
<a name="LN318"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>leftUpper</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* upper bound of left interval */ 
</span><a name="LN319"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>rightLower</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* lower bound of right interval */ 
</span> 
<a name="LN321"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>ratio</span><span class='Delimiter'>; 
</span><a name="LN322"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>overlap</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>dim</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* axis of this split */ 
</span><a name="LN324"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>range</span><span class='Delimiter'>;</span>          <span class='Comment_Multi_Line'>/* width of general MBR projection to the 
                                 * selected axis */ 
</span><a name="LN326"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ConsiderSplitContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Interval represents projection of box to axis. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN333"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>lower</span><span class='Delimiter'>, 
</span><a name="LN334"></a>                <span class='Declare_Member'>upper</span><span class='Delimiter'>; 
</span><a name="LN335"></a>} <span class='Declare_Typedef'>SplitInterval</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Interval comparison function by lower bound of the interval; 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN341"></a><span class='Declare_Function'>interval_cmp_lower</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN343"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>lower1</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN341"><span class='Ref_to_Parameter'>i1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>lower<span class='Delimiter'>, 
</span><a name="LN344"></a>                <span class='Declare_Local'>lower2</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN341"><span class='Ref_to_Parameter'>i2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>lower<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN343"><span class='Ref_To_Local'>lower1</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN344"><span class='Ref_To_Local'>lower2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Interval comparison function by upper bound of the interval; 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN353"></a><span class='Declare_Function'>interval_cmp_upper</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN355"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>upper1</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN353"><span class='Ref_to_Parameter'>i1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>upper<span class='Delimiter'>, 
</span><a name="LN356"></a>                <span class='Declare_Local'>upper2</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN353"><span class='Ref_to_Parameter'>i2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>upper<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN64"><span class='Ref_to_Proto'>float8_cmp_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN355"><span class='Ref_To_Local'>upper1</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN356"><span class='Ref_To_Local'>upper2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Replace negative (or NaN) value with zero. 
 */ 
</span><span class='Keyword'>static inline float 
</span><a name="LN365"></a><span class='Declare_Function'>non_negative</span><span class='Parentheses'>(</span><span class='Keyword'>float </span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN365"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0f</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="gistproc.c.html#LN365"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0f</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Consider replacement of currently selected split with the better one. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN377"></a><span class='Declare_Function'>g_box_consider_split</span><span class='Parentheses'>(</span><a href="../../utils/adt/rangetypes_gist.c.html#LN69"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dimNum</span><span class='Delimiter'>, 
</span><a name="LN378"></a>                     <span class='Keyword'>double </span><span class='Declare_Parameter'>rightLower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>minLeftCount</span><span class='Delimiter'>, 
</span><a name="LN379"></a>                     <span class='Keyword'>double </span><span class='Declare_Parameter'>leftUpper</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxLeftCount</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN381"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>leftCount</span><span class='Delimiter'>, 
</span><a name="LN382"></a>                <span class='Declare_Local'>rightCount</span><span class='Delimiter'>; 
</span><a name="LN383"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Local'>ratio</span><span class='Delimiter'>, 
</span><a name="LN384"></a>                <span class='Declare_Local'>overlap</span><span class='Delimiter'>; 
</span><a name="LN385"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>range</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate entries distribution ratio assuming most uniform distribution 
     * of common entries. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN378"><span class='Ref_to_Parameter'>minLeftCount</span></a> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN311"><span class='Ref_to_Member'>entriesCount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="gistproc.c.html#LN381"><span class='Ref_To_Local'>leftCount</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN378"><span class='Ref_to_Parameter'>minLeftCount</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN379"><span class='Ref_to_Parameter'>maxLeftCount</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN311"><span class='Ref_to_Member'>entriesCount</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN381"><span class='Ref_To_Local'>leftCount</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN379"><span class='Ref_to_Parameter'>maxLeftCount</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistproc.c.html#LN381"><span class='Ref_To_Local'>leftCount</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN311"><span class='Ref_to_Member'>entriesCount</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="gistproc.c.html#LN382"><span class='Ref_To_Local'>rightCount</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN311"><span class='Ref_to_Member'>entriesCount</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN381"><span class='Ref_To_Local'>leftCount</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ratio of split - quotient between size of lesser group and total 
     * entries count. 
     */ 
</span>    <a href="gistproc.c.html#LN383"><span class='Ref_To_Local'>ratio</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>) </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN381"><span class='Ref_To_Local'>leftCount</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN382"><span class='Ref_To_Local'>rightCount</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ 
</span>        <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>) </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN311"><span class='Ref_to_Member'>entriesCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN383"><span class='Ref_To_Local'>ratio</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN34"><span class='Ref_to_Const'>LIMIT_RATIO</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN413"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>selectthis</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The ratio is acceptable, so compare current split with previously 
         * selected one. Between splits of one dimension we search for minimal 
         * overlap (allowing negative values) and minimal ration (between same 
         * overlaps. We switch dimension if find less overlap (non-negative) 
         * or less range with same overlap. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>dimNum</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN385"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN312"><span class='Ref_to_Member'>boundingBox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN312"><span class='Ref_to_Member'>boundingBox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistproc.c.html#LN385"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN312"><span class='Ref_to_Member'>boundingBox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN312"><span class='Ref_to_Member'>boundingBox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN384"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN379"><span class='Ref_to_Parameter'>leftUpper</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN378"><span class='Ref_to_Parameter'>rightLower</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="gistproc.c.html#LN385"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If there is no previous selection, select this */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN413"><span class='Ref_To_Local'>selectthis</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN323"><span class='Ref_to_Member'>dim</span></a> <span class='Operator'>== </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>dimNum</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Within the same dimension, choose the new split if it has a 
             * smaller overlap, or same overlap but better ratio. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN384"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="gistproc.c.html#LN384"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>== </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a> <span class='Operator'>&& </span><a href="gistproc.c.html#LN383"><span class='Ref_To_Local'>ratio</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN82"><span class='Ref_to_Member'>ratio</span></a><span class='Parentheses'>))</span> 
                <a href="gistproc.c.html#LN413"><span class='Ref_To_Local'>selectthis</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Across dimensions, choose the new split if it has a smaller 
             * *non-negative* overlap, or same *non-negative* overlap but 
             * bigger range. This condition differs from the one described in 
             * the article. On the datasets where leaf MBRs don't overlap 
             * themselves, non-overlapping splits (i.e. splits which have zero 
             * *non-negative* overlap) are frequently possible. In this case 
             * splits tends to be along one dimension, because most distant 
             * non-overlapping splits (i.e. having lowest negative overlap) 
             * appears to be in the same dimension as in the previous split. 
             * Therefore MBRs appear to be very prolonged along another 
             * dimension, which leads to bad search performance. Using range 
             * as the second split criteria makes MBRs more quadratic. Using 
             * *non-negative* overlap instead of overlap as the first split 
             * criteria gives to range criteria a chance to matter, because 
             * non-overlapping splits are equivalent in this criteria. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN364"><span class='Ref_to_Func'>non_negative</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN384"><span class='Ref_To_Local'>overlap</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN364"><span class='Ref_to_Func'>non_negative</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="gistproc.c.html#LN385"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN324"><span class='Ref_to_Member'>range</span></a> <span class='Operator'>&& 
</span>                 <a href="gistproc.c.html#LN364"><span class='Ref_to_Func'>non_negative</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN384"><span class='Ref_To_Local'>overlap</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN364"><span class='Ref_to_Func'>non_negative</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a><span class='Parentheses'>)))</span> 
                <a href="gistproc.c.html#LN413"><span class='Ref_To_Local'>selectthis</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN413"><span class='Ref_To_Local'>selectthis</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* save information about selected split */ 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN82"><span class='Ref_to_Member'>ratio</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN383"><span class='Ref_To_Local'>ratio</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN324"><span class='Ref_to_Member'>range</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN385"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="../../utils/adt/rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN384"><span class='Ref_To_Local'>overlap</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN319"><span class='Ref_to_Member'>rightLower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN378"><span class='Ref_to_Parameter'>rightLower</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN318"><span class='Ref_to_Member'>leftUpper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN379"><span class='Ref_to_Parameter'>leftUpper</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="gistproc.c.html#LN323"><span class='Ref_to_Member'>dim</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN377"><span class='Ref_to_Parameter'>dimNum</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ratio&GT;LIMIT_RATIO &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end g_box_consider_split &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compare common entries by their deltas. 
 * (We assume the deltas can't be NaN.) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN486"></a><span class='Declare_Function'>common_entry_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN488"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>delta1</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../utils/adt/rangetypes_gist.c.html#LN102"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN486"><span class='Ref_to_Parameter'>i1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>delta<span class='Delimiter'>, 
</span><a name="LN489"></a>                <span class='Declare_Local'>delta2</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../utils/adt/rangetypes_gist.c.html#LN102"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN486"><span class='Ref_to_Parameter'>i2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>delta<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN488"><span class='Ref_To_Local'>delta1</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN489"><span class='Ref_To_Local'>delta2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN488"><span class='Ref_To_Local'>delta1</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN489"><span class='Ref_To_Local'>delta2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * -------------------------------------------------------------------------- 
 * Double sorting split algorithm. This is used for both boxes and points. 
 * 
 * The algorithm finds split of boxes by considering splits along each axis. 
 * Each entry is first projected as an interval on the X-axis, and different 
 * ways to split the intervals into two groups are considered, trying to 
 * minimize the overlap of the groups. Then the same is repeated for the 
 * Y-axis, and the overall best split is chosen. The quality of a split is 
 * determined by overlap along that axis and some other criteria (see 
 * g_box_consider_split). 
 * 
 * After that, all the entries are divided into three groups: 
 * 
 * 1) Entries which should be placed to the left group 
 * 2) Entries which should be placed to the right group 
 * 3) "Common entries" which can be placed to any of groups without affecting 
 *    of overlap along selected axis. 
 * 
 * The common entries are distributed by minimizing penalty. 
 * 
 * For details see: 
 * "A new double sorting-based node splitting algorithm for R-tree", A. Korotkov 
 * http://syrcose.ispras.ru/2011/files/SYRCoSE2011_Proceedings.pdf#page=36 
 * -------------------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN526"></a><span class='Declare_Function'>gist_box_picksplit</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN528"></a>    <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entryvec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN529"></a>    <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN530"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN531"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN532"></a>    <a href="../../utils/adt/rangetypes_gist.c.html#LN69"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span><a name="LN533"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>box</span><span class='Delimiter'>, 
</span><a name="LN534"></a>               <span class='Operator'>*</span><span class='Declare_Local'>leftBox</span><span class='Delimiter'>, 
</span><a name="LN535"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rightBox</span><span class='Delimiter'>; 
</span><a name="LN536"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dim</span><span class='Delimiter'>, 
</span><a name="LN537"></a>                <span class='Declare_Local'>commonEntriesCount</span><span class='Delimiter'>; 
</span><a name="LN538"></a>    <a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Declare_Local'>intervalsLower</span><span class='Delimiter'>, 
</span><a name="LN539"></a>               <span class='Operator'>*</span><span class='Declare_Local'>intervalsUpper</span><span class='Delimiter'>; 
</span><a name="LN540"></a>    <a href="../../utils/adt/rangetypes_gist.c.html#LN102"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>commonEntries</span><span class='Delimiter'>; 
</span><a name="LN541"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nentries</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../utils/adt/rangetypes_gist.c.html#LN69"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN531"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN311"><span class='Ref_to_Member'>entriesCount</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN531"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate arrays for intervals along axes */ 
</span>    <a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate the overall minimum bounding box over all the entries. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN531"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN312"><span class='Ref_to_Member'>boundingBox</span></a> <span class='Operator'>= *</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistproc.c.html#LN143"><span class='Ref_to_Func'>adjustBox</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN312"><span class='Ref_to_Member'>boundingBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Iterate over axes for optimal split searching. 
     */ 
</span>    <a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* nothing selected yet */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN536"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistproc.c.html#LN536"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Delimiter'>; </span><a href="gistproc.c.html#LN536"><span class='Ref_To_Local'>dim</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN570"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>leftUpper</span><span class='Delimiter'>, 
</span><a name="LN571"></a>                    <span class='Declare_Local'>rightLower</span><span class='Delimiter'>; 
</span><a name="LN572"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i1</span><span class='Delimiter'>, 
</span><a name="LN573"></a>                    <span class='Declare_Local'>i2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Project each entry as an interval on the selected axis. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN531"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN536"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>                <a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>                <a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make two arrays of intervals: one sorted by lower bound and another 
         * sorted by upper bound. 
         */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>, 
</span>               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../utils/adt/rangetypes_gist.c.html#LN162"><span class='Ref_to_Proto'>interval_cmp_lower</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN331"><span class='Ref_to_Typedef'>SplitInterval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../utils/adt/rangetypes_gist.c.html#LN163"><span class='Ref_to_Proto'>interval_cmp_upper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/*---- 
         * The goal is to form a left and right interval, so that every entry 
         * interval is contained by either left or right interval (or both). 
         * 
         * For example, with the intervals (0,1), (1,3), (2,3), (2,4): 
         * 
         * 0 1 2 3 4 
         * +-+ 
         *   +---+ 
         *     +-+ 
         *     +---+ 
         * 
         * The left and right intervals are of the form (0,a) and (b,4). 
         * We first consider splits where b is the lower bound of an entry. 
         * We iterate through all entries, and for each b, calculate the 
         * smallest possible a. Then we consider splits where a is the 
         * upper bound of an entry, and for each a, calculate the greatest 
         * possible b. 
         * 
         * In the above example, the first loop would consider splits: 
         * b=0: (0,1)-(0,4) 
         * b=1: (0,1)-(1,4) 
         * b=2: (0,3)-(2,4) 
         * 
         * And the second loop: 
         * a=1: (0,1)-(1,4) 
         * a=3: (0,3)-(2,4) 
         * a=4: (0,4)-(2,4) 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Iterate over lower bound of right group, finding smallest possible 
         * upper bound of left group. 
         */ 
</span>        <a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Find next lower bound of right group. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>&& 
</span>                   <a href="gistproc.c.html#LN37"><span class='Ref_to_Macro'>FLOAT8_EQ</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN38"><span class='Ref_to_Macro'>FLOAT8_LT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Parentheses'>))</span> 
                    <a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span>                <a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Find count of intervals which anyway should be placed to the 
             * left group. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>&& 
</span>                   <a href="gistproc.c.html#LN39"><span class='Ref_to_Macro'>FLOAT8_LE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a><span class='Parentheses'>))</span> 
                <a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Consider found split. 
             */ 
</span>            <a href="gistproc.c.html#LN376"><span class='Ref_to_Func'>g_box_consider_split</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN536"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Iterate over upper bound of left group finding greatest possible 
         * lower bound of right group. 
         */ 
</span>        <a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Find next upper bound of left group. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="gistproc.c.html#LN37"><span class='Ref_to_Macro'>FLOAT8_EQ</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN40"><span class='Ref_to_Macro'>FLOAT8_GT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>))</span> 
                    <a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span>                <a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN539"><span class='Ref_To_Local'>intervalsUpper</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN334"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Find count of intervals which anyway should be placed to the 
             * right group. 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="gistproc.c.html#LN41"><span class='Ref_to_Macro'>FLOAT8_GE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN538"><span class='Ref_To_Local'>intervalsLower</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="gistproc.c.html#LN333"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a><span class='Parentheses'>))</span> 
                <a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Consider found split. 
             */ 
</span>            <a href="gistproc.c.html#LN376"><span class='Ref_to_Func'>g_box_consider_split</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN536"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, 
</span>                                 <a href="gistproc.c.html#LN571"><span class='Ref_To_Local'>rightLower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN572"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN570"><span class='Ref_To_Local'>leftUpper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN573"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for dim=0;dim&LT;2;dim++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we failed to find any acceptable splits, use trivial split. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="gistproc.c.html#LN241"><span class='Ref_to_Func'>fallbackSplit</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ok, we have now selected the split across one axis. 
     * 
     * While considering the splits, we already determined that there will be 
     * enough entries in both groups to reach the desired ratio, but we did 
     * not memorize which entries go to which group. So determine that now. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate vectors for results */ 
</span>    <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate bounding boxes of left and right groups */ 
</span>    <a href="gistproc.c.html#LN534"><span class='Ref_To_Local'>leftBox</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN535"><span class='Ref_To_Local'>rightBox</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate an array for "common entries" - entries which can be placed to 
     * either group without affecting overlap along selected axis. 
     */ 
</span>    <a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../utils/adt/rangetypes_gist.c.html#LN102"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../utils/adt/rangetypes_gist.c.html#LN102"><span class='Ref_to_Typedef'>CommonEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Helper macros to place an entry in the left or right group */ 
</span><a name="LN743"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PLACE_LEFT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>box</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>off</span><span class='Parentheses'>)</span>                    <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{</span>                                        <span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>                   <span class='Operator'>\ 
</span>            <a href="gistproc.c.html#LN143"><span class='Ref_to_Func'>adjustBox</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN534"><span class='Ref_To_Local'>leftBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>            <span class='Operator'>\ 
</span>        <span class='Control'>else</span>                                    <span class='Operator'>\ 
</span>            <span class='Operator'>*</span><a href="gistproc.c.html#LN534"><span class='Ref_To_Local'>leftBox</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>                  <span class='Operator'>\ 
</span>        <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span>off<span class='Delimiter'>;</span>      <span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN752"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PLACE_RIGHT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>box</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>off</span><span class='Parentheses'>)</span>                   <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{</span>                                        <span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>                  <span class='Operator'>\ 
</span>            <a href="gistproc.c.html#LN143"><span class='Ref_to_Func'>adjustBox</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN535"><span class='Ref_To_Local'>rightBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>           <span class='Operator'>\ 
</span>        <span class='Control'>else</span>                                    <span class='Operator'>\ 
</span>            <span class='Operator'>*</span><a href="gistproc.c.html#LN535"><span class='Ref_To_Local'>rightBox</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>                 <span class='Operator'>\ 
</span>        <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span>off<span class='Delimiter'>;</span>    <span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Distribute entries which can be distributed unambiguously, and collect 
     * common entries. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN531"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN767"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN768"></a>                    <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get upper and lower bounds along selected axis. 
         */ 
</span>        <a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN323"><span class='Ref_to_Member'>dim</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN767"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN768"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN767"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN768"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN39"><span class='Ref_to_Macro'>FLOAT8_LE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN768"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN318"><span class='Ref_to_Member'>leftUpper</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Fits to the left group */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN41"><span class='Ref_to_Macro'>FLOAT8_GE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN767"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN319"><span class='Ref_to_Member'>rightLower</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Fits also to the right group, so "common entry" */ 
</span>                <a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a><span class='Operator'>++</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Doesn't fit to the right group, so join to the left group */ 
</span>                <a href="../../utils/adt/rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Each entry should fit on either left or right group. Since this 
             * entry didn't fit on the left group, it better fit in the right 
             * group. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN41"><span class='Ref_to_Macro'>FLOAT8_GE</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN767"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN532"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="gistproc.c.html#LN319"><span class='Ref_to_Member'>rightLower</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Doesn't fit to the left group, so join to the right group */ 
</span>            <a href="../../utils/adt/rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=FirstOffsetNumber;i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Distribute "common entries", if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Calculate minimum number of entries that must be placed in both 
         * groups, to reach LIMIT_RATIO. 
         */ 
</span><a name="LN822"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>m</span> <span class='Operator'>= </span>ceil<span class='Parentheses'>(</span><a href="gistproc.c.html#LN34"><span class='Ref_to_Const'>LIMIT_RATIO</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN541"><span class='Ref_To_Local'>nentries</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Calculate delta between penalties of join "common entries" to 
         * different groups. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN107"><span class='Ref_to_Member'>delta</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN94"><span class='Ref_to_Func'>box_penalty</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN534"><span class='Ref_To_Local'>leftBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>) </span><span class='Operator'>- 
</span>                                         <a href="gistproc.c.html#LN94"><span class='Ref_to_Func'>box_penalty</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN535"><span class='Ref_To_Local'>rightBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Sort "common entries" by calculated deltas in order to distribute 
         * the most ambiguous entries first. 
         */ 
</span>        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../utils/adt/rangetypes_gist.c.html#LN102"><span class='Ref_to_Typedef'>CommonEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../utils/adt/rangetypes_gist.c.html#LN164"><span class='Ref_to_Proto'>common_entry_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Distribute "common entries" between groups. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a><span class='Delimiter'>; </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN528"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Check if we have to place this entry in either group to achieve 
             * LIMIT_RATIO. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN822"><span class='Ref_To_Local'>m</span></a><span class='Parentheses'>)</span> 
                <a href="../../utils/adt/rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN537"><span class='Ref_To_Local'>commonEntriesCount</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN822"><span class='Ref_To_Local'>m</span></a><span class='Parentheses'>)</span> 
                <a href="../../utils/adt/rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Otherwise select the group by minimal penalty */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN94"><span class='Ref_to_Func'>box_penalty</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN534"><span class='Ref_To_Local'>leftBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="gistproc.c.html#LN94"><span class='Ref_to_Func'>box_penalty</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN535"><span class='Ref_To_Local'>rightBox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>))</span> 
                    <a href="../../utils/adt/rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../utils/adt/rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN533"><span class='Ref_To_Local'>box</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN540"><span class='Ref_To_Local'>commonEntries</span></a><span class='Delimiter'>[</span><a href="gistproc.c.html#LN530"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../utils/adt/rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;commonEntriesCo... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if commonEntriesCount&GT;0 &raquo; </span> 
 
    <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN534"><span class='Ref_To_Local'>leftBox</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN535"><span class='Ref_To_Local'>rightBox</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN529"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_box_picksplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Equality method 
 * 
 * This is used for boxes, points, circles, and polygons, all of which store 
 * boxes as GiST index entries. 
 * 
 * Returns true only when boxes are exactly the same.  We can't use fuzzy 
 * comparisons here without breaking index consistency; therefore, this isn't 
 * equivalent to box_same(). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN883"></a><span class='Declare_Function'>gist_box_same</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN885"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>b1</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN160"><span class='Ref_to_Macro'>PG_GETARG_BOX_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN886"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>b2</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN160"><span class='Ref_to_Macro'>PG_GETARG_BOX_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN887"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN885"><span class='Ref_To_Local'>b1</span></a> <span class='Operator'>&& </span><a href="gistproc.c.html#LN886"><span class='Ref_To_Local'>b2</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="gistproc.c.html#LN887"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN37"><span class='Ref_to_Macro'>FLOAT8_EQ</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN885"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN886"><span class='Ref_To_Local'>b2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                   <a href="gistproc.c.html#LN37"><span class='Ref_to_Macro'>FLOAT8_EQ</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN885"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN886"><span class='Ref_To_Local'>b2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                   <a href="gistproc.c.html#LN37"><span class='Ref_to_Macro'>FLOAT8_EQ</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN885"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN886"><span class='Ref_To_Local'>b2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                   <a href="gistproc.c.html#LN37"><span class='Ref_to_Macro'>FLOAT8_EQ</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN885"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN886"><span class='Ref_To_Local'>b2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="gistproc.c.html#LN887"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN885"><span class='Ref_To_Local'>b1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="gistproc.c.html#LN886"><span class='Ref_To_Local'>b2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN887"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Leaf-level consistency for boxes: just apply the query operator 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN903"></a><span class='Declare_Function'>gist_box_leaf_consistent</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN905"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN43"><span class='Ref_to_Const'>RTLeftStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN536"><span class='Ref_to_Func'>box_left</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN44"><span class='Ref_to_Const'>RTOverLeftStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN551"><span class='Ref_to_Func'>box_overleft</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN45"><span class='Ref_to_Const'>RTOverlapStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN516"><span class='Ref_to_Func'>box_overlap</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN46"><span class='Ref_to_Const'>RTOverRightStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN577"><span class='Ref_to_Func'>box_overright</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN47"><span class='Ref_to_Const'>RTRightStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN562"><span class='Ref_to_Func'>box_right</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN48"><span class='Ref_to_Const'>RTSameStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN502"><span class='Ref_to_Func'>box_same</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN49"><span class='Ref_to_Const'>RTContainsStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN55"><span class='Ref_to_Const'>RTOldContainsStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN648"><span class='Ref_to_Func'>box_contain</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN50"><span class='Ref_to_Const'>RTContainedByStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN56"><span class='Ref_to_Const'>RTOldContainedByStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN634"><span class='Ref_to_Func'>box_contained</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN51"><span class='Ref_to_Const'>RTOverBelowStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN600"><span class='Ref_to_Func'>box_overbelow</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN52"><span class='Ref_to_Const'>RTBelowStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN588"><span class='Ref_to_Func'>box_below</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN53"><span class='Ref_to_Const'>RTAboveStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN611"><span class='Ref_to_Func'>box_above</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN54"><span class='Ref_to_Const'>RTOverAboveStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN623"><span class='Ref_to_Func'>box_overabove</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN903"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
    <span class='Control'>return</span> <a href="gistproc.c.html#LN905"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_box_leaf_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/***************************************** 
 * Common rtree functions (for boxes, polygons, and circles) 
 *****************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Internal-page consistency for all these types 
 * 
 * We can use the same function since all types use bounding boxes as the 
 * internal-page representation. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN990"></a><span class='Declare_Function'>rtree_internal_consistent</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN992"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN43"><span class='Ref_to_Const'>RTLeftStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN577"><span class='Ref_to_Func'>box_overright</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN44"><span class='Ref_to_Const'>RTOverLeftStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN562"><span class='Ref_to_Func'>box_right</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN45"><span class='Ref_to_Const'>RTOverlapStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN516"><span class='Ref_to_Func'>box_overlap</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN46"><span class='Ref_to_Const'>RTOverRightStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN536"><span class='Ref_to_Func'>box_left</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN47"><span class='Ref_to_Const'>RTRightStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN551"><span class='Ref_to_Func'>box_overleft</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN48"><span class='Ref_to_Const'>RTSameStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN49"><span class='Ref_to_Const'>RTContainsStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN55"><span class='Ref_to_Const'>RTOldContainsStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN648"><span class='Ref_to_Func'>box_contain</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN50"><span class='Ref_to_Const'>RTContainedByStrategyNumber</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN56"><span class='Ref_to_Const'>RTOldContainedByStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN516"><span class='Ref_to_Func'>box_overlap</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN51"><span class='Ref_to_Const'>RTOverBelowStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN611"><span class='Ref_to_Func'>box_above</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN52"><span class='Ref_to_Const'>RTBelowStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN623"><span class='Ref_to_Func'>box_overabove</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN53"><span class='Ref_to_Const'>RTAboveStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN600"><span class='Ref_to_Func'>box_overbelow</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN54"><span class='Ref_to_Const'>RTOverAboveStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= !</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN588"><span class='Ref_to_Func'>box_below</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN990"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
    <span class='Control'>return</span> <a href="gistproc.c.html#LN992"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end rtree_internal_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/************************************************** 
 * Polygon ops 
 **************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GiST compress for polygons: represent a polygon by its bounding box 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1070"></a><span class='Declare_Function'>gist_poly_compress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1072"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1073"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1072"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN126"><span class='Ref_to_Member'>leafkey</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1077"></a>        <a href="../../../include/utils/geo_decls.h.html#LN112"><span class='Ref_to_Typedef'>POLYGON</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN163"><span class='Ref_to_Macro'>DatumGetPolygonP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1072"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1078"></a>        <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1078"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistproc.c.html#LN1078"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1077"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN116"><span class='Ref_to_Member'>boundbox</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1073"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistproc.c.html#LN1073"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1078"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="gistproc.c.html#LN1072"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN123"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1072"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN124"><span class='Ref_to_Member'>page</span></a><span class='Delimiter'>, 
</span>                      <a href="gistproc.c.html#LN1072"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN125"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="gistproc.c.html#LN1073"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1072"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1073"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_poly_compress &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The GiST Consistent method for polygons 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1097"></a><span class='Declare_Function'>gist_poly_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1099"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1100"></a>    <a href="../../../include/utils/geo_decls.h.html#LN112"><span class='Ref_to_Typedef'>POLYGON</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN166"><span class='Ref_to_Macro'>PG_GETARG_POLYGON_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1101"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Oid      subtype = PG_GETARG_OID(3); */ 
</span><a name="LN1104"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1105"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* All cases served by this function are inexact */ 
</span>    <span class='Operator'>*</span><a href="gistproc.c.html#LN1104"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1099"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="gistproc.c.html#LN1100"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since the operators require recheck anyway, we can just use 
     * rtree_internal_consistent even at leaf nodes.  (This works in part 
     * because the index entries are bounding boxes not polygons.) 
     */ 
</span>    <a href="gistproc.c.html#LN1105"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN30"><span class='Ref_to_Proto'>rtree_internal_consistent</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1099"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1100"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN116"><span class='Ref_to_Member'>boundbox</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1101"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Avoid memory leak if supplied poly is toasted */ 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1100"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1105"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_poly_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/************************************************** 
 * Circle ops 
 **************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GiST compress for circles: represent a circle by its bounding box 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1135"></a><span class='Declare_Function'>gist_circle_compress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1137"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1138"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1137"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN126"><span class='Ref_to_Member'>leafkey</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1142"></a>        <a href="../../../include/utils/geo_decls.h.html#LN123"><span class='Ref_to_Typedef'>CIRCLE</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN170"><span class='Ref_to_Macro'>DatumGetCircleP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1137"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1143"></a>        <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1143"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1143"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>+ </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1143"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1143"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>+ </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1143"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1142"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1138"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistproc.c.html#LN1138"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1143"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="gistproc.c.html#LN1137"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN123"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1137"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN124"><span class='Ref_to_Member'>page</span></a><span class='Delimiter'>, 
</span>                      <a href="gistproc.c.html#LN1137"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN125"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="gistproc.c.html#LN1138"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1137"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1138"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_circle_compress &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The GiST Consistent method for circles 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1165"></a><span class='Declare_Function'>gist_circle_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1167"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    <a href="../../../include/utils/geo_decls.h.html#LN123"><span class='Ref_to_Typedef'>CIRCLE</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN172"><span class='Ref_to_Macro'>PG_GETARG_CIRCLE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1169"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Oid      subtype = PG_GETARG_OID(3); */ 
</span><a name="LN1172"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1173"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>         <span class='Declare_Local'>bbox</span><span class='Delimiter'>; 
</span><a name="LN1174"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* All cases served by this function are inexact */ 
</span>    <span class='Operator'>*</span><a href="gistproc.c.html#LN1172"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1167"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since the operators require recheck anyway, we can just use 
     * rtree_internal_consistent even at leaf nodes.  (This works in part 
     * because the index entries are bounding boxes not circles.) 
     */ 
</span>    <a href="gistproc.c.html#LN1173"><span class='Ref_To_Local'>bbox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>+ </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN1173"><span class='Ref_To_Local'>bbox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN1173"><span class='Ref_To_Local'>bbox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>+ </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN1173"><span class='Ref_To_Local'>bbox</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN125"><span class='Ref_to_Member'>center</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1168"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN126"><span class='Ref_to_Member'>radius</span></a><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN1174"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN30"><span class='Ref_to_Proto'>rtree_internal_consistent</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1167"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="gistproc.c.html#LN1173"><span class='Ref_To_Local'>bbox</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1169"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1174"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_circle_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/************************************************** 
 * Point ops 
 **************************************************/ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1203"></a><span class='Declare_Function'>gist_point_compress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1205"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1205"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN126"><span class='Ref_to_Member'>leafkey</span></a><span class='Parentheses'>)</span>         <span class='Comment_Single_Line'>/* Point, actually */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1209"></a>        <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>box</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1210"></a>        <a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>point</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN136"><span class='Ref_to_Macro'>DatumGetPointP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1205"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1211"></a>        <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>retval</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1209"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1209"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a> <span class='Operator'>= *</span><a href="gistproc.c.html#LN1210"><span class='Ref_To_Local'>point</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistproc.c.html#LN1211"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN159"><span class='Ref_to_Macro'>BoxPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1209"><span class='Ref_To_Local'>box</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="gistproc.c.html#LN1205"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN123"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1205"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN124"><span class='Ref_to_Member'>page</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1205"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN125"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1211"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1205"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_point_compress &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GiST Fetch method for point 
 * 
 * Get point coordinates from its bounding box coordinates and form new 
 * gistentry. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1231"></a><span class='Declare_Function'>gist_point_fetch</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1233"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1234"></a>    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1233"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1235"></a>    <a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN1236"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>retval</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN1236"><span class='Ref_To_Local'>retval</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN1235"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN1235"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1234"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>    <a href="gistproc.c.html#LN1235"><span class='Ref_To_Local'>r</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1234"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistproc.c.html#LN1236"><span class='Ref_To_Local'>retval</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1235"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="gistproc.c.html#LN1233"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN123"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1233"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN124"><span class='Ref_to_Member'>page</span></a><span class='Delimiter'>, 
</span>                  <a href="gistproc.c.html#LN1233"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN125"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1236"><span class='Ref_To_Local'>retval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a name="LN1251"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>point_point_distance</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>p1</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>p2</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="../../utils/adt/geo_ops.c.html#LN1895"><span class='Ref_to_Func'>point_distance</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                       <a href="../../../include/utils/geo_decls.h.html#LN137"><span class='Ref_to_Macro'>PointPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Parameter'>p1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN137"><span class='Ref_to_Macro'>PointPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Parameter'>p2</span></a><span class='Parentheses'>)))</span> 
 
<span class='Keyword'>static double 
</span><a name="LN1256"></a><span class='Declare_Function'>computeDistance</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isLeaf</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>box</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>point</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1258"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>isLeaf</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* simple point to point distance */ 
</span>        <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Macro'>point_point_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&& </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&& 
</span>             <a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&& </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* point inside the box */ 
</span>        <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&& </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* point is over or below box */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"inconsistent point values"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&& </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* point is to left or right of box */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&LT; </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>- </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"inconsistent point values"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* closest point will be a vertex */ 
</span><a name="LN1296"></a>        <a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a>       <span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1297"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>subresult</span><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Macro'>point_point_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Macro'>point_point_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1296"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1296"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Macro'>point_point_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistproc.c.html#LN1296"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a><span class='Delimiter'>; 
</span> 
        <a href="gistproc.c.html#LN1296"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1296"><span class='Ref_To_Local'>p</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>; 
</span>        <a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1251"><span class='Ref_to_Macro'>point_point_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1256"><span class='Ref_to_Parameter'>point</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistproc.c.html#LN1296"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a><span class='Parentheses'>) 
</span>            <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1297"><span class='Ref_To_Local'>subresult</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="gistproc.c.html#LN1258"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end computeDistance &raquo; </span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1322"></a><span class='Declare_Function'>gist_point_consistent_internal</span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, 
</span><a name="LN1323"></a>                               <span class='Keyword'>bool </span><span class='Declare_Parameter'>isLeaf</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/utils/geo_decls.h.html#LN57"><span class='Ref_to_Typedef'>Point</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1325"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1322"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN43"><span class='Ref_to_Const'>RTLeftStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN38"><span class='Ref_to_Macro'>FPlt</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN47"><span class='Ref_to_Const'>RTRightStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN40"><span class='Ref_to_Macro'>FPgt</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN53"><span class='Ref_to_Const'>RTAboveStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN40"><span class='Ref_to_Macro'>FPgt</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN52"><span class='Ref_to_Const'>RTBelowStrategyNumber</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN38"><span class='Ref_to_Macro'>FPlt</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN48"><span class='Ref_to_Const'>RTSameStrategyNumber</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>isLeaf</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* key.high must equal key.low, so we can disregard it */ 
</span>                <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN36"><span class='Ref_to_Macro'>FPeq</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                          <a href="../../../include/utils/geo_decls.h.html#LN36"><span class='Ref_to_Macro'>FPeq</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/geo_decls.h.html#LN39"><span class='Ref_to_Macro'>FPle</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                          <a href="../../../include/utils/geo_decls.h.html#LN41"><span class='Ref_to_Macro'>FPge</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                          <a href="../../../include/utils/geo_decls.h.html#LN39"><span class='Ref_to_Macro'>FPle</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                          <a href="../../../include/utils/geo_decls.h.html#LN41"><span class='Ref_to_Macro'>FPge</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1323"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1322"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
 
    <span class='Control'>return</span> <a href="gistproc.c.html#LN1325"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_point_consistent_internal &raquo; </span> 
 
<a name="LN1365"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>GeoStrategyNumberOffset</span>     <span class='Number'>20</span> 
<a name="LN1366"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PointStrategyNumberGroup</span>    <span class='Number'>0</span> 
<a name="LN1367"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>BoxStrategyNumberGroup</span>      <span class='Number'>1</span> 
<a name="LN1368"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PolygonStrategyNumberGroup</span>  <span class='Number'>2</span> 
<a name="LN1369"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CircleStrategyNumberGroup</span>   <span class='Number'>3</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1372"></a><span class='Declare_Function'>gist_point_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1374"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1375"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1376"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1377"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1378"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategyGroup</span> <span class='Operator'>= </span><a href="gistproc.c.html#LN1375"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>/ </span><a href="gistproc.c.html#LN1365"><span class='Ref_to_Const'>GeoStrategyNumberOffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1378"><span class='Ref_To_Local'>strategyGroup</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="gistproc.c.html#LN1366"><span class='Ref_to_Const'>PointStrategyNumberGroup</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1321"><span class='Ref_to_Func'>gist_point_consistent_internal</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1375"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>% </span><a href="gistproc.c.html#LN1365"><span class='Ref_to_Const'>GeoStrategyNumberOffset</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/access/gist.h.html#LN132"><span class='Ref_to_Macro'>GIST_LEAF</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/utils/geo_decls.h.html#LN138"><span class='Ref_to_Macro'>PG_GETARG_POINT_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="gistproc.c.html#LN1376"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="gistproc.c.html#LN1367"><span class='Ref_to_Const'>BoxStrategyNumberGroup</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * The only operator in this group is point &LT;@ box (on_pb), so 
                 * we needn't examine strategy again. 
                 * 
                 * For historical reasons, on_pb uses exact rather than fuzzy 
                 * comparisons.  We could use box_overlap when at an internal 
                 * page, but that would lead to possibly visiting child pages 
                 * uselessly, because box_overlap uses fuzzy comparisons. 
                 * Instead we write a non-fuzzy overlap test.  The same code 
                 * will also serve for leaf-page tests, since leaf keys have 
                 * high == low. 
                 */ 
</span><a name="LN1403"></a>                <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>, 
</span><a name="LN1404"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span> 
                <a href="gistproc.c.html#LN1403"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN160"><span class='Ref_to_Macro'>PG_GETARG_BOX_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="gistproc.c.html#LN1404"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1404"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN1403"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&& 
</span>                          <a href="gistproc.c.html#LN1404"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1403"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>&& 
</span>                          <a href="gistproc.c.html#LN1404"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&GT;= </span><a href="gistproc.c.html#LN1403"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&& 
</span>                          <a href="gistproc.c.html#LN1404"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>&LT;= </span><a href="gistproc.c.html#LN1403"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="gistproc.c.html#LN1376"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="gistproc.c.html#LN1368"><span class='Ref_to_Const'>PolygonStrategyNumberGroup</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1418"></a>                <a href="../../../include/utils/geo_decls.h.html#LN112"><span class='Ref_to_Typedef'>POLYGON</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN166"><span class='Ref_to_Macro'>PG_GETARG_POLYGON_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN591"><span class='Ref_to_Macro'>DirectFunctionCall5</span></a><span class='Parentheses'>(</span> 
                                                        <a href="gistproc.c.html#LN1096"><span class='Ref_to_Func'>gist_poly_consistent</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/utils/geo_decls.h.html#LN165"><span class='Ref_to_Macro'>PolygonPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1418"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN45"><span class='Ref_to_Const'>RTOverlapStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1376"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN132"><span class='Ref_to_Macro'>GIST_LEAF</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We are on leaf page and quick check shows overlapping 
                     * of polygon's bounding box and point 
                     */ 
</span><a name="LN1433"></a>                    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>box</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1433"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>== </span><a href="gistproc.c.html#LN1433"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> 
                           <span class='Operator'>&& </span><a href="gistproc.c.html#LN1433"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>== </span><a href="gistproc.c.html#LN1433"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span> 
                                                              <a href="../../utils/adt/geo_ops.c.html#LN3982"><span class='Ref_to_Func'>poly_contain_pt</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/utils/geo_decls.h.html#LN165"><span class='Ref_to_Macro'>PolygonPGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1418"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="../../../include/utils/geo_decls.h.html#LN137"><span class='Ref_to_Macro'>PointPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN1433"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="gistproc.c.html#LN1376"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="gistproc.c.html#LN1369"><span class='Ref_to_Const'>CircleStrategyNumberGroup</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1447"></a>                <a href="../../../include/utils/geo_decls.h.html#LN123"><span class='Ref_to_Typedef'>CIRCLE</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN172"><span class='Ref_to_Macro'>PG_GETARG_CIRCLE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN591"><span class='Ref_to_Macro'>DirectFunctionCall5</span></a><span class='Parentheses'>(</span> 
                                                      <a href="gistproc.c.html#LN1164"><span class='Ref_to_Func'>gist_circle_consistent</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/utils/geo_decls.h.html#LN171"><span class='Ref_to_Macro'>CirclePGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1447"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN45"><span class='Ref_to_Const'>RTOverlapStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1376"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN132"><span class='Ref_to_Macro'>GIST_LEAF</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We are on leaf page and quick check shows overlapping 
                     * of polygon's bounding box and point 
                     */ 
</span><a name="LN1462"></a>                    <a href="../../../include/utils/geo_decls.h.html#LN101"><span class='Ref_to_Typedef'>BOX</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>box</span> <span class='Operator'>= </span><a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1374"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1462"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> <span class='Operator'>== </span><a href="gistproc.c.html#LN1462"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN59"><span class='Ref_to_Member'>x</span></a> 
                           <span class='Operator'>&& </span><a href="gistproc.c.html#LN1462"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a> <span class='Operator'>== </span><a href="gistproc.c.html#LN1462"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN104"><span class='Ref_to_Member'>low</span></a><span class='Operator'>.</span><a href="../../../include/utils/geo_decls.h.html#LN60"><span class='Ref_to_Member'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span> 
                                                           <a href="../../utils/adt/geo_ops.c.html#LN5011"><span class='Ref_to_Func'>circle_contain_pt</span></a><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/utils/geo_decls.h.html#LN171"><span class='Ref_to_Macro'>CirclePGetDatum</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1447"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="../../../include/utils/geo_decls.h.html#LN137"><span class='Ref_to_Macro'>PointPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistproc.c.html#LN1462"><span class='Ref_To_Local'>box</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/geo_decls.h.html#LN103"><span class='Ref_to_Member'>high</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="gistproc.c.html#LN1376"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1375"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategyGroup &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1377"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_point_consistent &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1484"></a><span class='Declare_Function'>gist_point_distance</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1486"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1487"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1488"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>distance</span><span class='Delimiter'>; 
</span><a name="LN1489"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategyGroup</span> <span class='Operator'>= </span><a href="gistproc.c.html#LN1487"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>/ </span><a href="gistproc.c.html#LN1365"><span class='Ref_to_Const'>GeoStrategyNumberOffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1489"><span class='Ref_To_Local'>strategyGroup</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="gistproc.c.html#LN1366"><span class='Ref_to_Const'>PointStrategyNumberGroup</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1488"><span class='Ref_To_Local'>distance</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1255"><span class='Ref_to_Func'>computeDistance</span></a><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN132"><span class='Ref_to_Macro'>GIST_LEAF</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1486"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1486"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/geo_decls.h.html#LN138"><span class='Ref_to_Macro'>PG_GETARG_POINT_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1487"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN1488"><span class='Ref_To_Local'>distance</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1488"><span class='Ref_To_Local'>distance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_point_distance &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The inexact GiST distance method for geometric types that store bounding 
 * boxes. 
 * 
 * Compute lossy distance from point to index entries.  The result is inexact 
 * because index entries are bounding boxes, not the exact shapes of the 
 * indexed geometric types.  We use distance from point to MBR of index entry. 
 * This is a lower bound estimate of distance from point to indexed geometric 
 * type. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN1518"></a><span class='Declare_Function'>gist_bbox_distance</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entry</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN1519"></a>                   <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>recheck</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1521"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>distance</span><span class='Delimiter'>; 
</span><a name="LN1522"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategyGroup</span> <span class='Operator'>= </span><a href="gistproc.c.html#LN1519"><span class='Ref_to_Parameter'>strategy</span></a> <span class='Operator'>/ </span><a href="gistproc.c.html#LN1365"><span class='Ref_to_Const'>GeoStrategyNumberOffset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Bounding box distance is always inexact. */ 
</span>    <span class='Operator'>*</span><a href="gistproc.c.html#LN1519"><span class='Ref_to_Parameter'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistproc.c.html#LN1522"><span class='Ref_To_Local'>strategyGroup</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="gistproc.c.html#LN1366"><span class='Ref_to_Const'>PointStrategyNumberGroup</span></a><span class='Operator'>: 
</span>            <a href="gistproc.c.html#LN1521"><span class='Ref_To_Local'>distance</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1255"><span class='Ref_to_Func'>computeDistance</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/geo_decls.h.html#LN158"><span class='Ref_to_Macro'>DatumGetBoxP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1518"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/utils/geo_decls.h.html#LN136"><span class='Ref_to_Macro'>DatumGetPointP</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1518"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1519"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistproc.c.html#LN1521"><span class='Ref_To_Local'>distance</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="gistproc.c.html#LN1521"><span class='Ref_To_Local'>distance</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_bbox_distance &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1543"></a><span class='Declare_Function'>gist_circle_distance</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1545"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1546"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1547"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Oid subtype = PG_GETARG_OID(3); */ 
</span><a name="LN1550"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1551"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>distance</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN1551"><span class='Ref_To_Local'>distance</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1517"><span class='Ref_to_Func'>gist_bbox_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1545"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1546"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1547"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1550"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1551"><span class='Ref_To_Local'>distance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1559"></a><span class='Declare_Function'>gist_poly_distance</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1561"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1562"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1563"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Oid subtype = PG_GETARG_OID(3); */ 
</span><a name="LN1566"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1567"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>distance</span><span class='Delimiter'>; 
</span> 
    <a href="gistproc.c.html#LN1567"><span class='Ref_To_Local'>distance</span></a> <span class='Operator'>= </span><a href="gistproc.c.html#LN1517"><span class='Ref_to_Func'>gist_bbox_distance</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1561"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1562"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1563"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, </span><a href="gistproc.c.html#LN1566"><span class='Ref_To_Local'>recheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="gistproc.c.html#LN1567"><span class='Ref_To_Local'>distance</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>