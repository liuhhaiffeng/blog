<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\gist\gistsplit.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\gist\gistsplit.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:28 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * gistsplit.c 
 *    Multi-column page splitting algorithm 
 * 
 * This file is concerned with making good page-split decisions in multi-column 
 * GiST indexes.  The opclass-specific picksplit functions can only be expected 
 * to produce answers based on a single column.  We first run the picksplit 
 * function for column 1; then, if there are more columns, we check if any of 
 * the tuples are "don't cares" so far as the column 1 split is concerned 
 * (that is, they could go to either side for no additional penalty).  If so, 
 * we try to redistribute those tuples on the basis of the next column. 
 * Repeat till we're out of columns. 
 * 
 * gistSplitByKey() is the entry point to this file. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/access/gist/gistsplit.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/gist_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN32"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Member'>entries</span><span class='Delimiter'>; 
</span><a name="LN33"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>len</span><span class='Delimiter'>; 
</span><a name="LN34"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>attr</span><span class='Delimiter'>; 
</span><a name="LN35"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>isnull</span><span class='Delimiter'>; 
</span><a name="LN36"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>dontcare</span><span class='Delimiter'>; 
</span><a name="LN37"></a>} <span class='Declare_Typedef'>GistSplitUnion</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Form unions of subkeys in itvec[] entries listed in gsvp-&GT;entries[], 
 * ignoring any tuples that are marked in gsvp-&GT;dontcare[].  Subroutine for 
 * gistunionsubkey. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN46"></a><span class='Declare_Function'>gistunionsubkeyvec</span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itvec</span><span class='Delimiter'>, 
</span><a name="LN47"></a>                   <a href="gistsplit.c.html#LN30"><span class='Ref_to_Typedef'>GistSplitUnion</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>gsvp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN49"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cleanedItVec</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN51"></a>                <span class='Declare_Local'>cleanedLen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN49"><span class='Ref_To_Local'>cleanedItVec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN33"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN50"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN50"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN33"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN50"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN36"><span class='Ref_to_Member'>dontcare</span></a> <span class='Operator'>&& </span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN36"><span class='Ref_to_Member'>dontcare</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN32"><span class='Ref_to_Member'>entries</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN50"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="gistsplit.c.html#LN49"><span class='Ref_To_Local'>cleanedItVec</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN51"><span class='Ref_To_Local'>cleanedLen</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN46"><span class='Ref_to_Parameter'>itvec</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN32"><span class='Ref_to_Member'>entries</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN50"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="gistutil.c.html#LN152"><span class='Ref_to_Func'>gistMakeUnionItVec</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN46"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN49"><span class='Ref_To_Local'>cleanedItVec</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN51"><span class='Ref_To_Local'>cleanedLen</span></a><span class='Delimiter'>, 
</span>                       <a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN34"><span class='Ref_to_Member'>attr</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN47"><span class='Ref_to_Parameter'>gsvp</span></a><span class='Operator'>-&GT;</span><a href="gistsplit.c.html#LN35"><span class='Ref_to_Member'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN49"><span class='Ref_To_Local'>cleanedItVec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistunionsubkeyvec &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recompute unions of left- and right-side subkeys after a page split, 
 * ignoring any tuples that are marked in spl-&GT;spl_dontcare[]. 
 * 
 * Note: we always recompute union keys for all index columns.  In some cases 
 * this might represent duplicate work for the leftmost column(s), but it's 
 * not safe to assume that "zero penalty to move a tuple" means "the union 
 * key doesn't change at all".  Penalty functions aren't 100% accurate. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN79"></a><span class='Declare_Function'>gistunionsubkey</span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itvec</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN223"><span class='Ref_to_Struct'>GistSplitVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN81"></a>    <a href="gistsplit.c.html#LN30"><span class='Ref_to_Typedef'>GistSplitUnion</span></a> <span class='Declare_Local'>gsvp</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN36"><span class='Ref_to_Member'>dontcare</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN32"><span class='Ref_to_Member'>entries</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN33"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN34"><span class='Ref_to_Member'>attr</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN227"><span class='Ref_to_Member'>spl_lattr</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN35"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN229"><span class='Ref_to_Member'>spl_lisnull</span></a><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN45"><span class='Ref_to_Func'>gistunionsubkeyvec</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>itvec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN32"><span class='Ref_to_Member'>entries</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN33"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN34"><span class='Ref_to_Member'>attr</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN231"><span class='Ref_to_Member'>spl_rattr</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Operator'>.</span><a href="gistsplit.c.html#LN35"><span class='Ref_to_Member'>isnull</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN45"><span class='Ref_to_Func'>gistunionsubkeyvec</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN79"><span class='Ref_to_Parameter'>itvec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN81"><span class='Ref_To_Local'>gsvp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistunionsubkey &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find tuples that are "don't cares", that is could be moved to the other 
 * side of the split with zero penalty, so far as the attno column is 
 * concerned. 
 * 
 * Don't-care tuples are marked by setting the corresponding entry in 
 * spl-&GT;spl_dontcare[] to "true".  Caller must have initialized that array 
 * to zeroes. 
 * 
 * Returns number of don't-cares found. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN112"></a><span class='Declare_Function'>findDontCares</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>r</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>valvec</span><span class='Delimiter'>, 
</span><a name="LN113"></a>              <a href="../../../include/access/gist_private.h.html#LN223"><span class='Ref_to_Struct'>GistSplitVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spl</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN115"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>   <span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN117"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>NumDontCare</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, search the left-side tuples to see if any have zero penalty to 
     * be added to the right-side union key. 
     * 
     * attno column is known all-not-null (see gistSplitByKey), so we need not 
     * check for nulls 
     */ 
</span>    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN116"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN112"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                  <span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN130"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span> <span class='Operator'>= </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN131"></a>        <span class='Keyword'>float</span>       <span class='Declare_Local'>penalty</span> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN112"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN116"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="gistsplit.c.html#LN112"><span class='Ref_to_Parameter'>valvec</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN130"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN131"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN130"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN117"><span class='Ref_To_Local'>NumDontCare</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* And conversely for the right-side tuples */ 
</span>    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN116"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN112"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                  <span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN146"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span> <span class='Operator'>= </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN115"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN147"></a>        <span class='Keyword'>float</span>       <span class='Declare_Local'>penalty</span> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN112"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN116"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="gistsplit.c.html#LN112"><span class='Ref_to_Parameter'>valvec</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN146"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN147"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="gistsplit.c.html#LN113"><span class='Ref_to_Parameter'>spl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN146"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN117"><span class='Ref_To_Local'>NumDontCare</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="gistsplit.c.html#LN117"><span class='Ref_To_Local'>NumDontCare</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findDontCares &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove tuples that are marked don't-cares from the tuple index array a[] 
 * of length *len.  This is applied separately to the spl_left and spl_right 
 * arrays. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN166"></a><span class='Declare_Function'>removeDontCares</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>const bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>dontcare</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN168"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>origlen</span><span class='Delimiter'>, 
</span><a name="LN169"></a>                <span class='Declare_Local'>newlen</span><span class='Delimiter'>, 
</span><a name="LN170"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN171"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>curwpos</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN168"><span class='Ref_To_Local'>origlen</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN169"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>= *</span><a href="gistsplit.c.html#LN166"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN171"><span class='Ref_To_Local'>curwpos</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN166"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN170"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN170"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN168"><span class='Ref_To_Local'>origlen</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN170"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN177"></a>        <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>ai</span> <span class='Operator'>= </span><a href="gistsplit.c.html#LN166"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN170"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN166"><span class='Ref_to_Parameter'>dontcare</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN177"><span class='Ref_To_Local'>ai</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Boolean'>FALSE</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* re-emit item into a[] */ 
</span>            <span class='Operator'>*</span><a href="gistsplit.c.html#LN171"><span class='Ref_To_Local'>curwpos</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN177"><span class='Ref_To_Local'>ai</span></a><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN171"><span class='Ref_To_Local'>curwpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="gistsplit.c.html#LN169"><span class='Ref_To_Local'>newlen</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="gistsplit.c.html#LN166"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN169"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end removeDontCares &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Place a single don't-care tuple into either the left or right side of the 
 * split, according to which has least penalty for merging the tuple into 
 * the previously-computed union keys.  We need consider only columns starting 
 * at attno. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN199"></a><span class='Declare_Function'>placeOne</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>r</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN223"><span class='Ref_to_Struct'>GistSplitVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN200"></a>         <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Declare_Parameter'>itup</span><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>off</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN202"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>   <span class='Declare_Local'>identry</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN203"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN204"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>toLeft</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="gistutil.c.html#LN292"><span class='Ref_to_Func'>gistDeCompressAtt</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                      <a href="gistsplit.c.html#LN202"><span class='Ref_To_Local'>identry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN203"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN211"></a>        <span class='Keyword'>float</span>       <span class='Declare_Local'>lpenalty</span><span class='Delimiter'>, 
</span><a name="LN212"></a>                    <span class='Declare_Local'>rpenalty</span><span class='Delimiter'>; 
</span><a name="LN213"></a>        <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>   <span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN213"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN227"><span class='Ref_to_Member'>spl_lattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN211"><span class='Ref_To_Local'>lpenalty</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN213"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN229"><span class='Ref_to_Member'>spl_lisnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                               <a href="gistsplit.c.html#LN202"><span class='Ref_To_Local'>identry</span></a> <span class='Operator'>+ </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN203"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN213"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN231"><span class='Ref_to_Member'>spl_rattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN212"><span class='Ref_To_Local'>rpenalty</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN213"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                               <a href="gistsplit.c.html#LN202"><span class='Ref_To_Local'>identry</span></a> <span class='Operator'>+ </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN203"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN211"><span class='Ref_To_Local'>lpenalty</span></a> <span class='Operator'>!= </span><a href="gistsplit.c.html#LN212"><span class='Ref_To_Local'>rpenalty</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN211"><span class='Ref_To_Local'>lpenalty</span></a> <span class='Operator'>&GT; </span><a href="gistsplit.c.html#LN212"><span class='Ref_To_Local'>rpenalty</span></a><span class='Parentheses'>) 
</span>                <a href="gistsplit.c.html#LN204"><span class='Ref_To_Local'>toLeft</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;attno&LT;giststate-&GT;tup... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN204"><span class='Ref_To_Local'>toLeft</span></a><span class='Parentheses'>) 
</span>        <a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>off</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN199"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN200"><span class='Ref_to_Parameter'>off</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end placeOne &raquo; </span> 
 
<a name="LN236"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SWAPVAR</span><span class='Parentheses'>( </span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>d</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>t</span> <span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{</span>    <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN236"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN236"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN236"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN236"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN236"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Clean up when we did a secondary split but the user-defined PickSplit 
 * method didn't support it (leaving spl_ldatum_exists or spl_rdatum_exists 
 * true). 
 * 
 * We consider whether to swap the left and right outputs of the secondary 
 * split; this can be worthwhile if the penalty for merging those tuples into 
 * the previously chosen sets is less that way. 
 * 
 * In any case we must update the union datums for the current column by 
 * adding in the previous union keys (oldL/oldR), since the user-defined 
 * PickSplit method didn't do so. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN257"></a><span class='Declare_Function'>supportSecondarySplit</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>r</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Delimiter'>, 
</span><a name="LN258"></a>                      <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sv</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>oldL</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>oldR</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN260"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>leaveOnLeft</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span><a name="LN261"></a>                <span class='Declare_Local'>tmpBool</span><span class='Delimiter'>; 
</span><a name="LN262"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>   <span class='Declare_Local'>entryL</span><span class='Delimiter'>, 
</span><a name="LN263"></a>                <span class='Declare_Local'>entryR</span><span class='Delimiter'>, 
</span><a name="LN264"></a>                <span class='Declare_Local'>entrySL</span><span class='Delimiter'>, 
</span><a name="LN265"></a>                <span class='Declare_Local'>entrySR</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN262"><span class='Ref_To_Local'>entryL</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>oldL</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN263"><span class='Ref_To_Local'>entryR</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>oldR</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN264"><span class='Ref_To_Local'>entrySL</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN265"><span class='Ref_To_Local'>entrySR</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a> <span class='Operator'>&& </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN274"></a>        <span class='Keyword'>float</span>       <span class='Declare_Local'>penalty1</span><span class='Delimiter'>, 
</span><a name="LN275"></a>                    <span class='Declare_Local'>penalty2</span><span class='Delimiter'>; 
</span> 
        <a href="gistsplit.c.html#LN274"><span class='Ref_To_Local'>penalty1</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN262"><span class='Ref_To_Local'>entryL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN264"><span class='Ref_To_Local'>entrySL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>            <a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN263"><span class='Ref_To_Local'>entryR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN265"><span class='Ref_To_Local'>entrySR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN275"><span class='Ref_To_Local'>penalty2</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN262"><span class='Ref_To_Local'>entryL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN265"><span class='Ref_To_Local'>entrySR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>            <a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN263"><span class='Ref_To_Local'>entryR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN264"><span class='Ref_To_Local'>entrySL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN274"><span class='Ref_To_Local'>penalty1</span></a> <span class='Operator'>&GT; </span><a href="gistsplit.c.html#LN275"><span class='Ref_To_Local'>penalty2</span></a><span class='Parentheses'>) 
</span>            <a href="gistsplit.c.html#LN260"><span class='Ref_To_Local'>leaveOnLeft</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN287"></a>        <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a><span class='Parentheses'>) </span><span class='Operator'>? &</span><a href="gistsplit.c.html#LN262"><span class='Ref_To_Local'>entryL</span></a> <span class='Operator'>: &</span><a href="gistsplit.c.html#LN263"><span class='Ref_To_Local'>entryR</span></a><span class='Delimiter'>; 
</span><a name="LN288"></a>        <span class='Keyword'>float</span>       <span class='Declare_Local'>penalty1</span><span class='Delimiter'>, 
</span><a name="LN289"></a>                    <span class='Declare_Local'>penalty2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * There is only one previously defined union, so we just choose swap 
         * or not by lowest penalty for that side.  We can only get here if a 
         * secondary split happened to have all NULLs in its column in the 
         * tuples that the outer recursion level had assigned to one side. 
         * (Note that the null checks in gistSplitByKey don't prevent the 
         * case, because they'll only be checking tuples that were considered 
         * don't-cares at the outer recursion level, not the tuples that went 
         * into determining the passed-down left and right union keys.) 
         */ 
</span>        <a href="gistsplit.c.html#LN288"><span class='Ref_To_Local'>penalty1</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN287"><span class='Ref_To_Local'>entry1</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN264"><span class='Ref_To_Local'>entrySL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN289"><span class='Ref_To_Local'>penalty2</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist_private.h.html#LN471"><span class='Ref_to_Proto'>gistpenalty</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN287"><span class='Ref_To_Local'>entry1</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN265"><span class='Ref_To_Local'>entrySR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN288"><span class='Ref_To_Local'>penalty1</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN289"><span class='Ref_To_Local'>penalty2</span></a><span class='Parentheses'>) 
</span>            <a href="gistsplit.c.html#LN260"><span class='Ref_To_Local'>leaveOnLeft</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistsplit.c.html#LN260"><span class='Ref_To_Local'>leaveOnLeft</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN260"><span class='Ref_To_Local'>leaveOnLeft</span></a> <span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * swap left and right 
         */ 
</span><a name="LN315"></a>        <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>off</span><span class='Delimiter'>, 
</span><a name="LN316"></a>                    <span class='Declare_Local'>noff</span><span class='Delimiter'>; 
</span><a name="LN317"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span> 
        <a href="gistsplit.c.html#LN236"><span class='Ref_to_Macro'>SWAPVAR</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN315"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN236"><span class='Ref_to_Macro'>SWAPVAR</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN316"><span class='Ref_To_Local'>noff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN236"><span class='Ref_to_Macro'>SWAPVAR</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN317"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN264"><span class='Ref_To_Local'>entrySL</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist.h.html#LN168"><span class='Ref_to_Macro'>gistentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN265"><span class='Ref_To_Local'>entrySR</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>FALSE</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a><span class='Parentheses'>) 
</span>        <a href="gistutil.c.html#LN229"><span class='Ref_to_Func'>gistMakeUnionKey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN262"><span class='Ref_To_Local'>entryL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN264"><span class='Ref_To_Local'>entrySL</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN261"><span class='Ref_To_Local'>tmpBool</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a><span class='Parentheses'>) 
</span>        <a href="gistutil.c.html#LN229"><span class='Ref_to_Func'>gistMakeUnionKey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN257"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN263"><span class='Ref_To_Local'>entryR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN265"><span class='Ref_To_Local'>entrySR</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN261"><span class='Ref_To_Local'>tmpBool</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN258"><span class='Ref_to_Parameter'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end supportSecondarySplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Trivial picksplit implementation. Function called only 
 * if user-defined picksplit puts all keys on the same side of the split. 
 * That is a bug of user-defined picksplit but we don't want to fail. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN343"></a><span class='Declare_Function'>genericPickSplit</span><span class='Parentheses'>(</span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN345"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN346"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN347"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN348"></a>    <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evec</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN346"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN347"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN346"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN347"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN347"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistsplit.c.html#LN346"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN346"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN345"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Form union datums for each side 
     */ 
</span>    <a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>+ </span><a href="../../../include/access/gist.h.html#LN163"><span class='Ref_to_Const'>GEVHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a> <span class='Operator'>+ </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>, 
</span>           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN85"><span class='Ref_to_Member'>unionFn</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                                      <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN95"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistsplit.c.html#LN347"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a> <span class='Operator'>+ </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>+ </span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>, 
</span>           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN85"><span class='Ref_to_Member'>unionFn</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                                      <a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN95"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN343"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN348"><span class='Ref_To_Local'>evec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistsplit.c.html#LN347"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end genericPickSplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calls user picksplit method for attno column to split tuples into 
 * two vectors. 
 * 
 * Returns FALSE if split is complete (there are no more index columns, or 
 * there is no need to consider them because split is optimal already). 
 * 
 * Returns TRUE and v-&GT;spl_dontcare = NULL if the picksplit result is 
 * degenerate (all tuples seem to be don't-cares), so we should just 
 * disregard this column and split on the next column(s) instead. 
 * 
 * Returns TRUE and v-&GT;spl_dontcare != NULL if there are don't-care tuples 
 * that could be relocated based on the next column(s).  The don't-care 
 * tuples have been removed from the split and must be reinserted by caller. 
 * There is at least one non-don't-care tuple on each side of the split, 
 * and union keys for all columns are updated to include just those tuples. 
 * 
 * A TRUE result implies there is at least one more index column. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN414"></a><span class='Declare_Function'>gistUserPicksplit</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>r</span><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN223"><span class='Ref_to_Struct'>GistSplitVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN415"></a>                  <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itup</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN417"></a>    <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sv</span> <span class='Operator'>= &</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare spl_ldatum/spl_rdatum/spl_ldatum_exists/spl_rdatum_exists in 
     * case we are doing a secondary split (see comments in gist.h). 
     */ 
</span>    <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN229"><span class='Ref_to_Member'>spl_lisnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>false </span><span class='Operator'>: </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>false </span><span class='Operator'>: </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN227"><span class='Ref_to_Member'>spl_lattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]; 
</span>    <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN231"><span class='Ref_to_Member'>spl_rattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let the opclass-specific PickSplit method do its thing.  Note that at 
     * this point we know there are no null keys in the entryvec. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN89"><span class='Ref_to_Member'>picksplitFn</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                      <a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN95"><span class='Ref_to_Member'>supportCollation</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], 
</span>                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * User-defined picksplit failed to create an actual split, ie it put 
         * everything on the same side.  Complain but cope. 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INTERNAL_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"picksplit method for column %d of index \"%s\" failed"</span><span class='Delimiter'>, 
</span>                     <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>r</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The index is not optimal. To optimize it, contact a developer, or try to use the column as the second one in the CREATE INDEX command."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reinit GIST_SPLITVEC. Although these fields are not used by 
         * genericPickSplit(), set them up for further processing 
         */ 
</span>        <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN229"><span class='Ref_to_Member'>spl_lisnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>false </span><span class='Operator'>: </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>false </span><span class='Operator'>: </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN227"><span class='Ref_to_Member'>spl_lattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]; 
</span>        <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN231"><span class='Ref_to_Member'>spl_rattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Do a generic split */ 
</span>        <a href="gistsplit.c.html#LN342"><span class='Ref_to_Func'>genericPickSplit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sv-&GT;spl_nleft==0||sv-... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* hack for compatibility with old picksplit API */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>) 
</span>            <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) (</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>) 
</span>            <a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) (</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up if PickSplit didn't take care of a secondary split */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN107"><span class='Ref_to_Member'>spl_ldatum_exists</span></a> <span class='Operator'>|| </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN112"><span class='Ref_to_Member'>spl_rdatum_exists</span></a><span class='Parentheses'>) 
</span>        <a href="gistsplit.c.html#LN256"><span class='Ref_to_Func'>supportSecondarySplit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Delimiter'>, 
</span>                              <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN227"><span class='Ref_to_Member'>spl_lattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>], </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN231"><span class='Ref_to_Member'>spl_rattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* emit union datums computed by PickSplit back to v arrays */ 
</span>    <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN227"><span class='Ref_to_Member'>spl_lattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN231"><span class='Ref_to_Member'>spl_rattr</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN229"><span class='Ref_to_Member'>spl_lisnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If index columns remain, then consider whether we can improve the split 
     * by using them. 
     */ 
</span>    <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN489"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>NumDontCare</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make a quick check to see if left and right union keys are equal; 
         * if so, the split is certainly degenerate, so tell caller to 
         * re-split with the next column. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistutil.c.html#LN277"><span class='Ref_to_Func'>gistKeyIsEQ</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Locate don't-care tuples, if any.  If there are none, the split is 
         * optimal, so just fall out and return false. 
         */ 
</span>        <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="gistsplit.c.html#LN489"><span class='Ref_To_Local'>NumDontCare</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN111"><span class='Ref_to_Func'>findDontCares</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN489"><span class='Ref_To_Local'>NumDontCare</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Remove don't-cares from spl_left[] and spl_right[]. 
             */ 
</span>            <a href="gistsplit.c.html#LN165"><span class='Ref_to_Func'>removeDontCares</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN165"><span class='Ref_to_Func'>removeDontCares</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If all tuples on either side were don't-cares, the split is 
             * degenerate, and we're best off to ignore it and split on the 
             * next column.  (We used to try to press on with a secondary 
             * split by forcing a random tuple on each side to be treated as 
             * non-don't-care, but it seems unlikely that that technique 
             * really gives a better result.  Note that we don't want to try a 
             * secondary split with empty left or right primary split sides, 
             * because then there is no union key on that side for the 
             * PickSplit function to try to expand, so it can have no good 
             * figure of merit for what it's doing.  Also note that this check 
             * ensures we can't produce a bogus one-side-only split in the 
             * NumDontCare == 1 special case below.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="gistsplit.c.html#LN417"><span class='Ref_To_Local'>sv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Recompute union keys, considering only non-don't-care tuples. 
             * NOTE: this will set union keys for remaining index columns, 
             * which will cause later calls of gistUserPicksplit to pass those 
             * values down to user-defined PickSplit methods with 
             * spl_ldatum_exists/spl_rdatum_exists set true. 
             */ 
</span>            <a href="gistsplit.c.html#LN78"><span class='Ref_to_Func'>gistunionsubkey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN489"><span class='Ref_To_Local'>NumDontCare</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If there's only one don't-care tuple then we can't do a 
                 * PickSplit on it, so just choose whether to send it left or 
                 * right by comparing penalties.  We needed the 
                 * gistunionsubkey step anyway so that we have appropriate 
                 * union keys for figuring the penalties. 
                 */ 
</span><a name="LN553"></a>                <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>toMove</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* find it ... */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* ... and assign it to cheaper side */ 
</span>                <a href="gistsplit.c.html#LN198"><span class='Ref_to_Func'>placeOne</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN415"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="gistsplit.c.html#LN553"><span class='Ref_To_Local'>toMove</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN414"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * At this point the union keys are wrong, but we don't care 
                 * because we're done splitting.  The outermost recursion 
                 * level of gistSplitByKey will fix things before returning. 
                 */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if NumDontCare==1 &raquo; </span> 
            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if NumDontCare&GT;0 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attno+1&LT;giststate-&GT;tu... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistUserPicksplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * simply split page in half 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN584"></a><span class='Declare_Function'>gistSplitHalf</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN586"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN586"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN586"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN586"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN586"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN586"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN584"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN586"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we need not compute union keys, caller took care of it */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * gistSplitByKey: main entry point for page-splitting algorithm 
 * 
 * r: index relation 
 * page: page being split 
 * itup: array of IndexTuples to be processed 
 * len: number of IndexTuples to be processed (must be at least 2) 
 * giststate: additional info about index 
 * v: working state and output area 
 * attno: column we are working on (zero-based index) 
 * 
 * Outside caller must initialize v-&GT;spl_lisnull and v-&GT;spl_risnull arrays 
 * to all-TRUE.  On return, spl_left/spl_nleft contain indexes of tuples 
 * to go left, spl_right/spl_nright contain indexes of tuples to go right, 
 * spl_lattr/spl_lisnull contain left-side union key values, and 
 * spl_rattr/spl_risnull contain right-side union key values.  Other fields 
 * in this struct are workspace for this file. 
 * 
 * Outside caller must pass zero for attno.  The function may internally 
 * recurse to the next column by passing attno+1. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN622"></a><span class='Declare_Function'>gistSplitByKey</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>r</span><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a> <span class='Declare_Parameter'>page</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itup</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, 
</span><a name="LN623"></a>               <a href="../../../include/access/gist_private.h.html#LN75"><span class='Ref_to_Struct'>GISTSTATE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>giststate</span><span class='Delimiter'>, </span><a href="../../../include/access/gist_private.h.html#LN223"><span class='Ref_to_Struct'>GistSplitVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>attno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN625"></a>    <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entryvec</span><span class='Delimiter'>; 
</span><a name="LN626"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>offNullTuples</span><span class='Delimiter'>; 
</span><a name="LN627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nOffNullTuples</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN628"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* generate the item array, and identify tuples with null keys */ 
</span>    <span class='Comment_Multi_Line'>/* note that entryvec-&GT;vector[0] goes unused in this code */ 
</span>    <a href="gistsplit.c.html#LN625"><span class='Ref_To_Local'>entryvec</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN163"><span class='Ref_to_Const'>GEVHDRSZ</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN625"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="gistsplit.c.html#LN626"><span class='Ref_To_Local'>offNullTuples</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN638"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN639"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>IsNull</span><span class='Delimiter'>; 
</span> 
        <a href="gistsplit.c.html#LN638"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="gistsplit.c.html#LN639"><span class='Ref_To_Local'>IsNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist_private.h.html#LN467"><span class='Ref_to_Proto'>gistdentryinit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN625"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="gistsplit.c.html#LN638"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                       <span class='Boolean'>FALSE</span><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN639"><span class='Ref_To_Local'>IsNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN639"><span class='Ref_To_Local'>IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="gistsplit.c.html#LN626"><span class='Ref_To_Local'>offNullTuples</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN627"><span class='Ref_To_Local'>nOffNullTuples</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN627"><span class='Ref_To_Local'>nOffNullTuples</span></a> <span class='Operator'>== </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Corner case: All keys in attno column are null, so just transfer 
         * our attention to the next column.  If there's no next column, just 
         * split page in half. 
         */ 
</span>        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN229"><span class='Ref_to_Member'>spl_lisnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/access/gist_private.h.html#LN497"><span class='Ref_to_Proto'>gistSplitByKey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistsplit.c.html#LN583"><span class='Ref_to_Func'>gistSplitHalf</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN627"><span class='Ref_To_Local'>nOffNullTuples</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN666"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We don't want to mix NULL and not-NULL keys on one page, so split 
         * nulls to right page and not-nulls to left. 
         */ 
</span>        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN626"><span class='Ref_To_Local'>offNullTuples</span></a><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN627"><span class='Ref_To_Local'>nOffNullTuples</span></a><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN233"><span class='Ref_to_Member'>spl_risnull</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN666"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>&& </span><a href="gistsplit.c.html#LN626"><span class='Ref_To_Local'>offNullTuples</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN666"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>                <a href="gistsplit.c.html#LN666"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Compute union keys, unless outer recursion level will handle it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="gistsplit.c.html#LN78"><span class='Ref_to_Func'>gistunionsubkey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nOffNullTuples&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * All keys are not-null, so apply user-defined PickSplit method 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN413"><span class='Ref_to_Func'>gistUserPicksplit</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN625"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Splitting on attno column is not optimal, so consider 
             * redistributing don't-care tuples according to the next column 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This split was actually degenerate, so ignore it altogether 
                 * and just split according to the next column. 
                 */ 
</span>                <a href="../../../include/access/gist_private.h.html#LN497"><span class='Ref_to_Proto'>gistSplitByKey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Form an array of just the don't-care tuples to pass to a 
                 * recursive invocation of this function for the next column. 
                 */ 
</span><a name="LN718"></a>                <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newitup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN719"></a>                <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN720"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>newlen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN721"></a>                <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Declare_Local'>backupSplit</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="gistsplit.c.html#LN718"><span class='Ref_To_Local'>newitup</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN720"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                        <a href="gistsplit.c.html#LN719"><span class='Ref_To_Local'>map</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN720"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <a href="gistsplit.c.html#LN720"><span class='Ref_To_Local'>newlen</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN720"><span class='Ref_To_Local'>newlen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Make a backup copy of v-&GT;splitVector, since the recursive 
                 * call will overwrite that with its own result. 
                 */ 
</span>                <a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Delimiter'>; 
</span>                <a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Recursively decide how to split the don't-care tuples */ 
</span>                <a href="../../../include/access/gist_private.h.html#LN497"><span class='Ref_to_Proto'>gistSplitByKey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>r</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN718"><span class='Ref_To_Local'>newitup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN720"><span class='Ref_To_Local'>newlen</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Merge result of subsplit with non-don't-care tuples */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN719"><span class='Ref_To_Local'>map</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Delimiter'>; </span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="gistsplit.c.html#LN719"><span class='Ref_To_Local'>map</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a><span class='Delimiter'>[</span><a href="gistsplit.c.html#LN628"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN225"><span class='Ref_to_Member'>splitVector</span></a> <span class='Operator'>= </span><a href="gistsplit.c.html#LN721"><span class='Ref_To_Local'>backupSplit</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if gistUserPicksplit(r,e... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we're handling a multicolumn index, at the end of the recursion 
     * recompute the left and right union datums for all index columns.  This 
     * makes sure we hand back correct union datums in all corner cases, 
     * including when we haven't processed all columns to start with, or when 
     * a secondary split moved "don't care" tuples from one side to the other 
     * (we really shouldn't assume that that didn't change the union datums). 
     * 
     * Note: when we're in an internal recursion (attno &GT; 0), we do not worry 
     * about whether the union datums we return with are sensible, since 
     * calling levels won't care.  Also, in a single-column index, we expect 
     * that PickSplit (or the special cases above) produced correct union 
     * datums. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>attno</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN80"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN235"><span class='Ref_to_Member'>spl_dontcare</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="gistsplit.c.html#LN78"><span class='Ref_to_Func'>gistunionsubkey</span></a><span class='Parentheses'>(</span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>giststate</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN622"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="gistsplit.c.html#LN623"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end gistSplitByKey &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>