<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\gist\gistxlog.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\gist\gistxlog.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:28 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * gistxlog.c 
 *    WAL replay logic for GiST. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *           src/backend/access/gist/gistxlog.c 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/bufmask.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/gist_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/gistxlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xloginsert.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
<a name="LN22"></a><span class='Keyword'>static </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>opCtx</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* working memory for operations */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Replay the clearing of F_FOLLOW_RIGHT flag on a child page. 
 * 
 * Even if the WAL record includes a full-page image, we have to update the 
 * follow-right flag, because that change is not included in the full-page 
 * image.  To be sure that the intermediate state with the wrong flag value is 
 * not visible to concurrent Hot Standby queries, this function handles 
 * restoring the full-page image as well as updating the flag.  (Note that 
 * we never need to do anything else to the child page in the current WAL 
 * action.) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN36"></a><span class='Declare_Function'>gistRedoClearFollowRight</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Declare_Parameter'>block_id</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN38"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="gistxlog.c.html#LN36"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN39"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN40"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN41"></a>    <a href="../../../include/access/xlogutils.h.html#LN26"><span class='Ref_to_Typedef'>XLogRedoAction</span></a> <span class='Declare_Local'>action</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note that we still update the page even if it was restored from a full 
     * page image, because the updated NSN is not included in the image. 
     */ 
</span>    <a href="gistxlog.c.html#LN41"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN36"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN36"><span class='Ref_to_Parameter'>block_id</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN41"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a> <span class='Operator'>|| </span><a href="gistxlog.c.html#LN41"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN30"><span class='Ref_to_EnumConst'>BLK_RESTORED</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="gistxlog.c.html#LN40"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/gist.h.html#LN151"><span class='Ref_to_Macro'>GistPageSetNSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN38"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist.h.html#LN148"><span class='Ref_to_Macro'>GistClearFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN40"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN38"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN39"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistRedoClearFollowRight &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * redo any page update (except page split) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN66"></a><span class='Declare_Function'>gistRedoPageUpdateRecord</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN68"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="gistxlog.c.html#LN66"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN69"></a>    <a href="../../../include/access/gistxlog.h.html#LN31"><span class='Ref_to_Struct'>gistxlogPageUpdate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gistxlog.h.html#LN31"><span class='Ref_to_Struct'>gistxlogPageUpdate</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN66"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN66"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN70"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN75"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>begin</span><span class='Delimiter'>; 
</span><a name="LN76"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN77"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>datalen</span><span class='Delimiter'>; 
</span><a name="LN78"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ninserted</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN75"><span class='Ref_To_Local'>begin</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN230"><span class='Ref_to_Proto'>XLogRecGetBlockData</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN66"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN77"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN70"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN69"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN34"><span class='Ref_to_Member'>ntodelete</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="gistxlog.c.html#LN69"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN35"><span class='Ref_to_Member'>ntoinsert</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * When replacing one tuple with one other tuple, we must use 
             * PageIndexTupleOverwrite for consistency with gistplacetopage. 
             */ 
</span><a name="LN90"></a>            <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a>            <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN92"></a>            <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>itupsize</span><span class='Delimiter'>; 
</span> 
            <a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistxlog.c.html#LN91"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>; 
</span>            <a href="gistxlog.c.html#LN92"><span class='Ref_To_Local'>itupsize</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN69"><span class='Ref_to_Macro'>IndexTupleSize</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN91"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufpage.h.html#LN433"><span class='Ref_to_Proto'>PageIndexTupleOverwrite</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN90"><span class='Ref_To_Local'>offnum</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN91"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN92"><span class='Ref_To_Local'>itupsize</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item to GiST index page, size %d bytes"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN92"><span class='Ref_To_Local'>itupsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+= </span><a href="gistxlog.c.html#LN92"><span class='Ref_To_Local'>itupsize</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* should be nothing left after consuming 1 tuple */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>- </span><a href="gistxlog.c.html#LN75"><span class='Ref_To_Local'>begin</span></a> <span class='Operator'>== </span><a href="gistxlog.c.html#LN77"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* update insertion count for assert check below */ 
</span>            <a href="gistxlog.c.html#LN78"><span class='Ref_To_Local'>ninserted</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xldata-&GT;ntodelete==1&... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN69"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN34"><span class='Ref_to_Member'>ntodelete</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Otherwise, delete old tuples if any */ 
</span><a name="LN109"></a>            <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>todelete</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>; 
</span> 
            <a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistxlog.c.html#LN69"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN34"><span class='Ref_to_Member'>ntodelete</span></a><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN431"><span class='Ref_to_Proto'>PageIndexMultiDelete</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN109"><span class='Ref_To_Local'>todelete</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN69"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN34"><span class='Ref_to_Member'>ntodelete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/access/gist.h.html#LN139"><span class='Ref_to_Macro'>GistMarkTuplesDeleted</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Add new tuples if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>- </span><a href="gistxlog.c.html#LN75"><span class='Ref_To_Local'>begin</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN77"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN121"></a>            <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>off</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN218"><span class='Ref_to_Macro'>PageIsEmpty</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> <span class='Operator'>? </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>: 
</span>            <a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>- </span><a href="gistxlog.c.html#LN75"><span class='Ref_To_Local'>begin</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN77"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN126"></a>                <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>; 
</span><a name="LN127"></a>                <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>sz</span> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN69"><span class='Ref_to_Macro'>IndexTupleSize</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN126"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN128"></a>                <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
                <a href="gistxlog.c.html#LN76"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+= </span><a href="gistxlog.c.html#LN127"><span class='Ref_To_Local'>sz</span></a><span class='Delimiter'>; 
</span> 
                <a href="gistxlog.c.html#LN128"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN126"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN127"><span class='Ref_To_Local'>sz</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN121"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN128"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>== </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>) 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item to GiST index page, size %d bytes"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN127"><span class='Ref_To_Local'>sz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="gistxlog.c.html#LN121"><span class='Ref_To_Local'>off</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="gistxlog.c.html#LN78"><span class='Ref_To_Local'>ninserted</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if data-begin&LT;datalen &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Check that XLOG record contained expected number of tuples */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN78"><span class='Ref_To_Local'>ninserted</span></a> <span class='Operator'>== </span><a href="gistxlog.c.html#LN69"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN35"><span class='Ref_to_Member'>ntoinsert</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN71"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN68"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN70"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogReadBufferForRedo... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Fix follow-right data on left child page 
     * 
     * This must be done while still holding the lock on the target page. Note 
     * that even if the target page no longer exists, we still attempt to 
     * replay the change on the child page. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN66"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="gistxlog.c.html#LN35"><span class='Ref_to_Func'>gistRedoClearFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN66"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN70"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN70"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistRedoPageUpdateRecord &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Returns an array of index pointers. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>* 
</span><a name="LN166"></a><span class='Declare_Function'>decodePageSplitRecord</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>begin</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN168"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN169"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN170"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuples</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* extract the number of tuples */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>begin</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN168"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>begin</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistxlog.c.html#LN170"><span class='Ref_To_Local'>tuples</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN169"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; *</span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN169"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN168"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>begin</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistxlog.c.html#LN170"><span class='Ref_To_Local'>tuples</span></a><span class='Delimiter'>[</span><a href="gistxlog.c.html#LN169"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN168"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <a href="gistxlog.c.html#LN168"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../../include/access/itup.h.html#LN69"><span class='Ref_to_Macro'>IndexTupleSize</span></a><span class='Parentheses'>((</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN168"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN168"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>begin</span></a> <span class='Operator'>== </span><a href="gistxlog.c.html#LN166"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="gistxlog.c.html#LN170"><span class='Ref_To_Local'>tuples</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end decodePageSplitRecord &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN190"></a><span class='Declare_Function'>gistRedoPageSplitRecord</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN192"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN193"></a>    <a href="../../../include/access/gistxlog.h.html#LN47"><span class='Ref_to_Struct'>gistxlogPageSplit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gistxlog.h.html#LN47"><span class='Ref_to_Struct'>gistxlogPageSplit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN194"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>firstbuffer</span> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span><a name="LN195"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN196"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN197"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN198"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isrootsplit</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must hold lock on the first-listed page throughout the action, 
     * including while updating the left child page (if any).  We can unlock 
     * remaining pages in the list as soon as they've been written, because 
     * there is no path for concurrent queries to reach those pages without 
     * first visiting the first-listed page. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* loop around all pages */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN53"><span class='Ref_to_Member'>npage</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN211"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>flags</span><span class='Delimiter'>; 
</span><a name="LN212"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN213"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>datalen</span><span class='Delimiter'>; 
</span><a name="LN214"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span><a name="LN215"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span><a name="LN216"></a>        <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuples</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN215"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN215"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/access/gist_private.h.html#LN248"><span class='Ref_to_Const'>GIST_ROOT_BLKNO</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="gistxlog.c.html#LN198"><span class='Ref_To_Local'>isrootsplit</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="gistxlog.c.html#LN195"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN195"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistxlog.c.html#LN212"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN230"><span class='Ref_to_Proto'>XLogRecGetBlockData</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN213"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="gistxlog.c.html#LN216"><span class='Ref_To_Local'>tuples</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN165"><span class='Ref_to_Func'>decodePageSplitRecord</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN212"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN213"><span class='Ref_To_Local'>datalen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN214"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ok, clear buffer */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN51"><span class='Ref_to_Member'>origleaf</span></a> <span class='Operator'>&& </span><a href="gistxlog.c.html#LN215"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>!= </span><a href="../../../include/access/gist_private.h.html#LN248"><span class='Ref_to_Const'>GIST_ROOT_BLKNO</span></a><span class='Parentheses'>) 
</span>            <a href="gistxlog.c.html#LN211"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>= </span><a href="../../../include/access/gist.h.html#LN41"><span class='Ref_to_Const'>F_LEAF</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="gistxlog.c.html#LN211"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/gist_private.h.html#LN466"><span class='Ref_to_Proto'>GISTInitBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN195"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN211"><span class='Ref_To_Local'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* and fill it */ 
</span>        <a href="gistutil.c.html#LN31"><span class='Ref_to_Func'>gistfillbuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN216"><span class='Ref_To_Local'>tuples</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN214"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN215"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/access/gist_private.h.html#LN248"><span class='Ref_to_Const'>GIST_ROOT_BLKNO</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/gist.h.html#LN129"><span class='Ref_to_Macro'>GistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rightlink <span class='Operator'>= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/access/gist.h.html#LN151"><span class='Ref_to_Macro'>GistPageSetNSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN50"><span class='Ref_to_Member'>orignsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/gist.h.html#LN148"><span class='Ref_to_Macro'>GistClearFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN53"><span class='Ref_to_Member'>npage</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN251"></a>                <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>nextblkno</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN251"><span class='Ref_To_Local'>nextblkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/gist.h.html#LN129"><span class='Ref_to_Macro'>GistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rightlink <span class='Operator'>= </span><a href="gistxlog.c.html#LN251"><span class='Ref_To_Local'>nextblkno</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/access/gist.h.html#LN129"><span class='Ref_to_Macro'>GistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rightlink <span class='Operator'>= </span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN49"><span class='Ref_to_Member'>origrlink</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/access/gist.h.html#LN151"><span class='Ref_to_Macro'>GistPageSetNSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN50"><span class='Ref_to_Member'>orignsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN53"><span class='Ref_to_Member'>npage</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& !</span><a href="gistxlog.c.html#LN198"><span class='Ref_To_Local'>isrootsplit</span></a> <span class='Operator'>&& 
</span>                <a href="gistxlog.c.html#LN193"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gistxlog.h.html#LN54"><span class='Ref_to_Member'>markfollowright</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/access/gist.h.html#LN147"><span class='Ref_to_Macro'>GistMarkFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/access/gist.h.html#LN148"><span class='Ref_to_Macro'>GistClearFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN196"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN192"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN195"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="gistxlog.c.html#LN194"><span class='Ref_To_Local'>firstbuffer</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN195"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN195"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;xldata-&GT;npage;i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Fix follow-right data on left child page, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="gistxlog.c.html#LN35"><span class='Ref_to_Func'>gistRedoClearFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN190"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Finally, release lock on the first page */ 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN194"><span class='Ref_To_Local'>firstbuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistRedoPageSplitRecord &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN284"></a><span class='Declare_Function'>gistRedoCreateIndex</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN286"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="gistxlog.c.html#LN284"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN287"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN288"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span> 
    <a href="gistxlog.c.html#LN287"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN284"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN287"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/gist_private.h.html#LN248"><span class='Ref_to_Const'>GIST_ROOT_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN288"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN287"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/gist_private.h.html#LN466"><span class='Ref_to_Proto'>GISTInitBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN287"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN41"><span class='Ref_to_Const'>F_LEAF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN288"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN286"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN287"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN287"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN303"></a><span class='Declare_Function'>gist_redo</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN305"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN303"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span><a name="LN306"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * GiST indexes do not require any conflict processing. NB: If we ever 
     * implement a similar optimization we have in b-tree, and remove killed 
     * tuples outside VACUUM, we'll need to handle that here. 
     */ 
</span> 
    <a href="gistxlog.c.html#LN306"><span class='Ref_To_Local'>oldCxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN305"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/gistxlog.h.html#LN19"><span class='Ref_to_Const'>XLOG_GIST_PAGE_UPDATE</span></a><span class='Operator'>: 
</span>            <a href="gistxlog.c.html#LN65"><span class='Ref_to_Func'>gistRedoPageUpdateRecord</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN303"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/gistxlog.h.html#LN21"><span class='Ref_to_Const'>XLOG_GIST_PAGE_SPLIT</span></a><span class='Operator'>: 
</span>            <a href="gistxlog.c.html#LN189"><span class='Ref_to_Func'>gistRedoPageSplitRecord</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN303"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/gistxlog.h.html#LN23"><span class='Ref_to_Const'>XLOG_GIST_CREATE_INDEX</span></a><span class='Operator'>: 
</span>            <a href="gistxlog.c.html#LN283"><span class='Ref_to_Func'>gistRedoCreateIndex</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN303"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='String'>"gist_redo: unknown op code %u"</span><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN305"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN306"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_redo &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN335"></a><span class='Declare_Function'>gist_xlog_startup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a> <span class='Operator'>= </span><a href="gist.c.html#LN108"><span class='Ref_to_Func'>createTempGistContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN341"></a><span class='Declare_Function'>gist_xlog_cleanup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Mask a Gist page before running consistency checks on it. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN350"></a><span class='Declare_Function'>gist_mask</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pagedata</span><span class='Delimiter'>, </span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN352"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN350"><span class='Ref_to_Parameter'>pagedata</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/bufmask.h.html#LN25"><span class='Ref_to_Proto'>mask_page_lsn</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/bufmask.h.html#LN26"><span class='Ref_to_Proto'>mask_page_hint_bits</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/bufmask.h.html#LN27"><span class='Ref_to_Proto'>mask_unused_space</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NSN is nothing but a special purpose LSN. Hence, mask it for the same 
     * reason as mask_page_lsn. 
     */ 
</span>    <a href="../../../include/access/gist.h.html#LN151"><span class='Ref_to_Macro'>GistPageSetNSN</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="../../../include/access/bufmask.h.html#LN23"><span class='Ref_to_Const'>MASK_MARKER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We update F_FOLLOW_RIGHT flag on the left child after writing WAL 
     * record. Hence, mask this flag. See gistplacetopage() for details. 
     */ 
</span>    <a href="../../../include/access/gist.h.html#LN147"><span class='Ref_to_Macro'>GistMarkFollowRight</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN131"><span class='Ref_to_Macro'>GistPageIsLeaf</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * In gist leaf pages, it is possible to modify the LP_FLAGS without 
         * emitting any WAL record. Hence, mask the line pointer flags. See 
         * gistkillitems() for details. 
         */ 
</span>        <a href="../../../include/access/bufmask.h.html#LN28"><span class='Ref_to_Proto'>mask_lp_flags</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * During gist redo, we never mark a page as garbage. Hence, mask it to 
     * ignore any differences. 
     */ 
</span>    <a href="../../../include/access/gist.h.html#LN144"><span class='Ref_to_Macro'>GistClearPageHasGarbage</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN352"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gist_mask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write WAL record of a page split. 
 */ 
</span><a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> 
<a name="LN392"></a><span class='Declare_Function'>gistXLogSplit</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>page_is_leaf</span><span class='Delimiter'>, 
</span><a name="LN393"></a>              <a href="../../../include/access/gist_private.h.html#LN186"><span class='Ref_to_Struct'>SplitedPageLayout</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dist</span><span class='Delimiter'>, 
</span><a name="LN394"></a>              <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>origrlink</span><span class='Delimiter'>, </span><a href="../../../include/access/gist.h.html#LN49"><span class='Ref_to_Typedef'>GistNSN</span></a> <span class='Declare_Parameter'>orignsn</span><span class='Delimiter'>, 
</span><a name="LN395"></a>              <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>leftchildbuf</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>markfollowright</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN397"></a>    <a href="../../../include/access/gistxlog.h.html#LN47"><span class='Ref_to_Struct'>gistxlogPageSplit</span></a> <span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN398"></a>    <a href="../../../include/access/gist_private.h.html#LN186"><span class='Ref_to_Struct'>SplitedPageLayout</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN399"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>npage</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN400"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span><a name="LN401"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN393"><span class='Ref_to_Parameter'>dist</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN195"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>        <a href="gistxlog.c.html#LN399"><span class='Ref_To_Local'>npage</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="gistxlog.c.html#LN397"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN49"><span class='Ref_to_Member'>origrlink</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN394"><span class='Ref_to_Parameter'>origrlink</span></a><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN397"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN50"><span class='Ref_to_Member'>orignsn</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN394"><span class='Ref_to_Parameter'>orignsn</span></a><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN397"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN51"><span class='Ref_to_Member'>origleaf</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN392"><span class='Ref_to_Parameter'>page_is_leaf</span></a><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN397"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN53"><span class='Ref_to_Member'>npage</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN399"><span class='Ref_To_Local'>npage</span></a><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN397"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN54"><span class='Ref_to_Member'>markfollowright</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN395"><span class='Ref_to_Parameter'>markfollowright</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/xloginsert.h.html#LN41"><span class='Ref_to_Proto'>XLogBeginInsert</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Include a full page image of the child buf. (only necessary if a 
     * checkpoint happened since the child page was split) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN395"><span class='Ref_to_Parameter'>leftchildbuf</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN395"><span class='Ref_to_Parameter'>leftchildbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xloginsert.h.html#LN34"><span class='Ref_to_Const'>REGBUF_STANDARD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NOTE: We register a lot of data. The caller must've called 
     * XLogEnsureRecordSpace() to prepare for that. We cannot do it here, 
     * because we're already in a critical section. If you change the number 
     * of buffer or data registrations here, make sure you modify the 
     * XLogEnsureRecordSpace() calls accordingly! 
     */ 
</span>    <a href="../../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN397"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gistxlog.h.html#LN47"><span class='Ref_to_Struct'>gistxlogPageSplit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="gistxlog.c.html#LN401"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN393"><span class='Ref_to_Parameter'>dist</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN195"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN401"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN193"><span class='Ref_to_Member'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xloginsert.h.html#LN31"><span class='Ref_to_Const'>REGBUF_WILL_INIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/xloginsert.h.html#LN50"><span class='Ref_to_Proto'>XLogRegisterBufData</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN401"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN188"><span class='Ref_to_Member'>block</span></a><span class='Operator'>.</span><a href="../../../include/access/gist_private.h.html#LN182"><span class='Ref_to_Member'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/xloginsert.h.html#LN50"><span class='Ref_to_Proto'>XLogRegisterBufData</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN401"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN189"><span class='Ref_to_Member'>list</span></a><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN398"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist_private.h.html#LN190"><span class='Ref_to_Member'>lenlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="gistxlog.c.html#LN401"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="gistxlog.c.html#LN400"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/xloginsert.h.html#LN43"><span class='Ref_to_Proto'>XLogInsert</span></a><span class='Parentheses'>(</span>RM_GIST_ID<span class='Delimiter'>, </span><a href="../../../include/access/gistxlog.h.html#LN21"><span class='Ref_to_Const'>XLOG_GIST_PAGE_SPLIT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="gistxlog.c.html#LN400"><span class='Ref_To_Local'>recptr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistXLogSplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write XLOG record describing a page update. The update can include any 
 * number of deletions and/or insertions of tuples on a single index page. 
 * 
 * If this update inserts a downlink for a split page, also record that 
 * the F_FOLLOW_RIGHT flag on the child page is cleared and NSN set. 
 * 
 * Note that both the todelete array and the tuples are marked as belonging 
 * to the target buffer; they need not be stored in XLOG if XLogInsert decides 
 * to log the whole buffer contents instead. 
 */ 
</span><a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> 
<a name="LN456"></a><span class='Declare_Function'>gistXLogUpdate</span><span class='Parentheses'>(</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, 
</span><a name="LN457"></a>               <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>todelete</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ntodelete</span><span class='Delimiter'>, 
</span><a name="LN458"></a>               <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>itup</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ituplen</span><span class='Delimiter'>, 
</span><a name="LN459"></a>               <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>leftchildbuf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN461"></a>    <a href="../../../include/access/gistxlog.h.html#LN31"><span class='Ref_to_Struct'>gistxlogPageUpdate</span></a> <span class='Declare_Local'>xlrec</span><span class='Delimiter'>; 
</span><a name="LN462"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN463"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>recptr</span><span class='Delimiter'>; 
</span> 
    <a href="gistxlog.c.html#LN461"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN34"><span class='Ref_to_Member'>ntodelete</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN457"><span class='Ref_to_Parameter'>ntodelete</span></a><span class='Delimiter'>; 
</span>    <a href="gistxlog.c.html#LN461"><span class='Ref_To_Local'>xlrec</span></a><span class='Operator'>.</span><a href="../../../include/access/gistxlog.h.html#LN35"><span class='Ref_to_Member'>ntoinsert</span></a> <span class='Operator'>= </span><a href="gistxlog.c.html#LN458"><span class='Ref_to_Parameter'>ituplen</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/xloginsert.h.html#LN41"><span class='Ref_to_Proto'>XLogBeginInsert</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/xloginsert.h.html#LN45"><span class='Ref_to_Proto'>XLogRegisterData</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="gistxlog.c.html#LN461"><span class='Ref_To_Local'>xlrec</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/gistxlog.h.html#LN31"><span class='Ref_to_Struct'>gistxlogPageUpdate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN456"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xloginsert.h.html#LN34"><span class='Ref_to_Const'>REGBUF_STANDARD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/xloginsert.h.html#LN50"><span class='Ref_to_Proto'>XLogRegisterBufData</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="gistxlog.c.html#LN457"><span class='Ref_to_Parameter'>todelete</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="gistxlog.c.html#LN457"><span class='Ref_to_Parameter'>ntodelete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* new tuples */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="gistxlog.c.html#LN462"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN462"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="gistxlog.c.html#LN458"><span class='Ref_to_Parameter'>ituplen</span></a><span class='Delimiter'>; </span><a href="gistxlog.c.html#LN462"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../../include/access/xloginsert.h.html#LN50"><span class='Ref_to_Proto'>XLogRegisterBufData</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="gistxlog.c.html#LN458"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>[</span><a href="gistxlog.c.html#LN462"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN69"><span class='Ref_to_Macro'>IndexTupleSize</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN458"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>[</span><a href="gistxlog.c.html#LN462"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Include a full page image of the child buf. (only necessary if a 
     * checkpoint happened since the child page was split) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="gistxlog.c.html#LN459"><span class='Ref_to_Parameter'>leftchildbuf</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/access/xloginsert.h.html#LN46"><span class='Ref_to_Proto'>XLogRegisterBuffer</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="gistxlog.c.html#LN459"><span class='Ref_to_Parameter'>leftchildbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/access/xloginsert.h.html#LN34"><span class='Ref_to_Const'>REGBUF_STANDARD</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="gistxlog.c.html#LN463"><span class='Ref_To_Local'>recptr</span></a> <span class='Operator'>= </span><a href="../../../include/access/xloginsert.h.html#LN43"><span class='Ref_to_Proto'>XLogInsert</span></a><span class='Parentheses'>(</span>RM_GIST_ID<span class='Delimiter'>, </span><a href="../../../include/access/gistxlog.h.html#LN19"><span class='Ref_to_Const'>XLOG_GIST_PAGE_UPDATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="gistxlog.c.html#LN463"><span class='Ref_To_Local'>recptr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end gistXLogUpdate &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>