<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\index\genam.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\index\genam.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:29 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * genam.c 
 *    general index access method routines 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/access/index/genam.c 
 * 
 * NOTES 
 *    many of the old access method routines have been turned into 
 *    macros and moved to genam.h -cim 4/30/91 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/index.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/bufmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rls.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ruleutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      general access method routines 
 * 
 *      All indexed access methods use an identical scan structure. 
 *      We don't know how the various AMs do locking, however, so we don't 
 *      do anything about that here. 
 * 
 *      The intent is that an AM implementor will define a beginscan routine 
 *      that calls RelationGetIndexScan, to fill in the scan, and then does 
 *      whatever kind of locking he wants. 
 * 
 *      At the end of a scan, the AM's endscan routine undoes the locking, 
 *      but does *not* call IndexScanEnd --- the higher-level index_endscan 
 *      routine does that.  (We can't do it in the AM because index_endscan 
 *      still needs to touch the IndexScanDesc after calling the AM.) 
 * 
 *      Because of this, the AM does not have a choice whether to call 
 *      RelationGetIndexScan or not; its beginscan routine must return an 
 *      object made by RelationGetIndexScan.  This is kinda ugly but not 
 *      worth cleaning up now. 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* ---------------- 
 *  RelationGetIndexScan -- Create and fill an IndexScanDesc. 
 * 
 *      This routine creates an index scan structure and sets up initial 
 *      contents for it. 
 * 
 *      Parameters: 
 *              indexRelation -- index relation for scan. 
 *              nkeys -- count of scan keys (index qual conditions). 
 *              norderbys -- count of index order-by operators. 
 * 
 *      Returns: 
 *              An initialized IndexScanDesc. 
 * ---------------- 
 */ 
</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> 
<a name="LN77"></a><span class='Declare_Function'>RelationGetIndexScan</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>indexRelation</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>norderbys</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN79"></a>    <a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/relscan.h.html#LN84"><span class='Ref_to_Struct'>IndexScanDescData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN87"><span class='Ref_to_Member'>heapRelation</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* may be set later */ 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* caller must initialize this */ 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN90"><span class='Ref_to_Member'>numberOfKeys</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN91"><span class='Ref_to_Member'>numberOfOrderBys</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>norderbys</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We allocate key workspace here, but it won't get filled until amrescan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>nkeys</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN92"><span class='Ref_to_Member'>keyData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN92"><span class='Ref_to_Member'>keyData</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>norderbys</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN93"><span class='Ref_to_Member'>orderByData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="genam.c.html#LN77"><span class='Ref_to_Parameter'>norderbys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN93"><span class='Ref_to_Member'>orderByData</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* may be set later */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * During recovery we ignore killed tuples and don't bother to kill them 
     * either. We do this because the xmin on the primary node could easily be 
     * later than the xmin on the standby node, so that what the primary 
     * thinks is killed is supposed to be visible on standby. So for correct 
     * MVCC for queries during recovery we must ignore these hints and check 
     * all tuples. Do *not* set ignore_killed_tuples to true when running in a 
     * transaction that was started during recovery. xactStartedInRecovery 
     * should not be altered by index AMs. 
     */ 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN98"><span class='Ref_to_Member'>kill_prior_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN100"><span class='Ref_to_Member'>xactStartedInRecovery</span></a> <span class='Operator'>= </span><a href="../../../include/access/transam.h.html#LN153"><span class='Ref_to_Proto'>TransactionStartedDuringRecovery</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN99"><span class='Ref_to_Member'>ignore_killed_tuples</span></a> <span class='Operator'>= !</span><a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN100"><span class='Ref_to_Member'>xactStartedInRecovery</span></a><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN112"><span class='Ref_to_Member'>xs_itup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN113"><span class='Ref_to_Member'>xs_itupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN114"><span class='Ref_to_Member'>xs_hitup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN115"><span class='Ref_to_Member'>xs_hitupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN119"><span class='Ref_to_Member'>xs_cbuf</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN135"><span class='Ref_to_Member'>xs_continue_hot</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="genam.c.html#LN79"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetIndexScan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *  IndexScanEnd -- End an index scan. 
 * 
 *      This routine just releases the storage acquired by 
 *      RelationGetIndexScan().  Any AM-level resources are 
 *      assumed to already have been released by the AM's 
 *      endscan routine. 
 * 
 *  Returns: 
 *      None. 
 * ---------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN145"></a><span class='Declare_Function'>IndexScanEnd</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN145"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN92"><span class='Ref_to_Member'>keyData</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN145"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN92"><span class='Ref_to_Member'>keyData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN145"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN93"><span class='Ref_to_Member'>orderByData</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN145"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN93"><span class='Ref_to_Member'>orderByData</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN145"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * BuildIndexValueDescription 
 * 
 * Construct a string describing the contents of an index entry, in the 
 * form "(key_name, ...)=(key_value, ...)".  This is currently used 
 * for building unique-constraint and exclusion-constraint error messages. 
 * 
 * Note that if the user does not have permissions to view all of the 
 * columns involved then a NULL is returned.  Returning a partial key seems 
 * unlikely to be useful and we have no way to know which of the columns the 
 * user provided (unlike in ExecBuildSlotValueDescription). 
 * 
 * The passed-in values/nulls arrays are the "raw" input to the index AM, 
 * e.g. results of FormIndexDatum --- this is not necessarily what is stored 
 * in the index, but it's what the user perceives to be stored. 
 * 
 * Note: if you change anything here, check whether 
 * ExecBuildSlotPartitionKeyDescription() in execMain.c needs a similar 
 * change. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN176"></a><span class='Declare_Function'>BuildIndexValueDescription</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>indexRelation</span><span class='Delimiter'>, 
</span><a name="LN177"></a>                           <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN179"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN180"></a>    <a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a> <span class='Declare_Local'>idxrec</span><span class='Delimiter'>; 
</span><a name="LN181"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>ht_idx</span><span class='Delimiter'>; 
</span><a name="LN182"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="genam.c.html#LN176"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span><a name="LN183"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN184"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>keyno</span><span class='Delimiter'>; 
</span><a name="LN185"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexrelid</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN176"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN186"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indrelid</span><span class='Delimiter'>; 
</span><a name="LN187"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check permissions- if the user does not have access to view all of the 
     * key columns then return NULL to avoid leaking data. 
     * 
     * First check if RLS is enabled for the relation.  If so, return NULL to 
     * avoid leaking data. 
     * 
     * Next we need to check table-level SELECT access and then, if there is 
     * no access there, check column-level permissions. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fetch the pg_index tuple by the Oid of the index 
     */ 
</span>    <a href="genam.c.html#LN181"><span class='Ref_To_Local'>ht_idx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN185"><span class='Ref_To_Local'>indexrelid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN181"><span class='Ref_To_Local'>ht_idx</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for index %u"</span><span class='Delimiter'>, </span><a href="genam.c.html#LN185"><span class='Ref_To_Local'>indexrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN180"><span class='Ref_To_Local'>idxrec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_index.h.html#LN66"><span class='Ref_to_Typedef'>Form_pg_index</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN181"><span class='Ref_To_Local'>ht_idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN186"><span class='Ref_To_Local'>indrelid</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN180"><span class='Ref_To_Local'>idxrec</span></a><span class='Operator'>-&GT;</span>indrelid<span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="genam.c.html#LN185"><span class='Ref_To_Local'>indexrelid</span></a> <span class='Operator'>== </span><a href="genam.c.html#LN180"><span class='Ref_To_Local'>idxrec</span></a><span class='Operator'>-&GT;</span>indexrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* RLS check- if RLS is enabled then we don't return anything. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rls.h.html#LN47"><span class='Ref_to_Proto'>check_enable_rls</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN186"><span class='Ref_To_Local'>indrelid</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/utils/rls.h.html#LN44"><span class='Ref_to_EnumConst'>RLS_ENABLED</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN181"><span class='Ref_To_Local'>ht_idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Table-level SELECT is enough, if the user has it */ 
</span>    <a href="genam.c.html#LN187"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN283"><span class='Ref_to_Proto'>pg_class_aclcheck</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN186"><span class='Ref_To_Local'>indrelid</span></a><span class='Delimiter'>, </span><a href="../../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN187"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No table-level access, so step through the columns in the index and 
         * make sure the user has SELECT rights on all of them. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN184"><span class='Ref_To_Local'>keyno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="genam.c.html#LN184"><span class='Ref_To_Local'>keyno</span></a> <span class='Operator'>&LT; </span><a href="genam.c.html#LN180"><span class='Ref_To_Local'>idxrec</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="genam.c.html#LN184"><span class='Ref_To_Local'>keyno</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN228"></a>            <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="genam.c.html#LN180"><span class='Ref_To_Local'>idxrec</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="genam.c.html#LN184"><span class='Ref_To_Local'>keyno</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Note that if attnum == InvalidAttrNumber, then this is an index 
             * based on an expression and we return no detail rather than try 
             * to figure out what column(s) the expression includes and if the 
             * user has SELECT rights on them. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN228"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a> <span class='Operator'>|| 
</span>                <a href="../../../include/utils/acl.h.html#LN279"><span class='Ref_to_Proto'>pg_attribute_aclcheck</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN186"><span class='Ref_To_Local'>indrelid</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN228"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, </span><a href="../../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* No access, so clean up and return */ 
</span>                <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN181"><span class='Ref_To_Local'>ht_idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if aclresult!=ACLCHECK_O... &raquo; </span> 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN181"><span class='Ref_To_Local'>ht_idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="genam.c.html#LN179"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="genam.c.html#LN179"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"(%s)=("</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/ruleutils.h.html#LN21"><span class='Ref_to_Proto'>pg_get_indexdef_columns</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN185"><span class='Ref_To_Local'>indexrelid</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="genam.c.html#LN182"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN254"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN177"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="genam.c.html#LN254"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='String'>"null"</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN260"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>foutoid</span><span class='Delimiter'>; 
</span><a name="LN261"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typisvarlena</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The provided data is not necessarily of the type stored in the 
             * index; rather it is of the index opclass's input type. So look 
             * at rd_opcintype not the index tupdesc. 
             * 
             * Note: this is a bit shaky for opclasses that have pseudotype 
             * input types such as ANYARRAY or RECORD.  Currently, the 
             * typoutput functions associated with the pseudotypes will work 
             * okay, but we might have to try harder in future. 
             */ 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN176"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                              <span class='Operator'>&</span><a href="genam.c.html#LN260"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="genam.c.html#LN261"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="genam.c.html#LN254"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN260"><span class='Ref_To_Local'>foutoid</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN177"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN183"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="genam.c.html#LN179"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="genam.c.html#LN179"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN254"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;natts;i++ &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="genam.c.html#LN179"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>')'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="genam.c.html#LN179"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BuildIndexValueDescription &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      heap-or-index-scan access to system catalogs 
 * 
 *      These functions support system catalog accesses that normally use 
 *      an index but need to be capable of being switched to heap scans 
 *      if the system indexes are unavailable. 
 * 
 *      The specified scan keys must be compatible with the named index. 
 *      Generally this means that they must constrain either all columns 
 *      of the index, or the first K columns of an N-column index. 
 * 
 *      These routines could work with non-system tables, actually, 
 *      but they're only useful when there is a known index to use with 
 *      the given scan keys; so in practice they're only good for 
 *      predetermined types of scans of system catalogs. 
 * ---------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * systable_beginscan --- set up for heap-or-index scan 
 * 
 *  rel: catalog to scan, already opened and suitably locked 
 *  indexId: OID of index to conditionally use 
 *  indexOK: if false, forces a heap scan (see notes below) 
 *  snapshot: time qual to use (NULL for a recent catalog snapshot) 
 *  nkeys, key: scan keys 
 * 
 * The attribute numbers in the scan key should be set for the heap case. 
 * If we choose to index, we reset them to 1..n to reference the index 
 * columns.  Note this means there must be one scankey qualification per 
 * index column!  This is checked by the Asserts in the normal, index-using 
 * case, but won't be checked if the heapscan path is taken. 
 * 
 * The routine checks the normal cases for whether an indexscan is safe, 
 * but caller can make additional checks and pass indexOK=false if needed. 
 * In standard case indexOK can simply be constant TRUE. 
 */ 
</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> 
<a name="LN327"></a><span class='Declare_Function'>systable_beginscan</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>heapRelation</span><span class='Delimiter'>, 
</span><a name="LN328"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexId</span><span class='Delimiter'>, 
</span><a name="LN329"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>indexOK</span><span class='Delimiter'>, 
</span><a name="LN330"></a>                   <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN331"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN333"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>sysscan</span><span class='Delimiter'>; 
</span><a name="LN334"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>irel</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN329"><span class='Ref_to_Parameter'>indexOK</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../utils/init/miscinit.c.html#LN72"><span class='Ref_to_Global_Var'>IgnoreSystemIndexes</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/catalog/index.h.html#LN130"><span class='Ref_to_Proto'>ReindexIsProcessingIndex</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN328"><span class='Ref_to_Parameter'>indexId</span></a><span class='Parentheses'>))</span> 
        <a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN328"><span class='Ref_to_Parameter'>indexId</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/relscan.h.html#LN151"><span class='Ref_to_Struct'>SysScanDescData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN153"><span class='Ref_to_Member'>heap_rel</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN327"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN330"><span class='Ref_to_Parameter'>snapshot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN350"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN327"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="genam.c.html#LN330"><span class='Ref_to_Parameter'>snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN68"><span class='Ref_to_Proto'>GetCatalogSnapshot</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN350"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN330"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Caller is responsible for any snapshot. */ 
</span>        <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN363"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Change attribute numbers to be index column numbers. */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN363"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="genam.c.html#LN363"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; </span><a href="genam.c.html#LN363"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN368"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN368"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="genam.c.html#LN368"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="genam.c.html#LN368"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN363"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>== </span><a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="genam.c.html#LN368"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN363"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN368"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN368"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"column is not in index"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN139"><span class='Ref_to_Proto'>index_beginscan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN327"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN334"><span class='Ref_To_Local'>irel</span></a><span class='Delimiter'>, 
</span>                                         <a href="genam.c.html#LN330"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/genam.h.html#LN146"><span class='Ref_to_Proto'>index_rescan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN155"><span class='Ref_to_Member'>scan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if irel &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We disallow synchronized scans when forced to use a heapscan on a 
         * catalog.  In most cases the desired rows are near the front, so 
         * that the unpredictable start point of a syncscan is a serious 
         * disadvantage; and there are no compensating advantages, because 
         * it's unlikely that such scans will occur in parallel. 
         */ 
</span>        <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN155"><span class='Ref_to_Member'>scan</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN112"><span class='Ref_to_Proto'>heap_beginscan_strat</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN327"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN330"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, 
</span>                                             <a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN331"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="genam.c.html#LN333"><span class='Ref_To_Local'>sysscan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end systable_beginscan &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * systable_getnext --- get next tuple in a heap-or-index scan 
 * 
 * Returns NULL if no more tuples available. 
 * 
 * Note that returned tuple is a reference to data in a disk buffer; 
 * it must not be modified, and should be presumed inaccessible after 
 * next getnext() or endscan() call. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN415"></a><span class='Declare_Function'>systable_getnext</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Parameter'>sysscan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN417"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN415"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="genam.c.html#LN417"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN162"><span class='Ref_to_Proto'>index_getnext</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN415"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We currently don't need to support lossy index operators for any 
         * system catalog scan.  It could be done here, using the scan keys to 
         * drive the operator calls, if we arranged to save the heap attnums 
         * during systable_beginscan(); this is practical because we still 
         * wouldn't need to support indexes on expressions. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN417"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>&& </span><a href="genam.c.html#LN415"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN121"><span class='Ref_to_Member'>xs_recheck</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"system catalog scans with lossy index conditions are not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="genam.c.html#LN417"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN415"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN155"><span class='Ref_to_Member'>scan</span></a><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="genam.c.html#LN417"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end systable_getnext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * systable_recheck_tuple --- recheck visibility of most-recently-fetched tuple 
 * 
 * In particular, determine if this tuple would be visible to a catalog scan 
 * that started now.  We don't handle the case of a non-MVCC scan snapshot, 
 * because no caller needs that yet. 
 * 
 * This is useful to test whether an object was deleted while we waited to 
 * acquire lock on it. 
 * 
 * Note: we don't actually *need* the tuple to be passed in, but it's a 
 * good crosscheck that the caller is interested in the right tuple. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN453"></a><span class='Declare_Function'>systable_recheck_tuple</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Parameter'>sysscan</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN455"></a>    <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a>    <span class='Declare_Local'>freshsnap</span><span class='Delimiter'>; 
</span><a name="LN456"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Trust that LockBuffer() and HeapTupleSatisfiesMVCC() do not themselves 
     * acquire snapshots, so we need not register the snapshot.  Those 
     * facilities are too low-level to have any business scanning tables. 
     */ 
</span>    <a href="genam.c.html#LN455"><span class='Ref_To_Local'>freshsnap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapmgr.h.html#LN68"><span class='Ref_to_Proto'>GetCatalogSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN153"><span class='Ref_to_Member'>heap_rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN467"></a>        <a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Local'>scan</span> <span class='Operator'>= </span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/tqual.h.html#LN30"><span class='Ref_to_Macro'>IsMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN467"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>== &</span><a href="genam.c.html#LN467"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN467"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN119"><span class='Ref_to_Member'>xs_cbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* must hold a buffer lock to call HeapTupleSatisfiesVisibility */ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN467"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN119"><span class='Ref_to_Member'>xs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="genam.c.html#LN456"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/tqual.h.html#LN44"><span class='Ref_to_Macro'>HeapTupleSatisfiesVisibility</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN455"><span class='Ref_To_Local'>freshsnap</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN467"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN119"><span class='Ref_to_Member'>xs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN467"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN119"><span class='Ref_to_Member'>xs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN479"></a>        <a href="../../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span> <span class='Operator'>= </span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN155"><span class='Ref_to_Member'>scan</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/tqual.h.html#LN30"><span class='Ref_to_Macro'>IsMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN479"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN47"><span class='Ref_to_Member'>rs_snapshot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>tup</span></a> <span class='Operator'>== &</span><a href="genam.c.html#LN479"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN67"><span class='Ref_to_Member'>rs_ctup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN479"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* must hold a buffer lock to call HeapTupleSatisfiesVisibility */ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN479"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN87"><span class='Ref_to_Const'>BUFFER_LOCK_SHARE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="genam.c.html#LN456"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/tqual.h.html#LN44"><span class='Ref_to_Macro'>HeapTupleSatisfiesVisibility</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN453"><span class='Ref_to_Parameter'>tup</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN455"><span class='Ref_To_Local'>freshsnap</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN479"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN479"><span class='Ref_To_Local'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN69"><span class='Ref_to_Member'>rs_cbuf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="genam.c.html#LN456"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end systable_recheck_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * systable_endscan --- close scan, release resources 
 * 
 * Note that it's still up to the caller to close the heap relation. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN498"></a><span class='Declare_Function'>systable_endscan</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Parameter'>sysscan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/access/genam.h.html#LN149"><span class='Ref_to_Proto'>index_endscan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN155"><span class='Ref_to_Member'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN498"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * systable_beginscan_ordered --- set up for ordered catalog scan 
 * 
 * These routines have essentially the same API as systable_beginscan etc, 
 * except that they guarantee to return multiple matching tuples in 
 * index order.  Also, for largely historical reasons, the index to use 
 * is opened and locked by the caller, not here. 
 * 
 * Currently we do not support non-index-based scans here.  (In principle 
 * we could do a heapscan and sort, but the uses are in places that 
 * probably don't need to still work with corrupted catalog indexes.) 
 * For the moment, therefore, these functions are merely the thinnest of 
 * wrappers around index_beginscan/index_getnext.  The main reason for their 
 * existence is to centralize possible future support of lossy operators 
 * in catalog scans. 
 */ 
</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> 
<a name="LN532"></a><span class='Declare_Function'>systable_beginscan_ordered</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>heapRelation</span><span class='Delimiter'>, 
</span><a name="LN533"></a>                           <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>indexRelation</span><span class='Delimiter'>, 
</span><a name="LN534"></a>                           <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Delimiter'>, 
</span><a name="LN535"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN537"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>sysscan</span><span class='Delimiter'>; 
</span><a name="LN538"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* REINDEX can probably be a hard error here ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/index.h.html#LN130"><span class='Ref_to_Proto'>ReindexIsProcessingIndex</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>)))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot do ordered scan on index \"%s\", because it is being reindexed"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ... but we only throw a warning about violating IgnoreSystemIndexes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../utils/init/miscinit.c.html#LN72"><span class='Ref_to_Global_Var'>IgnoreSystemIndexes</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"using index \"%s\" despite IgnoreSystemIndexes"</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/relscan.h.html#LN151"><span class='Ref_to_Struct'>SysScanDescData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN153"><span class='Ref_to_Member'>heap_rel</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN532"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN534"><span class='Ref_to_Parameter'>snapshot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN556"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN532"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="genam.c.html#LN534"><span class='Ref_to_Parameter'>snapshot</span></a> <span class='Operator'>= </span><a href="../../../include/utils/snapmgr.h.html#LN80"><span class='Ref_to_Proto'>RegisterSnapshot</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/snapmgr.h.html#LN68"><span class='Ref_to_Proto'>GetCatalogSnapshot</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN556"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN534"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Caller is responsible for any snapshot. */ 
</span>        <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Change attribute numbers to be index column numbers. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN538"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="genam.c.html#LN538"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="genam.c.html#LN535"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; </span><a href="genam.c.html#LN538"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN570"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN570"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="genam.c.html#LN570"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Delimiter'>; </span><a href="genam.c.html#LN570"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN535"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN538"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>== </span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indkey<span class='Operator'>.</span>values<span class='Delimiter'>[</span><a href="genam.c.html#LN570"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="genam.c.html#LN535"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>[</span><a href="genam.c.html#LN538"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>= </span><a href="genam.c.html#LN570"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN570"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indnatts<span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"column is not in index"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN139"><span class='Ref_to_Proto'>index_beginscan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN532"><span class='Ref_to_Parameter'>heapRelation</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN533"><span class='Ref_to_Parameter'>indexRelation</span></a><span class='Delimiter'>, 
</span>                                     <a href="genam.c.html#LN534"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN535"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/genam.h.html#LN146"><span class='Ref_to_Proto'>index_rescan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN535"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN535"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN155"><span class='Ref_to_Member'>scan</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="genam.c.html#LN537"><span class='Ref_To_Local'>sysscan</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end systable_beginscan_ordered &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * systable_getnext_ordered --- get next tuple in an ordered catalog scan 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN596"></a><span class='Declare_Function'>systable_getnext_ordered</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Parameter'>sysscan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>direction</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN598"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>htup</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="genam.c.html#LN596"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="genam.c.html#LN598"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN162"><span class='Ref_to_Proto'>index_getnext</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN596"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Delimiter'>, </span><a href="genam.c.html#LN596"><span class='Ref_to_Parameter'>direction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* See notes in systable_getnext */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN598"><span class='Ref_To_Local'>htup</span></a> <span class='Operator'>&& </span><a href="genam.c.html#LN596"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN121"><span class='Ref_to_Member'>xs_recheck</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"system catalog scans with lossy index conditions are not implemented"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="genam.c.html#LN598"><span class='Ref_To_Local'>htup</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * systable_endscan_ordered --- close scan, release resources 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN613"></a><span class='Declare_Function'>systable_endscan_ordered</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Parameter'>sysscan</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="genam.c.html#LN613"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/genam.h.html#LN149"><span class='Ref_to_Proto'>index_endscan</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN613"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN156"><span class='Ref_to_Member'>iscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="genam.c.html#LN613"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/snapmgr.h.html#LN81"><span class='Ref_to_Proto'>UnregisterSnapshot</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN613"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN157"><span class='Ref_to_Member'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="genam.c.html#LN613"><span class='Ref_to_Parameter'>sysscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>