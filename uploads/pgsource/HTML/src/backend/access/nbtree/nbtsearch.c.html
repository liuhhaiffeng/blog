<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\nbtree\nbtsearch.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\nbtree\nbtsearch.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:29 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * nbtsearch.c 
 *    Search code for postgres btrees. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/access/nbtree/nbtsearch.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/nbtree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/predicate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<a name="LN27"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_bt_readpage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Delimiter'>, 
</span><a name="LN28"></a>             <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offnum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN29"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_bt_saveitem</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Parameter'>so</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>itemIndex</span><span class='Delimiter'>, 
</span><a name="LN30"></a>             <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offnum</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Declare_Parameter'>itup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN31"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_bt_steppage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN32"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_bt_readnextpage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN33"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_bt_parallel_readpage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Delimiter'>, 
</span><a name="LN34"></a>                      <a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN35"></a><span class='Keyword'>static </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Prototype'>_bt_walk_left</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN36"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>_bt_endpoint</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>_bt_drop_lock_and_maybe_pin</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN330"><span class='Ref_to_Typedef'>BTScanPos</span></a> <span class='Declare_Parameter'>sp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>_bt_initialize_more_data</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Parameter'>so</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_drop_lock_and_maybe_pin() 
 * 
 * Unlock the buffer; and if it is safe to release the pin, do that, too.  It 
 * is safe if the scan is using an MVCC snapshot and the index is WAL-logged. 
 * This will prevent vacuum from stalling in a blocked state trying to read a 
 * page when a cursor is sitting on it -- at least in many important cases. 
 * 
 * Set the buffer to invalid if the pin is released, since the buffer may be 
 * re-used.  If we need to go back to this block (for example, to apply 
 * LP_DEAD hints) we must get a fresh reference to the buffer.  Hopefully it 
 * will remain in shared memory for as long as it takes to scan the index 
 * buffer page. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN56"></a><span class='Declare_Function'>_bt_drop_lock_and_maybe_pin</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN330"><span class='Ref_to_Typedef'>BTScanPos</span></a> <span class='Declare_Parameter'>sp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN56"><span class='Ref_to_Parameter'>sp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/tqual.h.html#LN30"><span class='Ref_to_Macro'>IsMVCCSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN56"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="../../../include/utils/rel.h.html#LN505"><span class='Ref_to_Macro'>RelationNeedsWAL</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN56"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="nbtsearch.c.html#LN56"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN174"><span class='Ref_to_Proto'>ReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN56"><span class='Ref_to_Parameter'>sp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN56"><span class='Ref_to_Parameter'>sp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_search() -- Search the tree for a particular scankey, 
 *      or more precisely for the first leaf page it could be on. 
 * 
 * The passed scankey must be an insertion-type scankey (see nbtree/README), 
 * but it can omit the rightmost column(s) of the index. 
 * 
 * When nextkey is false (the usual case), we are looking for the first 
 * item &GT;= scankey.  When nextkey is true, we are looking for the first 
 * item strictly greater than scankey. 
 * 
 * Return value is a stack of parent-page pointers.  *bufP is set to the 
 * address of the leaf-page buffer, which is read-locked and pinned. 
 * No locks are held on the parent pages, however! 
 * 
 * If the snapshot parameter is not NULL, "old snapshot" checking will take 
 * place during the descent through the tree.  This is not needed when 
 * positioning for an insert or delete, so NULL is used for those cases. 
 * 
 * NOTE that the returned buffer is read-locked regardless of the access 
 * parameter.  However, access = BT_WRITE will allow an empty root page 
 * to be created and returned.  When access = BT_READ, an empty index 
 * will result in *bufP being set to InvalidBuffer.  Also, in BT_WRITE mode, 
 * any incomplete splits encountered during the search will be finished. 
 */ 
</span><a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a> 
<a name="LN96"></a><span class='Declare_Function'>_bt_search</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>keysz</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>scankey</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nextkey</span><span class='Delimiter'>, 
</span><a name="LN97"></a>           <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bufP</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>access</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN99"></a>    <a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a>     <span class='Declare_Local'>stack_in</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the root page to start with */ 
</span>    <span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a> <span class='Operator'>= </span><a href="nbtpage.c.html#LN102"><span class='Ref_to_Func'>_bt_getroot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>access</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If index is empty and access = BT_READ, no root page is created. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop iterates once per level descended in the tree */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN111"></a>        <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN112"></a>        <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN113"></a>        <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span><span class='Delimiter'>; 
</span><a name="LN114"></a>        <a href="../../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>itemid</span><span class='Delimiter'>; 
</span><a name="LN115"></a>        <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN116"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span><a name="LN117"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>par_blkno</span><span class='Delimiter'>; 
</span><a name="LN118"></a>        <a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a>     <span class='Declare_Local'>new_stack</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Race -- the page we just grabbed may have split since we read its 
         * pointer in the parent (or metapage).  If it has, we may need to 
         * move right to its new sibling.  Do that. 
         * 
         * In write-mode, allow _bt_moveright to finish any incomplete splits 
         * along the way.  Strictly speaking, we'd only need to finish an 
         * incomplete split on the leaf page we're about to insert to, not on 
         * any of the upper levels (they are taken care of in _bt_getstackbuf, 
         * if the leaf page is split and we insert to the parent page).  But 
         * this is a good opportunity to finish splits of internal pages too. 
         */ 
</span>        <span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN212"><span class='Ref_to_Func'>_bt_moveright</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>keysz</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>scankey</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>nextkey</span></a><span class='Delimiter'>, 
</span>                              <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>access</span></a> <span class='Operator'>== </span><a href="../../../include/access/nbtree.h.html#LN238"><span class='Ref_to_Const'>BT_WRITE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN99"><span class='Ref_To_Local'>stack_in</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if this is a leaf page, we're done */ 
</span>        <a href="nbtsearch.c.html#LN111"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN112"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN111"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN175"><span class='Ref_to_Macro'>P_ISLEAF</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN112"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find the appropriate item on the internal page, and get the child 
         * page that it points to. 
         */ 
</span>        <a href="nbtsearch.c.html#LN113"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN321"><span class='Ref_to_Func'>_bt_binsrch</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>keysz</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>scankey</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>nextkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN114"><span class='Ref_To_Local'>itemid</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN111"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN113"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN115"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN111"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN114"><span class='Ref_To_Local'>itemid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN116"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/storage/itemptr.h.html#LN74"><span class='Ref_to_Macro'>ItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN115"><span class='Ref_To_Local'>itup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN117"><span class='Ref_To_Local'>par_blkno</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need to save the location of the index entry we chose in the 
         * parent page on a stack. In case we split the tree, we'll use the 
         * stack to work back up to the parent page.  We also save the actual 
         * downlink (TID) to uniquely identify the index entry, in case it 
         * moves right while we're working lower in the tree.  See the paper 
         * by Lehman and Yao for how this is detected and handled. (We use the 
         * child link to disambiguate duplicate keys in the index -- Lehman 
         * and Yao disallow duplicate keys.) 
         */ 
</span>        <a href="nbtsearch.c.html#LN118"><span class='Ref_To_Local'>new_stack</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN250"><span class='Ref_to_Struct'>BTStackData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN118"><span class='Ref_To_Local'>new_stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN252"><span class='Ref_to_Member'>bts_blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN117"><span class='Ref_To_Local'>par_blkno</span></a><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN118"><span class='Ref_To_Local'>new_stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN253"><span class='Ref_to_Member'>bts_offset</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN113"><span class='Ref_To_Local'>offnum</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN118"><span class='Ref_To_Local'>new_stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN254"><span class='Ref_to_Member'>bts_btentry</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN115"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN34"><span class='Ref_to_Struct'>IndexTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN118"><span class='Ref_To_Local'>new_stack</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN255"><span class='Ref_to_Member'>bts_parent</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN99"><span class='Ref_To_Local'>stack_in</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* drop the read lock on the parent page, acquire one on the child */ 
</span>        <span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN96"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="nbtsearch.c.html#LN97"><span class='Ref_to_Parameter'>bufP</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN116"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* okay, all set to move down a level */ 
</span>        <a href="nbtsearch.c.html#LN99"><span class='Ref_To_Local'>stack_in</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN118"><span class='Ref_To_Local'>new_stack</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>return</span> <a href="nbtsearch.c.html#LN99"><span class='Ref_To_Local'>stack_in</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_search &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_moveright() -- move right in the btree if necessary. 
 * 
 * When we follow a pointer to reach a page, it is possible that 
 * the page has changed in the meanwhile.  If this happens, we're 
 * guaranteed that the page has "split right" -- that is, that any 
 * data that appeared on the page originally is either on the page 
 * or strictly to the right of it. 
 * 
 * This routine decides whether or not we need to move right in the 
 * tree by examining the high key entry on the page.  If that entry 
 * is strictly less than the scankey, or &LT;= the scankey in the nextkey=true 
 * case, then we followed the wrong link and we need to move right. 
 * 
 * The passed scankey must be an insertion-type scankey (see nbtree/README), 
 * but it can omit the rightmost column(s) of the index. 
 * 
 * When nextkey is false (the usual case), we are looking for the first 
 * item &GT;= scankey.  When nextkey is true, we are looking for the first 
 * item strictly greater than scankey. 
 * 
 * If forupdate is true, we will attempt to finish any incomplete splits 
 * that we encounter.  This is required when locking a target page for an 
 * insertion, because we don't allow inserting on a page before the split 
 * is completed.  'stack' is only used if forupdate is true. 
 * 
 * On entry, we have the buffer pinned and a lock of the type specified by 
 * 'access'.  If we move right, we release the buffer and lock and acquire 
 * the same on the right sibling.  Return value is the buffer we stop at. 
 * 
 * If the snapshot parameter is not NULL, "old snapshot" checking will take 
 * place during the descent through the tree.  This is not needed when 
 * positioning for an insert or delete, so NULL is used for those cases. 
 */ 
</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> 
<a name="LN213"></a><span class='Declare_Function'>_bt_moveright</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN214"></a>              <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN215"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>keysz</span><span class='Delimiter'>, 
</span><a name="LN216"></a>              <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>scankey</span><span class='Delimiter'>, 
</span><a name="LN217"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>nextkey</span><span class='Delimiter'>, 
</span><a name="LN218"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>forupdate</span><span class='Delimiter'>, 
</span><a name="LN219"></a>              <a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a> <span class='Declare_Parameter'>stack</span><span class='Delimiter'>, 
</span><a name="LN220"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>access</span><span class='Delimiter'>, 
</span><a name="LN221"></a>              <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN223"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN224"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN225"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpval</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When nextkey = false (normal case): if the scan key that brought us to 
     * this page is &GT; the high key stored on the page, then the page has split 
     * and we need to move right.  (If the scan key is equal to the high key, 
     * we might or might not need to move right; have to scan the page first 
     * anyway.) 
     * 
     * When nextkey = true: move right if the scan key is &GT;= page's high key. 
     * 
     * The page could even have split more than once, so scan as far as 
     * needed. 
     * 
     * We also have to move right if we followed a link that brought us to a 
     * dead page. 
     */ 
</span>    <a href="nbtsearch.c.html#LN225"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN217"><span class='Ref_to_Parameter'>nextkey</span></a> <span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nbtsearch.c.html#LN223"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN221"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN223"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN223"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN174"><span class='Ref_to_Macro'>P_RIGHTMOST</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finish any incomplete splits we encounter along the way. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN218"><span class='Ref_to_Parameter'>forupdate</span></a> <span class='Operator'>&& </span><a href="../../../include/access/nbtree.h.html#LN182"><span class='Ref_to_Macro'>P_INCOMPLETE_SPLIT</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN258"></a>            <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* upgrade our lock if necessary */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN220"><span class='Ref_to_Parameter'>access</span></a> <span class='Operator'>== </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN238"><span class='Ref_to_Const'>BT_WRITE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN182"><span class='Ref_to_Macro'>P_INCOMPLETE_SPLIT</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/access/nbtree.h.html#LN472"><span class='Ref_to_Proto'>_bt_finish_split</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN219"><span class='Ref_to_Parameter'>stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* re-acquire the lock in the right mode, and re-check */ 
</span>            <a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN482"><span class='Ref_to_Proto'>_bt_getbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN258"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN220"><span class='Ref_to_Parameter'>access</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if forupdate&&P_INCOMPLE... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN180"><span class='Ref_to_Macro'>P_IGNORE</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="nbtsearch.c.html#LN426"><span class='Ref_to_Func'>_bt_compare</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN215"><span class='Ref_to_Parameter'>keysz</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN216"><span class='Ref_to_Parameter'>scankey</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN223"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN202"><span class='Ref_to_Const'>P_HIKEY</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="nbtsearch.c.html#LN225"><span class='Ref_To_Local'>cmpval</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* step right one page */ 
</span>            <a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN220"><span class='Ref_to_Parameter'>access</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN180"><span class='Ref_to_Macro'>P_IGNORE</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN224"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"fell off the end of index \"%s\""</span><span class='Delimiter'>, 
</span>             <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN213"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="nbtsearch.c.html#LN214"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_moveright &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_binsrch() -- Do a binary search for a key on a particular page. 
 * 
 * The passed scankey must be an insertion-type scankey (see nbtree/README), 
 * but it can omit the rightmost column(s) of the index. 
 * 
 * When nextkey is false (the usual case), we are looking for the first 
 * item &GT;= scankey.  When nextkey is true, we are looking for the first 
 * item strictly greater than scankey. 
 * 
 * On a leaf page, _bt_binsrch() returns the OffsetNumber of the first 
 * key &GT;= given scankey, or &GT; scankey if nextkey is true.  (NOTE: in 
 * particular, this means it is possible to return a value 1 greater than the 
 * number of keys on the page, if the scankey is &GT; all keys on the page.) 
 * 
 * On an internal (non-leaf) page, _bt_binsrch() returns the OffsetNumber 
 * of the last key &LT; given scankey, or last key &LT;= given scankey if nextkey 
 * is true.  (Since _bt_compare treats the first data key of such a page as 
 * minus infinity, there will be at least one key &LT; scankey, so the result 
 * always points at one of the keys on the page.)  This key indicates the 
 * right place to descend to be sure we find all leaf keys &GT;= given scankey 
 * (or leaf keys &GT; given scankey when nextkey is true). 
 * 
 * This procedure is not responsible for walking right, it just examines 
 * the given page.  _bt_binsrch() has no lock or refcount side effects 
 * on the buffer. 
 */ 
</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> 
<a name="LN322"></a><span class='Declare_Function'>_bt_binsrch</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN323"></a>            <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, 
</span><a name="LN324"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>keysz</span><span class='Delimiter'>, 
</span><a name="LN325"></a>            <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>scankey</span><span class='Delimiter'>, 
</span><a name="LN326"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>nextkey</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN328"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN329"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN330"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>low</span><span class='Delimiter'>, 
</span><a name="LN331"></a>                <span class='Declare_Local'>high</span><span class='Delimiter'>; 
</span><a name="LN332"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>, 
</span><a name="LN333"></a>                <span class='Declare_Local'>cmpval</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN328"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN323"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN331"><span class='Ref_To_Local'>high</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are no keys on the page, return the first available slot. Note 
     * this covers two cases: the page is really empty (no keys), or it 
     * contains only a high key.  The latter case is possible after vacuuming. 
     * This can never happen on an internal page, however, since they are 
     * never empty (an internal page must have children). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN331"><span class='Ref_To_Local'>high</span></a> <span class='Operator'>&LT; </span><a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Binary search to find the first key on the page &GT;= scan key, or first 
     * key &GT; scankey when nextkey is true. 
     * 
     * For nextkey=false (cmpval=1), the loop invariant is: all slots before 
     * 'low' are &LT; scan key, all slots at or after 'high' are &GT;= scan key. 
     * 
     * For nextkey=true (cmpval=0), the loop invariant is: all slots before 
     * 'low' are &LT;= scan key, all slots at or after 'high' are &GT; scan key. 
     * 
     * We can fall out when high == low. 
     */ 
</span>    <a href="nbtsearch.c.html#LN331"><span class='Ref_To_Local'>high</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>                     <span class='Comment_Single_Line'>/* establish the loop invariant for high */ 
</span> 
    <a href="nbtsearch.c.html#LN333"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN326"><span class='Ref_to_Parameter'>nextkey</span></a> <span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* select comparison value */ 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN331"><span class='Ref_To_Local'>high</span></a> <span class='Operator'>&GT; </span><a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN369"></a>        <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>mid</span> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="nbtsearch.c.html#LN331"><span class='Ref_To_Local'>high</span></a> <span class='Operator'>- </span><a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We have low &LT;= mid &LT; high, so mid points at a real slot */ 
</span> 
        <a href="nbtsearch.c.html#LN332"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN426"><span class='Ref_to_Func'>_bt_compare</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN322"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN324"><span class='Ref_to_Parameter'>keysz</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN325"><span class='Ref_to_Parameter'>scankey</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN328"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN369"><span class='Ref_To_Local'>mid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN332"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT;= </span><a href="nbtsearch.c.html#LN333"><span class='Ref_To_Local'>cmpval</span></a><span class='Parentheses'>) 
</span>            <a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN369"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="nbtsearch.c.html#LN331"><span class='Ref_To_Local'>high</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN369"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * At this point we have high == low, but be careful: they could point 
     * past the last slot on the page. 
     * 
     * On a leaf page, we always return the first key &GT;= scan key (resp. &GT; 
     * scan key), which could be the last slot + 1. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN175"><span class='Ref_to_Macro'>P_ISLEAF</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * On a non-leaf page, return the last key &LT; scan key (resp. &LT;= scan key). 
     * There must be one if _bt_compare() is playing by the rules. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a> <span class='Operator'>&GT; </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN329"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/storage/off.h.html#LN54"><span class='Ref_to_Macro'>OffsetNumberPrev</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN330"><span class='Ref_To_Local'>low</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_binsrch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*---------- 
 *  _bt_compare() -- Compare scankey to a particular tuple on the page. 
 * 
 * The passed scankey must be an insertion-type scankey (see nbtree/README), 
 * but it can omit the rightmost column(s) of the index. 
 * 
 *  keysz: number of key conditions to be checked (might be less than the 
 *      number of index columns!) 
 *  page/offnum: location of btree item to be compared to. 
 * 
 *      This routine returns: 
 *          &LT;0 if scankey &LT; tuple at offnum; 
 *           0 if scankey == tuple at offnum; 
 *          &GT;0 if scankey &GT; tuple at offnum. 
 *      NULLs in the keys are treated as sortable values.  Therefore 
 *      "equality" does not necessarily mean that the item should be 
 *      returned to the caller as a matching key! 
 * 
 * CRUCIAL NOTE: on a non-leaf page, the first data key is assumed to be 
 * "minus infinity": this routine will always claim it is less than the 
 * scankey.  The actual key value stored (if any, which there probably isn't) 
 * does not matter.  This convention allows us to implement the Lehman and 
 * Yao convention that the first down-link pointer is before the first key. 
 * See backend/access/nbtree/README for details. 
 *---------- 
 */ 
</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN427"></a><span class='Declare_Function'>_bt_compare</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN428"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>keysz</span><span class='Delimiter'>, 
</span><a name="LN429"></a>            <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>scankey</span><span class='Delimiter'>, 
</span><a name="LN430"></a>            <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a> <span class='Declare_Parameter'>page</span><span class='Delimiter'>, 
</span><a name="LN431"></a>            <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN433"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>itupdesc</span> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN427"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN434"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN430"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN435"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN436"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Force result "&GT;" if target item is first data item on an internal page 
     * --- see NOTE above. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN175"><span class='Ref_to_Macro'>P_ISLEAF</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN434"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="nbtsearch.c.html#LN431"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>== </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN434"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN435"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN430"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN430"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN431"><span class='Ref_to_Parameter'>offnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The scan key is set up with the attribute number associated with each 
     * term in the key.  It is important that, if the index is multi-key, the 
     * scan contain the first k key attributes, and that they be in order.  If 
     * you think about how multi-key ordering works, you'll understand why 
     * this is. 
     * 
     * We don't test for violation of this condition here, however.  The 
     * initial setup for the index scan had better have gotten it right (see 
     * _bt_first). 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="nbtsearch.c.html#LN436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="nbtsearch.c.html#LN428"><span class='Ref_to_Parameter'>keysz</span></a><span class='Delimiter'>; </span><a href="nbtsearch.c.html#LN436"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN461"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN462"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN463"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN461"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN99"><span class='Ref_to_Macro'>index_getattr</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN435"><span class='Ref_To_Local'>itup</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN433"><span class='Ref_To_Local'>itupdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN462"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* see comments about NULLs handling in btbuild */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* key is NULL */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN462"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* NULL "=" NULL */ 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/nbtree.h.html#LN427"><span class='Ref_to_Const'>SK_BT_NULLS_FIRST</span></a><span class='Parentheses'>) 
</span>                <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* NULL "&LT;" NOT_NULL */ 
</span>            <span class='Control'>else</span> 
                <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* NULL "&GT;" NOT_NULL */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN462"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* key is NOT_NULL and item is NULL */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/nbtree.h.html#LN427"><span class='Ref_to_Const'>SK_BT_NULLS_FIRST</span></a><span class='Parentheses'>) 
</span>                <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* NOT_NULL "&GT;" NULL */ 
</span>            <span class='Control'>else</span> 
                <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* NOT_NULL "&LT;" NULL */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The sk_func needs to be passed the index value as left arg and 
             * the sk_argument as right arg (they might be of different 
             * types).  Since it is convenient for callers to think of 
             * _bt_compare as comparing the scankey to the index item, we have 
             * to flip the sign of the comparison result.  (Unless it's a DESC 
             * column, in which case we *don't* flip the sign.) 
             */ 
</span>            <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN70"><span class='Ref_to_Member'>sk_func</span></a><span class='Delimiter'>, 
</span>                                                     <a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN69"><span class='Ref_to_Member'>sk_collation</span></a><span class='Delimiter'>, 
</span>                                                     <a href="nbtsearch.c.html#LN461"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, 
</span>                                                     <a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/nbtree.h.html#LN426"><span class='Ref_to_Const'>SK_BT_DESC</span></a><span class='Parentheses'>))</span> 
                <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* if the keys are unequal, return the difference */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="nbtsearch.c.html#LN463"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN429"><span class='Ref_to_Parameter'>scankey</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=keysz;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* if we get here, the keys are equal */ 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_compare &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_first() -- Find the first item in a scan. 
 * 
 *      We need to be clever about the direction of scan, the search 
 *      conditions, and the tree ordering.  We find the first item (or, 
 *      if backwards scan, the last item) in the tree that satisfies the 
 *      qualifications in the scan key.  On success exit, the page containing 
 *      the current index tuple is pinned but not locked, and data about 
 *      the matching tuple(s) on the page has been loaded into so-&GT;currPos. 
 *      scan-&GT;xs_ctup.t_self is set to the heap TID of the current tuple, 
 *      and if requested, scan-&GT;xs_itup points to a copy of the index tuple. 
 * 
 * If there are no matching items in the index, we return FALSE, with no 
 * pins or locks held. 
 * 
 * Note that scan-&GT;keyData[], and the so-&GT;keyData[] scankey built from it, 
 * are both search-type scankeys (see nbtree/README for more about this). 
 * Within this routine, we build a temporary insertion-type scankey to use 
 * in locating the scan start position. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN535"></a><span class='Declare_Function'>_bt_first</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN537"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>; 
</span><a name="LN538"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN539"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN540"></a>    <a href="../../../include/access/nbtree.h.html#LN258"><span class='Ref_to_Typedef'>BTStack</span></a>     <span class='Declare_Local'>stack</span><span class='Delimiter'>; 
</span><a name="LN541"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span><span class='Delimiter'>; 
</span><a name="LN542"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strat</span><span class='Delimiter'>; 
</span><a name="LN543"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nextkey</span><span class='Delimiter'>; 
</span><a name="LN544"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>goback</span><span class='Delimiter'>; 
</span><a name="LN545"></a>    <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>startKeys</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN546"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>scankeys</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN547"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>notnullkeys</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN548"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>keysCount</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN549"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN550"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>status</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN551"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strat_total</span><span class='Delimiter'>; 
</span><a name="LN552"></a>    <a href="../../../include/access/nbtree.h.html#LN286"><span class='Ref_to_Struct'>BTScanPosItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>currItem</span><span class='Delimiter'>; 
</span><a name="LN553"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN349"><span class='Ref_to_Macro'>BTScanPosIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/pgstat.h.html#LN1262"><span class='Ref_to_Macro'>pgstat_count_index_scan</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Examine the scan keys and eliminate any redundant keys; also mark the 
     * keys that must be matched to continue the scan. 
     */ 
</span>    <a href="../../../include/access/nbtree.h.html#LN525"><span class='Ref_to_Proto'>_bt_preprocess_keys</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Quit now if _bt_preprocess_keys() discovered that the scan keys can 
     * never be satisfied (eg, x == 1 AND x &GT; 2). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN377"><span class='Ref_to_Member'>qual_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For parallel scans, get the starting page from shared state. If the 
     * scan has not started, proceed to find out first leaf page in the usual 
     * way while keeping other participating processes waiting.  If the scan 
     * has already begun, use the page number from the shared structure. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN138"><span class='Ref_to_Member'>parallel_scan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="nbtsearch.c.html#LN550"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN461"><span class='Ref_to_Proto'>_bt_parallel_seize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN553"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN550"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN553"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/access/nbtree.h.html#LN167"><span class='Ref_to_Const'>P_NONE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN553"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN33"><span class='Ref_to_Proto'>_bt_parallel_readpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN553"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="nbtsearch.c.html#LN1103"><span class='Ref_to_Label'>readcomplete</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Examine the scan keys to discover where we need to start the scan. 
     * 
     * We want to identify the keys that can be used as starting boundaries; 
     * these are =, &GT;, or &GT;= keys for a forward scan or =, &LT;, &LT;= keys for 
     * a backwards scan.  We can use keys for multiple attributes so long as 
     * the prior attributes had only =, &GT;= (resp. =, &LT;=) keys.  Once we accept 
     * a &GT; or &LT; boundary or find an attribute with no boundary (which can be 
     * thought of as the same as "&GT; -infinity"), we can't use keys for any 
     * attributes to its right, because it would break our simplistic notion 
     * of what initial positioning strategy to use. 
     * 
     * When the scan keys include cross-type operators, _bt_preprocess_keys 
     * may not be able to eliminate redundant keys; in such cases we will 
     * arbitrarily pick a usable one for each attribute.  This is correct 
     * but possibly not optimal behavior.  (For example, with keys like 
     * "x &GT;= 4 AND x &GT;= 5" we would elect to scan starting at x=4 when 
     * x=5 would be more efficient.)  Since the situation only arises given 
     * a poorly-worded query plus an incomplete opfamily, live with it. 
     * 
     * When both equality and inequality keys appear for a single attribute 
     * (again, only possible when cross-type operators appear), we *must* 
     * select one of the equality keys for the starting point, because 
     * _bt_checkkeys() will stop the scan as soon as an equality qual fails. 
     * For example, if we have keys like "x &GT;= 4 AND x = 10" and we elect to 
     * start at x=4, we will fail and stop before reaching x=10.  If multiple 
     * equality quals survive preprocessing, however, it doesn't matter which 
     * one we use --- by definition, they are either redundant or 
     * contradictory. 
     * 
     * Any regular (not SK_SEARCHNULL) key implies a NOT NULL qualifier. 
     * If the index stores nulls at the end of the index we'll be starting 
     * from, and we have no boundary key for the column (which means the key 
     * we deduced NOT NULL from is an inequality key that constrains the other 
     * end of the index), then we cons up an explicit SK_SEARCHNOTNULL key to 
     * use as a boundary key.  If we didn't do this, we might find ourselves 
     * traversing a lot of null entries at the start of the scan. 
     * 
     * In this loop, row-comparison keys are treated the same as keys on their 
     * first (leftmost) columns.  We'll add on lower-order columns of the row 
     * comparison below, if possible. 
     * 
     * The selected scan keys (at most one per index column) are remembered by 
     * storing their addresses into the local startKeys[] array. 
     *---------- 
     */ 
</span>    <a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a> <span class='Operator'>= </span><a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN378"><span class='Ref_to_Member'>numberOfKeys</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN645"></a>        <a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>curattr</span><span class='Delimiter'>; 
</span><a name="LN646"></a>        <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>chosen</span><span class='Delimiter'>; 
</span><a name="LN647"></a>        <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>impliesNN</span><span class='Delimiter'>; 
</span><a name="LN648"></a>        <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * chosen is the so-far-chosen key for the current attribute, if any. 
         * We don't cast the decision in stone until we reach keys for the 
         * next attribute. 
         */ 
</span>        <a href="nbtsearch.c.html#LN645"><span class='Ref_To_Local'>curattr</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Also remember any scankey that implies a NOT NULL constraint */ 
</span>        <a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Loop iterates from 0 to numberOfKeys inclusive; we use the last 
         * pass to handle after-last-key processing.  Actual exit from the 
         * loop is at one of the "break" statements below. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN379"><span class='Ref_to_Member'>keyData</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;; </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN378"><span class='Ref_to_Member'>numberOfKeys</span></a> <span class='Operator'>|| </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>!= </span><a href="nbtsearch.c.html#LN645"><span class='Ref_To_Local'>curattr</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Done looking at keys for curattr.  If we didn't find a 
                 * usable boundary key, see if we can deduce a NOT NULL key. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                    <span class='Parentheses'>((</span><a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/nbtree.h.html#LN427"><span class='Ref_to_Const'>SK_BT_NULLS_FIRST</span></a><span class='Parentheses'>) </span><span class='Operator'>? 
</span>                     <a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                     <a href="../../../include/access/sdir.h.html#LN40"><span class='Ref_to_Macro'>ScanDirectionIsBackward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Yes, so build the key in notnullkeys[keysCount] */ 
</span>                    <a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>= &</span><a href="nbtsearch.c.html#LN547"><span class='Ref_To_Local'>notnullkeys</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Delimiter'>]; 
</span>                    <a href="../common/scankey.c.html#LN30"><span class='Ref_to_Func'>ScanKeyEntryInitialize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN121"><span class='Ref_to_Const'>SK_SEARCHNOTNULL</span></a> <span class='Operator'>| </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a> <span class='Operator'>| 
</span>                                            <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& 
</span>                                          <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN426"><span class='Ref_to_Const'>SK_BT_DESC</span></a> <span class='Operator'>| </span><a href="../../../include/access/nbtree.h.html#LN427"><span class='Ref_to_Const'>SK_BT_NULLS_FIRST</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>, 
</span>                                           <a href="nbtsearch.c.html#LN645"><span class='Ref_To_Local'>curattr</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>((</span><a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/nbtree.h.html#LN427"><span class='Ref_to_Const'>SK_BT_NULLS_FIRST</span></a><span class='Parentheses'>)</span> <span class='Operator'>? 
</span>                                  <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a> <span class='Operator'>: 
</span>                                  <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span> <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if chosen==NULL&&implies... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * If we still didn't find a usable boundary key, quit; else 
                 * save the boundary key pointer in startKeys. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN545"><span class='Ref_To_Local'>startKeys</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Adjust strat_total, and quit if we have stored a &GT; or &LT; 
                 * key. 
                 */ 
</span>                <a href="nbtsearch.c.html#LN542"><span class='Ref_To_Local'>strat</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN542"><span class='Ref_To_Local'>strat</span></a> <span class='Operator'>!= </span><a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN542"><span class='Ref_To_Local'>strat</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN542"><span class='Ref_To_Local'>strat</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a> <span class='Operator'>|| 
</span>                        <a href="nbtsearch.c.html#LN542"><span class='Ref_To_Local'>strat</span></a> <span class='Operator'>== </span><a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Done if that was the last attribute, or if next key is not 
                 * in sequence (implying no boundary key is available for the 
                 * next attribute). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN378"><span class='Ref_to_Member'>numberOfKeys</span></a> <span class='Operator'>|| 
</span>                    <a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>!= </span><a href="nbtsearch.c.html#LN645"><span class='Ref_To_Local'>curattr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Reset for next attr. 
                 */ 
</span>                <a href="nbtsearch.c.html#LN645"><span class='Ref_To_Local'>curattr</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if i&GT;=so-&GT;numberOfKeys||... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Can we use this key as a starting boundary for this attr? 
             * 
             * If not, does it imply a NOT NULL constraint?  (Because 
             * SK_SEARCHNULL keys are always assigned BTEqualStrategyNumber, 
             * *any* inequality key works for that; we need not test.) 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN40"><span class='Ref_to_Macro'>ScanDirectionIsBackward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
                            <a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* override any non-equality choice */ 
</span>                    <a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
                            <a href="nbtsearch.c.html#LN646"><span class='Ref_To_Local'>chosen</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="nbtsearch.c.html#LN647"><span class='Ref_To_Local'>impliesNN</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN648"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cur-&GT;sk_strategy &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cur=so-&GT;keyData,i=0;;... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if so-&GT;numberOfKeys&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we found no usable boundary keys, we have to start from one end of 
     * the tree.  Walk down that edge to the first or last key, and scan from 
     * there. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN776"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN776"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN36"><span class='Ref_to_Proto'>_bt_endpoint</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN776"><span class='Ref_To_Local'>match</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No match, so mark (parallel) scan finished */ 
</span>            <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span> <a href="nbtsearch.c.html#LN776"><span class='Ref_To_Local'>match</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We want to start the scan somewhere within the index.  Set up an 
     * insertion scankey we can use to search for the boundary point we 
     * identified above.  The insertion scankey is built in the local 
     * scankeys[] array, using the keys identified by startKeys[]. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Delimiter'>; </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN798"></a>        <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>cur</span> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN545"><span class='Ref_To_Local'>startKeys</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>== </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN116"><span class='Ref_to_Const'>SK_ROW_HEADER</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Row comparison header: look to the first row member instead. 
             * 
             * The member scankeys are already in insertion format (ie, they 
             * have sk_func = 3-way-comparison function), but we have to watch 
             * out for nulls, which _bt_preprocess_keys didn't check. A null 
             * in the first row member makes the condition unmatchable, just 
             * like qual_ok = false. 
             */ 
</span><a name="LN813"></a>            <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a>     <span class='Declare_Local'>subkey</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN117"><span class='Ref_to_Const'>SK_ROW_MEMBER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            memcpy<span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN546"><span class='Ref_To_Local'>scankeys</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If the row comparison is the last positioning key we accepted, 
             * try to add additional keys from the lower-order row members. 
             * (If we accepted independent conditions on additional index 
             * columns, we use those instead --- doesn't seem worth trying to 
             * determine which is more restrictive.)  Note that this is OK 
             * even if the row comparison is of "&GT;" or "&LT;" type, because the 
             * condition applied to all but the last row member is effectively 
             * "&GT;=" or "&LT;=", and so the extra keys don't break the positioning 
             * scheme.  But, by the same token, if we aren't able to use all 
             * the row members, then the part of the row comparison that we 
             * did use has to be treated as just a "&GT;=" or "&LT;=" condition, and 
             * so we'd better adjust strat_total accordingly. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN839"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>used_all_subkeys</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN118"><span class='Ref_to_Const'>SK_ROW_END</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN117"><span class='Ref_to_Const'>SK_ROW_MEMBER</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>!= </span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* out-of-sequence, can't use it */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a> <span class='Operator'>!= </span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* wrong direction, can't use it */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN114"><span class='Ref_to_Const'>SK_ISNULL</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* can't use null keys */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a> <span class='Operator'>&LT; </span><a href="../../../include/pg_config_manual.h.html#LN45"><span class='Ref_to_Const'>INDEX_MAX_KEYS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    memcpy<span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN546"><span class='Ref_To_Local'>scankeys</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN813"><span class='Ref_To_Local'>subkey</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a> <span class='Operator'>& </span><a href="../../../include/access/skey.h.html#LN118"><span class='Ref_to_Const'>SK_ROW_END</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="nbtsearch.c.html#LN839"><span class='Ref_To_Local'>used_all_subkeys</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN839"><span class='Ref_To_Local'>used_all_subkeys</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span>                            <a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a> <span class='Operator'>= </span><a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span>                            <a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a> <span class='Operator'>= </span><a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* done with outer loop */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if i==keysCount-1 &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cur-&GT;sk_flags&SK_ROW_... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Ordinary comparison key.  Transform the search-style scan key 
             * to an insertion scan key by replacing the sk_func with the 
             * appropriate btree comparison function. 
             * 
             * If scankey operator is not a cross-type comparison, we can use 
             * the cached comparison function; otherwise gotta look it up in 
             * the catalogs.  (That can't lead to infinite recursion, since no 
             * indexscan initiated by syscache lookup will use cross-data-type 
             * operators.) 
             * 
             * We support the convention that sk_subtype == InvalidOid means 
             * the opclass input type; this is a hack to simplify life for 
             * ScanKeyInit(). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a> <span class='Operator'>== </span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>                <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN896"></a>                <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>procinfo</span><span class='Delimiter'>; 
</span> 
                <a href="nbtsearch.c.html#LN896"><span class='Ref_To_Local'>procinfo</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN174"><span class='Ref_to_Proto'>index_getprocinfo</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../common/scankey.c.html#LN99"><span class='Ref_to_Func'>ScanKeyEntryInitializeWithInfo</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN546"><span class='Ref_To_Local'>scankeys</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                               <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a><span class='Delimiter'>, 
</span>                                               <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/access/stratnum.h.html#LN23"><span class='Ref_to_Const'>InvalidStrategy</span></a><span class='Delimiter'>, 
</span>                                               <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Delimiter'>, 
</span>                                               <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN69"><span class='Ref_to_Member'>sk_collation</span></a><span class='Delimiter'>, 
</span>                                               <a href="nbtsearch.c.html#LN896"><span class='Ref_To_Local'>procinfo</span></a><span class='Delimiter'>, 
</span>                                               <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN910"></a>                <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Declare_Local'>cmp_proc</span><span class='Delimiter'>; 
</span> 
                <a href="nbtsearch.c.html#LN910"><span class='Ref_To_Local'>cmp_proc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN83"><span class='Ref_to_Proto'>get_opfamily_proc</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN181"><span class='Ref_to_Member'>rd_opfamily</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN910"><span class='Ref_To_Local'>cmp_proc</span></a><span class='Parentheses'>))</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"missing support function %d(%u,%u) for attribute %d of index \"%s\""</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/access/nbtree.h.html#LN228"><span class='Ref_to_Const'>BTORDER_PROC</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN182"><span class='Ref_to_Member'>rd_opcintype</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Delimiter'>, 
</span>                         <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../common/scankey.c.html#LN30"><span class='Ref_to_Func'>ScanKeyEntryInitialize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN546"><span class='Ref_To_Local'>scankeys</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN549"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                       <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN65"><span class='Ref_to_Member'>sk_flags</span></a><span class='Delimiter'>, 
</span>                                       <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/access/stratnum.h.html#LN23"><span class='Ref_to_Const'>InvalidStrategy</span></a><span class='Delimiter'>, 
</span>                                       <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a><span class='Delimiter'>, 
</span>                                       <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN69"><span class='Ref_to_Member'>sk_collation</span></a><span class='Delimiter'>, 
</span>                                       <a href="nbtsearch.c.html#LN910"><span class='Ref_To_Local'>cmp_proc</span></a><span class='Delimiter'>, 
</span>                                       <a href="nbtsearch.c.html#LN798"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;keysCount;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/*---------- 
     * Examine the selected initial-positioning strategy to determine exactly 
     * where we need to start the scan, and set flag variables to control the 
     * code below. 
     * 
     * If nextkey = false, _bt_search and _bt_binsrch will locate the first 
     * item &GT;= scan key.  If nextkey = true, they will locate the first 
     * item &GT; scan key. 
     * 
     * If goback = true, we will then step back one item, while if 
     * goback = false, we will start the scan on the located item. 
     *---------- 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Find first item &GT;= scankey, then back up one to arrive at last 
             * item &LT; scankey.  (Note: this positioning strategy is only used 
             * for a backward scan, so that is always the correct starting 
             * position.) 
             */ 
</span>            <a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Find first item &GT; scankey, then back up one to arrive at last 
             * item &LT;= scankey.  (Note: this positioning strategy is only used 
             * for a backward scan, so that is always the correct starting 
             * position.) 
             */ 
</span>            <a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If a backward scan was specified, need to start with last equal 
             * item not first one. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN40"><span class='Ref_to_Macro'>ScanDirectionIsBackward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This is the same as the &LT;= strategy.  We will check at the 
                 * end whether the found item is actually =. 
                 */ 
</span>                <a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This is the same as the &GT;= strategy.  We will check at the 
                 * end whether the found item is actually =. 
                 */ 
</span>                <a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Find first item &GT;= scankey.  (This is only used for forward 
             * scans.) 
             */ 
</span>            <a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Find first item &GT; scankey.  (This is only used for forward 
             * scans.) 
             */ 
</span>            <a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* can't get here, but keep compiler quiet */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strat_total: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN551"><span class='Ref_To_Local'>strat_total</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strat_total &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Use the manufactured insertion scan key to descend the tree and 
     * position ourselves on the target leaf page. 
     */ 
</span>    <a href="nbtsearch.c.html#LN540"><span class='Ref_To_Local'>stack</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN95"><span class='Ref_to_Func'>_bt_search</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN546"><span class='Ref_To_Local'>scankeys</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN539"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Delimiter'>, 
</span>                       <a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't need to keep the stack around... */ 
</span>    <a href="nbtutils.c.html#LN162"><span class='Ref_to_Func'>_bt_freestack</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN540"><span class='Ref_To_Local'>stack</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN539"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We only get here if the index is completely empty. Lock relation 
         * because nothing finer to lock exists. 
         */ 
</span>        <a href="../../../include/storage/predicate.h.html#LN50"><span class='Ref_to_Proto'>PredicateLockRelation</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * mark parallel scan as done, so that all the workers can finish 
         * their scan 
         */ 
</span>        <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/storage/predicate.h.html#LN51"><span class='Ref_to_Proto'>PredicateLockPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN539"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN38"><span class='Ref_to_Proto'>_bt_initialize_more_data</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* position to the precise item on the page */ 
</span>    <a href="nbtsearch.c.html#LN541"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN321"><span class='Ref_to_Func'>_bt_binsrch</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN537"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN539"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN548"><span class='Ref_To_Local'>keysCount</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN546"><span class='Ref_To_Local'>scankeys</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN543"><span class='Ref_To_Local'>nextkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If nextkey = false, we are positioned at the first item &GT;= scan key, or 
     * possibly at the end of a page on which all the existing items are less 
     * than the scan key and we know that everything on later pages is greater 
     * than or equal to scan key. 
     * 
     * If nextkey = true, we are positioned at the first item &GT; scan key, or 
     * possibly at the end of a page on which all the existing items are less 
     * than or equal to the scan key and we know that everything on later 
     * pages is greater than scan key. 
     * 
     * The actually desired starting point is either this item or the prior 
     * one, or in the end-of-page case it's the first item on the next page or 
     * the last item on this page.  Adjust the starting offset if needed. (If 
     * this results in an offset before the first item or after the last one, 
     * _bt_readpage will report no items found, and then we'll step to the 
     * next page as needed.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN544"><span class='Ref_To_Local'>goback</span></a><span class='Parentheses'>) 
</span>        <a href="nbtsearch.c.html#LN541"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN54"><span class='Ref_to_Macro'>OffsetNumberPrev</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN541"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* remember which buffer we have pinned, if any */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN349"><span class='Ref_to_Macro'>BTScanPosIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN539"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now load data from the first page of the scan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN27"><span class='Ref_to_Proto'>_bt_readpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN541"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * There's no actually-matching data on this page.  Try to advance to 
         * the next page.  Return false if there's no matching data at all. 
         */ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN31"><span class='Ref_to_Proto'>_bt_steppage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Drop the lock, and maybe the pin, on the current page */ 
</span>        <a href="nbtsearch.c.html#LN37"><span class='Ref_to_Proto'>_bt_drop_lock_and_maybe_pin</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<a name="LN1103"></a><span class='Label'>readcomplete</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* OK, itemIndex says what to return */ 
</span>    <a href="nbtsearch.c.html#LN552"><span class='Ref_To_Local'>currItem</span></a> <span class='Operator'>= &</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN327"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a><span class='Delimiter'>]; 
</span>    <a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN552"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN288"><span class='Ref_to_Member'>heapTid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>        <a href="nbtsearch.c.html#LN535"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN112"><span class='Ref_to_Member'>xs_itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) (</span><a href="nbtsearch.c.html#LN538"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN399"><span class='Ref_to_Member'>currTuples</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN552"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN290"><span class='Ref_to_Member'>tupleOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_first &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_next() -- Get the next item in a scan. 
 * 
 *      On entry, so-&GT;currPos describes the current page, which may be pinned 
 *      but is not locked, and so-&GT;currPos.itemIndex identifies which item was 
 *      previously returned. 
 * 
 *      On successful exit, scan-&GT;xs_ctup.t_self is set to the TID of the 
 *      next heap tuple, and if requested, scan-&GT;xs_itup points to a copy of 
 *      the index tuple.  so-&GT;currPos is updated as needed. 
 * 
 *      On failure exit (no more tuples), we release pin and set 
 *      so-&GT;currPos.buf to InvalidBuffer. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1128"></a><span class='Declare_Function'>_bt_next</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1130"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1131"></a>    <a href="../../../include/access/nbtree.h.html#LN286"><span class='Ref_to_Struct'>BTScanPosItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>currItem</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Advance to next tuple on current page; or if there's no more, try to 
     * step to the next page with data. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a> <span class='Operator'>&GT; </span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN324"><span class='Ref_to_Member'>lastItem</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN31"><span class='Ref_to_Proto'>_bt_steppage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>--</span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a> <span class='Operator'>&LT; </span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN323"><span class='Ref_to_Member'>firstItem</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN31"><span class='Ref_to_Proto'>_bt_steppage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, itemIndex says what to return */ 
</span>    <a href="nbtsearch.c.html#LN1131"><span class='Ref_To_Local'>currItem</span></a> <span class='Operator'>= &</span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN327"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a><span class='Delimiter'>]; 
</span>    <a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1131"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN288"><span class='Ref_to_Member'>heapTid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>        <a href="nbtsearch.c.html#LN1128"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN112"><span class='Ref_to_Member'>xs_itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) (</span><a href="nbtsearch.c.html#LN1130"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN399"><span class='Ref_to_Member'>currTuples</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN1131"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN290"><span class='Ref_to_Member'>tupleOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_next &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_readpage() -- Load data from current index page into so-&GT;currPos 
 * 
 * Caller must have pinned and read-locked so-&GT;currPos.buf; the buffer's state 
 * is not changed here.  Also, currPos.moreLeft and moreRight must be valid; 
 * they are updated as appropriate.  All other fields of so-&GT;currPos are 
 * initialized from scratch here. 
 * 
 * We scan the current page starting at offnum and moving in the indicated 
 * direction.  All items matching the scan keys are loaded into currPos.items. 
 * moreLeft or moreRight (as appropriate) is cleared if _bt_checkkeys reports 
 * that there can be no more matching tuples in the current scan direction. 
 * 
 * In the case of a parallel scan, caller must have called _bt_parallel_seize 
 * prior to calling this function; this function will invoke 
 * _bt_parallel_release before returning. 
 * 
 * Returns true if any matching items found on the page, false if none. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1183"></a><span class='Declare_Function'>_bt_readpage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1185"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1186"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1187"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN1188"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>minoff</span><span class='Delimiter'>; 
</span><a name="LN1189"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN1190"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>itemIndex</span><span class='Delimiter'>; 
</span><a name="LN1191"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span><a name="LN1192"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>continuescan</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must have the buffer pinned and locked, but the usual macro can't be 
     * used here; this function is what makes it good for currPos. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN1186"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1187"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1186"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* allow next page be processed by parallel worker */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN138"><span class='Ref_to_Member'>parallel_scan</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/access/nbtree.h.html#LN462"><span class='Ref_to_Proto'>_bt_parallel_release</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1187"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/access/nbtree.h.html#LN462"><span class='Ref_to_Proto'>_bt_parallel_release</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="nbtsearch.c.html#LN1188"><span class='Ref_To_Local'>minoff</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1187"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1189"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1186"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We note the buffer's block number so that we can release the pin later. 
     * This allows us to re-read the buffer if it is needed again for hinting. 
     */ 
</span>    <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN298"><span class='Ref_to_Member'>currPage</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We save the LSN of the page as we read it, so that we know whether it 
     * safe to apply LP_DEAD hints to the page later.  This allows us to drop 
     * the pin for MVCC scans, which allows vacuum to avoid blocking. 
     */ 
</span>    <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN297"><span class='Ref_to_Member'>lsn</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN362"><span class='Ref_to_Macro'>PageGetLSN</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1186"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we must save the page's right-link while scanning it; this tells us 
     * where to step right to after we're done with these items.  There is no 
     * corresponding need for the left-link, since splits always go right. 
     */ 
</span>    <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN299"><span class='Ref_to_Member'>nextPage</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1187"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initialize tuple workspace to empty */ 
</span>    <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN314"><span class='Ref_to_Member'>nextTupleOffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now that the current page has been made consistent, the macro should be 
     * good. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN332"><span class='Ref_to_Macro'>BTScanPosIsPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* load items[] in ascending order */ 
</span>        <a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1188"><span class='Ref_To_Local'>minoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>&LT;= </span><a href="nbtsearch.c.html#LN1189"><span class='Ref_To_Local'>maxoff</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nbtsearch.c.html#LN1191"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN526"><span class='Ref_to_Proto'>_bt_checkkeys</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1186"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1192"><span class='Ref_To_Local'>continuescan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1191"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* tuple passes all scan key conditions, so remember it */ 
</span>                <a href="nbtsearch.c.html#LN29"><span class='Ref_to_Proto'>_bt_saveitem</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1191"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1192"><span class='Ref_To_Local'>continuescan</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* there can't be any more matches, so stop */ 
</span>                <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN308"><span class='Ref_to_Member'>moreRight</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN323"><span class='Ref_to_Member'>firstItem</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN324"><span class='Ref_to_Member'>lastItem</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ScanDirectionIsForwar... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* load items[] in descending order */ 
</span>        <a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1189"><span class='Ref_To_Local'>maxoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>&GT;= </span><a href="nbtsearch.c.html#LN1188"><span class='Ref_To_Local'>minoff</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="nbtsearch.c.html#LN1191"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN526"><span class='Ref_to_Proto'>_bt_checkkeys</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1186"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1192"><span class='Ref_To_Local'>continuescan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1191"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* tuple passes all scan key conditions, so remember it */ 
</span>                <a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN29"><span class='Ref_to_Proto'>_bt_saveitem</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1191"><span class='Ref_To_Local'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1192"><span class='Ref_To_Local'>continuescan</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* there can't be any more matches, so stop */ 
</span>                <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN307"><span class='Ref_to_Member'>moreLeft</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN54"><span class='Ref_to_Macro'>OffsetNumberPrev</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1183"><span class='Ref_to_Parameter'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN323"><span class='Ref_to_Member'>firstItem</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1190"><span class='Ref_To_Local'>itemIndex</span></a><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN324"><span class='Ref_to_Member'>lastItem</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN136"><span class='Ref_to_Const'>MaxIndexTuplesPerPage</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN323"><span class='Ref_to_Member'>firstItem</span></a> <span class='Operator'>&LT;= </span><a href="nbtsearch.c.html#LN1185"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN324"><span class='Ref_to_Member'>lastItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_readpage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Save an index item into so-&GT;currPos.items[itemIndex] */ 
</span><span class='Keyword'>static void 
</span><a name="LN1312"></a><span class='Declare_Function'>_bt_saveitem</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Parameter'>so</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>itemIndex</span><span class='Delimiter'>, 
</span><a name="LN1313"></a>             <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offnum</span><span class='Delimiter'>, </span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a> <span class='Declare_Parameter'>itup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1315"></a>    <a href="../../../include/access/nbtree.h.html#LN286"><span class='Ref_to_Struct'>BTScanPosItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>currItem</span> <span class='Operator'>= &</span><a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN327"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>itemIndex</span></a><span class='Delimiter'>]; 
</span> 
    <a href="nbtsearch.c.html#LN1315"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN288"><span class='Ref_to_Member'>heapTid</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1313"><span class='Ref_to_Parameter'>itup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1315"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN289"><span class='Ref_to_Member'>indexOffset</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1313"><span class='Ref_to_Parameter'>offnum</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN399"><span class='Ref_to_Member'>currTuples</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1321"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>itupsz</span> <span class='Operator'>= </span><a href="../../../include/access/itup.h.html#LN69"><span class='Ref_to_Macro'>IndexTupleSize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1313"><span class='Ref_to_Parameter'>itup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN1315"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN290"><span class='Ref_to_Member'>tupleOffset</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN314"><span class='Ref_to_Member'>nextTupleOffset</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN399"><span class='Ref_to_Member'>currTuples</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN314"><span class='Ref_to_Member'>nextTupleOffset</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1313"><span class='Ref_to_Parameter'>itup</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1321"><span class='Ref_To_Local'>itupsz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1312"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN314"><span class='Ref_to_Member'>nextTupleOffset</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1321"><span class='Ref_To_Local'>itupsz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  _bt_steppage() -- Step to next page containing valid data for scan 
 * 
 * On entry, if so-&GT;currPos.buf is valid the buffer is pinned but not locked; 
 * if pinned, we'll drop the pin before moving to next page.  The buffer is 
 * not locked on entry. 
 * 
 * For success on a scan using a non-MVCC snapshot we hold a pin, but not a 
 * read lock, on that page.  If we do not hold the pin, we set so-&GT;currPos.buf 
 * to InvalidBuffer.  We return TRUE to indicate success. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1341"></a><span class='Declare_Function'>_bt_steppage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1343"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1344"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span> <span class='Operator'>= </span><a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>; 
</span><a name="LN1345"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>status</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN349"><span class='Ref_to_Macro'>BTScanPosIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Before leaving current page, deal with any killed items */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN392"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/access/nbtree.h.html#LN529"><span class='Ref_to_Proto'>_bt_killitems</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Before we modify currPos, make a copy of the page data if there was a 
     * mark position that needs it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN409"><span class='Ref_to_Member'>markItemIndex</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* bump pin on current buffer for assignment to mark buffer */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN332"><span class='Ref_to_Macro'>BTScanPosIsPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN177"><span class='Ref_to_Proto'>IncrBufferRefCount</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN413"><span class='Ref_to_Member'>markPos</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Delimiter'>, 
</span>               <a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN293"><span class='Ref_to_Struct'>BTScanPosData</span></a><span class='Delimiter'>, </span>items<span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN324"><span class='Ref_to_Member'>lastItem</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN286"><span class='Ref_to_Struct'>BTScanPosItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN400"><span class='Ref_to_Member'>markTuples</span></a><span class='Parentheses'>) 
</span>            memcpy<span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN400"><span class='Ref_to_Member'>markTuples</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN399"><span class='Ref_to_Member'>currTuples</span></a><span class='Delimiter'>, 
</span>                   <a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN314"><span class='Ref_to_Member'>nextTupleOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN413"><span class='Ref_to_Member'>markPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN409"><span class='Ref_to_Member'>markItemIndex</span></a><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN409"><span class='Ref_to_Member'>markItemIndex</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Walk right to the next page with data */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN138"><span class='Ref_to_Member'>parallel_scan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Seize the scan to get the next block number; if the scan has 
             * ended already, bail out. 
             */ 
</span>            <a href="nbtsearch.c.html#LN1345"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN461"><span class='Ref_to_Proto'>_bt_parallel_seize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1344"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1345"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* release the previous buffer, if pinned */ 
</span>                <a href="../../../include/access/nbtree.h.html#LN343"><span class='Ref_to_Macro'>BTScanPosUnpinIfPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Not parallel, so use the previously-saved nextPage link. */ 
</span>            <a href="nbtsearch.c.html#LN1344"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN299"><span class='Ref_to_Member'>nextPage</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Remember we left a page with data */ 
</span>        <a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN307"><span class='Ref_to_Member'>moreLeft</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* release the previous buffer, if pinned */ 
</span>        <a href="../../../include/access/nbtree.h.html#LN343"><span class='Ref_to_Macro'>BTScanPosUnpinIfPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ScanDirectionIsForwar... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Remember we left a page with data */ 
</span>        <a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN308"><span class='Ref_to_Member'>moreRight</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN138"><span class='Ref_to_Member'>parallel_scan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Seize the scan to get the current block number; if the scan has 
             * ended already, bail out. 
             */ 
</span>            <a href="nbtsearch.c.html#LN1345"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN461"><span class='Ref_to_Proto'>_bt_parallel_seize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1344"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/nbtree.h.html#LN343"><span class='Ref_to_Macro'>BTScanPosUnpinIfPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1345"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Not parallel, so just use our own notion of the current page */ 
</span>            <a href="nbtsearch.c.html#LN1344"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN298"><span class='Ref_to_Member'>currPage</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN32"><span class='Ref_to_Proto'>_bt_readnextpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1344"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Drop the lock, and maybe the pin, on the current page */ 
</span>    <a href="nbtsearch.c.html#LN37"><span class='Ref_to_Proto'>_bt_drop_lock_and_maybe_pin</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1341"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1343"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_steppage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_readnextpage() -- Read next page containing valid data for scan 
 * 
 * On success exit, so-&GT;currPos is updated to contain data from the next 
 * interesting page.  Caller is responsible to release lock and pin on 
 * buffer on success.  We return TRUE to indicate success. 
 * 
 * If there are no more matching records in the given direction, we drop all 
 * locks and pins, set so-&GT;currPos.buf to InvalidBuffer, and return FALSE. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1448"></a><span class='Declare_Function'>_bt_readnextpage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1450"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1451"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1452"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1453"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN1454"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>status</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * if we're at end of scan, give up and mark parallel scan as 
             * done, so that all the workers can finish their scan 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/access/nbtree.h.html#LN167"><span class='Ref_to_Const'>P_NONE</span></a> <span class='Operator'>|| !</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN308"><span class='Ref_to_Member'>moreRight</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* check for interrupts while we're not holding any buffer lock */ 
</span>            <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* step right one page */ 
</span>            <a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN482"><span class='Ref_to_Proto'>_bt_getbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1453"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* check for deleted page */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN180"><span class='Ref_to_Macro'>P_IGNORE</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1453"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/predicate.h.html#LN51"><span class='Ref_to_Proto'>PredicateLockPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* see if there are any matches on this page */ 
</span>                <span class='Comment_Multi_Line'>/* note that this will clear moreRight if we can stop */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN27"><span class='Ref_to_Proto'>_bt_readpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1453"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* nope, keep going */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN138"><span class='Ref_to_Member'>parallel_scan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="nbtsearch.c.html#LN1454"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN461"><span class='Ref_to_Proto'>_bt_parallel_seize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1454"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1453"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ScanDirectionIsForwar... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Should only happen in parallel cases, when some other backend 
         * advanced the scan. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN298"><span class='Ref_to_Member'>currPage</span></a> <span class='Operator'>!= </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/nbtree.h.html#LN343"><span class='Ref_to_Macro'>BTScanPosUnpinIfPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN298"><span class='Ref_to_Member'>currPage</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Walk left to the next page with data.  This is much more complex 
         * than the walk-right case because of the possibility that the page 
         * to our left splits while we are in flight to it, plus the 
         * possibility that the page we were on gets deleted after we leave 
         * it.  See nbtree/README for details. 
         * 
         * It might be possible to rearrange this code to have less overhead 
         * in pinning and locking, but that would require capturing the left 
         * pointer when the page is initially read, and using it here, along 
         * with big changes to _bt_walk_left() and the code below.  It is not 
         * clear whether this would be a win, since if the page immediately to 
         * the left splits after we read this page and before we step left, we 
         * would need to visit more pages than with the current code. 
         * 
         * Note that if we change the code so that we drop the pin for a scan 
         * which uses a non-MVCC snapshot, we will need to modify the code for 
         * walking left, to allow for the possibility that a referenced page 
         * has been deleted.  As long as the buffer is pinned or the snapshot 
         * is MVCC the page cannot move past the half-dead state to fully 
         * deleted. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN332"><span class='Ref_to_Macro'>BTScanPosIsPinned</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN482"><span class='Ref_to_Proto'>_bt_getbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN298"><span class='Ref_to_Member'>currPage</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Done if we know there are no matching keys to the left */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN307"><span class='Ref_to_Member'>moreLeft</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Step to next physical page */ 
</span>            <a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN35"><span class='Ref_to_Proto'>_bt_walk_left</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>, 
</span>                                            <a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* if we're physically at end of index, return failure */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>== </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/nbtree.h.html#LN463"><span class='Ref_to_Proto'>_bt_parallel_done</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Okay, we managed to move left to a non-deleted page. Done if 
             * it's not half-dead and contains matching tuples. Else loop back 
             * and do it all again. 
             */ 
</span>            <a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1453"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN180"><span class='Ref_to_Macro'>P_IGNORE</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1453"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="../../../include/storage/predicate.h.html#LN51"><span class='Ref_to_Proto'>PredicateLockPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* see if there are any matches on this page */ 
</span>                <span class='Comment_Multi_Line'>/* note that this will clear moreLeft if we can stop */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN27"><span class='Ref_to_Proto'>_bt_readpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1452"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * For parallel scans, get the last page scanned as it is quite 
             * possible that by the time we try to seize the scan, some other 
             * worker has already advanced the scan to a different page.  We 
             * must continue based on the latest page scanned by any worker. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN138"><span class='Ref_to_Member'>parallel_scan</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN1454"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN461"><span class='Ref_to_Proto'>_bt_parallel_seize</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN1454"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="nbtsearch.c.html#LN1450"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN482"><span class='Ref_to_Proto'>_bt_getbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1451"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1448"><span class='Ref_to_Parameter'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_readnextpage &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_parallel_readpage() -- Read current page containing valid data for scan 
 * 
 * On success, release lock and maybe pin on buffer.  We return TRUE to 
 * indicate success. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1614"></a><span class='Declare_Function'>_bt_parallel_readpage</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1616"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1614"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN38"><span class='Ref_to_Proto'>_bt_initialize_more_data</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1616"><span class='Ref_To_Local'>so</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1614"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN32"><span class='Ref_to_Proto'>_bt_readnextpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1614"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1614"><span class='Ref_to_Parameter'>blkno</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1614"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Drop the lock, and maybe the pin, on the current page */ 
</span>    <a href="nbtsearch.c.html#LN37"><span class='Ref_to_Proto'>_bt_drop_lock_and_maybe_pin</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1614"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1616"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * _bt_walk_left() -- step left one page, if possible 
 * 
 * The given buffer must be pinned and read-locked.  This will be dropped 
 * before stepping left.  On return, we have pin and read lock on the 
 * returned page, instead. 
 * 
 * Returns InvalidBuffer if there is no page to the left (no lock is held 
 * in that case). 
 * 
 * When working on a non-leaf level, it is possible for the returned page 
 * to be half-dead; the caller should check that condition and step left 
 * again if it's important. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> 
<a name="LN1644"></a><span class='Declare_Function'>_bt_walk_left</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1646"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1647"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1654"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>obknum</span><span class='Delimiter'>; 
</span><a name="LN1655"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>lblkno</span><span class='Delimiter'>; 
</span><a name="LN1656"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span><a name="LN1657"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tries</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if we're at end of tree, release buf and return failure */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN173"><span class='Ref_to_Macro'>P_LEFTMOST</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* remember original page we are stepping left from */ 
</span>        <a href="nbtsearch.c.html#LN1654"><span class='Ref_To_Local'>obknum</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* step left */ 
</span>        <a href="nbtsearch.c.html#LN1656"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1655"><span class='Ref_To_Local'>lblkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN55"><span class='Ref_to_Member'>btpo_prev</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/access/nbtree.h.html#LN485"><span class='Ref_to_Proto'>_bt_relbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* check for interrupts while we're not holding any buffer lock */ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN482"><span class='Ref_to_Proto'>_bt_getbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1656"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this isn't the page we want, walk right till we find what we 
         * want --- but go no more than four hops (an arbitrary limit). If we 
         * don't find the correct page by then, the most likely bet is that 
         * the original page got deleted and isn't in the sibling chain at all 
         * anymore, not that its left sibling got split more than four times. 
         * 
         * Note that it is correct to test P_ISDELETED not P_IGNORE here, 
         * because half-dead pages are still in the sibling chain.  Caller 
         * must reject half-dead pages if wanted. 
         */ 
</span>        <a href="nbtsearch.c.html#LN1657"><span class='Ref_To_Local'>tries</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN177"><span class='Ref_to_Macro'>P_ISDELETED</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a> <span class='Operator'>== </span><a href="nbtsearch.c.html#LN1654"><span class='Ref_To_Local'>obknum</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Found desired page, return it */ 
</span>                <span class='Control'>return</span> <a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN174"><span class='Ref_to_Macro'>P_RIGHTMOST</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>) </span><span class='Operator'>|| ++</span><a href="nbtsearch.c.html#LN1657"><span class='Ref_To_Local'>tries</span></a> <span class='Operator'>&GT; </span><span class='Number'>4</span><span class='Parentheses'>)</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1656"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1656"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Return to the original page to see what's up */ 
</span>        <a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1654"><span class='Ref_To_Local'>obknum</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN177"><span class='Ref_to_Macro'>P_ISDELETED</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * It was deleted.  Move right to first nondeleted page (there 
             * must be one); that is the page that has acquired the deleted 
             * one's keyspace, so stepping left from it will take us where we 
             * want to be. 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN174"><span class='Ref_to_Macro'>P_RIGHTMOST</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"fell off the end of index \"%s\""</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN1656"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1656"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1646"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/nbtree.h.html#LN177"><span class='Ref_to_Macro'>P_ISDELETED</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Now return to top of loop, resetting obknum to point to this 
             * nondeleted page, and try again. 
             */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if P_ISDELETED(opaque) &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * It wasn't deleted; the explanation had better be that the page 
             * to the left got split or deleted. Without this check, we'd go 
             * into an infinite loop if there's anything wrong. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1647"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN55"><span class='Ref_to_Member'>btpo_prev</span></a> <span class='Operator'>== </span><a href="nbtsearch.c.html#LN1655"><span class='Ref_To_Local'>lblkno</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find left sibling of block %u in index \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="nbtsearch.c.html#LN1654"><span class='Ref_To_Local'>obknum</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1644"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Okay to try again with new lblkno value */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>return</span> <a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_walk_left &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * _bt_get_endpoint() -- Find the first or last page on a given tree level 
 * 
 * If the index is empty, we will return InvalidBuffer; any other failure 
 * condition causes ereport().  We will not return a dead page. 
 * 
 * The returned buffer is pinned and read-locked. 
 */ 
</span><a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a> 
<a name="LN1763"></a><span class='Declare_Function'>_bt_get_endpoint</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>rightmost</span><span class='Delimiter'>, 
</span><a name="LN1764"></a>                 <a href="../../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1766"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1767"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1768"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN1769"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>offnum</span><span class='Delimiter'>; 
</span><a name="LN1770"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span><a name="LN1771"></a>    <a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a>  <span class='Declare_Local'>itup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are looking for a leaf page, okay to descend from fast root; 
     * otherwise better descend from true root.  (There is no point in being 
     * smarter about intermediate levels.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="nbtpage.c.html#LN102"><span class='Ref_to_Func'>_bt_getroot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="nbtpage.c.html#LN339"><span class='Ref_to_Func'>_bt_gettrueroot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1764"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we landed on a deleted page, step right to find a live page 
         * (there must be one).  Also, if we want the rightmost page, step 
         * right if needed to get to it (this could happen if the page split 
         * since we obtained a pointer to it). 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN180"><span class='Ref_to_Macro'>P_IGNORE</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>               <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rightmost</span></a> <span class='Operator'>&& !</span><a href="../../../include/access/nbtree.h.html#LN174"><span class='Ref_to_Macro'>P_RIGHTMOST</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="nbtsearch.c.html#LN1770"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN56"><span class='Ref_to_Member'>btpo_next</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1770"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>== </span><a href="../../../include/access/nbtree.h.html#LN167"><span class='Ref_to_Const'>P_NONE</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"fell off the end of index \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1770"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN263"><span class='Ref_to_Func'>TestForOldSnapshot</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1764"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Done? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN61"><span class='Ref_to_Member'>btpo</span></a><span class='Operator'>.</span>level <span class='Operator'>== </span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>level</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN61"><span class='Ref_to_Member'>btpo</span></a><span class='Operator'>.</span>level <span class='Operator'>&LT; </span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>level</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"btree level %u not found in index \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Descend to leftmost or rightmost child page */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rightmost</span></a><span class='Parentheses'>) 
</span>            <a href="nbtsearch.c.html#LN1769"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="nbtsearch.c.html#LN1769"><span class='Ref_To_Local'>offnum</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN1771"><span class='Ref_To_Local'>itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1769"><span class='Ref_To_Local'>offnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1770"><span class='Ref_To_Local'>blkno</span></a> <span class='Operator'>= </span><a href="../../../include/storage/itemptr.h.html#LN74"><span class='Ref_to_Macro'>ItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1771"><span class='Ref_To_Local'>itup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/itup.h.html#LN36"><span class='Ref_to_Member'>t_tid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN483"><span class='Ref_to_Proto'>_bt_relandgetbuf</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1763"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1770"><span class='Ref_To_Local'>blkno</span></a><span class='Delimiter'>, </span><a href="../../../include/access/nbtree.h.html#LN237"><span class='Ref_to_Const'>BT_READ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1768"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1767"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>return</span> <a href="nbtsearch.c.html#LN1766"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_get_endpoint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  _bt_endpoint() -- Find the first or last page in the index, and scan 
 * from there to the first key satisfying all the quals. 
 * 
 * This is used by _bt_first() to set up a scan when we've determined 
 * that the scan must start at the beginning or end of the index (for 
 * a forward or backward scan respectively).  Exit conditions are the 
 * same as for _bt_first(). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1845"></a><span class='Declare_Function'>_bt_endpoint</span><span class='Parentheses'>(</span><a href="../../../include/access/genam.h.html#LN85"><span class='Ref_to_Typedef'>IndexScanDesc</span></a> <span class='Declare_Parameter'>scan</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1847"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN88"><span class='Ref_to_Member'>indexRelation</span></a><span class='Delimiter'>; 
</span><a name="LN1848"></a>    <a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Local'>so</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN104"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span><a name="LN1849"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1850"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN1851"></a>    <a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a> <span class='Declare_Local'>opaque</span><span class='Delimiter'>; 
</span><a name="LN1852"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>start</span><span class='Delimiter'>; 
</span><a name="LN1853"></a>    <a href="../../../include/access/nbtree.h.html#LN286"><span class='Ref_to_Struct'>BTScanPosItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>currItem</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan down to the leftmost or rightmost leaf page.  This is a simplified 
     * version of _bt_search().  We don't maintain a stack since we know we 
     * won't need it. 
     */ 
</span>    <a href="nbtsearch.c.html#LN1849"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN510"><span class='Ref_to_Proto'>_bt_get_endpoint</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1847"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN40"><span class='Ref_to_Macro'>ScanDirectionIsBackward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1849"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Empty index. Lock the whole relation, as nothing finer to lock 
         * exists. 
         */ 
</span>        <a href="../../../include/storage/predicate.h.html#LN50"><span class='Ref_to_Proto'>PredicateLockRelation</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1847"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/nbtree.h.html#LN355"><span class='Ref_to_Macro'>BTScanPosInvalidate</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/predicate.h.html#LN51"><span class='Ref_to_Proto'>PredicateLockPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1847"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1849"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN89"><span class='Ref_to_Member'>xs_snapshot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1850"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1849"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="nbtsearch.c.html#LN1851"><span class='Ref_To_Local'>opaque</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN66"><span class='Ref_to_Typedef'>BTPageOpaque</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN322"><span class='Ref_to_Macro'>PageGetSpecialPointer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1850"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN175"><span class='Ref_to_Macro'>P_ISLEAF</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1851"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* There could be dead pages to the left, so not this: */ 
</span>        <span class='Comment_Multi_Line'>/* Assert(P_LEFTMOST(opaque)); */ 
</span> 
        <a href="nbtsearch.c.html#LN1852"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="../../../include/access/nbtree.h.html#LN204"><span class='Ref_to_Macro'>P_FIRSTDATAKEY</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1851"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN40"><span class='Ref_to_Macro'>ScanDirectionIsBackward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN174"><span class='Ref_to_Macro'>P_RIGHTMOST</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1851"><span class='Ref_To_Local'>opaque</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="nbtsearch.c.html#LN1852"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1850"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid scan direction: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1852"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* remember which buffer we have pinned */ 
</span>    <a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1849"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span> 
    <a href="nbtsearch.c.html#LN38"><span class='Ref_to_Proto'>_bt_initialize_more_data</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now load data from the first page of the scan. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN27"><span class='Ref_to_Proto'>_bt_readpage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1852"><span class='Ref_To_Local'>start</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * There's no actually-matching data on this page.  Try to advance to 
         * the next page.  Return false if there's no matching data at all. 
         */ 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN214"><span class='Ref_to_Proto'>LockBuffer</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN295"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/bufmgr.h.html#LN86"><span class='Ref_to_Const'>BUFFER_LOCK_UNLOCK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="nbtsearch.c.html#LN31"><span class='Ref_to_Proto'>_bt_steppage</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Drop the lock, and maybe the pin, on the current page */ 
</span>        <a href="nbtsearch.c.html#LN37"><span class='Ref_to_Proto'>_bt_drop_lock_and_maybe_pin</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, itemIndex says what to return */ 
</span>    <a href="nbtsearch.c.html#LN1853"><span class='Ref_To_Local'>currItem</span></a> <span class='Operator'>= &</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN327"><span class='Ref_to_Member'>items</span></a><span class='Delimiter'>[</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN325"><span class='Ref_to_Member'>itemIndex</span></a><span class='Delimiter'>]; 
</span>    <a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN118"><span class='Ref_to_Member'>xs_ctup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a> <span class='Operator'>= </span><a href="nbtsearch.c.html#LN1853"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN288"><span class='Ref_to_Member'>heapTid</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN94"><span class='Ref_to_Member'>xs_want_itup</span></a><span class='Parentheses'>) 
</span>        <a href="nbtsearch.c.html#LN1845"><span class='Ref_to_Parameter'>scan</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN112"><span class='Ref_to_Member'>xs_itup</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/itup.h.html#LN52"><span class='Ref_to_Typedef'>IndexTuple</span></a><span class='Parentheses'>) (</span><a href="nbtsearch.c.html#LN1848"><span class='Ref_To_Local'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN399"><span class='Ref_to_Member'>currTuples</span></a> <span class='Operator'>+ </span><a href="nbtsearch.c.html#LN1853"><span class='Ref_To_Local'>currItem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN290"><span class='Ref_to_Member'>tupleOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end _bt_endpoint &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * _bt_initialize_more_data() -- initialize moreLeft/moreRight appropriately 
 * for scan direction 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN1935"></a><span class='Declare_Function'>_bt_initialize_more_data</span><span class='Parentheses'>(</span><a href="../../../include/access/nbtree.h.html#LN416"><span class='Ref_to_Typedef'>BTScanOpaque</span></a> <span class='Declare_Parameter'>so</span><span class='Delimiter'>, </span><a href="../../../include/access/sdir.h.html#LN21"><span class='Ref_to_Enum'>ScanDirection</span></a> <span class='Declare_Parameter'>dir</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* initialize moreLeft/moreRight appropriately for scan direction */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/sdir.h.html#LN54"><span class='Ref_to_Macro'>ScanDirectionIsForward</span></a><span class='Parentheses'>(</span><a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>dir</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN307"><span class='Ref_to_Member'>moreLeft</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN308"><span class='Ref_to_Member'>moreRight</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN307"><span class='Ref_to_Member'>moreLeft</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN412"><span class='Ref_to_Member'>currPos</span></a><span class='Operator'>.</span><a href="../../../include/access/nbtree.h.html#LN308"><span class='Ref_to_Member'>moreRight</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN392"><span class='Ref_to_Member'>numKilled</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* just paranoia */ 
</span>    <a href="nbtsearch.c.html#LN1935"><span class='Ref_to_Parameter'>so</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/nbtree.h.html#LN409"><span class='Ref_to_Member'>markItemIndex</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* ditto */ 
</span><span class='Delimiter'>} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>