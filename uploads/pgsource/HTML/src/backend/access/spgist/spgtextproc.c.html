<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\spgist\spgtextproc.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\spgist\spgtextproc.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:30 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * spgtextproc.c 
 *    implementation of radix tree (compressed trie) over text 
 * 
 * In a text_ops SPGiST index, inner tuples can have a prefix which is the 
 * common prefix of all strings indexed under that tuple.  The node labels 
 * represent the next byte of the string(s) after the prefix.  Assuming we 
 * always use the longest possible prefix, we will get more than one node 
 * label unless the prefix length is restricted by SPGIST_MAX_PREFIX_LENGTH. 
 * 
 * To reconstruct the indexed string for any index entry, concatenate the 
 * inner-tuple prefixes and node labels starting at the root and working 
 * down to the leaf entry, then append the datum in the leaf entry. 
 * (While descending the tree, "level" is the number of bytes reconstructed 
 * so far.) 
 * 
 * However, there are two special cases for node labels: -1 indicates that 
 * there are no more bytes after the prefix-so-far, and -2 indicates that we 
 * had to split an existing allTheSame tuple (in such a case we have to create 
 * a node label that doesn't correspond to any string byte).  In either case, 
 * the node label does not contribute anything to the reconstructed string. 
 * 
 * Previously, we used a node label of zero for both special cases, but 
 * this was problematic because one can't tell whether a string ending at 
 * the current level can be pushed down into such a child node.  For 
 * backwards compatibility, we still support such node labels for reading; 
 * but no new entries will ever be pushed down into a zero-labeled child. 
 * No new entries ever get pushed into a -2-labeled child, either. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *          src/backend/access/spgist/spgtextproc.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/spgist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/pg_locale.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * In the worst case, an inner tuple in a text radix tree could have as many 
 * as 258 nodes (one for each possible byte value, plus the two special 
 * cases).  Each node can take 16 bytes on MAXALIGN=8 machines.  The inner 
 * tuple must fit on an index page of size BLCKSZ.  Rather than assuming we 
 * know the exact amount of overhead imposed by page headers, tuple headers, 
 * etc, we leave 100 bytes for that (the actual overhead should be no more 
 * than 56 bytes at this writing, so there is slop in this number). 
 * So we can safely create prefixes up to BLCKSZ - 258 * 16 - 100 bytes long. 
 * Unfortunately, because 258 * 16 is over 4K, there is no safe prefix length 
 * when BLCKSZ is less than 8K; it is always possible to get "SPGiST inner 
 * tuple size exceeds maximum" if there are too many distinct next-byte values 
 * at a given place in the tree.  Since use of nonstandard block sizes appears 
 * to be negligible in the field, we just live with that fact for now, 
 * choosing a max prefix size of 32 bytes when BLCKSZ is configured smaller 
 * than default. 
 */ 
</span><a name="LN67"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>SPGIST_MAX_PREFIX_LENGTH</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span>BLCKSZ <span class='Operator'>- </span><span class='Number'>258</span> <span class='Operator'>* </span><span class='Number'>16</span> <span class='Operator'>- </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>32</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* Struct for sorting values in picksplit */ 
</span><a name="LN70"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>spgNodePtr</span> 
<span class='Delimiter'>{ 
</span><a name="LN72"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>d</span><span class='Delimiter'>; 
</span><a name="LN73"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>i</span><span class='Delimiter'>; 
</span><a name="LN74"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>c</span><span class='Delimiter'>; 
</span><a name="LN75"></a>} <span class='Declare_Typedef'>spgNodePtr</span><span class='Delimiter'>; 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN79"></a><span class='Declare_Function'>spg_text_config</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* spgConfigIn *cfgin = (spgConfigIn *) PG_GETARG_POINTER(0); */ 
</span><a name="LN82"></a>    <a href="../../../include/access/spgist.h.html#LN42"><span class='Ref_to_Struct'>spgConfigOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cfg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN42"><span class='Ref_to_Struct'>spgConfigOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgtextproc.c.html#LN82"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN44"><span class='Ref_to_Member'>prefixType</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN82"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN45"><span class='Ref_to_Member'>labelType</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN82"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN46"><span class='Ref_to_Member'>canReturnData</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN82"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN47"><span class='Ref_to_Member'>longValuesOK</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* suffixing will shorten long values */ 
</span>    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Form a text datum from the given not-necessarily-null-terminated string, 
 * using short varlena header format if possible 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN96"></a><span class='Declare_Function'>formTextDatum</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>datalen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN98"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="spgtextproc.c.html#LN98"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN268"><span class='Ref_to_Const'>VARHDRSZ_SHORT</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/postgres.h.html#LN269"><span class='Ref_to_Const'>VARATT_SHORT_MAX</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/postgres.h.html#LN328"><span class='Ref_to_Macro'>SET_VARSIZE_SHORT</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN98"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN268"><span class='Ref_to_Const'>VARHDRSZ_SHORT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a><span class='Parentheses'>) 
</span>            memcpy<span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN98"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN268"><span class='Ref_to_Const'>VARHDRSZ_SHORT</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN98"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN98"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN96"><span class='Ref_to_Parameter'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN98"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end formTextDatum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find the length of the common prefix of a and b 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN121"></a><span class='Declare_Function'>commonPrefix</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lena</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lenb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN123"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN123"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN121"><span class='Ref_to_Parameter'>lena</span></a> <span class='Operator'>&& </span><a href="spgtextproc.c.html#LN123"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN121"><span class='Ref_to_Parameter'>lenb</span></a> <span class='Operator'>&& *</span><a href="spgtextproc.c.html#LN121"><span class='Ref_to_Parameter'>a</span></a> <span class='Operator'>== *</span><a href="spgtextproc.c.html#LN121"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN121"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN121"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN123"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="spgtextproc.c.html#LN123"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Binary search an array of int16 datums for a match to c 
 * 
 * On success, *i gets the match location; on failure, it gets where to insert 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN141"></a><span class='Declare_Function'>searchChar</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nodeLabels</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nNodes</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Parameter'>c</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN143"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>StopLow</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                <span class='Declare_Local'>StopHigh</span> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN141"><span class='Ref_to_Parameter'>nNodes</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN143"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN144"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN148"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>StopMiddle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN143"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN144"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN149"></a>        <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>middle</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN449"><span class='Ref_to_Macro'>DatumGetInt16</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN141"><span class='Ref_to_Parameter'>nodeLabels</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN148"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN141"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN149"><span class='Ref_To_Local'>middle</span></a><span class='Parentheses'>) 
</span>            <a href="spgtextproc.c.html#LN144"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN148"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN141"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>&GT; </span><a href="spgtextproc.c.html#LN149"><span class='Ref_To_Local'>middle</span></a><span class='Parentheses'>) 
</span>            <a href="spgtextproc.c.html#LN143"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN148"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="spgtextproc.c.html#LN141"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN148"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="spgtextproc.c.html#LN141"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN144"><span class='Ref_To_Local'>StopHigh</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end searchChar &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN167"></a><span class='Declare_Function'>spg_text_choose</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN169"></a>    <a href="../../../include/access/spgist.h.html#LN53"><span class='Ref_to_Struct'>spgChooseIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN53"><span class='Ref_to_Struct'>spgChooseIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN170"></a>    <a href="../../../include/access/spgist.h.html#LN74"><span class='Ref_to_Struct'>spgChooseOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN74"><span class='Ref_to_Struct'>spgChooseOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN171"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inText</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN55"><span class='Ref_to_Member'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN172"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>inStr</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN171"><span class='Ref_To_Local'>inText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN173"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inSize</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN171"><span class='Ref_To_Local'>inText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN174"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>prefixStr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN175"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>prefixSize</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN176"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>commonLen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN177"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>nodeChar</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN178"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for prefix match, set nodeChar to first byte after prefix */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN61"><span class='Ref_to_Member'>hasPrefix</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN183"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>prefixText</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN62"><span class='Ref_to_Member'>prefixDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgtextproc.c.html#LN174"><span class='Ref_To_Local'>prefixStr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN183"><span class='Ref_To_Local'>prefixText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN175"><span class='Ref_To_Local'>prefixSize</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN183"><span class='Ref_To_Local'>prefixText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN120"><span class='Ref_to_Func'>commonPrefix</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN172"><span class='Ref_To_Local'>inStr</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a><span class='Delimiter'>, 
</span>                                 <a href="spgtextproc.c.html#LN174"><span class='Ref_To_Local'>prefixStr</span></a><span class='Delimiter'>, 
</span>                                 <a href="spgtextproc.c.html#LN173"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a><span class='Delimiter'>, 
</span>                                 <a href="spgtextproc.c.html#LN175"><span class='Ref_To_Local'>prefixSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>== </span><a href="spgtextproc.c.html#LN175"><span class='Ref_To_Local'>prefixSize</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN173"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>&GT; </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>) 
</span>                <a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="spgtextproc.c.html#LN172"><span class='Ref_To_Local'>inStr</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Must split tuple because incoming value doesn't match prefix */ 
</span>            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN71"><span class='Ref_to_EnumConst'>spgSplitTuple</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixHasPrefix <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixHasPrefix <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixPrefixDatum <span class='Operator'>= 
</span>                    <a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN174"><span class='Ref_To_Local'>prefixStr</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixNNodes <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixNodeLabels <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixNodeLabels<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="spgtextproc.c.html#LN174"><span class='Ref_To_Local'>prefixStr</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>childNodeN <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN175"><span class='Ref_To_Local'>prefixSize</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>postfixHasPrefix <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>postfixHasPrefix <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>postfixPrefixDatum <span class='Operator'>= 
</span>                    <a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN174"><span class='Ref_To_Local'>prefixStr</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="spgtextproc.c.html#LN175"><span class='Ref_To_Local'>prefixSize</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if in-&GT;hasPrefix &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN173"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>&GT; </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="spgtextproc.c.html#LN172"><span class='Ref_To_Local'>inStr</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Look up nodeChar in the node label array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN140"><span class='Ref_to_Func'>searchChar</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN64"><span class='Ref_to_Member'>nodeLabels</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN63"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgtextproc.c.html#LN178"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Descend to existing node.  (If in-&GT;allTheSame, the core code will 
         * ignore our nodeN specification here, but that's OK.  We still have 
         * to provide the correct levelAdd and restDatum values, and those are 
         * the same regardless of which node gets chosen by core.) 
         */ 
</span><a name="LN256"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>levelAdd</span><span class='Delimiter'>; 
</span> 
        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN69"><span class='Ref_to_EnumConst'>spgMatchNode</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>nodeN <span class='Operator'>= </span><a href="spgtextproc.c.html#LN178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN256"><span class='Ref_To_Local'>levelAdd</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN176"><span class='Ref_To_Local'>commonLen</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="spgtextproc.c.html#LN256"><span class='Ref_To_Local'>levelAdd</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>levelAdd <span class='Operator'>= </span><a href="spgtextproc.c.html#LN256"><span class='Ref_To_Local'>levelAdd</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN173"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN256"><span class='Ref_To_Local'>levelAdd</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>restDatum <span class='Operator'>= 
</span>                <a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN172"><span class='Ref_To_Local'>inStr</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN256"><span class='Ref_To_Local'>levelAdd</span></a><span class='Delimiter'>, 
</span>                              <a href="spgtextproc.c.html#LN173"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN57"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN256"><span class='Ref_To_Local'>levelAdd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>restDatum <span class='Operator'>= 
</span>                <a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if searchChar(in-&GT;nodeLa... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN60"><span class='Ref_to_Member'>allTheSame</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Can't use AddNode action, so split the tuple.  The upper tuple has 
         * the same prefix as before and uses a dummy node label -2 for the 
         * lower tuple.  The lower tuple has no prefix and the same node 
         * labels as the original tuple. 
         * 
         * Note: it might seem tempting to shorten the upper tuple's prefix, 
         * if it has one, then use its last byte as label for the lower tuple. 
         * But that doesn't win since we know the incoming value matches the 
         * whole prefix: we'd just end up splitting the lower tuple again. 
         */ 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN71"><span class='Ref_to_EnumConst'>spgSplitTuple</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixHasPrefix <span class='Operator'>= </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN61"><span class='Ref_to_Member'>hasPrefix</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixPrefixDatum <span class='Operator'>= </span><a href="spgtextproc.c.html#LN169"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN62"><span class='Ref_to_Member'>prefixDatum</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixNNodes <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixNodeLabels <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>prefixNodeLabels<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>childNodeN <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>splitTuple<span class='Operator'>.</span>postfixHasPrefix <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if in-&GT;allTheSame &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Add a node for the not-previously-seen nodeChar value */ 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN70"><span class='Ref_to_EnumConst'>spgAddNode</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>addNode<span class='Operator'>.</span>nodeLabel <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN177"><span class='Ref_To_Local'>nodeChar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN170"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>addNode<span class='Operator'>.</span>nodeN <span class='Operator'>= </span><a href="spgtextproc.c.html#LN178"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_text_choose &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* qsort comparator to sort spgNodePtr structs by "c" */ 
</span><span class='Keyword'>static int 
</span><a name="LN307"></a><span class='Declare_Function'>cmpNodePtr</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN309"></a>    <span class='Keyword'>const </span><a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>aa</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgtextproc.c.html#LN307"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN310"></a>    <span class='Keyword'>const </span><a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgtextproc.c.html#LN307"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="spgtextproc.c.html#LN309"><span class='Ref_To_Local'>aa</span></a><span class='Operator'>-&GT;</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN310"><span class='Ref_To_Local'>bb</span></a><span class='Operator'>-&GT;</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN316"></a><span class='Declare_Function'>spg_text_picksplit</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN318"></a>    <a href="../../../include/access/spgist.h.html#LN110"><span class='Ref_to_Struct'>spgPickSplitIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN110"><span class='Ref_to_Struct'>spgPickSplitIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN319"></a>    <a href="../../../include/access/spgist.h.html#LN117"><span class='Ref_to_Struct'>spgPickSplitOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN117"><span class='Ref_to_Struct'>spgPickSplitOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN320"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>text0</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN322"></a>                <span class='Declare_Local'>commonLen</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nodes</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify longest common prefix, if any */ 
</span>    <a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN320"><span class='Ref_To_Local'>text0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a> <span class='Operator'>&& </span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN329"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>texti</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN330"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN120"><span class='Ref_to_Func'>commonPrefix</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN320"><span class='Ref_To_Local'>text0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN329"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN320"><span class='Ref_To_Local'>text0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN329"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN330"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>) 
</span>            <a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN330"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Limit the prefix length, if necessary, to ensure that the resulting 
     * inner tuple will fit on a page. 
     */ 
</span>    <a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN67"><span class='Ref_to_Const'>SPGIST_MAX_PREFIX_LENGTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set node prefix to be that string, if it's not empty */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN119"><span class='Ref_to_Member'>hasPrefix</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN119"><span class='Ref_to_Member'>hasPrefix</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN120"><span class='Ref_to_Member'>prefixDatum</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN320"><span class='Ref_To_Local'>text0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the node label (first non-common byte) from each value */ 
</span>    <a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN70"><span class='Ref_to_Struct'>spgNodePtr</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN361"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>texti</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>&LT; </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN361"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>))</span> 
            <a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN361"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* use -1 if string is all common */ 
</span>        <a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN73"><span class='Ref_to_Member'>i</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN72"><span class='Ref_to_Member'>d</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sort by label values so that we can group the values into nodes.  This 
     * also ensures that the nodes are ordered by label value, allowing the 
     * use of binary search in searchChar. 
     */ 
</span>    <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN306"><span class='Ref_to_Func'>cmpNodePtr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And emit results */ 
</span>    <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN122"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN123"><span class='Ref_to_Member'>nodeLabels</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN125"><span class='Ref_to_Member'>mapTuplesToNodes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN126"><span class='Ref_to_Member'>leafTupleDatums</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN318"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN386"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>texti</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN72"><span class='Ref_to_Member'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN387"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>leafD</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a> <span class='Operator'>!= </span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN123"><span class='Ref_to_Member'>nodeLabels</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN122"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN74"><span class='Ref_to_Member'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN122"><span class='Ref_to_Member'>nNodes</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>&LT; </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN386"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>))</span> 
            <a href="spgtextproc.c.html#LN387"><span class='Ref_To_Local'>leafD</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN386"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN386"><span class='Ref_To_Local'>texti</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="spgtextproc.c.html#LN322"><span class='Ref_To_Local'>commonLen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="spgtextproc.c.html#LN387"><span class='Ref_To_Local'>leafD</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN95"><span class='Ref_to_Func'>formTextDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN126"><span class='Ref_to_Member'>leafTupleDatums</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN73"><span class='Ref_to_Member'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spgtextproc.c.html#LN387"><span class='Ref_To_Local'>leafD</span></a><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN125"><span class='Ref_to_Member'>mapTuplesToNodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN323"><span class='Ref_To_Local'>nodes</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN321"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="spgtextproc.c.html#LN73"><span class='Ref_to_Member'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spgtextproc.c.html#LN319"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN122"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;in-&GT;nTuples;i++ &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_text_picksplit &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN409"></a><span class='Declare_Function'>spg_text_inner_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN411"></a>    <a href="../../../include/access/spgist.h.html#LN132"><span class='Ref_to_Struct'>spgInnerConsistentIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN132"><span class='Ref_to_Struct'>spgInnerConsistentIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN412"></a>    <a href="../../../include/access/spgist.h.html#LN152"><span class='Ref_to_Struct'>spgInnerConsistentOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN152"><span class='Ref_to_Struct'>spgInnerConsistentOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN413"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>collate_is_c</span> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN50"><span class='Ref_to_Proto'>lc_collate_is_c</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span><a name="LN414"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>reconstructedValue</span><span class='Delimiter'>; 
</span><a name="LN415"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>reconstrText</span><span class='Delimiter'>; 
</span><a name="LN416"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxReconstrLen</span><span class='Delimiter'>; 
</span><a name="LN417"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>prefixText</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>prefixSize</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN419"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reconstruct values represented at this tuple, including parent data, 
     * prefix of this tuple if any, and the node label if it's non-dummy. 
     * in-&GT;level should be the length of the previously reconstructed value, 
     * and the number of bytes added here is prefixSize or prefixSize + 1. 
     * 
     * Note: we assume that in-&GT;reconstructedValue isn't toasted and doesn't 
     * have a short varlena header.  This is okay because it must have been 
     * created by a previous invocation of this routine, and we always emit 
     * long-format reconstructed values. 
     */ 
</span>    <a href="spgtextproc.c.html#LN414"><span class='Ref_To_Local'>reconstructedValue</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN137"><span class='Ref_to_Member'>reconstructedValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN414"><span class='Ref_To_Local'>reconstructedValue</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>: 
</span>           <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN414"><span class='Ref_To_Local'>reconstructedValue</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN146"><span class='Ref_to_Member'>hasPrefix</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN417"><span class='Ref_To_Local'>prefixText</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN147"><span class='Ref_to_Member'>prefixDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN418"><span class='Ref_To_Local'>prefixSize</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN417"><span class='Ref_To_Local'>prefixText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a> <span class='Operator'>+= </span><a href="spgtextproc.c.html#LN418"><span class='Ref_To_Local'>prefixSize</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN414"><span class='Ref_To_Local'>reconstructedValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN418"><span class='Ref_To_Local'>prefixSize</span></a><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Parentheses'>))</span> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a><span class='Delimiter'>, 
</span>               <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN417"><span class='Ref_To_Local'>prefixText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="spgtextproc.c.html#LN418"><span class='Ref_To_Local'>prefixSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* last byte of reconstrText will be filled in below */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan the child nodes.  For each one, complete the reconstructed value 
     * and see if it's consistent with the query.  If so, emit an entry into 
     * the output arrays. 
     */ 
</span>    <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN155"><span class='Ref_to_Member'>nodeNumbers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN156"><span class='Ref_to_Member'>levelAdds</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN157"><span class='Ref_to_Member'>reconstructedValues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN419"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN419"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN419"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN469"></a>        <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>nodeChar</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN449"><span class='Ref_to_Macro'>DatumGetInt16</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN149"><span class='Ref_to_Member'>nodeLabels</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN419"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN470"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>thisLen</span><span class='Delimiter'>; 
</span><a name="LN471"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN472"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If nodeChar is a dummy value, don't include it in data */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN469"><span class='Ref_To_Local'>nodeChar</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="spgtextproc.c.html#LN470"><span class='Ref_To_Local'>thisLen</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spgtextproc.c.html#LN469"><span class='Ref_To_Local'>nodeChar</span></a><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN470"><span class='Ref_To_Local'>thisLen</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN416"><span class='Ref_To_Local'>maxReconstrLen</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN472"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN472"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN135"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN472"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN485"></a>            <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN472"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Delimiter'>; 
</span><a name="LN486"></a>            <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inText</span><span class='Delimiter'>; 
</span><a name="LN487"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>inSize</span><span class='Delimiter'>; 
</span><a name="LN488"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If it's a collation-aware operator, but the collation is C, we 
             * can treat it as non-collation-aware.  With non-C collation we 
             * need to traverse whole tree :-( so there's no point in making 
             * any check here.  (Note also that our reconstructed value may 
             * well end with a partial multibyte character, so that applying 
             * any encoding-sensitive test to it would be risky anyhow.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN485"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>&GT; </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN413"><span class='Ref_To_Local'>collate_is_c</span></a><span class='Parentheses'>) 
</span>                    <a href="spgtextproc.c.html#LN485"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>-= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="spgtextproc.c.html#LN486"><span class='Ref_To_Local'>inText</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN472"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN487"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN486"><span class='Ref_To_Local'>inText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="spgtextproc.c.html#LN488"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN486"><span class='Ref_To_Local'>inText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN487"><span class='Ref_To_Local'>inSize</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN470"><span class='Ref_To_Local'>thisLen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN485"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN488"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="spgtextproc.c.html#LN471"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN488"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="spgtextproc.c.html#LN487"><span class='Ref_To_Local'>inSize</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN470"><span class='Ref_To_Local'>thisLen</span></a><span class='Parentheses'>) 
</span>                        <a href="spgtextproc.c.html#LN471"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN488"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="spgtextproc.c.html#LN471"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, 
</span>                         <a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN472"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spgtextproc.c.html#LN471"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* no need to consider remaining conditions */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;in-&GT;nkeys;j++ &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN471"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN155"><span class='Ref_to_Member'>nodeNumbers</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spgtextproc.c.html#LN419"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN156"><span class='Ref_to_Member'>levelAdds</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spgtextproc.c.html#LN470"><span class='Ref_To_Local'>thisLen</span></a> <span class='Operator'>- </span><a href="spgtextproc.c.html#LN411"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN141"><span class='Ref_to_Member'>level</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN470"><span class='Ref_To_Local'>thisLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN157"><span class='Ref_to_Member'>reconstructedValues</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN415"><span class='Ref_To_Local'>reconstrText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgtextproc.c.html#LN412"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;in-&GT;nNodes;i++ &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_text_inner_consistent &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN553"></a><span class='Declare_Function'>spg_text_leaf_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN555"></a>    <a href="../../../include/access/spgist.h.html#LN164"><span class='Ref_to_Struct'>spgLeafConsistentIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN164"><span class='Ref_to_Struct'>spgLeafConsistentIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN556"></a>    <a href="../../../include/access/spgist.h.html#LN177"><span class='Ref_to_Struct'>spgLeafConsistentOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN177"><span class='Ref_to_Struct'>spgLeafConsistentOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN557"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>level</span> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN171"><span class='Ref_to_Member'>level</span></a><span class='Delimiter'>; 
</span><a name="LN558"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>leafValue</span><span class='Delimiter'>, 
</span><a name="LN559"></a>               <span class='Operator'>*</span><span class='Declare_Local'>reconstrValue</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN560"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fullValue</span><span class='Delimiter'>; 
</span><a name="LN561"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fullLen</span><span class='Delimiter'>; 
</span><a name="LN562"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN563"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* all tests are exact */ 
</span>    <a href="spgtextproc.c.html#LN556"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN180"><span class='Ref_to_Member'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="spgtextproc.c.html#LN558"><span class='Ref_To_Local'>leafValue</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN174"><span class='Ref_to_Member'>leafDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* As above, in-&GT;reconstructedValue isn't toasted or short. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN169"><span class='Ref_to_Member'>reconstructedValue</span></a><span class='Parentheses'>))</span> 
        <a href="spgtextproc.c.html#LN559"><span class='Ref_To_Local'>reconstrValue</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN169"><span class='Ref_to_Member'>reconstructedValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN559"><span class='Ref_To_Local'>reconstrValue</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>: 
</span>           <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN559"><span class='Ref_To_Local'>reconstrValue</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reconstruct the full string represented by this leaf tuple */ 
</span>    <a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN558"><span class='Ref_To_Local'>leafValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN558"><span class='Ref_To_Local'>leafValue</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN559"><span class='Ref_To_Local'>reconstrValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN556"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN179"><span class='Ref_to_Member'>leafValue</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN559"><span class='Ref_To_Local'>reconstrValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN586"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fullText</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN586"><span class='Ref_To_Local'>fullText</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN586"><span class='Ref_To_Local'>fullText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a><span class='Parentheses'>) 
</span>            memcpy<span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN559"><span class='Ref_To_Local'>reconstrValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN558"><span class='Ref_To_Local'>leafValue</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            memcpy<span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a> <span class='Operator'>+ </span><a href="spgtextproc.c.html#LN557"><span class='Ref_To_Local'>level</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN558"><span class='Ref_To_Local'>leafValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN558"><span class='Ref_To_Local'>leafValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spgtextproc.c.html#LN556"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN179"><span class='Ref_to_Member'>leafValue</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN586"><span class='Ref_To_Local'>fullText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Perform the required comparison(s) */ 
</span>    <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN563"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN563"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN167"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="spgtextproc.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN602"></a>        <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN166"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Delimiter'>; 
</span><a name="LN603"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN166"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN604"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>queryLen</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN603"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN605"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN602"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>&GT; </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Collation-aware comparison */ 
</span>            <a href="spgtextproc.c.html#LN602"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>-= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If asserts enabled, verify encoding of reconstructed string */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../parser/scan.l.html#LN546"><span class='Ref_to_Proto'>pg_verifymbstr</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/varlena.h.html#LN18"><span class='Ref_to_Proto'>varstr_cmp</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN604"><span class='Ref_To_Local'>queryLen</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN603"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN604"><span class='Ref_To_Local'>queryLen</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Non-collation-aware comparison */ 
</span>            <a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN560"><span class='Ref_To_Local'>fullValue</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN603"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN604"><span class='Ref_To_Local'>queryLen</span></a><span class='Delimiter'>, </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN604"><span class='Ref_To_Local'>queryLen</span></a> <span class='Operator'>&GT; </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>) 
</span>                <a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN604"><span class='Ref_To_Local'>queryLen</span></a> <span class='Operator'>&LT; </span><a href="spgtextproc.c.html#LN561"><span class='Ref_To_Local'>fullLen</span></a><span class='Parentheses'>) 
</span>                <a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN602"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Operator'>: 
</span>                <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Operator'>: 
</span>                <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Operator'>: 
</span>                <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN605"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized strategy number: %d"</span><span class='Delimiter'>, 
</span>                     <a href="spgtextproc.c.html#LN555"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN166"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="spgtextproc.c.html#LN563"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no need to consider remaining conditions */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;in-&GT;nkeys;j++ &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="spgtextproc.c.html#LN562"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_text_leaf_consistent &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>