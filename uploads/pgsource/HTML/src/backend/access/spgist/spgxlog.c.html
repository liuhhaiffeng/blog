<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\access\spgist\spgxlog.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\access\spgist\spgxlog.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:30 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * spgxlog.c 
 *    WAL replay logic for SP-GiST 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *           src/backend/access/spgist/spgxlog.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/bufmask.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/spgist_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/spgxlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlogutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/standby.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
 
 
<a name="LN26"></a><span class='Keyword'>static </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>opCtx</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* working memory for operations */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Prepare a dummy SpGistState, with just the minimum info needed for replay. 
 * 
 * At present, all we need is enough info to support spgFormDeadTuple(), 
 * plus the isBuild flag. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN36"></a><span class='Declare_Function'>fillFakeState</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN117"><span class='Ref_to_Struct'>SpGistState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/access/spgxlog.h.html#LN35"><span class='Ref_to_Struct'>spgxlogState</span></a> <span class='Declare_Parameter'>stateSrc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    memset<span class='Parentheses'>(</span><a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN127"><span class='Ref_to_Member'>myXid</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>stateSrc</span></a><span class='Operator'>.</span><a href="../../../include/access/spgxlog.h.html#LN37"><span class='Ref_to_Member'>myXid</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN128"><span class='Ref_to_Member'>isBuild</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>stateSrc</span></a><span class='Operator'>.</span><a href="../../../include/access/spgxlog.h.html#LN38"><span class='Ref_to_Member'>isBuild</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN36"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN125"><span class='Ref_to_Member'>deadTupleStorage</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN328"><span class='Ref_to_Const'>SGDTSIZE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Add a leaf tuple, or replace an existing placeholder tuple.  This is used 
 * to replay SpGistPageAddNewItem() operations.  If the offset points at an 
 * existing tuple, it had better be a placeholder tuple. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN51"></a><span class='Declare_Function'>addOrReplaceTuple</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a> <span class='Declare_Parameter'>page</span><span class='Delimiter'>, </span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>size</span><span class='Delimiter'>, </span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Parameter'>offset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN55"></a>        <a href="../../../include/access/spgist_private.h.html#LN326"><span class='Ref_to_Typedef'>SpGistDeadTuple</span></a> <span class='Declare_Local'>dt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN326"><span class='Ref_to_Typedef'>SpGistDeadTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN55"><span class='Ref_To_Local'>dt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN319"><span class='Ref_to_Member'>tupstate</span></a> <span class='Operator'>!= </span><a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPGiST tuple to be replaced is not a placeholder"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN55"><span class='Ref_to_Macro'>SpGistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nPlaceholder <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/spgist_private.h.html#LN55"><span class='Ref_to_Macro'>SpGistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nPlaceholder<span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN430"><span class='Ref_to_Proto'>PageIndexTupleDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>size</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item of size %u to SPGiST index page"</span><span class='Delimiter'>, 
</span>             <a href="spgxlog.c.html#LN51"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end addOrReplaceTuple &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN75"></a><span class='Declare_Function'>spgRedoCreateIndex</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN77"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN75"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN78"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN79"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN75"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/spgist_private.h.html#LN24"><span class='Ref_to_Const'>SPGIST_METAPAGE_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/spgist_private.h.html#LN391"><span class='Ref_to_Proto'>SpGistInitMetapage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN77"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN75"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/spgist_private.h.html#LN25"><span class='Ref_to_Const'>SPGIST_ROOT_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN52"><span class='Ref_to_Const'>SPGIST_LEAF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN77"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN75"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN187"><span class='Ref_to_Proto'>BufferGetBlockNumber</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/spgist_private.h.html#LN26"><span class='Ref_to_Const'>SPGIST_NULL_BLKNO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN52"><span class='Ref_to_Const'>SPGIST_LEAF</span></a> <span class='Operator'>| </span><a href="../../../include/access/spgist_private.h.html#LN53"><span class='Ref_to_Const'>SPGIST_NULLS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN79"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN77"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN78"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoCreateIndex &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN107"></a><span class='Declare_Function'>spgRedoAddLeaf</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN109"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN107"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN110"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN107"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a>    <a href="../../../include/access/spgxlog.h.html#LN45"><span class='Ref_to_Struct'>spgxlogAddLeaf</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN45"><span class='Ref_to_Struct'>spgxlogAddLeaf</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN110"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN112"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>leafTuple</span><span class='Delimiter'>; 
</span><a name="LN113"></a>    <a href="../../../include/access/spgist_private.h.html#LN289"><span class='Ref_to_Struct'>SpGistLeafTupleData</span></a> <span class='Declare_Local'>leafTupleHdr</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <a href="../../../include/access/xlogutils.h.html#LN26"><span class='Ref_to_Typedef'>XLogRedoAction</span></a> <span class='Declare_Local'>action</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN110"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN45"><span class='Ref_to_Struct'>spgxlogAddLeaf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN112"><span class='Ref_To_Local'>leafTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN110"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the leaf tuple is unaligned, so make a copy to access its header */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN113"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN112"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN289"><span class='Ref_to_Struct'>SpGistLeafTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In normal operation we would have both current and parent pages locked 
     * simultaneously; but in WAL replay it should be safe to update the leaf 
     * page before updating the parent. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN47"><span class='Ref_to_Member'>newPage</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN107"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, 
</span>                     <a href="../../../include/access/spgist_private.h.html#LN52"><span class='Ref_to_Const'>SPGIST_LEAF</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN48"><span class='Ref_to_Member'>storesNulls</span></a> <span class='Operator'>? </span><a href="../../../include/access/spgist_private.h.html#LN53"><span class='Ref_to_Const'>SPGIST_NULLS</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN116"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="spgxlog.c.html#LN116"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN107"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN116"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* insert new tuple */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a> <span class='Operator'>!= </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN50"><span class='Ref_to_Member'>offnumHeadLeaf</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* normal cases, tuple was added by SpGistPageAddNewItem */ 
</span>            <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN112"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN113"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* update head tuple's chain link if needed */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN50"><span class='Ref_to_Member'>offnumHeadLeaf</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN152"></a>                <a href="../../../include/access/spgist_private.h.html#LN298"><span class='Ref_to_Typedef'>SpGistLeafTuple</span></a> <span class='Declare_Local'>head</span><span class='Delimiter'>; 
</span> 
                <a href="spgxlog.c.html#LN152"><span class='Ref_To_Local'>head</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN298"><span class='Ref_to_Typedef'>SpGistLeafTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN50"><span class='Ref_to_Member'>offnumHeadLeaf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN152"><span class='Ref_To_Local'>head</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN293"><span class='Ref_to_Member'>nextOffset</span></a> <span class='Operator'>== </span><a href="spgxlog.c.html#LN113"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN293"><span class='Ref_to_Member'>nextOffset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="spgxlog.c.html#LN152"><span class='Ref_To_Local'>head</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN293"><span class='Ref_to_Member'>nextOffset</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* replacing a DEAD tuple */ 
</span>            <a href="../../../include/storage/bufpage.h.html#LN430"><span class='Ref_to_Proto'>PageIndexTupleDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN112"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN113"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                     <a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a><span class='Parentheses'>)</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item of size %u to SPGiST index page"</span><span class='Delimiter'>, 
</span>                     <a href="spgxlog.c.html#LN113"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN109"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if action==BLK_NEEDS_RED... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* update parent downlink if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN52"><span class='Ref_to_Member'>offnumParent</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN107"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN182"></a>            <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN183"></a>            <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blknoLeaf</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN107"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN183"><span class='Ref_To_Local'>blknoLeaf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN182"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN52"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN182"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN53"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN183"><span class='Ref_To_Local'>blknoLeaf</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN111"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN49"><span class='Ref_to_Member'>offnumLeaf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN115"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN109"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN114"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xldata-&GT;offnumParent!... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end spgRedoAddLeaf &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN204"></a><span class='Declare_Function'>spgRedoMoveLeafs</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN206"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN207"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN208"></a>    <a href="../../../include/access/spgxlog.h.html#LN63"><span class='Ref_to_Struct'>spgxlogMoveLeafs</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN63"><span class='Ref_to_Struct'>spgxlogMoveLeafs</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN209"></a>    <a href="../../../include/access/spgist_private.h.html#LN117"><span class='Ref_to_Struct'>SpGistState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN210"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toDelete</span><span class='Delimiter'>; 
</span><a name="LN211"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toInsert</span><span class='Delimiter'>; 
</span><a name="LN212"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nInsert</span><span class='Delimiter'>; 
</span><a name="LN213"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN214"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN215"></a>    <a href="../../../include/access/xlogutils.h.html#LN26"><span class='Ref_to_Typedef'>XLogRedoAction</span></a> <span class='Declare_Local'>action</span><span class='Delimiter'>; 
</span><a name="LN216"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blknoDst</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN216"><span class='Ref_To_Local'>blknoDst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN35"><span class='Ref_to_Func'>fillFakeState</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN209"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN74"><span class='Ref_to_Member'>stateSrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN212"><span class='Ref_To_Local'>nInsert</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN67"><span class='Ref_to_Member'>replaceDead</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN65"><span class='Ref_to_Member'>nMoves</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../../include/access/spgxlog.h.html#LN90"><span class='Ref_to_Const'>SizeOfSpgxlogMoveLeafs</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN210"><span class='Ref_To_Local'>toDelete</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN65"><span class='Ref_to_Member'>nMoves</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN211"><span class='Ref_To_Local'>toInsert</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN212"><span class='Ref_To_Local'>nInsert</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* now ptr points to the list of leaf tuples */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In normal operation we would have all three pages (source, dest, and 
     * parent) locked simultaneously; but in WAL replay it should be safe to 
     * update them one at a time, as long as we do it in the right order. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Insert tuples on the dest page (do first, so redirect is valid) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN66"><span class='Ref_to_Member'>newPage</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, 
</span>                     <a href="../../../include/access/spgist_private.h.html#LN52"><span class='Ref_to_Const'>SPGIST_LEAF</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN68"><span class='Ref_to_Member'>storesNulls</span></a> <span class='Operator'>? </span><a href="../../../include/access/spgist_private.h.html#LN53"><span class='Ref_to_Const'>SPGIST_NULLS</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN215"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="spgxlog.c.html#LN215"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN215"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN251"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN251"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN251"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgxlog.c.html#LN212"><span class='Ref_To_Local'>nInsert</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN251"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN257"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>leafTuple</span><span class='Delimiter'>; 
</span><a name="LN258"></a>            <a href="../../../include/access/spgist_private.h.html#LN289"><span class='Ref_to_Struct'>SpGistLeafTupleData</span></a> <span class='Declare_Local'>leafTupleHdr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * the tuples are not aligned, so must copy to access the size 
             * field. 
             */ 
</span>            <a href="spgxlog.c.html#LN257"><span class='Ref_To_Local'>leafTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN258"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN257"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, 
</span>                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN289"><span class='Ref_to_Struct'>SpGistLeafTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN257"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN258"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN211"><span class='Ref_To_Local'>toInsert</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN251"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgxlog.c.html#LN207"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="spgxlog.c.html#LN258"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN206"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if action==BLK_NEEDS_RED... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Delete tuples from the source page, inserting a redirection pointer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgdoinsert.c.html#LN129"><span class='Ref_to_Func'>spgPageIndexMultiDelete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN209"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN210"><span class='Ref_To_Local'>toDelete</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN65"><span class='Ref_to_Member'>nMoves</span></a><span class='Delimiter'>, 
</span>                        <a href="spgxlog.c.html#LN209"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN128"><span class='Ref_to_Member'>isBuild</span></a> <span class='Operator'>? </span><a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a> <span class='Operator'>: </span><a href="../../../include/access/spgist_private.h.html#LN197"><span class='Ref_to_Const'>SPGIST_REDIRECT</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                <a href="spgxlog.c.html#LN216"><span class='Ref_To_Local'>blknoDst</span></a><span class='Delimiter'>, 
</span>                                <a href="spgxlog.c.html#LN211"><span class='Ref_To_Local'>toInsert</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN212"><span class='Ref_To_Local'>nInsert</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN206"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And update the parent downlink */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN204"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN299"></a>        <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgxlog.c.html#LN299"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN71"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN299"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN208"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN72"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                          <a href="spgxlog.c.html#LN216"><span class='Ref_To_Local'>blknoDst</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN211"><span class='Ref_To_Local'>toInsert</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN212"><span class='Ref_To_Local'>nInsert</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN214"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN206"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN213"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoMoveLeafs &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN317"></a><span class='Declare_Function'>spgRedoAddNode</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN319"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN320"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a>    <a href="../../../include/access/spgxlog.h.html#LN98"><span class='Ref_to_Struct'>spgxlogAddNode</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN98"><span class='Ref_to_Struct'>spgxlogAddNode</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN320"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN322"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>innerTuple</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a> <span class='Declare_Local'>innerTupleHdr</span><span class='Delimiter'>; 
</span><a name="LN324"></a>    <a href="../../../include/access/spgist_private.h.html#LN117"><span class='Ref_to_Struct'>SpGistState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN325"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN326"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN327"></a>    <a href="../../../include/access/xlogutils.h.html#LN26"><span class='Ref_to_Typedef'>XLogRedoAction</span></a> <span class='Declare_Local'>action</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN320"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN98"><span class='Ref_to_Struct'>spgxlogAddNode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN322"><span class='Ref_To_Local'>innerTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN320"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the tuple is unaligned, so make a copy to access its header */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN323"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN322"><span class='Ref_To_Local'>innerTuple</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN35"><span class='Ref_to_Func'>fillFakeState</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN324"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN129"><span class='Ref_to_Member'>stateSrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* update in place */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN124"><span class='Ref_to_Member'>parentBlk</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN430"><span class='Ref_to_Proto'>PageIndexTupleDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN104"><span class='Ref_to_Member'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN322"><span class='Ref_To_Local'>innerTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN323"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                            <a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN104"><span class='Ref_to_Member'>offnum</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN104"><span class='Ref_to_Member'>offnum</span></a><span class='Parentheses'>)</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item of size %u to SPGiST index page"</span><span class='Delimiter'>, 
</span>                     <a href="spgxlog.c.html#LN323"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN319"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !XLogRecHasBlockRef(r... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN359"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blkno</span><span class='Delimiter'>; 
</span><a name="LN360"></a>        <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blknoNew</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN359"><span class='Ref_To_Local'>blkno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN360"><span class='Ref_To_Local'>blknoNew</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In normal operation we would have all three pages (source, dest, 
         * and parent) locked simultaneously; but in WAL replay it should be 
         * safe to update them one at a time, as long as we do it in the right 
         * order. We must insert the new tuple before replacing the old tuple 
         * with the redirect tuple. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* Install new tuple first so redirect is valid */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN111"><span class='Ref_to_Member'>newPage</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* AddNode is not used for nulls pages */ 
</span>            <a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgxlog.c.html#LN327"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="spgxlog.c.html#LN327"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN327"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN322"><span class='Ref_To_Local'>innerTuple</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN323"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN110"><span class='Ref_to_Member'>offnumNew</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If parent is in this same page, update it now. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN124"><span class='Ref_to_Member'>parentBlk</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN395"></a>                <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>parentTuple</span><span class='Delimiter'>; 
</span> 
                <a href="spgxlog.c.html#LN395"><span class='Ref_To_Local'>parentTuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN125"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN395"><span class='Ref_To_Local'>parentTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN127"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                                  <a href="spgxlog.c.html#LN360"><span class='Ref_To_Local'>blknoNew</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN110"><span class='Ref_to_Member'>offnumNew</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN319"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if action==BLK_NEEDS_RED... &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Delete old tuple, replacing it with redirect or placeholder tuple */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN412"></a>            <a href="../../../include/access/spgist_private.h.html#LN326"><span class='Ref_to_Typedef'>SpGistDeadTuple</span></a> <span class='Declare_Local'>dt</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN324"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN128"><span class='Ref_to_Member'>isBuild</span></a><span class='Parentheses'>) 
</span>                <a href="spgxlog.c.html#LN412"><span class='Ref_To_Local'>dt</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist_private.h.html#LN401"><span class='Ref_to_Proto'>spgFormDeadTuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN324"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="spgxlog.c.html#LN412"><span class='Ref_To_Local'>dt</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist_private.h.html#LN401"><span class='Ref_to_Proto'>spgFormDeadTuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN324"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN197"><span class='Ref_to_Const'>SPGIST_REDIRECT</span></a><span class='Delimiter'>, 
</span>                                      <a href="spgxlog.c.html#LN360"><span class='Ref_To_Local'>blknoNew</span></a><span class='Delimiter'>, 
</span>                                      <a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN110"><span class='Ref_to_Member'>offnumNew</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN430"><span class='Ref_to_Proto'>PageIndexTupleDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN104"><span class='Ref_to_Member'>offnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN412"><span class='Ref_To_Local'>dt</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN412"><span class='Ref_To_Local'>dt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN320"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                            <a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN104"><span class='Ref_to_Member'>offnum</span></a><span class='Delimiter'>, 
</span>                            <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN104"><span class='Ref_to_Member'>offnum</span></a><span class='Parentheses'>)</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item of size %u to SPGiST index page"</span><span class='Delimiter'>, 
</span>                     <a href="spgxlog.c.html#LN412"><span class='Ref_To_Local'>dt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN320"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN324"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN128"><span class='Ref_to_Member'>isBuild</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/access/spgist_private.h.html#LN55"><span class='Ref_to_Macro'>SpGistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nPlaceholder<span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/access/spgist_private.h.html#LN55"><span class='Ref_to_Macro'>SpGistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nRedirection<span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If parent is in this same page, update it now. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN124"><span class='Ref_to_Member'>parentBlk</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN442"></a>                <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>parentTuple</span><span class='Delimiter'>; 
</span> 
                <a href="spgxlog.c.html#LN442"><span class='Ref_To_Local'>parentTuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN125"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN442"><span class='Ref_To_Local'>parentTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN127"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                                  <a href="spgxlog.c.html#LN360"><span class='Ref_To_Local'>blknoNew</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN110"><span class='Ref_to_Member'>offnumNew</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN319"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogReadBufferForRedo... &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Update parent downlink (if we didn't do it as part of the source or 
         * destination page update already). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN124"><span class='Ref_to_Member'>parentBlk</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN317"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN464"></a>                <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>parentTuple</span><span class='Delimiter'>; 
</span> 
                <a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="spgxlog.c.html#LN464"><span class='Ref_To_Local'>parentTuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN125"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN464"><span class='Ref_To_Local'>parentTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN127"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                                  <a href="spgxlog.c.html#LN360"><span class='Ref_To_Local'>blknoNew</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN321"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN110"><span class='Ref_to_Member'>offnumNew</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN326"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN319"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN325"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xldata-&GT;parentBlk==2 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end spgRedoAddNode &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN484"></a><span class='Declare_Function'>spgRedoSplitTuple</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN486"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN484"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN487"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN484"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN488"></a>    <a href="../../../include/access/spgxlog.h.html#LN140"><span class='Ref_to_Struct'>spgxlogSplitTuple</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN140"><span class='Ref_to_Struct'>spgxlogSplitTuple</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN487"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN489"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>prefixTuple</span><span class='Delimiter'>; 
</span><a name="LN490"></a>    <a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a> <span class='Declare_Local'>prefixTupleHdr</span><span class='Delimiter'>; 
</span><a name="LN491"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>postfixTuple</span><span class='Delimiter'>; 
</span><a name="LN492"></a>    <a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a> <span class='Declare_Local'>postfixTupleHdr</span><span class='Delimiter'>; 
</span><a name="LN493"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN494"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN495"></a>    <a href="../../../include/access/xlogutils.h.html#LN26"><span class='Ref_to_Typedef'>XLogRedoAction</span></a> <span class='Declare_Local'>action</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN487"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN140"><span class='Ref_to_Struct'>spgxlogSplitTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN489"><span class='Ref_To_Local'>prefixTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN487"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the prefix tuple is unaligned, so make a copy to access its header */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN490"><span class='Ref_To_Local'>prefixTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN489"><span class='Ref_To_Local'>prefixTuple</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN487"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="spgxlog.c.html#LN490"><span class='Ref_To_Local'>prefixTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN491"><span class='Ref_To_Local'>postfixTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN487"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* postfix tuple is also unaligned */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN492"><span class='Ref_To_Local'>postfixTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN491"><span class='Ref_To_Local'>postfixTuple</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In normal operation we would have both pages locked simultaneously; but 
     * in WAL replay it should be safe to update them one at a time, as long 
     * as we do it in the right order. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* insert postfix tuple first to avoid dangling link */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN148"><span class='Ref_to_Member'>postfixBlkSame</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN147"><span class='Ref_to_Member'>newPage</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN484"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* SplitTuple is not used for nulls pages */ 
</span>            <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgxlog.c.html#LN495"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="spgxlog.c.html#LN495"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN484"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN495"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN491"><span class='Ref_To_Local'>postfixTuple</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN492"><span class='Ref_To_Local'>postfixTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN146"><span class='Ref_to_Member'>offnumPostfix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN486"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !xldata-&GT;postfixBlkSa... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* now handle the original page */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN484"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN430"><span class='Ref_to_Proto'>PageIndexTupleDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN143"><span class='Ref_to_Member'>offnumPrefix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN412"><span class='Ref_to_Macro'>PageAddItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN489"><span class='Ref_To_Local'>prefixTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN490"><span class='Ref_To_Local'>prefixTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                 <a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN143"><span class='Ref_to_Member'>offnumPrefix</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN143"><span class='Ref_to_Member'>offnumPrefix</span></a><span class='Parentheses'>)</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"failed to add item of size %u to SPGiST index page"</span><span class='Delimiter'>, 
</span>                 <a href="spgxlog.c.html#LN490"><span class='Ref_To_Local'>prefixTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN148"><span class='Ref_to_Member'>postfixBlkSame</span></a><span class='Parentheses'>) 
</span>            <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN491"><span class='Ref_To_Local'>postfixTuple</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN492"><span class='Ref_To_Local'>postfixTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN488"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN146"><span class='Ref_to_Member'>offnumPostfix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN494"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN486"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN493"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoSplitTuple &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN562"></a><span class='Declare_Function'>spgRedoPickSplit</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN564"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN565"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN566"></a>    <a href="../../../include/access/spgxlog.h.html#LN164"><span class='Ref_to_Struct'>spgxlogPickSplit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN164"><span class='Ref_to_Struct'>spgxlogPickSplit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN567"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>innerTuple</span><span class='Delimiter'>; 
</span><a name="LN568"></a>    <a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a> <span class='Declare_Local'>innerTupleHdr</span><span class='Delimiter'>; 
</span><a name="LN569"></a>    <a href="../../../include/access/spgist_private.h.html#LN117"><span class='Ref_to_Struct'>SpGistState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN570"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toDelete</span><span class='Delimiter'>; 
</span><a name="LN571"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toInsert</span><span class='Delimiter'>; 
</span><a name="LN572"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>leafPageSelect</span><span class='Delimiter'>; 
</span><a name="LN573"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>srcBuffer</span><span class='Delimiter'>; 
</span><a name="LN574"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>destBuffer</span><span class='Delimiter'>; 
</span><a name="LN575"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>innerBuffer</span><span class='Delimiter'>; 
</span><a name="LN576"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>srcPage</span><span class='Delimiter'>; 
</span><a name="LN577"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>destPage</span><span class='Delimiter'>; 
</span><a name="LN578"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN579"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN580"></a>    <a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Local'>blknoInner</span><span class='Delimiter'>; 
</span><a name="LN581"></a>    <a href="../../../include/access/xlogutils.h.html#LN26"><span class='Ref_to_Typedef'>XLogRedoAction</span></a> <span class='Declare_Local'>action</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN580"><span class='Ref_To_Local'>blknoInner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN35"><span class='Ref_to_Func'>fillFakeState</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN569"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN184"><span class='Ref_to_Member'>stateSrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../../include/access/spgxlog.h.html#LN198"><span class='Ref_to_Const'>SizeOfSpgxlogPickSplit</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN570"><span class='Ref_To_Local'>toDelete</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN168"><span class='Ref_to_Member'>nDelete</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN571"><span class='Ref_To_Local'>toInsert</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN169"><span class='Ref_to_Member'>nInsert</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN572"><span class='Ref_To_Local'>leafPageSelect</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN169"><span class='Ref_to_Member'>nInsert</span></a><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN567"><span class='Ref_To_Local'>innerTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* the inner tuple is unaligned, so make a copy to access its header */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN568"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN567"><span class='Ref_To_Local'>innerTuple</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN209"><span class='Ref_to_Struct'>SpGistInnerTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="spgxlog.c.html#LN568"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* now ptr points to the list of leaf tuples */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN166"><span class='Ref_to_Member'>isRootSplit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* when splitting root, we touch it only in the guise of new inner */ 
</span>        <a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN170"><span class='Ref_to_Member'>initSrc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* just re-init the source page */ 
</span>        <a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Delimiter'>, 
</span>                     <a href="../../../include/access/spgist_private.h.html#LN52"><span class='Ref_to_Const'>SPGIST_LEAF</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN177"><span class='Ref_to_Member'>storesNulls</span></a> <span class='Operator'>? </span><a href="../../../include/access/spgist_private.h.html#LN53"><span class='Ref_to_Const'>SPGIST_NULLS</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* don't update LSN etc till we're done with it */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Delete the specified tuples from source page.  (In case we're in 
         * Hot Standby, we need to hold lock on the page till we're done 
         * inserting leaf tuples and the new inner tuple, else the added 
         * redirect tuple will be a dangling link.) 
         */ 
</span>        <a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We have it a bit easier here than in doPickSplit(), because we 
             * know the inner tuple's location already, so we can inject the 
             * correct redirection tuple now. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="spgxlog.c.html#LN569"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN128"><span class='Ref_to_Member'>isBuild</span></a><span class='Parentheses'>) 
</span>                <a href="spgdoinsert.c.html#LN129"><span class='Ref_to_Func'>spgPageIndexMultiDelete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN569"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a><span class='Delimiter'>, 
</span>                                        <a href="spgxlog.c.html#LN570"><span class='Ref_To_Local'>toDelete</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN168"><span class='Ref_to_Member'>nDelete</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/access/spgist_private.h.html#LN197"><span class='Ref_to_Const'>SPGIST_REDIRECT</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                        <a href="spgxlog.c.html#LN580"><span class='Ref_To_Local'>blknoInner</span></a><span class='Delimiter'>, 
</span>                                        <a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN174"><span class='Ref_to_Member'>offnumInner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="spgdoinsert.c.html#LN129"><span class='Ref_to_Func'>spgPageIndexMultiDelete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN569"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a><span class='Delimiter'>, 
</span>                                        <a href="spgxlog.c.html#LN570"><span class='Ref_To_Local'>toDelete</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN168"><span class='Ref_to_Member'>nDelete</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* don't update LSN etc till we're done with it */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogReadBufferForRedo... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* try to access dest page if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN171"><span class='Ref_to_Member'>initDest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* just re-init the dest page */ 
</span>        <a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Delimiter'>, 
</span>                     <a href="../../../include/access/spgist_private.h.html#LN52"><span class='Ref_to_Const'>SPGIST_LEAF</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN177"><span class='Ref_to_Member'>storesNulls</span></a> <span class='Operator'>? </span><a href="../../../include/access/spgist_private.h.html#LN53"><span class='Ref_to_Const'>SPGIST_NULLS</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* don't update LSN etc till we're done with it */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We could probably release the page lock immediately in the 
         * full-page-image case, but for safety let's hold it till later. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
            <a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* don't do any page updates */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* restore leaf tuples to src and/or dest page */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN579"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN579"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN169"><span class='Ref_to_Member'>nInsert</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN579"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN686"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>leafTuple</span><span class='Delimiter'>; 
</span><a name="LN687"></a>        <a href="../../../include/access/spgist_private.h.html#LN289"><span class='Ref_to_Struct'>SpGistLeafTupleData</span></a> <span class='Declare_Local'>leafTupleHdr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* the tuples are not aligned, so must copy to access the size field. */ 
</span>        <a href="spgxlog.c.html#LN686"><span class='Ref_To_Local'>leafTuple</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN687"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN686"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN289"><span class='Ref_to_Struct'>SpGistLeafTupleData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN565"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="spgxlog.c.html#LN687"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span> 
        <a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN572"><span class='Ref_To_Local'>leafPageSelect</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN579"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>? </span><a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a> <span class='Operator'>: </span><a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no need to touch this page */ 
</span> 
        <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN686"><span class='Ref_To_Local'>leafTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN687"><span class='Ref_To_Local'>leafTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN292"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                          <a href="spgxlog.c.html#LN571"><span class='Ref_To_Local'>toInsert</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN579"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now update src and dest page LSNs if needed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN576"><span class='Ref_To_Local'>srcPage</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN564"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN577"><span class='Ref_To_Local'>destPage</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN564"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* restore new inner tuple */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN175"><span class='Ref_to_Member'>initInner</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN37"><span class='Ref_to_Proto'>XLogInitBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/spgist_private.h.html#LN390"><span class='Ref_to_Proto'>SpGistInitBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN177"><span class='Ref_to_Member'>storesNulls</span></a> <span class='Operator'>? </span><a href="../../../include/access/spgist_private.h.html#LN53"><span class='Ref_to_Const'>SPGIST_NULLS</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN581"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="spgxlog.c.html#LN581"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>= </span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN581"><span class='Ref_To_Local'>action</span></a> <span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgxlog.c.html#LN50"><span class='Ref_to_Func'>addOrReplaceTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/storage/item.h.html#LN16"><span class='Ref_to_Typedef'>Item</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN567"><span class='Ref_To_Local'>innerTuple</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN568"><span class='Ref_To_Local'>innerTupleHdr</span></a><span class='Operator'>.</span><a href="../../../include/access/spgist_private.h.html#LN215"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span>                          <a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN174"><span class='Ref_to_Member'>offnumInner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if inner is also parent, update link while we're here */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN180"><span class='Ref_to_Member'>innerIsParent</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN734"></a>            <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>parent</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN734"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN181"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN734"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN182"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN580"><span class='Ref_To_Local'>blknoInner</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN174"><span class='Ref_to_Member'>offnumInner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN564"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if action==BLK_NEEDS_RED... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN575"><span class='Ref_To_Local'>innerBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can release the leaf-page locks.  It's okay to do this before 
     * updating the parent downlink. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN573"><span class='Ref_To_Local'>srcBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN574"><span class='Ref_To_Local'>destBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* update parent downlink, unless we did it above */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN222"><span class='Ref_to_Macro'>XLogRecHasBlockRef</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN760"></a>        <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>parentBuffer</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN562"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN760"><span class='Ref_To_Local'>parentBuffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN764"></a>            <a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a> <span class='Declare_Local'>parent</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN760"><span class='Ref_To_Local'>parentBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN764"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN220"><span class='Ref_to_Typedef'>SpGistInnerTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN181"><span class='Ref_to_Member'>offnumParent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="spgdoinsert.c.html#LN48"><span class='Ref_to_Func'>spgUpdateNodeLink</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN764"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN182"><span class='Ref_to_Member'>nodeI</span></a><span class='Delimiter'>, 
</span>                              <a href="spgxlog.c.html#LN580"><span class='Ref_To_Local'>blknoInner</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN174"><span class='Ref_to_Member'>offnumInner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN578"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN564"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN760"><span class='Ref_To_Local'>parentBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN760"><span class='Ref_To_Local'>parentBuffer</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN760"><span class='Ref_To_Local'>parentBuffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogRecHasBlockRef(re... &raquo; </span> 
    <span class='Control'>else</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN180"><span class='Ref_to_Member'>innerIsParent</span></a> <span class='Operator'>|| </span><a href="spgxlog.c.html#LN566"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN166"><span class='Ref_to_Member'>isRootSplit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoPickSplit &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN784"></a><span class='Declare_Function'>spgRedoVacuumLeaf</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN786"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN784"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN787"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN784"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN788"></a>    <a href="../../../include/access/spgxlog.h.html#LN200"><span class='Ref_to_Struct'>spgxlogVacuumLeaf</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN200"><span class='Ref_to_Struct'>spgxlogVacuumLeaf</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN789"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toDead</span><span class='Delimiter'>; 
</span><a name="LN790"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toPlaceholder</span><span class='Delimiter'>; 
</span><a name="LN791"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>moveSrc</span><span class='Delimiter'>; 
</span><a name="LN792"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>moveDest</span><span class='Delimiter'>; 
</span><a name="LN793"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chainSrc</span><span class='Delimiter'>; 
</span><a name="LN794"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>chainDest</span><span class='Delimiter'>; 
</span><a name="LN795"></a>    <a href="../../../include/access/spgist_private.h.html#LN117"><span class='Ref_to_Struct'>SpGistState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN796"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN797"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN35"><span class='Ref_to_Func'>fillFakeState</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN795"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN207"><span class='Ref_to_Member'>stateSrc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../../include/access/spgxlog.h.html#LN222"><span class='Ref_to_Const'>SizeOfSpgxlogVacuumLeaf</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN789"><span class='Ref_To_Local'>toDead</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN202"><span class='Ref_to_Member'>nDead</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN790"><span class='Ref_To_Local'>toPlaceholder</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN203"><span class='Ref_to_Member'>nPlaceholder</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN791"><span class='Ref_To_Local'>moveSrc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN204"><span class='Ref_to_Member'>nMove</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN792"><span class='Ref_To_Local'>moveDest</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN204"><span class='Ref_to_Member'>nMove</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN793"><span class='Ref_To_Local'>chainSrc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN205"><span class='Ref_to_Member'>nChain</span></a><span class='Delimiter'>; 
</span>    <a href="spgxlog.c.html#LN794"><span class='Ref_To_Local'>chainDest</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN784"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN796"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN796"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgdoinsert.c.html#LN129"><span class='Ref_to_Func'>spgPageIndexMultiDelete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN795"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                <a href="spgxlog.c.html#LN789"><span class='Ref_To_Local'>toDead</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN202"><span class='Ref_to_Member'>nDead</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/spgist_private.h.html#LN198"><span class='Ref_to_Const'>SPGIST_DEAD</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN198"><span class='Ref_to_Const'>SPGIST_DEAD</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="spgdoinsert.c.html#LN129"><span class='Ref_to_Func'>spgPageIndexMultiDelete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN795"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                <a href="spgxlog.c.html#LN790"><span class='Ref_To_Local'>toPlaceholder</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN203"><span class='Ref_to_Member'>nPlaceholder</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* see comments in vacuumLeafPage() */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN204"><span class='Ref_to_Member'>nMove</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN834"></a>            <a href="../../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>idSrc</span> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN791"><span class='Ref_To_Local'>moveSrc</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN835"></a>            <a href="../../../include/storage/itemid.h.html#LN30"><span class='Ref_to_Typedef'>ItemId</span></a>      <span class='Declare_Local'>idDest</span> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN792"><span class='Ref_To_Local'>moveDest</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN836"></a>            <a href="../../../include/storage/itemid.h.html#LN23"><span class='Ref_to_Struct'>ItemIdData</span></a>  <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN836"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= *</span><a href="spgxlog.c.html#LN834"><span class='Ref_To_Local'>idSrc</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="spgxlog.c.html#LN834"><span class='Ref_To_Local'>idSrc</span></a> <span class='Operator'>= *</span><a href="spgxlog.c.html#LN835"><span class='Ref_To_Local'>idDest</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="spgxlog.c.html#LN835"><span class='Ref_To_Local'>idDest</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN836"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="spgdoinsert.c.html#LN129"><span class='Ref_to_Func'>spgPageIndexMultiDelete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN795"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                <a href="spgxlog.c.html#LN791"><span class='Ref_To_Local'>moveSrc</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN204"><span class='Ref_to_Member'>nMove</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, </span><a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgxlog.c.html#LN788"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN205"><span class='Ref_to_Member'>nChain</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN851"></a>            <a href="../../../include/access/spgist_private.h.html#LN298"><span class='Ref_to_Typedef'>SpGistLeafTuple</span></a> <span class='Declare_Local'>lt</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN851"><span class='Ref_To_Local'>lt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN298"><span class='Ref_to_Typedef'>SpGistLeafTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN793"><span class='Ref_To_Local'>chainSrc</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN851"><span class='Ref_To_Local'>lt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN291"><span class='Ref_to_Member'>tupstate</span></a> <span class='Operator'>== </span><a href="../../../include/access/spgist_private.h.html#LN196"><span class='Ref_to_Const'>SPGIST_LIVE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgxlog.c.html#LN851"><span class='Ref_To_Local'>lt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN293"><span class='Ref_to_Member'>nextOffset</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN794"><span class='Ref_To_Local'>chainDest</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN798"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN797"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN786"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN796"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogReadBufferForRedo... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN796"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN796"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoVacuumLeaf &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN867"></a><span class='Declare_Function'>spgRedoVacuumRoot</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN869"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN867"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN870"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN867"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN871"></a>    <a href="../../../include/access/spgxlog.h.html#LN224"><span class='Ref_to_Struct'>spgxlogVacuumRoot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN224"><span class='Ref_to_Struct'>spgxlogVacuumRoot</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN870"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN872"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toDelete</span><span class='Delimiter'>; 
</span><a name="LN873"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN874"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN872"><span class='Ref_To_Local'>toDelete</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN871"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN232"><span class='Ref_to_Member'>offsets</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN867"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN873"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="spgxlog.c.html#LN874"><span class='Ref_To_Local'>page</span></a> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN873"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The tuple numbers are in order */ 
</span>        <a href="../../../include/storage/bufpage.h.html#LN431"><span class='Ref_to_Proto'>PageIndexMultiDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN874"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN872"><span class='Ref_To_Local'>toDelete</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN871"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN227"><span class='Ref_to_Member'>nDelete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN874"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN869"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN873"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN873"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN873"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoVacuumRoot &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN893"></a><span class='Declare_Function'>spgRedoVacuumRedirect</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN895"></a>    <a href="../../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a>  <span class='Declare_Local'>lsn</span> <span class='Operator'>= </span><a href="spgxlog.c.html#LN893"><span class='Ref_to_Parameter'>record</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/xlogreader.h.html#LN114"><span class='Ref_to_Member'>EndRecPtr</span></a><span class='Delimiter'>; 
</span><a name="LN896"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN219"><span class='Ref_to_Macro'>XLogRecGetData</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN893"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN897"></a>    <a href="../../../include/access/spgxlog.h.html#LN237"><span class='Ref_to_Struct'>spgxlogVacuumRedirect</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xldata</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgxlog.h.html#LN237"><span class='Ref_to_Struct'>spgxlogVacuumRedirect</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN896"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN898"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>itemToPlaceholder</span><span class='Delimiter'>; 
</span><a name="LN899"></a>    <a href="../../../include/storage/buf.h.html#LN22"><span class='Ref_to_Typedef'>Buffer</span></a>      <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN898"><span class='Ref_To_Local'>itemToPlaceholder</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN244"><span class='Ref_to_Member'>offsets</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If any redirection tuples are being removed, make sure there are no 
     * live Hot Standby transactions that might need to see them. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlog.h.html#LN73"><span class='Ref_to_Const'>InHotStandby</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/transam.h.html#LN40"><span class='Ref_to_Macro'>TransactionIdIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN241"><span class='Ref_to_Member'>newestRedirectXid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN911"></a>            <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>node</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/access/xlogreader.h.html#LN231"><span class='Ref_to_Proto'>XLogRecGetBlockTag</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN893"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN911"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/standby.h.html#LN29"><span class='Ref_to_Proto'>ResolveRecoveryConflictWithSnapshot</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN241"><span class='Ref_to_Member'>newestRedirectXid</span></a><span class='Delimiter'>, 
</span>                                                <a href="spgxlog.c.html#LN911"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/xlogutils.h.html#LN35"><span class='Ref_to_Proto'>XLogReadBufferForRedo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN893"><span class='Ref_to_Parameter'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="spgxlog.c.html#LN899"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/access/xlogutils.h.html#LN28"><span class='Ref_to_EnumConst'>BLK_NEEDS_REDO</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN921"></a>        <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><a href="../../../include/storage/bufmgr.h.html#LN159"><span class='Ref_to_Macro'>BufferGetPage</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN899"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN922"></a>        <a href="../../../include/access/spgist_private.h.html#LN46"><span class='Ref_to_Typedef'>SpGistPageOpaque</span></a> <span class='Declare_Local'>opaque</span> <span class='Operator'>= </span><a href="../../../include/access/spgist_private.h.html#LN55"><span class='Ref_to_Macro'>SpGistPageGetOpaque</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN921"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN923"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Convert redirect pointers to plain placeholders */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN239"><span class='Ref_to_Member'>nToPlaceholder</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN928"></a>            <a href="../../../include/access/spgist_private.h.html#LN326"><span class='Ref_to_Typedef'>SpGistDeadTuple</span></a> <span class='Declare_Local'>dt</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN928"><span class='Ref_To_Local'>dt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist_private.h.html#LN326"><span class='Ref_to_Typedef'>SpGistDeadTuple</span></a><span class='Parentheses'>) </span><a href="../../../include/storage/bufpage.h.html#LN336"><span class='Ref_to_Macro'>PageGetItem</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN921"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/storage/bufpage.h.html#LN231"><span class='Ref_to_Macro'>PageGetItemId</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN921"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN898"><span class='Ref_To_Local'>itemToPlaceholder</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN928"><span class='Ref_To_Local'>dt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN319"><span class='Ref_to_Member'>tupstate</span></a> <span class='Operator'>== </span><a href="../../../include/access/spgist_private.h.html#LN197"><span class='Ref_to_Const'>SPGIST_REDIRECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgxlog.c.html#LN928"><span class='Ref_To_Local'>dt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN319"><span class='Ref_to_Member'>tupstate</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist_private.h.html#LN199"><span class='Ref_to_Const'>SPGIST_PLACEHOLDER</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="spgxlog.c.html#LN928"><span class='Ref_To_Local'>dt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN322"><span class='Ref_to_Member'>pointer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN922"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN40"><span class='Ref_to_Member'>nRedirection</span></a> <span class='Operator'>&GT;= </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN239"><span class='Ref_to_Member'>nToPlaceholder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN922"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN40"><span class='Ref_to_Member'>nRedirection</span></a> <span class='Operator'>-= </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN239"><span class='Ref_to_Member'>nToPlaceholder</span></a><span class='Delimiter'>; 
</span>        <a href="spgxlog.c.html#LN922"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN41"><span class='Ref_to_Member'>nPlaceholder</span></a> <span class='Operator'>+= </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN239"><span class='Ref_to_Member'>nToPlaceholder</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remove placeholder tuples at end of page */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN240"><span class='Ref_to_Member'>firstPlaceholder</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/off.h.html#LN25"><span class='Ref_to_Const'>InvalidOffsetNumber</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN944"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>max</span> <span class='Operator'>= </span><a href="../../../include/storage/bufpage.h.html#LN353"><span class='Ref_to_Macro'>PageGetMaxOffsetNumber</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN921"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN945"></a>            <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>toDelete</span><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN945"><span class='Ref_To_Local'>toDelete</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="spgxlog.c.html#LN944"><span class='Ref_To_Local'>max</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN240"><span class='Ref_to_Member'>firstPlaceholder</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="spgxlog.c.html#LN944"><span class='Ref_To_Local'>max</span></a><span class='Delimiter'>; </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="spgxlog.c.html#LN945"><span class='Ref_To_Local'>toDelete</span></a><span class='Delimiter'>[</span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN240"><span class='Ref_to_Member'>firstPlaceholder</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="spgxlog.c.html#LN944"><span class='Ref_To_Local'>max</span></a> <span class='Operator'>- </span><a href="spgxlog.c.html#LN897"><span class='Ref_To_Local'>xldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgxlog.h.html#LN240"><span class='Ref_to_Member'>firstPlaceholder</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN922"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN41"><span class='Ref_to_Member'>nPlaceholder</span></a> <span class='Operator'>&GT;= </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="spgxlog.c.html#LN922"><span class='Ref_To_Local'>opaque</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist_private.h.html#LN41"><span class='Ref_to_Member'>nPlaceholder</span></a> <span class='Operator'>-= </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* The array is sorted, so can use PageIndexMultiDelete */ 
</span>            <a href="../../../include/storage/bufpage.h.html#LN431"><span class='Ref_to_Proto'>PageIndexMultiDelete</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN921"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN945"><span class='Ref_To_Local'>toDelete</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN923"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN945"><span class='Ref_To_Local'>toDelete</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/storage/bufpage.h.html#LN364"><span class='Ref_to_Macro'>PageSetLSN</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN921"><span class='Ref_To_Local'>page</span></a><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN895"><span class='Ref_To_Local'>lsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/bufmgr.h.html#LN176"><span class='Ref_to_Proto'>MarkBufferDirty</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN899"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if XLogReadBufferForRedo... &raquo; </span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/storage/bufmgr.h.html#LN113"><span class='Ref_to_Macro'>BufferIsValid</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN899"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/storage/bufmgr.h.html#LN175"><span class='Ref_to_Proto'>UnlockReleaseBuffer</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN899"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spgRedoVacuumRedirect &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN970"></a><span class='Declare_Function'>spg_redo</span><span class='Parentheses'>(</span><a href="../../../include/access/xlogreader.h.html#LN68"><span class='Ref_to_Struct'>XLogReaderState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>record</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN972"></a>    <a href="../../../include/c.h.html#LN265"><span class='Ref_to_Typedef'>uint8</span></a>       <span class='Declare_Local'>info</span> <span class='Operator'>= </span><a href="../../../include/access/xlogreader.h.html#LN215"><span class='Ref_to_Macro'>XLogRecGetInfo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>) </span><span class='Operator'>& ~</span><a href="../../../include/access/xlogrecord.h.html#LN61"><span class='Ref_to_Const'>XLR_INFO_MASK</span></a><span class='Delimiter'>; 
</span><a name="LN973"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCxt</span><span class='Delimiter'>; 
</span> 
    <a href="spgxlog.c.html#LN973"><span class='Ref_To_Local'>oldCxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="spgxlog.c.html#LN972"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN20"><span class='Ref_to_Const'>XLOG_SPGIST_CREATE_INDEX</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN74"><span class='Ref_to_Func'>spgRedoCreateIndex</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN21"><span class='Ref_to_Const'>XLOG_SPGIST_ADD_LEAF</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN106"><span class='Ref_to_Func'>spgRedoAddLeaf</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN22"><span class='Ref_to_Const'>XLOG_SPGIST_MOVE_LEAFS</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN203"><span class='Ref_to_Func'>spgRedoMoveLeafs</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN23"><span class='Ref_to_Const'>XLOG_SPGIST_ADD_NODE</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN316"><span class='Ref_to_Func'>spgRedoAddNode</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN24"><span class='Ref_to_Const'>XLOG_SPGIST_SPLIT_TUPLE</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN483"><span class='Ref_to_Func'>spgRedoSplitTuple</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN25"><span class='Ref_to_Const'>XLOG_SPGIST_PICKSPLIT</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN561"><span class='Ref_to_Func'>spgRedoPickSplit</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN26"><span class='Ref_to_Const'>XLOG_SPGIST_VACUUM_LEAF</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN783"><span class='Ref_to_Func'>spgRedoVacuumLeaf</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN27"><span class='Ref_to_Const'>XLOG_SPGIST_VACUUM_ROOT</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN866"><span class='Ref_to_Func'>spgRedoVacuumRoot</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/access/spgxlog.h.html#LN28"><span class='Ref_to_Const'>XLOG_SPGIST_VACUUM_REDIRECT</span></a><span class='Operator'>: 
</span>            <a href="spgxlog.c.html#LN892"><span class='Ref_to_Func'>spgRedoVacuumRedirect</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN970"><span class='Ref_to_Parameter'>record</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN52"><span class='Ref_to_Const'>PANIC</span></a><span class='Delimiter'>, </span><span class='String'>"spg_redo: unknown op code %u"</span><span class='Delimiter'>, </span><a href="spgxlog.c.html#LN972"><span class='Ref_To_Local'>info</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch info &raquo; </span> 
 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN973"><span class='Ref_To_Local'>oldCxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_redo &raquo; </span> 
 
<span class='Keyword'>void 
</span><a name="LN1014"></a><span class='Declare_Function'>spg_xlog_startup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                  <span class='String'>"SP-GiST temporary context"</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN1022"></a><span class='Declare_Function'>spg_xlog_cleanup</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../gin/ginxlog.c.html#LN21"><span class='Ref_to_Global_Var'>opCtx</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Mask a SpGist page before performing consistency checks on it. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1032"></a><span class='Declare_Function'>spg_mask</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>pagedata</span><span class='Delimiter'>, </span><a href="../../../include/storage/block.h.html#LN30"><span class='Ref_to_Typedef'>BlockNumber</span></a> <span class='Declare_Parameter'>blkno</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1034"></a>    <a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a>        <span class='Declare_Local'>page</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/bufpage.h.html#LN73"><span class='Ref_to_Typedef'>Page</span></a><span class='Parentheses'>) </span><a href="spgxlog.c.html#LN1032"><span class='Ref_to_Parameter'>pagedata</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/bufmask.h.html#LN25"><span class='Ref_to_Proto'>mask_page_lsn</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN1034"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/bufmask.h.html#LN26"><span class='Ref_to_Proto'>mask_page_hint_bits</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN1034"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Any SpGist page other than meta contains unused space which needs to be 
     * masked. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/spgist_private.h.html#LN56"><span class='Ref_to_Macro'>SpGistPageIsMeta</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN1034"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/access/bufmask.h.html#LN27"><span class='Ref_to_Proto'>mask_unused_space</span></a><span class='Parentheses'>(</span><a href="spgxlog.c.html#LN1034"><span class='Ref_To_Local'>page</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>