<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\aclchk.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\aclchk.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:31 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * aclchk.c 
 *    Routines to check access control permissions. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/catalog/aclchk.c 
 * 
 * NOTES 
 *    See acl.h. 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/binary_upgrade.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_aggregate.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_am.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_cast.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_conversion.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_database.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_default_acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_data_wrapper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_foreign_server.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_init_privs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_language.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_largeobject.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_largeobject_metadata.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opclass.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opfamily.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_statistic_ext.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_subscription.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_ts_config.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_ts_dict.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_ts_parser.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_ts_template.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_transform.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/proclang.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"foreign/foreign.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/aclchk_internal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Internal format used by ALTER DEFAULT PRIVILEGES. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN84"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>roleid</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* owning role */ 
</span><a name="LN85"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>nspid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* namespace, or InvalidOid if none */ 
</span>    <span class='Comment_Multi_Line'>/* remaining fields are same as in InternalGrant: */ 
</span><a name="LN87"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_grant</span><span class='Delimiter'>; 
</span><a name="LN88"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Member'>objtype</span><span class='Delimiter'>; 
</span><a name="LN89"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>all_privs</span><span class='Delimiter'>; 
</span><a name="LN90"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Member'>privileges</span><span class='Delimiter'>; 
</span><a name="LN91"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>grantees</span><span class='Delimiter'>; 
</span><a name="LN92"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>grant_option</span><span class='Delimiter'>; 
</span><a name="LN93"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Member'>behavior</span><span class='Delimiter'>; 
</span><a name="LN94"></a>} <span class='Declare_Typedef'>InternalDefaultACL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * When performing a binary-upgrade, pg_dump will call a function to set 
 * this variable to let us know that we need to populate the pg_init_privs 
 * table for the GRANT/REVOKE commands while this variable is set to true. 
 */ 
</span><a name="LN101"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>binary_upgrade_record_init_privs</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
<a name="LN103"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrantStmt_oids</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN104"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Relation</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Database</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Fdw</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_ForeignServer</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Function</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Language</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Largeobject</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Namespace</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Tablespace</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN113"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ExecGrant_Type</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantStmt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN115"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SetDefaultACLsInSchemas</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN82"><span class='Ref_to_Typedef'>InternalDefaultACL</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>iacls</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nspnames</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SetDefaultACL</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN82"><span class='Ref_to_Typedef'>InternalDefaultACL</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>iacls</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN118"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>objectNamesToOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objnames</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN119"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>objectsInSchemaToOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nspnames</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>getRelationsInNamespace</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>namespaceId</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relkind</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN121"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>expand_col_privileges</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colnames</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, 
</span><a name="LN122"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>this_privileges</span><span class='Delimiter'>, 
</span><a name="LN123"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col_privileges</span><span class='Delimiter'>, 
</span><a name="LN124"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>num_col_privileges</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN125"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>expand_all_col_privileges</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Parameter'>classForm</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>this_privileges</span><span class='Delimiter'>, 
</span><a name="LN127"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col_privileges</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>num_col_privileges</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN129"></a><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>string_to_privilege</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>privname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN130"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>privilege_to_string</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>privilege</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>restrict_and_check_grant</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_grant</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>avail_goptions</span><span class='Delimiter'>, 
</span><a name="LN132"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>all_privs</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>privileges</span><span class='Delimiter'>, 
</span><a name="LN133"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantorId</span><span class='Delimiter'>, 
</span><a name="LN134"></a>                         <a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Parameter'>objkind</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>objname</span><span class='Delimiter'>, 
</span><a name="LN135"></a>                         <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>att_number</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN136"></a><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Prototype'>pg_aclmask</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Parameter'>objkind</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN137"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN138"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>recordExtensionInitPriv</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>objsubid</span><span class='Delimiter'>, 
</span><a name="LN139"></a>                        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_acl</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN140"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>recordExtensionInitPrivWorker</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>objsubid</span><span class='Delimiter'>, 
</span><a name="LN141"></a>                              <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_acl</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Directive'>#ifdef</span> ACLDEBUG 
<span class='Keyword'>static void 
</span><a name="LN146"></a><span class='Declare_Function'>dumpacl</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN148"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN149"></a>    <a href="../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>aip</span><span class='Delimiter'>; 
</span> 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"acl size = %d, # acls = %d"</span><span class='Delimiter'>, 
</span>         <a href="../../include/utils/acl.h.html#LN103"><span class='Ref_to_Macro'>ACL_SIZE</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN146"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN146"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN149"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN101"><span class='Ref_to_Macro'>ACL_DAT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN146"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN148"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="aclchk.c.html#LN148"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN146"><span class='Ref_to_Parameter'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="aclchk.c.html#LN148"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"  acl[%d]: %s"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN148"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>             <a href="../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/acl.c.html#LN588"><span class='Ref_to_Func'>aclitemout</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN149"><span class='Ref_To_Local'>aip</span></a> <span class='Operator'>+ </span><a href="aclchk.c.html#LN148"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* ACLDEBUG */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * If is_grant is true, adds the given privileges for the list of 
 * grantees to the existing old_acl.  If is_grant is false, the 
 * privileges for the given grantees are removed from old_acl. 
 * 
 * NB: the original old_acl is pfree'd. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN170"></a><span class='Declare_Function'>merge_acl_with_grant</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_acl</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_grant</span><span class='Delimiter'>, 
</span><a name="LN171"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>grant_option</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1652"><span class='Ref_to_Enum'>DropBehavior</span></a> <span class='Declare_Parameter'>behavior</span><span class='Delimiter'>, 
</span><a name="LN172"></a>                     <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>grantees</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>privileges</span><span class='Delimiter'>, 
</span><a name="LN173"></a>                     <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantorId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN175"></a>    <span class='Keyword'>unsigned</span>    <span class='Declare_Local'>modechg</span><span class='Delimiter'>; 
</span><a name="LN176"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN177"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN175"><span class='Ref_To_Local'>modechg</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN170"><span class='Ref_to_Parameter'>is_grant</span></a> <span class='Operator'>? </span><a href="../../include/utils/acl.h.html#LN121"><span class='Ref_to_Const'>ACL_MODECHG_ADD</span></a> <span class='Operator'>: </span><a href="../../include/utils/acl.h.html#LN122"><span class='Ref_to_Const'>ACL_MODECHG_DEL</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> ACLDEBUG 
    <a href="aclchk.c.html#LN145"><span class='Ref_to_Func'>dumpacl</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN170"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <a href="aclchk.c.html#LN177"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN170"><span class='Ref_to_Parameter'>old_acl</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN176"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN172"><span class='Ref_to_Parameter'>grantees</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN188"></a>        <a href="../../include/utils/acl.h.html#LN46"><span class='Ref_to_Struct'>AclItem</span></a>     <span class='Declare_Local'>aclitem</span><span class='Delimiter'>; 
</span><a name="LN189"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newer_acl</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN188"><span class='Ref_To_Local'>aclitem</span></a><span class='Operator'>.</span><a href="../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN176"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Grant options can only be granted to individual roles, not PUBLIC. 
         * The reason is that if a user would re-grant a privilege that he 
         * held through PUBLIC, and later the user is removed, the situation 
         * is impossible to clean up. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN170"><span class='Ref_to_Parameter'>is_grant</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN171"><span class='Ref_to_Parameter'>grant_option</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN188"><span class='Ref_To_Local'>aclitem</span></a><span class='Operator'>.</span><a href="../../include/utils/acl.h.html#LN48"><span class='Ref_to_Member'>ai_grantee</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"grant options can only be granted to roles"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN188"><span class='Ref_To_Local'>aclitem</span></a><span class='Operator'>.</span><a href="../../include/utils/acl.h.html#LN49"><span class='Ref_to_Member'>ai_grantor</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN173"><span class='Ref_to_Parameter'>grantorId</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The asymmetry in the conditions here comes from the spec.  In 
         * GRANT, the grant_option flag signals WITH GRANT OPTION, which means 
         * to grant both the basic privilege and its grant option. But in 
         * REVOKE, plain revoke revokes both the basic privilege and its grant 
         * option, while REVOKE GRANT OPTION revokes only the option. 
         */ 
</span>        <a href="../../include/utils/acl.h.html#LN74"><span class='Ref_to_Macro'>ACLITEM_SET_PRIVS_GOPTIONS</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN188"><span class='Ref_To_Local'>aclitem</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="aclchk.c.html#LN170"><span class='Ref_to_Parameter'>is_grant</span></a> <span class='Operator'>|| !</span><a href="aclchk.c.html#LN171"><span class='Ref_to_Parameter'>grant_option</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="aclchk.c.html#LN172"><span class='Ref_to_Parameter'>privileges</span></a> <span class='Operator'>: </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>, 
</span>                   <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN170"><span class='Ref_to_Parameter'>is_grant</span></a> <span class='Operator'>|| </span><a href="aclchk.c.html#LN171"><span class='Ref_to_Parameter'>grant_option</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="aclchk.c.html#LN172"><span class='Ref_to_Parameter'>privileges</span></a> <span class='Operator'>: </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN189"><span class='Ref_To_Local'>newer_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN215"><span class='Ref_to_Proto'>aclupdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN177"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN188"><span class='Ref_To_Local'>aclitem</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN175"><span class='Ref_To_Local'>modechg</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN173"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN171"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* avoid memory leak when there are many grantees */ 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN177"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN177"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN189"><span class='Ref_To_Local'>newer_acl</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> ACLDEBUG 
        <a href="aclchk.c.html#LN145"><span class='Ref_to_Func'>dumpacl</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN177"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN177"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end merge_acl_with_grant &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Restrict the privileges to what we can actually grant, and emit 
 * the standards-mandated warning and error messages. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN236"></a><span class='Declare_Function'>restrict_and_check_grant</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_grant</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>avail_goptions</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>all_privs</span><span class='Delimiter'>, 
</span><a name="LN237"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>privileges</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>grantorId</span><span class='Delimiter'>, 
</span><a name="LN238"></a>                         <a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Parameter'>objkind</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>objname</span><span class='Delimiter'>, 
</span><a name="LN239"></a>                         <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>att_number</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN241"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN242"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>whole_mask</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN148"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_COLUMN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN182"><span class='Ref_to_EnumConst'>ACL_KIND_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN151"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_DATABASE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN154"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN187"><span class='Ref_to_EnumConst'>ACL_KIND_LANGUAGE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN155"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LANGUAGE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN188"><span class='Ref_to_EnumConst'>ACL_KIND_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN156"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LARGEOBJECT</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN158"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TABLESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN198"><span class='Ref_to_EnumConst'>ACL_KIND_FDW</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN152"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FDW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN153"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FOREIGN_SERVER</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN200"><span class='Ref_to_EnumConst'>ACL_KIND_EVENT_TRIGGER</span></a><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"grantable rights not supported for event triggers"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* not reached, but keep compiler quiet */ 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN186"><span class='Ref_to_EnumConst'>ACL_KIND_TYPE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized object kind: %d"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* not reached, but keep compiler quiet */ 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objkind &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we found no grant options, consider whether to issue a hard error. 
     * Per spec, having any privilege at all on the object will get you by 
     * here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN236"><span class='Ref_to_Parameter'>avail_goptions</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN136"><span class='Ref_to_Proto'>pg_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN237"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>att_number</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN237"><span class='Ref_to_Parameter'>grantorId</span></a><span class='Delimiter'>, 
</span>                       <a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a> <span class='Operator'>| </span><a href="../../include/utils/acl.h.html#LN62"><span class='Ref_to_Macro'>ACL_GRANT_OPTION_FOR</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN242"><span class='Ref_To_Local'>whole_mask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/acl.h.html#LN298"><span class='Ref_to_Proto'>aclcheck_error_col</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Restrict the operation to what we can actually grant or revoke, and 
     * issue a warning if appropriate.  (For REVOKE this isn't quite what the 
     * spec says to do: the spec seems to want a warning only if no privilege 
     * bits actually change in the ACL. In practice that behavior seems much 
     * too noisy, as well as inconsistent with the GRANT case.) 
     */ 
</span>    <a href="aclchk.c.html#LN241"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN237"><span class='Ref_to_Parameter'>privileges</span></a> <span class='Operator'>& </span><a href="../../include/utils/acl.h.html#LN63"><span class='Ref_to_Macro'>ACL_OPTION_TO_PRIVS</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN236"><span class='Ref_to_Parameter'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN236"><span class='Ref_to_Parameter'>is_grant</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN241"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_GRANTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no privileges were granted for column \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_GRANTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no privileges were granted for \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN236"><span class='Ref_to_Parameter'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN241"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>!= </span><a href="aclchk.c.html#LN237"><span class='Ref_to_Parameter'>privileges</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_GRANTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"not all privileges were granted for column \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_GRANTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"not all privileges were granted for \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_grant &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN241"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_REVOKED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no privileges could be revoked for column \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_REVOKED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no privileges could be revoked for \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN236"><span class='Ref_to_Parameter'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN241"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>!= </span><a href="aclchk.c.html#LN237"><span class='Ref_to_Parameter'>privileges</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objkind</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_REVOKED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"not all privileges could be revoked for column \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN239"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WARNING_PRIVILEGE_NOT_REVOKED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"not all privileges could be revoked for \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN238"><span class='Ref_to_Parameter'>objname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN241"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end restrict_and_check_grant &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Called to execute the utility commands GRANT and REVOKE 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN384"></a><span class='Declare_Function'>ExecuteGrantStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1828"><span class='Ref_to_Struct'>GrantStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN386"></a>    <a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Declare_Local'>istmt</span><span class='Delimiter'>; 
</span><a name="LN387"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN388"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errormsg</span><span class='Delimiter'>; 
</span><a name="LN389"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>all_privileges</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Turn the regular GrantStmt into the InternalGrant form. 
     */ 
</span>    <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1831"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Collect the OIDs of the target objects */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1832"><span class='Ref_to_Member'>targtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1806"><span class='Ref_to_EnumConst'>ACL_TARGET_OBJECT</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN118"><span class='Ref_to_Proto'>objectNamesToOids</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1834"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1807"><span class='Ref_to_EnumConst'>ACL_TARGET_ALL_IN_SCHEMA</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN119"><span class='Ref_to_Proto'>objectsInSchemaToOids</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1834"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* ACL_TARGET_DEFAULTS should not be seen here */ 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized GrantStmt.targtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1832"><span class='Ref_to_Member'>targtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* all_privs to be filled below */ 
</span>    <span class='Comment_Multi_Line'>/* privileges to be filled below */ 
</span>    <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* may get filled below */ 
</span>    <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* filled below */ 
</span>    <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1839"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1840"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert the RoleSpec list into an Oid list.  Note that at this point we 
     * insert an ACL_ID_PUBLIC into the list if appropriate, so downstream 
     * there shouldn't be any additional work needed to support this case. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN387"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1838"><span class='Ref_to_Member'>grantees</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN426"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>grantee</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN387"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN427"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantee_uid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN426"><span class='Ref_To_Local'>grantee</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN427"><span class='Ref_To_Local'>grantee_uid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN427"><span class='Ref_To_Local'>grantee_uid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN426"><span class='Ref_To_Local'>grantee</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN427"><span class='Ref_To_Local'>grantee_uid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert stmt-&GT;privileges, a list of AccessPriv nodes, into an AclMode 
     * bitmask.  Note: objtype can't be ACL_OBJECT_COLUMN. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Because this might be a sequence, we test both relation and 
             * sequence bits, and later do a more limited test when we know 
             * the object type. 
             */ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a> <span class='Operator'>| </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for relation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN151"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_DATABASE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for database"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for domain"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN154"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for function"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN155"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LANGUAGE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for language"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN156"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LARGEOBJECT</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for large object"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for schema"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN158"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TABLESPACE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for tablespace"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN152"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FDW</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for foreign-data wrapper"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN153"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FOREIGN_SERVER</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for foreign server"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized GrantStmt.objtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* keep compiler quiet */ 
</span>            <a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch stmt-&GT;objtype &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1836"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * will be turned into ACL_ALL_RIGHTS_* by the internal routines 
         * depending on the object type 
         */ 
</span>        <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN387"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1836"><span class='Ref_to_Member'>privileges</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN525"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Declare_Local'>privnode</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN387"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN526"></a>            <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>priv</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If it's a column-level specification, we just set it aside in 
             * col_privs for the moment; but insist it's for a relation. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN525"><span class='Ref_To_Local'>privnode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1869"><span class='Ref_to_Member'>cols</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN384"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column privileges are only valid for relations"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN525"><span class='Ref_To_Local'>privnode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN525"><span class='Ref_To_Local'>privnode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* parser mistake? */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"AccessPriv node must specify privilege or columns"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN526"><span class='Ref_To_Local'>priv</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN129"><span class='Ref_to_Proto'>string_to_privilege</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN525"><span class='Ref_To_Local'>privnode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN526"><span class='Ref_To_Local'>priv</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN389"><span class='Ref_To_Local'>all_privileges</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN388"><span class='Ref_To_Local'>errormsg</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN130"><span class='Ref_to_Proto'>privilege_to_string</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN526"><span class='Ref_To_Local'>priv</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>|= </span><a href="aclchk.c.html#LN526"><span class='Ref_To_Local'>priv</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="aclchk.c.html#LN103"><span class='Ref_to_Proto'>ExecGrantStmt_oids</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN386"><span class='Ref_To_Local'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecuteGrantStmt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ExecGrantStmt_oids 
 * 
 * Internal entry point for granting and revoking privileges. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN564"></a><span class='Declare_Function'>ExecGrantStmt_oids</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN104"><span class='Ref_to_Proto'>ExecGrant_Relation</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN105"><span class='Ref_to_Proto'>ExecGrant_Database</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN113"><span class='Ref_to_Proto'>ExecGrant_Type</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN106"><span class='Ref_to_Proto'>ExecGrant_Fdw</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN107"><span class='Ref_to_Proto'>ExecGrant_ForeignServer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN108"><span class='Ref_to_Proto'>ExecGrant_Function</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN109"><span class='Ref_to_Proto'>ExecGrant_Language</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN110"><span class='Ref_to_Proto'>ExecGrant_Largeobject</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN111"><span class='Ref_to_Proto'>ExecGrant_Namespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN112"><span class='Ref_to_Proto'>ExecGrant_Tablespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized GrantStmt.objtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch istmt-&GT;objtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Pass the info to event triggers about the just-executed GRANT.  Note 
     * that we prefer to do it after actually executing it, because that gives 
     * the functions a chance to adjust the istmt with privileges actually 
     * granted. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/event_trigger.h.html#LN52"><span class='Ref_to_Proto'>EventTriggerSupportsGrantObjectType</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/commands/event_trigger.h.html#LN77"><span class='Ref_to_Proto'>EventTriggerCollectGrant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN564"><span class='Ref_to_Parameter'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrantStmt_oids &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * objectNamesToOids 
 * 
 * Turn a list of object names of a given type into an Oid list. 
 * 
 * XXX: This function doesn't take any sort of locks on the objects whose 
 * names it looks up.  In the face of concurrent DDL, we might easily latch 
 * onto an old version of an object, causing the GRANT or REVOKE statement 
 * to fail. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN626"></a><span class='Declare_Function'>objectNamesToOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objnames</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN628"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>objects</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN629"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN639"></a>                <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>relvar</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN640"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN640"><span class='Ref_To_Local'>relOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN52"><span class='Ref_to_Macro'>RangeVarGetRelid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN639"><span class='Ref_To_Local'>relvar</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN640"><span class='Ref_To_Local'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN649"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN650"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>dbid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN650"><span class='Ref_To_Local'>dbid</span></a> <span class='Operator'>= </span><a href="../../include/commands/dbcommands.h.html#LN28"><span class='Ref_to_Proto'>get_database_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN649"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN650"><span class='Ref_To_Local'>dbid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN660"></a>                <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typname</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN661"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN661"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN27"><span class='Ref_to_Proto'>typenameTypeId</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/makefuncs.h.html#LN71"><span class='Ref_to_Proto'>makeTypeNameFromNameList</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN660"><span class='Ref_To_Local'>typname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN661"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN670"></a>                <a href="../../include/nodes/parsenodes.h.html#LN1848"><span class='Ref_to_Struct'>ObjectWithArgs</span></a> <span class='Operator'>*</span><span class='Declare_Local'>func</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1848"><span class='Ref_to_Struct'>ObjectWithArgs</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN671"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN671"><span class='Ref_To_Local'>funcid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN64"><span class='Ref_to_Proto'>LookupFuncWithArgs</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN670"><span class='Ref_To_Local'>func</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN671"><span class='Ref_To_Local'>funcid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN680"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>langname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN681"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN681"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/commands/proclang.h.html#LN20"><span class='Ref_to_Proto'>get_language_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN680"><span class='Ref_To_Local'>langname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN681"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN690"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>lobjOid</span> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN68"><span class='Ref_to_Proto'>oidparse</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_largeobject.h.html#LN57"><span class='Ref_to_Proto'>LargeObjectExists</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN690"><span class='Ref_To_Local'>lobjOid</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"large object %u does not exist"</span><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN690"><span class='Ref_To_Local'>lobjOid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN690"><span class='Ref_To_Local'>lobjOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN704"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN705"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN705"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN114"><span class='Ref_to_Proto'>get_namespace_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN704"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN705"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN714"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>spcname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN715"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>spcoid</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN715"><span class='Ref_To_Local'>spcoid</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN714"><span class='Ref_To_Local'>spcname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN715"><span class='Ref_To_Local'>spcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN724"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fdwname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN725"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN81"><span class='Ref_to_Proto'>get_foreign_data_wrapper_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN724"><span class='Ref_To_Local'>fdwname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN725"><span class='Ref_To_Local'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objnames</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN733"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>srvname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN629"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN734"></a>                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>srvid</span> <span class='Operator'>= </span><a href="../../include/foreign/foreign.h.html#LN82"><span class='Ref_to_Proto'>get_foreign_server_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN733"><span class='Ref_To_Local'>srvname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN734"><span class='Ref_To_Local'>srvid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized GrantStmt.objtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN626"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN628"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end objectNamesToOids &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * objectsInSchemaToOids 
 * 
 * Find all objects of a given type in specified schemas, and make a list 
 * of their Oids.  We check USAGE privilege on the schemas, but there is 
 * no privilege checking on the individual objects here. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN755"></a><span class='Declare_Function'>objectsInSchemaToOids</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nspnames</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN757"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>objects</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN758"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN758"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN755"><span class='Ref_to_Parameter'>nspnames</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN762"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN758"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN763"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span><span class='Delimiter'>; 
</span><a name="LN764"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>objs</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN762"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN755"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN120"><span class='Ref_to_Proto'>getRelationsInNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN120"><span class='Ref_to_Proto'>getRelationsInNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN120"><span class='Ref_to_Proto'>getRelationsInNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN120"><span class='Ref_to_Proto'>getRelationsInNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN120"><span class='Ref_to_Proto'>getRelationsInNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN120"><span class='Ref_to_Proto'>getRelationsInNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN764"><span class='Ref_To_Local'>objs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN788"></a>                    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN789"></a>                    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN790"></a>                    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN791"></a>                    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
                    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN788"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                <a href="../../include/catalog/pg_proc.h.html#LN90"><span class='Ref_to_Const'>Anum_pg_proc_pronamespace</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN763"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <a href="aclchk.c.html#LN789"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="aclchk.c.html#LN790"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN110"><span class='Ref_to_Proto'>heap_beginscan_catalog</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN789"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN788"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="aclchk.c.html#LN791"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN790"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN791"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN790"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN789"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* should not happen */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized GrantStmt.objtype: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN755"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN757"><span class='Ref_To_Local'>objects</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end objectsInSchemaToOids &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * getRelationsInNamespace 
 * 
 * Return Oid list of relations in given namespace filtered by relation kind 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN826"></a><span class='Declare_Function'>getRelationsInNamespace</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>namespaceId</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>relkind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN828"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relations</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN829"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN830"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN831"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN832"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN829"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_class.h.html#LN103"><span class='Ref_to_Const'>Anum_pg_class_relnamespace</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN826"><span class='Ref_to_Parameter'>namespaceId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN829"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_class.h.html#LN117"><span class='Ref_to_Const'>Anum_pg_class_relkind</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_CHAREQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN826"><span class='Ref_to_Parameter'>relkind</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN830"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN831"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN110"><span class='Ref_to_Proto'>heap_beginscan_catalog</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN830"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN829"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="aclchk.c.html#LN832"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN831"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN828"><span class='Ref_To_Local'>relations</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN828"><span class='Ref_To_Local'>relations</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN832"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN831"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN830"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN828"><span class='Ref_To_Local'>relations</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getRelationsInNamespace &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER DEFAULT PRIVILEGES statement 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN862"></a><span class='Declare_Function'>ExecAlterDefaultPrivilegesStmt</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1896"><span class='Ref_to_Struct'>AlterDefaultPrivilegesStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN864"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1828"><span class='Ref_to_Struct'>GrantStmt</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>action</span> <span class='Operator'>= </span><a href="aclchk.c.html#LN862"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1900"><span class='Ref_to_Member'>action</span></a><span class='Delimiter'>; 
</span><a name="LN865"></a>    <a href="aclchk.c.html#LN82"><span class='Ref_to_Typedef'>InternalDefaultACL</span></a> <span class='Declare_Local'>iacls</span><span class='Delimiter'>; 
</span><a name="LN866"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rolespecs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN868"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>nspnames</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN869"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>drolespecs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN870"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dnspnames</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN871"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>all_privileges</span><span class='Delimiter'>; 
</span><a name="LN872"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>errormsg</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deconstruct the "options" part of the statement */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN866"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN862"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1899"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN877"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN866"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"schemas"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN870"><span class='Ref_To_Local'>dnspnames</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN862"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN870"><span class='Ref_To_Local'>dnspnames</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"roles"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN869"><span class='Ref_To_Local'>drolespecs</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN862"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN869"><span class='Ref_To_Local'>drolespecs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN877"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN870"><span class='Ref_To_Local'>dnspnames</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN868"><span class='Ref_To_Local'>nspnames</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN870"><span class='Ref_To_Local'>dnspnames</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN869"><span class='Ref_To_Local'>drolespecs</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN867"><span class='Ref_To_Local'>rolespecs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN869"><span class='Ref_To_Local'>drolespecs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare the InternalDefaultACL representation of the statement */ 
</span>    <span class='Comment_Multi_Line'>/* roleid to be filled below */ 
</span>    <span class='Comment_Multi_Line'>/* nspid to be filled in SetDefaultACLsInSchemas */ 
</span>    <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN87"><span class='Ref_to_Member'>is_grant</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1831"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* all_privs to be filled below */ 
</span>    <span class='Comment_Multi_Line'>/* privileges to be filled below */ 
</span>    <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN91"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* filled below */ 
</span>    <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN92"><span class='Ref_to_Member'>grant_option</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1839"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN93"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1840"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert the RoleSpec list into an Oid list.  Note that at this point we 
     * insert an ACL_ID_PUBLIC into the list if appropriate, so downstream 
     * there shouldn't be any additional work needed to support this case. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN866"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1838"><span class='Ref_to_Member'>grantees</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN924"></a>        <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>grantee</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN866"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN925"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantee_uid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN924"><span class='Ref_To_Local'>grantee</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN327"><span class='Ref_to_Member'>roletype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN321"><span class='Ref_to_EnumConst'>ROLESPEC_PUBLIC</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN925"><span class='Ref_To_Local'>grantee_uid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN38"><span class='Ref_to_Const'>ACL_ID_PUBLIC</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN925"><span class='Ref_To_Local'>grantee_uid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN924"><span class='Ref_To_Local'>grantee</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN91"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN91"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN925"><span class='Ref_To_Local'>grantee_uid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert action-&GT;privileges, a list of privilege strings, into an 
     * AclMode bitmask. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for relation"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN154"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for function"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for schema"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized GrantStmt.objtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* keep compiler quiet */ 
</span>            <a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch action-&GT;objtype &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1836"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * will be turned into ACL_ALL_RIGHTS_* by the internal routines 
         * depending on the object type 
         */ 
</span>        <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN90"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN90"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN866"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN864"><span class='Ref_To_Local'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1836"><span class='Ref_to_Member'>privileges</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN990"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Declare_Local'>privnode</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN866"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN991"></a>            <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>priv</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN990"><span class='Ref_To_Local'>privnode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1869"><span class='Ref_to_Member'>cols</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"default privileges cannot be set for columns"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN990"><span class='Ref_To_Local'>privnode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* parser mistake? */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"AccessPriv node must specify privilege"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN991"><span class='Ref_To_Local'>priv</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN129"><span class='Ref_to_Proto'>string_to_privilege</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN990"><span class='Ref_To_Local'>privnode</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN991"><span class='Ref_To_Local'>priv</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN871"><span class='Ref_To_Local'>all_privileges</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN872"><span class='Ref_To_Local'>errormsg</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN130"><span class='Ref_to_Proto'>privilege_to_string</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN991"><span class='Ref_To_Local'>priv</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN90"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>|= </span><a href="aclchk.c.html#LN991"><span class='Ref_To_Local'>priv</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN867"><span class='Ref_To_Local'>rolespecs</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Set permissions for myself */ 
</span>        <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN115"><span class='Ref_to_Proto'>SetDefaultACLsInSchemas</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN868"><span class='Ref_To_Local'>nspnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Look up the role OIDs and do permissions checks */ 
</span><a name="LN1021"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rolecell</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1021"><span class='Ref_To_Local'>rolecell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN867"><span class='Ref_To_Local'>rolespecs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1025"></a>            <a href="../../include/nodes/parsenodes.h.html#LN324"><span class='Ref_to_Struct'>RoleSpec</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>rolespec</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1021"><span class='Ref_To_Local'>rolecell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN236"><span class='Ref_to_Proto'>get_rolespec_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1025"><span class='Ref_To_Local'>rolespec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We insist that calling user be a member of each target role. If 
             * he has that, he could become that role anyway via SET ROLE, so 
             * FOR ROLE is just a syntactic convenience and doesn't give any 
             * special privileges. 
             */ 
</span>            <a href="../../include/utils/acl.h.html#LN233"><span class='Ref_to_Proto'>check_is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN115"><span class='Ref_to_Proto'>SetDefaultACLsInSchemas</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN865"><span class='Ref_To_Local'>iacls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN868"><span class='Ref_To_Local'>nspnames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ExecAlterDefaultPrivilegesStmt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process ALTER DEFAULT PRIVILEGES for a list of target schemas 
 * 
 * All fields of *iacls except nspid were filled already 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1048"></a><span class='Declare_Function'>SetDefaultACLsInSchemas</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN82"><span class='Ref_to_Typedef'>InternalDefaultACL</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>iacls</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nspnames</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1048"><span class='Ref_to_Parameter'>nspnames</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Set database-wide permissions if no schema was specified */ 
</span>        <a href="aclchk.c.html#LN1048"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN116"><span class='Ref_to_Proto'>SetDefaultACL</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1048"><span class='Ref_to_Parameter'>iacls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Look up the schema OIDs and set permissions for each one */ 
</span><a name="LN1060"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nspcell</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1060"><span class='Ref_To_Local'>nspcell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1048"><span class='Ref_to_Parameter'>nspnames</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1064"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1060"><span class='Ref_To_Local'>nspcell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN1048"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN114"><span class='Ref_to_Proto'>get_namespace_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1064"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We used to insist that the target role have CREATE privileges 
             * on the schema, since without that it wouldn't be able to create 
             * an object for which these default privileges would apply. 
             * However, this check proved to be more confusing than helpful, 
             * and it also caused certain database states to not be 
             * dumpable/restorable, since revoking CREATE doesn't cause 
             * default privileges for the schema to go away.  So now, we just 
             * allow the ALTER; if the user lacks CREATE he'll find out when 
             * he tries to create an object. 
             */ 
</span> 
            <a href="aclchk.c.html#LN116"><span class='Ref_to_Proto'>SetDefaultACL</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1048"><span class='Ref_to_Parameter'>iacls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end SetDefaultACLsInSchemas &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Create or update a pg_default_acl entry 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1090"></a><span class='Declare_Function'>SetDefaultACL</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN82"><span class='Ref_to_Typedef'>InternalDefaultACL</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>iacls</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1092"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span> <span class='Operator'>= </span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN90"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>; 
</span><a name="LN1093"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>objtype</span><span class='Delimiter'>; 
</span><a name="LN1094"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1095"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1096"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNew</span><span class='Delimiter'>; 
</span><a name="LN1097"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>def_acl</span><span class='Delimiter'>; 
</span><a name="LN1098"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN1099"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN1100"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN1101"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN52"><span class='Ref_to_Const'>Natts_pg_default_acl</span></a><span class='Delimiter'>]; 
</span><a name="LN1102"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN52"><span class='Ref_to_Const'>Natts_pg_default_acl</span></a><span class='Delimiter'>]; 
</span><a name="LN1103"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN52"><span class='Ref_to_Const'>Natts_pg_default_acl</span></a><span class='Delimiter'>]; 
</span><a name="LN1104"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN1105"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN1106"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN1107"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN1094"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The default for a global entry is the hard-wired default ACL for the 
     * particular object type.  The default for non-global entries is an empty 
     * ACL.  This must be so because global entries replace the hard-wired 
     * defaults, while others are added on. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a><span class='Parentheses'>))</span> 
        <a href="aclchk.c.html#LN1097"><span class='Ref_To_Local'>def_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="aclchk.c.html#LN1097"><span class='Ref_To_Local'>def_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN218"><span class='Ref_to_Proto'>make_empty_acl</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert ACL object type to pg_default_acl object type and handle 
     * all_privs option 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN68"><span class='Ref_to_Const'>DEFACLOBJ_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN69"><span class='Ref_to_Const'>DEFACLOBJ_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN70"><span class='Ref_to_Const'>DEFACLOBJ_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN154"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN71"><span class='Ref_to_Const'>DEFACLOBJ_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot use IN SCHEMA clause when using GRANT/REVOKE ON SCHEMAS"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN72"><span class='Ref_to_Const'>DEFACLOBJ_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized objtype: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch iacls-&GT;objtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Search for existing row for this object type in catalog */ 
</span>    <a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN159"><span class='Ref_to_Macro'>SearchSysCache3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN55"><span class='Ref_to_EnumConst'>DEFACLROLENSPOBJ</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1177"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN1178"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1177"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN55"><span class='Ref_to_EnumConst'>DEFACLROLENSPOBJ</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_default_acl.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN1178"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN1178"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1177"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* this case shouldn't happen, probably */ 
</span>        <a href="aclchk.c.html#LN1096"><span class='Ref_To_Local'>isNew</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1096"><span class='Ref_To_Local'>isNew</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information.  Collect data before 
         * merge_acl_with_grant throws away old_acl. 
         */ 
</span>        <a href="aclchk.c.html#LN1104"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1106"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If no or null entry, start with the default ACL value */ 
</span>        <a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN219"><span class='Ref_to_Proto'>aclcopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1097"><span class='Ref_To_Local'>def_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>        <a href="aclchk.c.html#LN1104"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1106"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate new ACL.  Grantor of rights is always the same as the target 
     * role. 
     */ 
</span>    <a href="aclchk.c.html#LN1099"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1098"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN87"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN92"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN93"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN91"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1092"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the result is the same as the default value, we do not need an 
     * explicit pg_default_acl entry, and should in fact remove the entry if 
     * it exists.  Must sort both arrays to compare properly. 
     */ 
</span>    <a href="../../include/utils/acl.h.html#LN222"><span class='Ref_to_Proto'>aclitemsort</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1099"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/acl.h.html#LN222"><span class='Ref_to_Proto'>aclitemsort</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1097"><span class='Ref_To_Local'>def_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN223"><span class='Ref_to_Proto'>aclequal</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1099"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1097"><span class='Ref_To_Local'>def_acl</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* delete old entry, if indeed there is one */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN1096"><span class='Ref_To_Local'>isNew</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1238"></a>            <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The dependency machinery will take care of removing all 
             * associated dependency entries.  We use DROP_RESTRICT since 
             * there shouldn't be anything depending on this entry. 
             */ 
</span>            <a href="aclchk.c.html#LN1238"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1238"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1238"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/dependency.h.html#LN182"><span class='Ref_to_Proto'>performDeletion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN1238"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1654"><span class='Ref_to_EnumConst'>DROP_RESTRICT</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Prepare to insert or update pg_default_acl entry */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1102"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1102"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1103"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1103"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1096"><span class='Ref_To_Local'>isNew</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* insert new entry */ 
</span>            <a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN53"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclrole</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN54"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN55"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclobjtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1093"><span class='Ref_To_Local'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1099"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1094"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1102"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1094"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* update existing entry */ 
</span>            <a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1099"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1103"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_default_acl.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1094"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="aclchk.c.html#LN1101"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1102"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1103"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1094"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* these dependencies don't change in an update */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1096"><span class='Ref_To_Local'>isNew</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* dependency on role */ 
</span>            <a href="pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* dependency on namespace */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1292"></a>                <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN1293"></a>                            <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN1292"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN1292"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN1292"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN1293"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN1293"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN1293"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN1292"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1293"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isNew &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Update the shared dependency ACL info 
         */ 
</span>        <a href="aclchk.c.html#LN1105"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1099"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1107"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN1090"><span class='Ref_to_Parameter'>iacls</span></a><span class='Operator'>-&GT;</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN1104"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1106"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN1105"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1107"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1096"><span class='Ref_To_Local'>isNew</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1100"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1095"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1094"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetDefaultACL &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * RemoveRoleFromObjectACL 
 * 
 * Used by shdepDropOwned to remove mentions of a role in ACLs 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1339"></a><span class='Declare_Function'>RemoveRoleFromObjectACL</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>classid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1343"></a>        <a href="aclchk.c.html#LN82"><span class='Ref_to_Typedef'>InternalDefaultACL</span></a> <span class='Declare_Local'>iacls</span><span class='Delimiter'>; 
</span><a name="LN1344"></a>        <a href="../../include/catalog/pg_default_acl.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_default_acl</span></a> <span class='Declare_Local'>pg_default_acl_tuple</span><span class='Delimiter'>; 
</span><a name="LN1345"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1346"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1347"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN1348"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* first fetch info needed by SetDefaultACL */ 
</span>        <a href="aclchk.c.html#LN1345"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN1346"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>objid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1347"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1345"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN306"><span class='Ref_to_Const'>DefaultAclOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1346"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1348"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1347"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1348"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for default ACL %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>objid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1344"><span class='Ref_To_Local'>pg_default_acl_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN45"><span class='Ref_to_Typedef'>Form_pg_default_acl</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1348"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN84"><span class='Ref_to_Member'>roleid</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN1344"><span class='Ref_To_Local'>pg_default_acl_tuple</span></a><span class='Operator'>-&GT;</span>defaclrole<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN85"><span class='Ref_to_Member'>nspid</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN1344"><span class='Ref_To_Local'>pg_default_acl_tuple</span></a><span class='Operator'>-&GT;</span>defaclnamespace<span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1344"><span class='Ref_To_Local'>pg_default_acl_tuple</span></a><span class='Operator'>-&GT;</span>defaclobjtype<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_default_acl.h.html#LN68"><span class='Ref_to_Const'>DEFACLOBJ_RELATION</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_default_acl.h.html#LN69"><span class='Ref_to_Const'>DEFACLOBJ_SEQUENCE</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_default_acl.h.html#LN70"><span class='Ref_to_Const'>DEFACLOBJ_FUNCTION</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_default_acl.h.html#LN71"><span class='Ref_to_Const'>DEFACLOBJ_TYPE</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_default_acl.h.html#LN72"><span class='Ref_to_Const'>DEFACLOBJ_NAMESPACE</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN88"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Shouldn't get here */ 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected default ACL type: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN1344"><span class='Ref_To_Local'>pg_default_acl_tuple</span></a><span class='Operator'>-&GT;</span>defaclobjtype<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch pg_default_acl_tuple-... &raquo; </span> 
 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1347"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1345"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN87"><span class='Ref_to_Member'>is_grant</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN89"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN90"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN91"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN92"><span class='Ref_to_Member'>grant_option</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Operator'>.</span><a href="aclchk.c.html#LN93"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Do it */ 
</span>        <a href="aclchk.c.html#LN116"><span class='Ref_to_Proto'>SetDefaultACL</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN1343"><span class='Ref_To_Local'>iacls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classid==DefaultAclRe... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1410"></a>        <a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Declare_Local'>istmt</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>classid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* it's OK to use RELATION for a sequence */ 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_language.h.html#LN28"><span class='Ref_to_Const'>LanguageRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_largeobject.h.html#LN28"><span class='Ref_to_Const'>LargeObjectRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_tablespace.h.html#LN28"><span class='Ref_to_Const'>TableSpaceRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected object class %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>classid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch classid &raquo; </span> 
        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>objid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1339"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Operator'>.</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN1655"><span class='Ref_to_EnumConst'>DROP_CASCADE</span></a><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN103"><span class='Ref_to_Proto'>ExecGrantStmt_oids</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN1410"><span class='Ref_To_Local'>istmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end RemoveRoleFromObjectACL &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Remove a pg_default_acl entry 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1467"></a><span class='Declare_Function'>RemoveDefaultACLById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>defaclOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1469"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1470"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1471"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN1472"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN1469"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_default_acl.h.html#LN27"><span class='Ref_to_Const'>DefaultAclRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN1470"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1467"><span class='Ref_to_Parameter'>defaclOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN1471"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1469"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN306"><span class='Ref_to_Const'>DefaultAclOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1470"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN1472"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1471"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1472"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for default ACL %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1467"><span class='Ref_to_Parameter'>defaclOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1469"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1472"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1471"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1469"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveDefaultACLById &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * expand_col_privileges 
 * 
 * OR the specified privilege(s) into per-column array entries for each 
 * specified attribute.  The per-column array is indexed starting at 
 * FirstLowInvalidHeapAttributeNumber, up to relation's last attribute. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1504"></a><span class='Declare_Function'>expand_col_privileges</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colnames</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, 
</span><a name="LN1505"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>this_privileges</span><span class='Delimiter'>, 
</span><a name="LN1506"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col_privileges</span><span class='Delimiter'>, 
</span><a name="LN1507"></a>                      <span class='Keyword'>int </span><span class='Declare_Parameter'>num_col_privileges</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1509"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1509"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1504"><span class='Ref_to_Parameter'>colnames</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1513"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1509"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1514"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN87"><span class='Ref_to_Proto'>get_attnum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1504"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1513"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN1513"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1504"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>-= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="aclchk.c.html#LN1514"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&GT;= </span><a href="aclchk.c.html#LN1507"><span class='Ref_to_Parameter'>num_col_privileges</span></a><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"column number out of range"</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* safety check */ 
</span>        <a href="aclchk.c.html#LN1506"><span class='Ref_to_Parameter'>col_privileges</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN1514"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>] </span><span class='Operator'>|= </span><a href="aclchk.c.html#LN1505"><span class='Ref_to_Parameter'>this_privileges</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end expand_col_privileges &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * expand_all_col_privileges 
 * 
 * OR the specified privilege(s) into per-column array entries for each valid 
 * attribute of a relation.  The per-column array is indexed starting at 
 * FirstLowInvalidHeapAttributeNumber, up to relation's last attribute. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1537"></a><span class='Declare_Function'>expand_all_col_privileges</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Parameter'>classForm</span><span class='Delimiter'>, 
</span><a name="LN1538"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>this_privileges</span><span class='Delimiter'>, 
</span><a name="LN1539"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col_privileges</span><span class='Delimiter'>, 
</span><a name="LN1540"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>num_col_privileges</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1542"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>curr_att</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1537"><span class='Ref_to_Parameter'>classForm</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a> <span class='Operator'>&LT; </span><a href="aclchk.c.html#LN1540"><span class='Ref_to_Parameter'>num_col_privileges</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>= </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>         <a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>&LT;= </span><a href="aclchk.c.html#LN1537"><span class='Ref_to_Parameter'>classForm</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span>         <a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1549"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span><a name="LN1550"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isdropped</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Skip OID column if it doesn't exist */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>== </span><a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a> <span class='Operator'>&& !</span><a href="aclchk.c.html#LN1537"><span class='Ref_to_Parameter'>classForm</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Views don't have any system columns at all */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1537"><span class='Ref_to_Parameter'>classForm</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1549"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1537"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1549"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for attribute %d of relation %u"</span><span class='Delimiter'>, 
</span>                 <a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1537"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1550"><span class='Ref_To_Local'>isdropped</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1549"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attisdropped<span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1549"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore dropped columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1550"><span class='Ref_To_Local'>isdropped</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1539"><span class='Ref_to_Parameter'>col_privileges</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN1542"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>] </span><span class='Operator'>|= </span><a href="aclchk.c.html#LN1538"><span class='Ref_to_Parameter'>this_privileges</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for curr_att=FirstLowInva... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end expand_all_col_privileges &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  This processes attributes, but expects to be called from 
 *  ExecGrant_Relation, not directly from ExecGrantStmt. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1587"></a><span class='Declare_Function'>ExecGrant_Attribute</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relOid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>relname</span><span class='Delimiter'>, 
</span><a name="LN1588"></a>                    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>col_privileges</span><span class='Delimiter'>, 
</span><a name="LN1589"></a>                    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>attRelation</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>old_rel_acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1591"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attr_tuple</span><span class='Delimiter'>; 
</span><a name="LN1592"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>pg_attribute_tuple</span><span class='Delimiter'>; 
</span><a name="LN1593"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN1594"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN1595"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>merged_acl</span><span class='Delimiter'>; 
</span><a name="LN1596"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN1597"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN1598"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN1599"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN1600"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_update</span><span class='Delimiter'>; 
</span><a name="LN1601"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN1602"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN1603"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN1604"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN193"><span class='Ref_to_Const'>Natts_pg_attribute</span></a><span class='Delimiter'>]; 
</span><a name="LN1605"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN1606"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN1607"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN1608"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN1591"><span class='Ref_To_Local'>attr_tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1591"><span class='Ref_To_Local'>attr_tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for attribute %d of relation %u"</span><span class='Delimiter'>, 
</span>             <a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN1592"><span class='Ref_To_Local'>pg_attribute_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1591"><span class='Ref_To_Local'>attr_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get working copy of existing ACL. If there's no ACL, substitute the 
     * proper default. 
     */ 
</span>    <a href="aclchk.c.html#LN1596"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1591"><span class='Ref_To_Local'>attr_tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN1597"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1597"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN1593"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1813"><span class='Ref_to_EnumConst'>ACL_OBJECT_COLUMN</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>        <a href="aclchk.c.html#LN1605"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1607"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN1593"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1596"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>        <a href="aclchk.c.html#LN1605"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1593"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1607"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In select_best_grantor we should consider existing table-level ACL bits 
     * as well as the per-column ACL.  Build a new ACL that is their 
     * concatenation.  (This is a bit cheap and dirty compared to merging them 
     * properly with no duplications, but it's all we need here.) 
     */ 
</span>    <a href="aclchk.c.html#LN1595"><span class='Ref_To_Local'>merged_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN220"><span class='Ref_to_Proto'>aclconcat</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1589"><span class='Ref_to_Parameter'>old_rel_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1593"><span class='Ref_To_Local'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>    <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>col_privileges</span></a><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN1595"><span class='Ref_To_Local'>merged_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="aclchk.c.html#LN1598"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1599"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1595"><span class='Ref_To_Local'>merged_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Restrict the privileges to what we can actually grant, and emit the 
     * standards-mandated warning and error messages.  Note: we don't track 
     * whether the user actually used the ALL PRIVILEGES(columns) syntax for 
     * each column; we just approximate it by whether all the possible 
     * privileges are specified now.  Since the all_privs flag only determines 
     * whether a warning is issued, this seems close enough. 
     */ 
</span>    <a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>col_privileges</span></a> <span class='Operator'>= 
</span>        <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1599"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>col_privileges</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN148"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_COLUMN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>col_privileges</span></a><span class='Delimiter'>, 
</span>                                 <a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1598"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a><span class='Delimiter'>, 
</span>                                 <a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>relname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1592"><span class='Ref_To_Local'>pg_attribute_tuple</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Generate new ACL. 
     */ 
</span>    <a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1593"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>col_privileges</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1598"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need the members of both old and new ACLs so we can correct the 
     * shared dependency information. 
     */ 
</span>    <a href="aclchk.c.html#LN1606"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1608"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1602"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1602"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1603"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1603"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1604"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1604"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the updated ACL is empty, we can set attacl to null, and maybe even 
     * avoid an update of the pg_attribute row.  This is worth testing because 
     * we'll come through here multiple times for any relation-level REVOKE, 
     * even if there were never any column GRANTs.  Note we are assuming that 
     * the "default" ACL state for columns is empty. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN1602"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1600"><span class='Ref_To_Local'>need_update</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN1603"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1600"><span class='Ref_To_Local'>need_update</span></a> <span class='Operator'>= !</span><a href="aclchk.c.html#LN1597"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="aclchk.c.html#LN1604"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1600"><span class='Ref_To_Local'>need_update</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN1601"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1591"><span class='Ref_To_Local'>attr_tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1589"><span class='Ref_to_Parameter'>attRelation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN1602"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1603"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1604"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1589"><span class='Ref_to_Parameter'>attRelation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1601"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1601"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/acl.h.html#LN100"><span class='Ref_to_Macro'>ACL_NUM</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1587"><span class='Ref_to_Parameter'>relOid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN1588"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN1605"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1607"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN1606"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1608"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1594"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1591"><span class='Ref_To_Local'>attr_tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Attribute &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  This processes both sequences and non-sequences. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1735"></a><span class='Declare_Function'>ExecGrant_Relation</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1737"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1738"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>attRelation</span><span class='Delimiter'>; 
</span><a name="LN1739"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN1737"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN1738"><span class='Ref_To_Local'>attRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN32"><span class='Ref_to_Const'>AttributeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1739"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1746"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1739"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1747"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN1748"></a>        <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN1749"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN1750"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN1751"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>col_privileges</span><span class='Delimiter'>; 
</span><a name="LN1752"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_col_privileges</span><span class='Delimiter'>; 
</span><a name="LN1753"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_col_privileges</span><span class='Delimiter'>; 
</span><a name="LN1754"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN1755"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_rel_acl</span><span class='Delimiter'>; 
</span><a name="LN1756"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN1757"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN1758"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN1759"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1760"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell_colprivs</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN1759"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1759"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1759"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Not sensible to grant on an index */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is an index"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Composite types aren't tables either */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a composite type"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used GRANT SEQUENCE on a non-sequence? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a> <span class='Operator'>&& 
</span>            <a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a sequence"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Adjust the default permissions based on object type */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The GRANT TABLE syntax can be used for sequences and non-sequences, 
         * so we have to look at the relkind to determine the supported 
         * permissions.  The OR of table and sequence permissions were already 
         * checked. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * For backward compatibility, just throw a warning for 
                 * invalid sequence permissions when using the non-sequence 
                 * GRANT syntax. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Mention the object name because the user needs to know 
                     * which operations succeeded.  This is required because 
                     * WARNING allows the command to continue. 
                     */ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sequence \"%s\" only supports USAGE, SELECT, and UPDATE privileges"</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                    <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="../../include/utils/acl.h.html#LN150"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_SEQUENCE</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_class_tuple-&GT;relki... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="../../include/utils/acl.h.html#LN149"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_RELATION</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * USAGE is the only permission supported by sequences but 
                     * not by non-sequences.  Don't mention the object name 
                     * because we didn't in the combined TABLE | SEQUENCE 
                     * check. 
                     */ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for table"</span><span class='Delimiter'>, 
</span>                                    <span class='String'>"USAGE"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if istmt-&GT;objtype==ACL_O... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Set up array in which we'll accumulate any column privilege bits 
         * that need modification.  The array is indexed such that entry [0] 
         * corresponds to FirstLowInvalidHeapAttributeNumber. 
         */ 
</span>        <a href="aclchk.c.html#LN1752"><span class='Ref_To_Local'>num_col_privileges</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relnatts <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1751"><span class='Ref_To_Local'>col_privileges</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1752"><span class='Ref_To_Local'>num_col_privileges</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1753"><span class='Ref_To_Local'>have_col_privileges</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we are revoking relation privileges that are also column 
         * privileges, we must implicitly revoke them from each column too, 
         * per SQL spec.  (We don't need to implicitly add column privileges 
         * during GRANT because the permissions-checking code always checks 
         * both relation and per-column privileges.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>& </span><a href="../../include/utils/acl.h.html#LN148"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_COLUMN</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN125"><span class='Ref_to_Proto'>expand_all_col_privileges</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Delimiter'>, 
</span>                                      <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>& </span><a href="../../include/utils/acl.h.html#LN148"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_COLUMN</span></a><span class='Delimiter'>, 
</span>                                      <a href="aclchk.c.html#LN1751"><span class='Ref_To_Local'>col_privileges</span></a><span class='Delimiter'>, 
</span>                                      <a href="aclchk.c.html#LN1752"><span class='Ref_To_Local'>num_col_privileges</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1753"><span class='Ref_To_Local'>have_col_privileges</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN1747"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1759"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN1749"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1749"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>                    <a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN1756"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1757"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1747"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN1756"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1757"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Need an extra copy of original rel ACL for column handling */ 
</span>        <a href="aclchk.c.html#LN1755"><span class='Ref_To_Local'>old_rel_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN219"><span class='Ref_to_Proto'>aclcopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Handle relation-level privileges, if any were specified 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1910"></a>            <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN1911"></a>            <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN1912"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN1913"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN1914"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN1915"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN1916"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN101"><span class='Ref_to_Const'>Natts_pg_class</span></a><span class='Delimiter'>]; 
</span><a name="LN1917"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN1918"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span><a name="LN1919"></a>            <a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Local'>aclkind</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>            <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="aclchk.c.html#LN1912"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1910"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>                    <a href="aclchk.c.html#LN1919"><span class='Ref_To_Local'>aclkind</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN182"><span class='Ref_to_EnumConst'>ACL_KIND_SEQUENCE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="aclchk.c.html#LN1919"><span class='Ref_To_Local'>aclkind</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Restrict the privileges to what we can actually grant, and emit 
             * the standards-mandated warning and error messages. 
             */ 
</span>            <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>                <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1910"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                         <a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                         <a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1912"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1919"><span class='Ref_To_Local'>aclkind</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Generate new ACL. 
             */ 
</span>            <a href="aclchk.c.html#LN1911"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1754"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1912"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We need the members of both old and new ACLs so we can correct 
             * the shared dependency information. 
             */ 
</span>            <a href="aclchk.c.html#LN1917"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1911"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1918"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1914"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1914"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1915"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1915"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1916"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1916"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN1916"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1914"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1911"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN1913"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1759"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1737"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="aclchk.c.html#LN1914"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1915"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1916"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1737"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN1913"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1913"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>            <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1911"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>            <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                  <a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                                  <a href="aclchk.c.html#LN1756"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1757"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                                  <a href="aclchk.c.html#LN1917"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1918"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1911"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if this_privileges!=ACL_... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Handle column-level privileges, if any were specified or implied. 
         * We first expand the user-specified column privileges into the 
         * array, and then iterate over all nonempty array entries. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1760"><span class='Ref_To_Local'>cell_colprivs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1997"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Declare_Local'>col_privs</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1865"><span class='Ref_to_Struct'>AccessPriv</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1760"><span class='Ref_To_Local'>cell_colprivs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1997"><span class='Ref_To_Local'>col_privs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN148"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_COLUMN</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN129"><span class='Ref_to_Proto'>string_to_privilege</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1997"><span class='Ref_To_Local'>col_privs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1868"><span class='Ref_to_Member'>priv_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="../../include/utils/acl.h.html#LN148"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_COLUMN</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid privilege type %s for column"</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN130"><span class='Ref_to_Proto'>privilege_to_string</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a> <span class='Operator'>&& 
</span>                <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>((</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * The only column privilege allowed on sequences is SELECT. 
                 * This is a warning not error because we do it that way for 
                 * relation-level privileges. 
                 */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sequence \"%s\" only supports SELECT column privileges"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a><span class='Parentheses'>) </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="aclchk.c.html#LN121"><span class='Ref_to_Proto'>expand_col_privileges</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1997"><span class='Ref_To_Local'>col_privs</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1869"><span class='Ref_to_Member'>cols</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, 
</span>                                  <a href="aclchk.c.html#LN1750"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                  <a href="aclchk.c.html#LN1751"><span class='Ref_To_Local'>col_privileges</span></a><span class='Delimiter'>, 
</span>                                  <a href="aclchk.c.html#LN1752"><span class='Ref_To_Local'>num_col_privileges</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN1753"><span class='Ref_To_Local'>have_col_privileges</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1753"><span class='Ref_To_Local'>have_col_privileges</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2035"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="aclchk.c.html#LN2035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="aclchk.c.html#LN1752"><span class='Ref_To_Local'>num_col_privileges</span></a><span class='Delimiter'>; </span><a href="aclchk.c.html#LN2035"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN1751"><span class='Ref_To_Local'>col_privileges</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN2035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <a href="aclchk.c.html#LN1586"><span class='Ref_to_Func'>ExecGrant_Attribute</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1735"><span class='Ref_to_Parameter'>istmt</span></a><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN1746"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1748"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN2035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN1758"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN1751"><span class='Ref_To_Local'>col_privileges</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN2035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                    <a href="aclchk.c.html#LN1738"><span class='Ref_To_Local'>attRelation</span></a><span class='Delimiter'>, 
</span>                                    <a href="aclchk.c.html#LN1755"><span class='Ref_To_Local'>old_rel_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1755"><span class='Ref_To_Local'>old_rel_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1751"><span class='Ref_To_Local'>col_privileges</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1759"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1738"><span class='Ref_To_Local'>attRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN1737"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Relation &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2066"></a><span class='Declare_Function'>ExecGrant_Database</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2068"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2069"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN151"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_DATABASE</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2068"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2069"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2078"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>datId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2069"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2079"></a>        <a href="../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a> <span class='Declare_Local'>pg_database_tuple</span><span class='Delimiter'>; 
</span><a name="LN2080"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2081"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2082"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2083"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2084"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2085"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2086"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2087"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2088"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2089"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_database.h.html#LN62"><span class='Ref_to_Const'>Natts_pg_database</span></a><span class='Delimiter'>]; 
</span><a name="LN2090"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_database.h.html#LN62"><span class='Ref_to_Const'>Natts_pg_database</span></a><span class='Delimiter'>]; 
</span><a name="LN2091"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_database.h.html#LN62"><span class='Ref_to_Const'>Natts_pg_database</span></a><span class='Delimiter'>]; 
</span><a name="LN2092"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2093"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2094"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2095"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span><a name="LN2096"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2078"><span class='Ref_To_Local'>datId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for database %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2078"><span class='Ref_To_Local'>datId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2079"><span class='Ref_To_Local'>pg_database_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2087"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2079"><span class='Ref_To_Local'>pg_database_tuple</span></a><span class='Operator'>-&GT;</span>datdba<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2080"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_database.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_database_datacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2068"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2081"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2081"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2084"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2087"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2092"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2094"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2084"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2080"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2092"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2084"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2094"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2084"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2087"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2086"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2082"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2083"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2082"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2078"><span class='Ref_To_Local'>datId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2086"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2079"><span class='Ref_To_Local'>pg_database_tuple</span></a><span class='Operator'>-&GT;</span>datname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2085"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2084"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2066"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2083"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2086"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2087"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2093"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2085"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2095"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2091"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2091"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2091"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_database.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_database_datacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_database.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_database_datacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2085"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2088"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2068"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2091"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2068"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2088"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2088"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_database.h.html#LN28"><span class='Ref_to_Const'>DatabaseRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2087"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2092"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2094"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2093"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2095"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2096"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2085"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2068"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Database &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2186"></a><span class='Declare_Function'>ExecGrant_Fdw</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2188"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2189"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN152"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FDW</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2188"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2189"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2198"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fdwid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2189"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2199"></a>        <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a> <span class='Declare_Local'>pg_fdw_tuple</span><span class='Delimiter'>; 
</span><a name="LN2200"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2201"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2202"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2203"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2204"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2205"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2206"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2207"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2208"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2209"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2210"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN2211"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN2212"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN55"><span class='Ref_to_Const'>Natts_pg_foreign_data_wrapper</span></a><span class='Delimiter'>]; 
</span><a name="LN2213"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2214"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2215"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2216"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2198"><span class='Ref_To_Local'>fdwid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for foreign-data wrapper %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2198"><span class='Ref_To_Local'>fdwid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2199"><span class='Ref_To_Local'>pg_fdw_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2207"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2199"><span class='Ref_To_Local'>pg_fdw_tuple</span></a><span class='Operator'>-&GT;</span>fdwowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2200"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN2201"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2201"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2204"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2207"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2213"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2215"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2204"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2200"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2213"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2204"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2215"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2204"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2207"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2206"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2202"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2203"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2202"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2198"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2206"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN198"><span class='Ref_to_EnumConst'>ACL_KIND_FDW</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2199"><span class='Ref_To_Local'>pg_fdw_tuple</span></a><span class='Operator'>-&GT;</span>fdwname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2205"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2204"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2186"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2203"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2206"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2207"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2214"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2205"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2216"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2210"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2210"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2211"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2211"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2212"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2212"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2212"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2210"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2205"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2209"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2188"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2210"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2211"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2212"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2188"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2209"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2209"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2198"><span class='Ref_To_Local'>fdwid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                <a href="aclchk.c.html#LN2205"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2207"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2213"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2215"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2214"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2216"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2208"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2205"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2188"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Fdw &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2313"></a><span class='Declare_Function'>ExecGrant_ForeignServer</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2315"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2316"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN153"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FOREIGN_SERVER</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2315"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2316"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2325"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>srvid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2316"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2326"></a>        <a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a> <span class='Declare_Local'>pg_server_tuple</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2329"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2330"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2331"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2332"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2333"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2334"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2335"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2336"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2337"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN2338"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN2339"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN54"><span class='Ref_to_Const'>Natts_pg_foreign_server</span></a><span class='Delimiter'>]; 
</span><a name="LN2340"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2341"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2342"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2343"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2325"><span class='Ref_To_Local'>srvid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for foreign server %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2325"><span class='Ref_To_Local'>srvid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2326"><span class='Ref_To_Local'>pg_server_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2334"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2326"><span class='Ref_To_Local'>pg_server_tuple</span></a><span class='Operator'>-&GT;</span>srvowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2327"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN2328"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2328"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2331"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2334"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2340"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2342"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2331"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2327"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2340"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2331"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2342"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2331"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2334"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2333"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2329"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2330"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2329"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                   <a href="aclchk.c.html#LN2325"><span class='Ref_To_Local'>srvid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2333"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2326"><span class='Ref_To_Local'>pg_server_tuple</span></a><span class='Operator'>-&GT;</span>srvname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2332"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2331"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2313"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2330"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2333"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2334"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2341"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2332"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2343"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2337"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2337"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2338"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2338"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2339"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2339"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2339"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2337"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2332"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2336"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2315"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2337"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2338"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2339"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2315"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2336"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2336"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2325"><span class='Ref_To_Local'>srvid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2332"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2334"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2340"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2342"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2341"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2343"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2335"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2332"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2315"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_ForeignServer &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2438"></a><span class='Declare_Function'>ExecGrant_Function</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2440"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2441"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN154"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_FUNCTION</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2440"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2441"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2450"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2441"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2451"></a>        <a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a> <span class='Declare_Local'>pg_proc_tuple</span><span class='Delimiter'>; 
</span><a name="LN2452"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2453"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2454"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2455"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2456"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2457"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2458"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2459"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2460"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2461"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2462"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_proc.h.html#LN88"><span class='Ref_to_Const'>Natts_pg_proc</span></a><span class='Delimiter'>]; 
</span><a name="LN2463"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_proc.h.html#LN88"><span class='Ref_to_Const'>Natts_pg_proc</span></a><span class='Delimiter'>]; 
</span><a name="LN2464"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_proc.h.html#LN88"><span class='Ref_to_Const'>Natts_pg_proc</span></a><span class='Delimiter'>]; 
</span><a name="LN2465"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2466"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2467"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2468"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2460"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2450"><span class='Ref_To_Local'>funcId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2460"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2450"><span class='Ref_To_Local'>funcId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2451"><span class='Ref_To_Local'>pg_proc_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2460"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2459"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2451"><span class='Ref_To_Local'>pg_proc_tuple</span></a><span class='Operator'>-&GT;</span>proowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2452"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2460"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_proc.h.html#LN117"><span class='Ref_to_Const'>Anum_pg_proc_proacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN2453"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2453"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2456"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2459"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2465"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2467"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2456"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2452"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2465"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2456"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2467"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2456"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2459"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2458"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2454"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2455"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2454"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2450"><span class='Ref_To_Local'>funcId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2458"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2451"><span class='Ref_To_Local'>pg_proc_tuple</span></a><span class='Operator'>-&GT;</span>proname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2457"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2456"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2438"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2455"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2458"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2459"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2466"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2457"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2468"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2462"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2462"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2463"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2463"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2464"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2464"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2464"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_proc.h.html#LN117"><span class='Ref_to_Const'>Anum_pg_proc_proacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2462"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_proc.h.html#LN117"><span class='Ref_to_Const'>Anum_pg_proc_proacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2457"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2461"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2460"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2440"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2462"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2463"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2464"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2440"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2461"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2461"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2450"><span class='Ref_To_Local'>funcId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2457"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2450"><span class='Ref_To_Local'>funcId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2459"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2465"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2467"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2466"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2468"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2460"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2457"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2440"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Function &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2561"></a><span class='Declare_Function'>ExecGrant_Language</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2563"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2564"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN155"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LANGUAGE</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2563"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_language.h.html#LN28"><span class='Ref_to_Const'>LanguageRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2564"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2573"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>langId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2564"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2574"></a>        <a href="../../include/catalog/pg_language.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_language</span></a> <span class='Declare_Local'>pg_language_tuple</span><span class='Delimiter'>; 
</span><a name="LN2575"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2576"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2577"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2578"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2579"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2580"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2581"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2582"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2583"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2584"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2585"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_language.h.html#LN56"><span class='Ref_to_Const'>Natts_pg_language</span></a><span class='Delimiter'>]; 
</span><a name="LN2586"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_language.h.html#LN56"><span class='Ref_to_Const'>Natts_pg_language</span></a><span class='Delimiter'>]; 
</span><a name="LN2587"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_language.h.html#LN56"><span class='Ref_to_Const'>Natts_pg_language</span></a><span class='Delimiter'>]; 
</span><a name="LN2588"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2589"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2590"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2591"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2573"><span class='Ref_To_Local'>langId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for language %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2573"><span class='Ref_To_Local'>langId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2574"><span class='Ref_To_Local'>pg_language_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_language.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_language</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN2574"><span class='Ref_To_Local'>pg_language_tuple</span></a><span class='Operator'>-&GT;</span>lanpltrusted<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"language \"%s\" is not trusted"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2574"><span class='Ref_To_Local'>pg_language_tuple</span></a><span class='Operator'>-&GT;</span>lanname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"GRANT and REVOKE are not allowed on untrusted languages, "</span> 
                   <span class='String'>"because only superusers can use untrusted languages."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2582"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2574"><span class='Ref_To_Local'>pg_language_tuple</span></a><span class='Operator'>-&GT;</span>lanowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2575"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN66"><span class='Ref_to_EnumConst'>LANGNAME</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_language.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_language_lanacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN2576"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2576"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2579"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2582"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2588"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2590"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2579"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2575"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2588"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2579"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2590"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2579"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2582"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2581"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2577"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2578"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2577"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2573"><span class='Ref_To_Local'>langId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2581"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN187"><span class='Ref_to_EnumConst'>ACL_KIND_LANGUAGE</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2574"><span class='Ref_To_Local'>pg_language_tuple</span></a><span class='Operator'>-&GT;</span>lanname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2580"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2579"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2561"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2578"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2581"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2582"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2589"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2580"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2591"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2585"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2585"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2586"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2586"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2587"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2587"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2587"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_language.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_language_lanacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2585"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_language.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_language_lanacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2580"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2584"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2563"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2585"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2586"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2587"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2563"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2584"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2584"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2573"><span class='Ref_To_Local'>langId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_language.h.html#LN28"><span class='Ref_to_Const'>LanguageRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2580"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_language.h.html#LN28"><span class='Ref_to_Const'>LanguageRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2582"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2588"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2590"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2589"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2591"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2583"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2580"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2563"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Language &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2692"></a><span class='Declare_Function'>ExecGrant_Largeobject</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2694"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2695"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN156"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_LARGEOBJECT</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2694"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN28"><span class='Ref_to_Const'>LargeObjectMetadataRelationId</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2695"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2705"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>loid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2695"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2706"></a>        <a href="../../include/catalog/pg_largeobject_metadata.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_largeobject_metadata</span></a> <span class='Declare_Local'>form_lo_meta</span><span class='Delimiter'>; 
</span><a name="LN2707"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>loname</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span><a name="LN2708"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2709"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2710"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2711"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2712"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2713"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2714"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2715"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2716"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2717"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_largeobject_metadata</span></a><span class='Delimiter'>]; 
</span><a name="LN2718"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_largeobject_metadata</span></a><span class='Delimiter'>]; 
</span><a name="LN2719"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN50"><span class='Ref_to_Const'>Natts_pg_largeobject_metadata</span></a><span class='Delimiter'>]; 
</span><a name="LN2720"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2721"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2722"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2723"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span><a name="LN2724"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2725"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN2726"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* There's no syscache for pg_largeobject_metadata */ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN2724"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2705"><span class='Ref_To_Local'>loid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2725"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2694"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/indexing.h.html#LN182"><span class='Ref_to_Const'>LargeObjectMetadataOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2724"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2726"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2725"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2726"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for large object %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2705"><span class='Ref_To_Local'>loid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2706"><span class='Ref_To_Local'>form_lo_meta</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_largeobject_metadata</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2726"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2715"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2706"><span class='Ref_To_Local'>form_lo_meta</span></a><span class='Operator'>-&GT;</span>lomowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2708"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2726"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_largeobject_metadata.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_largeobject_metadata_lomacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2694"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2709"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2709"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2712"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2715"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2720"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2722"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2712"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2708"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2720"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2712"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2722"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2712"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2715"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2714"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2710"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2707"><span class='Ref_To_Local'>loname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2707"><span class='Ref_To_Local'>loname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"large object %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2705"><span class='Ref_To_Local'>loid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2711"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2710"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2705"><span class='Ref_To_Local'>loid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2714"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN188"><span class='Ref_to_EnumConst'>ACL_KIND_LARGEOBJECT</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2707"><span class='Ref_To_Local'>loname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2713"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2712"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2692"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2711"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2714"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2715"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2721"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2713"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2723"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2717"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2717"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2718"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2718"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2719"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2719"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2719"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_largeobject_metadata_lomacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2717"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_largeobject_metadata_lomacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] 
</span>            <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2713"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2716"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2726"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2694"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2717"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2718"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2719"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2694"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2716"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2716"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2705"><span class='Ref_To_Local'>loid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_largeobject.h.html#LN28"><span class='Ref_to_Const'>LargeObjectRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2713"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_largeobject.h.html#LN28"><span class='Ref_to_Const'>LargeObjectRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2726"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2715"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2720"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2722"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2721"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2723"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2725"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2713"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2694"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Largeobject &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2832"></a><span class='Declare_Function'>ExecGrant_Namespace</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2834"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2835"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2834"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2835"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2844"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2835"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2845"></a>        <a href="../../include/catalog/pg_namespace.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_namespace</span></a> <span class='Declare_Local'>pg_namespace_tuple</span><span class='Delimiter'>; 
</span><a name="LN2846"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2847"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2848"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2849"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2850"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2851"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2852"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2853"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2854"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2855"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2856"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_namespace.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_namespace</span></a><span class='Delimiter'>]; 
</span><a name="LN2857"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_namespace.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_namespace</span></a><span class='Delimiter'>]; 
</span><a name="LN2858"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_namespace.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_namespace</span></a><span class='Delimiter'>]; 
</span><a name="LN2859"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2860"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2861"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2862"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2844"><span class='Ref_To_Local'>nspid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for namespace %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2844"><span class='Ref_To_Local'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2845"><span class='Ref_To_Local'>pg_namespace_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_namespace.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_namespace</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2853"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2845"><span class='Ref_To_Local'>pg_namespace_tuple</span></a><span class='Operator'>-&GT;</span>nspowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2846"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN68"><span class='Ref_to_EnumConst'>NAMESPACENAME</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_namespace.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_namespace_nspacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN2847"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2847"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2850"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2853"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2859"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2861"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2850"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2846"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2859"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2850"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2861"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2850"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2853"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2852"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2848"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2849"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2848"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2844"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2852"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2845"><span class='Ref_To_Local'>pg_namespace_tuple</span></a><span class='Operator'>-&GT;</span>nspname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2851"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2850"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2832"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2849"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2852"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2853"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2860"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2851"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2862"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2856"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2856"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2857"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2857"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2858"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2858"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2858"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_namespace.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_namespace_nspacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2856"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_namespace.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_namespace_nspacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2851"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2855"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2834"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2856"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2857"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2858"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2834"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2855"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2855"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2844"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2851"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2853"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2859"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2861"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2860"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2862"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2854"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2851"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2834"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Namespace &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2956"></a><span class='Declare_Function'>ExecGrant_Tablespace</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2958"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN2959"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN158"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TABLESPACE</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN2958"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_tablespace.h.html#LN28"><span class='Ref_to_Const'>TableSpaceRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2959"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2968"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tblId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2959"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2969"></a>        <a href="../../include/catalog/pg_tablespace.h.html#LN46"><span class='Ref_to_Typedef'>Form_pg_tablespace</span></a> <span class='Declare_Local'>pg_tablespace_tuple</span><span class='Delimiter'>; 
</span><a name="LN2970"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN2971"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN2972"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN2973"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN2974"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN2975"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN2976"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN2977"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN2978"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN2979"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_tablespace.h.html#LN53"><span class='Ref_to_Const'>Natts_pg_tablespace</span></a><span class='Delimiter'>]; 
</span><a name="LN2980"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_tablespace.h.html#LN53"><span class='Ref_to_Const'>Natts_pg_tablespace</span></a><span class='Delimiter'>]; 
</span><a name="LN2981"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_tablespace.h.html#LN53"><span class='Ref_to_Const'>Natts_pg_tablespace</span></a><span class='Delimiter'>]; 
</span><a name="LN2982"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN2983"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN2984"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN2985"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span><a name="LN2986"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Search syscache for pg_tablespace */ 
</span>        <a href="aclchk.c.html#LN2986"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN94"><span class='Ref_to_EnumConst'>TABLESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2968"><span class='Ref_To_Local'>tblId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2986"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for tablespace %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2968"><span class='Ref_To_Local'>tblId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2969"><span class='Ref_To_Local'>pg_tablespace_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_tablespace.h.html#LN46"><span class='Ref_to_Typedef'>Form_pg_tablespace</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2986"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN2977"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN2969"><span class='Ref_To_Local'>pg_tablespace_tuple</span></a><span class='Operator'>-&GT;</span>spcowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2970"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2986"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_tablespace.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_tablespace_spcacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2958"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2971"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN2971"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2974"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2977"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN2982"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN2984"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN2974"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2970"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN2982"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2974"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2984"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN2974"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2977"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN2976"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2972"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN2973"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2972"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2968"><span class='Ref_To_Local'>tblId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2976"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2969"><span class='Ref_To_Local'>pg_tablespace_tuple</span></a><span class='Operator'>-&GT;</span>spcname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN2975"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2974"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2956"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2973"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN2976"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2977"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN2983"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2975"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2985"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2979"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2979"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2980"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2980"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2981"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2981"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2981"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_tablespace.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_tablespace_spcacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN2979"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_tablespace.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_tablespace_spcacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2975"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN2978"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2986"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2958"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2979"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN2980"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2981"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2958"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN2978"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2978"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_tablespace.h.html#LN28"><span class='Ref_to_Const'>TableSpaceRelationId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2968"><span class='Ref_To_Local'>tblId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2977"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2982"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2984"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN2983"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN2985"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2986"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2975"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN2958"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Tablespace &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3076"></a><span class='Declare_Function'>ExecGrant_Type</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3078"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN3079"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a> <span class='Operator'>&& </span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN159"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_TYPE</span></a><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3078"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3079"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3088"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typId</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3079"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3089"></a>        <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>pg_type_tuple</span><span class='Delimiter'>; 
</span><a name="LN3090"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3091"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3092"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>avail_goptions</span><span class='Delimiter'>; 
</span><a name="LN3093"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>this_privileges</span><span class='Delimiter'>; 
</span><a name="LN3094"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>old_acl</span><span class='Delimiter'>; 
</span><a name="LN3095"></a>        <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>new_acl</span><span class='Delimiter'>; 
</span><a name="LN3096"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>grantorId</span><span class='Delimiter'>; 
</span><a name="LN3097"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span><a name="LN3098"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>newtuple</span><span class='Delimiter'>; 
</span><a name="LN3099"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN3100"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN3101"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN3102"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>noldmembers</span><span class='Delimiter'>; 
</span><a name="LN3103"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nnewmembers</span><span class='Delimiter'>; 
</span><a name="LN3104"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oldmembers</span><span class='Delimiter'>; 
</span><a name="LN3105"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>newmembers</span><span class='Delimiter'>; 
</span><a name="LN3106"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Search syscache for pg_type */ 
</span>        <a href="aclchk.c.html#LN3106"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3088"><span class='Ref_To_Local'>typId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3106"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3088"><span class='Ref_To_Local'>typId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3106"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a><span class='Operator'>-&GT;</span>typelem <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a><span class='Operator'>-&GT;</span>typlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_GRANT_OPERATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot set privileges of array types"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Set the privileges of the element type instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Used GRANT DOMAIN on a non-domain? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a> <span class='Operator'>&& 
</span>            <a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a domain"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get owner ID and working copy of existing ACL. If there's no ACL, 
         * substitute the proper default. 
         */ 
</span>        <a href="aclchk.c.html#LN3097"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a><span class='Operator'>-&GT;</span>typowner<span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3090"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3106"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3078"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN3091"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3091"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN3094"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN33"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3097"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* There are no old member roles according to the catalogs */ 
</span>            <a href="aclchk.c.html#LN3102"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN3104"><span class='Ref_To_Local'>oldmembers</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN3094"><span class='Ref_To_Local'>old_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3090"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Get the roles mentioned in the existing ACL */ 
</span>            <a href="aclchk.c.html#LN3102"><span class='Ref_To_Local'>noldmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3094"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN3104"><span class='Ref_To_Local'>oldmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Determine ID to do the grant as, and available grant options */ 
</span>        <a href="../../include/utils/acl.h.html#LN241"><span class='Ref_to_Proto'>select_best_grantor</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                            <a href="aclchk.c.html#LN3094"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3097"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="aclchk.c.html#LN3096"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN3092"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Restrict the privileges to what we can actually grant, and emit the 
         * standards-mandated warning and error messages. 
         */ 
</span>        <a href="aclchk.c.html#LN3093"><span class='Ref_To_Local'>this_privileges</span></a> <span class='Operator'>= 
</span>            <a href="aclchk.c.html#LN131"><span class='Ref_to_Proto'>restrict_and_check_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3092"><span class='Ref_To_Local'>avail_goptions</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN35"><span class='Ref_to_Member'>all_privs</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN36"><span class='Ref_to_Member'>privileges</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN3088"><span class='Ref_To_Local'>typId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3096"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN186"><span class='Ref_to_EnumConst'>ACL_KIND_TYPE</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3089"><span class='Ref_To_Local'>pg_type_tuple</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate new ACL. 
         */ 
</span>        <a href="aclchk.c.html#LN3095"><span class='Ref_To_Local'>new_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN169"><span class='Ref_to_Func'>merge_acl_with_grant</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3094"><span class='Ref_To_Local'>old_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN32"><span class='Ref_to_Member'>is_grant</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN39"><span class='Ref_to_Member'>grant_option</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN40"><span class='Ref_to_Member'>behavior</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN3076"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3093"><span class='Ref_To_Local'>this_privileges</span></a><span class='Delimiter'>, 
</span>                                       <a href="aclchk.c.html#LN3096"><span class='Ref_To_Local'>grantorId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3097"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need the members of both old and new ACLs so we can correct the 
         * shared dependency information. 
         */ 
</span>        <a href="aclchk.c.html#LN3103"><span class='Ref_To_Local'>nnewmembers</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN227"><span class='Ref_to_Proto'>aclmembers</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3095"><span class='Ref_To_Local'>new_acl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN3105"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* finished building new ACL value, now insert it */ 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3099"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3099"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3100"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3100"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3101"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3101"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN3101"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3099"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3095"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN3098"><span class='Ref_To_Local'>newtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3106"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3078"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3099"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                     <a href="aclchk.c.html#LN3100"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3101"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3078"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN3098"><span class='Ref_To_Local'>newtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3098"><span class='Ref_To_Local'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update initial privileges for extensions */ 
</span>        <a href="aclchk.c.html#LN138"><span class='Ref_to_Proto'>recordExtensionInitPriv</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3088"><span class='Ref_To_Local'>typId</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3095"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the shared dependency ACL info */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN262"><span class='Ref_to_Proto'>updateAclDependencies</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3088"><span class='Ref_To_Local'>typId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN3097"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN3102"><span class='Ref_To_Local'>noldmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3104"><span class='Ref_To_Local'>oldmembers</span></a><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN3103"><span class='Ref_To_Local'>nnewmembers</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3105"><span class='Ref_To_Local'>newmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3106"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3095"><span class='Ref_To_Local'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* prevent error when processing duplicate objects */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3078"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecGrant_Type &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3214"></a><span class='Declare_Function'>string_to_privilege</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>privname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"insert"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"select"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"update"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"delete"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"truncate"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"references"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"trigger"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"execute"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"usage"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"create"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"temporary"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"temp"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"connect"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Delimiter'>, </span><span class='String'>"rule"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* ignore old RULE privileges */ 
</span>    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized privilege type \"%s\""</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3214"><span class='Ref_to_Parameter'>privname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* appease compiler */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end string_to_privilege &raquo; </span> 
 
<span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3251"></a><span class='Declare_Function'>privilege_to_string</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>privilege</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3251"><span class='Ref_to_Parameter'>privilege</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"INSERT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SELECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"UPDATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"DELETE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TRUNCATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN76"><span class='Ref_to_Const'>ACL_REFERENCES</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"REFERENCES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN77"><span class='Ref_to_Const'>ACL_TRIGGER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TRIGGER"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN78"><span class='Ref_to_Const'>ACL_EXECUTE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"EXECUTE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"USAGE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"CREATE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TEMP"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"CONNECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized privilege: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3251"><span class='Ref_to_Parameter'>privilege</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch privilege &raquo; </span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* appease compiler */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end privilege_to_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Standardized reporting of aclcheck permissions failures. 
 * 
 * Note: we do not double-quote the %s's below, because many callers 
 * supply strings that might be already quoted. 
 */ 
</span> 
<a name="LN3292"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>no_priv_msg</span><span class='Delimiter'>[</span><a href="../../include/utils/acl.h.html#LN204"><span class='Ref_to_EnumConst'>MAX_ACL_KIND</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_COLUMN */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for column %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_CLASS */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for relation %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_SEQUENCE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for sequence %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_DATABASE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for database %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_PROC */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for function %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_OPER */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for operator %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TYPE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for type %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_LANGUAGE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for language %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_LARGEOBJECT */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for large object %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_NAMESPACE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for schema %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_OPCLASS */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for operator class %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_OPFAMILY */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for operator family %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_COLLATION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for collation %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_CONVERSION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for conversion %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_STATISTICS */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for statistics object %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TABLESPACE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for tablespace %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TSDICTIONARY */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for text search dictionary %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TSCONFIGURATION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for text search configuration %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_FDW */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for foreign-data wrapper %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_FOREIGN_SERVER */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for foreign server %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_EVENT_TRIGGER */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for event trigger %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_EXTENSION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for extension %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_PUBLICATION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for publication %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_SUBSCRIPTION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for subscription %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
}; 
</span> 
<a name="LN3344"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>not_owner_msg</span><span class='Delimiter'>[</span><a href="../../include/utils/acl.h.html#LN204"><span class='Ref_to_EnumConst'>MAX_ACL_KIND</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_COLUMN */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of relation %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_CLASS */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of relation %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_SEQUENCE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of sequence %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_DATABASE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of database %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_PROC */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of function %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_OPER */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of operator %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TYPE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of type %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_LANGUAGE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of language %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_LARGEOBJECT */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of large object %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_NAMESPACE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of schema %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_OPCLASS */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of operator class %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_OPFAMILY */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of operator family %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_COLLATION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of collation %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_CONVERSION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of conversion %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_STATISTICS */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of statistics object %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TABLESPACE */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of tablespace %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TSDICTIONARY */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of text search dictionary %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_TSCONFIGURATION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of text search configuration %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_FDW */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of foreign-data wrapper %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_FOREIGN_SERVER */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of foreign server %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_EVENT_TRIGGER */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of event trigger %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_EXTENSION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of extension %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_PUBLICATION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of publication %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>    <span class='Comment_Multi_Line'>/* ACL_KIND_SUBSCRIPTION */ 
</span>    <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"must be owner of subscription %s"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
}; 
</span> 
 
<span class='Keyword'>void 
</span><a name="LN3398"></a><span class='Declare_Function'>aclcheck_error</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> <span class='Declare_Parameter'>aclerr</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Parameter'>objectkind</span><span class='Delimiter'>, 
</span><a name="LN3399"></a>               <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>objectname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3398"><span class='Ref_to_Parameter'>aclerr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no error, so return to caller */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3292"><span class='Ref_to_Global_Var'>no_priv_msg</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN3398"><span class='Ref_to_Parameter'>objectkind</span></a><span class='Delimiter'>], </span><a href="aclchk.c.html#LN3399"><span class='Ref_to_Parameter'>objectname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3344"><span class='Ref_to_Global_Var'>not_owner_msg</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN3398"><span class='Ref_to_Parameter'>objectkind</span></a><span class='Delimiter'>], </span><a href="aclchk.c.html#LN3399"><span class='Ref_to_Parameter'>objectname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized AclResult: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3398"><span class='Ref_to_Parameter'>aclerr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end aclcheck_error &raquo; </span> 
 
 
<span class='Keyword'>void 
</span><a name="LN3424"></a><span class='Declare_Function'>aclcheck_error_col</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> <span class='Declare_Parameter'>aclerr</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Parameter'>objectkind</span><span class='Delimiter'>, 
</span><a name="LN3425"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>objectname</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3424"><span class='Ref_to_Parameter'>aclerr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no error, so return to caller */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Operator'>: 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied for column \"%s\" of relation \"%s\""</span><span class='Delimiter'>, 
</span>                    <a href="aclchk.c.html#LN3425"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3425"><span class='Ref_to_Parameter'>objectname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* relation msg is OK since columns don't have separate owners */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3344"><span class='Ref_to_Global_Var'>not_owner_msg</span></a><span class='Delimiter'>[</span><a href="aclchk.c.html#LN3424"><span class='Ref_to_Parameter'>objectkind</span></a><span class='Delimiter'>], </span><a href="aclchk.c.html#LN3425"><span class='Ref_to_Parameter'>objectname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized AclResult: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3424"><span class='Ref_to_Parameter'>aclerr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch aclerr &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end aclcheck_error_col &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Special common handling for types: use element type instead of array type, 
 * and format nicely 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3456"></a><span class='Declare_Function'>aclcheck_error_type</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> <span class='Declare_Parameter'>aclerr</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3458"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3456"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3456"><span class='Ref_to_Parameter'>aclerr</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN186"><span class='Ref_to_EnumConst'>ACL_KIND_TYPE</span></a><span class='Delimiter'>, </span><a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3458"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>? </span><a href="aclchk.c.html#LN3458"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>: </span><a href="aclchk.c.html#LN3456"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Relay for the various pg_*_mask routines depending on object kind 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3468"></a><span class='Declare_Function'>pg_aclmask</span><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN178"><span class='Ref_to_Enum'>AclObjectKind</span></a> <span class='Declare_Parameter'>objkind</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3469"></a>           <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>objkind</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN180"><span class='Ref_to_EnumConst'>ACL_KIND_COLUMN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> 
                <a href="../../include/utils/acl.h.html#LN258"><span class='Ref_to_Proto'>pg_class_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                <a href="../../include/utils/acl.h.html#LN256"><span class='Ref_to_Proto'>pg_attribute_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN181"><span class='Ref_to_EnumConst'>ACL_KIND_CLASS</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN182"><span class='Ref_to_EnumConst'>ACL_KIND_SEQUENCE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN258"><span class='Ref_to_Proto'>pg_class_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN260"><span class='Ref_to_Proto'>pg_database_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN184"><span class='Ref_to_EnumConst'>ACL_KIND_PROC</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN262"><span class='Ref_to_Proto'>pg_proc_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN187"><span class='Ref_to_EnumConst'>ACL_KIND_LANGUAGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN264"><span class='Ref_to_Proto'>pg_language_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN188"><span class='Ref_to_EnumConst'>ACL_KIND_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN266"><span class='Ref_to_Proto'>pg_largeobject_aclmask_snapshot</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, 
</span>                                                   <a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN268"><span class='Ref_to_Proto'>pg_namespace_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN194"><span class='Ref_to_EnumConst'>ACL_KIND_STATISTICS</span></a><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"grantable rights not supported for statistics objects"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* not reached, but keep compiler quiet */ 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN270"><span class='Ref_to_Proto'>pg_tablespace_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN198"><span class='Ref_to_EnumConst'>ACL_KIND_FDW</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN272"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN199"><span class='Ref_to_EnumConst'>ACL_KIND_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN274"><span class='Ref_to_Proto'>pg_foreign_server_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN200"><span class='Ref_to_EnumConst'>ACL_KIND_EVENT_TRIGGER</span></a><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"grantable rights not supported for event triggers"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* not reached, but keep compiler quiet */ 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/utils/acl.h.html#LN186"><span class='Ref_to_EnumConst'>ACL_KIND_TYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN276"><span class='Ref_to_Proto'>pg_type_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3469"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized objkind: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3468"><span class='Ref_to_Parameter'>objkind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* not reached, but keep compiler quiet */ 
</span>            <span class='Control'>return</span> <a href="../../include/nodes/parsenodes.h.html#LN85"><span class='Ref_to_Const'>ACL_NO_RIGHTS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objkind &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pg_aclmask &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* **************************************************************** 
 * Exported routines for examining a user's privileges for various objects 
 * 
 * See aclmask() for a description of the common API for these functions. 
 * 
 * Note: we give lookup failure the full ereport treatment because the 
 * has_xxx_privilege() family of functions allow users to pass any random 
 * OID to these functions. 
 * **************************************************************** 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a column 
 * 
 * Note: this considers only privileges granted specifically on the column. 
 * It is caller's responsibility to take relation-level privileges into account 
 * as appropriate.  (For the same reason, we have no special case for 
 * superuser-ness here.) 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3536"></a><span class='Declare_Function'>pg_attribute_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3537"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3539"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3540"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>classTuple</span><span class='Delimiter'>; 
</span><a name="LN3541"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span><a name="LN3542"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classForm</span><span class='Delimiter'>; 
</span><a name="LN3543"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attributeForm</span><span class='Delimiter'>; 
</span><a name="LN3544"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3545"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3546"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3547"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, get the column's ACL from its pg_attribute entry 
     */ 
</span>    <a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"attribute %d of relation with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN3543"><span class='Ref_To_Local'>attributeForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Throw error on dropped columns, too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3543"><span class='Ref_To_Local'>attributeForm</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"attribute %d of relation with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3544"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN3545"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Here we hard-wire knowledge that the default ACL for a column grants no 
     * privileges, so that we can fall out quickly in the very common case 
     * where attacl is null. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3545"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must get the relation's ownerId from pg_class.  Since we already found 
     * a pg_attribute entry, the only likely reason for this to fail is that a 
     * concurrent DROP of the relation committed since then (which could only 
     * happen if we don't have lock on the relation).  We prefer to report "no 
     * privileges" rather than failing in such a case, so as to avoid unwanted 
     * failures in has_column_privilege() tests. 
     */ 
</span>    <a href="aclchk.c.html#LN3540"><span class='Ref_To_Local'>classTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3540"><span class='Ref_To_Local'>classTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="aclchk.c.html#LN3542"><span class='Ref_To_Local'>classForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3540"><span class='Ref_To_Local'>classTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3547"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN3542"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3540"><span class='Ref_To_Local'>classTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* detoast column's ACL if necessary */ 
</span>    <a href="aclchk.c.html#LN3546"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3544"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3539"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3546"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3536"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3547"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3537"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3537"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3546"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3546"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3544"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3546"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3541"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3539"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_attribute_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a table 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3621"></a><span class='Declare_Function'>pg_class_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3622"></a>                 <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3624"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3625"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3626"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classForm</span><span class='Delimiter'>; 
</span><a name="LN3627"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3628"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3629"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3630"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must get the relation's tuple from pg_class 
     */ 
</span>    <a href="aclchk.c.html#LN3625"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN3626"><span class='Ref_To_Local'>classForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Deny anyone permission to update a system catalog unless 
     * pg_authid.rolsuper is set.  Also allow it if allowSystemTableMods. 
     * 
     * As of 7.4 we have some updatable system views; those shouldn't be 
     * protected in this way.  Assume the view rules can take care of 
     * themselves.  ACL_USAGE is if we ever have system sequences. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="aclchk.c.html#LN3622"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& 
</span>        <a href="../../include/catalog/catalog.h.html#LN33"><span class='Ref_to_Proto'>IsSystemClass</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3626"><span class='Ref_To_Local'>classForm</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <a href="aclchk.c.html#LN3626"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN111"><span class='Ref_to_Global_Var'>allowSystemTableMods</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> ACLDEBUG 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"permission denied for system catalog update"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="aclchk.c.html#LN3622"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN73"><span class='Ref_to_Const'>ACL_UPDATE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN74"><span class='Ref_to_Const'>ACL_DELETE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN75"><span class='Ref_to_Const'>ACL_TRUNCATE</span></a> <span class='Operator'>| </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, superusers bypass all permission-checking. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> ACLDEBUG 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"OID %u is superuser, home free"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="aclchk.c.html#LN3622"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Normal case: get the relation's ACL from pg_class 
     */ 
</span>    <a href="aclchk.c.html#LN3630"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN3626"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3627"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3625"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN3628"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3628"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3626"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3630"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3630"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="aclchk.c.html#LN3627"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast rel's ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3627"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN3624"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3621"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3630"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3622"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3622"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3627"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3629"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3624"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_class_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a database 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3717"></a><span class='Declare_Function'>pg_database_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>db_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3718"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3720"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3721"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3722"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3723"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3724"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3725"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3717"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN3718"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the database's ACL from pg_database 
     */ 
</span>    <a href="aclchk.c.html#LN3721"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3717"><span class='Ref_to_Parameter'>db_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3721"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3717"><span class='Ref_to_Parameter'>db_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3725"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3721"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>datdba<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3722"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3721"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_database.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_database_datacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN3723"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3723"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN3724"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3725"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3722"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN3724"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3722"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN3720"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3724"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3717"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3725"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3718"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3718"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3724"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3724"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3722"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3724"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3721"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3720"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_database_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a function 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3771"></a><span class='Declare_Function'>pg_proc_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>proc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3772"></a>                <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3774"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3775"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3776"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3777"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3778"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3779"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3771"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN3772"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the function's ACL from pg_proc 
     */ 
</span>    <a href="aclchk.c.html#LN3775"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3771"><span class='Ref_to_Parameter'>proc_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3775"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3771"><span class='Ref_to_Parameter'>proc_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3779"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3775"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>proowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3776"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3775"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_proc.h.html#LN117"><span class='Ref_to_Const'>Anum_pg_proc_proacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN3777"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3777"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN3778"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3779"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3776"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN3778"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3776"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN3774"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3778"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3771"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3779"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3772"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3772"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3778"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3778"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3776"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3778"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3775"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3774"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_proc_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a language 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3825"></a><span class='Declare_Function'>pg_language_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lang_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3826"></a>                    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3828"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3829"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3830"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3831"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3832"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3833"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3825"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN3826"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the language's ACL from pg_language 
     */ 
</span>    <a href="aclchk.c.html#LN3829"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3825"><span class='Ref_to_Parameter'>lang_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3829"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"language with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3825"><span class='Ref_to_Parameter'>lang_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3833"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_language.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_language</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3829"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>lanowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3830"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3829"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_language.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_language_lanacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN3831"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3831"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN3832"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3833"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3830"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN3832"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3830"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN3828"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3832"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3825"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3833"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3826"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3826"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3832"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3832"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3830"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3832"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3829"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3828"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_language_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a largeobject 
 * 
 * When a large object is opened for reading, it is opened relative to the 
 * caller's snapshot, but when it is opened for writing, a current 
 * MVCC snapshot will be used.  See doc/src/sgml/lobj.sgml.  This function 
 * takes a snapshot argument so that the permissions check can be made 
 * relative to the same snapshot that will be used to read the underlying 
 * data.  The caller will actually pass NULL for an instantaneous MVCC 
 * snapshot, since all we do with the snapshot argument is pass it through 
 * to systable_beginscan(). 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3888"></a><span class='Declare_Function'>pg_largeobject_aclmask_snapshot</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lobj_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3889"></a>                                <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Delimiter'>, 
</span><a name="LN3890"></a>                                <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3892"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3893"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_lo_meta</span><span class='Delimiter'>; 
</span><a name="LN3894"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN3895"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN3896"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3897"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3898"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3899"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3900"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3888"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN3889"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the largeobject's ACL from pg_language_metadata 
     */ 
</span>    <a href="aclchk.c.html#LN3893"><span class='Ref_To_Local'>pg_lo_meta</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN28"><span class='Ref_to_Const'>LargeObjectMetadataRelationId</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN3894"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3888"><span class='Ref_to_Parameter'>lobj_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3895"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3893"><span class='Ref_To_Local'>pg_lo_meta</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/catalog/indexing.h.html#LN182"><span class='Ref_to_Const'>LargeObjectMetadataOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <a href="aclchk.c.html#LN3890"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3894"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3896"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3895"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3896"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"large object %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3888"><span class='Ref_to_Parameter'>lobj_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3900"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_largeobject_metadata</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3896"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>lomowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3897"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3896"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_largeobject_metadata_lomacl</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3893"><span class='Ref_To_Local'>pg_lo_meta</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN3898"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3898"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN3899"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3900"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3897"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN3899"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3897"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN3892"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3899"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3888"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3900"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3889"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3889"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3899"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3899"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3897"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3899"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3895"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3893"><span class='Ref_To_Local'>pg_lo_meta</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3892"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_largeobject_aclmask_snapshot &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a namespace 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN3961"></a><span class='Declare_Function'>pg_namespace_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nsp_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN3962"></a>                     <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3964"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3965"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3966"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN3967"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN3968"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN3969"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3961"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN3962"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have been assigned this namespace as a temp namespace, check to 
     * make sure we have CREATE TEMP permission on the database, and if so act 
     * as though we have all standard (but not GRANT OPTION) permissions on 
     * the namespace.  If we don't have CREATE TEMP, act as though we have 
     * only USAGE (and not CREATE) rights. 
     * 
     * This may seem redundant given the check in InitTempTableNamespace, but 
     * it really isn't since current user ID may have changed since then. The 
     * upshot of this behavior is that a SECURITY DEFINER function can create 
     * temp tables that can then be accessed (if permission is granted) by 
     * code in the same session that doesn't have permissions to create temp 
     * tables. 
     * 
     * XXX Would it be safe to ereport a special error message as 
     * InitTempTableNamespace does?  Returning zero here means we'll get a 
     * generic "permission denied for schema pg_temp_N" message, which is not 
     * remarkably user-friendly. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN123"><span class='Ref_to_Proto'>isTempNamespace</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3961"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3961"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/nodes/parsenodes.h.html#LN82"><span class='Ref_to_Const'>ACL_CREATE_TEMP</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="aclchk.c.html#LN3962"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><a href="../../include/utils/acl.h.html#LN157"><span class='Ref_to_Const'>ACL_ALL_RIGHTS_NAMESPACE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="aclchk.c.html#LN3962"><span class='Ref_to_Parameter'>mask</span></a> <span class='Operator'>& </span><a href="../../include/nodes/parsenodes.h.html#LN79"><span class='Ref_to_Const'>ACL_USAGE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the schema's ACL from pg_namespace 
     */ 
</span>    <a href="aclchk.c.html#LN3965"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3961"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_SCHEMA<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"schema with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3961"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3969"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_namespace.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_namespace</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>nspowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN3966"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3965"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_namespace.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_namespace_nspacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN3967"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3967"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN3968"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3969"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN3966"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN3968"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3966"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN3964"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3968"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3961"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3969"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3962"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN3962"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN3968"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN3968"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3966"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3968"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN3965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN3964"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_namespace_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a tablespace 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4043"></a><span class='Declare_Function'>pg_tablespace_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>spc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN4044"></a>                      <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4046"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4047"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4048"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN4049"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN4050"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN4051"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4043"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN4044"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the tablespace's ACL from pg_tablespace 
     */ 
</span>    <a href="aclchk.c.html#LN4047"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN94"><span class='Ref_to_EnumConst'>TABLESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4043"><span class='Ref_to_Parameter'>spc_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4047"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tablespace with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4043"><span class='Ref_to_Parameter'>spc_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4051"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_tablespace.h.html#LN46"><span class='Ref_to_Typedef'>Form_pg_tablespace</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4047"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>spcowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4048"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN94"><span class='Ref_to_EnumConst'>TABLESPACEOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4047"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/pg_tablespace.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_tablespace_spcacl</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="aclchk.c.html#LN4049"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4049"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN4050"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4051"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN4048"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN4050"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4048"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN4046"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4050"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4043"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4051"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4044"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4044"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4050"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN4050"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4048"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4050"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4047"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN4046"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_tablespace_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a foreign 
 * data wrapper 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4100"></a><span class='Declare_Function'>pg_foreign_data_wrapper_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fdw_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN4101"></a>                                <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4103"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4104"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4105"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN4106"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN4107"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN4108"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
<a name="LN4110"></a>    <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a> <span class='Declare_Local'>fdwForm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Bypass permission checks for superusers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4100"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN4101"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must get the FDW's tuple from pg_foreign_data_wrapper 
     */ 
</span>    <a href="aclchk.c.html#LN4104"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4100"><span class='Ref_to_Parameter'>fdw_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4104"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4100"><span class='Ref_to_Parameter'>fdw_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN4110"><span class='Ref_To_Local'>fdwForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4104"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Normal case: get the FDW's ACL from pg_foreign_data_wrapper 
     */ 
</span>    <a href="aclchk.c.html#LN4108"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN4110"><span class='Ref_To_Local'>fdwForm</span></a><span class='Operator'>-&GT;</span>fdwowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4105"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4104"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN4106"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4106"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN4107"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4108"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN4105"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast rel's ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN4107"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4105"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN4103"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4107"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4100"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4108"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4101"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4101"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4107"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN4107"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4105"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4107"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4104"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN4103"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreign_data_wrapper_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a foreign 
 * server. 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4162"></a><span class='Declare_Function'>pg_foreign_server_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srv_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, 
</span><a name="LN4163"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4165"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4166"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4167"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN4168"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN4169"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN4170"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
<a name="LN4172"></a>    <a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a> <span class='Declare_Local'>srvForm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Bypass permission checks for superusers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4162"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN4163"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must get the FDW's tuple from pg_foreign_data_wrapper 
     */ 
</span>    <a href="aclchk.c.html#LN4166"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4162"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign server with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4162"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN4172"><span class='Ref_To_Local'>srvForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Normal case: get the foreign server's ACL from pg_foreign_server 
     */ 
</span>    <a href="aclchk.c.html#LN4170"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN4172"><span class='Ref_To_Local'>srvForm</span></a><span class='Operator'>-&GT;</span>srvowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4167"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4166"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN4168"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4168"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN4169"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4170"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN4167"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast rel's ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN4169"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4167"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN4165"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4169"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4162"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4170"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4163"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4163"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4169"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN4169"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4167"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4169"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4166"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN4165"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreign_server_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for examining a user's privileges for a type. 
 */ 
</span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> 
<a name="LN4223"></a><span class='Declare_Function'>pg_type_aclmask</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mask</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4225"></a>    <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4226"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4227"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN4228"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN4229"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>acl</span><span class='Delimiter'>; 
</span><a name="LN4230"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
<a name="LN4232"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typeForm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Bypass permission checks for superusers */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must get the type's tuple from pg_type 
     */ 
</span>    <a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>type_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>type_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN4232"><span class='Ref_To_Local'>typeForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * "True" array types don't manage permissions of their own; consult the 
     * element type instead. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4232"><span class='Ref_To_Local'>typeForm</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="aclchk.c.html#LN4232"><span class='Ref_To_Local'>typeForm</span></a><span class='Operator'>-&GT;</span>typlen <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4255"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elttype_oid</span> <span class='Operator'>= </span><a href="aclchk.c.html#LN4232"><span class='Ref_To_Local'>typeForm</span></a><span class='Operator'>-&GT;</span>typelem<span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4255"><span class='Ref_To_Local'>elttype_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* this case is not a user-facing error, so elog not ereport */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4255"><span class='Ref_To_Local'>elttype_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN4232"><span class='Ref_To_Local'>typeForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now get the type's owner and ACL from the tuple 
     */ 
</span>    <a href="aclchk.c.html#LN4230"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN4232"><span class='Ref_To_Local'>typeForm</span></a><span class='Operator'>-&GT;</span>typowner<span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4227"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN4228"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4228"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ACL, so build default ACL */ 
</span>        <a href="aclchk.c.html#LN4229"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4230"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN4227"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* detoast rel's ACL if necessary */ 
</span>        <a href="aclchk.c.html#LN4229"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4227"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="aclchk.c.html#LN4225"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN225"><span class='Ref_to_Proto'>aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4229"><span class='Ref_To_Local'>acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4230"><span class='Ref_To_Local'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>mask</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4223"><span class='Ref_to_Parameter'>how</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we have a detoasted copy, free it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4229"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="aclchk.c.html#LN4229"><span class='Ref_To_Local'>acl</span></a> <span class='Operator'>!= </span><a href="../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4227"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4229"><span class='Ref_To_Local'>acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4226"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN4225"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_type_aclmask &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a column 
 * 
 * Returns ACLCHECK_OK if the user has any of the privileges identified by 
 * 'mode'; otherwise returns a suitable error code (in practice, always 
 * ACLCHECK_NO_PRIV). 
 * 
 * As with pg_attribute_aclmask, only privileges granted directly on the 
 * column are considered here. 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4307"></a><span class='Declare_Function'>pg_attribute_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Delimiter'>, 
</span><a name="LN4308"></a>                      <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN256"><span class='Ref_to_Proto'>pg_attribute_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4307"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4307"><span class='Ref_to_Parameter'>attnum</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4308"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4308"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to any/all columns 
 * 
 * If 'how' is ACLMASK_ANY, then returns ACLCHECK_OK if user has any of the 
 * privileges identified by 'mode' on any non-dropped column in the relation; 
 * otherwise returns a suitable error code (in practice, always 
 * ACLCHECK_NO_PRIV). 
 * 
 * If 'how' is ACLMASK_ALL, then returns ACLCHECK_OK if user has any of the 
 * privileges identified by 'mode' on each non-dropped column in the relation 
 * (and there must be at least one such column); otherwise returns a suitable 
 * error code (in practice, always ACLCHECK_NO_PRIV). 
 * 
 * As with pg_attribute_aclmask, only privileges granted directly on the 
 * column(s) are considered here. 
 * 
 * Note: system columns are not considered here; there are cases where that 
 * might be appropriate but there are also cases where it wouldn't. 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4336"></a><span class='Declare_Function'>pg_attribute_aclcheck_all</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Delimiter'>, 
</span><a name="LN4337"></a>                          <a href="../../include/utils/acl.h.html#LN162"><span class='Ref_to_Typedef'>AclMaskHow</span></a> <span class='Declare_Parameter'>how</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4339"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4340"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>classTuple</span><span class='Delimiter'>; 
</span><a name="LN4341"></a>    <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>classForm</span><span class='Delimiter'>; 
</span><a name="LN4342"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>nattrs</span><span class='Delimiter'>; 
</span><a name="LN4343"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>curr_att</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Must fetch pg_class row to check number of attributes.  As in 
     * pg_attribute_aclmask, we prefer to return "no privileges" instead of 
     * throwing an error if we get any unexpected lookup errors. 
     */ 
</span>    <a href="aclchk.c.html#LN4340"><span class='Ref_To_Local'>classTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4336"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4340"><span class='Ref_To_Local'>classTuple</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN4341"><span class='Ref_To_Local'>classForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4340"><span class='Ref_To_Local'>classTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4342"><span class='Ref_To_Local'>nattrs</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN4341"><span class='Ref_To_Local'>classForm</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4340"><span class='Ref_To_Local'>classTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize result in case there are no non-dropped columns.  We want to 
     * report failure in such cases for either value of 'how'. 
     */ 
</span>    <a href="aclchk.c.html#LN4339"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4343"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="aclchk.c.html#LN4343"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>&LT;= </span><a href="aclchk.c.html#LN4342"><span class='Ref_To_Local'>nattrs</span></a><span class='Delimiter'>; </span><a href="aclchk.c.html#LN4343"><span class='Ref_To_Local'>curr_att</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4367"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span><a name="LN4368"></a>        <a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a>     <span class='Declare_Local'>attmask</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN4367"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4336"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4343"><span class='Ref_To_Local'>curr_att</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4367"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ignore dropped columns */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4367"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4367"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Here we hard-wire knowledge that the default ACL for a column 
         * grants no privileges, so that we can fall out quickly in the very 
         * common case where attacl is null. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../access/common/heaptuple.c.html#LN295"><span class='Ref_to_Func'>heap_attisnull</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4367"><span class='Ref_To_Local'>attTuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a><span class='Parentheses'>))</span> 
            <a href="aclchk.c.html#LN4368"><span class='Ref_To_Local'>attmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="aclchk.c.html#LN4368"><span class='Ref_To_Local'>attmask</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN256"><span class='Ref_to_Proto'>pg_attribute_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4336"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4343"><span class='Ref_To_Local'>curr_att</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4336"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, 
</span>                                           <a href="aclchk.c.html#LN4336"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4367"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4368"><span class='Ref_To_Local'>attmask</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN4339"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4337"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* succeed on any success */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="aclchk.c.html#LN4339"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN4337"><span class='Ref_to_Parameter'>how</span></a> <span class='Operator'>== </span><a href="../../include/utils/acl.h.html#LN164"><span class='Ref_to_EnumConst'>ACLMASK_ALL</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* fail on any failure */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for curr_att=1;curr_att&LT;=... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN4339"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_attribute_aclcheck_all &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a table 
 * 
 * Returns ACLCHECK_OK if the user has any of the privileges identified by 
 * 'mode'; otherwise returns a suitable error code (in practice, always 
 * ACLCHECK_NO_PRIV). 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4421"></a><span class='Declare_Function'>pg_class_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>table_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN258"><span class='Ref_to_Proto'>pg_class_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4421"><span class='Ref_to_Parameter'>table_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4421"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4421"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a database 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4433"></a><span class='Declare_Function'>pg_database_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>db_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN260"><span class='Ref_to_Proto'>pg_database_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4433"><span class='Ref_to_Parameter'>db_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4433"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4433"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a function 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4445"></a><span class='Declare_Function'>pg_proc_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>proc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN262"><span class='Ref_to_Proto'>pg_proc_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4445"><span class='Ref_to_Parameter'>proc_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4445"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4445"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a language 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4457"></a><span class='Declare_Function'>pg_language_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lang_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN264"><span class='Ref_to_Proto'>pg_language_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4457"><span class='Ref_to_Parameter'>lang_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4457"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4457"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a largeobject 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4469"></a><span class='Declare_Function'>pg_largeobject_aclcheck_snapshot</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lobj_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Delimiter'>, 
</span><a name="LN4470"></a>                                 <a href="../../include/utils/snapshot.h.html#LN22"><span class='Ref_to_Typedef'>Snapshot</span></a> <span class='Declare_Parameter'>snapshot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN266"><span class='Ref_to_Proto'>pg_largeobject_aclmask_snapshot</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4469"><span class='Ref_to_Parameter'>lobj_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4469"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4469"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4470"><span class='Ref_to_Parameter'>snapshot</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a namespace 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4483"></a><span class='Declare_Function'>pg_namespace_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nsp_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN268"><span class='Ref_to_Proto'>pg_namespace_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4483"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4483"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4483"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a tablespace 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4495"></a><span class='Declare_Function'>pg_tablespace_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>spc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN270"><span class='Ref_to_Proto'>pg_tablespace_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4495"><span class='Ref_to_Parameter'>spc_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4495"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4495"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a foreign 
 * data wrapper 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4508"></a><span class='Declare_Function'>pg_foreign_data_wrapper_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>fdw_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN272"><span class='Ref_to_Proto'>pg_foreign_data_wrapper_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4508"><span class='Ref_to_Parameter'>fdw_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4508"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4508"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a foreign 
 * server 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4521"></a><span class='Declare_Function'>pg_foreign_server_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srv_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN274"><span class='Ref_to_Proto'>pg_foreign_server_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4521"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4521"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4521"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Exported routine for checking a user's access privileges to a type 
 */ 
</span><a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a> 
<a name="LN4533"></a><span class='Declare_Function'>pg_type_aclcheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN69"><span class='Ref_to_Typedef'>AclMode</span></a> <span class='Declare_Parameter'>mode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN276"><span class='Ref_to_Proto'>pg_type_aclmask</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4533"><span class='Ref_to_Parameter'>type_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4533"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4533"><span class='Ref_to_Parameter'>mode</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN165"><span class='Ref_to_EnumConst'>ACLMASK_ANY</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN172"><span class='Ref_to_EnumConst'>ACLCHECK_NO_PRIV</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a relation (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4545"></a><span class='Declare_Function'>pg_class_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>class_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4547"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4548"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4545"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4547"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4545"><span class='Ref_to_Parameter'>class_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4547"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4545"><span class='Ref_to_Parameter'>class_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4548"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4547"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4547"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4545"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4548"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_class_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a type (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4571"></a><span class='Declare_Function'>pg_type_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4573"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4574"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4571"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4573"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4571"><span class='Ref_to_Parameter'>type_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4573"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4571"><span class='Ref_to_Parameter'>type_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4574"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4573"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>typowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4573"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4571"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4574"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_type_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for an operator (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4597"></a><span class='Declare_Function'>pg_oper_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oper_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4599"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4600"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4597"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4599"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4597"><span class='Ref_to_Parameter'>oper_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4599"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4597"><span class='Ref_to_Parameter'>oper_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4600"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4599"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>oprowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4599"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4597"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4600"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_oper_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a function (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4623"></a><span class='Declare_Function'>pg_proc_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>proc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4625"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4626"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4623"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4625"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4623"><span class='Ref_to_Parameter'>proc_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4623"><span class='Ref_to_Parameter'>proc_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4626"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_proc.h.html#LN82"><span class='Ref_to_Typedef'>Form_pg_proc</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>proowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4625"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4623"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4626"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_proc_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a procedural language (specified by OID) 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4649"></a><span class='Declare_Function'>pg_language_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lan_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4651"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4652"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4649"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4651"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4649"><span class='Ref_to_Parameter'>lan_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4651"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"language with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4649"><span class='Ref_to_Parameter'>lan_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4652"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_language.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_language</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4651"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>lanowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4651"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4649"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4652"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_language_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a largeobject (specified by OID) 
 * 
 * This is only used for operations like ALTER LARGE OBJECT that are always 
 * relative to an up-to-date snapshot. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4678"></a><span class='Declare_Function'>pg_largeobject_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>lobj_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4680"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_lo_meta</span><span class='Delimiter'>; 
</span><a name="LN4681"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4682"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN4683"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4684"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4678"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* There's no syscache for pg_largeobject_metadata */ 
</span>    <a href="aclchk.c.html#LN4680"><span class='Ref_To_Local'>pg_lo_meta</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN28"><span class='Ref_to_Const'>LargeObjectMetadataRelationId</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN4681"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4678"><span class='Ref_to_Parameter'>lobj_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4682"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4680"><span class='Ref_To_Local'>pg_lo_meta</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/catalog/indexing.h.html#LN182"><span class='Ref_to_Const'>LargeObjectMetadataOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4681"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4683"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4682"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4683"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"large object %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4678"><span class='Ref_to_Parameter'>lobj_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4684"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_largeobject_metadata</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4683"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>lomowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4682"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4680"><span class='Ref_To_Local'>pg_lo_meta</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4678"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4684"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_largeobject_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a namespace (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4721"></a><span class='Declare_Function'>pg_namespace_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nsp_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4723"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4724"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4721"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4723"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4721"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4723"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_SCHEMA<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"schema with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4721"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4724"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_namespace.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_namespace</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4723"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>nspowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4723"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4721"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4724"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_namespace_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a tablespace (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4747"></a><span class='Declare_Function'>pg_tablespace_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>spc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4749"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>spctuple</span><span class='Delimiter'>; 
</span><a name="LN4750"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>spcowner</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4747"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Search syscache for pg_tablespace */ 
</span>    <a href="aclchk.c.html#LN4749"><span class='Ref_To_Local'>spctuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN94"><span class='Ref_to_EnumConst'>TABLESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4747"><span class='Ref_to_Parameter'>spc_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4749"><span class='Ref_To_Local'>spctuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tablespace with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4747"><span class='Ref_to_Parameter'>spc_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4750"><span class='Ref_To_Local'>spcowner</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_tablespace.h.html#LN46"><span class='Ref_to_Typedef'>Form_pg_tablespace</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4749"><span class='Ref_To_Local'>spctuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>spcowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4749"><span class='Ref_To_Local'>spctuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4747"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4750"><span class='Ref_To_Local'>spcowner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_tablespace_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for an operator class (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4774"></a><span class='Declare_Function'>pg_opclass_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opc_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4776"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4777"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4774"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4776"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN47"><span class='Ref_to_EnumConst'>CLAOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4774"><span class='Ref_to_Parameter'>opc_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4776"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator class with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4774"><span class='Ref_to_Parameter'>opc_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4777"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_opclass.h.html#LN67"><span class='Ref_to_Typedef'>Form_pg_opclass</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4776"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>opcowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4776"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4774"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4777"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_opclass_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for an operator family (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4801"></a><span class='Declare_Function'>pg_opfamily_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opf_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4803"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4804"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4801"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4803"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN73"><span class='Ref_to_EnumConst'>OPFAMILYOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4801"><span class='Ref_to_Parameter'>opf_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4803"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator family with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4801"><span class='Ref_to_Parameter'>opf_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4804"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_opfamily.h.html#LN43"><span class='Ref_to_Typedef'>Form_pg_opfamily</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4803"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>opfowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4803"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4801"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4804"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_opfamily_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a text search dictionary (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4828"></a><span class='Declare_Function'>pg_ts_dict_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dict_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4830"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4831"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4828"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4830"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN101"><span class='Ref_to_EnumConst'>TSDICTOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4828"><span class='Ref_to_Parameter'>dict_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4830"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"text search dictionary with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4828"><span class='Ref_to_Parameter'>dict_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4831"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_ts_dict.h.html#LN44"><span class='Ref_to_Typedef'>Form_pg_ts_dict</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4830"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>dictowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4830"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4828"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4831"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_ts_dict_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a text search configuration (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4855"></a><span class='Declare_Function'>pg_ts_config_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>cfg_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4857"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4858"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4855"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4857"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN99"><span class='Ref_to_EnumConst'>TSCONFIGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4855"><span class='Ref_to_Parameter'>cfg_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4857"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"text search configuration with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                      <a href="aclchk.c.html#LN4855"><span class='Ref_to_Parameter'>cfg_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4858"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_ts_config.h.html#LN40"><span class='Ref_to_Typedef'>Form_pg_ts_config</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4857"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>cfgowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4857"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4855"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4858"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_ts_config_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a foreign-data wrapper (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4882"></a><span class='Declare_Function'>pg_foreign_data_wrapper_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srv_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4884"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4885"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4882"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4884"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4882"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4884"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign-data wrapper with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4882"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4885"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN48"><span class='Ref_to_Typedef'>Form_pg_foreign_data_wrapper</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4884"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>fdwowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4884"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4882"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4885"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreign_data_wrapper_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a foreign server (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4909"></a><span class='Declare_Function'>pg_foreign_server_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>srv_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4911"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4912"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4909"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4911"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4909"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4911"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"foreign server with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4909"><span class='Ref_to_Parameter'>srv_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4912"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_foreign_server.h.html#LN47"><span class='Ref_to_Typedef'>Form_pg_foreign_server</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4911"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>srvowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4911"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4909"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4912"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_foreign_server_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for an event trigger (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4936"></a><span class='Declare_Function'>pg_event_trigger_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>et_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4938"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4939"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4936"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4938"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN59"><span class='Ref_to_EnumConst'>EVENTTRIGGEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4936"><span class='Ref_to_Parameter'>et_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4938"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN4936"><span class='Ref_to_Parameter'>et_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4939"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_event_trigger.h.html#LN49"><span class='Ref_to_Typedef'>Form_pg_event_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4938"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>evtowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4938"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4936"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4939"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_event_trigger_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a database (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4963"></a><span class='Declare_Function'>pg_database_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>db_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4965"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4966"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>dba</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4963"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4965"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN54"><span class='Ref_to_EnumConst'>DATABASEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4963"><span class='Ref_to_Parameter'>db_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_DATABASE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"database with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4963"><span class='Ref_to_Parameter'>db_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4966"><span class='Ref_To_Local'>dba</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_database.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_database</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>datdba<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4965"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4963"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4966"><span class='Ref_To_Local'>dba</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_database_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a collation (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN4989"></a><span class='Declare_Function'>pg_collation_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>coll_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4991"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4992"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4989"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4991"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN49"><span class='Ref_to_EnumConst'>COLLOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4989"><span class='Ref_to_Parameter'>coll_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4991"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4989"><span class='Ref_to_Parameter'>coll_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN4992"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4991"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>collowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4991"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN4989"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN4992"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_collation_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a conversion (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5015"></a><span class='Declare_Function'>pg_conversion_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>conv_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5017"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5018"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5015"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5017"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN53"><span class='Ref_to_EnumConst'>CONVOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5015"><span class='Ref_to_Parameter'>conv_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5017"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conversion with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5015"><span class='Ref_to_Parameter'>conv_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5018"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_conversion.h.html#LN55"><span class='Ref_to_Typedef'>Form_pg_conversion</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5017"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>conowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5017"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5015"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5018"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_conversion_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for an extension (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5041"></a><span class='Declare_Function'>pg_extension_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ext_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5043"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_extension</span><span class='Delimiter'>; 
</span><a name="LN5044"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN5045"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN5046"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5047"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5041"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* There's no syscache for pg_extension, so do it the hard way */ 
</span>    <a href="aclchk.c.html#LN5043"><span class='Ref_To_Local'>pg_extension</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN5044"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5041"><span class='Ref_to_Parameter'>ext_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5045"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5043"><span class='Ref_To_Local'>pg_extension</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5044"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5046"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5045"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5046"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5041"><span class='Ref_to_Parameter'>ext_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5047"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5046"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>extowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5045"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5043"><span class='Ref_To_Local'>pg_extension</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5041"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5047"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_extension_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for an publication (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5083"></a><span class='Declare_Function'>pg_publication_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>pub_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5085"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5086"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5083"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5085"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN78"><span class='Ref_to_EnumConst'>PUBLICATIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5083"><span class='Ref_to_Parameter'>pub_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5085"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"publication with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5083"><span class='Ref_to_Parameter'>pub_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5086"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_publication.h.html#LN58"><span class='Ref_to_Typedef'>Form_pg_publication</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5085"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>pubowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5085"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5083"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5086"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_publication_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a subscription (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5109"></a><span class='Declare_Function'>pg_subscription_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>sub_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5111"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5112"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5109"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5111"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5109"><span class='Ref_to_Parameter'>sub_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5111"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5109"><span class='Ref_to_Parameter'>sub_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5112"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5111"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>subowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5111"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5109"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5112"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_subscription_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Ownership check for a statistics object (specified by OID). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5135"></a><span class='Declare_Function'>pg_statistics_object_ownercheck</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>stat_oid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5137"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5138"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>ownerId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5135"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5137"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN89"><span class='Ref_to_EnumConst'>STATEXTOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5135"><span class='Ref_to_Parameter'>stat_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5137"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"statistics object with OID %u does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="aclchk.c.html#LN5135"><span class='Ref_to_Parameter'>stat_oid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5138"><span class='Ref_To_Local'>ownerId</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_statistic_ext.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_statistic_ext</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5137"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>stxowner<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5137"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/utils/acl.h.html#LN229"><span class='Ref_to_Proto'>has_privs_of_role</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5135"><span class='Ref_to_Parameter'>roleid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5138"><span class='Ref_To_Local'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_statistics_object_ownercheck &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check whether specified role has CREATEROLE privilege (or is a superuser) 
 * 
 * Note: roles do not have owners per se; instead we use this test in 
 * places where an ownership-like permissions test is needed for a role. 
 * Be sure to apply it to the role trying to do the operation, not the 
 * role being operated on!  Also note that this generally should not be 
 * considered enough privilege if the target role is a superuser. 
 * (We don't handle that consideration here because we want to give a 
 * separate error message for such cases, so the caller has to deal with it.) 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN5170"></a><span class='Declare_Function'>has_createrole_privilege</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5172"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5173"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>utup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5170"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5173"><span class='Ref_To_Local'>utup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5170"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5173"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN5172"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5173"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolcreaterole<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5173"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="aclchk.c.html#LN5172"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>bool 
</span><a name="LN5189"></a><span class='Declare_Function'>has_bypassrls_privilege</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5191"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5192"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>utup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Superusers bypass all permission checking. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5189"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5192"><span class='Ref_To_Local'>utup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5189"><span class='Ref_to_Parameter'>roleid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5192"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="aclchk.c.html#LN5191"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_authid.h.html#LN71"><span class='Ref_to_Typedef'>Form_pg_authid</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5192"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>rolbypassrls<span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5192"><span class='Ref_To_Local'>utup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="aclchk.c.html#LN5191"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch pg_default_acl entry for given role, namespace and object type 
 * (object type must be given in pg_default_acl's encoding). 
 * Returns NULL if no such entry. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN5213"></a><span class='Declare_Function'>get_default_acl_internal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>roleId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nsp_oid</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>objtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5215"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN5216"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5216"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN159"><span class='Ref_to_Macro'>SearchSysCache3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN55"><span class='Ref_to_EnumConst'>DEFACLROLENSPOBJ</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5213"><span class='Ref_to_Parameter'>roleId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5213"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5213"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5216"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5225"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5226"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5225"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN55"><span class='Ref_to_EnumConst'>DEFACLROLENSPOBJ</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5216"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_default_acl.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_default_acl_defaclacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5226"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5226"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN5215"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN113"><span class='Ref_to_Macro'>DatumGetAclPCopy</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5225"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5216"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN5215"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_default_acl_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get default permissions for newly created object within given schema 
 * 
 * Returns NULL if built-in system defaults should be used 
 */ 
</span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>* 
</span><a name="LN5245"></a><span class='Declare_Function'>get_user_default_acl</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nsp_oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5247"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5248"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>glob_acl</span><span class='Delimiter'>; 
</span><a name="LN5249"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>schema_acl</span><span class='Delimiter'>; 
</span><a name="LN5250"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>def_acl</span><span class='Delimiter'>; 
</span><a name="LN5251"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>defaclobjtype</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use NULL during bootstrap, since pg_default_acl probably isn't there 
     * yet. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check if object type is supported in pg_default_acl */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN68"><span class='Ref_to_Const'>DEFACLOBJ_RELATION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN69"><span class='Ref_to_Const'>DEFACLOBJ_SEQUENCE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN70"><span class='Ref_to_Const'>DEFACLOBJ_FUNCTION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN71"><span class='Ref_to_Const'>DEFACLOBJ_TYPE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_default_acl.h.html#LN72"><span class='Ref_to_Const'>DEFACLOBJ_NAMESPACE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Look up the relevant pg_default_acl entries */ 
</span>    <a href="aclchk.c.html#LN5248"><span class='Ref_To_Local'>glob_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN5212"><span class='Ref_to_Func'>get_default_acl_internal</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="aclchk.c.html#LN5249"><span class='Ref_To_Local'>schema_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN5212"><span class='Ref_to_Func'>get_default_acl_internal</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>nsp_oid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5251"><span class='Ref_To_Local'>defaclobjtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick out if neither entry exists */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5248"><span class='Ref_To_Local'>glob_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="aclchk.c.html#LN5249"><span class='Ref_To_Local'>schema_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need to know the hard-wired default value, too */ 
</span>    <a href="aclchk.c.html#LN5250"><span class='Ref_To_Local'>def_acl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN211"><span class='Ref_to_Proto'>acldefault</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>objtype</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there's no global entry, substitute the hard-wired default */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5248"><span class='Ref_To_Local'>glob_acl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="aclchk.c.html#LN5248"><span class='Ref_To_Local'>glob_acl</span></a> <span class='Operator'>= </span><a href="aclchk.c.html#LN5250"><span class='Ref_To_Local'>def_acl</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Merge in any per-schema privileges */ 
</span>    <a href="aclchk.c.html#LN5247"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN221"><span class='Ref_to_Proto'>aclmerge</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5248"><span class='Ref_To_Local'>glob_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5249"><span class='Ref_To_Local'>schema_acl</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5245"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For efficiency, we want to return NULL if the result equals default. 
     * This requires sorting both arrays to get an accurate comparison. 
     */ 
</span>    <a href="../../include/utils/acl.h.html#LN222"><span class='Ref_to_Proto'>aclitemsort</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5247"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/acl.h.html#LN222"><span class='Ref_to_Proto'>aclitemsort</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5250"><span class='Ref_To_Local'>def_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN223"><span class='Ref_to_Proto'>aclequal</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5247"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5250"><span class='Ref_To_Local'>def_acl</span></a><span class='Parentheses'>))</span> 
        <a href="aclchk.c.html#LN5247"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="aclchk.c.html#LN5247"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_user_default_acl &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Record initial privileges for the top-level object passed in. 
 * 
 * For the object passed in, this will record its ACL (if any) and the ACLs of 
 * any sub-objects (eg: columns) into pg_init_privs. 
 * 
 * Any new kinds of objects which have ACLs associated with them and can be 
 * added to an extension should be added to the if-else tree below. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5327"></a><span class='Declare_Function'>recordExtObjInitPriv</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * pg_class / pg_attribute 
     * 
     * If this is a relation then we need to see if there are any sub-objects 
     * (eg: columns) for it and, if so, be sure to call 
     * recordExtensionInitPrivWorker() for each one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5338"></a>        <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN5339"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5340"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5341"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5341"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5341"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN5338"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5341"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Indexes don't have permissions */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5338"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Composite types don't have permissions either */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5338"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this isn't a sequence, index, or composite type then it's 
         * possibly going to have columns associated with it that might have 
         * ACLs. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5338"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5363"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>curr_att</span><span class='Delimiter'>; 
</span><a name="LN5364"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>nattrs</span> <span class='Operator'>= </span><a href="aclchk.c.html#LN5338"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5363"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="aclchk.c.html#LN5363"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>&LT;= </span><a href="aclchk.c.html#LN5364"><span class='Ref_To_Local'>nattrs</span></a><span class='Delimiter'>; </span><a href="aclchk.c.html#LN5363"><span class='Ref_To_Local'>curr_att</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5368"></a>                <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span><a name="LN5369"></a>                <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>attaclDatum</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5363"><span class='Ref_To_Local'>curr_att</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* ignore dropped columns */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="aclchk.c.html#LN5369"><span class='Ref_To_Local'>attaclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/catalog/pg_attribute.h.html#LN213"><span class='Ref_to_Const'>Anum_pg_attribute_attacl</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="aclchk.c.html#LN5340"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* no need to do anything for a NULL ACL */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5340"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5363"><span class='Ref_To_Local'>curr_att</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5369"><span class='Ref_To_Local'>attaclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5368"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for curr_att=1;curr_att&LT;=... &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_class_tuple-&GT;relki... &raquo; </span> 
 
        <a href="aclchk.c.html#LN5339"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5341"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_class.h.html#LN132"><span class='Ref_to_Const'>Anum_pg_class_relacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5340"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5340"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5339"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5341"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==RelationRel... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_foreign_data_wrapper */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN28"><span class='Ref_to_Const'>ForeignDataWrapperRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5416"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5417"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5418"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5418"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5418"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for foreign data wrapper %u"</span><span class='Delimiter'>, 
</span>                 <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5416"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN61"><span class='Ref_to_EnumConst'>FOREIGNDATAWRAPPEROID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5418"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_foreign_data_wrapper.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_data_wrapper_fdwacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5417"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5417"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5416"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5418"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==ForeignData... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_foreign_server */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_foreign_server.h.html#LN26"><span class='Ref_to_Const'>ForeignServerRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5440"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5441"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5442"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5442"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5442"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for foreign data wrapper %u"</span><span class='Delimiter'>, 
</span>                 <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5440"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN63"><span class='Ref_to_EnumConst'>FOREIGNSERVEROID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5442"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_foreign_server.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_foreign_server_srvacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5441"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5441"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5440"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5442"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==ForeignServ... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_language */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_language.h.html#LN28"><span class='Ref_to_Const'>LanguageRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5463"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5464"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5465"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5465"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5465"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for language %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5463"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN67"><span class='Ref_to_EnumConst'>LANGOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5465"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_language.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_language_lanacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5464"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5464"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5463"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5465"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==LanguageRel... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_largeobject_metadata */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN28"><span class='Ref_to_Const'>LargeObjectMetadataRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5484"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5485"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5486"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5487"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN5488"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN5489"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5489"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_largeobject_metadata.h.html#LN28"><span class='Ref_to_Const'>LargeObjectMetadataRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* There's no syscache for pg_largeobject_metadata */ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN5487"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5488"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5489"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/catalog/indexing.h.html#LN182"><span class='Ref_to_Const'>LargeObjectMetadataOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5487"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5486"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5488"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5486"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for large object %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5484"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5486"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_largeobject_metadata.h.html#LN52"><span class='Ref_to_Const'>Anum_pg_largeobject_metadata_lomacl</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5489"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN5485"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5485"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5484"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5488"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==LargeObject... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_namespace */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5521"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5522"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5523"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5523"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5523"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5521"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN69"><span class='Ref_to_EnumConst'>NAMESPACEOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5523"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/catalog/pg_namespace.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_namespace_nspacl</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN5522"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5522"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5521"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5523"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==NamespaceRe... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_proc */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5542"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5543"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5544"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5544"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5544"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5542"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN76"><span class='Ref_to_EnumConst'>PROCOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5544"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_proc.h.html#LN117"><span class='Ref_to_Const'>Anum_pg_proc_proacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5543"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5543"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5542"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5544"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==ProcedureRe... &raquo; </span> 
    <span class='Comment_Multi_Line'>/* pg_type */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5563"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>aclDatum</span><span class='Delimiter'>; 
</span><a name="LN5564"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5565"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5565"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5565"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for function %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5563"><span class='Ref_To_Local'>aclDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5565"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="aclchk.c.html#LN5564"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add the record, if any, for the top-level object */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="aclchk.c.html#LN5564"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>            <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/acl.h.html#LN112"><span class='Ref_to_Macro'>DatumGetAclP</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5563"><span class='Ref_To_Local'>aclDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5565"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==TypeRelatio... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_am.h.html#LN31"><span class='Ref_to_Const'>AccessMethodRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_aggregate.h.html#LN52"><span class='Ref_to_Const'>AggregateRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_cast.h.html#LN30"><span class='Ref_to_Const'>CastRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_conversion.h.html#LN37"><span class='Ref_to_Const'>ConversionRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_ts_config.h.html#LN30"><span class='Ref_to_Const'>TSConfigRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_ts_dict.h.html#LN30"><span class='Ref_to_Const'>TSDictionaryRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_ts_parser.h.html#LN30"><span class='Ref_to_Const'>TSParserRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_ts_template.h.html#LN30"><span class='Ref_to_Const'>TSTemplateRelationId</span></a> <span class='Operator'>|| 
</span>             <a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_transform.h.html#LN24"><span class='Ref_to_Const'>TransformRelationId</span></a> 
        <span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no ACL for these object types, so do nothing. */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * complain if we are given a class OID for a class that extensions don't 
     * support or that we don't recognize. 
     */ 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized or unsupported class OID: %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5327"><span class='Ref_to_Parameter'>classoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end recordExtObjInitPriv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * For the object passed in, remove its ACL and the ACLs of any object subIds 
 * from pg_init_privs (via recordExtensionInitPrivWorker()). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN5616"></a><span class='Declare_Function'>removeExtObjInitPriv</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * If this is a relation then we need to see if there are any sub-objects 
     * (eg: columns) for it and, if so, be sure to call 
     * recordExtensionInitPrivWorker() for each one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>classoid</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5625"></a>        <a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>pg_class_tuple</span><span class='Delimiter'>; 
</span><a name="LN5626"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="aclchk.c.html#LN5626"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5626"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="aclchk.c.html#LN5625"><span class='Ref_To_Local'>pg_class_tuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5626"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Indexes don't have permissions */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5625"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Composite types don't have permissions either */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5625"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this isn't a sequence, index, or composite type then it's 
         * possibly going to have columns associated with it that might have 
         * ACLs. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5625"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5648"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>curr_att</span><span class='Delimiter'>; 
</span><a name="LN5649"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>nattrs</span> <span class='Operator'>= </span><a href="aclchk.c.html#LN5625"><span class='Ref_To_Local'>pg_class_tuple</span></a><span class='Operator'>-&GT;</span>relnatts<span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5648"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="aclchk.c.html#LN5648"><span class='Ref_To_Local'>curr_att</span></a> <span class='Operator'>&LT;= </span><a href="aclchk.c.html#LN5649"><span class='Ref_To_Local'>nattrs</span></a><span class='Delimiter'>; </span><a href="aclchk.c.html#LN5648"><span class='Ref_To_Local'>curr_att</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN5653"></a>                <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>attTuple</span><span class='Delimiter'>; 
</span> 
                <a href="aclchk.c.html#LN5653"><span class='Ref_To_Local'>attTuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN40"><span class='Ref_to_EnumConst'>ATTNUM</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5648"><span class='Ref_To_Local'>curr_att</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5653"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* when removing, remove all entires, even dropped columns */ 
</span> 
                <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5648"><span class='Ref_To_Local'>curr_att</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5653"><span class='Ref_To_Local'>attTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_class_tuple-&GT;relki... &raquo; </span> 
 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5626"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if classoid==RelationRel... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Remove the record, if any, for the top-level object */ 
</span>    <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5616"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end removeExtObjInitPriv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Record initial ACL for an extension object 
 * 
 * Can be called at any time, we check if 'creating_extension' is set and, if 
 * not, exit immediately. 
 * 
 * Pass in the object OID, the OID of the class (the OID of the table which 
 * the object is defined in) and the 'sub' id of the object (objsubid), if 
 * any.  If there is no 'sub' id (they are currently only used for columns of 
 * tables) then pass in '0'.  Finally, pass in the complete ACL to store. 
 * 
 * If an ACL already exists for this object/sub-object then we will replace 
 * it with what is passed in. 
 * 
 * Passing in NULL for 'new_acl' will result in the entry for the object being 
 * removed, if one is found. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5695"></a><span class='Declare_Function'>recordExtensionInitPriv</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>objsubid</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Generally, we only record the initial privileges when an extension is 
     * being created, but because we don't actually use CREATE EXTENSION 
     * during binary upgrades with pg_upgrade, there is a variable to let us 
     * know that the GRANT and REVOKE statements being issued, while this 
     * variable is true, are for the initial privileges of the extension 
     * object and therefore we need to record them. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../commands/extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a> <span class='Operator'>&& !</span><a href="aclchk.c.html#LN101"><span class='Ref_to_Global_Var'>binary_upgrade_record_init_privs</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN140"><span class='Ref_to_Proto'>recordExtensionInitPrivWorker</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5695"><span class='Ref_to_Parameter'>objoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5695"><span class='Ref_to_Parameter'>classoid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5695"><span class='Ref_to_Parameter'>objsubid</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5695"><span class='Ref_to_Parameter'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Record initial ACL for an extension object, worker. 
 * 
 * This will perform a wholesale replacement of the entire ACL for the object 
 * passed in, therefore be sure to pass in the complete new ACL to use. 
 * 
 * Generally speaking, do *not* use this function directly but instead use 
 * recordExtensionInitPriv(), which checks if 'creating_extension' is set. 
 * This function does *not* check if 'creating_extension' is set as it is also 
 * used when an object is added to or removed from an extension via ALTER 
 * EXTENSION ... ADD/DROP. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5724"></a><span class='Declare_Function'>recordExtensionInitPrivWorker</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>objsubid</span><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>new_acl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5726"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN5727"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN5728"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN5729"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN5730"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>oldtuple</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_init_privs.h.html#LN41"><span class='Ref_to_Const'>InitPrivsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN5727"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_init_privs.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_init_privs_objoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN5727"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_init_privs.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_init_privs_classoid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>classoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="aclchk.c.html#LN5727"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_init_privs.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_init_privs_objsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>objsubid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="aclchk.c.html#LN5728"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN171"><span class='Ref_to_Const'>InitPrivsObjIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5727"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* There should exist only one entry or none. */ 
</span>    <a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5728"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we find an entry, update it with the latest ACL. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5756"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN67"><span class='Ref_to_Const'>Natts_pg_init_privs</span></a><span class='Delimiter'>]; 
</span><a name="LN5757"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN67"><span class='Ref_to_Const'>Natts_pg_init_privs</span></a><span class='Delimiter'>]; 
</span><a name="LN5758"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replace</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN67"><span class='Ref_to_Const'>Natts_pg_init_privs</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* If we have a new ACL to set, then update the row with it. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>new_acl</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5756"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5756"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5757"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5757"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5758"><span class='Ref_To_Local'>replace</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5758"><span class='Ref_To_Local'>replace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN5756"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_init_privs_privs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN5758"><span class='Ref_To_Local'>replace</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_init_privs_privs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="aclchk.c.html#LN5756"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5757"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5758"><span class='Ref_To_Local'>replace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* new_acl is NULL, so delete the entry we found. */ 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="aclchk.c.html#LN5730"><span class='Ref_To_Local'>oldtuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(oldt... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5783"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN67"><span class='Ref_to_Const'>Natts_pg_init_privs</span></a><span class='Delimiter'>]; 
</span><a name="LN5784"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN67"><span class='Ref_to_Const'>Natts_pg_init_privs</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Only add a new entry if the new ACL is non-NULL. 
         * 
         * If we are passed in a NULL ACL and no entry exists, we can just 
         * fall through and do nothing. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>new_acl</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No entry found, so add it. */ 
</span>            <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5784"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5784"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN5783"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_init_privs_objoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>objoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN5783"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_init_privs_classoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>classoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="aclchk.c.html#LN5783"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_init_privs_objsubid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>objsubid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* This function only handles initial privileges of extensions */ 
</span>            <a href="aclchk.c.html#LN5783"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_init_privs_privtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                <a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_init_privs.h.html#LN84"><span class='Ref_to_EnumConst'>INITPRIVS_EXTENSION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN5783"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_init_privs.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_init_privs_privs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5724"><span class='Ref_to_Parameter'>new_acl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="aclchk.c.html#LN5729"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5783"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5784"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="aclchk.c.html#LN5729"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5728"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* prevent error when processing objects multiple times */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="aclchk.c.html#LN5726"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end recordExtensionInitPrivWorker &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>