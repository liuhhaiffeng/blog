<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\partition.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\partition.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:33 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * partition.c 
 *        Partitioning related data structures and functions. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *        src/backend/catalog/partition.c 
 * 
 *------------------------------------------------------------------------- 
*/ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/nbtree.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaddress.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/partition.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opclass.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/parsenodes.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planmain.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/var.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteManip.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/ruleutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Information about bounds of a partitioned relation 
 * 
 * A list partition datum that is known to be NULL is never put into the 
 * datums array. Instead, it is tracked using the null_index field. 
 * 
 * In the case of range partitioning, ndatums will typically be far less than 
 * 2 * nparts, because a partition's upper bound and the next partition's lower 
 * bound are the same in most common cases, and we only store one of them. 
 * 
 * In the case of list partitioning, the indexes array stores one entry for 
 * every datum, which is the index of the partition that accepts a given datum. 
 * In case of range partitioning, it stores one entry per distinct range 
 * datum, which is the index of the partition for which a given datum 
 * is an upper bound. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Ternary value to represent what's contained in a range bound datum */ 
</span><a name="LN69"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>RangeDatumContent</span> 
<span class='Delimiter'>{ 
</span><a name="LN71"></a>    <span class='Declare_Enum_Const'>RANGE_DATUM_FINITE</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* actual datum stored elsewhere */ 
</span><a name="LN72"></a>    <span class='Declare_Enum_Const'>RANGE_DATUM_NEG_INF</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* negative infinity */ 
</span><a name="LN73"></a>    <span class='Declare_Enum_Const'>RANGE_DATUM_POS_INF</span>         <span class='Comment_Single_Line'>/* positive infinity */ 
</span><a name="LN74"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>RangeDatumContent</span><span class='Delimiter'>; 
</span> 
<a name="LN76"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PartitionBoundInfoData</span> 
<span class='Delimiter'>{ 
</span><a name="LN78"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>strategy</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* list or range bounds? */ 
</span><a name="LN79"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ndatums</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Length of the datums following array */ 
</span><a name="LN80"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>     <span class='Operator'>**</span><span class='Declare_Member'>datums</span><span class='Delimiter'>;</span>         <span class='Comment_Multi_Line'>/* Array of datum-tuples with key-&GT;partnatts 
                                 * datums each */ 
</span><a name="LN82"></a>    <a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>**</span><span class='Declare_Member'>content</span><span class='Delimiter'>;</span><span class='Comment_Multi_Line'>/* what's contained in each range bound datum? 
                                 * (see the above enum); NULL for list 
                                 * partitioned tables */ 
</span><a name="LN85"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>indexes</span><span class='Delimiter'>;</span>        <span class='Comment_Multi_Line'>/* Partition indexes; one entry per member of 
                                 * the datums array (plus one if range 
                                 * partitioned table) */ 
</span><a name="LN88"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>null_index</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* Index of the null-accepting partition; -1 
                                 * if there isn't one */ 
</span><a name="LN90"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PartitionBoundInfoData</span><span class='Delimiter'>; 
</span> 
<a name="LN92"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>partition_bound_accepts_nulls</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>bi</span><span class='Parentheses'>) ((</span><a href="partition.c.html#LN92"><span class='Ref_to_Parameter'>bi</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>null_index <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * When qsort'ing partition bounds after reading from the catalog, each bound 
 * is represented with one of the following structs. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* One value coming from some (index'th) list partition */ 
</span><a name="LN100"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PartitionListValue</span> 
<span class='Delimiter'>{ 
</span><a name="LN102"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>index</span><span class='Delimiter'>; 
</span><a name="LN103"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Member'>value</span><span class='Delimiter'>; 
</span><a name="LN104"></a>} <span class='Declare_Typedef'>PartitionListValue</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* One bound of a range partition */ 
</span><a name="LN107"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PartitionRangeBound</span> 
<span class='Delimiter'>{ 
</span><a name="LN109"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>index</span><span class='Delimiter'>; 
</span><a name="LN110"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>datums</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* range bound datums */ 
</span><a name="LN111"></a>    <a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Member'>content</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* what's contained in each datum? */ 
</span><a name="LN112"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>lower</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* this is the lower (vs upper) bound */ 
</span><a name="LN113"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PartitionRangeBound</span><span class='Delimiter'>; 
</span> 
<a name="LN115"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>qsort_partition_list_value_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, 
</span><a name="LN116"></a>                               <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN117"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>qsort_partition_rbound_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, 
</span><a name="LN118"></a>                           <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN120"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>get_partition_operator</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>col</span><span class='Delimiter'>, 
</span><a name="LN121"></a>                       <a href="../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>need_relabel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static </span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>make_partition_op_expr</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>keynum</span><span class='Delimiter'>, 
</span><a name="LN123"></a>                       <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN124"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_range_key_properties</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>keynum</span><span class='Delimiter'>, 
</span><a name="LN125"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ldatum</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>udatum</span><span class='Delimiter'>, 
</span><a name="LN127"></a>                         <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>partexprs_item</span><span class='Delimiter'>, 
</span><a name="LN128"></a>                         <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>keyCol</span><span class='Delimiter'>, 
</span><a name="LN129"></a>                         <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>lower_val</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>upper_val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN130"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_qual_for_list</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_qual_for_range</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>generate_partition_qual</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN134"></a><span class='Keyword'>static </span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>make_one_range_bound</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN135"></a>                     <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datums</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>lower</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN136"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>partition_rbound_cmp</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN137"></a>                     <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datums1</span><span class='Delimiter'>, </span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>content1</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>lower1</span><span class='Delimiter'>, 
</span><a name="LN138"></a>                     <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN139"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>partition_rbound_datum_cmp</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN140"></a>                           <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rb_datums</span><span class='Delimiter'>, </span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rb_content</span><span class='Delimiter'>, 
</span><a name="LN141"></a>                           <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple_datums</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN143"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>partition_bound_cmp</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                    <a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Parameter'>boundinfo</span><span class='Delimiter'>, 
</span><a name="LN145"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>probe</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>probe_is_bound</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN146"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>partition_bound_bsearch</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                        <a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Parameter'>boundinfo</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                        <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>probe</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>probe_is_bound</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_equal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationBuildPartitionDesc 
 *      Form rel's partition descriptor 
 * 
 * Not flushed from the cache by RelationClearRelation() unless changed because 
 * of addition or removal of partition. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN158"></a><span class='Declare_Function'>RelationBuildPartitionDesc</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN160"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inhoids</span><span class='Delimiter'>, 
</span><a name="LN161"></a>               <span class='Operator'>*</span><span class='Declare_Local'>partoids</span><span class='Delimiter'>; 
</span><a name="LN162"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oids</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN163"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>boundspecs</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN164"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN165"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN166"></a>                <span class='Declare_Local'>nparts</span><span class='Delimiter'>; 
</span><a name="LN167"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN158"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a>    <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN169"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
<a name="LN171"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* List partitioning specific */ 
</span><a name="LN174"></a>    <a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>**</span><span class='Declare_Local'>all_values</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN175"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>null_index</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Range partitioning specific */ 
</span><a name="LN178"></a>    <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>**</span><span class='Declare_Local'>rbounds</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The following could happen in situations where rel has a pg_class entry 
     * but not the pg_partitioned_table entry yet. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get partition oids from pg_inherits */ 
</span>    <a href="partition.c.html#LN160"><span class='Ref_To_Local'>inhoids</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN158"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Collect bound spec nodes in a list */ 
</span>    <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN161"><span class='Ref_To_Local'>partoids</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN160"><span class='Ref_To_Local'>inhoids</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN195"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inhrelid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN196"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN197"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN198"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN199"></a>        <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>boundspec</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN196"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN195"><span class='Ref_To_Local'>inhrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN196"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="partition.c.html#LN195"><span class='Ref_To_Local'>inhrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It is possible that the pg_class tuple of a partition has not been 
         * updated yet to set its relpartbound field.  The only case where 
         * this happens is when we open the parent relation to check using its 
         * partition descriptor that a new partition's bound does not overlap 
         * some existing partition. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN196"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN196"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="partition.c.html#LN197"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN196"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/pg_class.h.html#LN134"><span class='Ref_to_Const'>Anum_pg_class_relpartbound</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="partition.c.html#LN198"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN198"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN199"><span class='Ref_To_Local'>boundspec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN197"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN163"><span class='Ref_To_Local'>boundspecs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN163"><span class='Ref_To_Local'>boundspecs</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN199"><span class='Ref_To_Local'>boundspec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN161"><span class='Ref_To_Local'>partoids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN161"><span class='Ref_To_Local'>partoids</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN195"><span class='Ref_To_Local'>inhrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN196"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN161"><span class='Ref_To_Local'>partoids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="partition.c.html#LN235"><span class='Ref_To_Local'>oids</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN161"><span class='Ref_To_Local'>partoids</span></a><span class='Parentheses'>) 
</span><a name="LN235"></a>            <span class='Declare_Local'>oids</span><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Convert from node to the internal representation */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN240"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>non_null_values</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create a unified list of non-null values across all partitions. 
             */ 
</span>            <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN163"><span class='Ref_To_Local'>boundspecs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN249"></a>                <a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>spec</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN251"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN249"><span class='Ref_To_Local'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN799"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Parentheses'>) 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid strategy in partition bound spec"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN251"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN249"><span class='Ref_To_Local'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN802"><span class='Ref_to_Member'>listdatums</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN258"></a>                    <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN251"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN259"></a>                    <a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>list_value</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN258"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="partition.c.html#LN259"><span class='Ref_To_Local'>list_value</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN259"><span class='Ref_To_Local'>list_value</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN102"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN259"><span class='Ref_To_Local'>list_value</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="partition.c.html#LN258"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Never put a null into the values array, flag 
                         * instead for the code further down below where we 
                         * construct the actual relcache struct. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"found null more than once"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN259"><span class='Ref_To_Local'>list_value</span></a><span class='Parentheses'>) 
</span>                        <a href="partition.c.html#LN240"><span class='Ref_To_Local'>non_null_values</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN240"><span class='Ref_To_Local'>non_null_values</span></a><span class='Delimiter'>, 
</span>                                                  <a href="partition.c.html#LN259"><span class='Ref_To_Local'>list_value</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN240"><span class='Ref_To_Local'>non_null_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Collect all list values in one array. Alongside the value, we 
             * also save the index of partition the value comes from. 
             */ 
</span>            <a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>* 
</span>                                               <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN240"><span class='Ref_To_Local'>non_null_values</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN299"></a>                <a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>src</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                    <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="partition.c.html#LN299"><span class='Ref_To_Local'>src</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN102"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN299"><span class='Ref_To_Local'>src</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN102"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="partition.c.html#LN115"><span class='Ref_to_Proto'>qsort_partition_list_value_cmp</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if key-&GT;strategy==PARTIT... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN313"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN314"></a>                        <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span><a name="LN315"></a>            <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>**</span><span class='Declare_Local'>all_bounds</span><span class='Delimiter'>, 
</span><a name="LN316"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>prev</span><span class='Delimiter'>; 
</span><a name="LN317"></a>            <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>distinct_indexes</span><span class='Delimiter'>; 
</span> 
            <a href="partition.c.html#LN315"><span class='Ref_To_Local'>all_bounds</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Number'>2</span> <span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>* 
</span>                                              <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN317"><span class='Ref_To_Local'>distinct_indexes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>2</span> <span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create a unified list of range bounds across all the 
             * partitions. 
             */ 
</span>            <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN313"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN163"><span class='Ref_To_Local'>boundspecs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN330"></a>                <a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>spec</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN164"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN332"></a>                <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN333"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN330"><span class='Ref_To_Local'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN799"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Parentheses'>) 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid strategy in partition bound spec"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="partition.c.html#LN332"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN134"><span class='Ref_to_Proto'>make_one_range_bound</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN330"><span class='Ref_To_Local'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN805"><span class='Ref_to_Member'>lowerdatums</span></a><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN333"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN134"><span class='Ref_to_Proto'>make_one_range_bound</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN330"><span class='Ref_To_Local'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN806"><span class='Ref_to_Member'>upperdatums</span></a><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN315"><span class='Ref_To_Local'>all_bounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN313"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN332"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN315"><span class='Ref_To_Local'>all_bounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN313"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN333"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN313"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN313"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Sort all the bounds in ascending order */ 
</span>            <a href="../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN315"><span class='Ref_To_Local'>all_bounds</span></a><span class='Delimiter'>, </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Delimiter'>, 
</span>                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="partition.c.html#LN117"><span class='Ref_to_Proto'>qsort_partition_rbound_cmp</span></a><span class='Delimiter'>, 
</span>                      <span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Count the number of distinct bounds to allocate an array of 
             * that size. 
             */ 
</span>            <a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN316"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN363"></a>                <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cur</span> <span class='Operator'>= </span><a href="partition.c.html#LN315"><span class='Ref_To_Local'>all_bounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN364"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_distinct</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN365"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Is current bound is distinct from the previous? */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN370"></a>                    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>cmpval</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN316"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="partition.c.html#LN364"><span class='Ref_To_Local'>is_distinct</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If either of them has infinite element, we can't equate 
                     * them.  Even when both are infinite, they'd have 
                     * opposite signs, because only one of cur and prev is a 
                     * lower bound). 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN363"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a> <span class='Operator'>|| 
</span>                        <a href="partition.c.html#LN316"><span class='Ref_To_Local'>prev</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="partition.c.html#LN364"><span class='Ref_To_Local'>is_distinct</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="partition.c.html#LN370"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                                               <a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                                               <a href="partition.c.html#LN363"><span class='Ref_To_Local'>cur</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                                               <a href="partition.c.html#LN316"><span class='Ref_To_Local'>prev</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN365"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN370"><span class='Ref_To_Local'>cmpval</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="partition.c.html#LN364"><span class='Ref_To_Local'>is_distinct</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;key-&GT;partnatts;... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Count the current bound if it is distinct from the previous 
                 * one.  Also, store if the index i contains a distinct bound 
                 * that we'd like put in the relcache array. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN364"><span class='Ref_To_Local'>is_distinct</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="partition.c.html#LN317"><span class='Ref_To_Local'>distinct_indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="partition.c.html#LN317"><span class='Ref_To_Local'>distinct_indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="partition.c.html#LN316"><span class='Ref_To_Local'>prev</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN363"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;2*nparts;i++ &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Finally save them in an array from where they will be copied 
             * into the relcache. 
             */ 
</span>            <a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>* 
</span>                                              <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN314"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN317"><span class='Ref_To_Local'>distinct_indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN314"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN315"><span class='Ref_To_Local'>all_bounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN314"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>== </span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if key-&GT;strategy==PARTIT... &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected partition strategy: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nparts&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Now build the actual relcache partition descriptor */ 
</span>    <a href="partition.c.html#LN158"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN129"><span class='Ref_to_Member'>rd_pdcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN158"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN169"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN158"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN129"><span class='Ref_to_Member'>rd_pdcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN168"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN32"><span class='Ref_to_Struct'>PartitionDescData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN32"><span class='Ref_to_Struct'>PartitionDescData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN168"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN446"></a>        <a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Local'>boundinfo</span><span class='Delimiter'>; 
</span><a name="LN447"></a>        <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>mapping</span><span class='Delimiter'>; 
</span><a name="LN448"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>next_index</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN168"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN35"><span class='Ref_to_Member'>oids</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN76"><span class='Ref_to_Struct'>PartitionBoundInfoData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN76"><span class='Ref_to_Struct'>PartitionBoundInfoData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN78"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN88"><span class='Ref_to_Member'>null_index</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Initialize mapping array with invalid values */ 
</span>        <a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Copy values.  Indexes of individual values are mapped 
                     * to canonical values so that they match for any two list 
                     * partitioned tables with same number of partitions and 
                     * same lists per partition.  One way to canonicalize is 
                     * to assign the index in all_values[] of the smallest 
                     * value of each partition, as the index of all of the 
                     * partition's values. 
                     */ 
</span>                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span>                                                        <a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                                         <a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* If the old index has no mapping, assign one */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN102"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>] </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN102"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN448"><span class='Ref_To_Local'>next_index</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN174"><span class='Ref_To_Local'>all_values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN102"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>]; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If null-accepting partition has no mapped index yet, 
                     * assign one.  This could happen if such partition 
                     * accepts only null and hence not covered in the above 
                     * loop which only handled non-null values. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a><span class='Delimiter'>] </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN448"><span class='Ref_To_Local'>next_index</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN88"><span class='Ref_to_Member'>null_index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN175"><span class='Ref_To_Local'>null_index</span></a><span class='Delimiter'>]; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* All partition must now have a valid mapping */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN448"><span class='Ref_To_Local'>next_index</span></a> <span class='Operator'>== </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>* 
</span>                                                <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                                                        <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN171"><span class='Ref_To_Local'>ndatums</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN521"></a>                        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
                        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* 
</span>                                                              <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                            <a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* 
</span>                                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>                                <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= 
</span>                                    <a href="../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                                              <a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                                              <a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Comment_Multi_Line'>/* Remember, we are storing the tri-state value. */ 
</span>                            <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * There is no mapping for invalid indexes. 
                         * 
                         * Any lower bounds in the rbounds array have invalid 
                         * indexes assigned, because the values between the 
                         * previous bound (if there is one) and this (lower) 
                         * bound are not part of the range of any existing 
                         * partition. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN112"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>) 
</span>                            <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span><a name="LN552"></a>                            <span class='Keyword'>int</span>         <span class='Declare_Local'>orig_index</span> <span class='Operator'>= </span><a href="partition.c.html#LN178"><span class='Ref_To_Local'>rbounds</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="partition.c.html#LN109"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>; 
</span> 
                            <span class='Comment_Multi_Line'>/* If the old index has no mapping, assign one */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN552"><span class='Ref_To_Local'>orig_index</span></a><span class='Delimiter'>] </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                                <a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN552"><span class='Ref_To_Local'>orig_index</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN448"><span class='Ref_To_Local'>next_index</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                            <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN552"><span class='Ref_To_Local'>orig_index</span></a><span class='Delimiter'>]; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;ndatums;i++ &raquo; </span> 
                    <a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected partition strategy: %d"</span><span class='Delimiter'>, 
</span>                     <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="partition.c.html#LN167"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch key-&GT;strategy &raquo; </span> 
 
        <a href="partition.c.html#LN168"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN446"><span class='Ref_To_Local'>boundinfo</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now assign OIDs from the original array into mapped indexes of the 
         * result array.  Order of OIDs in the former is defined by the 
         * catalog scan that retrived them, whereas that in the latter is 
         * defined by canonicalized representation of the list values or the 
         * range bounds. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN166"><span class='Ref_To_Local'>nparts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="partition.c.html#LN168"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN35"><span class='Ref_to_Member'>oids</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]] </span><span class='Operator'>= </span><a href="partition.c.html#LN162"><span class='Ref_To_Local'>oids</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN447"><span class='Ref_To_Local'>mapping</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nparts&GT;0 &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN169"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN158"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN130"><span class='Ref_to_Member'>rd_partdesc</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN168"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationBuildPartitionDesc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Are two partition bound collections logically equal? 
 * 
 * Used in the keep logic of relcache.c (ie, in RelationClearRelation()). 
 * This is also useful when b1 and b2 are bound collections of two separate 
 * relations, respectively, because PartitionBoundInfo is a canonical 
 * representation of partition bounds. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN597"></a><span class='Declare_Function'>partition_bounds_equal</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN598"></a>                       <a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Parameter'>b1</span><span class='Delimiter'>, </span><a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Parameter'>b2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN600"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN78"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>!= </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN78"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>!= </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN88"><span class='Ref_to_Member'>null_index</span></a> <span class='Operator'>!= </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN88"><span class='Ref_to_Member'>null_index</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN613"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN597"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* For range partitions, the bounds might not be finite. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * A finite bound always differs from an infinite bound, and 
                 * different kinds of infinities differ from each other. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Non-finite bounds are equal without further examination. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Compare the actual values. Note that it would be both incorrect 
             * and unsafe to invoke the comparison operator derived from the 
             * partitioning specification here.  It would be incorrect because 
             * we want the relcache entry to be updated for ANY change to the 
             * partition bounds, not just those that the partitioning operator 
             * thinks are significant.  It would be unsafe because we might 
             * reach this code in the context of an aborted transaction, and 
             * an arbitrary partitioning operator might not be safe in that 
             * context.  datumIsEqual() should be simple enough to be safe. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/datum.h.html#LN45"><span class='Ref_to_Proto'>datumIsEqual</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>][</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                              <a href="partition.c.html#LN597"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN71"><span class='Ref_to_Member'>parttypbyval</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], 
</span>                              <a href="partition.c.html#LN597"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN70"><span class='Ref_to_Member'>parttyplen</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN613"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;key-&GT;partnatts;... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;b1-&GT;ndatums;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* There are ndatums+1 indexes in case of range partitions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN597"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a> <span class='Operator'>&& 
</span>        <a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN598"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN600"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end partition_bounds_equal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * check_new_partition_bound 
 * 
 * Checks if the new partition's bound overlaps any of the existing partitions 
 * of parent.  Also performs additional checks as necessary per strategy. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN668"></a><span class='Declare_Function'>check_new_partition_bound</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>relname</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent</span><span class='Delimiter'>, 
</span><a name="LN669"></a>                          <a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN671"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN668"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN672"></a>    <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>partdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN632"><span class='Ref_to_Macro'>RelationGetPartitionDesc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN668"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN673"></a>    <a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><a href="../parser/parse_node.c.html#LN42"><span class='Ref_to_Func'>make_parsestate</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN674"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>with</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN675"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>overlap</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN799"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN672"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN685"></a>                    <a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Local'>boundinfo</span> <span class='Operator'>= </span><a href="partition.c.html#LN672"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Delimiter'>; 
</span><a name="LN686"></a>                    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a> <span class='Operator'>&& 
</span>                           <a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN78"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a> <span class='Operator'>&& 
</span>                           <span class='Parentheses'>(</span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                            <a href="partition.c.html#LN92"><span class='Ref_to_Macro'>partition_bound_accepts_nulls</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN686"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN802"><span class='Ref_to_Member'>listdatums</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN695"></a>                        <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN686"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN695"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span><a name="LN699"></a>                            <span class='Keyword'>int</span>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span><a name="LN700"></a>                            <span class='Keyword'>bool</span>        <span class='Declare_Local'>equal</span><span class='Delimiter'>; 
</span> 
                            <a href="partition.c.html#LN699"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN146"><span class='Ref_to_Proto'>partition_bound_bsearch</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Operator'>&</span><a href="partition.c.html#LN695"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN700"><span class='Ref_To_Local'>equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN699"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="partition.c.html#LN700"><span class='Ref_To_Local'>equal</span></a><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="partition.c.html#LN675"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                                <a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN699"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>]; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN92"><span class='Ref_to_Macro'>partition_bound_accepts_nulls</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Parentheses'>))</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="partition.c.html#LN675"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN685"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN88"><span class='Ref_to_Member'>null_index</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if partdesc-&GT;nparts&GT;0 &raquo; </span> 
 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN726"></a>                <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN727"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN799"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN726"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN134"><span class='Ref_to_Proto'>make_one_range_bound</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN805"><span class='Ref_to_Member'>lowerdatums</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN727"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN134"><span class='Ref_to_Proto'>make_one_range_bound</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN806"><span class='Ref_to_Member'>upperdatums</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * First check if the resulting range would be empty with 
                 * specified lower and upper bounds 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN136"><span class='Ref_to_Proto'>partition_rbound_cmp</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN726"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN726"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                         <a href="partition.c.html#LN727"><span class='Ref_To_Local'>upper</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot create range partition with empty range"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN673"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN808"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN672"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN746"></a>                    <a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Local'>boundinfo</span> <span class='Operator'>= </span><a href="partition.c.html#LN672"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Delimiter'>; 
</span><a name="LN747"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>off1</span><span class='Delimiter'>, 
</span><a name="LN748"></a>                                <span class='Declare_Local'>off2</span><span class='Delimiter'>; 
</span><a name="LN749"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>equal</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                           <a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN78"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Firstly, find the greatest range bound that is less 
                     * than or equal to the new lower bound. 
                     */ 
</span>                    <a href="partition.c.html#LN747"><span class='Ref_To_Local'>off1</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN146"><span class='Ref_to_Proto'>partition_bound_bsearch</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN726"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                                   <span class='Operator'>&</span><a href="partition.c.html#LN749"><span class='Ref_To_Local'>equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * off1 == -1 means that all existing bounds are greater 
                     * than the new lower bound.  In that case and the case 
                     * where no partition is defined between the bounds at 
                     * off1 and off1 + 1, we have a "gap" in the range that 
                     * could be occupied by the new partition.  We confirm if 
                     * so by checking whether the new upper bound is confined 
                     * within the gap. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN749"><span class='Ref_To_Local'>equal</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN747"><span class='Ref_To_Local'>off1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="partition.c.html#LN748"><span class='Ref_To_Local'>off2</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN146"><span class='Ref_to_Proto'>partition_bound_bsearch</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN727"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN749"><span class='Ref_To_Local'>equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * If the new upper bound is returned to be equal to 
                         * the bound at off2, the latter must be the upper 
                         * bound of some partition with which the new 
                         * partition clearly overlaps. 
                         * 
                         * Also, if bound at off2 is not same as the one 
                         * returned for the new lower bound (IOW, off1 != 
                         * off2), then the new partition overlaps at least one 
                         * partition. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN749"><span class='Ref_To_Local'>equal</span></a> <span class='Operator'>|| </span><a href="partition.c.html#LN747"><span class='Ref_To_Local'>off1</span></a> <span class='Operator'>!= </span><a href="partition.c.html#LN748"><span class='Ref_To_Local'>off2</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="partition.c.html#LN675"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * The bound at off2 could be the lower bound of 
                             * the partition with which the new partition 
                             * overlaps.  In that case, use the upper bound 
                             * (that is, the bound at off2 + 1) to get the 
                             * index of that partition. 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN748"><span class='Ref_To_Local'>off2</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                <a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN748"><span class='Ref_To_Local'>off2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                            <span class='Control'>else</span> 
                                <a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN748"><span class='Ref_To_Local'>off2</span></a><span class='Delimiter'>]; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !equal&&boundinfo-&GT;in... &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Equal has been set to true and there is no "gap" 
                         * between the bound at off1 and that at off1 + 1, so 
                         * the new partition will overlap some partition. In 
                         * the former case, the new lower bound is found to be 
                         * equal to the bound at off1, which could only ever 
                         * be true if the latter is the lower bound of some 
                         * partition.  It's clear in such a case that the new 
                         * partition overlaps that partition, whose index we 
                         * get using its upper bound (that is, using the bound 
                         * at off1 + 1). 
                         */ 
</span>                        <a href="partition.c.html#LN675"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN746"><span class='Ref_To_Local'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN747"><span class='Ref_To_Local'>off1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if partdesc-&GT;nparts&GT;0 &raquo; </span> 
 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected partition strategy: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="partition.c.html#LN671"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch key-&GT;strategy &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN675"><span class='Ref_To_Local'>overlap</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"partition \"%s\" would overlap partition \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="partition.c.html#LN668"><span class='Ref_to_Parameter'>relname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN672"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN35"><span class='Ref_to_Member'>oids</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN674"><span class='Ref_To_Local'>with</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                 <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN673"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN669"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN808"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end check_new_partition_bound &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_partition_parent 
 * 
 * Returns inheritance parent of a partition by scanning pg_inherits 
 * 
 * Note: Because this function assumes that the relation whose OID is passed 
 * as an argument will have precisely one parent, it should only be called 
 * when it is known that the relation is a partition. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN851"></a><span class='Declare_Function'>get_partition_parent</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN853"></a>    <a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span><a name="LN854"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalogRelation</span><span class='Delimiter'>; 
</span><a name="LN855"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN856"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN857"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN858"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN854"><span class='Ref_To_Local'>catalogRelation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN856"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN851"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN856"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN51"><span class='Ref_to_Const'>Anum_pg_inherits_inhseqno</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN855"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN854"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN166"><span class='Ref_to_Const'>InheritsRelidSeqnoIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="partition.c.html#LN856"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN857"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN855"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN857"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for parent of relation %u"</span><span class='Delimiter'>, </span><a href="partition.c.html#LN851"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN853"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN857"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN858"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN853"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>inhparent<span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN855"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN854"><span class='Ref_To_Local'>catalogRelation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN858"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_partition_parent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_qual_from_partbound 
 *      Given a parser node for partition bound, return the list of executable 
 *      expressions as partition constraint 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN893"></a><span class='Declare_Function'>get_qual_from_partbound</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent</span><span class='Delimiter'>, 
</span><a name="LN894"></a>                        <a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN896"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN893"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN897"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>my_qual</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN896"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN896"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN894"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN799"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN897"><span class='Ref_To_Local'>my_qual</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN130"><span class='Ref_to_Proto'>get_qual_for_list</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN896"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN894"><span class='Ref_to_Parameter'>spec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN894"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN799"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN897"><span class='Ref_To_Local'>my_qual</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN131"><span class='Ref_to_Proto'>get_qual_for_range</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN896"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN894"><span class='Ref_to_Parameter'>spec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected partition strategy: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="partition.c.html#LN896"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN897"><span class='Ref_To_Local'>my_qual</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_qual_from_partbound &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * map_partition_varattnos - maps varattno of any Vars in expr from the 
 * parent attno to partition attno. 
 * 
 * We must allow for cases where physical attnos of a partition can be 
 * different from the parent's. 
 * 
 * Note: this will work on any node tree, so really the argument and result 
 * should be declared "Node *".  But a substantial majority of the callers 
 * are working on Lists, so it's less messy to do the casts internally. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN933"></a><span class='Declare_Function'>map_partition_varattnos</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>expr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>target_varno</span><span class='Delimiter'>, 
</span><a name="LN934"></a>                        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>partrel</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>parent</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN936"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Operator'>*</span><span class='Declare_Local'>part_attnos</span><span class='Delimiter'>; 
</span><a name="LN937"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_whole_row</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN933"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN936"><span class='Ref_To_Local'>part_attnos</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN40"><span class='Ref_to_Proto'>convert_tuples_by_name_map</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN934"><span class='Ref_to_Parameter'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN934"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN933"><span class='Ref_to_Parameter'>expr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/rewrite/rewriteManip.h.html#LN71"><span class='Ref_to_Proto'>map_variable_attnos</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN933"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>, 
</span>                                        <a href="partition.c.html#LN933"><span class='Ref_to_Parameter'>target_varno</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                        <a href="partition.c.html#LN936"><span class='Ref_To_Local'>part_attnos</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN934"><span class='Ref_to_Parameter'>parent</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>natts<span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="partition.c.html#LN937"><span class='Ref_To_Local'>found_whole_row</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* There can never be a whole-row reference here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN937"><span class='Ref_To_Local'>found_whole_row</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected whole-row reference found in partition key"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN933"><span class='Ref_to_Parameter'>expr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_partition_varattnos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RelationGetPartitionQual 
 * 
 * Returns a list of partition quals 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN963"></a><span class='Declare_Function'>RelationGetPartitionQual</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Quick exit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN963"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN132"><span class='Ref_to_Proto'>generate_partition_qual</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN963"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_partition_qual_relid 
 * 
 * Returns an expression tree describing the passed-in relation's partition 
 * constraint. 
 */ 
</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN979"></a><span class='Declare_Function'>get_partition_qual_relid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN981"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN979"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN982"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN983"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>and_args</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do the work only if this relation is a partition. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN981"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="partition.c.html#LN983"><span class='Ref_To_Local'>and_args</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN132"><span class='Ref_to_Proto'>generate_partition_qual</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN981"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN983"><span class='Ref_To_Local'>and_args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="partition.c.html#LN982"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN61"><span class='Ref_to_Proto'>makeBoolExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN554"><span class='Ref_to_EnumConst'>AND_EXPR</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN983"><span class='Ref_To_Local'>and_args</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="partition.c.html#LN982"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN983"><span class='Ref_To_Local'>and_args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Keep the lock. */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN981"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN982"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_partition_qual_relid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Append OIDs of rel's partitions to the list 'partoids' and for each OID, 
 * append pointer rel to the list 'parents'. 
 */ 
</span><a name="LN1005"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>APPEND_REL_PARTITION_OIDS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>partoids</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>parents</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span><span class='Operator'>\ 
</span>    <span class='Delimiter'>{</span><span class='Operator'>\ 
</span>        <span class='Keyword'>int</span>     <a href="../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Delimiter'>;</span><span class='Operator'>\ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rd_partdesc<span class='Operator'>-&GT;</span>nparts<span class='Delimiter'>; </span><a href="../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Operator'>\ 
</span>        <span class='Delimiter'>{</span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>partoids</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>((</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>partoids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>rd_partdesc<span class='Operator'>-&GT;</span>oids<span class='Delimiter'>[</span><a href="../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>parents</span></a><span class='Parentheses'>) </span><span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>((</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>parents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="partition.c.html#LN1005"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>;</span><span class='Operator'>\ 
</span>        <span class='Delimiter'>}</span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RelationGetPartitionDispatchInfo 
 *      Returns information necessary to route tuples down a partition tree 
 * 
 * All the partitions will be locked with lockmode, unless it is NoLock. 
 * A list of the OIDs of all the leaf partitions of rel is returned in 
 * *leaf_part_oids. 
 */ 
</span><a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>* 
</span><a name="LN1025"></a><span class='Declare_Function'>RelationGetPartitionDispatchInfo</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, 
</span><a name="LN1026"></a>                                 <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>num_parted</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>leaf_part_oids</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1028"></a>    <a href="../../include/catalog/partition.h.html#LN59"><span class='Ref_to_Struct'>PartitionDispatchData</span></a> <span class='Operator'>**</span><span class='Declare_Local'>pd</span><span class='Delimiter'>; 
</span><a name="LN1029"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>all_parts</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span><a name="LN1030"></a>               <span class='Operator'>*</span><span class='Declare_Local'>all_parents</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span><a name="LN1031"></a>               <span class='Operator'>*</span><span class='Declare_Local'>parted_rels</span><span class='Delimiter'>, 
</span><a name="LN1032"></a>               <span class='Operator'>*</span><span class='Declare_Local'>parted_rel_parents</span><span class='Delimiter'>; 
</span><a name="LN1033"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>, 
</span><a name="LN1034"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span><a name="LN1035"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1036"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>, 
</span><a name="LN1037"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Lock partitions and make a list of the partitioned ones to prepare 
     * their PartitionDispatch objects below. 
     * 
     * Cannot use find_all_inheritors() here, because then the order of OIDs 
     * in parted_rels list would be unknown, which does not help, because we 
     * assign indexes within individual PartitionDispatch in an order that is 
     * predetermined (determined by the order of OIDs in individual partition 
     * descriptors). 
     */ 
</span>    <span class='Operator'>*</span><a href="partition.c.html#LN1026"><span class='Ref_to_Parameter'>num_parted</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1031"><span class='Ref_To_Local'>parted_rels</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1025"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Root partitioned table has no parent, so NULL for parent */ 
</span>    <a href="partition.c.html#LN1032"><span class='Ref_To_Local'>parted_rel_parents</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1005"><span class='Ref_to_Macro'>APPEND_REL_PARTITION_OIDS</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1025"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1029"><span class='Ref_To_Local'>all_parts</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1030"><span class='Ref_To_Local'>all_parents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1033"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1029"><span class='Ref_To_Local'>all_parts</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1034"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1030"><span class='Ref_To_Local'>all_parents</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1056"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1033"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="partition.c.html#LN1025"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1057"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1034"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1058"></a>        <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>partdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN632"><span class='Ref_to_Macro'>RelationGetPartitionDesc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1056"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If this partition is a partitioned table, add its children to the 
         * end of the list, so that they are processed as well. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1058"><span class='Ref_To_Local'>partdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN1026"><span class='Ref_to_Parameter'>num_parted</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1031"><span class='Ref_To_Local'>parted_rels</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1031"><span class='Ref_To_Local'>parted_rels</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1056"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1032"><span class='Ref_To_Local'>parted_rel_parents</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1032"><span class='Ref_To_Local'>parted_rel_parents</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1057"><span class='Ref_To_Local'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1005"><span class='Ref_to_Macro'>APPEND_REL_PARTITION_OIDS</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1056"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1029"><span class='Ref_To_Local'>all_parts</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1030"><span class='Ref_To_Local'>all_parents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1056"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We keep the partitioned ones open until we're done using the 
         * information being collected here (for example, see 
         * ExecEndModifyTable). 
         */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We want to create two arrays - one for leaf partitions and another for 
     * partitioned tables (including the root table and internal partitions). 
     * While we only create the latter here, leaf partition array of suitable 
     * objects (such as, ResultRelInfo) is created by the caller using the 
     * list of OIDs we return.  Indexes into these arrays get assigned in a 
     * breadth-first manner, whereby partitions of any given level are placed 
     * consecutively in the respective arrays. 
     */ 
</span>    <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN59"><span class='Ref_to_Struct'>PartitionDispatchData</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN1026"><span class='Ref_to_Parameter'>num_parted</span></a> <span class='Operator'>* 
</span>                                           <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN59"><span class='Ref_to_Struct'>PartitionDispatchData</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="partition.c.html#LN1026"><span class='Ref_to_Parameter'>leaf_part_oids</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1036"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1037"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1033"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1031"><span class='Ref_To_Local'>parted_rels</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1034"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1032"><span class='Ref_To_Local'>parted_rel_parents</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1096"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1033"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1097"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1034"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1098"></a>        <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>partkey</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN584"><span class='Ref_to_Macro'>RelationGetPartitionKey</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1096"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1099"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1096"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1100"></a>        <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>partdesc</span> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN632"><span class='Ref_to_Macro'>RelationGetPartitionDesc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1096"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1101"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN1102"></a>                    <span class='Declare_Local'>m</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN59"><span class='Ref_to_Struct'>PartitionDispatchData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN61"><span class='Ref_to_Member'>reldesc</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1096"><span class='Ref_To_Local'>partrel</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN62"><span class='Ref_to_Member'>key</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1098"><span class='Ref_To_Local'>partkey</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN63"><span class='Ref_to_Member'>keystate</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN64"><span class='Ref_to_Member'>partdesc</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1100"><span class='Ref_To_Local'>partdesc</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1097"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * For every partitioned table other than root, we must store a 
             * tuple table slot initialized with its tuple descriptor and a 
             * tuple conversion map to convert a tuple from its parent's 
             * rowtype to its own. That is to make sure that we are looking at 
             * the correct row using the correct tuple descriptor when 
             * computing its partition key for tuple routing. 
             */ 
</span>            <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN65"><span class='Ref_to_Member'>tupslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN144"><span class='Ref_to_Proto'>MakeSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1099"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN66"><span class='Ref_to_Member'>tupmap</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN36"><span class='Ref_to_Proto'>convert_tuples_by_name</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1097"><span class='Ref_To_Local'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="partition.c.html#LN1099"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert row type"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Not required for the root partitioned table */ 
</span>            <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN65"><span class='Ref_to_Member'>tupslot</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN66"><span class='Ref_to_Member'>tupmap</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN67"><span class='Ref_to_Member'>indexes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1100"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Indexes corresponding to the internal partitions are multiplied by 
         * -1 to distinguish them from those of leaf partitions.  Encountering 
         * an index &GT;= 0 means we found a leaf partition, which is immediately 
         * returned as the partition we are looking for.  A negative index 
         * means we found a partitioned table, whose PartitionDispatch object 
         * is located at the above index multiplied back by -1.  Using the 
         * PartitionDispatch object, search is continued further down the 
         * partition tree. 
         */ 
</span>        <a href="partition.c.html#LN1102"><span class='Ref_To_Local'>m</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1101"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN1101"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1100"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN1101"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1145"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>partrelid</span> <span class='Operator'>= </span><a href="partition.c.html#LN1100"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN35"><span class='Ref_to_Member'>oids</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1101"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1145"><span class='Ref_To_Local'>partrelid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="partition.c.html#LN1026"><span class='Ref_to_Parameter'>leaf_part_oids</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN1026"><span class='Ref_to_Parameter'>leaf_part_oids</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1145"><span class='Ref_To_Local'>partrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN67"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1101"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN1036"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * offset denotes the number of partitioned tables of upper 
                 * levels including those of the current level.  Any partition 
                 * of this table must belong to the next level and hence will 
                 * be placed after the last partitioned table of this level. 
                 */ 
</span>                <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN67"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1101"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="partition.c.html#LN1037"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+ </span><a href="partition.c.html#LN1102"><span class='Ref_To_Local'>m</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1102"><span class='Ref_To_Local'>m</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;partdesc-&GT;npart... &raquo; </span> 
        <a href="partition.c.html#LN1035"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * This counts the number of partitioned tables at upper levels 
         * including those of the current level. 
         */ 
</span>        <a href="partition.c.html#LN1037"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+= </span><a href="partition.c.html#LN1102"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN1028"><span class='Ref_To_Local'>pd</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RelationGetPartitionDispatchInfo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Module-local functions */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_partition_operator 
 * 
 * Return oid of the operator of given strategy for a given partition key 
 * column. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1185"></a><span class='Declare_Function'>get_partition_operator</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>col</span><span class='Delimiter'>, </span><a href="../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, 
</span><a name="LN1186"></a>                       <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>need_relabel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1188"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operoid</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First check if there exists an operator of the given strategy, with 
     * this column's type as both its lefttype and righttype, in the 
     * partitioning operator family specified for the column. 
     */ 
</span>    <a href="partition.c.html#LN1188"><span class='Ref_To_Local'>operoid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>], 
</span>                                  <a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>], 
</span>                                  <a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>], 
</span>                                  <a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If one doesn't exist, we must resort to using an operator in the same 
     * opreator family but with the operator class declared input type.  It is 
     * OK to do so, because the column's type is known to be binary-coercible 
     * with the operator class input type (otherwise, the operator class in 
     * question would not have been accepted as the partitioning operator 
     * class).  We must however inform the caller to wrap the non-Const 
     * expression with a RelabelType node to denote the implicit coercion. It 
     * ensures that the resulting expression structurally matches similarly 
     * processed expressions within the optimizer. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1188"><span class='Ref_To_Local'>operoid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="partition.c.html#LN1188"><span class='Ref_To_Local'>operoid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN70"><span class='Ref_to_Proto'>get_opfamily_member</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN60"><span class='Ref_to_Member'>partopfamily</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>], 
</span>                                      <a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>], 
</span>                                      <a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>], 
</span>                                      <a href="partition.c.html#LN1185"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="partition.c.html#LN1186"><span class='Ref_to_Parameter'>need_relabel</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="partition.c.html#LN1186"><span class='Ref_to_Parameter'>need_relabel</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1188"><span class='Ref_To_Local'>operoid</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find operator for partitioning"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN1188"><span class='Ref_To_Local'>operoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_partition_operator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_partition_op_expr 
 *      Returns an Expr for the given partition key column with arg1 and 
 *      arg2 as its leftop and rightop, respectively 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>* 
</span><a name="LN1234"></a><span class='Declare_Function'>make_partition_op_expr</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>keynum</span><span class='Delimiter'>, 
</span><a name="LN1235"></a>                       <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1237"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operoid</span><span class='Delimiter'>; 
</span><a name="LN1238"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_relabel</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1239"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the correct btree operator for this partitioning column */ 
</span>    <a href="partition.c.html#LN1237"><span class='Ref_To_Local'>operoid</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN120"><span class='Ref_to_Proto'>get_partition_operator</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>strategy</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN1238"><span class='Ref_To_Local'>need_relabel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Chosen operator may be such that the non-Const operand needs to be 
     * coerced, so apply the same; see the comment in 
     * get_partition_operator(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="partition.c.html#LN1238"><span class='Ref_To_Local'>need_relabel</span></a> <span class='Operator'>|| 
</span>         <a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN65"><span class='Ref_to_Proto'>makeRelabelType</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, 
</span>                                        <a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN61"><span class='Ref_to_Member'>partopcintype</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>], 
</span>                                        <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                        <a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>], 
</span>                                        <a href="../../include/nodes/primnodes.h.html#LN437"><span class='Ref_to_EnumConst'>COERCE_EXPLICIT_CAST</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate the actual expression */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1263"></a>                <a href="../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a> <span class='Operator'>*</span><span class='Declare_Local'>saopexpr</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Build leftop = ANY (rightop) */ 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN534"><span class='Ref_to_Struct'>ScalarArrayOpExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN537"><span class='Ref_to_Member'>opno</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1237"><span class='Ref_To_Local'>operoid</span></a><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN538"><span class='Ref_to_Member'>opfuncid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1237"><span class='Ref_To_Local'>operoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN539"><span class='Ref_to_Member'>useOr</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN540"><span class='Ref_to_Member'>inputcollid</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>]; 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN541"><span class='Ref_to_Member'>args</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN542"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <a href="partition.c.html#LN1239"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1263"><span class='Ref_To_Local'>saopexpr</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Operator'>: 
</span>            <a href="partition.c.html#LN1239"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/clauses.h.html#LN29"><span class='Ref_to_Proto'>make_opclause</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1237"><span class='Ref_To_Local'>operoid</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                   <a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1235"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                   <a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1234"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid partitioning strategy"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch key-&GT;strategy &raquo; </span> 
 
    <span class='Control'>return</span> <a href="partition.c.html#LN1239"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_partition_op_expr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_qual_for_list 
 * 
 * Returns an implicit-AND list of expressions to use as a list partition's 
 * constraint, given the partition key and bound structures. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1302"></a><span class='Declare_Function'>get_qual_for_list</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1304"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1305"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>keyCol</span><span class='Delimiter'>; 
</span><a name="LN1306"></a>    <a href="../../include/nodes/primnodes.h.html#LN947"><span class='Ref_to_Struct'>ArrayExpr</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN1307"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>opexpr</span><span class='Delimiter'>; 
</span><a name="LN1308"></a>    <a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nulltest</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN1310"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arrelems</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1311"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>list_has_null</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct Var or expression representing the partition column */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="partition.c.html#LN1305"><span class='Ref_To_Local'>keyCol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                  <a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                  <a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                  <a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                  <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="partition.c.html#LN1305"><span class='Ref_To_Local'>keyCol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create list of Consts for the allowed values, excluding any nulls */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1309"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN802"><span class='Ref_to_Member'>listdatums</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1327"></a>        <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1309"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1327"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a><span class='Parentheses'>) 
</span>            <a href="partition.c.html#LN1311"><span class='Ref_To_Local'>list_has_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="partition.c.html#LN1310"><span class='Ref_To_Local'>arrelems</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1310"><span class='Ref_To_Local'>arrelems</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1327"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Construct an ArrayExpr for the non-null partition values */ 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN947"><span class='Ref_to_Struct'>ArrayExpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN950"><span class='Ref_to_Member'>array_typeid</span></a> <span class='Operator'>= !</span><a href="../../include/utils/lsyscache.h.html#LN179"><span class='Ref_to_Macro'>type_is_array</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Operator'>? </span><a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Operator'>: </span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN951"><span class='Ref_to_Member'>array_collid</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN952"><span class='Ref_to_Member'>element_typeid</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN953"><span class='Ref_to_Member'>elements</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1310"><span class='Ref_To_Local'>arrelems</span></a><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN954"><span class='Ref_to_Member'>multidims</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN955"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate the main expression, i.e., keyCol = ANY (arr) */ 
</span>    <a href="partition.c.html#LN1307"><span class='Ref_To_Local'>opexpr</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN122"><span class='Ref_to_Proto'>make_partition_op_expr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1302"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, 
</span>                                    <a href="partition.c.html#LN1305"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1306"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN1311"><span class='Ref_To_Local'>list_has_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Gin up a "col IS NOT NULL" test that will be AND'd with the main 
         * expression.  This might seem redundant, but the partition routing 
         * machinery needs it. 
         */ 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1305"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1179"><span class='Ref_to_Member'>nulltesttype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NOT_NULL</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1180"><span class='Ref_to_Member'>argisrow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1181"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN1304"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1307"><span class='Ref_To_Local'>opexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Gin up a "col IS NULL" test that will be OR'd with the main 
         * expression. 
         */ 
</span><a name="LN1371"></a>        <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>or</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1305"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1179"><span class='Ref_to_Member'>nulltesttype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NULL</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1180"><span class='Ref_to_Member'>argisrow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1181"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN1371"><span class='Ref_To_Local'>or</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN61"><span class='Ref_to_Proto'>makeBoolExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN554"><span class='Ref_to_EnumConst'>OR_EXPR</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1308"><span class='Ref_To_Local'>nulltest</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1307"><span class='Ref_To_Local'>opexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1304"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1371"><span class='Ref_To_Local'>or</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN1304"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_qual_for_list &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_range_key_properties 
 *      Returns range partition key information for a given column 
 * 
 * This is a subroutine for get_qual_for_range, and its API is pretty 
 * specialized to that caller. 
 * 
 * Constructs an Expr for the key column (returned in *keyCol) and Consts 
 * for the lower and upper range limits (returned in *lower_val and 
 * *upper_val).  For UNBOUNDED limits, NULL is returned instead of a Const. 
 * All of these structures are freshly palloc'd. 
 * 
 * *partexprs_item points to the cell containing the next expression in 
 * the key-&GT;partexprs list, or NULL.  It may be advanced upon return. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1402"></a><span class='Declare_Function'>get_range_key_properties</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>keynum</span><span class='Delimiter'>, 
</span><a name="LN1403"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ldatum</span><span class='Delimiter'>, 
</span><a name="LN1404"></a>                         <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>udatum</span><span class='Delimiter'>, 
</span><a name="LN1405"></a>                         <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>partexprs_item</span><span class='Delimiter'>, 
</span><a name="LN1406"></a>                         <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>keyCol</span><span class='Delimiter'>, 
</span><a name="LN1407"></a>                         <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>lower_val</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>upper_val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Get partition key expression for this column */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="partition.c.html#LN1406"><span class='Ref_to_Parameter'>keyCol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                   <a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>], 
</span>                                   <a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>], 
</span>                                   <a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>], 
</span>                                   <a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1402"><span class='Ref_to_Parameter'>keynum</span></a><span class='Delimiter'>], 
</span>                                   <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN1405"><span class='Ref_to_Parameter'>partexprs_item</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of partition key expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="partition.c.html#LN1406"><span class='Ref_to_Parameter'>keyCol</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN1405"><span class='Ref_to_Parameter'>partexprs_item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="partition.c.html#LN1405"><span class='Ref_to_Parameter'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN1405"><span class='Ref_to_Parameter'>partexprs_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get appropriate Const nodes for the bounds */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN1403"><span class='Ref_to_Parameter'>ldatum</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="partition.c.html#LN1407"><span class='Ref_to_Parameter'>lower_val</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1403"><span class='Ref_to_Parameter'>ldatum</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="partition.c.html#LN1407"><span class='Ref_to_Parameter'>lower_val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN1404"><span class='Ref_to_Parameter'>udatum</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="partition.c.html#LN1407"><span class='Ref_to_Parameter'>upper_val</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1404"><span class='Ref_to_Parameter'>udatum</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="partition.c.html#LN1407"><span class='Ref_to_Parameter'>upper_val</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_range_key_properties &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_qual_for_range 
 * 
 * Returns an implicit-AND list of expressions to use as a range partition's 
 * constraint, given the partition key and bound structures. 
 * 
 * For a multi-column range partition key, say (a, b, c), with (al, bl, cl) 
 * as the lower bound tuple and (au, bu, cu) as the upper bound tuple, we 
 * generate an expression tree of the following form: 
 * 
 *  (a IS NOT NULL) and (b IS NOT NULL) and (c IS NOT NULL) 
 *      AND 
 *  (a &GT; al OR (a = al AND b &GT; bl) OR (a = al AND b = bl AND c &GT;= cl)) 
 *      AND 
 *  (a &LT; au OR (a = au AND b &LT; bu) OR (a = au AND b = bu AND c &LT; cu)) 
 * 
 * It is often the case that a prefix of lower and upper bound tuples contains 
 * the same values, for example, (al = au), in which case, we will emit an 
 * expression tree of the following form: 
 * 
 *  (a IS NOT NULL) and (b IS NOT NULL) and (c IS NOT NULL) 
 *      AND 
 *  (a = al) 
 *      AND 
 *  (b &GT; bl OR (b = bl AND c &GT;= cl)) 
 *      AND 
 *  (b &LT; bu) OR (b = bu AND c &LT; cu)) 
 * 
 * If cu happens to be UNBOUNDED, we need not emit any expression for it, so 
 * the last line would be: 
 * 
 *  (b &LT; bu) OR (b = bu), which is simplified to (b &LT;= bu) 
 * 
 * In most common cases with only one partition column, say a, the following 
 * expression tree will be generated: a IS NOT NULL AND a &GT;= al AND a &LT; au 
 * 
 * If all values of both lower and upper bounds are UNBOUNDED, the partition 
 * does not really have a constraint, except the IS NOT NULL constraint for 
 * partition keys. 
 * 
 * If we end up with an empty result list, we return a single-member list 
 * containing a constant TRUE, because callers expect a non-empty list. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1483"></a><span class='Declare_Function'>get_qual_for_range</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>spec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1485"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1486"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell1</span><span class='Delimiter'>, 
</span><a name="LN1487"></a>               <span class='Operator'>*</span><span class='Declare_Local'>cell2</span><span class='Delimiter'>, 
</span><a name="LN1488"></a>               <span class='Operator'>*</span><span class='Declare_Local'>partexprs_item</span><span class='Delimiter'>, 
</span><a name="LN1489"></a>               <span class='Operator'>*</span><span class='Declare_Local'>partexprs_item_saved</span><span class='Delimiter'>; 
</span><a name="LN1490"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1491"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN1492"></a>    <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ldatum</span><span class='Delimiter'>, 
</span><a name="LN1493"></a>               <span class='Operator'>*</span><span class='Declare_Local'>udatum</span><span class='Delimiter'>; 
</span><a name="LN1494"></a>    <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>keyCol</span><span class='Delimiter'>; 
</span><a name="LN1495"></a>    <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>lower_val</span><span class='Delimiter'>, 
</span><a name="LN1496"></a>               <span class='Operator'>*</span><span class='Declare_Local'>upper_val</span><span class='Delimiter'>; 
</span><a name="LN1497"></a>    <a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>nulltest</span><span class='Delimiter'>; 
</span><a name="LN1498"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lower_or_arms</span><span class='Delimiter'>, 
</span><a name="LN1499"></a>               <span class='Operator'>*</span><span class='Declare_Local'>upper_or_arms</span><span class='Delimiter'>; 
</span><a name="LN1500"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_or_arms</span><span class='Delimiter'>, 
</span><a name="LN1501"></a>                <span class='Declare_Local'>current_or_arm</span><span class='Delimiter'>; 
</span><a name="LN1502"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lower_or_start_datum</span><span class='Delimiter'>, 
</span><a name="LN1503"></a>               <span class='Operator'>*</span><span class='Declare_Local'>upper_or_start_datum</span><span class='Delimiter'>; 
</span><a name="LN1504"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_next_lower_arm</span><span class='Delimiter'>, 
</span><a name="LN1505"></a>                <span class='Declare_Local'>need_next_upper_arm</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN1502"><span class='Ref_To_Local'>lower_or_start_datum</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN805"><span class='Ref_to_Member'>lowerdatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1503"><span class='Ref_To_Local'>upper_or_start_datum</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN806"><span class='Ref_to_Member'>upperdatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1500"><span class='Ref_To_Local'>num_or_arms</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * A range-partitioned table does not currently allow partition keys to be 
     * null, so emit an IS NOT NULL expression for each key column. 
     */ 
</span>    <a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1518"></a>        <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>keyCol</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="partition.c.html#LN1518"><span class='Ref_To_Local'>keyCol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/makefuncs.h.html#LN25"><span class='Ref_to_Proto'>makeVar</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                      <a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN68"><span class='Ref_to_Member'>parttypid</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN69"><span class='Ref_to_Member'>parttypmod</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN73"><span class='Ref_to_Member'>parttypcoll</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of partition key expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1518"><span class='Ref_To_Local'>keyCol</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="partition.c.html#LN1497"><span class='Ref_To_Local'>nulltest</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1175"><span class='Ref_to_Struct'>NullTest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1497"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1178"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1518"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1497"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1179"><span class='Ref_to_Member'>nulltesttype</span></a> <span class='Operator'>= </span><a href="../../include/nodes/primnodes.h.html#LN1172"><span class='Ref_to_EnumConst'>IS_NOT_NULL</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1497"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1180"><span class='Ref_to_Member'>argisrow</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1497"><span class='Ref_To_Local'>nulltest</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1181"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1497"><span class='Ref_To_Local'>nulltest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key-&GT;partnatts;... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Iterate over the key columns and check if the corresponding lower and 
     * upper datums are equal using the btree equality operator for the 
     * column's type.  If equal, we emit single keyCol = common_value 
     * expression.  Starting from the first column for which the corresponding 
     * lower and upper bound datums are not equal, we generate OR expressions 
     * as shown in the function's header comment. 
     */ 
</span>    <a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1489"><span class='Ref_To_Local'>partexprs_item_saved</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* placate compiler */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN805"><span class='Ref_to_Member'>lowerdatums</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>spec</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN806"><span class='Ref_to_Member'>upperdatums</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1558"></a>        <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span><span class='Delimiter'>; 
</span><a name="LN1559"></a>        <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1560"></a>        <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>test_expr</span><span class='Delimiter'>; 
</span><a name="LN1561"></a>        <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>test_exprstate</span><span class='Delimiter'>; 
</span><a name="LN1562"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>test_result</span><span class='Delimiter'>; 
</span><a name="LN1563"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN1492"><span class='Ref_To_Local'>ldatum</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1493"><span class='Ref_To_Local'>udatum</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Since get_range_key_properties() modifies partexprs_item, and we 
         * might need to start over from the previous expression in the later 
         * part of this function, save away the current value. 
         */ 
</span>        <a href="partition.c.html#LN1489"><span class='Ref_To_Local'>partexprs_item_saved</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN124"><span class='Ref_to_Proto'>get_range_key_properties</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1492"><span class='Ref_To_Local'>ldatum</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1493"><span class='Ref_To_Local'>udatum</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="partition.c.html#LN1494"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN1496"><span class='Ref_To_Local'>upper_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If either or both of lower_val and upper_val is NULL, they are 
         * unequal, because being NULL means the column is unbounded in the 
         * respective direction. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a> <span class='Operator'>|| !</span><a href="partition.c.html#LN1496"><span class='Ref_To_Local'>upper_val</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create the test expression */ 
</span>        <a href="partition.c.html#LN1558"><span class='Ref_To_Local'>estate</span></a> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1559"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1558"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN447"><span class='Ref_to_Member'>es_query_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1560"><span class='Ref_To_Local'>test_expr</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN122"><span class='Ref_to_Proto'>make_partition_op_expr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a><span class='Delimiter'>, 
</span>                                           <span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1496"><span class='Ref_To_Local'>upper_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/nodeFuncs.h.html#LN45"><span class='Ref_to_Proto'>fix_opfuncids</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1560"><span class='Ref_To_Local'>test_expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1561"><span class='Ref_To_Local'>test_exprstate</span></a> <span class='Operator'>= </span><a href="../executor/execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1560"><span class='Ref_To_Local'>test_expr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1562"><span class='Ref_To_Local'>test_result</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1561"><span class='Ref_To_Local'>test_exprstate</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1558"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <span class='Operator'>&</span><a href="partition.c.html#LN1563"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1559"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1558"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If not equal, go generate the OR expressions */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1562"><span class='Ref_To_Local'>test_result</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The bounds for the last key column can't be equal, because such a 
         * range partition would never be allowed to be defined (it would have 
         * an empty range otherwise). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid range bound specification"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Equal, so generate keyCol = lower_val expression */ 
</span>        <a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <a href="partition.c.html#LN122"><span class='Ref_to_Proto'>make_partition_op_expr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, 
</span>                                                <a href="partition.c.html#LN1494"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* First pair of lower_val and upper_val that are not equal. */ 
</span>    <a href="partition.c.html#LN1502"><span class='Ref_To_Local'>lower_or_start_datum</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1503"><span class='Ref_To_Local'>upper_or_start_datum</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OR will have as many arms as there are key columns left. */ 
</span>    <a href="partition.c.html#LN1500"><span class='Ref_To_Local'>num_or_arms</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>- </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1501"><span class='Ref_To_Local'>current_or_arm</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1504"><span class='Ref_To_Local'>need_next_lower_arm</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1505"><span class='Ref_To_Local'>need_next_upper_arm</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1501"><span class='Ref_To_Local'>current_or_arm</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1500"><span class='Ref_To_Local'>num_or_arms</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1633"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>lower_or_arm_args</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span><a name="LN1634"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>upper_or_arm_args</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Restart scan of columns from the i'th one */ 
</span>        <a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1489"><span class='Ref_To_Local'>partexprs_item_saved</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN193"><span class='Ref_to_Macro'>for_both_cell</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1502"><span class='Ref_To_Local'>lower_or_start_datum</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1503"><span class='Ref_To_Local'>upper_or_start_datum</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1642"></a>            <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ldatum_next</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN1643"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>udatum_next</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <a href="partition.c.html#LN1492"><span class='Ref_To_Local'>ldatum</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>))</span> 
                <a href="partition.c.html#LN1642"><span class='Ref_To_Local'>ldatum_next</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1486"><span class='Ref_To_Local'>cell1</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1493"><span class='Ref_To_Local'>udatum</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Parentheses'>))</span> 
                <a href="partition.c.html#LN1643"><span class='Ref_To_Local'>udatum_next</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1487"><span class='Ref_To_Local'>cell2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN124"><span class='Ref_to_Proto'>get_range_key_properties</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1492"><span class='Ref_To_Local'>ldatum</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1493"><span class='Ref_To_Local'>udatum</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="partition.c.html#LN1488"><span class='Ref_To_Local'>partexprs_item</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="partition.c.html#LN1494"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN1496"><span class='Ref_To_Local'>upper_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1504"><span class='Ref_To_Local'>need_next_lower_arm</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1660"></a>                <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>strategy</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * For the non-last columns of this arm, use the EQ operator. 
                 * For the last or the last finite-valued column, use GE. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>- </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1501"><span class='Ref_To_Local'>current_or_arm</span></a><span class='Parentheses'>) 
</span>                    <a href="partition.c.html#LN1660"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="partition.c.html#LN1642"><span class='Ref_To_Local'>ldatum_next</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN1642"><span class='Ref_To_Local'>ldatum_next</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                         <a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                    <a href="partition.c.html#LN1660"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN31"><span class='Ref_to_Const'>BTGreaterEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="partition.c.html#LN1660"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN32"><span class='Ref_to_Const'>BTGreaterStrategyNumber</span></a><span class='Delimiter'>; 
</span> 
                <a href="partition.c.html#LN1633"><span class='Ref_To_Local'>lower_or_arm_args</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1633"><span class='Ref_To_Local'>lower_or_arm_args</span></a><span class='Delimiter'>, 
</span>                                            <a href="partition.c.html#LN122"><span class='Ref_to_Proto'>make_partition_op_expr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                                   <a href="partition.c.html#LN1660"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, 
</span>                                                                   <a href="partition.c.html#LN1494"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1495"><span class='Ref_To_Local'>lower_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if need_next_lower_arm&&... &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1505"><span class='Ref_To_Local'>need_next_upper_arm</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN1496"><span class='Ref_To_Local'>upper_val</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1683"></a>                <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>strategy</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * For the non-last columns of this arm, use the EQ operator. 
                 * For the last finite-valued column, use LE. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>- </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1501"><span class='Ref_To_Local'>current_or_arm</span></a><span class='Parentheses'>) 
</span>                    <a href="partition.c.html#LN1683"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1643"><span class='Ref_To_Local'>udatum_next</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN1643"><span class='Ref_To_Local'>udatum_next</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>                    <a href="partition.c.html#LN1683"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN29"><span class='Ref_to_Const'>BTLessEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="partition.c.html#LN1683"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../include/access/stratnum.h.html#LN28"><span class='Ref_to_Const'>BTLessStrategyNumber</span></a><span class='Delimiter'>; 
</span> 
                <a href="partition.c.html#LN1634"><span class='Ref_To_Local'>upper_or_arm_args</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1634"><span class='Ref_To_Local'>upper_or_arm_args</span></a><span class='Delimiter'>, 
</span>                                            <a href="partition.c.html#LN122"><span class='Ref_to_Proto'>make_partition_op_expr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1483"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>, 
</span>                                                                   <a href="partition.c.html#LN1683"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, 
</span>                                                                   <a href="partition.c.html#LN1494"><span class='Ref_To_Local'>keyCol</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1496"><span class='Ref_To_Local'>upper_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if need_next_upper_arm&&... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Did we generate enough of OR's arguments?  First arm considers 
             * the first of the remaining columns, second arm considers first 
             * two of the remaining columns, and so on. 
             */ 
</span>            <span class='Operator'>++</span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1491"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>- </span><a href="partition.c.html#LN1490"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><a href="partition.c.html#LN1501"><span class='Ref_To_Local'>current_or_arm</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We need not emit the next arm if the new column that will 
                 * be considered is unbounded. 
                 */ 
</span>                <a href="partition.c.html#LN1504"><span class='Ref_To_Local'>need_next_lower_arm</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1642"><span class='Ref_To_Local'>ldatum_next</span></a> <span class='Operator'>&& !</span><a href="partition.c.html#LN1642"><span class='Ref_To_Local'>ldatum_next</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a><span class='Delimiter'>; 
</span>                <a href="partition.c.html#LN1505"><span class='Ref_To_Local'>need_next_upper_arm</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1643"><span class='Ref_To_Local'>udatum_next</span></a> <span class='Operator'>&& !</span><a href="partition.c.html#LN1643"><span class='Ref_To_Local'>udatum_next</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1633"><span class='Ref_To_Local'>lower_or_arm_args</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1633"><span class='Ref_To_Local'>lower_or_arm_args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span> 
                              <span class='Operator'>? </span><a href="../../include/nodes/makefuncs.h.html#LN61"><span class='Ref_to_Proto'>makeBoolExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN554"><span class='Ref_to_EnumConst'>AND_EXPR</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1633"><span class='Ref_To_Local'>lower_or_arm_args</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                                    <span class='Operator'>: </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1633"><span class='Ref_To_Local'>lower_or_arm_args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1634"><span class='Ref_To_Local'>upper_or_arm_args</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1634"><span class='Ref_To_Local'>upper_or_arm_args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span> 
                              <span class='Operator'>? </span><a href="../../include/nodes/makefuncs.h.html#LN61"><span class='Ref_to_Proto'>makeBoolExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN554"><span class='Ref_to_EnumConst'>AND_EXPR</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1634"><span class='Ref_To_Local'>upper_or_arm_args</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                                    <span class='Operator'>: </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1634"><span class='Ref_To_Local'>upper_or_arm_args</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If no work to do in the next iteration, break away. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN1504"><span class='Ref_To_Local'>need_next_lower_arm</span></a> <span class='Operator'>&& !</span><a href="partition.c.html#LN1505"><span class='Ref_To_Local'>need_next_upper_arm</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>++</span><a href="partition.c.html#LN1501"><span class='Ref_To_Local'>current_or_arm</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while current_or_arm&LT;num_or... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Generate the OR expressions for each of lower and upper bounds (if 
     * required), and append to the list of implicitly ANDed list of 
     * expressions. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span> 
                         <span class='Operator'>? </span><a href="../../include/nodes/makefuncs.h.html#LN61"><span class='Ref_to_Proto'>makeBoolExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN554"><span class='Ref_to_EnumConst'>OR_EXPR</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                         <span class='Operator'>: </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1498"><span class='Ref_To_Local'>lower_or_arms</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span> 
                         <span class='Operator'>? </span><a href="../../include/nodes/makefuncs.h.html#LN61"><span class='Ref_to_Proto'>makeBoolExpr</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN554"><span class='Ref_to_EnumConst'>OR_EXPR</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                         <span class='Operator'>: </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1499"><span class='Ref_To_Local'>upper_or_arms</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* As noted above, caller expects the list to be non-empty. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/makefuncs.h.html#LN59"><span class='Ref_to_Proto'>makeBoolConst</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN1485"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_qual_for_range &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_partition_qual 
 * 
 * Generate partition predicate from rel's partition bound expression 
 * 
 * Result expression tree is stored CacheMemoryContext to ensure it survives 
 * as long as the relcache entry. But we should be running in a less long-lived 
 * working context. To avoid leaking cache memory if this routine fails partway 
 * through, we build in working memory and then copy the completed structure 
 * into cache memory. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1775"></a><span class='Declare_Function'>generate_partition_qual</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1777"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1778"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1779"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>boundDatum</span><span class='Delimiter'>; 
</span><a name="LN1780"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1781"></a>    <a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bound</span><span class='Delimiter'>; 
</span><a name="LN1782"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>my_qual</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span><a name="LN1783"></a>               <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1784"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>parent</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Guard against stack overflow due to overly deep partition tree */ 
</span>    <a href="../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick copy */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN131"><span class='Ref_to_Member'>rd_partcheck</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN131"><span class='Ref_to_Member'>rd_partcheck</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Grab at least an AccessShareLock on the parent table */ 
</span>    <a href="partition.c.html#LN1784"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN78"><span class='Ref_to_Proto'>get_partition_parent</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                       <a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get pg_class.relpartbound */ 
</span>    <a href="partition.c.html#LN1777"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1777"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, 
</span>             <a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN1779"><span class='Ref_To_Local'>boundDatum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1777"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/catalog/pg_class.h.html#LN134"><span class='Ref_to_Const'>Anum_pg_class_relpartbound</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="partition.c.html#LN1780"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1780"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span>                 <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"relation \"%s\" has relpartbound = null"</span><span class='Delimiter'>, 
</span>             <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1781"><span class='Ref_To_Local'>bound</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN795"><span class='Ref_to_Struct'>PartitionBoundSpec</span></a><span class='Delimiter'>, 
</span>                     <a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1779"><span class='Ref_To_Local'>boundDatum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1777"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN1782"><span class='Ref_To_Local'>my_qual</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN79"><span class='Ref_to_Proto'>get_qual_from_partbound</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1784"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1781"><span class='Ref_To_Local'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add the parent's quals to the list (if any) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1784"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relispartition<span class='Parentheses'>) 
</span>        <a href="partition.c.html#LN1783"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN219"><span class='Ref_to_Proto'>list_concat</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN132"><span class='Ref_to_Proto'>generate_partition_qual</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1784"><span class='Ref_To_Local'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="partition.c.html#LN1782"><span class='Ref_To_Local'>my_qual</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="partition.c.html#LN1783"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1782"><span class='Ref_To_Local'>my_qual</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Change Vars to have partition's attnos instead of the parent's. We do 
     * this after we concatenate the parent's quals, because we want every Var 
     * in it to bear this relation's attnos. It's safe to assume varno = 1 
     * here. 
     */ 
</span>    <a href="partition.c.html#LN1783"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/catalog/partition.h.html#LN81"><span class='Ref_to_Proto'>map_partition_varattnos</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1783"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1784"><span class='Ref_To_Local'>parent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Save a copy in the relcache */ 
</span>    <a href="partition.c.html#LN1778"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN1775"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN131"><span class='Ref_to_Member'>rd_partcheck</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1783"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1778"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Keep the parent locked until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1784"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN1783"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_partition_qual &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------- 
 *      FormPartitionKeyDatum 
 *          Construct values[] and isnull[] arrays for the partition key 
 *          of a tuple. 
 * 
 *  pd              Partition dispatch object of the partitioned table 
 *  slot            Heap tuple from which to extract partition key 
 *  estate          executor state for evaluating any partition key 
 *                  expressions (must be non-NULL) 
 *  values          Array of partition key Datums (output area) 
 *  isnull          Array of is-null indicators (output area) 
 * 
 * the ecxt_scantuple slot of estate's per-tuple expr context must point to 
 * the heap tuple passed in. 
 * ---------------- 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1857"></a><span class='Declare_Function'>FormPartitionKeyDatum</span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Declare_Parameter'>pd</span><span class='Delimiter'>, 
</span><a name="LN1858"></a>                      <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN1859"></a>                      <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1860"></a>                      <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, 
</span><a name="LN1861"></a>                      <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1863"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>partexpr_item</span><span class='Delimiter'>; 
</span><a name="LN1864"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN62"><span class='Ref_to_Member'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& </span><a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN63"><span class='Ref_to_Member'>keystate</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check caller has set up context correctly */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="partition.c.html#LN1859"><span class='Ref_to_Parameter'>estate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>               <a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1859"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>ecxt_scantuple <span class='Operator'>== </span><a href="partition.c.html#LN1858"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* First time through, set up expression evaluation state */ 
</span>        <a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN63"><span class='Ref_to_Member'>keystate</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN249"><span class='Ref_to_Proto'>ExecPrepareExprList</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN62"><span class='Ref_to_Member'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN57"><span class='Ref_to_Member'>partexprs</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1859"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="partition.c.html#LN1863"><span class='Ref_To_Local'>partexpr_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN63"><span class='Ref_to_Member'>keystate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1864"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN1864"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN62"><span class='Ref_to_Member'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN1864"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1879"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>keycol</span> <span class='Operator'>= </span><a href="partition.c.html#LN1857"><span class='Ref_to_Parameter'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN62"><span class='Ref_to_Member'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN55"><span class='Ref_to_Member'>partattrs</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1864"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1880"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1881"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1879"><span class='Ref_To_Local'>keycol</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Plain column; get the value directly from the heap tuple */ 
</span>            <a href="partition.c.html#LN1880"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN167"><span class='Ref_to_Proto'>slot_getattr</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1858"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1879"><span class='Ref_To_Local'>keycol</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN1881"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Expression; need to evaluate it */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1863"><span class='Ref_To_Local'>partexpr_item</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of partition key expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1880"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN279"><span class='Ref_to_Func'>ExecEvalExprSwitchContext</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1863"><span class='Ref_To_Local'>partexpr_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1859"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="partition.c.html#LN1881"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1863"><span class='Ref_To_Local'>partexpr_item</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1863"><span class='Ref_To_Local'>partexpr_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="partition.c.html#LN1860"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1864"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN1880"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN1861"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1864"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN1881"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;pd-&GT;key-&GT;partna... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1863"><span class='Ref_To_Local'>partexpr_item</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of partition key expressions"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end FormPartitionKeyDatum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_partition_for_tuple 
 *      Finds a leaf partition for tuple contained in *slot 
 * 
 * Returned value is the sequence number of the leaf partition thus found, 
 * or -1 if no leaf partition is found for the tuple.  *failed_at is set 
 * to the OID of the partitioned table whose partition was not found in 
 * the latter case. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1916"></a><span class='Declare_Function'>get_partition_for_tuple</span><span class='Parentheses'>(</span><a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pd</span><span class='Delimiter'>, 
</span><a name="LN1917"></a>                        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, 
</span><a name="LN1918"></a>                        <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN1919"></a>                        <a href="../../include/catalog/partition.h.html#LN59"><span class='Ref_to_Struct'>PartitionDispatchData</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>failed_at</span><span class='Delimiter'>, 
</span><a name="LN1920"></a>                        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>failed_slot</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1922"></a>    <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Declare_Local'>parent</span><span class='Delimiter'>; 
</span><a name="LN1923"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN1924"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN50"><span class='Ref_to_Const'>PARTITION_MAX_KEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN1925"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cur_offset</span><span class='Delimiter'>, 
</span><a name="LN1926"></a>                <span class='Declare_Local'>cur_index</span><span class='Delimiter'>; 
</span><a name="LN1927"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1928"></a>                <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1929"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ecxt</span> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1918"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1930"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ecxt_scantuple_old</span> <span class='Operator'>= </span><a href="partition.c.html#LN1929"><span class='Ref_To_Local'>ecxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* start with the root partitioned table */ 
</span>    <a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1916"><span class='Ref_to_Parameter'>pd</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1936"></a>        <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN62"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>; 
</span><a name="LN1937"></a>        <a href="../../include/catalog/partition.h.html#LN39"><span class='Ref_to_Typedef'>PartitionDesc</span></a> <span class='Declare_Local'>partdesc</span> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN64"><span class='Ref_to_Member'>partdesc</span></a><span class='Delimiter'>; 
</span><a name="LN1938"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myslot</span> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN65"><span class='Ref_to_Member'>tupslot</span></a><span class='Delimiter'>; 
</span><a name="LN1939"></a>        <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN66"><span class='Ref_to_Member'>tupmap</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1938"><span class='Ref_To_Local'>myslot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="partition.c.html#LN1939"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1943"></a>            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN159"><span class='Ref_to_Proto'>ExecFetchSlotTuple</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/executor/tuptable.h.html#LN154"><span class='Ref_to_Proto'>ExecClearTuple</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1938"><span class='Ref_To_Local'>myslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1943"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1943"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1939"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1943"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1938"><span class='Ref_To_Local'>myslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1938"><span class='Ref_To_Local'>myslot</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Quick exit */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1937"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN34"><span class='Ref_to_Member'>nparts</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="partition.c.html#LN1919"><span class='Ref_to_Parameter'>failed_at</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="partition.c.html#LN1920"><span class='Ref_to_Parameter'>failed_slot</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN1928"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="partition.c.html#LN2049"><span class='Ref_to_Label'>error_exit</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Extract partition key from tuple. Expression evaluation machinery 
         * that FormPartitionKeyDatum() invokes expects ecxt_scantuple to 
         * point to the correct tuple slot.  The slot might have changed from 
         * what was used for the parent table if the table of the current 
         * partitioning level has different tuple descriptor from the parent. 
         * So update ecxt_scantuple accordingly. 
         */ 
</span>        <a href="partition.c.html#LN1929"><span class='Ref_To_Local'>ecxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/partition.h.html#LN90"><span class='Ref_to_Proto'>FormPartitionKeyDatum</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1918"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1923"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1924"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1936"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Since we cannot route tuples with NULL partition keys through a 
             * range-partitioned table, simply return that no partition exists 
             */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1927"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN1927"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN1936"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN1927"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1924"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1927"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="partition.c.html#LN1919"><span class='Ref_to_Parameter'>failed_at</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="partition.c.html#LN1920"><span class='Ref_to_Parameter'>failed_slot</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span>                    <a href="partition.c.html#LN1928"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="partition.c.html#LN2049"><span class='Ref_to_Label'>error_exit</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A null partition key is only acceptable if null-accepting list 
         * partition exists. 
         */ 
</span>        <a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1924"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&& </span><a href="partition.c.html#LN92"><span class='Ref_to_Macro'>partition_bound_accepts_nulls</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1937"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Parentheses'>))</span> 
            <a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1937"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN88"><span class='Ref_to_Member'>null_index</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="partition.c.html#LN1924"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Else bsearch in partdesc-&GT;boundinfo */ 
</span><a name="LN1999"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>equal</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="partition.c.html#LN1925"><span class='Ref_To_Local'>cur_offset</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN146"><span class='Ref_to_Proto'>partition_bound_bsearch</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN1936"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN1937"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Delimiter'>, 
</span>                                                 <a href="partition.c.html#LN1923"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="partition.c.html#LN1999"><span class='Ref_To_Local'>equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1936"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1925"><span class='Ref_To_Local'>cur_offset</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="partition.c.html#LN1999"><span class='Ref_To_Local'>equal</span></a><span class='Parentheses'>) 
</span>                        <a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1937"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1925"><span class='Ref_To_Local'>cur_offset</span></a><span class='Delimiter'>]; 
</span>                    <span class='Control'>else</span> 
                        <a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Offset returned is such that the bound at offset is 
                     * found to be less or equal with the tuple. So, the bound 
                     * at offset+1 would be the upper bound. 
                     */ 
</span>                    <a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1937"><span class='Ref_To_Local'>partdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN36"><span class='Ref_to_Member'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1925"><span class='Ref_To_Local'>cur_offset</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected partition strategy: %d"</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="partition.c.html#LN1936"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch key-&GT;strategy &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isnull[0] &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * cur_index &LT; 0 means we failed to find a partition of this parent. 
         * cur_index &GT;= 0 means we either found the leaf partition, or the 
         * next parent to find a partition of. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="partition.c.html#LN1928"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="partition.c.html#LN1919"><span class='Ref_to_Parameter'>failed_at</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="partition.c.html#LN1920"><span class='Ref_to_Parameter'>failed_slot</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1917"><span class='Ref_to_Parameter'>slot</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN67"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="partition.c.html#LN1928"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN67"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1916"><span class='Ref_to_Parameter'>pd</span></a><span class='Delimiter'>[</span><span class='Operator'>-</span><a href="partition.c.html#LN1922"><span class='Ref_To_Local'>parent</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN67"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN1926"><span class='Ref_To_Local'>cur_index</span></a><span class='Delimiter'>]]; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
 
<a name="LN2049"></a><span class='Label'>error_exit</span><span class='Operator'>: 
</span>    <a href="partition.c.html#LN1929"><span class='Ref_To_Local'>ecxt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN196"><span class='Ref_to_Member'>ecxt_scantuple</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN1930"><span class='Ref_To_Local'>ecxt_scantuple_old</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="partition.c.html#LN1928"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_partition_for_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * qsort_partition_list_value_cmp 
 * 
 * Compare two list partition bound datums 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN2060"></a><span class='Declare_Function'>qsort_partition_list_value_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2062"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2060"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, 
</span><a name="LN2063"></a>                <span class='Declare_Local'>val2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="partition.c.html#LN100"><span class='Ref_to_Struct'>PartitionListValue</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2060"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span><a name="LN2064"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a><span class='Parentheses'>) </span><a href="partition.c.html#LN2060"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN2064"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                           <a href="partition.c.html#LN2064"><span class='Ref_To_Local'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                           <a href="partition.c.html#LN2062"><span class='Ref_To_Local'>val1</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2063"><span class='Ref_To_Local'>val2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * make_one_range_bound 
 * 
 * Return a PartitionRangeBound given a list of PartitionRangeDatum elements 
 * and a flag telling whether the bound is lower or not.  Made into a function 
 * because there are multiple sites that want to use this facility. 
 */ 
</span><span class='Keyword'>static </span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>* 
</span><a name="LN2079"></a><span class='Declare_Function'>make_one_range_bound</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datums</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>lower</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2081"></a>    <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bound</span><span class='Delimiter'>; 
</span><a name="LN2082"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN2083"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN109"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN2079"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2079"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2079"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a> <span class='Operator'>* 
</span>                                                   <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN112"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN2079"><span class='Ref_to_Parameter'>lower</span></a><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN2083"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2082"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2079"><span class='Ref_to_Parameter'>datums</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2095"></a>        <a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a> <span class='Operator'>*</span><span class='Declare_Local'>datum</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN816"><span class='Ref_to_Struct'>PartitionRangeDatum</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2082"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* What's contained in this range datum? */ 
</span>        <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2083"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= !</span><a href="partition.c.html#LN2095"><span class='Ref_To_Local'>datum</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN820"><span class='Ref_to_Member'>infinite</span></a> 
            <span class='Operator'>? </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a> 
            <span class='Operator'>: </span><span class='Parentheses'>(</span><a href="partition.c.html#LN2079"><span class='Ref_to_Parameter'>lower</span></a> <span class='Operator'>? </span><a href="partition.c.html#LN72"><span class='Ref_to_EnumConst'>RANGE_DATUM_NEG_INF</span></a> 
               <span class='Operator'>: </span><a href="partition.c.html#LN73"><span class='Ref_to_EnumConst'>RANGE_DATUM_POS_INF</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2083"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2105"></a>            <a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2095"><span class='Ref_To_Local'>datum</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2105"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN196"><span class='Ref_to_Member'>constisnull</span></a><span class='Parentheses'>) 
</span>                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid range bound datum"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2083"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="partition.c.html#LN2105"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN195"><span class='Ref_to_Member'>constvalue</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="partition.c.html#LN2083"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN2081"><span class='Ref_To_Local'>bound</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_one_range_bound &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Used when sorting range bounds across all range partitions */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN2120"></a><span class='Declare_Function'>qsort_partition_rbound_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2122"></a>    <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>b1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2120"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2123"></a>    <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>b2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Keyword'>const </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2120"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2124"></a>    <a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Local'>key</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a><span class='Parentheses'>) </span><a href="partition.c.html#LN2120"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN136"><span class='Ref_to_Proto'>partition_rbound_cmp</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2124"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2122"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2122"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2122"><span class='Ref_To_Local'>b1</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN112"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2123"><span class='Ref_To_Local'>b2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * partition_rbound_cmp 
 * 
 * Return for two range bounds whether the 1st one (specified in datum1, 
 * content1, and lower1) is &LT;=, =, &GT;= the bound specified in *b2 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN2136"></a><span class='Declare_Function'>partition_rbound_cmp</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN2137"></a>                     <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>datums1</span><span class='Delimiter'>, </span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>content1</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>lower1</span><span class='Delimiter'>, 
</span><a name="LN2138"></a>                     <a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2140"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpval</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* placate compiler */ 
</span><a name="LN2141"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2142"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>datums2</span> <span class='Operator'>= </span><a href="partition.c.html#LN2138"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN110"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>; 
</span><a name="LN2143"></a>    <a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>content2</span> <span class='Operator'>= </span><a href="partition.c.html#LN2138"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN111"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>; 
</span><a name="LN2144"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>lower2</span> <span class='Operator'>= </span><a href="partition.c.html#LN2138"><span class='Ref_to_Parameter'>b2</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN112"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN2136"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * First, handle cases involving infinity, which don't require 
         * invoking the comparison proc. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>content1</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a> <span class='Operator'>&& 
</span>            <a href="partition.c.html#LN2143"><span class='Ref_To_Local'>content2</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Both are infinity, so they are equal unless one is negative 
             * infinity and other positive (or vice versa) 
             */ 
</span>            <span class='Control'>return</span> <a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>content1</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="partition.c.html#LN2143"><span class='Ref_To_Local'>content2</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>? </span><span class='Number'>0</span> 
                <span class='Operator'>: </span><span class='Parentheses'>(</span><a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>content1</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="partition.c.html#LN2143"><span class='Ref_To_Local'>content2</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>content1</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>content1</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="partition.c.html#LN72"><span class='Ref_to_EnumConst'>RANGE_DATUM_NEG_INF</span></a> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2143"><span class='Ref_To_Local'>content2</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="partition.c.html#LN2143"><span class='Ref_To_Local'>content2</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="partition.c.html#LN72"><span class='Ref_to_EnumConst'>RANGE_DATUM_NEG_INF</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN2140"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN2136"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                 <a href="partition.c.html#LN2136"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                 <a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>datums1</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                 <a href="partition.c.html#LN2142"><span class='Ref_To_Local'>datums2</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2141"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2140"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key-&GT;partnatts;... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the comparison is anything other than equal, we're done. If they 
     * compare equal though, we still have to consider whether the boundaries 
     * are inclusive or exclusive.  Exclusive one is considered smaller of the 
     * two. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2140"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>lower1</span></a> <span class='Operator'>!= </span><a href="partition.c.html#LN2144"><span class='Ref_To_Local'>lower2</span></a><span class='Parentheses'>) 
</span>        <a href="partition.c.html#LN2140"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN2137"><span class='Ref_to_Parameter'>lower1</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN2140"><span class='Ref_To_Local'>cmpval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end partition_rbound_cmp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * partition_rbound_datum_cmp 
 * 
 * Return whether range bound (specified in rb_datums, rb_content, and 
 * rb_lower) &LT;=, =, &GT;= partition key of tuple (tuple_datums) 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN2193"></a><span class='Declare_Function'>partition_rbound_datum_cmp</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN2194"></a>                           <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rb_datums</span><span class='Delimiter'>, </span><a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rb_content</span><span class='Delimiter'>, 
</span><a name="LN2195"></a>                           <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tuple_datums</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2197"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2198"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpval</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN2193"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN54"><span class='Ref_to_Member'>partnatts</span></a><span class='Delimiter'>; </span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2194"><span class='Ref_to_Parameter'>rb_content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="partition.c.html#LN71"><span class='Ref_to_EnumConst'>RANGE_DATUM_FINITE</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="partition.c.html#LN2194"><span class='Ref_to_Parameter'>rb_content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="partition.c.html#LN72"><span class='Ref_to_EnumConst'>RANGE_DATUM_NEG_INF</span></a> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN2198"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN2193"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                 <a href="partition.c.html#LN2193"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                 <a href="partition.c.html#LN2194"><span class='Ref_to_Parameter'>rb_datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                 <a href="partition.c.html#LN2195"><span class='Ref_to_Parameter'>tuple_datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2197"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2198"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN2198"><span class='Ref_To_Local'>cmpval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end partition_rbound_datum_cmp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * partition_bound_cmp 
 * 
 * Return whether the bound at offset in boundinfo is &LT;=, =, &GT;= the argument 
 * specified in *probe. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN2223"></a><span class='Declare_Function'>partition_bound_cmp</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Parameter'>boundinfo</span><span class='Delimiter'>, 
</span><a name="LN2224"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>probe</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>probe_is_bound</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2226"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bound_datums</span> <span class='Operator'>= </span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN80"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>]; 
</span><a name="LN2227"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpval</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN786"><span class='Ref_to_Const'>PARTITION_STRATEGY_LIST</span></a><span class='Operator'>: 
</span>            <a href="partition.c.html#LN2227"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN62"><span class='Ref_to_Member'>partsupfunc</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                                     <a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN65"><span class='Ref_to_Member'>partcollation</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                                     <a href="partition.c.html#LN2226"><span class='Ref_To_Local'>bound_datums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                                     <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>probe</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN787"><span class='Ref_to_Const'>PARTITION_STRATEGY_RANGE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2240"></a>                <a href="partition.c.html#LN69"><span class='Ref_to_Enum'>RangeDatumContent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>content</span> <span class='Operator'>= </span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN82"><span class='Ref_to_Member'>content</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>probe_is_bound</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We need to pass whether the existing bound is a lower 
                     * bound, so that two equal-valued lower and upper bounds 
                     * are not regarded equal. 
                     */ 
</span><a name="LN2249"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>lower</span> <span class='Operator'>= </span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN85"><span class='Ref_to_Member'>indexes</span></a><span class='Delimiter'>[</span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <a href="partition.c.html#LN2227"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN136"><span class='Ref_to_Proto'>partition_rbound_cmp</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                                <a href="partition.c.html#LN2226"><span class='Ref_To_Local'>bound_datums</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2240"><span class='Ref_To_Local'>content</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2249"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, 
</span>                                              <span class='Parentheses'>(</span><a href="partition.c.html#LN107"><span class='Ref_to_Struct'>PartitionRangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>probe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="partition.c.html#LN2227"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN139"><span class='Ref_to_Proto'>partition_rbound_datum_cmp</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                                        <a href="partition.c.html#LN2226"><span class='Ref_To_Local'>bound_datums</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2240"><span class='Ref_To_Local'>content</span></a><span class='Delimiter'>, 
</span>                                                        <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2224"><span class='Ref_to_Parameter'>probe</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected partition strategy: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="partition.c.html#LN2223"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN53"><span class='Ref_to_Member'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch key-&GT;strategy &raquo; </span> 
 
    <span class='Control'>return</span> <a href="partition.c.html#LN2227"><span class='Ref_To_Local'>cmpval</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end partition_bound_cmp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Binary search on a collection of partition bounds. Returns greatest 
 * bound in array boundinfo-&GT;datums which is less than or equal to *probe 
 * If all bounds in the array are greater than *probe, -1 is returned. 
 * 
 * *probe could either be a partition bound or a Datum array representing 
 * the partition key of a tuple being routed; probe_is_bound tells which. 
 * We pass that down to the comparison function so that it can interpret the 
 * contents of *probe accordingly. 
 * 
 * *is_equal is set to whether the bound at the returned index is equal with 
 * *probe. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2284"></a><span class='Declare_Function'>partition_bound_bsearch</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN76"><span class='Ref_to_Typedef'>PartitionKey</span></a> <span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../include/catalog/partition.h.html#LN27"><span class='Ref_to_Typedef'>PartitionBoundInfo</span></a> <span class='Declare_Parameter'>boundinfo</span><span class='Delimiter'>, 
</span><a name="LN2285"></a>                        <span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>probe</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>probe_is_bound</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_equal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2287"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lo</span><span class='Delimiter'>, 
</span><a name="LN2288"></a>                <span class='Declare_Local'>hi</span><span class='Delimiter'>, 
</span><a name="LN2289"></a>                <span class='Declare_Local'>mid</span><span class='Delimiter'>; 
</span> 
    <a href="partition.c.html#LN2287"><span class='Ref_To_Local'>lo</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="partition.c.html#LN2288"><span class='Ref_To_Local'>hi</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN2284"><span class='Ref_to_Parameter'>boundinfo</span></a><span class='Operator'>-&GT;</span><a href="partition.c.html#LN79"><span class='Ref_to_Member'>ndatums</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2287"><span class='Ref_To_Local'>lo</span></a> <span class='Operator'>&LT; </span><a href="partition.c.html#LN2288"><span class='Ref_To_Local'>hi</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2295"></a>        <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>cmpval</span><span class='Delimiter'>; 
</span> 
        <a href="partition.c.html#LN2289"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN2287"><span class='Ref_To_Local'>lo</span></a> <span class='Operator'>+ </span><a href="partition.c.html#LN2288"><span class='Ref_To_Local'>hi</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="partition.c.html#LN2295"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN143"><span class='Ref_to_Proto'>partition_bound_cmp</span></a><span class='Parentheses'>(</span><a href="partition.c.html#LN2284"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2284"><span class='Ref_to_Parameter'>boundinfo</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2289"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>, </span><a href="partition.c.html#LN2285"><span class='Ref_to_Parameter'>probe</span></a><span class='Delimiter'>, 
</span>                                     <a href="partition.c.html#LN2285"><span class='Ref_to_Parameter'>probe_is_bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="partition.c.html#LN2295"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="partition.c.html#LN2287"><span class='Ref_To_Local'>lo</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN2289"><span class='Ref_To_Local'>mid</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="partition.c.html#LN2285"><span class='Ref_to_Parameter'>is_equal</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="partition.c.html#LN2295"><span class='Ref_To_Local'>cmpval</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="partition.c.html#LN2285"><span class='Ref_to_Parameter'>is_equal</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="partition.c.html#LN2288"><span class='Ref_To_Local'>hi</span></a> <span class='Operator'>= </span><a href="partition.c.html#LN2289"><span class='Ref_To_Local'>mid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="partition.c.html#LN2287"><span class='Ref_To_Local'>lo</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end partition_bound_bsearch &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>