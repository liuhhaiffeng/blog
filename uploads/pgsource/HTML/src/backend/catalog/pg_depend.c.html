<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\pg_depend.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\pg_depend.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:33 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_depend.c 
 *    routines to support manipulation of the pg_depend relation 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/catalog/pg_depend.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_constraint.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_depend.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
<a name="LN32"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>isObjectPinned</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Record a dependency between 2 objects via their respective objectAddress. 
 * The first argument is the dependent object, the second the one it 
 * references. 
 * 
 * This simply creates an entry in pg_depend, without any other processing. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN43"></a><span class='Declare_Function'>recordDependencyOn</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>depender</span><span class='Delimiter'>, 
</span><a name="LN44"></a>                   <span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>referenced</span><span class='Delimiter'>, 
</span><a name="LN45"></a>                   <a href="../../include/catalog/dependency.h.html#LN72"><span class='Ref_to_Enum'>DependencyType</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="pg_depend.c.html#LN54"><span class='Ref_to_Func'>recordMultipleDependencies</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN43"><span class='Ref_to_Parameter'>depender</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN44"><span class='Ref_to_Parameter'>referenced</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN45"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Record multiple dependencies (of the same kind) for a single dependent 
 * object.  This has a little less overhead than recording each separately. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN55"></a><span class='Declare_Function'>recordMultipleDependencies</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>depender</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                           <span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>referenced</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>nreferenced</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                           <a href="../../include/catalog/dependency.h.html#LN72"><span class='Ref_to_Enum'>DependencyType</span></a> <span class='Declare_Parameter'>behavior</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN60"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>dependDesc</span><span class='Delimiter'>; 
</span><a name="LN61"></a>    <a href="../../include/catalog/indexing.h.html#LN25"><span class='Ref_to_Typedef'>CatalogIndexState</span></a> <span class='Declare_Local'>indstate</span><span class='Delimiter'>; 
</span><a name="LN62"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN63"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN66"><span class='Ref_to_Const'>Natts_pg_depend</span></a><span class='Delimiter'>]; 
</span><a name="LN65"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN66"><span class='Ref_to_Const'>Natts_pg_depend</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN57"><span class='Ref_to_Parameter'>nreferenced</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* nothing to do */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * During bootstrap, do nothing since pg_depend may not exist yet. initdb 
     * will fill in appropriate pg_depend entries after bootstrap. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN60"><span class='Ref_To_Local'>dependDesc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't open indexes unless we need to make an update */ 
</span>    <a href="pg_depend.c.html#LN61"><span class='Ref_To_Local'>indstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="pg_depend.c.html#LN64"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN64"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN63"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_depend.c.html#LN63"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_depend.c.html#LN57"><span class='Ref_to_Parameter'>nreferenced</span></a><span class='Delimiter'>; </span><a href="pg_depend.c.html#LN63"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN56"><span class='Ref_to_Parameter'>referenced</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If the referenced object is pinned by the system, there's no real 
         * need to record dependencies on it.  This saves lots of space in 
         * pg_depend, so it's worth the time taken to check. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_depend.c.html#LN32"><span class='Ref_to_Proto'>isObjectPinned</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN56"><span class='Ref_to_Parameter'>referenced</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN60"><span class='Ref_To_Local'>dependDesc</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Record the Dependency.  Note we don't bother to check for 
             * duplicate dependencies; there's no harm in them. 
             */ 
</span>            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN55"><span class='Ref_to_Parameter'>depender</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN55"><span class='Ref_to_Parameter'>depender</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_depend_objsubid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN55"><span class='Ref_to_Parameter'>depender</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN56"><span class='Ref_to_Parameter'>referenced</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN56"><span class='Ref_to_Parameter'>referenced</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_depend_refobjsubid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN56"><span class='Ref_to_Parameter'>referenced</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_depend.h.html#LN73"><span class='Ref_to_Const'>Anum_pg_depend_deptype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>((</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><a href="pg_depend.c.html#LN58"><span class='Ref_to_Parameter'>behavior</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="pg_depend.c.html#LN62"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN60"><span class='Ref_To_Local'>dependDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN65"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN64"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* fetch index info only when we know we need it */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN61"><span class='Ref_To_Local'>indstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="pg_depend.c.html#LN61"><span class='Ref_To_Local'>indstate</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN30"><span class='Ref_to_Proto'>CatalogOpenIndexes</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN60"><span class='Ref_To_Local'>dependDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/catalog/indexing.h.html#LN33"><span class='Ref_to_Proto'>CatalogTupleInsertWithInfo</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN60"><span class='Ref_To_Local'>dependDesc</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN62"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN61"><span class='Ref_To_Local'>indstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN62"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isObjectPinned(refer... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nreferenced;i++... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN61"><span class='Ref_To_Local'>indstate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/indexing.h.html#LN31"><span class='Ref_to_Proto'>CatalogCloseIndexes</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN61"><span class='Ref_To_Local'>indstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN60"><span class='Ref_To_Local'>dependDesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end recordMultipleDependencies &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * If we are executing a CREATE EXTENSION operation, mark the given object 
 * as being a member of the extension.  Otherwise, do nothing. 
 * 
 * This must be called during creation of any user-definable object type 
 * that could be a member of an extension. 
 * 
 * If isReplace is true, the object already existed (or might have already 
 * existed), so we must check for a pre-existing extension membership entry. 
 * Passing false is a guarantee that the object is newly created, and so 
 * could not already be a member of any extension. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN138"></a><span class='Declare_Function'>recordDependencyOnCurrentExtension</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, 
</span><a name="LN139"></a>                                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>isReplace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Only whole objects can be extension members */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN138"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../commands/extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN146"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>extension</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Only need to check for existing membership if isReplace */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN139"><span class='Ref_to_Parameter'>isReplace</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN151"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldext</span><span class='Delimiter'>; 
</span> 
            <a href="pg_depend.c.html#LN151"><span class='Ref_To_Local'>oldext</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN238"><span class='Ref_to_Proto'>getExtensionOfObject</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN138"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN138"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN151"><span class='Ref_To_Local'>oldext</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* If already a member of this extension, nothing to do */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN151"><span class='Ref_To_Local'>oldext</span></a> <span class='Operator'>== </span><a href="../commands/extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Already a member of some other extension, so reject */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is already a member of extension \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN138"><span class='Ref_to_Parameter'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/commands/extension.h.html#LN48"><span class='Ref_to_Proto'>get_extension_name</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN151"><span class='Ref_To_Local'>oldext</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* OK, record it as a member of CurrentExtensionObject */ 
</span>        <a href="pg_depend.c.html#LN146"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN146"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../commands/extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN146"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN138"><span class='Ref_to_Parameter'>object</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_depend.c.html#LN146"><span class='Ref_To_Local'>extension</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN77"><span class='Ref_to_EnumConst'>DEPENDENCY_EXTENSION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if creating_extension &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end recordDependencyOnCurrentExtension &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * deleteDependencyRecordsFor -- delete all records with given depender 
 * classId/objectId.  Returns the number of records deleted. 
 * 
 * This is used when redefining an existing object.  Links leading to the 
 * object do not change, and links leading from it will be recreated 
 * (possibly with some differences from before). 
 * 
 * If skipExtensionDeps is true, we do not delete any dependencies that 
 * show that the given object is a member of an extension.  This avoids 
 * needing a lot of extra logic to fetch and recreate that dependency. 
 */ 
</span><span class='Keyword'>long 
</span><a name="LN190"></a><span class='Declare_Function'>deleteDependencyRecordsFor</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, 
</span><a name="LN191"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>skipExtensionDeps</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN193"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN194"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN195"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN196"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN197"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN194"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN195"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN190"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN195"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN190"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN196"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN194"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN195"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN197"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN196"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN191"><span class='Ref_to_Parameter'>skipExtensionDeps</span></a> <span class='Operator'>&& 
</span>          <span class='Parentheses'>((</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN197"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN77"><span class='Ref_to_EnumConst'>DEPENDENCY_EXTENSION</span></a><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN194"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_depend.c.html#LN197"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN193"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN196"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN194"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN193"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end deleteDependencyRecordsFor &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * deleteDependencyRecordsForClass -- delete all records with given depender 
 * classId/objectId, dependee classId, and deptype. 
 * Returns the number of records deleted. 
 * 
 * This is a variant of deleteDependencyRecordsFor, useful when revoking 
 * an object property that is expressed by a dependency record (such as 
 * extension membership). 
 */ 
</span><span class='Keyword'>long 
</span><a name="LN240"></a><span class='Declare_Function'>deleteDependencyRecordsForClass</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, 
</span><a name="LN241"></a>                                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refclassId</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>deptype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN243"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN245"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN246"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN247"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN244"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN245"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN240"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN245"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN240"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN246"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN244"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN245"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN247"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN246"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN265"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>depform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN247"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN265"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="pg_depend.c.html#LN241"><span class='Ref_to_Parameter'>refclassId</span></a> <span class='Operator'>&& </span><a href="pg_depend.c.html#LN265"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="pg_depend.c.html#LN241"><span class='Ref_to_Parameter'>deptype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN244"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_depend.c.html#LN247"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_depend.c.html#LN243"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN246"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN244"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN243"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end deleteDependencyRecordsForClass &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Adjust dependency record(s) to point to a different object of the same type 
 * 
 * classId/objectId specify the referencing object. 
 * refClassId/oldRefObjectId specify the old referenced object. 
 * newRefObjectId is the new referenced object (must be of class refClassId). 
 * 
 * Note the lack of objsubid parameters.  If there are subobject references 
 * they will all be readjusted. 
 * 
 * Returns the number of records updated. 
 */ 
</span><span class='Keyword'>long 
</span><a name="LN294"></a><span class='Declare_Function'>changeDependencyFor</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Delimiter'>, 
</span><a name="LN295"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>refClassId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>oldRefObjectId</span><span class='Delimiter'>, 
</span><a name="LN296"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newRefObjectId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN298"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN299"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN300"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN301"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN302"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN303"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>objAddr</span><span class='Delimiter'>; 
</span><a name="LN304"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>newIsPinned</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If oldRefObjectId is pinned, there won't be any dependency entries on 
     * it --- we can't cope in that case.  (This isn't really worth expending 
     * code to fix, in current usage; it just means you can't rename stuff out 
     * of pg_catalog, which would likely be a bad move anyway.) 
     */ 
</span>    <a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN295"><span class='Ref_to_Parameter'>refClassId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN295"><span class='Ref_to_Parameter'>oldRefObjectId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN32"><span class='Ref_to_Proto'>isObjectPinned</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot remove dependency on %s because it is a system object"</span><span class='Delimiter'>, 
</span>               <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can handle adding a dependency on something pinned, though, since 
     * that just means deleting the dependency entry. 
     */ 
</span>    <a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN296"><span class='Ref_to_Parameter'>newRefObjectId</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN304"><span class='Ref_To_Local'>newIsPinned</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN32"><span class='Ref_to_Proto'>isObjectPinned</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN303"><span class='Ref_To_Local'>objAddr</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now search for dependency records */ 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN300"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN294"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN300"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN294"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN301"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN300"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>((</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN301"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>))))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN347"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>depform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN347"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="pg_depend.c.html#LN295"><span class='Ref_to_Parameter'>refClassId</span></a> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN347"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refobjid <span class='Operator'>== </span><a href="pg_depend.c.html#LN295"><span class='Ref_to_Parameter'>oldRefObjectId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN304"><span class='Ref_To_Local'>newIsPinned</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* make a modifiable copy */ 
</span>                <a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_depend.c.html#LN347"><span class='Ref_To_Local'>depform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="pg_depend.c.html#LN347"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refobjid <span class='Operator'>= </span><a href="pg_depend.c.html#LN296"><span class='Ref_to_Parameter'>newRefObjectId</span></a><span class='Delimiter'>; 
</span> 
                <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN302"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="pg_depend.c.html#LN298"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if depform-&GT;refclassid==... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid((tup... &raquo; </span> 
 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN301"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN299"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN298"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end changeDependencyFor &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * isObjectPinned() 
 * 
 * Test if an object is required for basic database functionality. 
 * Caller must already have opened pg_depend. 
 * 
 * The passed subId, if any, is ignored; we assume that only whole objects 
 * are pinned (and that this implies pinning their components). 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN388"></a><span class='Declare_Function'>isObjectPinned</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN390"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN391"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN392"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN393"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN393"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN388"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN393"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN388"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN391"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN388"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN393"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we won't generate additional pg_depend entries for pinned 
     * objects, there can be at most one entry referencing a pinned object. 
     * Hence, it's sufficient to look at the first returned tuple; we don't 
     * need to loop. 
     */ 
</span>    <a href="pg_depend.c.html#LN392"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN391"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN392"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN417"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>foundDep</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN392"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN417"><span class='Ref_To_Local'>foundDep</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN79"><span class='Ref_to_EnumConst'>DEPENDENCY_PIN</span></a><span class='Parentheses'>) 
</span>            <a href="pg_depend.c.html#LN390"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN391"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN390"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end isObjectPinned &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Various special-purpose lookups and manipulations of pg_depend. 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find the extension containing the specified object, if any 
 * 
 * Returns the OID of the extension, or InvalidOid if the object does not 
 * belong to any extension. 
 * 
 * Extension membership is marked by an EXTENSION dependency from the object 
 * to the extension.  Note that the result will be indeterminate if pg_depend 
 * contains links from this object to more than one extension ... but that 
 * should never happen. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN446"></a><span class='Declare_Function'>getExtensionOfObject</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>classId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN448"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN449"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN450"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN451"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN452"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN449"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN450"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN446"><span class='Ref_to_Parameter'>classId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN450"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN446"><span class='Ref_to_Parameter'>objectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN451"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN449"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN450"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>((</span><a href="pg_depend.c.html#LN452"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN451"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>))))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN470"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>depform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN452"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN470"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN470"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN77"><span class='Ref_to_EnumConst'>DEPENDENCY_EXTENSION</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_depend.c.html#LN448"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN470"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refobjid<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no need to keep scanning */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN451"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN449"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN448"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getExtensionOfObject &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Detect whether a sequence is marked as "owned" by a column 
 * 
 * An ownership marker is an AUTO or INTERNAL dependency from the sequence to the 
 * column.  If we find one, store the identity of the owning column 
 * into *tableId and *colId and return TRUE; else return FALSE. 
 * 
 * Note: if there's more than one such pg_depend entry then you get 
 * a random one of them returned into the out parameters.  This should 
 * not happen, though. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN499"></a><span class='Declare_Function'>sequenceIsOwned</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>seqId</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>deptype</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tableId</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>colId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN501"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN502"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN503"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN504"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN505"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN502"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN503"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN503"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN499"><span class='Ref_to_Parameter'>seqId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN504"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN502"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN503"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>((</span><a href="pg_depend.c.html#LN505"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN504"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>))))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN523"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>depform</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN505"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN523"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN523"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="pg_depend.c.html#LN499"><span class='Ref_to_Parameter'>deptype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="pg_depend.c.html#LN499"><span class='Ref_to_Parameter'>tableId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN523"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refobjid<span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="pg_depend.c.html#LN499"><span class='Ref_to_Parameter'>colId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN523"><span class='Ref_To_Local'>depform</span></a><span class='Operator'>-&GT;</span>refobjsubid<span class='Delimiter'>; 
</span>            <a href="pg_depend.c.html#LN501"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* no need to keep scanning */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN504"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN502"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN501"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sequenceIsOwned &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Collect a list of OIDs of all sequences owned by the specified relation, 
 * and column if specified. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN547"></a><span class='Declare_Function'>getOwnedSequences</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN549"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN550"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN551"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN552"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN553"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN550"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN551"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN551"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN547"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN547"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>) 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN551"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                    <a href="../../include/catalog/pg_depend.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_depend_refobjsubid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN547"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN552"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN550"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN547"><span class='Ref_to_Parameter'>attnum</span></a> <span class='Operator'>? </span><span class='Number'>3</span> <span class='Operator'>: </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN551"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN553"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN552"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN576"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>deprec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN553"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume any auto or internal dependency of a sequence on a column 
         * must be what we are looking for.  (We need the relkind test because 
         * indexes can also have auto dependencies on columns.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>refobjsubid <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN75"><span class='Ref_to_EnumConst'>DEPENDENCY_AUTO</span></a> <span class='Operator'>|| </span><a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>objid<span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_depend.c.html#LN549"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN549"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN576"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>objid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN552"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN550"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN549"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getOwnedSequences &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get owned sequence, error if not exactly one. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN604"></a><span class='Declare_Function'>getOwnedSequence</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a> <span class='Declare_Parameter'>attnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN606"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>seqlist</span> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN241"><span class='Ref_to_Proto'>getOwnedSequences</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN604"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN604"><span class='Ref_to_Parameter'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN606"><span class='Ref_To_Local'>seqlist</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"more than one owned sequence found"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN606"><span class='Ref_To_Local'>seqlist</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"no owned sequence found"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN606"><span class='Ref_To_Local'>seqlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_constraint_index 
 *      Given the OID of a unique or primary-key constraint, return the 
 *      OID of the underlying unique index. 
 * 
 * Return InvalidOid if the index couldn't be found; this suggests the 
 * given OID is bogus, but we leave it to caller to decide what to do. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN625"></a><span class='Declare_Function'>get_constraint_index</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>constraintId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN627"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>indexId</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN628"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN629"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN630"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN631"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Search the dependency table for the dependent index */ 
</span>    <a href="pg_depend.c.html#LN628"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN629"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN629"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN625"><span class='Ref_to_Parameter'>constraintId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN629"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_depend_refobjsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN630"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN628"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN629"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN631"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN630"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN654"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>deprec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN631"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume any internal dependency of an index on the constraint 
         * must be what we are looking for.  (The relkind test is just 
         * paranoia; there shouldn't be any such dependencies otherwise.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN654"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>classid <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN654"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>objsubid <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN654"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/utils/lsyscache.h.html#LN127"><span class='Ref_to_Proto'>get_rel_relkind</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN654"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>objid<span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_depend.c.html#LN627"><span class='Ref_To_Local'>indexId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN654"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN630"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN628"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN627"><span class='Ref_To_Local'>indexId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_constraint_index &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_index_constraint 
 *      Given the OID of an index, return the OID of the owning unique or 
 *      primary-key constraint, or InvalidOid if no such constraint. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN683"></a><span class='Declare_Function'>get_index_constraint</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN685"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>constraintId</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN686"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN687"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN688"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN689"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Search the dependency table for the index */ 
</span>    <a href="pg_depend.c.html#LN686"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN687"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_depend_classid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN687"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_depend_objid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN683"><span class='Ref_to_Parameter'>indexId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_depend.c.html#LN687"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_depend_objsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_INT4EQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_depend.c.html#LN688"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN686"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN144"><span class='Ref_to_Const'>DependDependerIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>, </span><a href="pg_depend.c.html#LN687"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN689"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN688"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN712"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>deprec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN689"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We assume any internal dependency on a constraint must be what we 
         * are looking for. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_depend.c.html#LN712"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>refclassid <span class='Operator'>== </span><a href="../../include/catalog/pg_constraint.h.html#LN28"><span class='Ref_to_Const'>ConstraintRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN712"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>refobjsubid <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="pg_depend.c.html#LN712"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>== </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_depend.c.html#LN685"><span class='Ref_To_Local'>constraintId</span></a> <span class='Operator'>= </span><a href="pg_depend.c.html#LN712"><span class='Ref_To_Local'>deprec</span></a><span class='Operator'>-&GT;</span>refobjid<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN688"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_depend.c.html#LN686"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_depend.c.html#LN685"><span class='Ref_To_Local'>constraintId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_index_constraint &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>