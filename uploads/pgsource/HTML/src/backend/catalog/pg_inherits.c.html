<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\pg_inherits.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\pg_inherits.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:33 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_inherits.c 
 *    routines to support manipulation of the pg_inherits relation 
 * 
 * Note: currently, this module only contains inquiry functions; the actual 
 * creation and deletion of pg_inherits entries is done in tablecmds.c. 
 * Perhaps someday that code should be moved here, but it'd have to be 
 * disentangled from other stuff such as pg_depend updates. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/catalog/pg_inherits.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_inherits_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Entry of a hash table used in find_all_inheritors. See below. 
 */ 
</span><a name="LN38"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SeenRelsEntry</span> 
<span class='Delimiter'>{ 
</span><a name="LN40"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>rel_id</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* relation oid */ 
</span><a name="LN41"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>numparents_cell</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* corresponding list cell */ 
</span><a name="LN42"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>SeenRelsEntry</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * find_inheritance_children 
 * 
 * Returns a list containing the OIDs of all relations which 
 * inherit *directly* from the relation with OID 'parentrelId'. 
 * 
 * The specified lock type is acquired on each child relation (but not on the 
 * given rel; caller should already have locked it).  If lockmode is NoLock 
 * then no locks are acquired, but caller must beware of race conditions 
 * against possible DROPs of child relations. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN56"></a><span class='Declare_Function'>find_inheritance_children</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>parentrelId</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN58"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>list</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN59"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN60"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN61"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN62"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>inheritsTuple</span><span class='Delimiter'>; 
</span><a name="LN63"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inhrelid</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>oidarr</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxoids</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                <span class='Declare_Local'>numoids</span><span class='Delimiter'>, 
</span><a name="LN67"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Can skip the scan if pg_class shows the relation has never had a 
     * subclass. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_inherits_fn.h.html#LN22"><span class='Ref_to_Proto'>has_subclass</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN56"><span class='Ref_to_Parameter'>parentrelId</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan pg_inherits and build a working array of subclass OIDs. 
     */ 
</span>    <a href="pg_inherits.c.html#LN65"><span class='Ref_To_Local'>maxoids</span></a> <span class='Operator'>= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN65"><span class='Ref_To_Local'>maxoids</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN66"><span class='Ref_To_Local'>numoids</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_inherits.c.html#LN59"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_inherits.c.html#LN61"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_inherits.h.html#LN50"><span class='Ref_to_Const'>Anum_pg_inherits_inhparent</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN56"><span class='Ref_to_Parameter'>parentrelId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_inherits.c.html#LN60"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN59"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN168"><span class='Ref_to_Const'>InheritsParentIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN61"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_inherits.c.html#LN62"><span class='Ref_To_Local'>inheritsTuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN60"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN62"><span class='Ref_To_Local'>inheritsTuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>inhrelid<span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN66"><span class='Ref_To_Local'>numoids</span></a> <span class='Operator'>&GT;= </span><a href="pg_inherits.c.html#LN65"><span class='Ref_To_Local'>maxoids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_inherits.c.html#LN65"><span class='Ref_To_Local'>maxoids</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN65"><span class='Ref_To_Local'>maxoids</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a><span class='Delimiter'>[</span><a href="pg_inherits.c.html#LN66"><span class='Ref_To_Local'>numoids</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN60"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN59"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we found more than one child, sort them by OID.  This ensures 
     * reasonably consistent behavior regardless of the vagaries of an 
     * indexscan.  This is important since we need to be sure all backends 
     * lock children in the same order to avoid needless deadlocks. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN66"><span class='Ref_To_Local'>numoids</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN66"><span class='Ref_To_Local'>numoids</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN69"><span class='Ref_to_Proto'>oid_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Acquire locks and build the result list. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN67"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_inherits.c.html#LN67"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_inherits.c.html#LN66"><span class='Ref_To_Local'>numoids</span></a><span class='Delimiter'>; </span><a href="pg_inherits.c.html#LN67"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a> <span class='Operator'>= </span><a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a><span class='Delimiter'>[</span><a href="pg_inherits.c.html#LN67"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN56"><span class='Ref_to_Parameter'>lockmode</span></a> <span class='Operator'>!= </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Get the lock to synchronize against concurrent drop */ 
</span>            <a href="../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN56"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Now that we have the lock, double-check to see if the relation 
             * really exists or not.  If not, assume it was dropped while we 
             * waited to acquire lock, and ignore it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/syscache.h.html#LN173"><span class='Ref_to_Macro'>SearchSysCacheExists1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Release useless lock */ 
</span>                <a href="../../include/storage/lmgr.h.html#LN42"><span class='Ref_to_Proto'>UnlockRelationOid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN56"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* And ignore this relation */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="pg_inherits.c.html#LN58"><span class='Ref_To_Local'>list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN58"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN63"><span class='Ref_To_Local'>inhrelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;numoids;i++ &raquo; </span> 
 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN64"><span class='Ref_To_Local'>oidarr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_inherits.c.html#LN58"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_inheritance_children &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * find_all_inheritors - 
 *      Returns a list of relation OIDs including the given rel plus 
 *      all relations that inherit from it, directly or indirectly. 
 *      Optionally, it also returns the number of parents found for 
 *      each such relation within the inheritance tree rooted at the 
 *      given rel. 
 * 
 * The specified lock type is acquired on all child relations (but not on the 
 * given rel; caller should already have locked it).  If lockmode is NoLock 
 * then no locks are acquired, but caller must beware of race conditions 
 * against possible DROPs of child relations. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN166"></a><span class='Declare_Function'>find_all_inheritors</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>parentrelId</span><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN25"><span class='Ref_to_Typedef'>LOCKMODE</span></a> <span class='Declare_Parameter'>lockmode</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>numparents</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* hash table for O(1) rel_oid -&GT; rel_numparents cell lookup */ 
</span><a name="LN169"></a>    <a href="../utils/hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>seen_rels</span><span class='Delimiter'>; 
</span><a name="LN170"></a>    <a href="../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span><a name="LN171"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rels_list</span><span class='Delimiter'>, 
</span><a name="LN172"></a>               <span class='Operator'>*</span><span class='Declare_Local'>rel_numparents</span><span class='Delimiter'>; 
</span><a name="LN173"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_inherits.c.html#LN170"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN170"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN170"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN170"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN38"><span class='Ref_to_Struct'>SeenRelsEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN170"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_inherits.c.html#LN169"><span class='Ref_To_Local'>seen_rels</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"find_all_inheritors temporary table"</span><span class='Delimiter'>, 
</span>                            <span class='Number'>32</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* start small and extend */ 
</span>                            <span class='Operator'>&</span><a href="pg_inherits.c.html#LN170"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN87"><span class='Ref_to_Const'>HASH_BLOBS</span></a> <span class='Operator'>| </span><a href="../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We build a list starting with the given rel and adding all direct and 
     * indirect children.  We can use a single list as both the record of 
     * already-found rels and the agenda of rels yet to be scanned for more 
     * children.  This is a bit tricky but works because the foreach() macro 
     * doesn't fetch the next list element until the bottom of the loop. 
     */ 
</span>    <a href="pg_inherits.c.html#LN171"><span class='Ref_To_Local'>rels_list</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN166"><span class='Ref_to_Parameter'>parentrelId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN172"><span class='Ref_To_Local'>rel_numparents</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN144"><span class='Ref_to_Macro'>list_make1_int</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN173"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN171"><span class='Ref_To_Local'>rels_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN197"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>currentrel</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN173"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN198"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>currentchildren</span><span class='Delimiter'>; 
</span><a name="LN199"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the direct children of this rel */ 
</span>        <a href="pg_inherits.c.html#LN198"><span class='Ref_To_Local'>currentchildren</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_inherits_fn.h.html#LN19"><span class='Ref_to_Proto'>find_inheritance_children</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN197"><span class='Ref_To_Local'>currentrel</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN166"><span class='Ref_to_Parameter'>lockmode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add to the queue only those children not already seen. This avoids 
         * making duplicate entries in case of multiple inheritance paths from 
         * the same parent.  (It'll also keep us from getting into an infinite 
         * loop, though theoretically there can't be any cycles in the 
         * inheritance graph anyway.) 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN199"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN198"><span class='Ref_To_Local'>currentchildren</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN213"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>child_oid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN199"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN214"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span><a name="LN215"></a>            <a href="pg_inherits.c.html#LN38"><span class='Ref_to_Struct'>SeenRelsEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hash_entry</span><span class='Delimiter'>; 
</span> 
            <a href="pg_inherits.c.html#LN215"><span class='Ref_To_Local'>hash_entry</span></a> <span class='Operator'>= </span><a href="../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN169"><span class='Ref_To_Local'>seen_rels</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_inherits.c.html#LN213"><span class='Ref_To_Local'>child_oid</span></a><span class='Delimiter'>, </span><a href="../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_inherits.c.html#LN214"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN214"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* if the rel is already there, bump number-of-parents counter */ 
</span>                <a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN215"><span class='Ref_To_Local'>hash_entry</span></a><span class='Operator'>-&GT;</span><a href="pg_inherits.c.html#LN41"><span class='Ref_to_Member'>numparents_cell</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* if it's not there, add it. expect 1 parent, initially. */ 
</span>                <a href="pg_inherits.c.html#LN171"><span class='Ref_To_Local'>rels_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN171"><span class='Ref_To_Local'>rels_list</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN213"><span class='Ref_To_Local'>child_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_inherits.c.html#LN172"><span class='Ref_To_Local'>rel_numparents</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN172"><span class='Ref_To_Local'>rel_numparents</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="pg_inherits.c.html#LN215"><span class='Ref_To_Local'>hash_entry</span></a><span class='Operator'>-&GT;</span><a href="pg_inherits.c.html#LN41"><span class='Ref_to_Member'>numparents_cell</span></a> <span class='Operator'>= </span><a href="pg_inherits.c.html#LN172"><span class='Ref_To_Local'>rel_numparents</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/pg_list.h.html#LN49"><span class='Ref_to_Member'>tail</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN166"><span class='Ref_to_Parameter'>numparents</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="pg_inherits.c.html#LN166"><span class='Ref_to_Parameter'>numparents</span></a> <span class='Operator'>= </span><a href="pg_inherits.c.html#LN172"><span class='Ref_To_Local'>rel_numparents</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN172"><span class='Ref_To_Local'>rel_numparents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/hsearch.h.html#LN123"><span class='Ref_to_Proto'>hash_destroy</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN169"><span class='Ref_To_Local'>seen_rels</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_inherits.c.html#LN171"><span class='Ref_To_Local'>rels_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_all_inheritors &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * has_subclass - does this relation have any children? 
 * 
 * In the current implementation, has_subclass returns whether a 
 * particular class *might* have a subclass. It will not return the 
 * correct result if a class had a subclass which was later dropped. 
 * This is because relhassubclass in pg_class is not updated immediately 
 * when a subclass is dropped, primarily because of concurrency concerns. 
 * 
 * Currently has_subclass is only used as an efficiency hack to skip 
 * unnecessary inheritance searches, so this is OK.  Note that ANALYZE 
 * on a childless table will clean up the obsolete relhassubclass flag. 
 * 
 * Although this doesn't actually touch pg_inherits, it seems reasonable 
 * to keep it here since it's normally used with the other routines here. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN261"></a><span class='Declare_Function'>has_subclass</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN263"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN264"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="pg_inherits.c.html#LN263"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN261"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN263"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN261"><span class='Ref_to_Parameter'>relationId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_inherits.c.html#LN264"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN263"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>relhassubclass<span class='Delimiter'>; 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN263"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_inherits.c.html#LN264"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given two type OIDs, determine whether the first is a complex type 
 * (class type) that inherits from the second. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN281"></a><span class='Declare_Function'>typeInheritsFrom</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subclassTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>superclassTypeId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN283"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN284"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subclassRelid</span><span class='Delimiter'>; 
</span><a name="LN285"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>superclassRelid</span><span class='Delimiter'>; 
</span><a name="LN286"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>inhrel</span><span class='Delimiter'>; 
</span><a name="LN287"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>visited</span><span class='Delimiter'>, 
</span><a name="LN288"></a>               <span class='Operator'>*</span><span class='Declare_Local'>queue</span><span class='Delimiter'>; 
</span><a name="LN289"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>queue_item</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need to work with the associated relation OIDs */ 
</span>    <a href="pg_inherits.c.html#LN284"><span class='Ref_To_Local'>subclassRelid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN47"><span class='Ref_to_Proto'>typeidTypeRelid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN281"><span class='Ref_to_Parameter'>subclassTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN284"><span class='Ref_To_Local'>subclassRelid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not a complex type */ 
</span>    <a href="pg_inherits.c.html#LN285"><span class='Ref_To_Local'>superclassRelid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_type.h.html#LN47"><span class='Ref_to_Proto'>typeidTypeRelid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN281"><span class='Ref_to_Parameter'>superclassTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN285"><span class='Ref_To_Local'>superclassRelid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* not a complex type */ 
</span> 
    <span class='Comment_Multi_Line'>/* No point in searching if the superclass has no subclasses */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/catalog/pg_inherits_fn.h.html#LN22"><span class='Ref_to_Proto'>has_subclass</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN285"><span class='Ref_To_Local'>superclassRelid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Begin the search at the relation itself, so add its relid to the queue. 
     */ 
</span>    <a href="pg_inherits.c.html#LN288"><span class='Ref_To_Local'>queue</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN150"><span class='Ref_to_Macro'>list_make1_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN284"><span class='Ref_To_Local'>subclassRelid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_inherits.c.html#LN287"><span class='Ref_To_Local'>visited</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="pg_inherits.c.html#LN286"><span class='Ref_To_Local'>inhrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN28"><span class='Ref_to_Const'>InheritsRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use queue to do a breadth-first traversal of the inheritance graph from 
     * the relid supplied up to the root.  Notice that we append to the queue 
     * inside the loop --- this is okay because the foreach() macro doesn't 
     * advance queue_item until the next loop iteration begins. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN289"><span class='Ref_To_Local'>queue_item</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN288"><span class='Ref_To_Local'>queue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN319"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>this_relid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN289"><span class='Ref_To_Local'>queue_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN320"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>; 
</span><a name="LN321"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>inhscan</span><span class='Delimiter'>; 
</span><a name="LN322"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>inhtup</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we've seen this relid already, skip it.  This avoids extra work 
         * in multiple-inheritance scenarios, and also protects us from an 
         * infinite loop in case there is a cycle in pg_inherits (though 
         * theoretically that shouldn't happen). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN287"><span class='Ref_To_Local'>visited</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN319"><span class='Ref_To_Local'>this_relid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Okay, this is a not-yet-seen relid. Add it to the list of 
         * already-visited OIDs, then find all the types this relid inherits 
         * from and add them to the queue. 
         */ 
</span>        <a href="pg_inherits.c.html#LN287"><span class='Ref_To_Local'>visited</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN287"><span class='Ref_To_Local'>visited</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN319"><span class='Ref_To_Local'>this_relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_inherits.c.html#LN320"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/catalog/pg_inherits.h.html#LN49"><span class='Ref_to_Const'>Anum_pg_inherits_inhrelid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN319"><span class='Ref_To_Local'>this_relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pg_inherits.c.html#LN321"><span class='Ref_To_Local'>inhscan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN286"><span class='Ref_To_Local'>inhrel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN166"><span class='Ref_to_Const'>InheritsRelidSeqnoIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_inherits.c.html#LN320"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="pg_inherits.c.html#LN322"><span class='Ref_To_Local'>inhtup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN321"><span class='Ref_To_Local'>inhscan</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN350"></a>            <a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a> <span class='Declare_Local'>inh</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_inherits.h.html#LN42"><span class='Ref_to_Typedef'>Form_pg_inherits</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN322"><span class='Ref_To_Local'>inhtup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN351"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>inhparent</span> <span class='Operator'>= </span><a href="pg_inherits.c.html#LN350"><span class='Ref_To_Local'>inh</span></a><span class='Operator'>-&GT;</span>inhparent<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* If this is the target superclass, we're done */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN351"><span class='Ref_To_Local'>inhparent</span></a> <span class='Operator'>== </span><a href="pg_inherits.c.html#LN285"><span class='Ref_To_Local'>superclassRelid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="pg_inherits.c.html#LN283"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Else add to queue */ 
</span>            <a href="pg_inherits.c.html#LN288"><span class='Ref_To_Local'>queue</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN288"><span class='Ref_To_Local'>queue</span></a><span class='Delimiter'>, </span><a href="pg_inherits.c.html#LN351"><span class='Ref_To_Local'>inhparent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN321"><span class='Ref_To_Local'>inhscan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN283"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* clean up ... */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN286"><span class='Ref_To_Local'>inhrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN287"><span class='Ref_To_Local'>visited</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="pg_inherits.c.html#LN288"><span class='Ref_To_Local'>queue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_inherits.c.html#LN283"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end typeInheritsFrom &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>