<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\pg_operator.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\pg_operator.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:33 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_operator.c 
 *    routines to support manipulation of the pg_operator relation 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/catalog/pg_operator.c 
 * 
 * NOTES 
 *    these routines moved here from commands/define.c and somewhat cleaned up. 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_oper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<a name="LN40"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>OperatorGet</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN41"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN42"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftObjectId</span><span class='Delimiter'>, 
</span><a name="LN43"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightObjectId</span><span class='Delimiter'>, 
</span><a name="LN44"></a>            <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>defined</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN46"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>OperatorLookup</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN47"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftObjectId</span><span class='Delimiter'>, 
</span><a name="LN48"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightObjectId</span><span class='Delimiter'>, 
</span><a name="LN49"></a>               <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>defined</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN51"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>OperatorShellMake</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN52"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftTypeId</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightTypeId</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN56"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>get_other_operator</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>otherOp</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>otherLeftTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>otherRightTypeId</span><span class='Delimiter'>, 
</span><a name="LN58"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightTypeId</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommutator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check whether a proposed operator name is legal 
 * 
 * This had better match the behavior of parser/scan.l! 
 * 
 * We need this because the parser is not smart enough to check that 
 * the arguments of CREATE OPERATOR's COMMUTATOR, NEGATOR, etc clauses 
 * are operator names rather than some other lexical entity. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN73"></a><span class='Declare_Function'>validOperatorName</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN75"></a>    size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't be empty or too long */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't contain any invalid characters */ 
</span>    <span class='Comment_Multi_Line'>/* Test string here should match op_chars in scan.l */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strspn<span class='Parentheses'>(</span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"~!@#^&|`?+-*/%&LT;&GT;="</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't contain slash-star or dash-dash (comment starts) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"/*"</span><span class='Parentheses'>) </span><span class='Operator'>|| </span>strstr<span class='Parentheses'>(</span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For SQL standard compatibility, '+' and '-' cannot be the last char of 
     * a multi-char operator unless the operator contains chars that are not 
     * in SQL operators. The idea is to lex '=-' as two operators, but not to 
     * forbid operator names like '?-' that could not be sequences of standard 
     * SQL operators. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'+'</span> <span class='Operator'>|| 
</span>         <a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN101"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ic</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN101"><span class='Ref_To_Local'>ic</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN75"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>; </span><a href="pg_operator.c.html#LN101"><span class='Ref_To_Local'>ic</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_operator.c.html#LN101"><span class='Ref_To_Local'>ic</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><span class='String'>"~!@#^&|`?%"</span><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN101"><span class='Ref_To_Local'>ic</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN101"><span class='Ref_To_Local'>ic</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* nope, not valid */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* != isn't valid either, because parser will convert it to &LT;&GT; */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_operator.c.html#LN73"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span><span class='String'>"!="</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end validOperatorName &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * OperatorGet 
 * 
 *      finds an operator given an exact specification (name, namespace, 
 *      left and right type IDs). 
 * 
 *      *defined is set TRUE if defined (not a shell) 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN129"></a><span class='Declare_Function'>OperatorGet</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN130"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN131"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftObjectId</span><span class='Delimiter'>, 
</span><a name="LN132"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightObjectId</span><span class='Delimiter'>, 
</span><a name="LN133"></a>            <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>defined</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN135"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN136"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operatorObjectId</span><span class='Delimiter'>; 
</span> 
    <a href="pg_operator.c.html#LN135"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN161"><span class='Ref_to_Macro'>SearchSysCache4</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN70"><span class='Ref_to_EnumConst'>OPERNAMENSP</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN129"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN131"><span class='Ref_to_Parameter'>leftObjectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN132"><span class='Ref_to_Parameter'>rightObjectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN130"><span class='Ref_to_Parameter'>operatorNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN135"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN145"></a>        <a href="../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Declare_Local'>oprcode</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN135"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>oprcode<span class='Delimiter'>; 
</span> 
        <a href="pg_operator.c.html#LN136"><span class='Ref_To_Local'>operatorObjectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN135"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_operator.c.html#LN133"><span class='Ref_to_Parameter'>defined</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN145"><span class='Ref_To_Local'>oprcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN135"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN136"><span class='Ref_To_Local'>operatorObjectId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="pg_operator.c.html#LN133"><span class='Ref_to_Parameter'>defined</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="pg_operator.c.html#LN136"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OperatorGet &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * OperatorLookup 
 * 
 *      looks up an operator given a possibly-qualified name and 
 *      left and right type IDs. 
 * 
 *      *defined is set TRUE if defined (not a shell) 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN169"></a><span class='Declare_Function'>OperatorLookup</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN170"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftObjectId</span><span class='Delimiter'>, 
</span><a name="LN171"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightObjectId</span><span class='Delimiter'>, 
</span><a name="LN172"></a>               <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>defined</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN174"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operatorObjectId</span><span class='Delimiter'>; 
</span><a name="LN175"></a>    <a href="../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Declare_Local'>oprcode</span><span class='Delimiter'>; 
</span> 
    <a href="pg_operator.c.html#LN174"><span class='Ref_To_Local'>operatorObjectId</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_oper.h.html#LN24"><span class='Ref_to_Proto'>LookupOperName</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN169"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Delimiter'>, 
</span>                                      <a href="pg_operator.c.html#LN170"><span class='Ref_to_Parameter'>leftObjectId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN171"><span class='Ref_to_Parameter'>rightObjectId</span></a><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN174"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="pg_operator.c.html#LN172"><span class='Ref_to_Parameter'>defined</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_operator.c.html#LN175"><span class='Ref_To_Local'>oprcode</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN174"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="pg_operator.c.html#LN172"><span class='Ref_to_Parameter'>defined</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN539"><span class='Ref_to_Macro'>RegProcedureIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN175"><span class='Ref_To_Local'>oprcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_operator.c.html#LN174"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OperatorLookup &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * OperatorShellMake 
 *      Make a "shell" entry for a not-yet-existing operator. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN198"></a><span class='Declare_Function'>OperatorShellMake</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN199"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN200"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftTypeId</span><span class='Delimiter'>, 
</span><a name="LN201"></a>                  <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightTypeId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN203"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_operator_desc</span><span class='Delimiter'>; 
</span><a name="LN204"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operatorObjectId</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN206"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN207"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>]; 
</span><a name="LN208"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>]; 
</span><a name="LN209"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>oname</span><span class='Delimiter'>; 
</span><a name="LN210"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * validate operator name 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_operator.c.html#LN72"><span class='Ref_to_Func'>validOperatorName</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN198"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a valid operator name"</span><span class='Delimiter'>, 
</span>                        <a href="pg_operator.c.html#LN198"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize our *nulls and *values arrays 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN205"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_operator.c.html#LN205"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="pg_operator.c.html#LN205"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN208"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN205"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN205"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* redundant, but safe */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize values[] with the operator name and input data types. Note 
     * that oprcode is set to InvalidOid, indicating it's a shell. 
     */ 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN209"><span class='Ref_To_Local'>oname</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN198"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_operator_oprname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN209"><span class='Ref_To_Local'>oname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_operator_oprnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN199"><span class='Ref_to_Parameter'>operatorNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN66"><span class='Ref_to_Const'>Anum_pg_operator_oprowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_operator_oprkind</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN200"><span class='Ref_to_Parameter'>leftTypeId</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN201"><span class='Ref_to_Parameter'>rightTypeId</span></a> <span class='Operator'>? </span><span class='String'>'b'</span> <span class='Operator'>: </span><span class='String'>'r'</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='String'>'l'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_operator_oprcanmerge</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_operator_oprcanhash</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_operator_oprleft</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN200"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_operator_oprright</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN201"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_operator_oprresult</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN73"><span class='Ref_to_Const'>Anum_pg_operator_oprcom</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN74"><span class='Ref_to_Const'>Anum_pg_operator_oprnegate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_operator_oprcode</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN76"><span class='Ref_to_Const'>Anum_pg_operator_oprrest</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN77"><span class='Ref_to_Const'>Anum_pg_operator_oprjoin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * open pg_operator 
     */ 
</span>    <a href="pg_operator.c.html#LN203"><span class='Ref_To_Local'>pg_operator_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN210"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN203"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create a new operator tuple 
     */ 
</span>    <a href="pg_operator.c.html#LN206"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN210"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN207"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN208"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * insert our "shell" operator tuple 
     */ 
</span>    <a href="pg_operator.c.html#LN204"><span class='Ref_To_Local'>operatorObjectId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN203"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN206"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Add dependencies for the entry */ 
</span>    <a href="../../include/catalog/pg_operator_fn.h.html#LN31"><span class='Ref_to_Proto'>makeOperatorDependencies</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN206"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN206"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new shell operator */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN204"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure the tuple is visible for subsequent lookups/updates. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * close the operator relation and return the oid. 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN203"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_operator.c.html#LN204"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OperatorShellMake &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * OperatorCreate 
 * 
 * "X" indicates an optional argument (i.e. one that can be NULL or 0) 
 *      operatorName            name for new operator 
 *      operatorNamespace       namespace for new operator 
 *      leftTypeId              X left type ID 
 *      rightTypeId             X right type ID 
 *      procedureId             procedure ID for operator 
 *      commutatorName          X commutator operator 
 *      negatorName             X negator operator 
 *      restrictionId           X restriction selectivity procedure ID 
 *      joinId                  X join selectivity procedure ID 
 *      canMerge                merge join can be used with this operator 
 *      canHash                 hash join can be used with this operator 
 * 
 * The caller should have validated properties and permissions for the 
 * objects passed as OID references.  We must handle the commutator and 
 * negator operator references specially, however, since those need not 
 * exist beforehand. 
 * 
 * This routine gets complicated because it allows the user to 
 * specify operators that do not exist.  For example, if operator 
 * "op" is being defined, the negator operator "negop" and the 
 * commutator "commop" can also be defined without specifying 
 * any information other than their names.  Since in order to 
 * add "op" to the PG_OPERATOR catalog, all the Oid's for these 
 * operators must be placed in the fields of "op", a forward 
 * declaration is done on the commutator and negator operators. 
 * This is called creating a shell, and its main effect is to 
 * create a tuple in the PG_OPERATOR catalog with minimal 
 * information about the operator (just its name and types). 
 * Forward declaration is used only for this purpose, it is 
 * not available to the user as it is for type definition. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN323"></a><span class='Declare_Function'>OperatorCreate</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, 
</span><a name="LN324"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN325"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftTypeId</span><span class='Delimiter'>, 
</span><a name="LN326"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightTypeId</span><span class='Delimiter'>, 
</span><a name="LN327"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>procedureId</span><span class='Delimiter'>, 
</span><a name="LN328"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>commutatorName</span><span class='Delimiter'>, 
</span><a name="LN329"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>negatorName</span><span class='Delimiter'>, 
</span><a name="LN330"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>restrictionId</span><span class='Delimiter'>, 
</span><a name="LN331"></a>               <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>joinId</span><span class='Delimiter'>, 
</span><a name="LN332"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>canMerge</span><span class='Delimiter'>, 
</span><a name="LN333"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>canHash</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN335"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_operator_desc</span><span class='Delimiter'>; 
</span><a name="LN336"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN337"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isUpdate</span><span class='Delimiter'>; 
</span><a name="LN338"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>]; 
</span><a name="LN339"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>]; 
</span><a name="LN340"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>]; 
</span><a name="LN341"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operatorObjectId</span><span class='Delimiter'>; 
</span><a name="LN342"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>operatorAlreadyDefined</span><span class='Delimiter'>; 
</span><a name="LN343"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>operResultType</span><span class='Delimiter'>; 
</span><a name="LN344"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>commutatorId</span><span class='Delimiter'>, 
</span><a name="LN345"></a>                <span class='Declare_Local'>negatorId</span><span class='Delimiter'>; 
</span><a name="LN346"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>selfCommutator</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN347"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>oname</span><span class='Delimiter'>; 
</span><a name="LN348"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN349"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sanity checks 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_operator.c.html#LN72"><span class='Ref_to_Func'>validOperatorName</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a valid operator name"</span><span class='Delimiter'>, 
</span>                        <a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If it's not a binary op, these things mustn't be set: */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN328"><span class='Ref_to_Parameter'>commutatorName</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only binary operators can have commutators"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN331"><span class='Ref_to_Parameter'>joinId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only binary operators can have join selectivity"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN332"><span class='Ref_to_Parameter'>canMerge</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only binary operators can merge join"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN333"><span class='Ref_to_Parameter'>canHash</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only binary operators can hash"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !(OidIsValid(leftType... &raquo; </span> 
 
    <a href="pg_operator.c.html#LN343"><span class='Ref_To_Local'>operResultType</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN327"><span class='Ref_to_Parameter'>procedureId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN343"><span class='Ref_To_Local'>operResultType</span></a> <span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If it's not a boolean op, these things mustn't be set: */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN329"><span class='Ref_to_Parameter'>negatorName</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only boolean operators can have negators"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN330"><span class='Ref_to_Parameter'>restrictionId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only boolean operators can have restriction selectivity"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN331"><span class='Ref_to_Parameter'>joinId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only boolean operators can have join selectivity"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN332"><span class='Ref_to_Parameter'>canMerge</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only boolean operators can merge join"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN333"><span class='Ref_to_Parameter'>canHash</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"only boolean operators can hash"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operResultType!=BOOLO... &raquo; </span> 
 
    <a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN40"><span class='Ref_to_Proto'>OperatorGet</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_operator.c.html#LN324"><span class='Ref_to_Parameter'>operatorNamespace</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Delimiter'>, 
</span>                                   <a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="pg_operator.c.html#LN342"><span class='Ref_To_Local'>operatorAlreadyDefined</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN342"><span class='Ref_To_Local'>operatorAlreadyDefined</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator %s already exists"</span><span class='Delimiter'>, 
</span>                        <a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * At this point, if operatorObjectId is not InvalidOid then we are 
     * filling in a previously-created shell.  Insist that the user own any 
     * such shell. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN310"><span class='Ref_to_Proto'>pg_oper_ownercheck</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN185"><span class='Ref_to_EnumConst'>ACL_KIND_OPER</span></a><span class='Delimiter'>, 
</span>                       <a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up the other operators.  If they do not currently exist, create 
     * shells in order to get ObjectId's. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN328"><span class='Ref_to_Parameter'>commutatorName</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* commutator has reversed arg types */ 
</span>        <a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN56"><span class='Ref_to_Proto'>get_other_operator</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN328"><span class='Ref_to_Parameter'>commutatorName</span></a><span class='Delimiter'>, 
</span>                                          <a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Delimiter'>, 
</span>                                          <a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN324"><span class='Ref_to_Parameter'>operatorNamespace</span></a><span class='Delimiter'>, 
</span>                                          <a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Permission check: must own other operator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN310"><span class='Ref_to_Proto'>pg_oper_ownercheck</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN185"><span class='Ref_to_EnumConst'>ACL_KIND_OPER</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN328"><span class='Ref_to_Parameter'>commutatorName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * self-linkage to this operator; will fix below. Note that only 
         * self-linkage for commutation makes sense. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a><span class='Parentheses'>))</span> 
            <a href="pg_operator.c.html#LN346"><span class='Ref_To_Local'>selfCommutator</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if commutatorName &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN329"><span class='Ref_to_Parameter'>negatorName</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* negator has same arg types */ 
</span>        <a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN56"><span class='Ref_to_Proto'>get_other_operator</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN329"><span class='Ref_to_Parameter'>negatorName</span></a><span class='Delimiter'>, 
</span>                                       <a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Delimiter'>, 
</span>                                       <a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN324"><span class='Ref_to_Parameter'>operatorNamespace</span></a><span class='Delimiter'>, 
</span>                                       <a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Delimiter'>, 
</span>                                       <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Permission check: must own other operator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN310"><span class='Ref_to_Proto'>pg_oper_ownercheck</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN185"><span class='Ref_to_EnumConst'>ACL_KIND_OPER</span></a><span class='Delimiter'>, 
</span>                           <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN329"><span class='Ref_to_Parameter'>negatorName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * set up values in the operator tuple 
     */ 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN348"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_operator.c.html#LN348"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/catalog/pg_operator.h.html#LN63"><span class='Ref_to_Const'>Natts_pg_operator</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="pg_operator.c.html#LN348"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN348"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN339"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN348"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN338"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_operator.c.html#LN348"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN347"><span class='Ref_To_Local'>oname</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN323"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_operator_oprname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN347"><span class='Ref_To_Local'>oname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_operator_oprnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN324"><span class='Ref_to_Parameter'>operatorNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN66"><span class='Ref_to_Const'>Anum_pg_operator_oprowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN67"><span class='Ref_to_Const'>Anum_pg_operator_oprkind</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a> <span class='Operator'>? </span><span class='String'>'b'</span> <span class='Operator'>: </span><span class='String'>'r'</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='String'>'l'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_operator_oprcanmerge</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN332"><span class='Ref_to_Parameter'>canMerge</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_operator_oprcanhash</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN333"><span class='Ref_to_Parameter'>canHash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_operator_oprleft</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN325"><span class='Ref_to_Parameter'>leftTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_operator_oprright</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN326"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN72"><span class='Ref_to_Const'>Anum_pg_operator_oprresult</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN343"><span class='Ref_To_Local'>operResultType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN73"><span class='Ref_to_Const'>Anum_pg_operator_oprcom</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN74"><span class='Ref_to_Const'>Anum_pg_operator_oprnegate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN75"><span class='Ref_to_Const'>Anum_pg_operator_oprcode</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN327"><span class='Ref_to_Parameter'>procedureId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN76"><span class='Ref_to_Const'>Anum_pg_operator_oprrest</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN330"><span class='Ref_to_Parameter'>restrictionId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_operator.h.html#LN77"><span class='Ref_to_Const'>Anum_pg_operator_oprjoin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN331"><span class='Ref_to_Parameter'>joinId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_operator.c.html#LN335"><span class='Ref_To_Local'>pg_operator_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are replacing an operator shell, update; else insert 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN337"><span class='Ref_To_Local'>isUpdate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for operator %u"</span><span class='Delimiter'>, 
</span>                 <a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN335"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_operator.c.html#LN338"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_operator.c.html#LN339"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN335"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN337"><span class='Ref_To_Local'>isUpdate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN335"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="pg_operator.c.html#LN340"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN338"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN335"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Add dependencies for the entry */ 
</span>    <a href="pg_operator.c.html#LN349"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_operator_fn.h.html#LN31"><span class='Ref_to_Proto'>makeOperatorDependencies</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN336"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN337"><span class='Ref_To_Local'>isUpdate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new operator */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN335"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If a commutator and/or negator link is provided, update the other 
     * operator(s) to point at this one, if they don't already have a link. 
     * This supports an alternative style of operator definition wherein the 
     * user first defines one operator without giving negator or commutator, 
     * then defines the other operator of the pair with the proper commutator 
     * or negator attribute.  That style doesn't require creation of a shell, 
     * and it's the only style that worked right before Postgres version 6.5. 
     * This code also takes care of the situation where the new operator is 
     * its own commutator. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN346"><span class='Ref_To_Local'>selfCommutator</span></a><span class='Parentheses'>) 
</span>        <a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/catalog/pg_operator_fn.h.html#LN33"><span class='Ref_to_Proto'>OperatorUpd</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN341"><span class='Ref_To_Local'>operatorObjectId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN344"><span class='Ref_To_Local'>commutatorId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN345"><span class='Ref_To_Local'>negatorId</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_operator.c.html#LN349"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OperatorCreate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Try to lookup another operator (commutator, etc) 
 * 
 * If not found, check to see if it is exactly the operator we are trying 
 * to define; if so, return InvalidOid.  (Note that this case is only 
 * sensible for a commutator, so we error out otherwise.)  If it is not 
 * the same operator, create a shell operator. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN575"></a><span class='Declare_Function'>get_other_operator</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>otherOp</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>otherLeftTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>otherRightTypeId</span><span class='Delimiter'>, 
</span><a name="LN576"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>operatorName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operatorNamespace</span><span class='Delimiter'>, 
</span><a name="LN577"></a>                   <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>leftTypeId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>rightTypeId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommutator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN579"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>other_oid</span><span class='Delimiter'>; 
</span><a name="LN580"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>otherDefined</span><span class='Delimiter'>; 
</span><a name="LN581"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>otherName</span><span class='Delimiter'>; 
</span><a name="LN582"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>otherNamespace</span><span class='Delimiter'>; 
</span><a name="LN583"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <a href="pg_operator.c.html#LN579"><span class='Ref_To_Local'>other_oid</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN46"><span class='Ref_to_Proto'>OperatorLookup</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherOp</span></a><span class='Delimiter'>, 
</span>                               <a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherLeftTypeId</span></a><span class='Delimiter'>, 
</span>                               <a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherRightTypeId</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="pg_operator.c.html#LN580"><span class='Ref_To_Local'>otherDefined</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN579"><span class='Ref_To_Local'>other_oid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* other op already in catalogs */ 
</span>        <span class='Control'>return</span> <a href="pg_operator.c.html#LN579"><span class='Ref_To_Local'>other_oid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_operator.c.html#LN582"><span class='Ref_To_Local'>otherNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherOp</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Operator'>&</span><a href="pg_operator.c.html#LN581"><span class='Ref_To_Local'>otherName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="pg_operator.c.html#LN581"><span class='Ref_To_Local'>otherName</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN576"><span class='Ref_to_Parameter'>operatorName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="pg_operator.c.html#LN582"><span class='Ref_To_Local'>otherNamespace</span></a> <span class='Operator'>== </span><a href="pg_operator.c.html#LN576"><span class='Ref_to_Parameter'>operatorNamespace</span></a> <span class='Operator'>&& 
</span>        <a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherLeftTypeId</span></a> <span class='Operator'>== </span><a href="pg_operator.c.html#LN577"><span class='Ref_to_Parameter'>leftTypeId</span></a> <span class='Operator'>&& 
</span>        <a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherRightTypeId</span></a> <span class='Operator'>== </span><a href="pg_operator.c.html#LN577"><span class='Ref_to_Parameter'>rightTypeId</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * self-linkage to this operator; caller will fix later. Note that 
         * only self-linkage for commutation makes sense. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_operator.c.html#LN577"><span class='Ref_to_Parameter'>isCommutator</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_FUNCTION_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operator cannot be its own negator or sort operator"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* not in catalogs, different from operator, so make shell */ 
</span> 
    <a href="pg_operator.c.html#LN583"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN582"><span class='Ref_To_Local'>otherNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                      <a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN583"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN583"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN582"><span class='Ref_To_Local'>otherNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_operator.c.html#LN579"><span class='Ref_To_Local'>other_oid</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN51"><span class='Ref_to_Proto'>OperatorShellMake</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN581"><span class='Ref_To_Local'>otherName</span></a><span class='Delimiter'>, 
</span>                                  <a href="pg_operator.c.html#LN582"><span class='Ref_To_Local'>otherNamespace</span></a><span class='Delimiter'>, 
</span>                                  <a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherLeftTypeId</span></a><span class='Delimiter'>, 
</span>                                  <a href="pg_operator.c.html#LN575"><span class='Ref_to_Parameter'>otherRightTypeId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_operator.c.html#LN579"><span class='Ref_To_Local'>other_oid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_other_operator &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * OperatorUpd 
 * 
 *  For a given operator, look up its negator and commutator operators. 
 *  When isDelete is false, update their negator and commutator fields to 
 *  point back to the given operator; when isDelete is true, update those 
 *  fields to no longer point back to the given operator. 
 * 
 *  The !isDelete case solves a problem for users who need to insert two new 
 *  operators that are the negator or commutator of each other, while the 
 *  isDelete case is needed so as not to leave dangling OID links behind 
 *  after dropping an operator. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN644"></a><span class='Declare_Function'>OperatorUpd</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>baseId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>commId</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>negId</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isDelete</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN646"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_operator_desc</span><span class='Delimiter'>; 
</span><a name="LN647"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're making an operator into its own commutator, then we need a 
     * command-counter increment here, since we've just inserted the tuple 
     * we're about to update.  But when we're dropping an operator, we can 
     * skip this because we're at the beginning of the command. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>isDelete</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open the relation. */ 
</span>    <a href="pg_operator.c.html#LN646"><span class='Ref_To_Local'>pg_operator_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get a writable copy of the commutator's tuple. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>commId</span></a><span class='Parentheses'>))</span> 
        <a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>commId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update the commutator's tuple if need be. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN670"></a>        <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>t</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN671"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>update_commutator</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Out of due caution, we only change the commutator's oprcom field if 
         * it has the exact value we expected: InvalidOid when creating an 
         * operator, or baseId when dropping one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>isDelete</span></a> <span class='Operator'>&& </span><a href="pg_operator.c.html#LN670"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprcom <span class='Operator'>== </span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>baseId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_operator.c.html#LN670"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprcom <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="pg_operator.c.html#LN671"><span class='Ref_To_Local'>update_commutator</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>isDelete</span></a> <span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN670"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprcom<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_operator.c.html#LN670"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprcom <span class='Operator'>= </span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>baseId</span></a><span class='Delimiter'>; 
</span>            <a href="pg_operator.c.html#LN671"><span class='Ref_To_Local'>update_commutator</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If any columns were found to need modification, update tuple. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN671"><span class='Ref_To_Local'>update_commutator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN646"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Do CCI to make the updated tuple visible.  We must do this in 
             * case the commutator is also the negator.  (Which would be a 
             * logic error on the operator definer's part, but that's not a 
             * good reason to fail here.)  We would need a CCI anyway in the 
             * deletion case for a self-commutator with no negator. 
             */ 
</span>            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tup) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Similarly find and update the negator, if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>negId</span></a><span class='Parentheses'>))</span> 
        <a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN71"><span class='Ref_to_EnumConst'>OPEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>negId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN715"></a>        <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>t</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN716"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>update_negator</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Out of due caution, we only change the negator's oprnegate field if 
         * it has the exact value we expected: InvalidOid when creating an 
         * operator, or baseId when dropping one. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>isDelete</span></a> <span class='Operator'>&& </span><a href="pg_operator.c.html#LN715"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprnegate <span class='Operator'>== </span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>baseId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="pg_operator.c.html#LN715"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprnegate <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="pg_operator.c.html#LN716"><span class='Ref_To_Local'>update_negator</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>isDelete</span></a> <span class='Operator'>&& !</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN715"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprnegate<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="pg_operator.c.html#LN715"><span class='Ref_To_Local'>t</span></a><span class='Operator'>-&GT;</span>oprnegate <span class='Operator'>= </span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>baseId</span></a><span class='Delimiter'>; 
</span>            <a href="pg_operator.c.html#LN716"><span class='Ref_To_Local'>update_negator</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* If any columns were found to need modification, update tuple. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN716"><span class='Ref_To_Local'>update_negator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN646"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN647"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In the deletion case, do CCI to make the updated tuple visible. 
             * We must do this in case the operator is its own negator. (Which 
             * would be a logic error on the operator definer's part, but 
             * that's not a good reason to fail here.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN644"><span class='Ref_to_Parameter'>isDelete</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tup) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Close relation and release catalog lock. */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN646"><span class='Ref_To_Local'>pg_operator_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end OperatorUpd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Create dependencies for an operator (either a freshly inserted 
 * complete operator, a new shell operator, a just-updated shell, 
 * or an operator that's being modified by ALTER OPERATOR). 
 * 
 * NB: the OidIsValid tests in this routine are necessary, in case 
 * the given operator is a shell. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN763"></a><span class='Declare_Function'>makeOperatorDependencies</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isUpdate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN765"></a>    <a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a> <span class='Declare_Local'>oper</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN56"><span class='Ref_to_Typedef'>Form_pg_operator</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN763"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN766"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN767"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN763"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we are updating the operator, delete any existing entries, except 
     * for extension membership which should remain the same. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_operator.c.html#LN763"><span class='Ref_to_Parameter'>isUpdate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_depend.c.html#LN189"><span class='Ref_to_Func'>deleteDependencyRecordsFor</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/dependency.h.html#LN254"><span class='Ref_to_Proto'>deleteSharedDependencyRecordsFor</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on namespace */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprnamespace<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprnamespace<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on left type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprleft<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on right type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprright<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprright<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprresult<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprresult<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * NOTE: we do not consider the operator to depend on the associated 
     * operators oprcom and oprnegate. We would not want to delete this 
     * operator if those go away, but only reset the link fields; which is not 
     * a function that the dependency code can presently handle.  (Something 
     * could perhaps be done with objectSubId though.)  For now, it's okay to 
     * let those links dangle if a referenced operator is removed. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on implementation function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprcode<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on restriction selectivity function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprrest<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprrest<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on join selectivity function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprjoin<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprjoin<span class='Delimiter'>; 
</span>        <a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_operator.c.html#LN767"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on owner */ 
</span>    <a href="pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_operator.h.html#LN31"><span class='Ref_to_Const'>OperatorRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="pg_operator.c.html#LN763"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="pg_operator.c.html#LN765"><span class='Ref_To_Local'>oper</span></a><span class='Operator'>-&GT;</span>oprowner<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Dependency on extension */ 
</span>    <a href="pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_operator.c.html#LN766"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeOperatorDependencies &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>