<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\pg_subscription.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\pg_subscription.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:33 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_subscription.c 
 *      replication subscriptions 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *      src/backend/catalog/pg_subscription.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_subscription.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_subscription_rel.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/pg_lsn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<a name="LN38"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>textarray_to_stringlist</span><span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>textarray</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Fetch the subscription from the syscache. 
 */ 
</span><a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a> <span class='Operator'>* 
</span><a name="LN44"></a><span class='Declare_Function'>GetSubscription</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN46"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN47"></a>    <a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sub</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a> <span class='Declare_Local'>subform</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN44"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN44"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for subscription %u"</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN44"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_subscription.c.html#LN48"><span class='Ref_To_Local'>subform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN76"><span class='Ref_to_Member'>oid</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN44"><span class='Ref_to_Parameter'>subid</span></a><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN77"><span class='Ref_to_Member'>dbid</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN48"><span class='Ref_To_Local'>subform</span></a><span class='Operator'>-&GT;</span>subdbid<span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN79"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN48"><span class='Ref_To_Local'>subform</span></a><span class='Operator'>-&GT;</span>subname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN80"><span class='Ref_to_Member'>owner</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN48"><span class='Ref_To_Local'>subform</span></a><span class='Operator'>-&GT;</span>subowner<span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN81"><span class='Ref_to_Member'>enabled</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN48"><span class='Ref_To_Local'>subform</span></a><span class='Operator'>-&GT;</span>subenabled<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get conninfo */ 
</span>    <a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, 
</span>                            <a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN68"><span class='Ref_to_Const'>Anum_pg_subscription_subconninfo</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN82"><span class='Ref_to_Member'>conninfo</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get slotname */ 
</span>    <a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, 
</span>                            <a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN69"><span class='Ref_to_Const'>Anum_pg_subscription_subslotname</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN83"><span class='Ref_to_Member'>slotname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../../include/postgres.h.html#LN590"><span class='Ref_to_Macro'>DatumGetName</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN83"><span class='Ref_to_Member'>slotname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get synccommit */ 
</span>    <a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, 
</span>                            <a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_subscription_subsynccommit</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN84"><span class='Ref_to_Member'>synccommit</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get publications */ 
</span>    <a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, 
</span>                            <a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/pg_subscription.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_subscription_subpublications</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_subscription.c.html#LN50"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN85"><span class='Ref_to_Member'>publications</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN38"><span class='Ref_to_Proto'>textarray_to_stringlist</span></a><span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN49"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN46"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN47"><span class='Ref_To_Local'>sub</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetSubscription &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return number of subscriptions defined in given database. 
 * Used by dropdb() to check if database can indeed be dropped. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN115"></a><span class='Declare_Function'>CountDBSubscriptions</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dbid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN117"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nsubs</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN118"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>scankey</span><span class='Delimiter'>; 
</span><a name="LN120"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN121"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN118"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN21"><span class='Ref_to_Const'>SubscriptionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN119"><span class='Ref_To_Local'>scankey</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/catalog/pg_subscription.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_subscription_subdbid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN115"><span class='Ref_to_Parameter'>dbid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN120"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN118"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN119"><span class='Ref_To_Local'>scankey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN121"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN120"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
        <a href="pg_subscription.c.html#LN117"><span class='Ref_To_Local'>nsubs</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN120"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN118"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN117"><span class='Ref_To_Local'>nsubs</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CountDBSubscriptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Free memory allocated by subscription struct. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN147"></a><span class='Declare_Function'>FreeSubscription</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN74"><span class='Ref_to_Struct'>Subscription</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sub</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN147"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN79"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN147"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN82"><span class='Ref_to_Member'>conninfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN147"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN83"><span class='Ref_to_Member'>slotname</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN147"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN83"><span class='Ref_to_Member'>slotname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN266"><span class='Ref_to_Proto'>list_free_deep</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN147"><span class='Ref_to_Parameter'>sub</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription.h.html#LN85"><span class='Ref_to_Member'>publications</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN147"><span class='Ref_to_Parameter'>sub</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_subscription_oid - given a subscription name, look up the OID 
 * 
 * If missing_ok is false, throw an error if name not found.  If true, just 
 * return InvalidOid. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN164"></a><span class='Declare_Function'>get_subscription_oid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>subname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN166"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN166"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN91"><span class='Ref_to_EnumConst'>SUBSCRIPTIONNAME</span></a><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN164"><span class='Ref_to_Parameter'>subname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN166"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="pg_subscription.c.html#LN164"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"subscription \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN164"><span class='Ref_to_Parameter'>subname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN166"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * get_subscription_name - given a subscription OID, look up the name 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN181"></a><span class='Declare_Function'>get_subscription_name</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN183"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN184"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>subname</span><span class='Delimiter'>; 
</span><a name="LN185"></a>    <a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a> <span class='Declare_Local'>subform</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN183"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN92"><span class='Ref_to_EnumConst'>SUBSCRIPTIONOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN181"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN183"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for subscription %u"</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN181"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN185"><span class='Ref_To_Local'>subform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription.h.html#LN57"><span class='Ref_to_Typedef'>Form_pg_subscription</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN183"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN184"><span class='Ref_To_Local'>subname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN185"><span class='Ref_To_Local'>subform</span></a><span class='Operator'>-&GT;</span>subname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN183"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN184"><span class='Ref_To_Local'>subname</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert text array to list of strings. 
 * 
 * Note: the resulting list of strings is pallocated here. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN206"></a><span class='Declare_Function'>textarray_to_stringlist</span><span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>textarray</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN208"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elems</span><span class='Delimiter'>; 
</span><a name="LN209"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>, 
</span><a name="LN210"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN211"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN206"><span class='Ref_to_Parameter'>textarray</span></a><span class='Delimiter'>, 
</span>                      <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="pg_subscription.c.html#LN208"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN209"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN209"><span class='Ref_To_Local'>nelems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN210"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_subscription.c.html#LN210"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="pg_subscription.c.html#LN209"><span class='Ref_To_Local'>nelems</span></a><span class='Delimiter'>; </span><a href="pg_subscription.c.html#LN210"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="pg_subscription.c.html#LN211"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN211"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN208"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><a href="pg_subscription.c.html#LN210"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN211"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end textarray_to_stringlist &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set the state of a subscription table. 
 * 
 * If update_only is true and the record for given table doesn't exist, do 
 * nothing.  This can be used to avoid inserting a new record that was deleted 
 * by someone else.  Generally, subscription DDL commands should use false, 
 * workers should use true. 
 * 
 * The insert-or-update logic in this function is not concurrency safe so it 
 * might raise an error in rare circumstances.  But if we took a stronger lock 
 * such as ShareRowExclusiveLock, we would risk more deadlocks. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN239"></a><span class='Declare_Function'>SetSubscriptionRelState</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN240"></a>                        <a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Declare_Parameter'>sublsn</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>update_only</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN242"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN243"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>subrelid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN245"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN43"><span class='Ref_to_Const'>Natts_pg_subscription_rel</span></a><span class='Delimiter'>]; 
</span><a name="LN246"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN43"><span class='Ref_to_Const'>Natts_pg_subscription_rel</span></a><span class='Delimiter'>]; 
</span> 
    <a href="pg_subscription.c.html#LN242"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN23"><span class='Ref_to_Const'>SubscriptionRelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Try finding existing mapping. */ 
</span>    <a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN166"><span class='Ref_to_Macro'>SearchSysCacheCopy2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN93"><span class='Ref_to_EnumConst'>SUBSCRIPTIONRELMAP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN239"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN239"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the record for given table does not exist yet create new record, 
     * otherwise update the existing one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="pg_subscription.c.html#LN240"><span class='Ref_to_Parameter'>update_only</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Form the tuple. */ 
</span>        memset<span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN239"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN45"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN239"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN46"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubstate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN239"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN240"><span class='Ref_to_Parameter'>sublsn</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Parentheses'>) 
</span>            <a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN47"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsublsn</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/pg_lsn.h.html#LN21"><span class='Ref_to_Macro'>LSNGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN240"><span class='Ref_to_Parameter'>sublsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN47"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsublsn</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN242"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Insert tuple into catalog. */ 
</span>        <a href="pg_subscription.c.html#LN244"><span class='Ref_To_Local'>subrelid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN242"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !HeapTupleIsValid(tup... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN281"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN43"><span class='Ref_to_Const'>Natts_pg_subscription_rel</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the tuple. */ 
</span>        memset<span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN281"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN281"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN281"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN46"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubstate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN46"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubstate</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN239"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN281"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN47"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsublsn</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN240"><span class='Ref_to_Parameter'>sublsn</span></a> <span class='Operator'>!= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Parentheses'>) 
</span>            <a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN47"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsublsn</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/pg_lsn.h.html#LN21"><span class='Ref_to_Macro'>LSNGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN240"><span class='Ref_to_Parameter'>sublsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN47"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsublsn</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN242"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN246"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN245"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_subscription.c.html#LN281"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Update the catalog. */ 
</span>        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN242"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN244"><span class='Ref_To_Local'>subrelid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN243"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tup) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN242"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN244"><span class='Ref_To_Local'>subrelid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SetSubscriptionRelState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get state of subscription table. 
 * 
 * Returns SUBREL_STATE_UNKNOWN when not found and missing_ok is true. 
 */ 
</span><span class='Keyword'>char 
</span><a name="LN318"></a><span class='Declare_Function'>GetSubscriptionRelState</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><a href="../../include/access/xlogdefs.h.html#LN20"><span class='Ref_to_Typedef'>XLogRecPtr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sublsn</span><span class='Delimiter'>, 
</span><a name="LN319"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN321"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN322"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>substate</span><span class='Delimiter'>; 
</span><a name="LN324"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN325"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN321"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN23"><span class='Ref_to_Const'>SubscriptionRelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Try finding the mapping. */ 
</span>    <a href="pg_subscription.c.html#LN322"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN157"><span class='Ref_to_Macro'>SearchSysCache2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN93"><span class='Ref_to_EnumConst'>SUBSCRIPTIONRELMAP</span></a><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN322"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN319"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN321"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>sublsn</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../include/catalog/pg_subscription_rel.h.html#LN61"><span class='Ref_to_Const'>SUBREL_STATE_UNKNOWN</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"subscription table %u in subscription %u does not exist"</span><span class='Delimiter'>, 
</span>             <a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>relid</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get the state. */ 
</span>    <a href="pg_subscription.c.html#LN325"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN93"><span class='Ref_to_EnumConst'>SUBSCRIPTIONRELMAP</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN322"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/pg_subscription_rel.h.html#LN46"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN324"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="pg_subscription.c.html#LN324"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN323"><span class='Ref_To_Local'>substate</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN414"><span class='Ref_to_Macro'>DatumGetChar</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN325"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_subscription.c.html#LN325"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN93"><span class='Ref_to_EnumConst'>SUBSCRIPTIONRELMAP</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN322"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/pg_subscription_rel.h.html#LN47"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsublsn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN324"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN324"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>sublsn</span></a> <span class='Operator'>= </span><a href="../../include/access/xlogdefs.h.html#LN27"><span class='Ref_to_Const'>InvalidXLogRecPtr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="pg_subscription.c.html#LN318"><span class='Ref_to_Parameter'>sublsn</span></a> <span class='Operator'>= </span><a href="../../include/utils/pg_lsn.h.html#LN20"><span class='Ref_to_Macro'>DatumGetLSN</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN325"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup */ 
</span>    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN322"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN321"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN323"><span class='Ref_To_Local'>substate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetSubscriptionRelState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Drop subscription relation mapping. These can be for a particular 
 * subscription, or for a particular relation, or both. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN371"></a><span class='Declare_Function'>RemoveSubscriptionRel</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN373"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN374"></a>    <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span><a name="LN375"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN376"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN377"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkeys</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN373"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN23"><span class='Ref_to_Const'>SubscriptionRelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN371"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN375"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><a href="pg_subscription.c.html#LN377"><span class='Ref_To_Local'>nkeys</span></a><span class='Operator'>++</span><span class='Delimiter'>], 
</span>                    <a href="../../include/catalog/pg_subscription_rel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, 
</span>                    F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN371"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN371"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN375"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><a href="pg_subscription.c.html#LN377"><span class='Ref_To_Local'>nkeys</span></a><span class='Operator'>++</span><span class='Delimiter'>], 
</span>                    <a href="../../include/catalog/pg_subscription_rel.h.html#LN45"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srrelid</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, 
</span>                    F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN371"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Do the search and delete what we found. */ 
</span>    <a href="pg_subscription.c.html#LN374"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN110"><span class='Ref_to_Proto'>heap_beginscan_catalog</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN373"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN377"><span class='Ref_To_Local'>nkeys</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN375"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN376"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN374"><span class='Ref_To_Local'>scan</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN176"><span class='Ref_to_Proto'>simple_heap_delete</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN373"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN376"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN374"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN373"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveSubscriptionRel &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Get all relations for subscription. 
 * 
 * Returned list is palloc'ed in current memory context. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN417"></a><span class='Declare_Function'>GetSubscriptionRelations</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN419"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN420"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN421"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN422"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkeys</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN423"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN424"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN420"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN23"><span class='Ref_to_Const'>SubscriptionRelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN423"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><a href="pg_subscription.c.html#LN422"><span class='Ref_To_Local'>nkeys</span></a><span class='Operator'>++</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_subscription_rel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN417"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN424"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN420"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN422"><span class='Ref_To_Local'>nkeys</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN423"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN421"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN424"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN438"></a>        <a href="../../include/catalog/pg_subscription_rel.h.html#LN37"><span class='Ref_to_Typedef'>Form_pg_subscription_rel</span></a> <span class='Declare_Local'>subrel</span><span class='Delimiter'>; 
</span><a name="LN439"></a>        <a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>relstate</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN438"><span class='Ref_To_Local'>subrel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN37"><span class='Ref_to_Typedef'>Form_pg_subscription_rel</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN421"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN439"><span class='Ref_To_Local'>relstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN439"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN67"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN438"><span class='Ref_To_Local'>subrel</span></a><span class='Operator'>-&GT;</span>srrelid<span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN439"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN69"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN438"><span class='Ref_To_Local'>subrel</span></a><span class='Operator'>-&GT;</span>srsubstate<span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN439"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN68"><span class='Ref_to_Member'>lsn</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN438"><span class='Ref_To_Local'>subrel</span></a><span class='Operator'>-&GT;</span>srsublsn<span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN419"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN419"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN439"><span class='Ref_To_Local'>relstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup */ 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN424"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN420"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN419"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetSubscriptionRelations &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get all relations for subscription that are not in a ready state. 
 * 
 * Returned list is palloc'ed in current memory context. 
 */ 
</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN464"></a><span class='Declare_Function'>GetSubscriptionNotReadyRelations</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>subid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN466"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN467"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN468"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN469"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkeys</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN470"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>skey</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN471"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scan</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN467"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN23"><span class='Ref_to_Const'>SubscriptionRelRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN470"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><a href="pg_subscription.c.html#LN469"><span class='Ref_To_Local'>nkeys</span></a><span class='Operator'>++</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_subscription_rel.h.html#LN44"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN464"><span class='Ref_to_Parameter'>subid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_subscription.c.html#LN470"><span class='Ref_To_Local'>skey</span></a><span class='Delimiter'>[</span><a href="pg_subscription.c.html#LN469"><span class='Ref_To_Local'>nkeys</span></a><span class='Operator'>++</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_subscription_rel.h.html#LN46"><span class='Ref_to_Const'>Anum_pg_subscription_rel_srsubstate</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_CHARNE<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN58"><span class='Ref_to_Const'>SUBREL_STATE_READY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="pg_subscription.c.html#LN471"><span class='Ref_To_Local'>scan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN467"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                              <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN469"><span class='Ref_To_Local'>nkeys</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN470"><span class='Ref_To_Local'>skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN468"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN471"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN490"></a>        <a href="../../include/catalog/pg_subscription_rel.h.html#LN37"><span class='Ref_to_Typedef'>Form_pg_subscription_rel</span></a> <span class='Declare_Local'>subrel</span><span class='Delimiter'>; 
</span><a name="LN491"></a>        <a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>relstate</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN490"><span class='Ref_To_Local'>subrel</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN37"><span class='Ref_to_Typedef'>Form_pg_subscription_rel</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN468"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN491"><span class='Ref_To_Local'>relstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN65"><span class='Ref_to_Struct'>SubscriptionRelState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN491"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN67"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN490"><span class='Ref_To_Local'>subrel</span></a><span class='Operator'>-&GT;</span>srrelid<span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN491"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN69"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN490"><span class='Ref_To_Local'>subrel</span></a><span class='Operator'>-&GT;</span>srsubstate<span class='Delimiter'>; 
</span>        <a href="pg_subscription.c.html#LN491"><span class='Ref_To_Local'>relstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/pg_subscription_rel.h.html#LN68"><span class='Ref_to_Member'>lsn</span></a> <span class='Operator'>= </span><a href="pg_subscription.c.html#LN490"><span class='Ref_To_Local'>subrel</span></a><span class='Operator'>-&GT;</span>srsublsn<span class='Delimiter'>; 
</span> 
        <a href="pg_subscription.c.html#LN466"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN466"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="pg_subscription.c.html#LN491"><span class='Ref_To_Local'>relstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup */ 
</span>    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN471"><span class='Ref_To_Local'>scan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_subscription.c.html#LN467"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_subscription.c.html#LN466"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetSubscriptionNotReadyRelations &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>