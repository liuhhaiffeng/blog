<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\catalog\pg_type.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\catalog\pg_type.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:33 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * pg_type.c 
 *    routines to support manipulation of the pg_type relation 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/catalog/pg_type.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/binary_upgrade.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/typecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/scansup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
<span class='Comment_Multi_Line'>/* Potentially set by pg_upgrade_support functions */ 
</span><a name="LN39"></a><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Var'>binary_upgrade_next_pg_type_oid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      TypeShellMake 
 * 
 *      This procedure inserts a "shell" tuple into the pg_type relation. 
 *      The type tuple inserted has valid but dummy values, and its 
 *      "typisdefined" field is false indicating it's not really defined. 
 * 
 *      This is used so that a tuple exists in the catalogs.  The I/O 
 *      functions for the type will link to this tuple.  When the full 
 *      CREATE TYPE command is issued, the bogus values will be replaced 
 *      with correct ones, and "typisdefined" will be set to true. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN55"></a><span class='Declare_Function'>TypeShellMake</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>typeName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeNamespace</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN57"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_type_desc</span><span class='Delimiter'>; 
</span><a name="LN58"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN59"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN60"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN61"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN62"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN63"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoid</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN55"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * open pg_type 
     */ 
</span>    <a href="pg_type.c.html#LN57"><span class='Ref_To_Local'>pg_type_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN58"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN57"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize our *nulls and *values arrays 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN59"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_type.c.html#LN59"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="pg_type.c.html#LN59"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN62"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_type.c.html#LN59"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_type.c.html#LN59"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* redundant, but safe */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize *values with the type name and dummy values 
     * 
     * The representational details are the same as int4 ... it doesn't really 
     * matter what they are so long as they are consistent.  Also note that we 
     * give it typtype = TYPTYPE_PSEUDO as extra insurance that it won't be 
     * mistaken for a usable type. 
     */ 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN64"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN55"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN239"><span class='Ref_to_Const'>Anum_pg_type_typname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN64"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN240"><span class='Ref_to_Const'>Anum_pg_type_typnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN55"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN241"><span class='Ref_to_Const'>Anum_pg_type_typowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN55"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN242"><span class='Ref_to_Const'>Anum_pg_type_typlen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN243"><span class='Ref_to_Const'>Anum_pg_type_typbyval</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN244"><span class='Ref_to_Const'>Anum_pg_type_typtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN723"><span class='Ref_to_Const'>TYPTYPE_PSEUDO</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN245"><span class='Ref_to_Const'>Anum_pg_type_typcategory</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN735"><span class='Ref_to_Const'>TYPCATEGORY_PSEUDOTYPE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN246"><span class='Ref_to_Const'>Anum_pg_type_typispreferred</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN247"><span class='Ref_to_Const'>Anum_pg_type_typisdefined</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN248"><span class='Ref_to_Const'>Anum_pg_type_typdelim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/commands/typecmds.h.html#LN21"><span class='Ref_to_Const'>DEFAULT_TYPDELIM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN249"><span class='Ref_to_Const'>Anum_pg_type_typrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN250"><span class='Ref_to_Const'>Anum_pg_type_typelem</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN251"><span class='Ref_to_Const'>Anum_pg_type_typarray</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN252"><span class='Ref_to_Const'>Anum_pg_type_typinput</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span>F_SHELL_IN<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN253"><span class='Ref_to_Const'>Anum_pg_type_typoutput</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span>F_SHELL_OUT<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN254"><span class='Ref_to_Const'>Anum_pg_type_typreceive</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN255"><span class='Ref_to_Const'>Anum_pg_type_typsend</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN256"><span class='Ref_to_Const'>Anum_pg_type_typmodin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN257"><span class='Ref_to_Const'>Anum_pg_type_typmodout</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN258"><span class='Ref_to_Const'>Anum_pg_type_typanalyze</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN259"><span class='Ref_to_Const'>Anum_pg_type_typalign</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN260"><span class='Ref_to_Const'>Anum_pg_type_typstorage</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><span class='String'>'p'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN261"><span class='Ref_to_Const'>Anum_pg_type_typnotnull</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN262"><span class='Ref_to_Const'>Anum_pg_type_typbasetype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN263"><span class='Ref_to_Const'>Anum_pg_type_typtypmod</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN264"><span class='Ref_to_Const'>Anum_pg_type_typndims</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN265"><span class='Ref_to_Const'>Anum_pg_type_typcollation</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN62"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN62"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN62"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * create a new type tuple 
     */ 
</span>    <a href="pg_type.c.html#LN60"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN58"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN61"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN62"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use binary-upgrade override for pg_type.oid? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN101"><span class='Ref_to_Global_Var'>IsBinaryUpgrade</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN39"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_type_oid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_type OID value not set when in binary upgrade mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN60"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN39"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_type_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN39"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_type_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * insert the tuple in the relation and get the tuple's oid. 
     */ 
</span>    <a href="pg_type.c.html#LN63"><span class='Ref_To_Local'>typoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN57"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN60"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create dependencies.  We can/must skip this in bootstrap mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/catalog/pg_type_fn.h.html#LN56"><span class='Ref_to_Proto'>GenerateTypeDependencies</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN55"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN63"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN55"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                                 F_SHELL_IN<span class='Delimiter'>, 
</span>                                 F_SHELL_OUT<span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new shell type */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN63"><span class='Ref_To_Local'>typoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN65"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN63"><span class='Ref_To_Local'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * clean up and return the type-oid 
     */ 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN60"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN57"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_type.c.html#LN65"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TypeShellMake &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *      TypeCreate 
 * 
 *      This does all the necessary work needed to define a new type. 
 * 
 *      Returns the ObjectAddress assigned to the new type. 
 *      If newTypeOid is zero (the normal case), a new OID is created; 
 *      otherwise we use exactly that OID. 
 * ---------------------------------------------------------------- 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN194"></a><span class='Declare_Function'>TypeCreate</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newTypeOid</span><span class='Delimiter'>, 
</span><a name="LN195"></a>           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>typeName</span><span class='Delimiter'>, 
</span><a name="LN196"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeNamespace</span><span class='Delimiter'>, 
</span><a name="LN197"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* only for relation rowtypes */ 
</span><a name="LN198"></a>           <span class='Keyword'>char </span><span class='Declare_Parameter'>relationKind</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* ditto */ 
</span><a name="LN199"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ownerId</span><span class='Delimiter'>, 
</span><a name="LN200"></a>           <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Parameter'>internalSize</span><span class='Delimiter'>, 
</span><a name="LN201"></a>           <span class='Keyword'>char </span><span class='Declare_Parameter'>typeType</span><span class='Delimiter'>, 
</span><a name="LN202"></a>           <span class='Keyword'>char </span><span class='Declare_Parameter'>typeCategory</span><span class='Delimiter'>, 
</span><a name="LN203"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>typePreferred</span><span class='Delimiter'>, 
</span><a name="LN204"></a>           <span class='Keyword'>char </span><span class='Declare_Parameter'>typDelim</span><span class='Delimiter'>, 
</span><a name="LN205"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>inputProcedure</span><span class='Delimiter'>, 
</span><a name="LN206"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>outputProcedure</span><span class='Delimiter'>, 
</span><a name="LN207"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>receiveProcedure</span><span class='Delimiter'>, 
</span><a name="LN208"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>sendProcedure</span><span class='Delimiter'>, 
</span><a name="LN209"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typmodinProcedure</span><span class='Delimiter'>, 
</span><a name="LN210"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typmodoutProcedure</span><span class='Delimiter'>, 
</span><a name="LN211"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>analyzeProcedure</span><span class='Delimiter'>, 
</span><a name="LN212"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elementType</span><span class='Delimiter'>, 
</span><a name="LN213"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>isImplicitArray</span><span class='Delimiter'>, 
</span><a name="LN214"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>arrayType</span><span class='Delimiter'>, 
</span><a name="LN215"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>baseType</span><span class='Delimiter'>, 
</span><a name="LN216"></a>           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>defaultTypeValue</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* human readable rep */ 
</span><a name="LN217"></a>           <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>defaultTypeBin</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* cooked rep */ 
</span><a name="LN218"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>passedByValue</span><span class='Delimiter'>, 
</span><a name="LN219"></a>           <span class='Keyword'>char </span><span class='Declare_Parameter'>alignment</span><span class='Delimiter'>, 
</span><a name="LN220"></a>           <span class='Keyword'>char </span><span class='Declare_Parameter'>storage</span><span class='Delimiter'>, 
</span><a name="LN221"></a>           <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typeMod</span><span class='Delimiter'>, 
</span><a name="LN222"></a>           <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typNDims</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* Array dimensions for baseType */ 
</span><a name="LN223"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>typeNotNull</span><span class='Delimiter'>, 
</span><a name="LN224"></a>           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeCollation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN226"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_type_desc</span><span class='Delimiter'>; 
</span><a name="LN227"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeObjectId</span><span class='Delimiter'>; 
</span><a name="LN228"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>rebuildDeps</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN229"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN230"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN231"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN232"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>]; 
</span><a name="LN233"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN234"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN235"></a>    <a href="../../include/utils/acl.h.html#LN98"><span class='Ref_to_Typedef'>Acl</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>typacl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We assume that the caller validated the arguments individually, but did 
     * not check for bad combinations. 
     * 
     * Validate size specifications: either positive (fixed-length) or -1 
     * (varlena) or -2 (cstring). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>          <a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>|| 
</span>          <a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid type internal size %d"</span><span class='Delimiter'>, 
</span>                        <a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN218"><span class='Ref_to_Parameter'>passedByValue</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Pass-by-value types must have a fixed length that is one of the 
         * values supported by fetch_att() and store_att_byval(); and the 
         * alignment had better agree, too.  All this code must match 
         * access/tupmacs.h! 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>!= </span><span class='String'>'c'</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%c\" is invalid for passed-by-value type of size %d"</span><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>!= </span><span class='String'>'s'</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%c\" is invalid for passed-by-value type of size %d"</span><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>!= </span><span class='String'>'i'</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%c\" is invalid for passed-by-value type of size %d"</span><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#if</span> <a href="../../include/postgres.h.html#LN373"><span class='Ref_to_Const'>SIZEOF_DATUM</span></a> <span class='Operator'>== </span><span class='Number'>8</span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>!= </span><span class='String'>'d'</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%c\" is invalid for passed-by-value type of size %d"</span><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"internal size %d is invalid for passed-by-value type"</span><span class='Delimiter'>, 
</span>                      <a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if passedByValue &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* varlena types must have int align or better */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& !</span><span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>== </span><span class='String'>'i'</span> <span class='Operator'>|| </span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>== </span><span class='String'>'d'</span><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%c\" is invalid for variable-length type"</span><span class='Delimiter'>, 
</span>                      <a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* cstring must have char alignment */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>== -</span><span class='Number'>2</span> <span class='Operator'>&& !</span><span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a> <span class='Operator'>== </span><span class='String'>'c'</span><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"alignment \"%c\" is invalid for variable-length type"</span><span class='Delimiter'>, 
</span>                      <a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Only varlena types can be toasted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN220"><span class='Ref_to_Parameter'>storage</span></a> <span class='Operator'>!= </span><span class='String'>'p'</span> <span class='Operator'>&& </span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"fixed-size types must have storage PLAIN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize arrays needed for heap_form_tuple or heap_modify_tuple 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN234"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="pg_type.c.html#LN234"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../include/catalog/pg_type.h.html#LN238"><span class='Ref_to_Const'>Natts_pg_type</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="pg_type.c.html#LN234"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN230"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="pg_type.c.html#LN234"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN231"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="pg_type.c.html#LN234"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="pg_type.c.html#LN234"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * insert data values 
     */ 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN233"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN195"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN239"><span class='Ref_to_Const'>Anum_pg_type_typname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN233"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN240"><span class='Ref_to_Const'>Anum_pg_type_typnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN196"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN241"><span class='Ref_to_Const'>Anum_pg_type_typowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN199"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN242"><span class='Ref_to_Const'>Anum_pg_type_typlen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN200"><span class='Ref_to_Parameter'>internalSize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN243"><span class='Ref_to_Const'>Anum_pg_type_typbyval</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN218"><span class='Ref_to_Parameter'>passedByValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN244"><span class='Ref_to_Const'>Anum_pg_type_typtype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN201"><span class='Ref_to_Parameter'>typeType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN245"><span class='Ref_to_Const'>Anum_pg_type_typcategory</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN202"><span class='Ref_to_Parameter'>typeCategory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN246"><span class='Ref_to_Const'>Anum_pg_type_typispreferred</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN203"><span class='Ref_to_Parameter'>typePreferred</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN247"><span class='Ref_to_Const'>Anum_pg_type_typisdefined</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN248"><span class='Ref_to_Const'>Anum_pg_type_typdelim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN204"><span class='Ref_to_Parameter'>typDelim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN249"><span class='Ref_to_Const'>Anum_pg_type_typrelid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN197"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN250"><span class='Ref_to_Const'>Anum_pg_type_typelem</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN212"><span class='Ref_to_Parameter'>elementType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN251"><span class='Ref_to_Const'>Anum_pg_type_typarray</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN214"><span class='Ref_to_Parameter'>arrayType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN252"><span class='Ref_to_Const'>Anum_pg_type_typinput</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN205"><span class='Ref_to_Parameter'>inputProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN253"><span class='Ref_to_Const'>Anum_pg_type_typoutput</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN206"><span class='Ref_to_Parameter'>outputProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN254"><span class='Ref_to_Const'>Anum_pg_type_typreceive</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN207"><span class='Ref_to_Parameter'>receiveProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN255"><span class='Ref_to_Const'>Anum_pg_type_typsend</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN208"><span class='Ref_to_Parameter'>sendProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN256"><span class='Ref_to_Const'>Anum_pg_type_typmodin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN209"><span class='Ref_to_Parameter'>typmodinProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN257"><span class='Ref_to_Const'>Anum_pg_type_typmodout</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN210"><span class='Ref_to_Parameter'>typmodoutProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN258"><span class='Ref_to_Const'>Anum_pg_type_typanalyze</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN211"><span class='Ref_to_Parameter'>analyzeProcedure</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN259"><span class='Ref_to_Const'>Anum_pg_type_typalign</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN219"><span class='Ref_to_Parameter'>alignment</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN260"><span class='Ref_to_Const'>Anum_pg_type_typstorage</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN220"><span class='Ref_to_Parameter'>storage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN261"><span class='Ref_to_Const'>Anum_pg_type_typnotnull</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN223"><span class='Ref_to_Parameter'>typeNotNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN262"><span class='Ref_to_Const'>Anum_pg_type_typbasetype</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN215"><span class='Ref_to_Parameter'>baseType</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN263"><span class='Ref_to_Const'>Anum_pg_type_typtypmod</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN221"><span class='Ref_to_Parameter'>typeMod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN264"><span class='Ref_to_Const'>Anum_pg_type_typndims</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN222"><span class='Ref_to_Parameter'>typNDims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN265"><span class='Ref_to_Const'>Anum_pg_type_typcollation</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN224"><span class='Ref_to_Parameter'>typeCollation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the default binary value for this type.  Check for nulls of 
     * course. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN217"><span class='Ref_to_Parameter'>defaultTypeBin</span></a><span class='Parentheses'>) 
</span>        <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN217"><span class='Ref_to_Parameter'>defaultTypeBin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_type.c.html#LN230"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN266"><span class='Ref_to_Const'>Anum_pg_type_typdefaultbin</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the default value for this type. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN216"><span class='Ref_to_Parameter'>defaultTypeValue</span></a><span class='Parentheses'>) 
</span>        <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN216"><span class='Ref_to_Parameter'>defaultTypeValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_type.c.html#LN230"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN267"><span class='Ref_to_Const'>Anum_pg_type_typdefault</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="pg_type.c.html#LN235"><span class='Ref_To_Local'>typacl</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN212"><span class='Ref_to_Proto'>get_user_default_acl</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN199"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                                  <a href="pg_type.c.html#LN196"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN235"><span class='Ref_To_Local'>typacl</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN235"><span class='Ref_To_Local'>typacl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="pg_type.c.html#LN230"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_type.h.html#LN268"><span class='Ref_to_Const'>Anum_pg_type_typacl</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * open pg_type and prepare to insert or update a row. 
     * 
     * NOTE: updating will not work correctly in bootstrap mode; but we don't 
     * expect to be overwriting any shell types in bootstrap mode. 
     */ 
</span>    <a href="pg_type.c.html#LN226"><span class='Ref_To_Local'>pg_type_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN166"><span class='Ref_to_Macro'>SearchSysCacheCopy2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN195"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN196"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * check that the type is not already defined.  It may exist as a 
         * shell type, however. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>typisdefined<span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="pg_type.c.html#LN195"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * shell type must have been created by same owner 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>typowner <span class='Operator'>!= </span><a href="pg_type.c.html#LN199"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN186"><span class='Ref_to_EnumConst'>ACL_KIND_TYPE</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN195"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* trouble if caller wanted to force the OID */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN194"><span class='Ref_to_Parameter'>newTypeOid</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cannot assign new OID to existing shell type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Okay to update existing shell type tuple 
         */ 
</span>        <a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN226"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN230"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                <a href="pg_type.c.html#LN231"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN226"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_type.c.html#LN227"><span class='Ref_To_Local'>typeObjectId</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_type.c.html#LN228"><span class='Ref_To_Local'>rebuildDeps</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* get rid of shell type's dependencies */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(tup) &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN226"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="pg_type.c.html#LN232"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, 
</span>                              <a href="pg_type.c.html#LN230"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Force the OID if requested by caller */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN194"><span class='Ref_to_Parameter'>newTypeOid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN194"><span class='Ref_to_Parameter'>newTypeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Use binary-upgrade override for pg_type.oid, if supplied. */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN101"><span class='Ref_to_Global_Var'>IsBinaryUpgrade</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN39"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_type_oid</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_type OID value not set when in binary upgrade mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN39"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_type_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="pg_type.c.html#LN39"><span class='Ref_to_Global_Var'>binary_upgrade_next_pg_type_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* else allow system to assign oid */ 
</span> 
        <a href="pg_type.c.html#LN227"><span class='Ref_To_Local'>typeObjectId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN226"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN229"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Create dependencies.  We can/must skip this in bootstrap mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/catalog/pg_type_fn.h.html#LN56"><span class='Ref_to_Proto'>GenerateTypeDependencies</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN196"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN227"><span class='Ref_To_Local'>typeObjectId</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN197"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN198"><span class='Ref_to_Parameter'>relationKind</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN199"><span class='Ref_to_Parameter'>ownerId</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN205"><span class='Ref_to_Parameter'>inputProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN206"><span class='Ref_to_Parameter'>outputProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN207"><span class='Ref_to_Parameter'>receiveProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN208"><span class='Ref_to_Parameter'>sendProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN209"><span class='Ref_to_Parameter'>typmodinProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN210"><span class='Ref_to_Parameter'>typmodoutProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN211"><span class='Ref_to_Parameter'>analyzeProcedure</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN212"><span class='Ref_to_Parameter'>elementType</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN213"><span class='Ref_to_Parameter'>isImplicitArray</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN215"><span class='Ref_to_Parameter'>baseType</span></a><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN224"><span class='Ref_to_Parameter'>typeCollation</span></a><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="pg_type.c.html#LN217"><span class='Ref_to_Parameter'>defaultTypeBin</span></a> <span class='Operator'>? 
</span>                                  <a href="../nodes/read.c.html#LN36"><span class='Ref_to_Func'>stringToNode</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN217"><span class='Ref_to_Parameter'>defaultTypeBin</span></a><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                                  <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="pg_type.c.html#LN228"><span class='Ref_To_Local'>rebuildDeps</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new type */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN227"><span class='Ref_To_Local'>typeObjectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN236"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN227"><span class='Ref_To_Local'>typeObjectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * finish up 
     */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN226"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_type.c.html#LN236"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TypeCreate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GenerateTypeDependencies: build the dependencies needed for a type 
 * 
 * If rebuild is true, we remove existing dependencies and rebuild them 
 * from scratch.  This is needed for ALTER TYPE, and also when replacing 
 * a shell type.  We don't remove an existing extension dependency, though. 
 * (That means an extension can't absorb a shell type created in another 
 * extension, nor ALTER a type created by another extension.  Also, if it 
 * replaces a free-standing shell type or ALTERs a free-standing type, 
 * that type will become a member of the extension.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN511"></a><span class='Declare_Function'>GenerateTypeDependencies</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeNamespace</span><span class='Delimiter'>, 
</span><a name="LN512"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeObjectId</span><span class='Delimiter'>, 
</span><a name="LN513"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relationOid</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* only for relation rowtypes */ 
</span><a name="LN514"></a>                         <span class='Keyword'>char </span><span class='Declare_Parameter'>relationKind</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* ditto */ 
</span><a name="LN515"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>owner</span><span class='Delimiter'>, 
</span><a name="LN516"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>inputProcedure</span><span class='Delimiter'>, 
</span><a name="LN517"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>outputProcedure</span><span class='Delimiter'>, 
</span><a name="LN518"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>receiveProcedure</span><span class='Delimiter'>, 
</span><a name="LN519"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>sendProcedure</span><span class='Delimiter'>, 
</span><a name="LN520"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typmodinProcedure</span><span class='Delimiter'>, 
</span><a name="LN521"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typmodoutProcedure</span><span class='Delimiter'>, 
</span><a name="LN522"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>analyzeProcedure</span><span class='Delimiter'>, 
</span><a name="LN523"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>elementType</span><span class='Delimiter'>, 
</span><a name="LN524"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>isImplicitArray</span><span class='Delimiter'>, 
</span><a name="LN525"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>baseType</span><span class='Delimiter'>, 
</span><a name="LN526"></a>                         <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeCollation</span><span class='Delimiter'>, 
</span><a name="LN527"></a>                         <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>defaultExpr</span><span class='Delimiter'>, 
</span><a name="LN528"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>rebuild</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN530"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN531"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If rebuild, first flush old dependencies, except extension deps */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN528"><span class='Ref_to_Parameter'>rebuild</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_depend.c.html#LN189"><span class='Ref_to_Func'>deleteDependencyRecordsFor</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN512"><span class='Ref_to_Parameter'>typeObjectId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/catalog/dependency.h.html#LN254"><span class='Ref_to_Proto'>deleteSharedDependencyRecordsFor</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN512"><span class='Ref_to_Parameter'>typeObjectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN512"><span class='Ref_to_Parameter'>typeObjectId</span></a><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make dependencies on namespace, owner, extension. 
     * 
     * For a relation rowtype (that's not a composite type), we should skip 
     * these because we'll depend on them indirectly through the pg_class 
     * entry.  Likewise, skip for implicit arrays since we'll depend on them 
     * through the element type. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN513"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="pg_type.c.html#LN514"><span class='Ref_to_Parameter'>relationKind</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="pg_type.c.html#LN524"><span class='Ref_to_Parameter'>isImplicitArray</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN511"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN512"><span class='Ref_to_Parameter'>typeObjectId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN515"><span class='Ref_to_Parameter'>owner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN528"><span class='Ref_to_Parameter'>rebuild</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Normal dependencies on the I/O functions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN516"><span class='Ref_to_Parameter'>inputProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN516"><span class='Ref_to_Parameter'>inputProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN517"><span class='Ref_to_Parameter'>outputProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN517"><span class='Ref_to_Parameter'>outputProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN518"><span class='Ref_to_Parameter'>receiveProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN518"><span class='Ref_to_Parameter'>receiveProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN519"><span class='Ref_to_Parameter'>sendProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN519"><span class='Ref_to_Parameter'>sendProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN520"><span class='Ref_to_Parameter'>typmodinProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN520"><span class='Ref_to_Parameter'>typmodinProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN521"><span class='Ref_to_Parameter'>typmodoutProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN521"><span class='Ref_to_Parameter'>typmodoutProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN522"><span class='Ref_to_Parameter'>analyzeProcedure</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN522"><span class='Ref_to_Parameter'>analyzeProcedure</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the type is a rowtype for a relation, mark it as internally 
     * dependent on the relation, *unless* it is a stand-alone composite type 
     * relation. For the latter case, we have to reverse the dependency. 
     * 
     * In the former case, this allows the type to be auto-dropped when the 
     * relation is, and not otherwise. And in the latter, of course we get the 
     * opposite effect. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN513"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN513"><span class='Ref_to_Parameter'>relationOid</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN514"><span class='Ref_to_Parameter'>relationKind</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN165"><span class='Ref_to_Const'>RELKIND_COMPOSITE_TYPE</span></a><span class='Parentheses'>) 
</span>            <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the type is an implicitly-created array type, mark it as internally 
     * dependent on the element type.  Otherwise, if it has an element type, 
     * the dependency is a normal one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN523"><span class='Ref_to_Parameter'>elementType</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN523"><span class='Ref_to_Parameter'>elementType</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, 
</span>                  <a href="pg_type.c.html#LN524"><span class='Ref_to_Parameter'>isImplicitArray</span></a> <span class='Operator'>? </span><a href="../../include/catalog/dependency.h.html#LN76"><span class='Ref_to_EnumConst'>DEPENDENCY_INTERNAL</span></a> <span class='Operator'>: </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Normal dependency from a domain to its base type. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN525"><span class='Ref_to_Parameter'>baseType</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN525"><span class='Ref_to_Parameter'>baseType</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Normal dependency from a domain to its collation. */ 
</span>    <span class='Comment_Multi_Line'>/* We know the default collation is pinned, so don't bother recording it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN526"><span class='Ref_to_Parameter'>typeCollation</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="pg_type.c.html#LN526"><span class='Ref_to_Parameter'>typeCollation</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN526"><span class='Ref_to_Parameter'>typeCollation</span></a><span class='Delimiter'>; 
</span>        <a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN531"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Normal dependency on the default expression. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN527"><span class='Ref_to_Parameter'>defaultExpr</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/catalog/dependency.h.html#LN188"><span class='Ref_to_Proto'>recordDependencyOnExpr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="pg_type.c.html#LN530"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN527"><span class='Ref_to_Parameter'>defaultExpr</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GenerateTypeDependencies &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RenameTypeInternal 
 *      This renames a type, as well as any associated array type. 
 * 
 * Caller must have already checked privileges. 
 * 
 * Currently this is used for renaming table rowtypes and for 
 * ALTER TYPE RENAME TO command. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN691"></a><span class='Declare_Function'>RenameTypeInternal</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newTypeName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeNamespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN693"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_type_desc</span><span class='Delimiter'>; 
</span><a name="LN694"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN695"></a>    <a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typ</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arrayOid</span><span class='Delimiter'>; 
</span><a name="LN697"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldTypeOid</span><span class='Delimiter'>; 
</span> 
    <a href="pg_type.c.html#LN693"><span class='Ref_To_Local'>pg_type_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_type.c.html#LN694"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN694"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="pg_type.c.html#LN695"><span class='Ref_To_Local'>typ</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN694"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We are not supposed to be changing schemas here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeNamespace</span></a> <span class='Operator'>== </span><a href="pg_type.c.html#LN695"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="pg_type.c.html#LN696"><span class='Ref_To_Local'>arrayOid</span></a> <span class='Operator'>= </span><a href="pg_type.c.html#LN695"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typarray<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for a conflicting type name. */ 
</span>    <a href="pg_type.c.html#LN697"><span class='Ref_To_Local'>oldTypeOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN184"><span class='Ref_to_Macro'>GetSysCacheOid2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>newTypeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there is one, see if it's an autogenerated array type, and if so 
     * rename it out of the way.  (But we must skip that for a shell type 
     * because moveArrayTypeName will do the wrong thing in that case.) 
     * Otherwise, we can at least give a more friendly error than unique-index 
     * violation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN697"><span class='Ref_To_Local'>oldTypeOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN132"><span class='Ref_to_Proto'>get_typisdefined</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN697"><span class='Ref_To_Local'>oldTypeOid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../include/catalog/pg_type_fn.h.html#LN80"><span class='Ref_to_Proto'>moveArrayTypeName</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN697"><span class='Ref_To_Local'>oldTypeOid</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>newTypeName</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>))</span> 
             <span class='Comment_Multi_Line'>/* successfully dodged the problem */ </span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"type \"%s\" already exists"</span><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>newTypeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* OK, do the rename --- tuple is a copy, so OK to scribble on it */ 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="pg_type.c.html#LN695"><span class='Ref_To_Local'>typ</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>newTypeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN693"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="pg_type.c.html#LN694"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN694"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN694"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN693"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the type has an array type, recurse to handle that.  But we don't 
     * need to do anything more if we already renamed that array type above 
     * (which would happen when, eg, renaming "foo" to "_foo"). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN696"><span class='Ref_To_Local'>arrayOid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="pg_type.c.html#LN696"><span class='Ref_To_Local'>arrayOid</span></a> <span class='Operator'>!= </span><a href="pg_type.c.html#LN697"><span class='Ref_To_Local'>oldTypeOid</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN751"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arrname</span> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN78"><span class='Ref_to_Proto'>makeArrayTypeName</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>newTypeName</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/pg_type_fn.h.html#LN75"><span class='Ref_to_Proto'>RenameTypeInternal</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN696"><span class='Ref_To_Local'>arrayOid</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN751"><span class='Ref_To_Local'>arrname</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN691"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN751"><span class='Ref_To_Local'>arrname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end RenameTypeInternal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * makeArrayTypeName 
 *    - given a base type name, make an array type name for it 
 * 
 * the caller is responsible for pfreeing the result 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN766"></a><span class='Declare_Function'>makeArrayTypeName</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>typeName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeNamespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN768"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>arr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN769"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>namelen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="pg_type.c.html#LN766"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN770"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>pg_type_desc</span><span class='Delimiter'>; 
</span><a name="LN771"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The idea is to prepend underscores as needed until we make a name that 
     * doesn't collide with anything... 
     */ 
</span>    <a href="pg_type.c.html#LN770"><span class='Ref_To_Local'>pg_type_desc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_type.h.html#LN33"><span class='Ref_to_Const'>TypeRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="pg_type.c.html#LN768"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>[</span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'_'</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><a href="pg_type.c.html#LN769"><span class='Ref_To_Local'>namelen</span></a> <span class='Operator'>&LT; </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>) 
</span>            <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN768"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>+ </span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN766"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            memcpy<span class='Parentheses'>(</span><a href="pg_type.c.html#LN768"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>+ </span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN766"><span class='Ref_to_Parameter'>typeName</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>- </span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/parser/scansup.h.html#LN25"><span class='Ref_to_Proto'>truncate_identifier</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN768"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/syscache.h.html#LN175"><span class='Ref_to_Macro'>SearchSysCacheExists2</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN106"><span class='Ref_to_EnumConst'>TYPENAMENSP</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN768"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN766"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN770"><span class='Ref_To_Local'>pg_type_desc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="pg_type.c.html#LN771"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not form array type name for type \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="pg_type.c.html#LN766"><span class='Ref_to_Parameter'>typeName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="pg_type.c.html#LN768"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeArrayTypeName &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * moveArrayTypeName 
 *    - try to reassign an array type name that the user wants to use. 
 * 
 * The given type name has been discovered to already exist (with the given 
 * OID).  If it is an autogenerated array type, change the array type's name 
 * to not conflict.  This allows the user to create type "foo" followed by 
 * type "_foo" without problems.  (Of course, there are race conditions if 
 * two backends try to create similarly-named types concurrently, but the 
 * worst that can happen is an unnecessary failure --- anything we do here 
 * will be rolled back if the type creation fails due to conflicting names.) 
 * 
 * Note that this must be called *before* calling makeArrayTypeName to 
 * determine the new type's own array type name; else the latter will 
 * certainly pick the same name. 
 * 
 * Returns TRUE if successfully moved the type, FALSE if not. 
 * 
 * We also return TRUE if the given type is a shell type.  In this case 
 * the type has not been renamed out of the way, but nonetheless it can 
 * be expected that TypeCreate will succeed.  This behavior is convenient 
 * for most callers --- those that need to distinguish the shell-type case 
 * must do their own typisdefined test. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN832"></a><span class='Declare_Function'>moveArrayTypeName</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeOid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>typeName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeNamespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN834"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elemOid</span><span class='Delimiter'>; 
</span><a name="LN835"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>newname</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need do nothing if it's a shell type. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/lsyscache.h.html#LN132"><span class='Ref_to_Proto'>get_typisdefined</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't change it if it's not an autogenerated array type. */ 
</span>    <a href="pg_type.c.html#LN834"><span class='Ref_To_Local'>elemOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN834"><span class='Ref_To_Local'>elemOid</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../include/utils/lsyscache.h.html#LN158"><span class='Ref_to_Proto'>get_array_type</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN834"><span class='Ref_To_Local'>elemOid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, use makeArrayTypeName to pick an unused modification of the name. 
     * Note that since makeArrayTypeName is an iterative process, this will 
     * produce a name that it might have produced the first time, had the 
     * conflicting type we are about to create already existed. 
     */ 
</span>    <a href="pg_type.c.html#LN835"><span class='Ref_To_Local'>newname</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_type_fn.h.html#LN78"><span class='Ref_to_Proto'>makeArrayTypeName</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeName</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Apply the rename */ 
</span>    <a href="../../include/catalog/pg_type_fn.h.html#LN75"><span class='Ref_to_Proto'>RenameTypeInternal</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeOid</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN835"><span class='Ref_To_Local'>newname</span></a><span class='Delimiter'>, </span><a href="pg_type.c.html#LN832"><span class='Ref_to_Parameter'>typeNamespace</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must bump the command counter so that any subsequent use of 
     * makeArrayTypeName sees what we just did and doesn't pick the same name. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="pg_type.c.html#LN835"><span class='Ref_To_Local'>newname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end moveArrayTypeName &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>