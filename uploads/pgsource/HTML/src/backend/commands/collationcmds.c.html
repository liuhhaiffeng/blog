<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\collationcmds.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\collationcmds.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:34 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * collationcmds.c 
 *    collation-related commands support code 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/collationcmds.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation_fn.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/alter.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/collationcmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/comment.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/pg_locale.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * CREATE COLLATION 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN43"></a><span class='Declare_Function'>DefineCollation</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>names</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parameters</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>if_not_exists</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN45"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collName</span><span class='Delimiter'>; 
</span><a name="LN46"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collNamespace</span><span class='Delimiter'>; 
</span><a name="LN47"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>pl</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>fromEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>localeEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN51"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>lccollateEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN52"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>lcctypeEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN53"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>providerEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN54"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>versionEl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collcollate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collctype</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collproviderstr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN58"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>collencoding</span><span class='Delimiter'>; 
</span><a name="LN59"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>collprovider</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN60"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collversion</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN61"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>newoid</span><span class='Delimiter'>; 
</span><a name="LN62"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN46"><span class='Ref_To_Local'>collNamespace</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN118"><span class='Ref_to_Proto'>QualifiedNameGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN43"><span class='Ref_to_Parameter'>names</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN45"><span class='Ref_To_Local'>collName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN47"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN46"><span class='Ref_To_Local'>collNamespace</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN47"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN47"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN46"><span class='Ref_To_Local'>collNamespace</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN48"><span class='Ref_To_Local'>pl</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN43"><span class='Ref_to_Parameter'>parameters</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN73"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN48"><span class='Ref_To_Local'>pl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>   <span class='Operator'>**</span><span class='Declare_Local'>defelp</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"from"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="collationcmds.c.html#LN49"><span class='Ref_To_Local'>fromEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"locale"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="collationcmds.c.html#LN50"><span class='Ref_To_Local'>localeEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"lc_collate"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="collationcmds.c.html#LN51"><span class='Ref_To_Local'>lccollateEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"lc_ctype"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="collationcmds.c.html#LN52"><span class='Ref_To_Local'>lcctypeEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"provider"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="collationcmds.c.html#LN53"><span class='Ref_To_Local'>providerEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= &</span><a href="collationcmds.c.html#LN54"><span class='Ref_To_Local'>versionEl</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation attribute \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                            <a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN43"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Operator'>*</span><a href="collationcmds.c.html#LN74"><span class='Ref_To_Local'>defelp</span></a> <span class='Operator'>= </span><a href="collationcmds.c.html#LN73"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="collationcmds.c.html#LN50"><span class='Ref_To_Local'>localeEl</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN51"><span class='Ref_To_Local'>lccollateEl</span></a> <span class='Operator'>|| </span><a href="collationcmds.c.html#LN52"><span class='Ref_To_Local'>lcctypeEl</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN49"><span class='Ref_To_Local'>fromEl</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN43"><span class='Ref_to_Parameter'>parameters</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN49"><span class='Ref_To_Local'>fromEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN109"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collid</span><span class='Delimiter'>; 
</span><a name="LN110"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span> 
        <a href="collationcmds.c.html#LN109"><span class='Ref_To_Local'>collid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN142"><span class='Ref_to_Proto'>get_collation_oid</span></a><span class='Parentheses'>(</span><a href="../../include/commands/defrem.h.html#LN161"><span class='Ref_to_Proto'>defGetQualifiedName</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN49"><span class='Ref_To_Local'>fromEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="collationcmds.c.html#LN110"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN49"><span class='Ref_to_EnumConst'>COLLOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN109"><span class='Ref_To_Local'>collid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN110"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for collation %u"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN109"><span class='Ref_To_Local'>collid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN110"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>collcollate<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="collationcmds.c.html#LN56"><span class='Ref_To_Local'>collctype</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN110"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>collctype<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN110"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>collprovider<span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN110"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Copying the "default" collation is not allowed because most code 
         * checks for DEFAULT_COLLATION_OID instead of COLLPROVIDER_DEFAULT, 
         * and so having a second collation with COLLPROVIDER_DEFAULT would 
         * not work and potentially confuse or crash some code.  This could be 
         * fixed with some legwork. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_collation.h.html#LN83"><span class='Ref_to_Const'>COLLPROVIDER_DEFAULT</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation \"default\" cannot be copied"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fromEl &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN50"><span class='Ref_To_Local'>localeEl</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN50"><span class='Ref_To_Local'>localeEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="collationcmds.c.html#LN56"><span class='Ref_To_Local'>collctype</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN50"><span class='Ref_To_Local'>localeEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN51"><span class='Ref_To_Local'>lccollateEl</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN51"><span class='Ref_To_Local'>lccollateEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN52"><span class='Ref_To_Local'>lcctypeEl</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN56"><span class='Ref_To_Local'>collctype</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN52"><span class='Ref_To_Local'>lcctypeEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN53"><span class='Ref_To_Local'>providerEl</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN57"><span class='Ref_To_Local'>collproviderstr</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN53"><span class='Ref_To_Local'>providerEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN54"><span class='Ref_To_Local'>versionEl</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN60"><span class='Ref_To_Local'>collversion</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN54"><span class='Ref_To_Local'>versionEl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN57"><span class='Ref_To_Local'>collproviderstr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN57"><span class='Ref_To_Local'>collproviderstr</span></a><span class='Delimiter'>, </span><span class='String'>"icu"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN57"><span class='Ref_To_Local'>collproviderstr</span></a><span class='Delimiter'>, </span><span class='String'>"libc"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized collation provider: %s"</span><span class='Delimiter'>, 
</span>                            <a href="collationcmds.c.html#LN57"><span class='Ref_To_Local'>collproviderstr</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="collationcmds.c.html#LN49"><span class='Ref_To_Local'>fromEl</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"lc_collate\" must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="collationcmds.c.html#LN56"><span class='Ref_To_Local'>collctype</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"lc_ctype\" must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN58"><span class='Ref_To_Local'>collencoding</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="collationcmds.c.html#LN58"><span class='Ref_To_Local'>collencoding</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../include/commands/dbcommands.h.html#LN31"><span class='Ref_to_Proto'>check_encoding_locale_matches</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN58"><span class='Ref_To_Local'>collencoding</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN56"><span class='Ref_To_Local'>collctype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="collationcmds.c.html#LN60"><span class='Ref_To_Local'>collversion</span></a><span class='Parentheses'>) 
</span>        <a href="collationcmds.c.html#LN60"><span class='Ref_To_Local'>collversion</span></a> <span class='Operator'>= </span><a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN61"><span class='Ref_To_Local'>newoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation_fn.h.html#LN16"><span class='Ref_to_Proto'>CollationCreate</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN45"><span class='Ref_To_Local'>collName</span></a><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN46"><span class='Ref_To_Local'>collNamespace</span></a><span class='Delimiter'>, 
</span>                             <a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN59"><span class='Ref_To_Local'>collprovider</span></a><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN58"><span class='Ref_To_Local'>collencoding</span></a><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN55"><span class='Ref_To_Local'>collcollate</span></a><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN56"><span class='Ref_To_Local'>collctype</span></a><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN60"><span class='Ref_To_Local'>collversion</span></a><span class='Delimiter'>, 
</span>                             <a href="collationcmds.c.html#LN43"><span class='Ref_to_Parameter'>if_not_exists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN61"><span class='Ref_To_Local'>newoid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN62"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN61"><span class='Ref_To_Local'>newoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check that the locales can be loaded */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/pg_locale.h.html#LN89"><span class='Ref_to_Proto'>pg_newlocale_from_collation</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN61"><span class='Ref_To_Local'>newoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="collationcmds.c.html#LN62"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DefineCollation &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine for ALTER COLLATION SET SCHEMA and RENAME 
 * 
 * Is there a collation with the same name of the given collation already in 
 * the given namespace?  If so, raise an appropriate error message. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN219"></a><span class='Declare_Function'>IsThereCollationInNamespace</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>collname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* make sure the name doesn't already exist in new schema */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN177"><span class='Ref_to_Macro'>SearchSysCacheExists3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN48"><span class='Ref_to_EnumConst'>COLLNAMEENCNSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>collname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation \"%s\" for encoding \"%s\" already exists in schema \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>collname</span></a><span class='Delimiter'>, </span><a href="../../include/mb/pg_wchar.h.html#LN546"><span class='Ref_to_Proto'>GetDatabaseEncodingName</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                        <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* mustn't match an any-encoding entry, either */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN177"><span class='Ref_to_Macro'>SearchSysCacheExists3</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN48"><span class='Ref_to_EnumConst'>COLLNAMEENCNSP</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>collname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>)))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation \"%s\" already exists in schema \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>collname</span></a><span class='Delimiter'>, </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN219"><span class='Ref_to_Parameter'>nspOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end IsThereCollationInNamespace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ALTER COLLATION 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN247"></a><span class='Declare_Function'>AlterCollation</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1767"><span class='Ref_to_Struct'>AlterCollationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN249"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN250"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collOid</span><span class='Delimiter'>; 
</span><a name="LN251"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN252"></a>    <a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a> <span class='Declare_Local'>collForm</span><span class='Delimiter'>; 
</span><a name="LN253"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>collversion</span><span class='Delimiter'>; 
</span><a name="LN254"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN255"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldversion</span><span class='Delimiter'>; 
</span><a name="LN256"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>newversion</span><span class='Delimiter'>; 
</span><a name="LN257"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN249"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="collationcmds.c.html#LN250"><span class='Ref_To_Local'>collOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN142"><span class='Ref_to_Proto'>get_collation_oid</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN247"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1770"><span class='Ref_to_Member'>collname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN319"><span class='Ref_to_Proto'>pg_collation_ownercheck</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN250"><span class='Ref_To_Local'>collOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN192"><span class='Ref_to_EnumConst'>ACL_KIND_COLLATION</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN247"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1770"><span class='Ref_to_Member'>collname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN49"><span class='Ref_to_EnumConst'>COLLOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN250"><span class='Ref_To_Local'>collOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for collation %u"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN250"><span class='Ref_To_Local'>collOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN252"><span class='Ref_To_Local'>collForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="collationcmds.c.html#LN253"><span class='Ref_To_Local'>collversion</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN133"><span class='Ref_to_Proto'>SysCacheGetAttr</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN49"><span class='Ref_to_EnumConst'>COLLOID</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_collation_collversion</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="collationcmds.c.html#LN254"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="collationcmds.c.html#LN255"><span class='Ref_To_Local'>oldversion</span></a> <span class='Operator'>= </span><a href="collationcmds.c.html#LN254"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><a href="../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN253"><span class='Ref_To_Local'>collversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a> <span class='Operator'>= </span><a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN252"><span class='Ref_To_Local'>collForm</span></a><span class='Operator'>-&GT;</span>collprovider<span class='Delimiter'>, </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN252"><span class='Ref_To_Local'>collForm</span></a><span class='Operator'>-&GT;</span>collcollate<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot change from NULL to non-NULL or vice versa */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="collationcmds.c.html#LN255"><span class='Ref_To_Local'>oldversion</span></a> <span class='Operator'>&& </span><a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN255"><span class='Ref_To_Local'>oldversion</span></a> <span class='Operator'>&& !</span><a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid collation version change"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN255"><span class='Ref_To_Local'>oldversion</span></a> <span class='Operator'>&& </span><a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN255"><span class='Ref_To_Local'>oldversion</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN282"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_collation.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_collation</span></a><span class='Delimiter'>]; 
</span><a name="LN283"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>replaces</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_collation.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_collation</span></a><span class='Delimiter'>]; 
</span><a name="LN284"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_collation.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_collation</span></a><span class='Delimiter'>]; 
</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"changing version from %s to %s"</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN255"><span class='Ref_To_Local'>oldversion</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN284"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN284"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN282"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN282"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN283"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN283"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="collationcmds.c.html#LN284"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_collation.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_collation_collversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN256"><span class='Ref_To_Local'>newversion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="collationcmds.c.html#LN283"><span class='Ref_To_Local'>replaces</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_collation.h.html#LN65"><span class='Ref_to_Const'>Anum_pg_collation_collversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN249"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="collationcmds.c.html#LN284"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN282"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN283"><span class='Ref_To_Local'>replaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if oldversion&&newversio... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"version has not changed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN249"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN250"><span class='Ref_To_Local'>collOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN257"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN250"><span class='Ref_To_Local'>collOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN251"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN249"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="collationcmds.c.html#LN257"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterCollation &raquo; </span> 
 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN318"></a><span class='Declare_Function'>pg_collation_actual_version</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN320"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN322"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>collcollate</span><span class='Delimiter'>; 
</span><a name="LN323"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>collprovider</span><span class='Delimiter'>; 
</span><a name="LN324"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>version</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN321"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN49"><span class='Ref_to_EnumConst'>COLLOID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN320"><span class='Ref_To_Local'>collid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN321"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN320"><span class='Ref_To_Local'>collid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN322"><span class='Ref_To_Local'>collcollate</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN321"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>collcollate<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="collationcmds.c.html#LN323"><span class='Ref_To_Local'>collprovider</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_collation.h.html#LN51"><span class='Ref_to_Typedef'>Form_pg_collation</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN321"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>collprovider<span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN321"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN324"><span class='Ref_To_Local'>version</span></a> <span class='Operator'>= </span><a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN323"><span class='Ref_To_Local'>collprovider</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN322"><span class='Ref_To_Local'>collcollate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN324"><span class='Ref_To_Local'>version</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN324"><span class='Ref_To_Local'>version</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_collation_actual_version &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * "Normalize" a libc locale name, stripping off encoding tags such as 
 * ".utf8" (e.g., "en_US.utf8" -&GT; "en_US", but "br_FR.iso885915@euro" 
 * -&GT; "br_FR@euro").  Return true if a new, different name was 
 * generated. 
 */ 
</span><a name="LN352"></a><span class='Declare_Function'>pg_attribute_unused</span><span class='Parentheses'>() 
</span><span class='Keyword'>static bool 
</span>normalize_libc_locale_name<span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Control'>new</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN70"><span class='Ref_to_Global_Var'>old</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN356"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>n</span> <span class='Operator'>= </span><span class='Control'>new</span><span class='Delimiter'>; 
</span><a name="LN357"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>o</span> <span class='Operator'>= </span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN70"><span class='Ref_to_Global_Var'>old</span></a><span class='Delimiter'>; 
</span><a name="LN358"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>changed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* skip over encoding tag such as ".utf8" or ".UTF-8" */ 
</span>            <a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>&GT;= </span><span class='String'>'A'</span> <span class='Operator'>&& *</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>&LT;= </span><span class='String'>'Z'</span><span class='Parentheses'>) 
</span>                   <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>&GT;= </span><span class='String'>'a'</span> <span class='Operator'>&& *</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>&LT;= </span><span class='String'>'z'</span><span class='Parentheses'>) 
</span>                   <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>                   <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>))</span> 
                <a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="collationcmds.c.html#LN358"><span class='Ref_To_Local'>changed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Operator'>*</span><a href="collationcmds.c.html#LN356"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++ = *</span><a href="collationcmds.c.html#LN357"><span class='Ref_To_Local'>o</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="collationcmds.c.html#LN356"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="collationcmds.c.html#LN358"><span class='Ref_To_Local'>changed</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_attribute_unused &raquo; </span> 
 
 
<span class='Directive'>#ifdef</span> USE_ICU 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN384"></a><span class='Declare_Function'>get_icu_language_tag</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>localename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN386"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span>ULOC_FULLNAME_CAPACITY<span class='Delimiter'>]; 
</span><a name="LN387"></a>    UErrorCode  <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN387"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>    uloc_toLanguageTag<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN384"><span class='Ref_to_Parameter'>localename</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN386"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN386"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN387"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN387"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>          <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert locale name \"%s\" to language tag: %s"</span><span class='Delimiter'>, 
</span>                  <a href="collationcmds.c.html#LN384"><span class='Ref_to_Parameter'>localename</span></a><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN387"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN386"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN401"></a><span class='Declare_Function'>get_icu_locale_comment</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>localename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN403"></a>    UErrorCode  <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN404"></a>    UChar       <span class='Declare_Local'>displayname</span><span class='Delimiter'>[</span><span class='Number'>128</span><span class='Delimiter'>]; 
</span><a name="LN405"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>len_uchar</span><span class='Delimiter'>; 
</span><a name="LN406"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="collationcmds.c.html#LN403"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>    <a href="collationcmds.c.html#LN405"><span class='Ref_To_Local'>len_uchar</span></a> <span class='Operator'>= </span>uloc_getDisplayName<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN401"><span class='Ref_to_Parameter'>localename</span></a><span class='Delimiter'>, </span><span class='String'>"en"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN404"><span class='Ref_To_Local'>displayname</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN404"><span class='Ref_To_Local'>displayname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN403"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN403"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could get display name for locale \"%s\": %s"</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN401"><span class='Ref_to_Parameter'>localename</span></a><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN403"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/pg_locale.h.html#LN95"><span class='Ref_to_Proto'>icu_from_uchar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="collationcmds.c.html#LN406"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN404"><span class='Ref_To_Local'>displayname</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN405"><span class='Ref_To_Local'>len_uchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="collationcmds.c.html#LN406"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_ICU */ 
</span> 
 
<a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN423"></a><span class='Declare_Function'>pg_import_system_collations</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN425"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>if_not_exists</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN426"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_LOCALE_T<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>) 
</span><a name="LN429"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>locale_a_handle</span><span class='Delimiter'>; 
</span><a name="LN430"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>localebuf</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* we assume ASCII so this is fine */ 
</span><a name="LN431"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN432"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>aliaslist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN433"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>localelist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN434"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>enclist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN435"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lca</span><span class='Delimiter'>, 
</span><a name="LN436"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lcl</span><span class='Delimiter'>, 
</span><a name="LN437"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lce</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to import system collations"</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <span class='Operator'>!</span><span class='Parentheses'>(</span>defined<span class='Parentheses'>(</span>HAVE_LOCALE_T<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span>USE_ICU<span class='Parentheses'>) 
</span>    <span class='Comment_Multi_Line'>/* silence compiler warnings */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="collationcmds.c.html#LN425"><span class='Ref_To_Local'>if_not_exists</span></a><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="collationcmds.c.html#LN426"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> defined<span class='Parentheses'>(</span>HAVE_LOCALE_T<span class='Parentheses'>) </span><span class='Operator'>&& !</span>defined<span class='Parentheses'>(</span><a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a><span class='Parentheses'>) 
</span>    <a href="collationcmds.c.html#LN429"><span class='Ref_To_Local'>locale_a_handle</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN87"><span class='Ref_to_Proto'>OpenPipeStream</span></a><span class='Parentheses'>(</span><span class='String'>"locale -a"</span><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN429"><span class='Ref_To_Local'>locale_a_handle</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not execute command \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <span class='String'>"locale -a"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span>fgets<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN429"><span class='Ref_To_Local'>locale_a_handle</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN461"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN462"></a>        size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN463"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>enc</span><span class='Delimiter'>; 
</span><a name="LN464"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip</span><span class='Delimiter'>; 
</span><a name="LN465"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>alias</span><span class='Delimiter'>[</span><a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>]; 
</span> 
        <a href="collationcmds.c.html#LN462"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN462"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>[</span><a href="collationcmds.c.html#LN462"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"locale name too long, skipped: \"%s\""</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>[</span><a href="collationcmds.c.html#LN462"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Some systems have locale names that don't consist entirely of ASCII 
         * letters (such as "bokm&aring;l" or "fran&ccedil;ais").  This is 
         * pretty silly, since we need the locale itself to interpret the 
         * non-ASCII characters. We can't do much with those, so we filter 
         * them out. 
         */ 
</span>        <a href="collationcmds.c.html#LN464"><span class='Ref_To_Local'>skip</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN461"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="collationcmds.c.html#LN461"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="collationcmds.c.html#LN462"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; </span><a href="collationcmds.c.html#LN461"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>[</span><a href="collationcmds.c.html#LN461"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="collationcmds.c.html#LN464"><span class='Ref_To_Local'>skip</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN464"><span class='Ref_To_Local'>skip</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"locale name has non-ASCII characters, skipped: \"%s\""</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="collationcmds.c.html#LN463"><span class='Ref_To_Local'>enc</span></a> <span class='Operator'>= </span><a href="../../port/chklocale.c.html#LN309"><span class='Ref_to_Func'>pg_get_encoding_from_locale</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN463"><span class='Ref_To_Local'>enc</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* error message printed by pg_get_encoding_from_locale() */ 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/mb/pg_wchar.h.html#LN292"><span class='Ref_to_Macro'>PG_VALID_BE_ENCODING</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN463"><span class='Ref_To_Local'>enc</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore locales for client-only encodings */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN463"><span class='Ref_To_Local'>enc</span></a> <span class='Operator'>== </span><a href="../../include/mb/pg_wchar.h.html#LN237"><span class='Ref_to_EnumConst'>PG_SQL_ASCII</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* C/POSIX are already in the catalog */ 
</span> 
        <a href="collationcmds.c.html#LN431"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/pg_collation_fn.h.html#LN16"><span class='Ref_to_Proto'>CollationCreate</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN426"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN463"><span class='Ref_To_Local'>enc</span></a><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Delimiter'>, 
</span>                  <a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN425"><span class='Ref_To_Local'>if_not_exists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Generate aliases such as "en_US" in addition to "en_US.utf8" for 
         * ease of use.  Note that collation names are unique per encoding 
         * only, so this doesn't clash with "en_US" for LATIN1, say. 
         * 
         * However, it might conflict with a name we'll see later in the 
         * "locale -a" output.  So save up the aliases and try to add them 
         * after we've read all the output. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>normalize_libc_locale_name<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN465"><span class='Ref_To_Local'>alias</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="collationcmds.c.html#LN432"><span class='Ref_To_Local'>aliaslist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN432"><span class='Ref_To_Local'>aliaslist</span></a><span class='Delimiter'>, </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN465"><span class='Ref_To_Local'>alias</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="collationcmds.c.html#LN433"><span class='Ref_To_Local'>localelist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN433"><span class='Ref_To_Local'>localelist</span></a><span class='Delimiter'>, </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN430"><span class='Ref_To_Local'>localebuf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="collationcmds.c.html#LN434"><span class='Ref_To_Local'>enclist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN434"><span class='Ref_To_Local'>enclist</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN463"><span class='Ref_To_Local'>enc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while fgets(localebuf,sizeo... &raquo; </span> 
 
    <a href="../../include/storage/fd.h.html#LN88"><span class='Ref_to_Proto'>ClosePipeStream</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN429"><span class='Ref_To_Local'>locale_a_handle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now try to add any aliases we created */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN202"><span class='Ref_to_Macro'>forthree</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN435"><span class='Ref_To_Local'>lca</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN432"><span class='Ref_To_Local'>aliaslist</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN436"><span class='Ref_To_Local'>lcl</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN433"><span class='Ref_To_Local'>localelist</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN437"><span class='Ref_To_Local'>lce</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN434"><span class='Ref_To_Local'>enclist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN540"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>alias</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN435"><span class='Ref_To_Local'>lca</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN541"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>locale</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN436"><span class='Ref_To_Local'>lcl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN542"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>enc</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN437"><span class='Ref_To_Local'>lce</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/pg_collation_fn.h.html#LN16"><span class='Ref_to_Proto'>CollationCreate</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN540"><span class='Ref_To_Local'>alias</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN426"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN542"><span class='Ref_To_Local'>enc</span></a><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN541"><span class='Ref_To_Local'>locale</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN541"><span class='Ref_To_Local'>locale</span></a><span class='Delimiter'>, 
</span>                     <a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN541"><span class='Ref_To_Local'>locale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN431"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no usable system locales were found"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not HAVE_LOCALE_T && not WIN32 */ 
</span> 
<span class='Directive'>#ifdef</span> USE_ICU 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/mb/pg_wchar.h.html#LN337"><span class='Ref_to_Proto'>is_encoding_supported_by_icu</span></a><span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>()))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"encoding \"%s\" not supported by ICU"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>()))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN566"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Start the loop at -1 to sneak in the root locale without too much 
         * code duplication. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN566"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="collationcmds.c.html#LN566"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span>ucol_countAvailable<span class='Parentheses'>()</span><span class='Delimiter'>; </span><a href="collationcmds.c.html#LN566"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN574"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>name</span><span class='Delimiter'>; 
</span><a name="LN575"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>langtag</span><span class='Delimiter'>; 
</span><a name="LN576"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>collcollate</span><span class='Delimiter'>; 
</span><a name="LN577"></a>            UEnumeration <span class='Operator'>*</span><span class='Declare_Local'>en</span><span class='Delimiter'>; 
</span><a name="LN578"></a>            UErrorCode  <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span><a name="LN579"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN580"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collid</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="collationcmds.c.html#LN566"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* ICU root locale */ 
</span>            <span class='Control'>else</span> 
                <a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>= </span>ucol_getAvailable<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN566"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="collationcmds.c.html#LN575"><span class='Ref_To_Local'>langtag</span></a> <span class='Operator'>= </span><a href="collationcmds.c.html#LN383"><span class='Ref_to_Func'>get_icu_language_tag</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a> <span class='Operator'>= </span>U_ICU_VERSION_MAJOR_NUM <span class='Operator'>&GT;= </span><span class='Number'>54</span> <span class='Operator'>? </span><a href="collationcmds.c.html#LN575"><span class='Ref_To_Local'>langtag</span></a> <span class='Operator'>: </span><a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>; 
</span>            <a href="collationcmds.c.html#LN580"><span class='Ref_To_Local'>collid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation_fn.h.html#LN16"><span class='Ref_to_Proto'>CollationCreate</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s-x-icu"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN575"><span class='Ref_To_Local'>langtag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="collationcmds.c.html#LN426"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                     <a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a><span class='Delimiter'>, 
</span>                 <a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="collationcmds.c.html#LN425"><span class='Ref_To_Local'>if_not_exists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/commands/comment.h.html#LN36"><span class='Ref_to_Proto'>CreateComments</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN580"><span class='Ref_To_Local'>collid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                           <a href="collationcmds.c.html#LN400"><span class='Ref_to_Func'>get_icu_locale_comment</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Add keyword variants 
             */ 
</span>            <a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>            <a href="collationcmds.c.html#LN577"><span class='Ref_To_Local'>en</span></a> <span class='Operator'>= </span>ucol_getKeywordValuesForLocale<span class='Parentheses'>(</span><span class='String'>"collation"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><span class='Boolean'>TRUE</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not get keyword values for locale \"%s\": %s"</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>            uenum_reset<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN577"><span class='Ref_To_Local'>en</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="collationcmds.c.html#LN579"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>uenum_next<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN577"><span class='Ref_To_Local'>en</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN612"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>localeid</span> <span class='Operator'>= </span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s@collation=%s"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN579"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="collationcmds.c.html#LN575"><span class='Ref_To_Local'>langtag</span></a> <span class='Operator'>= </span><a href="collationcmds.c.html#LN383"><span class='Ref_to_Func'>get_icu_language_tag</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN612"><span class='Ref_To_Local'>localeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a> <span class='Operator'>= </span>U_ICU_VERSION_MAJOR_NUM <span class='Operator'>&GT;= </span><span class='Number'>54</span> <span class='Operator'>? </span><a href="collationcmds.c.html#LN575"><span class='Ref_To_Local'>langtag</span></a> <span class='Operator'>: </span><a href="collationcmds.c.html#LN612"><span class='Ref_To_Local'>localeid</span></a><span class='Delimiter'>; 
</span>                <a href="collationcmds.c.html#LN580"><span class='Ref_To_Local'>collid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_collation_fn.h.html#LN16"><span class='Ref_to_Proto'>CollationCreate</span></a><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s-x-icu"</span><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN575"><span class='Ref_To_Local'>langtag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="collationcmds.c.html#LN426"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                         <a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a><span class='Delimiter'>, 
</span>                 <a href="../../include/utils/pg_locale.h.html#LN91"><span class='Ref_to_Proto'>get_collation_actual_version</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Delimiter'>, </span><a href="collationcmds.c.html#LN576"><span class='Ref_To_Local'>collcollate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="collationcmds.c.html#LN425"><span class='Ref_To_Local'>if_not_exists</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/commands/comment.h.html#LN36"><span class='Ref_to_Proto'>CreateComments</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN580"><span class='Ref_To_Local'>collid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_collation.h.html#LN29"><span class='Ref_to_Const'>CollationRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                               <a href="collationcmds.c.html#LN400"><span class='Ref_to_Func'>get_icu_locale_comment</span></a><span class='Parentheses'>(</span><a href="collationcmds.c.html#LN612"><span class='Ref_To_Local'>localeid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not get keyword values for locale \"%s\": %s"</span><span class='Delimiter'>, 
</span>                        <a href="collationcmds.c.html#LN574"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN578"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            uenum_close<span class='Parentheses'>(</span><a href="collationcmds.c.html#LN577"><span class='Ref_To_Local'>en</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=-1;i&LT;ucol_countAvai... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Directive'>#endif</span> 
 
    <a href="../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_import_system_collations &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>