<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\copy.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\copy.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:34 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * copy.c 
 *      Implements the COPY utility command 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/copy.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;netinet/in.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;arpa/inet.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/copy.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/executor.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/libpq.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/clauses.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"optimizer/planner.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_relation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteHandler.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/fd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/portal.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rls.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
 
 
<a name="LN52"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ISOCTAL</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) (((</span><a href="copy.c.html#LN52"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span><span class='Parentheses'>)</span> <span class='Operator'>&& </span><span class='Parentheses'>((</span><a href="copy.c.html#LN52"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='String'>'7'</span><span class='Parentheses'>))</span> 
<a name="LN53"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>OCTVALUE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) ((</span><a href="copy.c.html#LN53"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='String'>'0'</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Represents the different source/dest cases we need to worry about at 
 * the bottom level 
 */ 
</span><a name="LN59"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>CopyDest</span> 
<span class='Delimiter'>{ 
</span><a name="LN61"></a>    <span class='Declare_Enum_Const'>COPY_FILE</span><span class='Delimiter'>,</span>                  <span class='Comment_Single_Line'>/* to/from file (or a piped program) */ 
</span><a name="LN62"></a>    <span class='Declare_Enum_Const'>COPY_OLD_FE</span><span class='Delimiter'>,</span>                <span class='Comment_Single_Line'>/* to/from frontend (2.0 protocol) */ 
</span><a name="LN63"></a>    <span class='Declare_Enum_Const'>COPY_NEW_FE</span><span class='Delimiter'>,</span>                <span class='Comment_Single_Line'>/* to/from frontend (3.0 protocol) */ 
</span><a name="LN64"></a>    <span class='Declare_Enum_Const'>COPY_CALLBACK</span>               <span class='Comment_Single_Line'>/* to/from callback function */ 
</span><a name="LN65"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>CopyDest</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  Represents the end-of-line terminator type of the input 
 */ 
</span><a name="LN70"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>EolType</span> 
<span class='Delimiter'>{ 
</span><a name="LN72"></a>    <span class='Declare_Enum_Const'>EOL_UNKNOWN</span><span class='Delimiter'>, 
</span><a name="LN73"></a>    <span class='Declare_Enum_Const'>EOL_NL</span><span class='Delimiter'>, 
</span><a name="LN74"></a>    <span class='Declare_Enum_Const'>EOL_CR</span><span class='Delimiter'>, 
</span><a name="LN75"></a>    <span class='Declare_Enum_Const'>EOL_CRNL</span> 
<a name="LN76"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>EolType</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This struct contains all the state variables used throughout a COPY 
 * operation. For simplicity, we use the same struct for all variants of COPY, 
 * even though some fields are used in only some cases. 
 * 
 * Multi-byte encodings: all supported client-side encodings encode multi-byte 
 * characters by having the first byte's high bit set. Subsequent bytes of the 
 * character can have the high bit not set. When scanning data in such an 
 * encoding to look for a match to a single-byte (ie ASCII) character, we must 
 * use the full pg_encoding_mblen() machinery to skip over multibyte 
 * characters, else we might find a false match to a trailing byte. In 
 * supported server encodings, there is no possibility of a false match, and 
 * it's faster to make useless comparisons to trailing bytes than it is to 
 * invoke pg_encoding_mblen() to skip over them. encoding_embeds_ascii is TRUE 
 * when we have to do it the hard way. 
 */ 
</span><a name="LN94"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>CopyStateData</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* low-level state data */ 
</span><a name="LN97"></a>    <a href="copy.c.html#LN59"><span class='Ref_to_Enum'>CopyDest</span></a>    <span class='Declare_Member'>copy_dest</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* type of copy source/destination */ 
</span><a name="LN98"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Member'>copy_file</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* used if copy_dest == COPY_FILE */ 
</span><a name="LN99"></a>    <a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Member'>fe_msgbuf</span><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* used for all dests during COPY TO, only for 
                                 * dest == COPY_NEW_FE in COPY FROM */ 
</span><a name="LN101"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>fe_eof</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* true if detected end of copy data */ 
</span><a name="LN102"></a>    <a href="copy.c.html#LN70"><span class='Ref_to_Enum'>EolType</span></a>     <span class='Declare_Member'>eol_type</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* EOL type of input */ 
</span><a name="LN103"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>file_encoding</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* file or remote side's character encoding */ 
</span><a name="LN104"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>need_transcoding</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* file encoding diff from server? */ 
</span><a name="LN105"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>encoding_embeds_ascii</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* ASCII can be non-first byte? */ 
</span> 
    <span class='Comment_Multi_Line'>/* parameters from the COPY command */ 
</span><a name="LN108"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* relation to copy to or from */ 
</span><a name="LN109"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>queryDesc</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* executable query to copy from */ 
</span><a name="LN110"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>attnumlist</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* integer list of attnums to copy */ 
</span><a name="LN111"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>filename</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* filename, or NULL for STDIN/STDOUT */ 
</span><a name="LN112"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_program</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* is 'filename' a program to popen? */ 
</span><a name="LN113"></a>    <a href="../../include/commands/copy.h.html#LN23"><span class='Ref_to_Typedef'>copy_data_source_cb</span></a> <span class='Declare_Member'>data_source_cb</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* function for reading data */ 
</span><a name="LN114"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>binary</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* binary format? */ 
</span><a name="LN115"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>oids</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* include OIDs? */ 
</span><a name="LN116"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>freeze</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* freeze rows on loading? */ 
</span><a name="LN117"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>csv_mode</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Comma Separated Value format? */ 
</span><a name="LN118"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>header_line</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* CSV header line? */ 
</span><a name="LN119"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>null_print</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* NULL marker string (server encoding!) */ 
</span><a name="LN120"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>null_print_len</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* length of same */ 
</span><a name="LN121"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>null_print_client</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* same converted to file encoding */ 
</span><a name="LN122"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>delim</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* column delimiter (must be 1 byte) */ 
</span><a name="LN123"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>quote</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* CSV quote char (must be 1 byte) */ 
</span><a name="LN124"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>escape</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* CSV escape char (must be 1 byte) */ 
</span><a name="LN125"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>force_quote</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* list of column names */ 
</span><a name="LN126"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>force_quote_all</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* FORCE_QUOTE *? */ 
</span><a name="LN127"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>force_quote_flags</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* per-column CSV FQ flags */ 
</span><a name="LN128"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>force_notnull</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* list of column names */ 
</span><a name="LN129"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>force_notnull_flags</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* per-column CSV FNN flags */ 
</span><a name="LN130"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>force_null</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* list of column names */ 
</span><a name="LN131"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>force_null_flags</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* per-column CSV FN flags */ 
</span><a name="LN132"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>convert_selectively</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* do selective binary conversion? */ 
</span><a name="LN133"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>convert_select</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* list of column names (can be NIL) */ 
</span><a name="LN134"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>convert_select_flags</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* per-column CSV/TEXT CS flags */ 
</span> 
    <span class='Comment_Multi_Line'>/* these are just for error messages, see CopyFromErrorCallback */ 
</span><a name="LN137"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>cur_relname</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* table name for error messages */ 
</span><a name="LN138"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>cur_lineno</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* line number for error messages */ 
</span><a name="LN139"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>cur_attname</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* current att for error messages */ 
</span><a name="LN140"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>cur_attval</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* current att value for error messages */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Working state for COPY TO/FROM 
     */ 
</span><a name="LN145"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>copycontext</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* per-copy execution context */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Working state for COPY TO 
     */ 
</span><a name="LN150"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>out_functions</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* lookup info for output functions */ 
</span><a name="LN151"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>rowcontext</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* per-row evaluation context */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Working state for COPY FROM 
     */ 
</span><a name="LN156"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Member'>num_defaults</span><span class='Delimiter'>; 
</span><a name="LN157"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>file_has_oids</span><span class='Delimiter'>; 
</span><a name="LN158"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>oid_in_function</span><span class='Delimiter'>; 
</span><a name="LN159"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>oid_typioparam</span><span class='Delimiter'>; 
</span><a name="LN160"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>in_functions</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* array of input functions for each attrs */ 
</span><a name="LN161"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Member'>typioparams</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* array of element types for in_functions */ 
</span><a name="LN162"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>defmap</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* array of default att numbers */ 
</span><a name="LN163"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Declare_Member'>defexprs</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* array of default att expressions */ 
</span><a name="LN164"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>volatile_defexprs</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* is any of defexprs volatile? */ 
</span><a name="LN165"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>range_table</span><span class='Delimiter'>; 
</span> 
<a name="LN167"></a>    <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>*</span><span class='Declare_Member'>partition_dispatch_info</span><span class='Delimiter'>; 
</span><a name="LN168"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_dispatch</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* Number of entries in the above array */ 
</span><a name="LN169"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_partitions</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* Number of members in the following arrays */ 
</span><a name="LN170"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>partitions</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Per partition result relation */ 
</span><a name="LN171"></a>    <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>**</span><span class='Declare_Member'>partition_tupconv_maps</span><span class='Delimiter'>; 
</span><a name="LN172"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Member'>partition_tuple_slot</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * These variables are used to reduce overhead in textual COPY FROM. 
     * 
     * attribute_buf holds the separated, de-escaped text for each field of 
     * the current line.  The CopyReadAttributes functions return arrays of 
     * pointers into this buffer.  We avoid palloc/pfree overhead by re-using 
     * the buffer on each cycle. 
     */ 
</span><a name="LN182"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Member'>attribute_buf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* field raw data pointers found by COPY FROM */ 
</span> 
<a name="LN186"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>max_fields</span><span class='Delimiter'>; 
</span><a name="LN187"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Member'>raw_fields</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Similarly, line_buf holds the whole input line being processed. The 
     * input cycle is first to read the whole line into line_buf, convert it 
     * to server encoding there, and then extract the individual attribute 
     * fields into attribute_buf.  line_buf is preserved unmodified so that we 
     * can display it in error messages if appropriate. 
     */ 
</span><a name="LN196"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Member'>line_buf</span><span class='Delimiter'>; 
</span><a name="LN197"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>line_buf_converted</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* converted to server encoding? */ 
</span><a name="LN198"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>line_buf_valid</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* contains the row being processed? */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally, raw_buf holds raw data read from the data source (file or 
     * client connection).  CopyReadLine parses this data sufficiently to 
     * locate line boundaries, then transfers the data to line_buf and 
     * converts it.  Note: we guarantee that there is a \0 at 
     * raw_buf[raw_buf_len]. 
     */ 
</span><a name="LN207"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>RAW_BUF_SIZE</span> <span class='Number'>65536</span>      <span class='Comment_Single_Line'>/* we palloc RAW_BUF_SIZE+1 bytes */ 
</span><a name="LN208"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>raw_buf</span><span class='Delimiter'>; 
</span><a name="LN209"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>raw_buf_index</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* next byte to process */ 
</span><a name="LN210"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>raw_buf_len</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* total # of bytes stored */ 
</span><a name="LN211"></a><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end CopyStateData &raquo; </span> <span class='Declare_Typedef'>CopyStateData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* DestReceiver for COPY (query) TO */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN216"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Declare_Member'>pub</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* publicly-known function pointers */ 
</span><a name="LN217"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Member'>cstate</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* CopyStateData for the command */ 
</span><a name="LN218"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Member'>processed</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* # of tuples processed */ 
</span><a name="LN219"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>DR_copy</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * These macros centralize code used to process line_buf and raw_buf buffers. 
 * They are macros because they often do continue/break control and to avoid 
 * function call overhead in tight COPY loops. 
 * 
 * We must use "if (1)" because the usual "do {...} while(0)" wrapper would 
 * prevent the continue/break processing from working.  We end the "if (1)" 
 * with "else ((void) 0)" to ensure the "if" does not unintentionally match 
 * any "else" in the calling code, and to avoid any compiler warnings about 
 * empty statements.  See http://www.cit.gu.edu.au/~anthony/info/C/C.macros. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This keeps the character read at the top of the loop in the buffer 
 * even if there is more than one read-ahead. 
 */ 
</span><a name="LN238"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>extralen</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>raw_buf_ptr <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="copy.c.html#LN238"><span class='Ref_to_Parameter'>extralen</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span>copy_buf_len <span class='Operator'>&& !</span>hit_eof<span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        raw_buf_ptr <span class='Operator'>= </span>prev_raw_ptr<span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* undo fetch */ </span><span class='Operator'>\ 
</span>        need_data <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>continue</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>else</span> <span class='Parentheses'>((</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* This consumes the remainder of the buffer and breaks */ 
</span><a name="LN250"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>IF_NEED_REFILL_AND_EOF_BREAK</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>extralen</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>raw_buf_ptr <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="copy.c.html#LN250"><span class='Ref_to_Parameter'>extralen</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span>copy_buf_len <span class='Operator'>&& </span>hit_eof<span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>    <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN250"><span class='Ref_to_Parameter'>extralen</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            raw_buf_ptr <span class='Operator'>= </span>copy_buf_len<span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* consume the partial character */ </span><span class='Operator'>\ 
</span>        <span class='Comment_Multi_Line'>/* backslash just before EOF, treat as data char */ </span><span class='Operator'>\ 
</span>        <a href="../../bin/pgbench/exprparse.y.html#LN62"><span class='Ref_to_Label'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>break</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>else</span> <span class='Parentheses'>((</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Transfer any approved data to line_buf; must do this to be sure 
 * there is some room in raw_buf. 
 */ 
</span><a name="LN267"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>REFILL_LINEBUF</span> <span class='Operator'>\ 
</span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>raw_buf_ptr <span class='Operator'>&GT; </span>cstate<span class='Operator'>-&GT;</span>raw_buf_index<span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span>cstate<span class='Operator'>-&GT;</span>line_buf<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                             cstate<span class='Operator'>-&GT;</span>raw_buf <span class='Operator'>+ </span>cstate<span class='Operator'>-&GT;</span>raw_buf_index<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                               raw_buf_ptr <span class='Operator'>- </span>cstate<span class='Operator'>-&GT;</span>raw_buf_index<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        cstate<span class='Operator'>-&GT;</span>raw_buf_index <span class='Operator'>= </span>raw_buf_ptr<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>else</span> <span class='Parentheses'>((</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* Undo any read-ahead and jump out of the block. */ 
</span><a name="LN280"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NO_END_OF_COPY_GOTO</span> <span class='Operator'>\ 
</span><span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    raw_buf_ptr <span class='Operator'>= </span>prev_raw_ptr <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Control'>goto</span> not_end_of_copy<span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>else</span> <span class='Parentheses'>((</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
 
<a name="LN287"></a><span class='Keyword'>static const char </span><span class='Declare_Var'>BinarySignature</span><span class='Delimiter'>[</span><span class='Number'>11</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>"PGCOPY\n\377\r\n\0"</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* non-export function prototypes */ 
</span><a name="LN291"></a><span class='Keyword'>static </span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Prototype'>BeginCopy</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_from</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN292"></a>          <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raw_query</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>queryRelId</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, 
</span><a name="LN293"></a>          <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN294"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>EndCopy</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN295"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ClosePipeToProgram</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN296"></a><span class='Keyword'>static </span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Prototype'>BeginCopyTo</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN297"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>queryRelId</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_program</span><span class='Delimiter'>, 
</span><a name="LN298"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN299"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>EndCopyTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN300"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Prototype'>DoCopyTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN301"></a><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Prototype'>CopyTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN302"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopyOneRowTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tupleOid</span><span class='Delimiter'>, 
</span><a name="LN303"></a>             <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN304"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopyFromInsertBatch</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, 
</span><a name="LN305"></a>                    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a> <span class='Declare_Parameter'>mycid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hi_options</span><span class='Delimiter'>, 
</span><a name="LN306"></a>                    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, </span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>myslot</span><span class='Delimiter'>, 
</span><a name="LN307"></a>                    <a href="../../include/access/heapam.h.html#LN32"><span class='Ref_to_Typedef'>BulkInsertState</span></a> <span class='Declare_Parameter'>bistate</span><span class='Delimiter'>, 
</span><a name="LN308"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>nBufferedTuples</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bufferedTuples</span><span class='Delimiter'>, 
</span><a name="LN309"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>firstBufferedLineNo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN310"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>CopyReadLine</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN311"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>CopyReadLineText</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN312"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>CopyReadAttributesText</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN313"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>CopyReadAttributesCSV</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN314"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>CopyReadBinaryAttribute</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, 
</span><a name="LN315"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>column_no</span><span class='Delimiter'>, </span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>flinfo</span><span class='Delimiter'>, 
</span><a name="LN316"></a>                        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typioparam</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN317"></a>                        <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN318"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopyAttributeOutText</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN319"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopyAttributeOutCSV</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Delimiter'>, 
</span><a name="LN320"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_quote</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>single_attr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN321"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>CopyGetAttnums</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupDesc</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN322"></a>               <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN323"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>limit_printout_length</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Low-level communications functions */ 
</span><a name="LN326"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SendCopyBegin</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN327"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ReceiveCopyBegin</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN328"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SendCopyEnd</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN329"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopySendData</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>databuf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>datasize</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN330"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopySendString</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopySendChar</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN332"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopySendEndOfRow</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN333"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>CopyGetData</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>databuf</span><span class='Delimiter'>, 
</span><a name="LN334"></a>            <span class='Keyword'>int </span><span class='Declare_Parameter'>minread</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxread</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN335"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopySendInt32</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>CopyGetInt32</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN337"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CopySendInt16</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN338"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>CopyGetInt16</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Send copy start/stop messages for frontend copies.  These have changed 
 * in past protocol redesigns. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN346"></a><span class='Declare_Function'>SendCopyBegin</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* new way */ 
</span><a name="LN351"></a>        <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN352"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN346"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN353"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>format</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN346"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN354"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/libpq/pqformat.h.html#LN17"><span class='Ref_to_Proto'>pq_beginmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'H'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN353"><span class='Ref_To_Local'>format</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* overall format */ 
</span>        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN352"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN354"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN354"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN352"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN354"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN353"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* per-column formats */ 
</span>        <a href="../../include/libpq/pqformat.h.html#LN29"><span class='Ref_to_Proto'>pq_endmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN346"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN63"><span class='Ref_to_EnumConst'>COPY_NEW_FE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* old way */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN346"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY BINARY is not supported to stdout or from stdin"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'H'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* grottiness needed for old COPY OUT protocol */ 
</span>        <a href="../../include/libpq/libpq.h.html#LN45"><span class='Ref_to_Macro'>pq_startcopyout</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN346"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN62"><span class='Ref_to_EnumConst'>COPY_OLD_FE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end SendCopyBegin &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN379"></a><span class='Declare_Function'>ReceiveCopyBegin</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/pqcomm.h.html#LN103"><span class='Ref_to_Macro'>PG_PROTOCOL_MAJOR</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN26"><span class='Ref_to_Global_Var'>FrontendProtocol</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* new way */ 
</span><a name="LN384"></a>        <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN385"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>natts</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN379"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN386"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>format</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN379"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN387"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/libpq/pqformat.h.html#LN17"><span class='Ref_to_Proto'>pq_beginmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN384"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'G'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN18"><span class='Ref_to_Proto'>pq_sendbyte</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN384"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN386"><span class='Ref_To_Local'>format</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* overall format */ 
</span>        <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN384"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN385"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN387"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN387"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN385"><span class='Ref_To_Local'>natts</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN387"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN384"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN386"><span class='Ref_To_Local'>format</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* per-column formats */ 
</span>        <a href="../../include/libpq/pqformat.h.html#LN29"><span class='Ref_to_Proto'>pq_endmessage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN384"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN379"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN63"><span class='Ref_to_EnumConst'>COPY_NEW_FE</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN379"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a> <span class='Operator'>= </span><a href="../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* old way */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN379"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY BINARY is not supported to stdout or from stdin"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'G'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* any error in old protocol will make us lose sync */ 
</span>        <a href="../../include/libpq/libpq.h.html#LN65"><span class='Ref_to_Proto'>pq_startmsgread</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN379"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN62"><span class='Ref_to_EnumConst'>COPY_OLD_FE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* We *must* flush here to ensure FE knows it can send. */ 
</span>    <a href="../../include/libpq/libpq.h.html#LN38"><span class='Ref_to_Macro'>pq_flush</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReceiveCopyBegin &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN415"></a><span class='Declare_Function'>SendCopyEnd</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN415"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN63"><span class='Ref_to_EnumConst'>COPY_NEW_FE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Shouldn't have any unsent data */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN415"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Send Copy Done message */ 
</span>        <a href="../../include/libpq/pqformat.h.html#LN35"><span class='Ref_to_Proto'>pq_putemptymessage</span></a><span class='Parentheses'>(</span><span class='String'>'c'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN329"><span class='Ref_to_Proto'>CopySendData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN415"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>"\\."</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Need to flush out the trailer (this also appends a newline) */ 
</span>        <a href="copy.c.html#LN332"><span class='Ref_to_Proto'>CopySendEndOfRow</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN415"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/libpq/libpq.h.html#LN46"><span class='Ref_to_Macro'>pq_endcopyout</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/*---------- 
 * CopySendData sends output data to the destination (file or frontend) 
 * CopySendString does the same for null-terminated strings 
 * CopySendChar does the same for single characters 
 * CopySendEndOfRow does the appropriate thing at end of each data row 
 *  (data is not actually flushed except by CopySendEndOfRow) 
 * 
 * NB: no data conversion is applied by these functions 
 *---------- 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN444"></a><span class='Declare_Function'>CopySendData</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>databuf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>datasize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN444"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN444"><span class='Ref_to_Parameter'>databuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN444"><span class='Ref_to_Parameter'>datasize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN450"></a><span class='Declare_Function'>CopySendString</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN450"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN450"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN456"></a><span class='Declare_Function'>CopySendChar</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN456"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN456"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN462"></a><span class='Declare_Function'>CopySendEndOfRow</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN464"></a>    <a href="../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>fe_msgbuf</span> <span class='Operator'>= </span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN61"><span class='Ref_to_EnumConst'>COPY_FILE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Default line termination depends on platform */ 
</span><span class='Directive'>#ifndef</span> <a href="../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
                <a href="copy.c.html#LN330"><span class='Ref_to_Proto'>CopySendString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>"\r\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>fwrite<span class='Parentheses'>(</span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>                ferror<span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN112"><span class='Ref_to_Member'>is_program</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>EPIPE<span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * The pipe will be closed automatically on error at 
                         * the end of transaction, but we might get a better 
                         * error message from the subprocess' exit code than 
                         * just "Broken Pipe" 
                         */ 
</span>                        <a href="copy.c.html#LN295"><span class='Ref_to_Proto'>ClosePipeToProgram</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * If ClosePipeToProgram() didn't throw an error, the 
                         * program terminated normally, but closed the pipe 
                         * first. Restore errno, and throw an error. 
                         */ 
</span>                        errno <span class='Operator'>= </span>EPIPE<span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write to COPY program: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;is_program &raquo; </span> 
                <span class='Control'>else</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not write to COPY file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fwrite(fe_msgbuf-&GT;dat... &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN62"><span class='Ref_to_EnumConst'>COPY_OLD_FE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* The FE/BE protocol uses \n as newline for all platforms */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/libpq.h.html#LN72"><span class='Ref_to_Proto'>pq_putbytes</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* no hope of recovering connection sync, so FATAL */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"connection lost during COPY to stdout"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN63"><span class='Ref_to_EnumConst'>COPY_NEW_FE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* The FE/BE protocol uses \n as newline for all platforms */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Dump the accumulated row as one CopyData message */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/libpq/libpq.h.html#LN41"><span class='Ref_to_Macro'>pq_putmessage</span></a><span class='Parentheses'>(</span><span class='String'>'d'</span><span class='Delimiter'>, </span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN64"><span class='Ref_to_EnumConst'>COPY_CALLBACK</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Not yet supported. */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cstate-&GT;copy_dest &raquo; </span> 
 
    <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN464"><span class='Ref_To_Local'>fe_msgbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopySendEndOfRow &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CopyGetData reads data from the source (file or frontend) 
 * 
 * We attempt to read at least minread, and at most maxread, bytes from 
 * the source.  The actual number of bytes read is returned; if this is 
 * less than minread, EOF was detected. 
 * 
 * Note: when copying from the frontend, we expect a proper EOF mark per 
 * protocol; if the frontend simply drops the connection, we raise error. 
 * It seems unwise to allow the COPY IN to complete normally in that case. 
 * 
 * NB: no data conversion is applied here. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN555"></a><span class='Declare_Function'>CopyGetData</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>databuf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>minread</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxread</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN557"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bytesread</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN61"><span class='Ref_to_EnumConst'>COPY_FILE</span></a><span class='Operator'>: 
</span>            <a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>databuf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>maxread</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>ferror<span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read from COPY file: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN62"><span class='Ref_to_EnumConst'>COPY_OLD_FE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We cannot read more than minread bytes (which in practice is 1) 
             * because old protocol doesn't have any clear way of separating 
             * the COPY stream from following data.  This is slow, but not any 
             * slower than the code path was originally, and we don't care 
             * much anymore about the performance of old protocol. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/libpq.h.html#LN63"><span class='Ref_to_Proto'>pq_getbytes</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>databuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>minread</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Only a \. terminator is legal EOF in old protocol */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection with an open transaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>minread</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN63"><span class='Ref_to_EnumConst'>COPY_NEW_FE</span></a><span class='Operator'>: 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>maxread</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>minread</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN101"><span class='Ref_to_Member'>fe_eof</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN589"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>avail</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Try to receive another message */ 
</span><a name="LN594"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>mtype</span><span class='Delimiter'>; 
</span> 
<a name="LN596"></a>            <span class='Label'>readmessage</span><span class='Operator'>: 
</span>                    <a href="../../include/miscadmin.h.html#LN124"><span class='Ref_to_Macro'>HOLD_CANCEL_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <a href="../../include/libpq/libpq.h.html#LN65"><span class='Ref_to_Proto'>pq_startmsgread</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN594"><span class='Ref_To_Local'>mtype</span></a> <span class='Operator'>= </span><a href="../../include/libpq/libpq.h.html#LN69"><span class='Ref_to_Proto'>pq_getbyte</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN594"><span class='Ref_To_Local'>mtype</span></a> <span class='Operator'>== </span>EOF<span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection with an open transaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/libpq/libpq.h.html#LN68"><span class='Ref_to_Proto'>pq_getmessage</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONNECTION_FAILURE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF on client connection with an open transaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="../../include/miscadmin.h.html#LN126"><span class='Ref_to_Macro'>RESUME_CANCEL_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN594"><span class='Ref_To_Local'>mtype</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* CopyData */ 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* CopyDone */ 
</span>                            <span class='Comment_Multi_Line'>/* COPY IN correctly terminated by frontend */ 
</span>                            <a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN101"><span class='Ref_to_Member'>fe_eof</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <span class='Control'>return</span> <a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* CopyFail */ 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_QUERY_CANCELED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY from stdin failed: %s"</span><span class='Delimiter'>, 
</span>                                       <a href="../../include/libpq/pqformat.h.html#LN45"><span class='Ref_to_Proto'>pq_getmsgstring</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Flush */ 
</span>                        <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Sync */ 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * Ignore Flush/Sync for the convenience of client 
                             * libraries (such as libpq) that may send those 
                             * without noticing that the command they just 
                             * sent was COPY. 
                             */ 
</span>                            <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="copy.c.html#LN596"><span class='Ref_to_Label'>readmessage</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROTOCOL_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected message type 0x%02X during COPY from stdin"</span><span class='Delimiter'>, 
</span>                                            <a href="copy.c.html#LN594"><span class='Ref_To_Local'>mtype</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch mtype &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while cstate-&GT;fe_msgbuf-&GT;cu... &raquo; </span> 
                <a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Operator'>-&GT;</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>&GT; </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>maxread</span></a><span class='Parentheses'>) 
</span>                    <a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>maxread</span></a><span class='Delimiter'>; 
</span>                <a href="../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>databuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>databuf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>databuf</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>maxread</span></a> <span class='Operator'>-= </span><a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a> <span class='Operator'>+= </span><a href="copy.c.html#LN589"><span class='Ref_To_Local'>avail</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while maxread&GT;0&&bytesread&LT;... &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="copy.c.html#LN64"><span class='Ref_to_EnumConst'>COPY_CALLBACK</span></a><span class='Operator'>: 
</span>            <a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN113"><span class='Ref_to_Member'>data_source_cb</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>databuf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>minread</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN555"><span class='Ref_to_Parameter'>maxread</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cstate-&GT;copy_dest &raquo; </span> 
 
    <span class='Control'>return</span> <a href="copy.c.html#LN557"><span class='Ref_To_Local'>bytesread</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyGetData &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * These functions do apply some data conversion 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CopySendInt32 sends an int32 in network byte order 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN667"></a><span class='Declare_Function'>CopySendInt32</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN669"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN669"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>htonl<span class='Parentheses'>((</span><a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="copy.c.html#LN667"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN329"><span class='Ref_to_Proto'>CopySendData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN667"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN669"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN669"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CopyGetInt32 reads an int32 that appears in network byte order 
 * 
 * Returns true if OK, false if EOF 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN681"></a><span class='Declare_Function'>CopyGetInt32</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN683"></a>    <a href="../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN681"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN683"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN681"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* suppress compiler warning */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="copy.c.html#LN681"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span>ntohl<span class='Parentheses'>(</span><a href="copy.c.html#LN683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CopySendInt16 sends an int16 in network byte order 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN698"></a><span class='Declare_Function'>CopySendInt16</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN700"></a>    <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN700"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>htons<span class='Parentheses'>((</span><a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="copy.c.html#LN698"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN329"><span class='Ref_to_Proto'>CopySendData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN698"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN700"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN700"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CopyGetInt16 reads an int16 that appears in network byte order 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN710"></a><span class='Declare_Function'>CopyGetInt16</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN712"></a>    <a href="../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN710"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN712"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN712"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN712"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN712"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN710"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* suppress compiler warning */ 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="copy.c.html#LN710"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span>ntohs<span class='Parentheses'>(</span><a href="copy.c.html#LN712"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * CopyLoadRawBuf loads some more data into raw_buf 
 * 
 * Returns TRUE if able to obtain at least one more byte, else FALSE. 
 * 
 * If raw_buf_index &LT; raw_buf_len, the unprocessed bytes are transferred 
 * down to the start of the buffer and then we load more data after that. 
 * This case is used only when a frontend multibyte character crosses a 
 * bufferload boundary. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN735"></a><span class='Declare_Function'>CopyLoadRawBuf</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN737"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN738"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inbytes</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Copy down the unprocessed data */ 
</span>        <a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a><span class='Delimiter'>, 
</span>                <a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* no data need be saved */ 
</span> 
    <a href="copy.c.html#LN738"><span class='Ref_To_Local'>inbytes</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, 
</span>                          <span class='Number'>1</span><span class='Delimiter'>, </span><a href="copy.c.html#LN207"><span class='Ref_to_Const'>RAW_BUF_SIZE</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+= </span><a href="copy.c.html#LN738"><span class='Ref_To_Local'>inbytes</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN735"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN737"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN738"><span class='Ref_To_Local'>inbytes</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyLoadRawBuf &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *   DoCopy executes the SQL COPY statement 
 * 
 * Either unload or reload contents of table &LT;relation&GT;, depending on &LT;from&GT;. 
 * (&LT;from&GT; = TRUE means we are inserting into the table.)  In the "TO" case 
 * we also support copying the output of an arbitrary SELECT, INSERT, UPDATE 
 * or DELETE query. 
 * 
 * If &LT;pipe&GT; is false, transfer is between the table and the file named 
 * &LT;filename&GT;.  Otherwise, transfer is between the table and our regular 
 * input/output stream. The latter could be either stdin/stdout or a 
 * socket, depending on whether we're running under Postmaster control. 
 * 
 * Do not allow a Postgres user without superuser privilege to read from 
 * or write to a file. 
 * 
 * Do not allow the copy if user doesn't have proper permission to access 
 * the table or the specifically requested columns. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN780"></a><span class='Declare_Function'>DoCopy</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../include/nodes/parsenodes.h.html#LN1911"><span class='Ref_to_Struct'>CopyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN781"></a>       <span class='Keyword'>int </span><span class='Declare_Parameter'>stmt_location</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>stmt_len</span><span class='Delimiter'>, 
</span><a name="LN782"></a>       <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>processed</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN784"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN785"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_from</span> <span class='Operator'>= </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1919"><span class='Ref_to_Member'>is_from</span></a><span class='Delimiter'>; 
</span><a name="LN786"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pipe</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1921"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN787"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN788"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span><span class='Delimiter'>; 
</span><a name="LN789"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Disallow COPY to/from file or program except to superusers. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN786"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>&& !</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1920"><span class='Ref_to_Member'>is_program</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to COPY to or from an external program"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Anyone can COPY to stdout or from stdin. "</span> 
                           <span class='String'>"psql's \\copy command also works for anyone."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"must be superuser to COPY to or from a file"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Anyone can COPY to stdout or from stdin. "</span> 
                           <span class='String'>"psql's \\copy command also works for anyone."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1914"><span class='Ref_to_Member'>relation</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN810"></a>        <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN811"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attnums</span><span class='Delimiter'>; 
</span><a name="LN812"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span><a name="LN813"></a>        <a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1915"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Open and lock the relation, using the appropriate lock type. */ 
</span>        <a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN92"><span class='Ref_to_Proto'>heap_openrv</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1914"><span class='Ref_to_Member'>relation</span></a><span class='Delimiter'>, 
</span>                          <span class='Parentheses'>(</span><a href="copy.c.html#LN785"><span class='Ref_To_Local'>is_from</span></a> <span class='Operator'>? </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a> <span class='Operator'>: </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN788"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_relation.h.html#LN69"><span class='Ref_to_Proto'>addRangeTableEntryForRelation</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1027"><span class='Ref_to_Member'>requiredPerms</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN785"><span class='Ref_To_Local'>is_from</span></a> <span class='Operator'>? </span><a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a> <span class='Operator'>: </span><a href="../../include/nodes/parsenodes.h.html#LN72"><span class='Ref_to_Const'>ACL_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN810"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN811"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN321"><span class='Ref_to_Proto'>CopyGetAttnums</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN810"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1917"><span class='Ref_to_Member'>attlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN812"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN811"><span class='Ref_To_Local'>attnums</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN830"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attno</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN812"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>) </span><span class='Operator'>- 
</span>            <a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN785"><span class='Ref_To_Local'>is_from</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN830"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1029"><span class='Ref_to_Member'>selectedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1029"><span class='Ref_to_Member'>selectedCols</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN830"><span class='Ref_To_Local'>attno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/executor/executor.h.html#LN178"><span class='Ref_to_Proto'>ExecCheckRTPerms</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN168"><span class='Ref_to_Member'>p_rtable</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Permission check for row security policies. 
         * 
         * check_enable_rls will ereport(ERROR) if the user has requested 
         * something invalid and will otherwise indicate if we should enable 
         * RLS (returns RLS_ENABLED) or not for this COPY statement. 
         * 
         * If the relation has a row security policy and we are to apply it 
         * then perform a "query" copy and allow the normal query processing 
         * to handle the policies. 
         * 
         * If RLS is not enabled for this, then just fall through to the 
         * normal non-filtering relation handling. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rls.h.html#LN47"><span class='Ref_to_Proto'>check_enable_rls</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN813"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/utils/rls.h.html#LN44"><span class='Ref_to_EnumConst'>RLS_ENABLED</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN856"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>select</span><span class='Delimiter'>; 
</span><a name="LN857"></a>            <a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>cr</span><span class='Delimiter'>; 
</span><a name="LN858"></a>            <a href="../../include/nodes/parsenodes.h.html#LN436"><span class='Ref_to_Struct'>ResTarget</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>target</span><span class='Delimiter'>; 
</span><a name="LN859"></a>            <a href="../../include/nodes/primnodes.h.html#LN62"><span class='Ref_to_Struct'>RangeVar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>from</span><span class='Delimiter'>; 
</span><a name="LN860"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targetList</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN785"><span class='Ref_To_Local'>is_from</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY FROM not supported with row-level security"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use INSERT statements instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Build target list 
             * 
             * If no columns are specified in the attribute list of the COPY 
             * command, then the target list is 'all' columns. Therefore, '*' 
             * should be used as the target list for the resulting SELECT 
             * statement. 
             * 
             * In the case that columns are specified in the attribute list, 
             * create a ColumnRef and ResTarget for each column and add them 
             * to the target list for the resulting SELECT statement. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1917"><span class='Ref_to_Member'>attlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN367"><span class='Ref_to_Struct'>A_Star</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN436"><span class='Ref_to_Struct'>ResTarget</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN439"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN440"><span class='Ref_to_Member'>indirection</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN441"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN442"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN860"><span class='Ref_To_Local'>targetList</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN896"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN896"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1917"><span class='Ref_to_Member'>attlist</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Build the ColumnRef for each column.  The ColumnRef 
                     * 'fields' property is a String 'Value' node (see 
                     * nodes/value.h) that corresponds to the column name 
                     * respectively. 
                     */ 
</span>                    <a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN231"><span class='Ref_to_Struct'>ColumnRef</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN234"><span class='Ref_to_Member'>fields</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN896"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN235"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Build the ResTarget and add the ColumnRef to it. */ 
</span>                    <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN436"><span class='Ref_to_Struct'>ResTarget</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN439"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN440"><span class='Ref_to_Member'>indirection</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN441"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN857"><span class='Ref_To_Local'>cr</span></a><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN442"><span class='Ref_to_Member'>location</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Add each column to the SELECT statement's target list */ 
</span>                    <a href="copy.c.html#LN860"><span class='Ref_To_Local'>targetList</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN860"><span class='Ref_To_Local'>targetList</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN858"><span class='Ref_To_Local'>target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Build RangeVar for from clause, fully qualified based on the 
             * relation which we have opened and locked. 
             */ 
</span>            <a href="copy.c.html#LN859"><span class='Ref_To_Local'>from</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN68"><span class='Ref_to_Proto'>makeRangeVar</span></a><span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN443"><span class='Ref_to_Macro'>RelationGetNamespace</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                <a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Build query */ 
</span>            <a href="copy.c.html#LN856"><span class='Ref_To_Local'>select</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1478"><span class='Ref_to_Struct'>SelectStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN856"><span class='Ref_To_Local'>select</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1488"><span class='Ref_to_Member'>targetList</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN860"><span class='Ref_To_Local'>targetList</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN856"><span class='Ref_To_Local'>select</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1489"><span class='Ref_to_Member'>fromClause</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN859"><span class='Ref_To_Local'>from</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN856"><span class='Ref_To_Local'>select</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1400"><span class='Ref_to_Member'>stmt_location</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN781"><span class='Ref_to_Parameter'>stmt_location</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1401"><span class='Ref_to_Member'>stmt_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN781"><span class='Ref_to_Parameter'>stmt_len</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Close the relation for now, but keep the lock on it to prevent 
             * changes between now and when we start the query-based COPY. 
             * 
             * We'll reopen it later as part of the query-based COPY. 
             */ 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if check_enable_rls(rte-... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;relation &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1915"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1399"><span class='Ref_to_Member'>stmt</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1915"><span class='Ref_to_Member'>query</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1400"><span class='Ref_to_Member'>stmt_location</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN781"><span class='Ref_to_Parameter'>stmt_location</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1401"><span class='Ref_to_Member'>stmt_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN781"><span class='Ref_to_Parameter'>stmt_len</span></a><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN788"><span class='Ref_To_Local'>relid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN785"><span class='Ref_To_Local'>is_from</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check read-only transaction and parallel mode */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../access/transam/xact.c.html#LN76"><span class='Ref_to_Global_Var'>XactReadOnly</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN89"><span class='Ref_to_Member'>rd_islocaltemp</span></a><span class='Parentheses'>) 
</span>            <a href="../tcop/utility.c.html#LN234"><span class='Ref_to_Func'>PreventCommandIfReadOnly</span></a><span class='Parentheses'>(</span><span class='String'>"COPY FROM"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../tcop/utility.c.html#LN252"><span class='Ref_to_Func'>PreventCommandIfParallelMode</span></a><span class='Parentheses'>(</span><span class='String'>"COPY FROM"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN784"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><a href="../../include/commands/copy.h.html#LN30"><span class='Ref_to_Proto'>BeginCopyFrom</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1921"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1920"><span class='Ref_to_Member'>is_program</span></a><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1917"><span class='Ref_to_Member'>attlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1922"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN782"><span class='Ref_to_Parameter'>processed</span></a> <span class='Operator'>= </span><a href="../../include/commands/copy.h.html#LN39"><span class='Ref_to_Proto'>CopyFrom</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN784"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* copy from file to database */ 
</span>        <a href="../../include/commands/copy.h.html#LN32"><span class='Ref_to_Proto'>EndCopyFrom</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN784"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN784"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN296"><span class='Ref_to_Proto'>BeginCopyTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN789"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN788"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, 
</span>                             <a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1921"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1920"><span class='Ref_to_Member'>is_program</span></a><span class='Delimiter'>, 
</span>                             <a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1917"><span class='Ref_to_Member'>attlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN780"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1922"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN782"><span class='Ref_to_Parameter'>processed</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN300"><span class='Ref_to_Proto'>DoCopyTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN784"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* copy from database to file */ 
</span>        <a href="copy.c.html#LN299"><span class='Ref_to_Proto'>EndCopyTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN784"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Close the relation. If reading, we can release the AccessShareLock we 
     * got; if writing, we should hold the lock until end of transaction to 
     * ensure that updates will be committed before lock is released. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN787"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="copy.c.html#LN785"><span class='Ref_To_Local'>is_from</span></a> <span class='Operator'>? </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a> <span class='Operator'>: </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DoCopy &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process the statement option list for COPY. 
 * 
 * Scan the options list (a list of DefElem) and transpose the information 
 * into cstate, applying appropriate error checking. 
 * 
 * cstate is assumed to be filled with zeroes initially. 
 * 
 * This is exported so that external users of the COPY API can sanity-check 
 * a list of options.  In that usage, cstate should be passed as NULL 
 * (since external users don't know sizeof(CopyStateData)) and the collected 
 * data is just leaked until CurrentMemoryContext is reset. 
 * 
 * Note that additional checking, such as whether column names listed in FORCE 
 * QUOTE actually exist, has to be applied later.  This just checks for 
 * self-consistency of the options list. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1013"></a><span class='Declare_Function'>ProcessCopyOptions</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN1014"></a>                   <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, 
</span><a name="LN1015"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_from</span><span class='Delimiter'>, 
</span><a name="LN1016"></a>                   <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1018"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>format_specified</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1019"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>option</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Support external use for option sanity checking */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN94"><span class='Ref_to_Struct'>CopyStateData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN94"><span class='Ref_to_Struct'>CopyStateData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract options from the statement node tree */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1019"><span class='Ref_To_Local'>option</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1016"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1030"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1019"><span class='Ref_To_Local'>option</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"format"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1034"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fmt</span> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1018"><span class='Ref_To_Local'>format_specified</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1018"><span class='Ref_To_Local'>format_specified</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1034"><span class='Ref_To_Local'>fmt</span></a><span class='Delimiter'>, </span><span class='String'>"text"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                 <span class='Comment_Multi_Line'>/* default format */ </span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1034"><span class='Ref_To_Local'>fmt</span></a><span class='Delimiter'>, </span><span class='String'>"csv"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1034"><span class='Ref_To_Local'>fmt</span></a><span class='Delimiter'>, </span><span class='String'>"binary"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY format \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="copy.c.html#LN1034"><span class='Ref_To_Local'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(defel-&GT;defname... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"oids"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"freeze"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN116"><span class='Ref_to_Member'>freeze</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN116"><span class='Ref_to_Member'>freeze</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"delimiter"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"header"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN118"><span class='Ref_to_Member'>header_line</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN118"><span class='Ref_to_Member'>header_line</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"quote"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"escape"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_quote"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN125"><span class='Ref_to_Member'>force_quote</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN126"><span class='Ref_to_Member'>force_quote_all</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN367"><span class='Ref_to_Struct'>A_Star</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN126"><span class='Ref_to_Member'>force_quote_all</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN125"><span class='Ref_to_Member'>force_quote</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument to option \"%s\" must be a list of column names"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_not_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN128"><span class='Ref_to_Member'>force_notnull</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN128"><span class='Ref_to_Member'>force_notnull</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument to option \"%s\" must be a list of column names"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"force_null"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN130"><span class='Ref_to_Member'>force_null</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>&& </span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN130"><span class='Ref_to_Member'>force_null</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument to option \"%s\" must be a list of column names"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"convert_selectively"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Undocumented, not-accessible-from-SQL option: convert only the 
             * named columns to binary form, storing the rest as NULLs. It's 
             * allowed for the column list to be NIL. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN132"><span class='Ref_to_Member'>convert_selectively</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN132"><span class='Ref_to_Member'>convert_selectively</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN133"><span class='Ref_to_Member'>convert_select</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument to option \"%s\" must be a list of column names"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strcmp(defel-&GT;defname... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"encoding"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN501"><span class='Ref_to_Proto'>pg_char_to_encoding</span></a><span class='Parentheses'>(</span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument to option \"%s\" must be a valid encoding name"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"option \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                            <a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1013"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1030"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for incompatible options (must do these two before inserting 
     * defaults) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot specify DELIMITER in BINARY mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot specify NULL in BINARY mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set defaults for omitted options */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? </span><span class='String'>","</span> <span class='Operator'>: </span><span class='String'>"\t"</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? </span><span class='String'>""</span> <span class='Operator'>: </span><span class='String'>"\\N"</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN120"><span class='Ref_to_Member'>null_print_len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a> <span class='Operator'>= </span><span class='String'>"\""</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Only single-byte delimiter strings are supported. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY delimiter must be a single one-byte character"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Disallow end-of-line characters */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>, </span><span class='String'>'\r'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        strchr<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY delimiter cannot be newline or carriage return"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, </span><span class='String'>'\r'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        strchr<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY null representation cannot use newline or carriage return"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow unsafe delimiter characters in non-CSV mode.  We can't allow 
     * backslash because it would be ambiguous.  We can't allow the other 
     * cases because data characters matching the delimiter must be 
     * backslashed, and certain backslash combinations are interpreted 
     * non-literally by COPY IN.  Disallowing all lower case ASCII letters is 
     * more than strictly necessary, but seems best for consistency and 
     * future-proofing.  Likewise we disallow all digits though only octal 
     * digits are actually dangerous. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& 
</span>        strchr<span class='Parentheses'>(</span><span class='String'>"\\.abcdefghijklmnopqrstuvwxyz0123456789"</span><span class='Delimiter'>, 
</span>               <a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY delimiter cannot be \"%s\""</span><span class='Delimiter'>, </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check header */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN118"><span class='Ref_to_Member'>header_line</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY HEADER available only in CSV mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check quote */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY quote available only in CSV mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY quote must be a single one-byte character"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY delimiter and quote must be different"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check escape */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY escape available only in CSV mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY escape must be a single one-byte character"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check force_quote */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN125"><span class='Ref_to_Member'>force_quote</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN126"><span class='Ref_to_Member'>force_quote_all</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY force quote available only in CSV mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN125"><span class='Ref_to_Member'>force_quote</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN126"><span class='Ref_to_Member'>force_quote_all</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="copy.c.html#LN1015"><span class='Ref_to_Parameter'>is_from</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY force quote only available using COPY TO"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check force_notnull */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN128"><span class='Ref_to_Member'>force_notnull</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY force not null available only in CSV mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN128"><span class='Ref_to_Member'>force_notnull</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN1015"><span class='Ref_to_Parameter'>is_from</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY force not null only available using COPY FROM"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check force_null */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN130"><span class='Ref_to_Member'>force_null</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY force null available only in CSV mode"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN130"><span class='Ref_to_Member'>force_null</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN1015"><span class='Ref_to_Parameter'>is_from</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY force null only available using COPY FROM"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't allow the delimiter to appear in the null string. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY delimiter must not appear in the NULL specification"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't allow the CSV quote char to appear in the null string. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>&& 
</span>        strchr<span class='Parentheses'>(</span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1014"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"CSV quote character must not appear in the NULL specification"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ProcessCopyOptions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Common setup routines used by BeginCopyFrom and BeginCopyTo. 
 * 
 * Iff &LT;binary&GT;, unload or reload in the binary format, as opposed to the 
 * more wasteful but more robust and portable text format. 
 * 
 * Iff &LT;oids&GT;, unload or reload the format that includes OID information. 
 * On input, we accept OIDs whether or not the table has an OID column, 
 * but silently drop them if it does not.  On output, we report an error 
 * if the user asks for OIDs in a table that has none (not providing an 
 * OID column might seem friendlier, but could seriously confuse programs). 
 * 
 * If in the text format, delimit columns with delimiter &LT;delim&GT; and print 
 * NULL values as &LT;null_print&GT;. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> 
<a name="LN1371"></a><span class='Declare_Function'>BeginCopy</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN1372"></a>          <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_from</span><span class='Delimiter'>, 
</span><a name="LN1373"></a>          <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN1374"></a>          <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>raw_query</span><span class='Delimiter'>, 
</span><a name="LN1375"></a>          <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>queryRelId</span><span class='Delimiter'>, 
</span><a name="LN1376"></a>          <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, 
</span><a name="LN1377"></a>          <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1379"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN1380"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN1381"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_phys_attrs</span><span class='Delimiter'>; 
</span><a name="LN1382"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate workspace and zero all fields */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN94"><span class='Ref_to_Struct'>CopyStateData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN94"><span class='Ref_to_Struct'>CopyStateData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We allocate everything used by a cstate in a new memory context. This 
     * avoids memory leaks during repeated use of COPY in a query. 
     */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN145"><span class='Ref_to_Member'>copycontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                <span class='String'>"COPY"</span><span class='Delimiter'>, 
</span>                                                <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN1382"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN145"><span class='Ref_to_Member'>copycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract options from the statement node tree */ 
</span>    <a href="../../include/commands/copy.h.html#LN29"><span class='Ref_to_Proto'>ProcessCopyOptions</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1371"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1372"><span class='Ref_to_Parameter'>is_from</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1377"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Process the source/target relation or query */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1373"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1374"><span class='Ref_to_Parameter'>raw_query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1373"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Don't allow COPY w/ OIDs to or from a table without them */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" does not have OIDs"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Initialize state for CopyFrom tuple routing. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1372"><span class='Ref_to_Parameter'>is_from</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN1373"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1419"></a>            <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Operator'>*</span><span class='Declare_Local'>partition_dispatch_info</span><span class='Delimiter'>; 
</span><a name="LN1420"></a>            <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>partitions</span><span class='Delimiter'>; 
</span><a name="LN1421"></a>            <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>**</span><span class='Declare_Local'>partition_tupconv_maps</span><span class='Delimiter'>; 
</span><a name="LN1422"></a>            <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>partition_tuple_slot</span><span class='Delimiter'>; 
</span><a name="LN1423"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>num_parted</span><span class='Delimiter'>, 
</span><a name="LN1424"></a>                        <span class='Declare_Local'>num_partitions</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/executor/executor.h.html#LN208"><span class='Ref_to_Proto'>ExecSetupPartitionTupleRouting</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1373"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="copy.c.html#LN1419"><span class='Ref_To_Local'>partition_dispatch_info</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="copy.c.html#LN1420"><span class='Ref_To_Local'>partitions</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="copy.c.html#LN1421"><span class='Ref_To_Local'>partition_tupconv_maps</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="copy.c.html#LN1422"><span class='Ref_To_Local'>partition_tuple_slot</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="copy.c.html#LN1423"><span class='Ref_To_Local'>num_parted</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN1424"><span class='Ref_To_Local'>num_partitions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN167"><span class='Ref_to_Member'>partition_dispatch_info</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1419"><span class='Ref_To_Local'>partition_dispatch_info</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN168"><span class='Ref_to_Member'>num_dispatch</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1423"><span class='Ref_To_Local'>num_parted</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN170"><span class='Ref_to_Member'>partitions</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1420"><span class='Ref_To_Local'>partitions</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN169"><span class='Ref_to_Member'>num_partitions</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1424"><span class='Ref_To_Local'>num_partitions</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN171"><span class='Ref_to_Member'>partition_tupconv_maps</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1421"><span class='Ref_To_Local'>partition_tupconv_maps</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN172"><span class='Ref_to_Member'>partition_tuple_slot</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1422"><span class='Ref_To_Local'>partition_tuple_slot</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_from&&rel-&GT;rd_rel-... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1442"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rewritten</span><span class='Delimiter'>; 
</span><a name="LN1443"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN1444"></a>        <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN1445"></a>        <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1372"><span class='Ref_to_Parameter'>is_from</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Don't allow COPY w/ OIDs from a query */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY (query) WITH OIDS is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Run parse analysis and rewrite.  Note this also acquires sufficient 
         * locks on the source table(s). 
         * 
         * Because the parser and planner tend to scribble on their input, we 
         * make a preliminary copy of the source querytree.  This prevents 
         * problems in the case that the COPY is in a portal or plpgsql 
         * function and is executed repeatedly.  (See also the same hack in 
         * DECLARE CURSOR and PREPARE.)  XXX FIXME someday. 
         */ 
</span>        <a href="copy.c.html#LN1442"><span class='Ref_To_Local'>rewritten</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN50"><span class='Ref_to_Proto'>pg_analyze_and_rewrite</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1374"><span class='Ref_to_Parameter'>raw_query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="copy.c.html#LN1371"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN167"><span class='Ref_to_Member'>p_sourcetext</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check that we got back something we can work with */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1442"><span class='Ref_To_Local'>rewritten</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DO INSTEAD NOTHING rules are not supported for COPY"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1442"><span class='Ref_To_Local'>rewritten</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1479"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* examine queries to determine which error message to issue */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1479"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1442"><span class='Ref_To_Local'>rewritten</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1484"></a>                <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>q</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1479"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1484"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN111"><span class='Ref_to_Member'>querySource</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN42"><span class='Ref_to_EnumConst'>QSRC_QUAL_INSTEAD_RULE</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conditional DO INSTEAD rules are not supported for COPY"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1484"><span class='Ref_To_Local'>q</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN111"><span class='Ref_to_Member'>querySource</span></a> <span class='Operator'>== </span><a href="../../include/nodes/parsenodes.h.html#LN43"><span class='Ref_to_EnumConst'>QSRC_NON_INSTEAD_RULE</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DO ALSO rules are not supported for the COPY"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"multi-statement DO INSTEAD rules are not supported for COPY"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if list_length(rewritten... &raquo; </span> 
 
        <a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1442"><span class='Ref_To_Local'>rewritten</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The grammar allows SELECT INTO, but we don't support that */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>            <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3108"><span class='Ref_to_Struct'>CreateTableAsStmt</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY (SELECT INTO) is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Similarly the grammar doesn't enforce the presence of a RETURNING 
         * clause, but this is required here. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a> <span class='Operator'>&& 
</span>            <a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN143"><span class='Ref_to_Member'>returningList</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN652"><span class='Ref_to_EnumConst'>CMD_INSERT</span></a> <span class='Operator'>|| 
</span>                   <a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN651"><span class='Ref_to_EnumConst'>CMD_UPDATE</span></a> <span class='Operator'>|| 
</span>                   <a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN653"><span class='Ref_to_EnumConst'>CMD_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY query must have a RETURNING clause"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* plan the query */ 
</span>        <a href="copy.c.html#LN1444"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN59"><span class='Ref_to_Proto'>pg_plan_query</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1443"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * With row level security and a user using "COPY relation TO", we 
         * have to convert the "COPY relation TO" to a query-based COPY (eg: 
         * "COPY (SELECT * FROM relation) TO"), to allow the rewriter to add 
         * in any RLS clauses. 
         * 
         * When this happens, we are passed in the relid of the originally 
         * found relation (which we have locked).  As the planner will look up 
         * the relation again, we double-check here to make sure it found the 
         * same one that we have locked. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1375"><span class='Ref_to_Parameter'>queryRelId</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Note that with RLS involved there may be multiple relations, 
             * and while the one we need is almost certainly first, we don't 
             * make any guarantees of that in the planner, so check the whole 
             * list and make sure we find the original relation. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN231"><span class='Ref_to_Proto'>list_member_oid</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1444"><span class='Ref_To_Local'>plan</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN87"><span class='Ref_to_Member'>relationOids</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1375"><span class='Ref_to_Parameter'>queryRelId</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation referenced by COPY statement has changed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Use a snapshot with an updated command ID to ensure this query sees 
         * results of any previously executed queries. 
         */ 
</span>        <a href="../../include/utils/snapmgr.h.html#LN74"><span class='Ref_to_Proto'>PushCopiedSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/snapmgr.h.html#LN75"><span class='Ref_to_Proto'>UpdateActiveSnapshotCommandId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create dest receiver for COPY OUT */ 
</span>        <a href="copy.c.html#LN1445"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../tcop/dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN95"><span class='Ref_to_EnumConst'>DestCopyOut</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>((</span><a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN1445"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>cstate <span class='Operator'>= </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create a QueryDesc requesting no output */ 
</span>        <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1444"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1371"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN167"><span class='Ref_to_Member'>p_sourcetext</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                            <a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                                            <a href="copy.c.html#LN1445"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Call ExecutorStart to prepare the plan for execution. 
         * 
         * ExecutorStart computes a result tupdesc for us 
         */ 
</span>        <a href="../executor/execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Generate or convert list of attributes to process */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN321"><span class='Ref_to_Proto'>CopyGetAttnums</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1376"><span class='Ref_to_Parameter'>attnamelist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN1381"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert FORCE_QUOTE name list to per-column flags, check validity */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN127"><span class='Ref_to_Member'>force_quote_flags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1381"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN126"><span class='Ref_to_Member'>force_quote_all</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1592"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1592"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN1592"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN1381"><span class='Ref_To_Local'>num_phys_attrs</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN1592"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN127"><span class='Ref_to_Member'>force_quote_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1592"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN125"><span class='Ref_to_Member'>force_quote</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1599"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attnums</span><span class='Delimiter'>; 
</span><a name="LN1600"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1599"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN321"><span class='Ref_to_Proto'>CopyGetAttnums</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN125"><span class='Ref_to_Member'>force_quote</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1600"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1599"><span class='Ref_To_Local'>attnums</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1606"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1600"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1606"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FORCE_QUOTE column \"%s\" not referenced by COPY"</span><span class='Delimiter'>, 
</span>                          <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1606"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN127"><span class='Ref_to_Member'>force_quote_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1606"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Convert FORCE_NOT_NULL name list to per-column flags, check validity */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN129"><span class='Ref_to_Member'>force_notnull_flags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1381"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN128"><span class='Ref_to_Member'>force_notnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1621"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attnums</span><span class='Delimiter'>; 
</span><a name="LN1622"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1621"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN321"><span class='Ref_to_Proto'>CopyGetAttnums</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN128"><span class='Ref_to_Member'>force_notnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1622"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1621"><span class='Ref_To_Local'>attnums</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1628"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1622"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1628"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FORCE_NOT_NULL column \"%s\" not referenced by COPY"</span><span class='Delimiter'>, 
</span>                       <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1628"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN129"><span class='Ref_to_Member'>force_notnull_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1628"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Convert FORCE_NULL name list to per-column flags, check validity */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN131"><span class='Ref_to_Member'>force_null_flags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1381"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN130"><span class='Ref_to_Member'>force_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1643"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attnums</span><span class='Delimiter'>; 
</span><a name="LN1644"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1643"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN321"><span class='Ref_to_Proto'>CopyGetAttnums</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN130"><span class='Ref_to_Member'>force_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1644"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1643"><span class='Ref_To_Local'>attnums</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1650"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1644"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1650"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FORCE_NULL column \"%s\" not referenced by COPY"</span><span class='Delimiter'>, 
</span>                           <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1650"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN131"><span class='Ref_to_Member'>force_null_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1650"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Convert convert_selectively name list to per-column flags */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN132"><span class='Ref_to_Member'>convert_selectively</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1664"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attnums</span><span class='Delimiter'>; 
</span><a name="LN1665"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN134"><span class='Ref_to_Member'>convert_select_flags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1381"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1664"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN321"><span class='Ref_to_Proto'>CopyGetAttnums</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN133"><span class='Ref_to_Member'>convert_select</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1665"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1664"><span class='Ref_To_Local'>attnums</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1673"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1665"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1673"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_COLUMN_REFERENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"selected column \"%s\" not referenced by COPY"</span><span class='Delimiter'>, 
</span>                             <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1380"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1673"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN134"><span class='Ref_to_Member'>convert_select_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1673"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;convert_selec... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Use client encoding when ENCODING option is not specified. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>= </span><a href="../utils/mb/mbutils.c.html#LN315"><span class='Ref_to_Func'>pg_get_client_encoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up encoding conversion info.  Even if the file and server encodings 
     * are the same, we must apply pg_any_to_server() to validate data in 
     * multibyte encodings. 
     */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN104"><span class='Ref_to_Member'>need_transcoding</span></a> <span class='Operator'>= 
</span>        <span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a> <span class='Operator'>!= </span><a href="../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>|| 
</span>         <a href="../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* See Multibyte encoding comment above */ 
</span>    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN105"><span class='Ref_to_Member'>encoding_embeds_ascii</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN295"><span class='Ref_to_Macro'>PG_ENCODING_IS_CLIENT_ONLY</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN61"><span class='Ref_to_EnumConst'>COPY_FILE</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* default */ 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1382"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN1379"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BeginCopy &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Closes the pipe to an external program, checking the pclose() return code. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1710"></a><span class='Declare_Function'>ClosePipeToProgram</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1712"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pclose_rc</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN1710"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN112"><span class='Ref_to_Member'>is_program</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN1712"><span class='Ref_To_Local'>pclose_rc</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN88"><span class='Ref_to_Proto'>ClosePipeStream</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1710"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1712"><span class='Ref_To_Local'>pclose_rc</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not close pipe to external command: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1712"><span class='Ref_To_Local'>pclose_rc</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_EXTERNAL_ROUTINE_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"program \"%s\" failed"</span><span class='Delimiter'>, 
</span>                        <a href="copy.c.html#LN1710"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="../../common/wait_error.c.html#LN30"><span class='Ref_to_Func'>wait_result_to_str</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1712"><span class='Ref_To_Local'>pclose_rc</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Release resources allocated in a cstate for COPY TO/FROM. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1733"></a><span class='Declare_Function'>EndCopy</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN112"><span class='Ref_to_Member'>is_program</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN295"><span class='Ref_to_Proto'>ClosePipeToProgram</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not close file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                            <a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN145"><span class='Ref_to_Member'>copycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1733"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Setup CopyState to read tuples from a table or a query for COPY TO. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> 
<a name="LN1756"></a><span class='Declare_Function'>BeginCopyTo</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN1757"></a>            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN1758"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN1759"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>queryRelId</span><span class='Delimiter'>, 
</span><a name="LN1760"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, 
</span><a name="LN1761"></a>            <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_program</span><span class='Delimiter'>, 
</span><a name="LN1762"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, 
</span><a name="LN1763"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1765"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN1766"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pipe</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN1760"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1767"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy from view \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try the COPY (SELECT ...) TO variant."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy from materialized view \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try the COPY (SELECT ...) TO variant."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy from foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try the COPY (SELECT ...) TO variant."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy from sequence \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy from partitioned table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try the COPY (SELECT ...) TO variant."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy from non-table relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel!=NULL&&rel-&GT;rd_re... &raquo; </span> 
 
    <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN291"><span class='Ref_to_Proto'>BeginCopy</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1756"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="copy.c.html#LN1757"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1758"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1759"><span class='Ref_to_Parameter'>queryRelId</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1762"><span class='Ref_to_Parameter'>attnamelist</span></a><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN1763"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN1767"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN145"><span class='Ref_to_Member'>copycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1766"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN1761"><span class='Ref_to_Parameter'>is_program</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* the grammar does not allow this */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>!= </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>= </span>stdout<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1760"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN112"><span class='Ref_to_Member'>is_program</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1761"><span class='Ref_to_Parameter'>is_program</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1761"><span class='Ref_to_Parameter'>is_program</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN87"><span class='Ref_to_Proto'>OpenPipeStream</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not execute command \"%s\": %m"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1833"></a>            <a href="../../include/port/win32.h.html#LN422"><span class='Ref_to_Typedef'>mode_t</span></a>      <span class='Declare_Local'>oumask</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* Pre-existing umask value */ 
</span><a name="LN1834"></a>            <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Prevent write to relative path ... too easy to shoot oneself in 
             * the foot by overwriting a database file ... 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1760"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relative path not allowed for COPY to file"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN1833"><span class='Ref_To_Local'>oumask</span></a> <span class='Operator'>= </span>umask<span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN448"><span class='Ref_to_Const'>S_IWGRP</span></a> <span class='Operator'>| </span><a href="../../include/port/win32.h.html#LN452"><span class='Ref_to_Const'>S_IWOTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN1035"><span class='Ref_to_Const'>PG_BINARY_W</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            umask<span class='Parentheses'>(</span><a href="copy.c.html#LN1833"><span class='Ref_To_Local'>oumask</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* copy errno because ereport subfunctions might change it */ 
</span><a name="LN1851"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\" for writing: %m"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="copy.c.html#LN1851"><span class='Ref_To_Local'>save_errno</span></a> <span class='Operator'>== </span>ENOENT <span class='Operator'>|| </span><a href="copy.c.html#LN1851"><span class='Ref_To_Local'>save_errno</span></a> <span class='Operator'>== </span>EACCES<span class='Parentheses'>) </span><span class='Operator'>? 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"COPY TO instructs the PostgreSQL server process to write a file. "</span> 
                                 <span class='String'>"You may want a client-side facility such as psql's \\copy."</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>fstat<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN1834"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1834"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a directory"</span><span class='Delimiter'>, </span><a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1767"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN1765"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BeginCopyTo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This intermediate routine exists mainly to localize the effects of setjmp 
 * so we don't need to plaster a lot of variables with "volatile". 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN1885"></a><span class='Declare_Function'>DoCopyTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1887"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pipe</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN1885"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1888"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>fe_copy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN1887"><span class='Ref_To_Local'>pipe</span></a> <span class='Operator'>&& </span><a href="../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1889"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>processed</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1888"><span class='Ref_To_Local'>fe_copy</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN326"><span class='Ref_to_Proto'>SendCopyBegin</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1885"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1889"><span class='Ref_To_Local'>processed</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN301"><span class='Ref_to_Proto'>CopyTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1885"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1888"><span class='Ref_To_Local'>fe_copy</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN328"><span class='Ref_to_Proto'>SendCopyEnd</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1885"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Make sure we turn off old-style COPY OUT mode upon error. It is 
         * okay to do this in all cases, since it does nothing if the mode is 
         * not on. 
         */ 
</span>        <a href="../../include/libpq/libpq.h.html#LN46"><span class='Ref_to_Macro'>pq_endcopyout</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN1889"><span class='Ref_To_Local'>processed</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DoCopyTo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Clean up storage and release resources for COPY TO. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1920"></a><span class='Declare_Function'>EndCopyTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1920"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Close down the query and free resources. */ 
</span>        <a href="../../include/executor/executor.h.html#LN173"><span class='Ref_to_Proto'>ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1920"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/executor.h.html#LN175"><span class='Ref_to_Proto'>ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1920"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/execdesc.h.html#LN67"><span class='Ref_to_Proto'>FreeQueryDesc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1920"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Clean up storage */ 
</span>    <a href="copy.c.html#LN294"><span class='Ref_to_Proto'>EndCopy</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1920"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Copy from relation or query TO file. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN1939"></a><span class='Declare_Function'>CopyTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1941"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN1942"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num_phys_attrs</span><span class='Delimiter'>; 
</span><a name="LN1943"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN1944"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span><a name="LN1945"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>processed</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN1941"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="copy.c.html#LN1941"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN46"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN1943"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1941"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN1942"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1941"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN121"><span class='Ref_to_Member'>null_print_client</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* default */ 
</span> 
    <span class='Comment_Multi_Line'>/* We use fe_msgbuf as a per-row buffer regardless of copy_dest */ 
</span>    <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN99"><span class='Ref_to_Member'>fe_msgbuf</span></a> <span class='Operator'>= </span><a href="../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get info about the columns we need to process. */ 
</span>    <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN150"><span class='Ref_to_Member'>out_functions</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1942"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1944"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1962"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1944"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1963"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>out_func_oid</span><span class='Delimiter'>; 
</span><a name="LN1964"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isvarlena</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/lsyscache.h.html#LN164"><span class='Ref_to_Proto'>getTypeBinaryOutputInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1943"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1962"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="copy.c.html#LN1963"><span class='Ref_To_Local'>out_func_oid</span></a><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="copy.c.html#LN1964"><span class='Ref_To_Local'>isvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1943"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1962"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="copy.c.html#LN1963"><span class='Ref_To_Local'>out_func_oid</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="copy.c.html#LN1964"><span class='Ref_To_Local'>isvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1963"><span class='Ref_To_Local'>out_func_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN150"><span class='Ref_to_Member'>out_functions</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN1962"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create a temporary memory context that we can reset once per row to 
     * recover palloc'd memory.  This avoids any problems with leaks inside 
     * datatype output routines, and should be faster than retail pfree's 
     * anyway.  (We don't need a whole econtext as CopyFrom does.) 
     */ 
</span>    <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN151"><span class='Ref_to_Member'>rowcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                               <span class='String'>"COPY TO"</span><span class='Delimiter'>, 
</span>                                               <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Generate header for a binary copy */ 
</span><a name="LN1990"></a>        <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Signature */ 
</span>        <a href="copy.c.html#LN329"><span class='Ref_to_Proto'>CopySendData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN287"><span class='Ref_to_Global_Var'>BinarySignature</span></a><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Flags field */ 
</span>        <a href="copy.c.html#LN1990"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN1990"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>|= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>16</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN335"><span class='Ref_to_Proto'>CopySendInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1990"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* No header extension */ 
</span>        <a href="copy.c.html#LN1990"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN335"><span class='Ref_to_Proto'>CopySendInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1990"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For non-binary copy, we need to convert null_print to file 
         * encoding, because it will be sent directly with CopySendString. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN104"><span class='Ref_to_Member'>need_transcoding</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN121"><span class='Ref_to_Member'>null_print_client</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN567"><span class='Ref_to_Proto'>pg_server_to_any</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, 
</span>                                                      <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN120"><span class='Ref_to_Member'>null_print_len</span></a><span class='Delimiter'>, 
</span>                                                      <a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if a header has been requested send the line */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN118"><span class='Ref_to_Member'>header_line</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2017"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>hdr_delim</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1944"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2021"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1944"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2022"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2017"><span class='Ref_To_Local'>hdr_delim</span></a><span class='Parentheses'>) 
</span>                    <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN2017"><span class='Ref_To_Local'>hdr_delim</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN2022"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1943"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2021"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN319"><span class='Ref_to_Proto'>CopyAttributeOutCSV</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2022"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="copy.c.html#LN332"><span class='Ref_to_Proto'>CopySendEndOfRow</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;header_line &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2040"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN2041"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN2042"></a>        <a href="../../include/access/heapam.h.html#LN99"><span class='Ref_to_Typedef'>HeapScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span><a name="LN2043"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN2040"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1942"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN2041"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1942"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN2042"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN108"><span class='Ref_to_Proto'>heap_beginscan</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN1945"><span class='Ref_To_Local'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN2043"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN127"><span class='Ref_to_Proto'>heap_getnext</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2042"><span class='Ref_To_Local'>scandesc</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Deconstruct the tuple ... faster than repeated heap_getattr */ 
</span>            <a href="../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2043"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN1941"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2040"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2041"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Format and send the data */ 
</span>            <a href="copy.c.html#LN302"><span class='Ref_to_Proto'>CopyOneRowTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2043"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="copy.c.html#LN2040"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2041"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN1945"><span class='Ref_To_Local'>processed</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/access/heapam.h.html#LN126"><span class='Ref_to_Proto'>heap_endscan</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2042"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2040"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2041"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;rel &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* run the plan --- the dest receiver will send tuples */ 
</span>        <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>, </span><span class='Number'>0L</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN1945"><span class='Ref_To_Local'>processed</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN109"><span class='Ref_to_Member'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN40"><span class='Ref_to_Member'>dest</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>processed<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Generate trailer for a binary copy */ 
</span>        <a href="copy.c.html#LN337"><span class='Ref_to_Proto'>CopySendInt16</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Need to flush out the trailer */ 
</span>        <a href="copy.c.html#LN332"><span class='Ref_to_Proto'>CopySendEndOfRow</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN1939"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN151"><span class='Ref_to_Member'>rowcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN1945"><span class='Ref_To_Local'>processed</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyTo &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Emit one row during CopyTo(). 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2092"></a><span class='Declare_Function'>CopyOneRowTo</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tupleOid</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2094"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_delim</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN2095"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>out_functions</span> <span class='Operator'>= </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN150"><span class='Ref_to_Member'>out_functions</span></a><span class='Delimiter'>; 
</span><a name="LN2096"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2097"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span><a name="LN2098"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>string</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN151"><span class='Ref_to_Member'>rowcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2096"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN151"><span class='Ref_to_Member'>rowcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Binary per-tuple header */ 
</span>        <a href="copy.c.html#LN337"><span class='Ref_to_Proto'>CopySendInt16</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Send OID if wanted --- note attnumlist doesn't include it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Hack --- assume Oid is same size as int32 */ 
</span>            <a href="copy.c.html#LN335"><span class='Ref_to_Proto'>CopySendInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN335"><span class='Ref_to_Proto'>CopySendInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>tupleOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Text format has no per-tuple header, but send OID if wanted */ 
</span>        <span class='Comment_Multi_Line'>/* Assume digits don't need any quoting or encoding conversion */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN2098"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/oid.c.html#LN125"><span class='Ref_to_Func'>oidout</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>tupleOid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN330"><span class='Ref_to_Proto'>CopySendString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2098"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN2094"><span class='Ref_To_Local'>need_delim</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2097"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2130"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2097"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2131"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2130"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2132"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span> <span class='Operator'>= </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2130"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2094"><span class='Ref_To_Local'>need_delim</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN2094"><span class='Ref_To_Local'>need_delim</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2132"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN330"><span class='Ref_to_Proto'>CopySendString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN121"><span class='Ref_to_Member'>null_print_client</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN335"><span class='Ref_to_Proto'>CopySendInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN2098"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN2095"><span class='Ref_To_Local'>out_functions</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2130"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                            <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>                    <a href="copy.c.html#LN319"><span class='Ref_to_Proto'>CopyAttributeOutCSV</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2098"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, 
</span>                                        <a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN127"><span class='Ref_to_Member'>force_quote_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2130"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="copy.c.html#LN318"><span class='Ref_to_Proto'>CopyAttributeOutText</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2098"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2163"></a>                <a href="../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>outputbytes</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN2163"><span class='Ref_To_Local'>outputbytes</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN652"><span class='Ref_to_Proto'>SendFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN2095"><span class='Ref_To_Local'>out_functions</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2130"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                               <span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN335"><span class='Ref_to_Proto'>CopySendInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2163"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN329"><span class='Ref_to_Proto'>CopySendData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2163"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2163"><span class='Ref_To_Local'>outputbytes</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <a href="copy.c.html#LN332"><span class='Ref_to_Proto'>CopySendEndOfRow</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2092"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2096"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyOneRowTo &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * error context callback for COPY FROM 
 * 
 * The argument for the error context must be CopyState. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2186"></a><span class='Declare_Function'>CopyFromErrorCallback</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2188"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a><span class='Parentheses'>) </span><a href="copy.c.html#LN2186"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* can't usefully display the data */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a><span class='Parentheses'>) 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"COPY %s, line %d, column %s"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            errcontext<span class='Parentheses'>(</span><span class='String'>"COPY %s, line %d"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* error is relevant to a particular column */ 
</span><a name="LN2206"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attval</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN2206"><span class='Ref_To_Local'>attval</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN323"><span class='Ref_to_Proto'>limit_printout_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"COPY %s, line %d, column %s: \"%s\""</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2206"><span class='Ref_To_Local'>attval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2206"><span class='Ref_To_Local'>attval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* error is relevant to a particular column, value is NULL */ 
</span>            errcontext<span class='Parentheses'>(</span><span class='String'>"COPY %s, line %d, column %s: null input"</span><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Delimiter'>, 
</span>                       <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Error is relevant to a particular line. 
             * 
             * If line_buf still contains the correct line, and it's already 
             * transcoded, print it. If it's still in a foreign encoding, it's 
             * quite likely that the error is precisely a failure to do 
             * encoding conversion (ie, bad data). We dare not try to convert 
             * it, and at present there's no way to regurgitate it without 
             * conversion. So we have to punt and just report the line number. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN198"><span class='Ref_to_Member'>line_buf_valid</span></a> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN197"><span class='Ref_to_Member'>line_buf_converted</span></a> <span class='Operator'>|| !</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN104"><span class='Ref_to_Member'>need_transcoding</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2236"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lineval</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN2236"><span class='Ref_To_Local'>lineval</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN323"><span class='Ref_to_Proto'>limit_printout_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                errcontext<span class='Parentheses'>(</span><span class='String'>"COPY %s, line %d: \"%s\""</span><span class='Delimiter'>, 
</span>                           <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2236"><span class='Ref_To_Local'>lineval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2236"><span class='Ref_To_Local'>lineval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                errcontext<span class='Parentheses'>(</span><span class='String'>"COPY %s, line %d"</span><span class='Delimiter'>, 
</span>                           <a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2188"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end CopyFromErrorCallback &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Make sure we don't print an unreasonable amount of COPY data in a message. 
 * 
 * It would seem a lot easier to just use the sprintf "precision" limit to 
 * truncate the string.  However, some versions of glibc have a bug/misfeature 
 * that vsnprintf will always fail (return -1) if it is asked to truncate 
 * a string that contains invalid byte sequences for the current encoding. 
 * So, do our own truncation.  We return a pstrdup'd copy of the input. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2262"></a><span class='Declare_Function'>limit_printout_length</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2264"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_COPY_DATA_DISPLAY</span> <span class='Number'>100</span> 
 
<a name="LN2266"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>slen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN2262"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2267"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN2268"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fast path if definitely okay */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2266"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&LT;= </span><a href="copy.c.html#LN2264"><span class='Ref_to_Const'>MAX_COPY_DATA_DISPLAY</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2262"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Apply encoding-dependent truncation */ 
</span>    <a href="copy.c.html#LN2267"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN530"><span class='Ref_to_Proto'>pg_mbcliplen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2262"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2266"><span class='Ref_To_Local'>slen</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2264"><span class='Ref_to_Const'>MAX_COPY_DATA_DISPLAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Truncate, and add "..." to show we truncated the input. 
     */ 
</span>    <a href="copy.c.html#LN2268"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2267"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="copy.c.html#LN2268"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2262"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2267"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2268"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN2267"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='String'>"..."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN2268"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end limit_printout_length &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy FROM file to relation. 
 */ 
</span><a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> 
<a name="LN2291"></a><span class='Declare_Function'>CopyFrom</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2293"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2294"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN2295"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN2296"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN2297"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span><span class='Delimiter'>; 
</span><a name="LN2298"></a>    <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>saved_resultRelInfo</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2299"></a>    <a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>estate</span> <span class='Operator'>= </span><a href="../executor/execUtils.c.html#LN78"><span class='Ref_to_Func'>CreateExecutorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* for ExecConstraints() */ 
</span><a name="LN2300"></a>    <a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>econtext</span><span class='Delimiter'>; 
</span><a name="LN2301"></a>    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myslot</span><span class='Delimiter'>; 
</span><a name="LN2302"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
<a name="LN2304"></a>    ErrorContextCallback <span class='Declare_Local'>errcallback</span><span class='Delimiter'>; 
</span><a name="LN2305"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Local'>mycid</span> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN339"><span class='Ref_to_Proto'>GetCurrentCommandId</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2306"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hi_options</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* start with default heap_insert options */ 
</span><a name="LN2307"></a>    <a href="../../include/access/heapam.h.html#LN32"><span class='Ref_to_Typedef'>BulkInsertState</span></a> <span class='Declare_Local'>bistate</span><span class='Delimiter'>; 
</span><a name="LN2308"></a>    <a href="../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>processed</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2309"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>useHeapMultiInsert</span><span class='Delimiter'>; 
</span><a name="LN2310"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nBufferedTuples</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2311"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>prev_leaf_part_index</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
<a name="LN2313"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_BUFFERED_TUPLES</span> <span class='Number'>1000</span> 
<a name="LN2314"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>bufferedTuples</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* initialize to silence warning */ 
</span><a name="LN2315"></a>    <a href="../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>bufferedTuplesSize</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2316"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>firstBufferedLineNo</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The target must be a plain relation or have an INSTEAD OF INSERT row 
     * trigger.  (Currently, such triggers are only allowed on views, so we 
     * only hint about them in the view case.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a> <span class='Operator'>&& 
</span>        <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>!= </span><a href="../../include/catalog/pg_class.h.html#LN167"><span class='Ref_to_Const'>RELKIND_PARTITIONED_TABLE</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a> <span class='Operator'>&& 
</span>          <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN119"><span class='Ref_to_Member'>trigdesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN56"><span class='Ref_to_Member'>trig_insert_instead_row</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy to view \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"To enable copying to a view, provide an INSTEAD OF INSERT trigger."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy to materialized view \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN166"><span class='Ref_to_Const'>RELKIND_FOREIGN_TABLE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy to foreign table \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relkind <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy to sequence \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot copy to non-table relation \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;rel-&GT;rd_rel-&GT;... &raquo; </span> 
 
    <a href="copy.c.html#LN2294"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Check to see if we can avoid writing WAL 
     * 
     * If archive logging/streaming is not enabled *and* either 
     *  - table was created in same transaction as this COPY 
     *  - data is being written to relfilenode created in this transaction 
     * then we can skip writing WAL.  It's safe because if the transaction 
     * doesn't commit, we'll discard the table (or the new relfilenode file). 
     * If it does commit, we'll have done the heap_sync at the bottom of this 
     * routine first. 
     * 
     * As mentioned in comments in utils/rel.h, the in-same-transaction test 
     * is not always set correctly, since in rare cases rd_newRelfilenodeSubid 
     * can be cleared before the end of the transaction. The exact case is 
     * when a relation sets a new relfilenode twice in same transaction, yet 
     * the second one fails in an aborted subtransaction, e.g. 
     * 
     * BEGIN; 
     * TRUNCATE t; 
     * SAVEPOINT save; 
     * TRUNCATE t; 
     * ROLLBACK TO save; 
     * COPY ... 
     * 
     * Also, if the target file is new-in-transaction, we assume that checking 
     * FSM for free space is a waste of time, even if we must use WAL because 
     * of archiving.  This could possibly be wrong, but it's unlikely. 
     * 
     * The comments for heap_insert and RelationGetBufferForTuple specify that 
     * skipping WAL logging is only safe if we ensure that our tuples do not 
     * go into pages containing tuples from any other transactions --- but this 
     * must be the case if we have a new table or new relfilenode, so we need 
     * no additional work to enforce that. 
     *---------- 
     */ 
</span>    <span class='Comment_Multi_Line'>/* createSubid is creation check, newRelfilenodeSubid is truncation check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a> <span class='Operator'>|| 
</span>        <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>!= </span><a href="../../include/c.h.html#LN402"><span class='Ref_to_Const'>InvalidSubTransactionId</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>|= </span><a href="../../include/access/heapam.h.html#LN28"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_FSM</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/xlog.h.html#LN144"><span class='Ref_to_Macro'>XLogIsNeeded</span></a><span class='Parentheses'>())</span> 
            <a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>|= </span><a href="../../include/access/heapam.h.html#LN27"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_WAL</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Optimize if new relfilenode was created in this subxact or one of its 
     * committed children and we won't see those rows later as part of an 
     * earlier scan or command. This ensures that if this subtransaction 
     * aborts then the frozen rows won't be visible after xact cleanup. Note 
     * that the stronger test of exactly which subtransaction created it is 
     * crucial for correctness of this optimization. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN116"><span class='Ref_to_Member'>freeze</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/snapmgr.h.html#LN92"><span class='Ref_to_Proto'>ThereAreNoPriorRegisteredSnapshots</span></a><span class='Parentheses'>() </span><span class='Operator'>|| !</span><a href="../../include/utils/portal.h.html#LN238"><span class='Ref_to_Proto'>ThereAreNoReadyPortals</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TRANSACTION_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot perform FREEZE because of prior transaction activity"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN109"><span class='Ref_to_Member'>rd_createSubid</span></a> <span class='Operator'>!= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>() </span><span class='Operator'>&& 
</span>         <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN110"><span class='Ref_to_Member'>rd_newRelfilenodeSubid</span></a> <span class='Operator'>!= </span><a href="../../include/access/xact.h.html#LN336"><span class='Ref_to_Proto'>GetCurrentSubTransactionId</span></a><span class='Parentheses'>())</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot perform FREEZE because the table was not created or truncated in the current subtransaction"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>|= </span><a href="../../include/access/heapam.h.html#LN29"><span class='Ref_to_Const'>HEAP_INSERT_FROZEN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need a ResultRelInfo so we can use the regular executor's 
     * index-entry-making machinery.  (There used to be a huge amount of code 
     * here that basically duplicated execUtils.c ...) 
     */ 
</span>    <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/executor.h.html#LN180"><span class='Ref_to_Proto'>InitResultRelInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                      <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                      <span class='Number'>1</span><span class='Delimiter'>,</span>        <span class='Comment_Single_Line'>/* dummy rangetable index */ 
</span>                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                      <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../executor/execIndexing.c.html#LN147"><span class='Ref_to_Func'>ExecOpenIndices</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN420"><span class='Ref_to_Member'>es_result_relations</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN421"><span class='Ref_to_Member'>es_num_result_relations</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN410"><span class='Ref_to_Member'>es_range_table</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN165"><span class='Ref_to_Member'>range_table</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up a tuple slot too */ 
</span>    <a href="copy.c.html#LN2301"><span class='Ref_To_Local'>myslot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2301"><span class='Ref_To_Local'>myslot</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2294"><span class='Ref_To_Local'>tupDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Triggers might need a slot as well */ 
</span>    <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN436"><span class='Ref_to_Member'>es_trig_tuple_slot</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN402"><span class='Ref_to_Proto'>ExecInitExtraTupleSlot</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's more efficient to prepare a bunch of tuples for insertion, and 
     * insert them in one heap_multi_insert() call, than call heap_insert() 
     * separately for every tuple. However, we can't do that if there are 
     * BEFORE/INSTEAD OF triggers, or we need to evaluate volatile default 
     * expressions. Such triggers or expressions might query the table we're 
     * inserting to, and act differently if the tuples that have already been 
     * processed and prepared for insertion are not there.  We also can't do 
     * it if the table is partitioned. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>         <span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a> <span class='Operator'>|| 
</span>          <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN56"><span class='Ref_to_Member'>trig_insert_instead_row</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>        <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN167"><span class='Ref_to_Member'>partition_dispatch_info</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN164"><span class='Ref_to_Member'>volatile_defexprs</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN2309"><span class='Ref_To_Local'>useHeapMultiInsert</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN2309"><span class='Ref_To_Local'>useHeapMultiInsert</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN2314"><span class='Ref_To_Local'>bufferedTuples</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2313"><span class='Ref_to_Const'>MAX_BUFFERED_TUPLES</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Prepare to catch AFTER triggers. */ 
</span>    <a href="../../include/commands/trigger.h.html#LN187"><span class='Ref_to_Proto'>AfterTriggerBeginQuery</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check BEFORE STATEMENT insertion triggers. It's debatable whether we 
     * should do this for COPY, since it's not really an "INSERT" statement as 
     * such. However, executing these triggers maintains consistency with the 
     * EACH ROW triggers that we already fire on COPY. 
     */ 
</span>    <a href="../../include/commands/trigger.h.html#LN131"><span class='Ref_to_Proto'>ExecBSInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN2295"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2294"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2296"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2294"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN2307"><span class='Ref_To_Local'>bistate</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN147"><span class='Ref_to_Proto'>GetBulkInsertState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2300"><span class='Ref_To_Local'>econtext</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN455"><span class='Ref_to_Macro'>GetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up callback to identify error line number */ 
</span>    <a href="copy.c.html#LN2304"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>callback <span class='Operator'>= </span><a href="../../include/commands/copy.h.html#LN37"><span class='Ref_to_Proto'>CopyFromErrorCallback</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2304"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>arg <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2304"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous <span class='Operator'>= </span><a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a><span class='Delimiter'>; 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= &</span><a href="copy.c.html#LN2304"><span class='Ref_To_Local'>errcallback</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2502"></a>        <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Local'>slot</span><span class='Delimiter'>; 
</span><a name="LN2503"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>skip_tuple</span><span class='Delimiter'>; 
</span><a name="LN2504"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>loaded_oid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Reset the per-tuple exprcontext. We can only do this if the 
             * tuple buffer is empty. (Calling the context the per-tuple 
             * memory context is a bit of a misnomer now.) 
             */ 
</span>            <a href="../../include/executor/executor.h.html#LN464"><span class='Ref_to_Macro'>ResetPerTupleExprContext</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Switch into its memory context */ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/copy.h.html#LN33"><span class='Ref_to_Proto'>NextCopyFrom</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2300"><span class='Ref_To_Local'>econtext</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2295"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2296"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN2504"><span class='Ref_To_Local'>loaded_oid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* And now we can form the input tuple. */ 
</span>        <a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2294"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2295"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2296"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2504"><span class='Ref_To_Local'>loaded_oid</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2504"><span class='Ref_To_Local'>loaded_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Constraints might reference the tableoid column, so initialize 
         * t_tableOid before evaluating them. 
         */ 
</span>        <a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Triggers and stuff need to be invoked in query context. */ 
</span>        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2302"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Place tuple in tuple slot --- but slot shouldn't free it */ 
</span>        <a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2301"><span class='Ref_To_Local'>myslot</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine the partition to heap_insert the tuple into */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN167"><span class='Ref_to_Member'>partition_dispatch_info</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2546"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>leaf_part_index</span><span class='Delimiter'>; 
</span><a name="LN2547"></a>            <a href="../../include/access/tupconvert.h.html#LN20"><span class='Ref_to_Struct'>TupleConversionMap</span></a> <span class='Operator'>*</span><span class='Declare_Local'>map</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Away we go ... If we end up not finding a partition after all, 
             * ExecFindPartition() does not return and errors out instead. 
             * Otherwise, the returned value is to be used as an index into 
             * arrays mt_partitions[] and mt_partition_tupconv_maps[] that 
             * will get us the ResultRelInfo and TupleConversionMap for the 
             * partition, respectively. 
             */ 
</span>            <a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN214"><span class='Ref_to_Proto'>ExecFindPartition</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                             <a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN167"><span class='Ref_to_Member'>partition_dispatch_info</span></a><span class='Delimiter'>, 
</span>                                                <a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                                                <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                   <a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN169"><span class='Ref_to_Member'>num_partitions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If this tuple is mapped to a partition that is not same as the 
             * previous one, we'd better make the bulk insert mechanism gets a 
             * new buffer. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2311"><span class='Ref_To_Local'>prev_leaf_part_index</span></a> <span class='Operator'>!= </span><a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../include/access/heapam.h.html#LN149"><span class='Ref_to_Proto'>ReleaseBulkInsertStatePin</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2307"><span class='Ref_To_Local'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN2311"><span class='Ref_To_Local'>prev_leaf_part_index</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Save the old ResultRelInfo and switch to the one corresponding 
             * to the selected partition. 
             */ 
</span>            <a href="copy.c.html#LN2298"><span class='Ref_To_Local'>saved_resultRelInfo</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN170"><span class='Ref_to_Member'>partitions</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We do not yet have a way to insert into a foreign partition */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN381"><span class='Ref_to_Member'>ri_FdwRoutine</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot route inserted tuples to a foreign table"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * For ExecInsertIndexTuples() to work on the partition's indexes 
             */ 
</span>            <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We might need to convert from the parent rowtype to the 
             * partition rowtype. 
             */ 
</span>            <a href="copy.c.html#LN2547"><span class='Ref_To_Local'>map</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN171"><span class='Ref_to_Member'>partition_tupconv_maps</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2546"><span class='Ref_To_Local'>leaf_part_index</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2547"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2600"></a>                <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>partrel</span> <span class='Operator'>= </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/tupconvert.h.html#LN44"><span class='Ref_to_Proto'>do_convert_tuple</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2547"><span class='Ref_To_Local'>map</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We must use the partition's tuple descriptor from this 
                 * point on.  Use a dedicated slot from this point on until 
                 * we're finished dealing with the partition. 
                 */ 
</span>                <a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN172"><span class='Ref_to_Member'>partition_tuple_slot</span></a><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/tuptable.h.html#LN146"><span class='Ref_to_Proto'>ExecSetSlotDescriptor</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2600"><span class='Ref_To_Local'>partrel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;partition_dis... &raquo; </span> 
 
        <a href="copy.c.html#LN2503"><span class='Ref_To_Local'>skip_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* BEFORE ROW INSERT Triggers */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>            <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>= </span><a href="../../include/commands/trigger.h.html#LN135"><span class='Ref_to_Proto'>ExecBRInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* "do nothing" */ 
</span>                <a href="copy.c.html#LN2503"><span class='Ref_To_Local'>skip_tuple</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* trigger might have changed tuple */ 
</span>                <a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2503"><span class='Ref_To_Local'>skip_tuple</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>                <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN56"><span class='Ref_to_Member'>trig_insert_instead_row</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Pass the data to the INSTEAD ROW INSERT trigger */ 
</span>                <a href="../../include/commands/trigger.h.html#LN142"><span class='Ref_to_Proto'>ExecIRInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We always check the partition constraint, including when 
                 * the tuple got here via tuple-routing.  However we don't 
                 * need to in the latter case if no BR trigger is defined on 
                 * the partition.  Note that a BR trigger might modify the 
                 * tuple such that the partition constraint is no longer 
                 * satisfied, so we need to check in that case. 
                 */ 
</span><a name="LN2650"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>check_partition_constr</span> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN391"><span class='Ref_to_Member'>ri_PartitionCheck</span></a> <span class='Operator'>!= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2298"><span class='Ref_To_Local'>saved_resultRelInfo</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                    <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>&& 
</span>                      <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN54"><span class='Ref_to_Member'>trig_insert_before_row</span></a><span class='Parentheses'>))</span> 
                    <a href="copy.c.html#LN2650"><span class='Ref_To_Local'>check_partition_constr</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Check the constraints of the tuple */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN75"><span class='Ref_to_Member'>constr</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN2650"><span class='Ref_To_Local'>check_partition_constr</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/executor/executor.h.html#LN188"><span class='Ref_to_Proto'>ExecConstraints</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2309"><span class='Ref_To_Local'>useHeapMultiInsert</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Add this tuple to the tuple buffer */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="copy.c.html#LN2316"><span class='Ref_To_Local'>firstBufferedLineNo</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN2314"><span class='Ref_To_Local'>bufferedTuples</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>; 
</span>                    <a href="copy.c.html#LN2315"><span class='Ref_To_Local'>bufferedTuplesSize</span></a> <span class='Operator'>+= </span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If the buffer filled up, flush it.  Also flush if the 
                     * total size of all the tuples in the buffer becomes 
                     * large, to avoid using large amounts of memory for the 
                     * buffer when the tuples are exceptionally wide. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN2313"><span class='Ref_to_Const'>MAX_BUFFERED_TUPLES</span></a> <span class='Operator'>|| 
</span>                        <a href="copy.c.html#LN2315"><span class='Ref_To_Local'>bufferedTuplesSize</span></a> <span class='Operator'>&GT; </span><span class='Number'>65535</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="copy.c.html#LN304"><span class='Ref_to_Proto'>CopyFromInsertBatch</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2305"><span class='Ref_To_Local'>mycid</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a><span class='Delimiter'>, 
</span>                                            <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2301"><span class='Ref_To_Local'>myslot</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2307"><span class='Ref_To_Local'>bistate</span></a><span class='Delimiter'>, 
</span>                                            <a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2314"><span class='Ref_To_Local'>bufferedTuples</span></a><span class='Delimiter'>, 
</span>                                            <a href="copy.c.html#LN2316"><span class='Ref_To_Local'>firstBufferedLineNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="copy.c.html#LN2315"><span class='Ref_To_Local'>bufferedTuplesSize</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if useHeapMultiInsert &raquo; </span> 
                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2689"></a>                    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>recheckIndexes</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* OK, store the tuple and create index entries for it */ 
</span>                    <a href="../../include/access/heapam.h.html#LN151"><span class='Ref_to_Proto'>heap_insert</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2305"><span class='Ref_To_Local'>mycid</span></a><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2307"><span class='Ref_To_Local'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN374"><span class='Ref_to_Member'>ri_NumIndices</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="copy.c.html#LN2689"><span class='Ref_To_Local'>recheckIndexes</span></a> <span class='Operator'>= </span><a href="../executor/execIndexing.c.html#LN269"><span class='Ref_to_Func'>ExecInsertIndexTuples</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2502"><span class='Ref_To_Local'>slot</span></a><span class='Delimiter'>, 
</span>                                                            <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                               <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, 
</span>                                                               <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                               <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* AFTER ROW INSERT Triggers */ 
</span>                    <a href="../../include/commands/trigger.h.html#LN138"><span class='Ref_to_Proto'>ExecARInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2293"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                                         <a href="copy.c.html#LN2689"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2689"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * We count only tuples not suppressed by a BEFORE INSERT trigger; 
             * this is the same definition used by execMain.c for counting 
             * tuples inserted by an INSERT command. 
             */ 
</span>            <a href="copy.c.html#LN2308"><span class='Ref_To_Local'>processed</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2298"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2298"><span class='Ref_To_Local'>saved_resultRelInfo</span></a><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN422"><span class='Ref_to_Member'>es_result_relation_info</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !skip_tuple &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Flush any remaining buffered tuples */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN304"><span class='Ref_to_Proto'>CopyFromInsertBatch</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2305"><span class='Ref_To_Local'>mycid</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a><span class='Delimiter'>, 
</span>                            <a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2301"><span class='Ref_To_Local'>myslot</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2307"><span class='Ref_To_Local'>bistate</span></a><span class='Delimiter'>, 
</span>                            <a href="copy.c.html#LN2310"><span class='Ref_To_Local'>nBufferedTuples</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2314"><span class='Ref_To_Local'>bufferedTuples</span></a><span class='Delimiter'>, 
</span>                            <a href="copy.c.html#LN2316"><span class='Ref_To_Local'>firstBufferedLineNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Done, clean up */ 
</span>    <a href="../utils/error/elog.c.html#LN87"><span class='Ref_to_Global_Var'>error_context_stack</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2304"><span class='Ref_To_Local'>errcallback</span></a><span class='Operator'>.</span>previous<span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN148"><span class='Ref_to_Proto'>FreeBulkInsertState</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2307"><span class='Ref_To_Local'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2302"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In the old protocol, tell pqcomm that we can process normal protocol 
     * messages again. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN62"><span class='Ref_to_EnumConst'>COPY_OLD_FE</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/libpq/libpq.h.html#LN66"><span class='Ref_to_Proto'>pq_endmsgread</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Execute AFTER STATEMENT insertion triggers */ 
</span>    <a href="../../include/commands/trigger.h.html#LN133"><span class='Ref_to_Proto'>ExecASInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle queued AFTER triggers */ 
</span>    <a href="../../include/commands/trigger.h.html#LN188"><span class='Ref_to_Proto'>AfterTriggerEndQuery</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2295"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2296"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/tuptable.h.html#LN143"><span class='Ref_to_Proto'>ExecResetTupleTable</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN449"><span class='Ref_to_Member'>es_tupleTable</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../executor/execIndexing.c.html#LN222"><span class='Ref_to_Func'>ExecCloseIndices</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2297"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Close all the partitioned tables, leaf partitions, and their indices */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN167"><span class='Ref_to_Member'>partition_dispatch_info</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2763"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remember cstate-&GT;partition_dispatch_info[0] corresponds to the root 
         * partitioned table, which we must not try to close, because it is 
         * the main target table of COPY that will be closed eventually by 
         * DoCopy().  Also, tupslot is NULL for the root partitioned table. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN168"><span class='Ref_to_Member'>num_dispatch</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2773"></a>            <a href="../../include/catalog/partition.h.html#LN70"><span class='Ref_to_Typedef'>PartitionDispatch</span></a> <span class='Declare_Local'>pd</span> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN167"><span class='Ref_to_Member'>partition_dispatch_info</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2773"><span class='Ref_To_Local'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN61"><span class='Ref_to_Member'>reldesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2773"><span class='Ref_To_Local'>pd</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/partition.h.html#LN65"><span class='Ref_to_Member'>tupslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN169"><span class='Ref_to_Member'>num_partitions</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2780"></a>            <a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>resultRelInfo</span> <span class='Operator'>= </span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN170"><span class='Ref_to_Member'>partitions</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN2763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
            <a href="../executor/execIndexing.c.html#LN222"><span class='Ref_to_Func'>ExecCloseIndices</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2780"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2780"><span class='Ref_To_Local'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN373"><span class='Ref_to_Member'>ri_RelationDesc</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Release the standalone partition tuple descriptor */ 
</span>        <a href="../../include/executor/tuptable.h.html#LN145"><span class='Ref_to_Proto'>ExecDropSingleTupleTableSlot</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN172"><span class='Ref_to_Member'>partition_tuple_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;partition_dis... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Close any trigger target relations */ 
</span>    <a href="../../include/executor/executor.h.html#LN186"><span class='Ref_to_Proto'>ExecCleanUpTriggerState</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../executor/execUtils.c.html#LN176"><span class='Ref_to_Func'>FreeExecutorState</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2299"><span class='Ref_To_Local'>estate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we skipped writing WAL, then we need to sync the heap (but not 
     * indexes since those use WAL anyway) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2306"><span class='Ref_To_Local'>hi_options</span></a> <span class='Operator'>& </span><a href="../../include/access/heapam.h.html#LN27"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_WAL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN180"><span class='Ref_to_Proto'>heap_sync</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2291"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN2308"><span class='Ref_To_Local'>processed</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyFrom &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * A subroutine of CopyFrom, to write the current batch of buffered heap 
 * tuples to the heap. Also updates indexes and runs AFTER ROW INSERT 
 * triggers. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2811"></a><span class='Declare_Function'>CopyFromInsertBatch</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN402"><span class='Ref_to_Struct'>EState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>estate</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a> <span class='Declare_Parameter'>mycid</span><span class='Delimiter'>, 
</span><a name="LN2812"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>hi_options</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN369"><span class='Ref_to_Struct'>ResultRelInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>resultRelInfo</span><span class='Delimiter'>, 
</span><a name="LN2813"></a>                    <a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>myslot</span><span class='Delimiter'>, </span><a href="../../include/access/heapam.h.html#LN32"><span class='Ref_to_Typedef'>BulkInsertState</span></a> <span class='Declare_Parameter'>bistate</span><span class='Delimiter'>, 
</span><a name="LN2814"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>nBufferedTuples</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bufferedTuples</span><span class='Delimiter'>, 
</span><a name="LN2815"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>firstBufferedLineNo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2817"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2818"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2819"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_cur_lineno</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Print error context information correctly, if one of the operations 
     * below fail. 
     */ 
</span>    <a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN198"><span class='Ref_to_Member'>line_buf_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2819"><span class='Ref_To_Local'>save_cur_lineno</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * heap_multi_insert leaks memory, so switch to short-lived memory context 
     * before calling it. 
     */ 
</span>    <a href="copy.c.html#LN2817"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../../include/executor/executor.h.html#LN460"><span class='Ref_to_Macro'>GetPerTupleMemoryContext</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>estate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN153"><span class='Ref_to_Proto'>heap_multi_insert</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                      <a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>bufferedTuples</span></a><span class='Delimiter'>, 
</span>                      <a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>nBufferedTuples</span></a><span class='Delimiter'>, 
</span>                      <a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>mycid</span></a><span class='Delimiter'>, 
</span>                      <a href="copy.c.html#LN2812"><span class='Ref_to_Parameter'>hi_options</span></a><span class='Delimiter'>, 
</span>                      <a href="copy.c.html#LN2813"><span class='Ref_to_Parameter'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2817"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are any indexes, update them for all the inserted tuples, and 
     * run AFTER ROW INSERT triggers. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2812"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN374"><span class='Ref_to_Member'>ri_NumIndices</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>nBufferedTuples</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2849"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>recheckIndexes</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2815"><span class='Ref_to_Parameter'>firstBufferedLineNo</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/executor/tuptable.h.html#LN147"><span class='Ref_to_Proto'>ExecStoreTuple</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>bufferedTuples</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="copy.c.html#LN2813"><span class='Ref_to_Parameter'>myslot</span></a><span class='Delimiter'>, </span><a href="../../include/storage/buf.h.html#LN24"><span class='Ref_to_Const'>InvalidBuffer</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN2849"><span class='Ref_To_Local'>recheckIndexes</span></a> <span class='Operator'>= 
</span>                <a href="../executor/execIndexing.c.html#LN269"><span class='Ref_to_Func'>ExecInsertIndexTuples</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2813"><span class='Ref_to_Parameter'>myslot</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>bufferedTuples</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/trigger.h.html#LN138"><span class='Ref_to_Proto'>ExecARInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2812"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                 <a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>bufferedTuples</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                 <a href="copy.c.html#LN2849"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2849"><span class='Ref_To_Local'>recheckIndexes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * There's no indexes, but see if we need to run AFTER ROW INSERT triggers 
     * anyway. 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2812"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>             <a href="copy.c.html#LN2812"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN377"><span class='Ref_to_Member'>ri_TrigDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/reltrigger.h.html#LN55"><span class='Ref_to_Member'>trig_insert_after_row</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>nBufferedTuples</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2815"><span class='Ref_to_Parameter'>firstBufferedLineNo</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <a href="../../include/commands/trigger.h.html#LN138"><span class='Ref_to_Proto'>ExecARInsertTriggers</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>estate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2812"><span class='Ref_to_Parameter'>resultRelInfo</span></a><span class='Delimiter'>, 
</span>                                 <a href="copy.c.html#LN2814"><span class='Ref_to_Parameter'>bufferedTuples</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2818"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                 <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* reset cur_lineno to where we were */ 
</span>    <a href="copy.c.html#LN2811"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2819"><span class='Ref_To_Local'>save_cur_lineno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyFromInsertBatch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Setup to read tuples from a file for COPY FROM. 
 * 
 * 'rel': Used as a template for the tuples 
 * 'filename': Name of server-local file to read 
 * 'attnamelist': List of char *, columns to include. NIL selects all cols. 
 * 'options': List of DefElem. See copy_opt_item in gram.y for selections. 
 * 
 * Returns a CopyState, to be passed to NextCopyFrom and related functions. 
 */ 
</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> 
<a name="LN2894"></a><span class='Declare_Function'>BeginCopyFrom</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN2895"></a>              <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN2896"></a>              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, 
</span><a name="LN2897"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_program</span><span class='Delimiter'>, 
</span><a name="LN2898"></a>              <a href="../../include/commands/copy.h.html#LN23"><span class='Ref_to_Typedef'>copy_data_source_cb</span></a> <span class='Declare_Parameter'>data_source_cb</span><span class='Delimiter'>, 
</span><a name="LN2899"></a>              <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Delimiter'>, 
</span><a name="LN2900"></a>              <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>options</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2902"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span><span class='Delimiter'>; 
</span><a name="LN2903"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>pipe</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN2896"><span class='Ref_to_Parameter'>filename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2904"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN2905"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN2906"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>num_phys_attrs</span><span class='Delimiter'>, 
</span><a name="LN2907"></a>                <span class='Declare_Local'>num_defaults</span><span class='Delimiter'>; 
</span><a name="LN2908"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>in_functions</span><span class='Delimiter'>; 
</span><a name="LN2909"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>typioparams</span><span class='Delimiter'>; 
</span><a name="LN2910"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN2911"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>in_func_oid</span><span class='Delimiter'>; 
</span><a name="LN2912"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>defmap</span><span class='Delimiter'>; 
</span><a name="LN2913"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Declare_Local'>defexprs</span><span class='Delimiter'>; 
</span><a name="LN2914"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2915"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>volatile_defexprs</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN291"><span class='Ref_to_Proto'>BeginCopy</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2894"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="copy.c.html#LN2895"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2899"><span class='Ref_to_Parameter'>attnamelist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2900"><span class='Ref_to_Parameter'>options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2914"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN145"><span class='Ref_to_Member'>copycontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize state variables */ 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN101"><span class='Ref_to_Member'>fe_eof</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN72"><span class='Ref_to_EnumConst'>EOL_UNKNOWN</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN137"><span class='Ref_to_Member'>cur_relname</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set up variables to avoid per-attribute overhead. */ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN197"><span class='Ref_to_Member'>line_buf_converted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN207"><span class='Ref_to_Const'>RAW_BUF_SIZE</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assign range table, we'll need it in CopyFrom. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2894"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN165"><span class='Ref_to_Member'>range_table</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2894"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../include/parser/parse_node.h.html#LN168"><span class='Ref_to_Member'>p_rtable</span></a><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN2904"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2905"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2904"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2906"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2904"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2907"><span class='Ref_To_Local'>num_defaults</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2915"><span class='Ref_To_Local'>volatile_defexprs</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Pick up the required catalog information for each attribute in the 
     * relation, including the input function, the element type (to pass to 
     * the input function), and info about defaults and constraints. (Which 
     * input function we use depends on text/binary format choice.) 
     */ 
</span>    <a href="copy.c.html#LN2908"><span class='Ref_To_Local'>in_functions</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2906"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2909"><span class='Ref_To_Local'>typioparams</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2906"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2912"><span class='Ref_To_Local'>defmap</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2906"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2913"><span class='Ref_To_Local'>defexprs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2906"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="copy.c.html#LN2906"><span class='Ref_To_Local'>num_phys_attrs</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We don't need info for dropped attributes */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2905"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Fetch the input function and typioparam info */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/lsyscache.h.html#LN163"><span class='Ref_to_Proto'>getTypeBinaryInputInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2905"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="copy.c.html#LN2911"><span class='Ref_To_Local'>in_func_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN2909"><span class='Ref_To_Local'>typioparams</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/lsyscache.h.html#LN161"><span class='Ref_to_Proto'>getTypeInputInfo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2905"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="copy.c.html#LN2911"><span class='Ref_To_Local'>in_func_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN2909"><span class='Ref_To_Local'>typioparams</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2911"><span class='Ref_To_Local'>in_func_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN2908"><span class='Ref_To_Local'>in_functions</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get default info if needed */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* attribute is NOT to be copied from input */ 
</span>            <span class='Comment_Multi_Line'>/* use default value if one exists */ 
</span><a name="LN2976"></a>            <a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>defexpr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/rewrite/rewriteHandler.h.html#LN24"><span class='Ref_to_Proto'>build_column_default</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                                                                <a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2976"><span class='Ref_To_Local'>defexpr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Run the expression through planner */ 
</span>                <a href="copy.c.html#LN2976"><span class='Ref_To_Local'>defexpr</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/planner.h.html#LN53"><span class='Ref_to_Proto'>expression_planner</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2976"><span class='Ref_To_Local'>defexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Initialize executable expression in copycontext */ 
</span>                <a href="copy.c.html#LN2913"><span class='Ref_To_Local'>defexprs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2907"><span class='Ref_To_Local'>num_defaults</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../executor/execExpr.c.html#LN111"><span class='Ref_to_Func'>ExecInitExpr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2976"><span class='Ref_To_Local'>defexpr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN2912"><span class='Ref_To_Local'>defmap</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN2907"><span class='Ref_To_Local'>num_defaults</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="copy.c.html#LN2910"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN2907"><span class='Ref_To_Local'>num_defaults</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If a default expression looks at the table being loaded, 
                 * then it could give the wrong answer when using 
                 * multi-insert. Since database access can be dynamic this is 
                 * hard to test for exactly, so we use the much wider test of 
                 * whether the default expression is volatile. We allow for 
                 * the special case of when the default expression is the 
                 * nextval() of a sequence which in this specific case is 
                 * known to be safe for use with the multi-insert 
                 * optimization. Hence we use this special case function 
                 * checker rather than the standard check for 
                 * contain_volatile_functions(). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2915"><span class='Ref_To_Local'>volatile_defexprs</span></a><span class='Parentheses'>) 
</span>                    <a href="copy.c.html#LN2915"><span class='Ref_To_Local'>volatile_defexprs</span></a> <span class='Operator'>= </span><a href="../../include/optimizer/clauses.h.html#LN61"><span class='Ref_to_Proto'>contain_volatile_functions_not_nextval</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN2976"><span class='Ref_To_Local'>defexpr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if defexpr!=NULL &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !list_member_int(csta... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attnum=1;attnum&LT;=num_... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We keep those variables in cstate. */ 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN160"><span class='Ref_to_Member'>in_functions</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2908"><span class='Ref_To_Local'>in_functions</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN161"><span class='Ref_to_Member'>typioparams</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2909"><span class='Ref_To_Local'>typioparams</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN162"><span class='Ref_to_Member'>defmap</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2912"><span class='Ref_To_Local'>defmap</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN163"><span class='Ref_to_Member'>defexprs</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2913"><span class='Ref_To_Local'>defexprs</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN164"><span class='Ref_to_Member'>volatile_defexprs</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2915"><span class='Ref_To_Local'>volatile_defexprs</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN156"><span class='Ref_to_Member'>num_defaults</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2907"><span class='Ref_To_Local'>num_defaults</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN112"><span class='Ref_to_Member'>is_program</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2897"><span class='Ref_to_Parameter'>is_program</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2898"><span class='Ref_to_Parameter'>data_source_cb</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN64"><span class='Ref_to_EnumConst'>COPY_CALLBACK</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN113"><span class='Ref_to_Member'>data_source_cb</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2898"><span class='Ref_to_Parameter'>data_source_cb</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2903"><span class='Ref_To_Local'>pipe</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2897"><span class='Ref_to_Parameter'>is_program</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* the grammar does not allow this */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../tcop/postgres.c.html#LN87"><span class='Ref_to_Global_Var'>whereToSendOutput</span></a> <span class='Operator'>== </span><a href="../../include/tcop/dest.h.html#LN89"><span class='Ref_to_EnumConst'>DestRemote</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN327"><span class='Ref_to_Proto'>ReceiveCopyBegin</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>= </span>stdin<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2896"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN112"><span class='Ref_to_Member'>is_program</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN87"><span class='Ref_to_Proto'>OpenPipeStream</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not execute command \"%s\": %m"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3045"></a>            <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* copy errno because ereport subfunctions might change it */ 
</span><a name="LN3051"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>save_errno</span> <span class='Operator'>= </span>errno<span class='Delimiter'>; 
</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\" for reading: %m"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Parentheses'>(</span><a href="copy.c.html#LN3051"><span class='Ref_To_Local'>save_errno</span></a> <span class='Operator'>== </span>ENOENT <span class='Operator'>|| </span><a href="copy.c.html#LN3051"><span class='Ref_To_Local'>save_errno</span></a> <span class='Operator'>== </span>EACCES<span class='Parentheses'>) </span><span class='Operator'>? 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"COPY FROM instructs the PostgreSQL server process to read a file. "</span> 
                                 <span class='String'>"You may want a client-side facility such as psql's \\copy."</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span>fstat<span class='Parentheses'>(</span>fileno<span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN98"><span class='Ref_to_Member'>copy_file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3045"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3045"><span class='Ref_To_Local'>st</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_WRONG_OBJECT_TYPE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is a directory"</span><span class='Delimiter'>, </span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN111"><span class='Ref_to_Member'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* must rely on user to tell us... */ 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN157"><span class='Ref_to_Member'>file_has_oids</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Read and verify binary header */ 
</span><a name="LN3083"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>readSig</span><span class='Delimiter'>[</span><span class='Number'>11</span><span class='Delimiter'>]; 
</span><a name="LN3084"></a>        <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Signature */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3083"><span class='Ref_To_Local'>readSig</span></a><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>11</span> <span class='Operator'>|| 
</span>            memcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN3083"><span class='Ref_To_Local'>readSig</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN287"><span class='Ref_to_Global_Var'>BinarySignature</span></a><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"COPY file signature not recognized"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Flags field */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN336"><span class='Ref_to_Proto'>CopyGetInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid COPY file header (missing flags)"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN157"><span class='Ref_to_Member'>file_has_oids</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>16</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>16</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized critical flags in COPY file header"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Header extension length */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN336"><span class='Ref_to_Proto'>CopyGetInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid COPY file header (missing length)"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Skip extension header, if present */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3084"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-- &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3083"><span class='Ref_To_Local'>readSig</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid COPY file header (wrong length)"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN157"><span class='Ref_to_Member'>file_has_oids</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/lsyscache.h.html#LN163"><span class='Ref_to_Proto'>getTypeBinaryInputInfo</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="copy.c.html#LN2911"><span class='Ref_To_Local'>in_func_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN159"><span class='Ref_to_Member'>oid_typioparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2911"><span class='Ref_To_Local'>in_func_oid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN158"><span class='Ref_to_Member'>oid_in_function</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* create workspace for CopyReadAttributes results */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3129"></a>        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attr_count</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3130"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span> <span class='Operator'>= </span><a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN157"><span class='Ref_to_Member'>file_has_oids</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="copy.c.html#LN3129"><span class='Ref_To_Local'>attr_count</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>: </span><a href="copy.c.html#LN3129"><span class='Ref_To_Local'>attr_count</span></a><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3130"><span class='Ref_To_Local'>nfields</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3130"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN2914"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN2902"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end BeginCopyFrom &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read raw fields in the next line for COPY FROM in text or csv mode. 
 * Return false if no more lines. 
 * 
 * An internal temporary buffer is returned via 'fields'. It is valid until 
 * the next call of the function. Since the function returns all raw fields 
 * in the input file, 'nfields' could be different from the number of columns 
 * in the relation. 
 * 
 * NOTE: force_not_null option are not applied to the returned fields. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3153"></a><span class='Declare_Function'>NextCopyFromRawFields</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>***</span><span class='Declare_Parameter'>fields</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>nfields</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3155"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fldct</span><span class='Delimiter'>; 
</span><a name="LN3156"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>done</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only available for text or csv input */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* on input just throw the header line away */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN118"><span class='Ref_to_Member'>header_line</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN310"><span class='Ref_to_Proto'>CopyReadLine</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* done */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Actually read the line into memory here */ 
</span>    <a href="copy.c.html#LN3156"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN310"><span class='Ref_to_Proto'>CopyReadLine</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * EOF at start of line means we're done.  If we see EOF after some 
     * characters, we act as though it was newline followed by EOF, ie, 
     * process the line and then exit loop on next iteration. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3156"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse the line into de-escaped field values */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN3155"><span class='Ref_To_Local'>fldct</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN313"><span class='Ref_to_Proto'>CopyReadAttributesCSV</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="copy.c.html#LN3155"><span class='Ref_To_Local'>fldct</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN312"><span class='Ref_to_Proto'>CopyReadAttributesText</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>fields</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="copy.c.html#LN3153"><span class='Ref_to_Parameter'>nfields</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3155"><span class='Ref_To_Local'>fldct</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end NextCopyFromRawFields &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read next tuple from file for COPY FROM. Return false if no more tuples. 
 * 
 * 'econtext' is used to evaluate default expression for each columns not 
 * read from the file. It can be NULL when no default values are used, i.e. 
 * when all columns are read from the file. 
 * 
 * 'values' and 'nulls' arrays must be the same length as columns of the 
 * relation passed to BeginCopyFrom. This function fills the arrays. 
 * Oid of the tuple is returned with 'tupleOid' separately. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3205"></a><span class='Declare_Function'>NextCopyFrom</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN191"><span class='Ref_to_Struct'>ExprContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>econtext</span><span class='Delimiter'>, 
</span><a name="LN3206"></a>             <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupleOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3208"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span><span class='Delimiter'>; 
</span><a name="LN3209"></a>    <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attr</span><span class='Delimiter'>; 
</span><a name="LN3210"></a>    <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>num_phys_attrs</span><span class='Delimiter'>, 
</span><a name="LN3211"></a>                <span class='Declare_Local'>attr_count</span><span class='Delimiter'>, 
</span><a name="LN3212"></a>                <span class='Declare_Local'>num_defaults</span> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN156"><span class='Ref_to_Member'>num_defaults</span></a><span class='Delimiter'>; 
</span><a name="LN3213"></a>    <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>in_functions</span> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN160"><span class='Ref_to_Member'>in_functions</span></a><span class='Delimiter'>; 
</span><a name="LN3214"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>typioparams</span> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN161"><span class='Ref_to_Member'>typioparams</span></a><span class='Delimiter'>; 
</span><a name="LN3215"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3216"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nfields</span><span class='Delimiter'>; 
</span><a name="LN3217"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN3218"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>file_has_oids</span> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN157"><span class='Ref_to_Member'>file_has_oids</span></a><span class='Delimiter'>; 
</span><a name="LN3219"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>defmap</span> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN162"><span class='Ref_to_Member'>defmap</span></a><span class='Delimiter'>; 
</span><a name="LN3220"></a>    <a href="../../include/nodes/execnodes.h.html#LN52"><span class='Ref_to_Struct'>ExprState</span></a> <span class='Operator'>**</span><span class='Declare_Local'>defexprs</span> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN163"><span class='Ref_to_Member'>defexprs</span></a><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN3208"><span class='Ref_To_Local'>tupDesc</span></a> <span class='Operator'>= </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3209"><span class='Ref_To_Local'>attr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3208"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3210"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3208"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3211"><span class='Ref_To_Local'>attr_count</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3216"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3218"><span class='Ref_To_Local'>file_has_oids</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="copy.c.html#LN3211"><span class='Ref_To_Local'>attr_count</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>: </span><a href="copy.c.html#LN3211"><span class='Ref_To_Local'>attr_count</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize all values for row to NULL */ 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="copy.c.html#LN3210"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="copy.c.html#LN3210"><span class='Ref_To_Local'>num_phys_attrs</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN114"><span class='Ref_to_Member'>binary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3234"></a>        <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>field_strings</span><span class='Delimiter'>; 
</span><a name="LN3235"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span><a name="LN3236"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>fldct</span><span class='Delimiter'>; 
</span><a name="LN3237"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>fieldno</span><span class='Delimiter'>; 
</span><a name="LN3238"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>string</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* read raw fields in the next line */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/copy.h.html#LN35"><span class='Ref_to_Proto'>NextCopyFromRawFields</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3234"><span class='Ref_To_Local'>field_strings</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3236"><span class='Ref_To_Local'>fldct</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check for overflowing fields */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3216"><span class='Ref_To_Local'>nfields</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="copy.c.html#LN3236"><span class='Ref_To_Local'>fldct</span></a> <span class='Operator'>&GT; </span><a href="copy.c.html#LN3216"><span class='Ref_To_Local'>nfields</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extra data after last expected column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN3237"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Read the OID field if present */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3218"><span class='Ref_To_Local'>file_has_oids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3237"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN3236"><span class='Ref_To_Local'>fldct</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"missing data for OID column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3234"><span class='Ref_To_Local'>field_strings</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3237"><span class='Ref_To_Local'>fieldno</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null OID in COPY data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>tupleOid</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='String'>"oid"</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>tupleOid</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/oid.c.html#LN115"><span class='Ref_to_Func'>oidin</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>tupleOid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid OID in COPY data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if file_has_oids &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Loop to read the user attributes on the line. */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3235"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3283"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3235"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3284"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>m</span> <span class='Operator'>= </span><a href="copy.c.html#LN3283"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3237"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN3236"><span class='Ref_To_Local'>fldct</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"missing data for column \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3209"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3234"><span class='Ref_To_Local'>field_strings</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3237"><span class='Ref_To_Local'>fieldno</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN134"><span class='Ref_to_Member'>convert_select_flags</span></a> <span class='Operator'>&& 
</span>                <span class='Operator'>!</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN134"><span class='Ref_to_Member'>convert_select_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* ignore input field, leaving column as NULL */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                    <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN129"><span class='Ref_to_Member'>force_notnull_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * FORCE_NOT_NULL option is set and column is NULL - 
                     * convert it to the NULL string. 
                     */ 
</span>                    <a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN131"><span class='Ref_to_Member'>force_null_flags</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>] 
</span>                         <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * FORCE_NULL option is set and column matches the NULL 
                     * string. It must have been quoted, or otherwise the 
                     * string would already have been set to NULL. Convert it 
                     * to NULL as specified. 
                     */ 
</span>                    <a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;csv_mode &raquo; </span> 
 
            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3209"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3213"><span class='Ref_To_Local'>in_functions</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>], 
</span>                                          <a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, 
</span>                                          <a href="copy.c.html#LN3214"><span class='Ref_To_Local'>typioparams</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>], 
</span>                                          <a href="copy.c.html#LN3209"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3238"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3284"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN140"><span class='Ref_to_Member'>cur_attval</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3237"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3216"><span class='Ref_To_Local'>nfields</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !cstate-&GT;binary &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* binary */ 
</span><a name="LN3341"></a>        <a href="../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>fld_count</span><span class='Delimiter'>; 
</span><a name="LN3342"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN338"><span class='Ref_to_Proto'>CopyGetInt16</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3341"><span class='Ref_To_Local'>fld_count</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* EOF detected (end of file, or protocol-level EOF) */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3341"><span class='Ref_To_Local'>fld_count</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Received EOF marker.  In a V3-protocol copy, wait for the 
             * protocol-level EOF, and complain if it doesn't come 
             * immediately.  This ensures that we correctly handle CopyFail, 
             * if client chooses to send that now. 
             * 
             * Note that we MUST NOT try to read more data in an old-protocol 
             * copy, since there is no protocol-level EOF marker then.  We 
             * could go either way for copy from file, but choose to throw 
             * error if there's data after the EOF marker, for consistency 
             * with the new-protocol case. 
             */ 
</span><a name="LN3366"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>dummy</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>!= </span><a href="copy.c.html#LN62"><span class='Ref_to_EnumConst'>COPY_OLD_FE</span></a> <span class='Operator'>&& 
</span>                <a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN3366"><span class='Ref_To_Local'>dummy</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"received copy data after EOF marker"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fld_count==-1 &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3341"><span class='Ref_To_Local'>fld_count</span></a> <span class='Operator'>!= </span><a href="copy.c.html#LN3211"><span class='Ref_To_Local'>attr_count</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"row field count is %d, expected %d"</span><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="copy.c.html#LN3341"><span class='Ref_To_Local'>fld_count</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3211"><span class='Ref_To_Local'>attr_count</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3218"><span class='Ref_To_Local'>file_has_oids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3384"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>loaded_oid</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='String'>"oid"</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3384"><span class='Ref_To_Local'>loaded_oid</span></a> <span class='Operator'>= 
</span>                <a href="../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN314"><span class='Ref_to_Proto'>CopyReadBinaryAttribute</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN158"><span class='Ref_to_Member'>oid_in_function</span></a><span class='Delimiter'>, 
</span>                                                      <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN159"><span class='Ref_to_Member'>oid_typioparam</span></a><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                                         <span class='Operator'>&</span><a href="copy.c.html#LN3217"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3217"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN3384"><span class='Ref_To_Local'>loaded_oid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid OID in COPY data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN115"><span class='Ref_to_Member'>oids</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>tupleOid</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>tupleOid</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3384"><span class='Ref_To_Local'>loaded_oid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if file_has_oids &raquo; </span> 
 
        <a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3342"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN110"><span class='Ref_to_Member'>attnumlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3406"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN106"><span class='Ref_to_Macro'>lfirst_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3342"><span class='Ref_To_Local'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3407"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>m</span> <span class='Operator'>= </span><a href="copy.c.html#LN3406"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3209"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3407"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3407"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="copy.c.html#LN314"><span class='Ref_to_Proto'>CopyReadBinaryAttribute</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, 
</span>                                                <a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                                                <span class='Operator'>&</span><a href="copy.c.html#LN3213"><span class='Ref_To_Local'>in_functions</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3407"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>], 
</span>                                                <a href="copy.c.html#LN3214"><span class='Ref_To_Local'>typioparams</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3407"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>], 
</span>                                                <a href="copy.c.html#LN3209"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3407"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                                <span class='Operator'>&</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3407"><span class='Ref_To_Local'>m</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN139"><span class='Ref_to_Member'>cur_attname</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now compute and insert any defaults available for the columns not 
     * provided by the input data.  Anything not processed here or above will 
     * remain NULL. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN3212"><span class='Ref_To_Local'>num_defaults</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The caller must supply econtext and have switched into the 
         * per-tuple memory context in it. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>econtext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN202"><span class='Ref_to_Member'>ecxt_per_tuple_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3219"><span class='Ref_To_Local'>defmap</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]] </span><span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN264"><span class='Ref_to_Func'>ExecEvalExpr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3220"><span class='Ref_To_Local'>defexprs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="copy.c.html#LN3205"><span class='Ref_to_Parameter'>econtext</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>&</span><a href="copy.c.html#LN3206"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3219"><span class='Ref_To_Local'>defmap</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3215"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end NextCopyFrom &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Clean up storage and release resources for COPY FROM. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3446"></a><span class='Declare_Function'>EndCopyFrom</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* No COPY FROM related resources except memory. */ 
</span> 
    <a href="copy.c.html#LN294"><span class='Ref_to_Proto'>EndCopy</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3446"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Read the next input line and stash it in line_buf, with conversion to 
 * server encoding. 
 * 
 * Result is true if read was terminated by EOF, false if terminated 
 * by newline.  The terminating newline or EOF marker is not included 
 * in the final value of line_buf. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3462"></a><span class='Declare_Function'>CopyReadLine</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3464"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN198"><span class='Ref_to_Member'>line_buf_valid</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mark that encoding conversion hasn't occurred yet */ 
</span>    <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN197"><span class='Ref_to_Member'>line_buf_converted</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Parse data and transfer into line_buf */ 
</span>    <a href="copy.c.html#LN3464"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN311"><span class='Ref_to_Proto'>CopyReadLineText</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3464"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Reached EOF.  In protocol version 3, we should ignore anything 
         * after \. up to the protocol end of copy data.  (XXX maybe better 
         * not to treat \. as special?) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN97"><span class='Ref_to_Member'>copy_dest</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN63"><span class='Ref_to_EnumConst'>COPY_NEW_FE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>do</span> 
            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN734"><span class='Ref_to_Func'>CopyLoadRawBuf</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If we didn't hit EOF, then we must have transferred the EOL marker 
         * to line_buf along with the data.  Get rid of it. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="copy.c.html#LN73"><span class='Ref_to_EnumConst'>EOL_NL</span></a><span class='Operator'>: 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="copy.c.html#LN74"><span class='Ref_to_EnumConst'>EOL_CR</span></a><span class='Operator'>: 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a><span class='Operator'>: 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>-= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="copy.c.html#LN72"><span class='Ref_to_EnumConst'>EOL_UNKNOWN</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* shouldn't get here */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cstate-&GT;eol_type &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Done reading the line.  Convert it to server encoding. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN104"><span class='Ref_to_Member'>need_transcoding</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3527"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cvt</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN3527"><span class='Ref_To_Local'>cvt</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                               <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, 
</span>                               <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3527"><span class='Ref_To_Local'>cvt</span></a> <span class='Operator'>!= </span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* transfer converted data back to line_buf */ 
</span>            <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3527"><span class='Ref_To_Local'>cvt</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN3527"><span class='Ref_To_Local'>cvt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3527"><span class='Ref_To_Local'>cvt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Now it's safe to use the buffer in error messages */ 
</span>    <a href="copy.c.html#LN3462"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN197"><span class='Ref_to_Member'>line_buf_converted</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN3464"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyReadLine &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CopyReadLineText - inner loop of CopyReadLine for text mode 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3551"></a><span class='Declare_Function'>CopyReadLineText</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3553"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>copy_raw_buf</span><span class='Delimiter'>; 
</span><a name="LN3554"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>raw_buf_ptr</span><span class='Delimiter'>; 
</span><a name="LN3555"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>copy_buf_len</span><span class='Delimiter'>; 
</span><a name="LN3556"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>need_data</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3557"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hit_eof</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3558"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3559"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>mblen_str</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* CSV variables */ 
</span><a name="LN3562"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>first_char_in_line</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3563"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>in_quote</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN3564"></a>                <span class='Declare_Local'>last_was_esc</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3565"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>quotec</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span><a name="LN3566"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>escapec</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN3565"><span class='Ref_To_Local'>quotec</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <a href="copy.c.html#LN3566"><span class='Ref_To_Local'>escapec</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Comment_Multi_Line'>/* ignore special escape processing if it's the same as quotec */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3565"><span class='Ref_To_Local'>quotec</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3566"><span class='Ref_To_Local'>escapec</span></a><span class='Parentheses'>) 
</span>            <a href="copy.c.html#LN3566"><span class='Ref_To_Local'>escapec</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="copy.c.html#LN3559"><span class='Ref_To_Local'>mblen_str</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The objective of this loop is to transfer the entire next input line 
     * into line_buf.  Hence, we only care for detecting newlines (\r and/or 
     * \n) and the end-of-copy marker (\.). 
     * 
     * In CSV mode, \r and \n inside a quoted field are just part of the data 
     * value and are put in line_buf.  We keep just enough state to know if we 
     * are currently in a quoted field or not. 
     * 
     * These four characters, and the CSV escape and quote characters, are 
     * assumed the same in frontend and backend encodings. 
     * 
     * For speed, we try to move data from raw_buf to line_buf in chunks 
     * rather than one character at a time.  raw_buf_ptr points to the next 
     * character to examine; any characters from raw_buf_index to raw_buf_ptr 
     * have been determined to be part of the line, but not yet transferred to 
     * line_buf. 
     * 
     * For a little extra speed within the loop, we copy raw_buf and 
     * raw_buf_len into local variables. 
     */ 
</span>    <a href="copy.c.html#LN3553"><span class='Ref_To_Local'>copy_raw_buf</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3555"><span class='Ref_To_Local'>copy_buf_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3606"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>prev_raw_ptr</span><span class='Delimiter'>; 
</span><a name="LN3607"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Load more data if needed.  Ideally we would just force four bytes 
         * of read-ahead and avoid the many calls to 
         * IF_NEED_REFILL_AND_NOT_EOF_CONTINUE(), but the COPY_OLD_FE protocol 
         * does not allow us to read too far ahead or we might read into the 
         * next data, so we read-ahead only as far we know we can.  One 
         * optimization would be to read-ahead four byte here if 
         * cstate-&GT;copy_dest != COPY_OLD_FE, but it hardly seems worth it, 
         * considering the size of the buffer. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN3555"><span class='Ref_To_Local'>copy_buf_len</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN3556"><span class='Ref_To_Local'>need_data</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN267"><span class='Ref_to_Const'>REFILL_LINEBUF</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Try to read some more data.  This will certainly reset 
             * raw_buf_index to zero, and raw_buf_ptr must go with it. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN734"><span class='Ref_to_Func'>CopyLoadRawBuf</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN3557"><span class='Ref_To_Local'>hit_eof</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3555"><span class='Ref_To_Local'>copy_buf_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN210"><span class='Ref_to_Member'>raw_buf_len</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If we are completely out of data, break out of the loop, 
             * reporting EOF. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3555"><span class='Ref_To_Local'>copy_buf_len</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN3558"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="copy.c.html#LN3556"><span class='Ref_To_Local'>need_data</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if raw_buf_ptr&GT;=copy_buf... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* OK to fetch a character */ 
</span>        <a href="copy.c.html#LN3606"><span class='Ref_To_Local'>prev_raw_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3553"><span class='Ref_To_Local'>copy_raw_buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If character is '\\' or '\r', we may need to look ahead below. 
             * Force fetch of the next character if we don't already have it. 
             * We need to do this before changing CSV state, in case one of 
             * these characters is also the quote or escape character. 
             * 
             * Note: old-protocol does not like forced prefetch, but it's OK 
             * here since we cannot validly be at EOF. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>|| </span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN238"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Dealing with quotes and escapes here is mildly tricky. If the 
             * quote char is also the escape char, there's no problem - we 
             * just use the char as a toggle. If they are different, we need 
             * to ensure that we only take account of an escape inside a 
             * quoted field and immediately preceding a quote char, and not 
             * the second in an escape-escape sequence. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3563"><span class='Ref_To_Local'>in_quote</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3566"><span class='Ref_To_Local'>escapec</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN3564"><span class='Ref_To_Local'>last_was_esc</span></a> <span class='Operator'>= !</span><a href="copy.c.html#LN3564"><span class='Ref_To_Local'>last_was_esc</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3565"><span class='Ref_To_Local'>quotec</span></a> <span class='Operator'>&& !</span><a href="copy.c.html#LN3564"><span class='Ref_To_Local'>last_was_esc</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN3563"><span class='Ref_To_Local'>in_quote</span></a> <span class='Operator'>= !</span><a href="copy.c.html#LN3563"><span class='Ref_To_Local'>in_quote</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>!= </span><a href="copy.c.html#LN3566"><span class='Ref_To_Local'>escapec</span></a><span class='Parentheses'>) 
</span>                <a href="copy.c.html#LN3564"><span class='Ref_To_Local'>last_was_esc</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Updating the line count for embedded CR and/or LF chars is 
             * necessarily a little fragile - this test is probably about the 
             * best we can do.  (XXX it's arguable whether we should do this 
             * at all --- is cur_lineno a physical or logical count?) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3563"><span class='Ref_To_Local'>in_quote</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN73"><span class='Ref_to_EnumConst'>EOL_NL</span></a> <span class='Operator'>? </span><span class='String'>'\n'</span> <span class='Operator'>: </span><span class='String'>'\r'</span><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN138"><span class='Ref_to_Member'>cur_lineno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;csv_mode &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Process \r */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>|| !</span><a href="copy.c.html#LN3563"><span class='Ref_To_Local'>in_quote</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Check for \r\n on first line, _and_ handle \r\n. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN72"><span class='Ref_to_EnumConst'>EOL_UNKNOWN</span></a> <span class='Operator'>|| 
</span>                <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If need more data, go back to loop top to load it. 
                 * 
                 * Note that if we are at EOF, c will wind up as '\0' because 
                 * of the guaranteed pad of raw_buf. 
                 */ 
</span>                <a href="copy.c.html#LN238"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* get next char */ 
</span>                <a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3553"><span class='Ref_To_Local'>copy_raw_buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* eat newline */ 
</span>                    <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* in case not set yet */ 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* found \r, but no \n */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? 
</span>                            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"literal carriage return found in data"</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                            <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unquoted carriage return found in data"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? 
</span>                        <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use \"\\r\" to represent carriage return."</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use quoted CSV field to represent carriage return."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * if we got here, it is the first line and we didn't find 
                     * \n, so don't consume the peeked character 
                     */ 
</span>                    <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN74"><span class='Ref_to_EnumConst'>EOL_CR</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;eol_type==EOL... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN73"><span class='Ref_to_EnumConst'>EOL_NL</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"literal carriage return found in data"</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unquoted carriage return found in data"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? 
</span>                       <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use \"\\r\" to represent carriage return."</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use quoted CSV field to represent carriage return."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* If reach here, we have found the line terminator */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if c=='\r'&&(!cstate-&GT;cs... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Process \n */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>|| !</span><a href="copy.c.html#LN3563"><span class='Ref_To_Local'>in_quote</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN74"><span class='Ref_to_EnumConst'>EOL_CR</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"literal newline found in data"</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unquoted newline found in data"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>? 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use \"\\n\" to represent newline."</span><span class='Parentheses'>) </span><span class='Operator'>: 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use quoted CSV field to represent newline."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN73"><span class='Ref_to_EnumConst'>EOL_NL</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* in case not set yet */ 
</span>            <span class='Comment_Multi_Line'>/* If reach here, we have found the line terminator */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In CSV mode, we only recognize \. alone on a line.  This is because 
         * \. is a valid CSV data value. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN3562"><span class='Ref_To_Local'>first_char_in_line</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3768"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>c2</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN238"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN250"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_EOF_BREAK</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ----- 
             * get next character 
             * Note: we do not change c so if it isn't \., we can fall 
             * through and continue processing for file encoding. 
             * ----- 
             */ 
</span>            <a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3553"><span class='Ref_To_Local'>copy_raw_buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* consume the '.' */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Note: if we loop back for more data here, it does not 
                 * matter that the CSV state change checks are re-executed; we 
                 * will come back here with no important state changed. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Get the next character */ 
</span>                    <a href="copy.c.html#LN238"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* if hit_eof, c2 will become '\0' */ 
</span>                    <a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3553"><span class='Ref_To_Local'>copy_raw_buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-copy marker does not match previous newline style"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="copy.c.html#LN280"><span class='Ref_to_Const'>NO_END_OF_COPY_GOTO</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>!= </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>                            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-copy marker corrupt"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="copy.c.html#LN280"><span class='Ref_to_Const'>NO_END_OF_COPY_GOTO</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;eol_type==EOL... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* Get the next character */ 
</span>                <a href="copy.c.html#LN238"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* if hit_eof, c2 will become '\0' */ 
</span>                <a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3553"><span class='Ref_To_Local'>copy_raw_buf</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>!= </span><span class='String'>'\r'</span> <span class='Operator'>&& </span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-copy marker corrupt"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="copy.c.html#LN280"><span class='Ref_to_Const'>NO_END_OF_COPY_GOTO</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN73"><span class='Ref_to_EnumConst'>EOL_NL</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN75"><span class='Ref_to_EnumConst'>EOL_CRNL</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>!= </span><span class='String'>'\n'</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN102"><span class='Ref_to_Member'>eol_type</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN74"><span class='Ref_to_EnumConst'>EOL_CR</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN3768"><span class='Ref_To_Local'>c2</span></a> <span class='Operator'>!= </span><span class='String'>'\r'</span><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"end-of-copy marker does not match previous newline style"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Transfer only the data before the \. into line_buf, then 
                 * discard the data and the \. sequence. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3606"><span class='Ref_To_Local'>prev_raw_ptr</span></a> <span class='Operator'>&GT; </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Delimiter'>, 
</span>                                     <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN208"><span class='Ref_to_Member'>raw_buf</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a><span class='Delimiter'>, 
</span>                                       <a href="copy.c.html#LN3606"><span class='Ref_To_Local'>prev_raw_ptr</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN209"><span class='Ref_to_Member'>raw_buf_index</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN3558"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* report EOF */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if c2=='.' &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN117"><span class='Ref_to_Member'>csv_mode</span></a><span class='Parentheses'>) 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we are here, it means we found a backslash followed by 
                 * something other than a period.  In non-CSV mode, anything 
                 * after a backslash is special, so we skip over that second 
                 * character too.  If we didn't do that \\. would be 
                 * considered an eof-of copy, while in non-CSV mode it is a 
                 * literal backslash followed by a period.  In CSV mode, 
                 * backslashes are not special, so we want to process the 
                 * character after the backslash just like a normal character, 
                 * so we don't increment in those cases. 
                 */ 
</span>                <a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if c=='\\'&&(!cstate-&GT;cs... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * This label is for CSV cases where \. appears at the start of a 
         * line, but there is more text after it, meaning it was a data value. 
         * We are more strict for \. in CSV mode because \. could be a data 
         * value, while in non-CSV mode, \. cannot be a data value. 
         */ 
</span><a name="LN3875"></a><span class='Label'>not_end_of_copy</span><span class='Operator'>: 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Process all bytes of a multi-byte character as a group. 
         * 
         * We only support multi-byte sequences where the first byte has the 
         * high-bit set, so as an optimization we can avoid this block 
         * entirely if it is not set. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN105"><span class='Ref_to_Member'>encoding_embeds_ascii</span></a> <span class='Operator'>&& </span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN3886"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>mblen</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN3559"><span class='Ref_To_Local'>mblen_str</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="copy.c.html#LN3607"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* All our encodings only read the first byte to get the length */ 
</span>            <a href="copy.c.html#LN3886"><span class='Ref_To_Local'>mblen</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3551"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3559"><span class='Ref_To_Local'>mblen_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN238"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_NOT_EOF_CONTINUE</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3886"><span class='Ref_To_Local'>mblen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN250"><span class='Ref_to_Macro'>IF_NEED_REFILL_AND_EOF_BREAK</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3886"><span class='Ref_To_Local'>mblen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3554"><span class='Ref_To_Local'>raw_buf_ptr</span></a> <span class='Operator'>+= </span><a href="copy.c.html#LN3886"><span class='Ref_To_Local'>mblen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="copy.c.html#LN3562"><span class='Ref_To_Local'>first_char_in_line</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span>                           <span class='Comment_Single_Line'>/* end of outer loop */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Transfer any still-uncopied data to line_buf. 
     */ 
</span>    <a href="copy.c.html#LN267"><span class='Ref_to_Const'>REFILL_LINEBUF</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN3558"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyReadLineText &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  Return decimal value for a hexadecimal digit 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3910"></a><span class='Declare_Function'>GetDecimalFromHex</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Declare_Parameter'>hex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="copy.c.html#LN3910"><span class='Ref_to_Parameter'>hex</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="copy.c.html#LN3910"><span class='Ref_to_Parameter'>hex</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> tolower<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="copy.c.html#LN3910"><span class='Ref_to_Parameter'>hex</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='String'>'a'</span> <span class='Operator'>+ </span><span class='Number'>10</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Parse the current line into separate attributes (fields), 
 * performing de-escaping as needed. 
 * 
 * The input is in line_buf.  We use attribute_buf to hold the result 
 * strings.  cstate-&GT;raw_fields[k] is set to point to the k'th attribute 
 * string, or NULL when the input matches the null marker string. 
 * This array is expanded as necessary. 
 * 
 * (Note that the caller cannot check for nulls since the returned 
 * string would be the post-de-escaping equivalent, which may look 
 * the same as some valid data string.) 
 * 
 * delim is the column delimiter string (must be just one byte for now). 
 * null_print is the null marker string.  Note that this is compared to 
 * the pre-de-escaped input string. 
 * 
 * The return value is the number of fields actually read. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3938"></a><span class='Declare_Function'>CopyReadAttributesText</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3940"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>delimc</span> <span class='Operator'>= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN3941"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fieldno</span><span class='Delimiter'>; 
</span><a name="LN3942"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>output_ptr</span><span class='Delimiter'>; 
</span><a name="LN3943"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cur_ptr</span><span class='Delimiter'>; 
</span><a name="LN3944"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>line_end_ptr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need a special case for zero-column tables: check that the input 
     * line is empty, and return. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extra data after last expected column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The de-escaped attributes will certainly not be longer than the input 
     * data line, so we can just force attribute_buf to be large enough and 
     * then transfer data without any checks for enough space.  We need to do 
     * it this way because enlarging attribute_buf mid-stream would invalidate 
     * pointers already stored into cstate-&GT;raw_fields[]. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN38"><span class='Ref_to_Member'>maxlen</span></a> <span class='Operator'>&LT;= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/lib/stringinfo.h.html#LN149"><span class='Ref_to_Proto'>enlargeStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set pointer variables for loop */ 
</span>    <a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Outer loop iterates over fields */ 
</span>    <a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3980"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_delim</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3981"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start_ptr</span><span class='Delimiter'>; 
</span><a name="LN3982"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>end_ptr</span><span class='Delimiter'>; 
</span><a name="LN3983"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>input_len</span><span class='Delimiter'>; 
</span><a name="LN3984"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>saw_non_ascii</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make sure there is enough space for the next value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a> <span class='Operator'>= 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Remember start of field on both input and output sides */ 
</span>        <a href="copy.c.html#LN3981"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan data for field. 
         * 
         * Note that in this loop, we are scanning to locate the end of field 
         * and also speculatively performing de-escaping.  Once we find the 
         * end-of-field, we can match the raw field contents against the null 
         * marker string.  Only after that comparison fails do we know that 
         * de-escaping is actually the right thing to do; therefore we *must 
         * not* throw any syntax errors before we've done the null-marker 
         * check. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4011"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
            <a href="copy.c.html#LN3982"><span class='Ref_To_Local'>end_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3940"><span class='Ref_To_Local'>delimc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN3980"><span class='Ref_To_Local'>found_delim</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <span class='String'>'0'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'1'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'2'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'3'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'4'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'5'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'6'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'7'</span><span class='Operator'>: 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* handle \013 */ 
</span><a name="LN4039"></a>                            <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                            <a href="copy.c.html#LN4039"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN53"><span class='Ref_to_Macro'>OCTVALUE</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN52"><span class='Ref_to_Macro'>ISOCTAL</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                                <span class='Delimiter'>{ 
</span>                                    <a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                                    <a href="copy.c.html#LN4039"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN4039"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="copy.c.html#LN53"><span class='Ref_to_Macro'>OCTVALUE</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                                    <span class='Delimiter'>{ 
</span>                                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>                                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN52"><span class='Ref_to_Macro'>ISOCTAL</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                                        <span class='Delimiter'>{ 
</span>                                            <a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                                            <a href="copy.c.html#LN4039"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN4039"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="copy.c.html#LN53"><span class='Ref_to_Macro'>OCTVALUE</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                        <span class='Delimiter'>} 
</span>                                    <span class='Delimiter'>} 
</span>                                <span class='Delimiter'>} 
</span>                            <span class='Delimiter'>} 
</span>                            <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4039"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>& </span><span class='Number'>0377</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| </span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                                <a href="copy.c.html#LN3984"><span class='Ref_To_Local'>saw_non_ascii</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Handle \x3F */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span><a name="LN4069"></a>                            <span class='Keyword'>char</span>        <span class='Declare_Local'>hexchar</span> <span class='Operator'>= *</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span>isxdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="copy.c.html#LN4069"><span class='Ref_To_Local'>hexchar</span></a><span class='Parentheses'>))</span> 
                            <span class='Delimiter'>{ 
</span><a name="LN4073"></a>                                <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="copy.c.html#LN3909"><span class='Ref_to_Func'>GetDecimalFromHex</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4069"><span class='Ref_To_Local'>hexchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                                <a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN3944"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                                <span class='Delimiter'>{ 
</span>                                    <a href="copy.c.html#LN4069"><span class='Ref_To_Local'>hexchar</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>                                    <span class='Control'>if</span> <span class='Parentheses'>(</span>isxdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="copy.c.html#LN4069"><span class='Ref_To_Local'>hexchar</span></a><span class='Parentheses'>))</span> 
                                    <span class='Delimiter'>{ 
</span>                                        <a href="copy.c.html#LN3943"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                                        <a href="copy.c.html#LN4073"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN4073"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="copy.c.html#LN3909"><span class='Ref_to_Func'>GetDecimalFromHex</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4069"><span class='Ref_To_Local'>hexchar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                    <span class='Delimiter'>} 
</span>                                <span class='Delimiter'>} 
</span>                                <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4073"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>& </span><span class='Number'>0xff</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>|| </span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                                    <a href="copy.c.html#LN3984"><span class='Ref_To_Local'>saw_non_ascii</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cur_ptr&LT;line_end_ptr &raquo; </span> 
                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\b'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\f'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\n'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\r'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\t'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'v'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'\v'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * in all other cases, take the char after '\' 
                         * literally 
                         */ 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if c=='\\' &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* Add c to output string */ 
</span>            <span class='Operator'>*</span><a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>++ = </span><a href="copy.c.html#LN4011"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Check whether raw input matched null marker */ 
</span>        <a href="copy.c.html#LN3983"><span class='Ref_To_Local'>input_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN3982"><span class='Ref_To_Local'>end_ptr</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN3981"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3983"><span class='Ref_To_Local'>input_len</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN120"><span class='Ref_to_Member'>null_print_len</span></a> <span class='Operator'>&& 
</span>            strncmp<span class='Parentheses'>(</span><a href="copy.c.html#LN3981"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3983"><span class='Ref_To_Local'>input_len</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * At this point we know the field is supposed to contain data. 
             * 
             * If we de-escaped any non-7-bit-ASCII chars, make sure the 
             * resulting string is valid data for the db encoding. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN3984"><span class='Ref_To_Local'>saw_non_ascii</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4136"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fld</span> <span class='Operator'>= </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>]; 
</span> 
                <a href="../parser/scan.l.html#LN546"><span class='Ref_to_Proto'>pg_verifymbstr</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4136"><span class='Ref_To_Local'>fld</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN4136"><span class='Ref_To_Local'>fld</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Terminate attribute value in output area */ 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Done if we hit EOL instead of a delim */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN3980"><span class='Ref_To_Local'>found_delim</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Clean up state of attribute_buf */ 
</span>    <a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN3942"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN3938"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN3941"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyReadAttributesText &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse the current line into separate attributes (fields), 
 * performing de-escaping as needed.  This has exactly the same API as 
 * CopyReadAttributesText, except we parse the fields according to 
 * "standard" (i.e. common) CSV usage. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN4166"></a><span class='Declare_Function'>CopyReadAttributesCSV</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4168"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>delimc</span> <span class='Operator'>= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN4169"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>quotec</span> <span class='Operator'>= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN4170"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>escapec</span> <span class='Operator'>= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN4171"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fieldno</span><span class='Delimiter'>; 
</span><a name="LN4172"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>output_ptr</span><span class='Delimiter'>; 
</span><a name="LN4173"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cur_ptr</span><span class='Delimiter'>; 
</span><a name="LN4174"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>line_end_ptr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need a special case for zero-column tables: check that the input 
     * line is empty, and return. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extra data after last expected column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The de-escaped attributes will certainly not be longer than the input 
     * data line, so we can just force attribute_buf to be large enough and 
     * then transfer data without any checks for enough space.  We need to do 
     * it this way because enlarging attribute_buf mid-stream would invalidate 
     * pointers already stored into cstate-&GT;raw_fields[]. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN38"><span class='Ref_to_Member'>maxlen</span></a> <span class='Operator'>&LT;= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/lib/stringinfo.h.html#LN149"><span class='Ref_to_Proto'>enlargeStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set pointer variables for loop */ 
</span>    <a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4174"><span class='Ref_To_Local'>line_end_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>+ </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN196"><span class='Ref_to_Member'>line_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Outer loop iterates over fields */ 
</span>    <a href="copy.c.html#LN4171"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4210"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>found_delim</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4211"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>saw_quote</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4212"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start_ptr</span><span class='Delimiter'>; 
</span><a name="LN4213"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>end_ptr</span><span class='Delimiter'>; 
</span><a name="LN4214"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>input_len</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Make sure there is enough space for the next value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4171"><span class='Ref_To_Local'>fieldno</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a> <span class='Operator'>= 
</span>                <a href="../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN186"><span class='Ref_to_Member'>max_fields</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Remember start of field on both input and output sides */ 
</span>        <a href="copy.c.html#LN4212"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>        <a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4171"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Scan data for field, 
         * 
         * The loop starts in "not quote" mode and then toggles between that 
         * and "in quote" mode. The loop exits normally if it is in "not 
         * quote" mode and a delimiter or line end is seen. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4237"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Not in quote */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN4213"><span class='Ref_To_Local'>end_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN4174"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN4305"><span class='Ref_to_Label'>endfield</span></a><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* unquoted field delimiter */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4168"><span class='Ref_To_Local'>delimc</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN4210"><span class='Ref_To_Local'>found_delim</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="copy.c.html#LN4305"><span class='Ref_to_Label'>endfield</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* start of quoted field (or part of field) */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4169"><span class='Ref_To_Local'>quotec</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN4211"><span class='Ref_To_Local'>saw_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Add c to output string */ 
</span>                <span class='Operator'>*</span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>++ = </span><a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* In quote */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN4213"><span class='Ref_To_Local'>end_ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&GT;= </span><a href="copy.c.html#LN4174"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unterminated CSV quoted field"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* escape within a quoted field */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4170"><span class='Ref_To_Local'>escapec</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * peek at the next char if available, and escape it if it 
                     * is an escape char or a quote char 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN4174"><span class='Ref_To_Local'>line_end_ptr</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span><a name="LN4282"></a>                        <span class='Keyword'>char</span>        <span class='Declare_Local'>nextc</span> <span class='Operator'>= *</span><a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4282"><span class='Ref_To_Local'>nextc</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4170"><span class='Ref_To_Local'>escapec</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN4282"><span class='Ref_To_Local'>nextc</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4169"><span class='Ref_To_Local'>quotec</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Operator'>*</span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>++ = </span><a href="copy.c.html#LN4282"><span class='Ref_To_Local'>nextc</span></a><span class='Delimiter'>; 
</span>                            <a href="copy.c.html#LN4173"><span class='Ref_To_Local'>cur_ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * end of quoted field. Must do this test after testing for 
                 * escape in case quote char and escape char are the same 
                 * (which is the common case). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4169"><span class='Ref_To_Local'>quotec</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Add c to output string */ 
</span>                <span class='Operator'>*</span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>++ = </span><a href="copy.c.html#LN4237"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<a name="LN4305"></a><span class='Label'>endfield</span><span class='Operator'>: 
</span> 
        <span class='Comment_Multi_Line'>/* Terminate attribute value in output area */ 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check whether raw input matched null marker */ 
</span>        <a href="copy.c.html#LN4214"><span class='Ref_To_Local'>input_len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4213"><span class='Ref_To_Local'>end_ptr</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN4212"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN4211"><span class='Ref_To_Local'>saw_quote</span></a> <span class='Operator'>&& </span><a href="copy.c.html#LN4214"><span class='Ref_To_Local'>input_len</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN120"><span class='Ref_to_Member'>null_print_len</span></a> <span class='Operator'>&& 
</span>            strncmp<span class='Parentheses'>(</span><a href="copy.c.html#LN4212"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4214"><span class='Ref_To_Local'>input_len</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN187"><span class='Ref_to_Member'>raw_fields</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4171"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN4171"><span class='Ref_To_Local'>fieldno</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Done if we hit EOL instead of a delim */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN4210"><span class='Ref_To_Local'>found_delim</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Clean up state of attribute_buf */ 
</span>    <a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN4172"><span class='Ref_To_Local'>output_ptr</span></a> <span class='Operator'>- </span><a href="copy.c.html#LN4166"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="copy.c.html#LN4171"><span class='Ref_To_Local'>fieldno</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyReadAttributesCSV &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Read a binary attribute 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4335"></a><span class='Declare_Function'>CopyReadBinaryAttribute</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, 
</span><a name="LN4336"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>column_no</span><span class='Delimiter'>, </span><a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>flinfo</span><span class='Delimiter'>, 
</span><a name="LN4337"></a>                        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typioparam</span><span class='Delimiter'>, </span><a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN4338"></a>                        <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4340"></a>    <a href="../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>fld_size</span><span class='Delimiter'>; 
</span><a name="LN4341"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN336"><span class='Ref_to_Proto'>CopyGetInt32</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF in COPY data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="copy.c.html#LN4338"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../include/fmgr.h.html#LN648"><span class='Ref_to_Proto'>ReceiveFunctionCall</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4336"><span class='Ref_to_Parameter'>flinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="copy.c.html#LN4337"><span class='Ref_to_Parameter'>typioparam</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4337"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid field size"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* reset attribute_buf to empty, and load raw data in it */ 
</span>    <a href="../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/lib/stringinfo.h.html#LN149"><span class='Ref_to_Proto'>enlargeStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN333"><span class='Ref_to_Proto'>CopyGetData</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                    <a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_BAD_COPY_FILE_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unexpected EOF in COPY data"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4340"><span class='Ref_To_Local'>fld_size</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Call the column type's binary input converter */ 
</span>    <a href="copy.c.html#LN4341"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN648"><span class='Ref_to_Proto'>ReceiveFunctionCall</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4336"><span class='Ref_to_Parameter'>flinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Delimiter'>, 
</span>                                 <a href="copy.c.html#LN4337"><span class='Ref_to_Parameter'>typioparam</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4337"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Trouble if it didn't eat the whole buffer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a> <span class='Operator'>!= </span><a href="copy.c.html#LN4335"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN182"><span class='Ref_to_Member'>attribute_buf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"incorrect binary data format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="copy.c.html#LN4338"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="copy.c.html#LN4341"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyReadBinaryAttribute &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Send text representation of one attribute, with conversion and escaping 
 */ 
</span><a name="LN4387"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DUMPSOFAR</span><span class='Parentheses'>() </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN941"><span class='Ref_to_Global_Var'>ptr</span></a> <span class='Operator'>&GT; </span>start<span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <a href="copy.c.html#LN329"><span class='Ref_to_Proto'>CopySendData</span></a><span class='Parentheses'>(</span>cstate<span class='Delimiter'>, </span>start<span class='Delimiter'>, </span><a href="../../interfaces/ecpg/preproc/pgc.l.html#LN941"><span class='Ref_to_Global_Var'>ptr</span></a> <span class='Operator'>- </span>start<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4394"></a><span class='Declare_Function'>CopyAttributeOutText</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4396"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN4397"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span><span class='Delimiter'>; 
</span><a name="LN4398"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN4399"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>delimc</span> <span class='Operator'>= </span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN104"><span class='Ref_to_Member'>need_transcoding</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN567"><span class='Ref_to_Proto'>pg_server_to_any</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We have to grovel through the string searching for control characters 
     * and instances of the delimiter character.  In most cases, though, these 
     * are infrequent.  To avoid overhead from calling CopySendData once per 
     * character, we dump out all characters between escaped characters in a 
     * single call.  The loop invariant is that the data from "start" to "ptr" 
     * can be sent literally, but hasn't yet been. 
     * 
     * We can skip pg_encoding_mblen() overhead when encoding is safe, because 
     * in valid backend encodings, extra bytes of a multibyte character never 
     * look like ASCII.  This loop is sufficiently performance-critical that 
     * it's worth making two copies of it to get the IS_HIGHBIT_SET() test out 
     * of the normal safe-encoding path. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN105"><span class='Ref_to_Member'>encoding_embeds_ascii</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN4397"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Number'>0x20</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * \r and \n must be escaped, the others are traditional. We 
                 * prefer to dump these using the C-like notation, rather than 
                 * a backslash and the literal character, because it makes the 
                 * dump file a bit more proof against Microsoftish data 
                 * mangling. 
                 */ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <span class='String'>'\b'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'b'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\f'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'f'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\n'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'n'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\r'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'r'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\t'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'t'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\v'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'v'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* If it's the delimiter, must backslash it */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4399"><span class='Ref_To_Local'>delimc</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* All ASCII control chars are length 1 */ 
</span>                        <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* fall to end of loop */ 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
                <span class='Comment_Multi_Line'>/* if we get here, we need to convert the control char */ 
</span>                <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4397"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= ++</span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* do not include char in next run */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (unsignedchar)c&LT;(unsi... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>|| </span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4399"><span class='Ref_To_Local'>delimc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4397"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* we include char in next run */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>))</span> 
                <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=*ptr)!='\0' &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cstate-&GT;encoding_embe... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN4397"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Number'>0x20</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * \r and \n must be escaped, the others are traditional. We 
                 * prefer to dump these using the C-like notation, rather than 
                 * a backslash and the literal character, because it makes the 
                 * dump file a bit more proof against Microsoftish data 
                 * mangling. 
                 */ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <span class='String'>'\b'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'b'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\f'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'f'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\n'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'n'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\r'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'r'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\t'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'t'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'\v'</span><span class='Operator'>: 
</span>                        <a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= </span><span class='String'>'v'</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* If it's the delimiter, must backslash it */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4399"><span class='Ref_To_Local'>delimc</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* All ASCII control chars are length 1 */ 
</span>                        <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* fall to end of loop */ 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch c &raquo; </span> 
                <span class='Comment_Multi_Line'>/* if we get here, we need to convert the control char */ 
</span>                <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4397"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= ++</span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* do not include char in next run */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (unsignedchar)c&LT;(unsi... &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>|| </span><a href="copy.c.html#LN4398"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4399"><span class='Ref_To_Local'>delimc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4394"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4397"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* we include char in next run */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN4396"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (c=*ptr)!='\0' &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyAttributeOutText &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Send text representation of one attribute, with conversion and 
 * CSV-style escaping 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4547"></a><span class='Declare_Function'>CopyAttributeOutCSV</span><span class='Parentheses'>(</span><a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a> <span class='Declare_Parameter'>cstate</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Delimiter'>, 
</span><a name="LN4548"></a>                    <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_quote</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>single_attr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4550"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN4551"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span><span class='Delimiter'>; 
</span><a name="LN4552"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>c</span><span class='Delimiter'>; 
</span><a name="LN4553"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>delimc</span> <span class='Operator'>= </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN122"><span class='Ref_to_Member'>delim</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN4554"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>quotec</span> <span class='Operator'>= </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN123"><span class='Ref_to_Member'>quote</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span><a name="LN4555"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>escapec</span> <span class='Operator'>= </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN124"><span class='Ref_to_Member'>escape</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* force quoting if it matches null_print (before conversion!) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>use_quote</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN119"><span class='Ref_to_Member'>null_print</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>use_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN104"><span class='Ref_to_Member'>need_transcoding</span></a><span class='Parentheses'>) 
</span>        <a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN567"><span class='Ref_to_Proto'>pg_server_to_any</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make a preliminary pass to discover if it needs quoting 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>use_quote</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Because '\.' can be a data value, quote it if it appears alone on a 
         * line so it is not interpreted as the end-of-data marker. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>single_attr</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='String'>"\\."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>use_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4579"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tptr</span> <span class='Operator'>= </span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN4579"><span class='Ref_To_Local'>tptr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4553"><span class='Ref_To_Local'>delimc</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4554"><span class='Ref_To_Local'>quotec</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>|| </span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>use_quote</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN105"><span class='Ref_to_Member'>encoding_embeds_ascii</span></a><span class='Parentheses'>)</span> 
                    <a href="copy.c.html#LN4579"><span class='Ref_To_Local'>tptr</span></a> <span class='Operator'>+= </span><a href="../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4579"><span class='Ref_To_Local'>tptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="copy.c.html#LN4579"><span class='Ref_To_Local'>tptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !use_quote &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4548"><span class='Ref_to_Parameter'>use_quote</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4554"><span class='Ref_To_Local'>quotec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We adopt the same optimization strategy as in CopyAttributeOutText 
         */ 
</span>        <a href="copy.c.html#LN4551"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>= *</span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4554"><span class='Ref_To_Local'>quotec</span></a> <span class='Operator'>|| </span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>== </span><a href="copy.c.html#LN4555"><span class='Ref_To_Local'>escapec</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4555"><span class='Ref_To_Local'>escapec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="copy.c.html#LN4551"><span class='Ref_To_Local'>start</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* we include char in next run */ 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4552"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN105"><span class='Ref_to_Member'>encoding_embeds_ascii</span></a><span class='Parentheses'>)</span> 
                <a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+= </span><a href="../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN103"><span class='Ref_to_Member'>file_encoding</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="copy.c.html#LN4387"><span class='Ref_to_Macro'>DUMPSOFAR</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="copy.c.html#LN331"><span class='Ref_to_Proto'>CopySendChar</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4554"><span class='Ref_To_Local'>quotec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if use_quote &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If it doesn't need quoting, we can just dump it as-is */ 
</span>        <a href="copy.c.html#LN330"><span class='Ref_to_Proto'>CopySendString</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4547"><span class='Ref_to_Parameter'>cstate</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4550"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end CopyAttributeOutCSV &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CopyGetAttnums - build an integer list of attnums to be copied 
 * 
 * The input attnamelist is either the user-specified column list, 
 * or NIL if there was none (in which case we want all the non-dropped 
 * columns). 
 * 
 * rel can be NULL ... it's only used for error reports. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN4638"></a><span class='Declare_Function'>CopyGetAttnums</span><span class='Parentheses'>(</span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupDesc</span><span class='Delimiter'>, </span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attnamelist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4640"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attnums</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>attnamelist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Generate default column list */ 
</span><a name="LN4645"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Operator'>*</span><span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>; 
</span><a name="LN4646"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attr_count</span> <span class='Operator'>= </span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN4647"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4647"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN4647"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN4646"><span class='Ref_To_Local'>attr_count</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN4647"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4645"><span class='Ref_To_Local'>attr</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4647"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN4640"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4640"><span class='Ref_To_Local'>attnums</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4647"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Validate the user-supplied list and extract attnums */ 
</span><a name="LN4659"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4659"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>attnamelist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4663"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4659"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN4664"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN4665"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Lookup column name */ 
</span>            <a href="copy.c.html#LN4664"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="copy.c.html#LN4665"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="copy.c.html#LN4665"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN41"><span class='Ref_to_Proto'>namestrcmp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="copy.c.html#LN4663"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="copy.c.html#LN4664"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="copy.c.html#LN4665"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attnum<span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4664"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>== </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>rel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" of relation \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                           <a href="copy.c.html#LN4663"><span class='Ref_To_Local'>name</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4638"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                                    <a href="copy.c.html#LN4663"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* Check for duplicates */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN230"><span class='Ref_to_Proto'>list_member_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4640"><span class='Ref_To_Local'>attnums</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4664"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" specified more than once"</span><span class='Delimiter'>, 
</span>                                <a href="copy.c.html#LN4663"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="copy.c.html#LN4640"><span class='Ref_To_Local'>attnums</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN144"><span class='Ref_to_Func'>lappend_int</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4640"><span class='Ref_To_Local'>attnums</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4664"><span class='Ref_To_Local'>attnum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="copy.c.html#LN4640"><span class='Ref_To_Local'>attnums</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CopyGetAttnums &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * copy_dest_startup --- executor startup 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4710"></a><span class='Declare_Function'>copy_dest_startup</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* no-op */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * copy_dest_receive --- receive one tuple 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4719"></a><span class='Declare_Function'>copy_dest_receive</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4721"></a>    <a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>myState</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN4719"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span><a name="LN4722"></a>    <a href="../../include/commands/copy.h.html#LN22"><span class='Ref_to_Typedef'>CopyState</span></a>   <span class='Declare_Local'>cstate</span> <span class='Operator'>= </span><a href="copy.c.html#LN4721"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN217"><span class='Ref_to_Member'>cstate</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure the tuple is fully deconstructed */ 
</span>    <a href="../../include/executor/tuptable.h.html#LN168"><span class='Ref_to_Proto'>slot_getallattrs</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4719"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And send the data */ 
</span>    <a href="copy.c.html#LN302"><span class='Ref_to_Proto'>CopyOneRowTo</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4722"><span class='Ref_To_Local'>cstate</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4719"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN124"><span class='Ref_to_Member'>tts_values</span></a><span class='Delimiter'>, </span><a href="copy.c.html#LN4719"><span class='Ref_to_Parameter'>slot</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/tuptable.h.html#LN125"><span class='Ref_to_Member'>tts_isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4721"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN218"><span class='Ref_to_Member'>processed</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * copy_dest_shutdown --- executor end 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4738"></a><span class='Declare_Function'>copy_dest_shutdown</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* no-op */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * copy_dest_destroy --- release DestReceiver object 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4747"></a><span class='Declare_Function'>copy_dest_destroy</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="copy.c.html#LN4747"><span class='Ref_to_Parameter'>self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * CreateCopyDestReceiver -- create a suitable DestReceiver object 
 */ 
</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>* 
</span><a name="LN4756"></a><span class='Declare_Function'>CreateCopyDestReceiver</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4758"></a>    <a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>self</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="copy.c.html#LN214"><span class='Ref_to_Typedef'>DR_copy</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN216"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN117"><span class='Ref_to_Member'>receiveSlot</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4718"><span class='Ref_to_Func'>copy_dest_receive</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN216"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN120"><span class='Ref_to_Member'>rStartup</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4709"><span class='Ref_to_Func'>copy_dest_startup</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN216"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN123"><span class='Ref_to_Member'>rShutdown</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4737"><span class='Ref_to_Func'>copy_dest_shutdown</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN216"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a> <span class='Operator'>= </span><a href="copy.c.html#LN4746"><span class='Ref_to_Func'>copy_dest_destroy</span></a><span class='Delimiter'>; 
</span>    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN216"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN95"><span class='Ref_to_EnumConst'>DestCopyOut</span></a><span class='Delimiter'>; 
</span> 
    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN217"><span class='Ref_to_Member'>cstate</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* will be set later */ 
</span>    <a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="copy.c.html#LN218"><span class='Ref_to_Member'>processed</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="copy.c.html#LN4758"><span class='Ref_To_Local'>self</span></a><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>