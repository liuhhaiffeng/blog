<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\createas.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\createas.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:34 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * createas.c 
 *    Execution of CREATE TABLE ... AS, a/k/a SELECT INTO. 
 *    Since CREATE MATERIALIZED VIEW shares syntax and most behaviors, 
 *    we implement that here, too. 
 * 
 * We implement this by diverting the query's normal output to a 
 * specialized DestReceiver type. 
 * 
 * Formerly, CTAS was implemented as a variant of SELECT, which led 
 * to assorted legacy behaviors that we still try to preserve, notably that 
 * we must return a tuples-processed count in the completionTag.  (We no 
 * longer do that for CTAS ... WITH NO DATA, however.) 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/createas.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/reloptions.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xlog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/toasting.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/createas.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/matview.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/prepare.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablecmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/view.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_clause.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"rewrite/rewriteHandler.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/smgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/tcopprot.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rls.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN54"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Declare_Member'>pub</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* publicly-known function pointers */ 
</span><a name="LN55"></a>    <a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Member'>into</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* target relation specification */ 
</span>    <span class='Comment_Multi_Line'>/* These fields are filled by intorel_startup: */ 
</span><a name="LN57"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Member'>rel</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* relation to write to */ 
</span><a name="LN58"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Member'>reladdr</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* address of rel, for ExecCreateTableAs */ 
</span><a name="LN59"></a>    <a href="../../include/c.h.html#LN410"><span class='Ref_to_Typedef'>CommandId</span></a>   <span class='Declare_Member'>output_cid</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* cmin to insert in output tuples */ 
</span><a name="LN60"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>hi_options</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* heap_insert performance options */ 
</span><a name="LN61"></a>    <a href="../../include/access/heapam.h.html#LN32"><span class='Ref_to_Typedef'>BulkInsertState</span></a> <span class='Declare_Member'>bistate</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* bulk insert state */ 
</span><a name="LN62"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>DR_intorel</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* utility functions for CTAS definition creation */ 
</span><a name="LN65"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>create_ctas_internal</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attrList</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>into</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN66"></a><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Prototype'>create_ctas_nodata</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>into</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* DestReceiver routines for collecting data */ 
</span><a name="LN69"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>intorel_startup</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>intorel_receive</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>intorel_shutdown</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>intorel_destroy</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * create_ctas_internal 
 * 
 * Internal utility used for the creation of the definition of a relation 
 * created via CREATE TABLE AS or a materialized view.  Caller needs to 
 * provide a list of attributes (ColumnDef nodes). 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN83"></a><span class='Declare_Function'>create_ctas_internal</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attrList</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>into</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN85"></a>    <a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>create</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1972"><span class='Ref_to_Struct'>CreateStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_matview</span><span class='Delimiter'>; 
</span><a name="LN87"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span><a name="LN88"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>toast_options</span><span class='Delimiter'>; 
</span><a name="LN89"></a>    <span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Local'>validnsps</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN58"><span class='Ref_to_Const'>HEAP_RELOPT_NAMESPACES</span></a><span class='Delimiter'>; 
</span><a name="LN90"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>intoRelationAddr</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This code supports both CREATE TABLE AS and CREATE MATERIALIZED VIEW */ 
</span>    <a href="createas.c.html#LN86"><span class='Ref_To_Local'>is_matview</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN113"><span class='Ref_to_Member'>viewQuery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN87"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN86"><span class='Ref_To_Local'>is_matview</span></a> <span class='Operator'>? </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>: </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the target relation by faking up a CREATE TABLE parsetree and 
     * passing it to DefineRelation. 
     */ 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1975"><span class='Ref_to_Member'>relation</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1976"><span class='Ref_to_Member'>tableElts</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>attrList</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1977"><span class='Ref_to_Member'>inhRelations</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1981"><span class='Ref_to_Member'>ofTypename</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1982"><span class='Ref_to_Member'>constraints</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1983"><span class='Ref_to_Member'>options</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN110"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1984"><span class='Ref_to_Member'>oncommit</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN111"><span class='Ref_to_Member'>onCommit</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1985"><span class='Ref_to_Member'>tablespacename</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN112"><span class='Ref_to_Member'>tableSpaceName</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1986"><span class='Ref_to_Member'>if_not_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the relation.  (This will error out if there's an existing view, 
     * so we don't need more code to complain if "replace" is false.) 
     */ 
</span>    <a href="createas.c.html#LN90"><span class='Ref_To_Local'>intoRelationAddr</span></a> <span class='Operator'>= </span><a href="../../include/commands/tablecmds.h.html#LN24"><span class='Ref_to_Proto'>DefineRelation</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN87"><span class='Ref_To_Local'>relkind</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If necessary, create a TOAST table for the target table.  Note that 
     * NewRelationCreateToastTable ends with CommandCounterIncrement(), so 
     * that the TOAST table will be visible for insertion. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* parse and validate reloptions for the toast table */ 
</span>    <a href="createas.c.html#LN88"><span class='Ref_To_Local'>toast_options</span></a> <span class='Operator'>= </span><a href="../../include/access/reloptions.h.html#LN257"><span class='Ref_to_Proto'>transformRelOptions</span></a><span class='Parentheses'>((</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                        <a href="createas.c.html#LN85"><span class='Ref_To_Local'>create</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1983"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                                        <span class='String'>"toast"</span><span class='Delimiter'>, 
</span>                                        <a href="createas.c.html#LN89"><span class='Ref_To_Local'>validnsps</span></a><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/access/reloptions.h.html#LN274"><span class='Ref_to_Proto'>heap_reloptions</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN88"><span class='Ref_To_Local'>toast_options</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/toasting.h.html#LN21"><span class='Ref_to_Proto'>NewRelationCreateToastTable</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN90"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN88"><span class='Ref_To_Local'>toast_options</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the "view" part of a materialized view. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN86"><span class='Ref_To_Local'>is_matview</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* StoreViewQuery scribbles on tree, so make a copy */ 
</span><a name="LN138"></a>        <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN83"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN113"><span class='Ref_to_Member'>viewQuery</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/commands/view.h.html#LN24"><span class='Ref_to_Proto'>StoreViewQuery</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN90"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN138"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="createas.c.html#LN90"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end create_ctas_internal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * create_ctas_nodata 
 * 
 * Create CTAS or materialized view when WITH NO DATA is used, starting from 
 * the targetlist of the SELECT or view definition. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN155"></a><span class='Declare_Function'>create_ctas_nodata</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tlist</span><span class='Delimiter'>, </span><a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>into</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN157"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attrList</span><span class='Delimiter'>; 
</span><a name="LN158"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>t</span><span class='Delimiter'>, 
</span><a name="LN159"></a>               <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build list of ColumnDefs from non-junk elements of the tlist.  If a 
     * column name list was specified in CREATE TABLE AS, override the column 
     * names in the query.  (Too few column names are OK, too many are not.) 
     */ 
</span>    <a href="createas.c.html#LN157"><span class='Ref_To_Local'>attrList</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN159"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN155"><span class='Ref_to_Parameter'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN109"><span class='Ref_to_Member'>colNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN158"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN155"><span class='Ref_to_Parameter'>tlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN170"></a>        <a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN1363"><span class='Ref_to_Struct'>TargetEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN158"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="createas.c.html#LN170"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1373"><span class='Ref_to_Member'>resjunk</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN174"></a>            <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>col</span><span class='Delimiter'>; 
</span><a name="LN175"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN159"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="createas.c.html#LN175"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN159"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="createas.c.html#LN159"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN159"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="createas.c.html#LN175"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN170"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1368"><span class='Ref_to_Member'>resname</span></a><span class='Delimiter'>; 
</span> 
            <a href="createas.c.html#LN174"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN74"><span class='Ref_to_Proto'>makeColumnDef</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN175"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, 
</span>                                <a href="../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN170"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN170"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../include/nodes/nodeFuncs.h.html#LN38"><span class='Ref_to_Proto'>exprCollation</span></a><span class='Parentheses'>((</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN170"><span class='Ref_To_Local'>tle</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN1366"><span class='Ref_to_Member'>expr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * It's possible that the column is of a collatable type but the 
             * collation could not be resolved, so double-check.  (We must 
             * check this here because DefineRelation would adopt the type's 
             * default collation rather than complaining.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN174"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN651"><span class='Ref_to_Member'>collOid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="../../include/utils/lsyscache.h.html#LN167"><span class='Ref_to_Proto'>type_is_collatable</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN174"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN209"><span class='Ref_to_Member'>typeOid</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INDETERMINATE_COLLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no collation was derived for column \"%s\" with collatable type %s"</span><span class='Delimiter'>, 
</span>                                <a href="createas.c.html#LN174"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, 
</span>                                <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN174"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN209"><span class='Ref_to_Member'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the COLLATE clause to set the collation explicitly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="createas.c.html#LN157"><span class='Ref_To_Local'>attrList</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN157"><span class='Ref_To_Local'>attrList</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN174"><span class='Ref_To_Local'>col</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !tle-&GT;resjunk &raquo; </span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN159"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"too many column names were specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the relation definition using the ColumnDef list */ 
</span>    <span class='Control'>return</span> <a href="createas.c.html#LN65"><span class='Ref_to_Proto'>create_ctas_internal</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN157"><span class='Ref_To_Local'>attrList</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN155"><span class='Ref_to_Parameter'>into</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end create_ctas_nodata &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ExecCreateTableAs -- execute a CREATE TABLE AS command 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN223"></a><span class='Declare_Function'>ExecCreateTableAs</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3108"><span class='Ref_to_Struct'>CreateTableAsStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>queryString</span><span class='Delimiter'>, 
</span><a name="LN224"></a>                  <a href="../../include/nodes/params.h.html#LN61"><span class='Ref_to_Typedef'>ParamListInfo</span></a> <span class='Declare_Parameter'>params</span><span class='Delimiter'>, </span><a href="../utils/misc/queryenvironment.c.html#LN31"><span class='Ref_to_Struct'>QueryEnvironment</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>queryEnv</span><span class='Delimiter'>, 
</span><a name="LN225"></a>                  <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>completionTag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN227"></a>    <a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3111"><span class='Ref_to_Member'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN228"></a>    <a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>into</span> <span class='Operator'>= </span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3112"><span class='Ref_to_Member'>into</span></a><span class='Delimiter'>; 
</span><a name="LN229"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_matview</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN228"><span class='Ref_To_Local'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN113"><span class='Ref_to_Member'>viewQuery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN230"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span><a name="LN231"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>save_userid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN232"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_sec_context</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN233"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_nestlevel</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN234"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN235"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rewritten</span><span class='Delimiter'>; 
</span><a name="LN236"></a>    <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN237"></a>    <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>queryDesc</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3115"><span class='Ref_to_Member'>if_not_exists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN241"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span><span class='Delimiter'>; 
</span> 
        <a href="createas.c.html#LN241"><span class='Ref_To_Local'>nspid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN59"><span class='Ref_to_Proto'>RangeVarGetCreationNamespace</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3112"><span class='Ref_to_Member'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/lsyscache.h.html#LN123"><span class='Ref_to_Proto'>get_relname_relid</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3112"><span class='Ref_to_Member'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN241"><span class='Ref_To_Local'>nspid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DUPLICATE_TABLE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"relation \"%s\" already exists, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN3112"><span class='Ref_to_Member'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN108"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN67"><span class='Ref_to_Member'>relname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create the tuple receiver object and insert info it will need 
     */ 
</span>    <a href="createas.c.html#LN230"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../../include/commands/createas.h.html#LN28"><span class='Ref_to_Proto'>CreateIntoRelDestReceiver</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN228"><span class='Ref_To_Local'>into</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The contained Query could be a SELECT, or an EXECUTE utility command. 
     * If the latter, we just pass it off to ExecuteQuery. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN654"><span class='Ref_to_EnumConst'>CMD_UTILITY</span></a> <span class='Operator'>&& 
</span>        <a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN267"></a>        <a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>estmt</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3268"><span class='Ref_to_Struct'>ExecuteStmt</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN117"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="createas.c.html#LN229"><span class='Ref_To_Local'>is_matview</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* excluded by syntax */ 
</span>        <a href="../../include/commands/prepare.h.html#LN39"><span class='Ref_to_Proto'>ExecuteQuery</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN267"><span class='Ref_To_Local'>estmt</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN228"><span class='Ref_To_Local'>into</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN224"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN230"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN225"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* get object address that intorel_startup saved for us */ 
</span>        <a href="createas.c.html#LN234"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN230"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>reladdr<span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="createas.c.html#LN234"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For materialized views, lock down security-restricted operations and 
     * arrange to make GUC variable changes local to this command.  This is 
     * not necessary for security, but this keeps the behavior similar to 
     * REFRESH MATERIALIZED VIEW.  Otherwise, one could create a materialized 
     * view not possible to refresh. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN229"><span class='Ref_To_Local'>is_matview</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/miscadmin.h.html#LN312"><span class='Ref_to_Proto'>GetUserIdAndSecContext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="createas.c.html#LN231"><span class='Ref_To_Local'>save_userid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="createas.c.html#LN232"><span class='Ref_To_Local'>save_sec_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/miscadmin.h.html#LN313"><span class='Ref_to_Proto'>SetUserIdAndSecContext</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN231"><span class='Ref_To_Local'>save_userid</span></a><span class='Delimiter'>, 
</span>                           <a href="createas.c.html#LN232"><span class='Ref_To_Local'>save_sec_context</span></a> <span class='Operator'>| </span><a href="../../include/miscadmin.h.html#LN296"><span class='Ref_to_Const'>SECURITY_RESTRICTED_OPERATION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="createas.c.html#LN233"><span class='Ref_To_Local'>save_nestlevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/guc.h.html#LN354"><span class='Ref_to_Proto'>NewGUCNestLevel</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN228"><span class='Ref_To_Local'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN114"><span class='Ref_to_Member'>skipData</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If WITH NO DATA was specified, do not go through the rewriter, 
         * planner and executor.  Just define the relation using a code path 
         * similar to CREATE VIEW.  This avoids dump/restore problems stemming 
         * from running the planner before all dependencies are set up. 
         */ 
</span>        <a href="createas.c.html#LN234"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN66"><span class='Ref_to_Proto'>create_ctas_nodata</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN137"><span class='Ref_to_Member'>targetList</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN228"><span class='Ref_To_Local'>into</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Parse analysis was done already, but we still have to run the rule 
         * rewriter.  We do not do AcquireRewriteLocks: we assume the query 
         * either came straight from the parser, or suitable locks were 
         * acquired by plancache.c. 
         * 
         * Because the rewriter and planner tend to scribble on the input, we 
         * make a preliminary copy of the source querytree.  This prevents 
         * problems in the case that CTAS is in a portal or plpgsql function 
         * and is executed repeatedly.  (See also the same hack in EXPLAIN and 
         * PREPARE.) 
         */ 
</span>        <a href="createas.c.html#LN235"><span class='Ref_To_Local'>rewritten</span></a> <span class='Operator'>= </span><a href="../../include/rewrite/rewriteHandler.h.html#LN19"><span class='Ref_to_Proto'>QueryRewrite</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* SELECT should never rewrite to more or less than one SELECT query */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN235"><span class='Ref_To_Local'>rewritten</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected rewrite result for %s"</span><span class='Delimiter'>, 
</span>                 <a href="createas.c.html#LN229"><span class='Ref_To_Local'>is_matview</span></a> <span class='Operator'>? </span><span class='String'>"CREATE MATERIALIZED VIEW"</span> <span class='Operator'>: 
</span>                 <span class='String'>"CREATE TABLE AS SELECT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN113"><span class='Ref_to_Macro'>linitial_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN105"><span class='Ref_to_Struct'>Query</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN235"><span class='Ref_To_Local'>rewritten</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN109"><span class='Ref_to_Member'>commandType</span></a> <span class='Operator'>== </span><a href="../../include/nodes/nodes.h.html#LN650"><span class='Ref_to_EnumConst'>CMD_SELECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* plan the query --- note we disallow parallelism */ 
</span>        <a href="createas.c.html#LN236"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN59"><span class='Ref_to_Proto'>pg_plan_query</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN227"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="createas.c.html#LN224"><span class='Ref_to_Parameter'>params</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Use a snapshot with an updated command ID to ensure this query sees 
         * results of any previously executed queries.  (This could only 
         * matter if the planner executed an allegedly-stable function that 
         * changed the database contents, but let's do it anyway to be 
         * parallel to the EXPLAIN code path.) 
         */ 
</span>        <a href="../../include/utils/snapmgr.h.html#LN74"><span class='Ref_to_Proto'>PushCopiedSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/snapmgr.h.html#LN75"><span class='Ref_to_Proto'>UpdateActiveSnapshotCommandId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create a QueryDesc, redirecting output to our tuple receiver */ 
</span>        <a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN236"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN223"><span class='Ref_to_Parameter'>queryString</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/utils/snapshot.h.html#LN24"><span class='Ref_to_Const'>InvalidSnapshot</span></a><span class='Delimiter'>, 
</span>                                    <a href="createas.c.html#LN230"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN224"><span class='Ref_to_Parameter'>params</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN224"><span class='Ref_to_Parameter'>queryEnv</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* call ExecutorStart to prepare the plan for execution */ 
</span>        <a href="../executor/execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><a href="../../include/commands/createas.h.html#LN26"><span class='Ref_to_Proto'>GetIntoRelEFlags</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN228"><span class='Ref_To_Local'>into</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* run the plan to completion */ 
</span>        <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>, </span><span class='Number'>0L</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* save the rowcount if we're given a completionTag to fill */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN225"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Parentheses'>) 
</span>            <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN225"><span class='Ref_to_Parameter'>completionTag</span></a><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN73"><span class='Ref_to_Const'>COMPLETION_TAG_BUFSIZE</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"SELECT "</span> <a href="../../include/c.h.html#LN315"><span class='Ref_to_Const'>UINT64_FORMAT</span></a><span class='Delimiter'>, 
</span>                     <a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/executor/execdesc.h.html#LN47"><span class='Ref_to_Member'>estate</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN453"><span class='Ref_to_Member'>es_processed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* get object address that intorel_startup saved for us */ 
</span>        <a href="createas.c.html#LN234"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN230"><span class='Ref_To_Local'>dest</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>reladdr<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* and clean up */ 
</span>        <a href="../../include/executor/executor.h.html#LN173"><span class='Ref_to_Proto'>ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/executor/executor.h.html#LN175"><span class='Ref_to_Proto'>ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/executor/execdesc.h.html#LN67"><span class='Ref_to_Proto'>FreeQueryDesc</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN237"><span class='Ref_To_Local'>queryDesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN229"><span class='Ref_To_Local'>is_matview</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Roll back any GUC changes */ 
</span>        <a href="../../include/utils/guc.h.html#LN355"><span class='Ref_to_Proto'>AtEOXact_GUC</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="createas.c.html#LN233"><span class='Ref_To_Local'>save_nestlevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Restore userid and security context */ 
</span>        <a href="../../include/miscadmin.h.html#LN313"><span class='Ref_to_Proto'>SetUserIdAndSecContext</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN231"><span class='Ref_To_Local'>save_userid</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN232"><span class='Ref_To_Local'>save_sec_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="createas.c.html#LN234"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecCreateTableAs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetIntoRelEFlags --- compute executor flags needed for CREATE TABLE AS 
 * 
 * This is exported because EXPLAIN and PREPARE need it too.  (Note: those 
 * callers still need to deal explicitly with the skipData flag; since they 
 * use different methods for suppressing execution, it doesn't seem worth 
 * trying to encapsulate that part.) 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN391"></a><span class='Declare_Function'>GetIntoRelEFlags</span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>intoClause</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN393"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>flags</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need to tell the executor whether it has to produce OIDs or not, 
     * because it doesn't have enough information to do so itself (since we 
     * can't build the target relation until after ExecutorStart). 
     * 
     * Disallow the OIDS option for materialized views. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/parser/parse_clause.h.html#LN21"><span class='Ref_to_Proto'>interpretOidsOption</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN391"><span class='Ref_to_Parameter'>intoClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN110"><span class='Ref_to_Member'>options</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="createas.c.html#LN391"><span class='Ref_to_Parameter'>intoClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN113"><span class='Ref_to_Member'>viewQuery</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)))</span> 
        <a href="createas.c.html#LN393"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN62"><span class='Ref_to_Const'>EXEC_FLAG_WITH_OIDS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="createas.c.html#LN393"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>= </span><a href="../../include/executor/executor.h.html#LN63"><span class='Ref_to_Const'>EXEC_FLAG_WITHOUT_OIDS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN391"><span class='Ref_to_Parameter'>intoClause</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN114"><span class='Ref_to_Member'>skipData</span></a><span class='Parentheses'>) 
</span>        <a href="createas.c.html#LN393"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>|= </span><a href="../../include/executor/executor.h.html#LN64"><span class='Ref_to_Const'>EXEC_FLAG_WITH_NO_DATA</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="createas.c.html#LN393"><span class='Ref_To_Local'>flags</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetIntoRelEFlags &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CreateIntoRelDestReceiver -- create a suitable DestReceiver object 
 * 
 * intoClause will be NULL if called from CreateDestReceiver(), in which 
 * case it has to be provided later.  However, it is convenient to allow 
 * self-&GT;into to be filled in immediately for other callers. 
 */ 
</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>* 
</span><a name="LN422"></a><span class='Declare_Function'>CreateIntoRelDestReceiver</span><span class='Parentheses'>(</span><a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>intoClause</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN424"></a>    <a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Declare_Local'>self</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN54"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN117"><span class='Ref_to_Member'>receiveSlot</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN70"><span class='Ref_to_Proto'>intorel_receive</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN54"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN120"><span class='Ref_to_Member'>rStartup</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN69"><span class='Ref_to_Proto'>intorel_startup</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN54"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN123"><span class='Ref_to_Member'>rShutdown</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN71"><span class='Ref_to_Proto'>intorel_shutdown</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN54"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN125"><span class='Ref_to_Member'>rDestroy</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN72"><span class='Ref_to_Proto'>intorel_destroy</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN54"><span class='Ref_to_Member'>pub</span></a><span class='Operator'>.</span><a href="../../include/tcop/dest.h.html#LN127"><span class='Ref_to_Member'>mydest</span></a> <span class='Operator'>= </span><a href="../../include/tcop/dest.h.html#LN94"><span class='Ref_to_EnumConst'>DestIntoRel</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN55"><span class='Ref_to_Member'>into</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN422"><span class='Ref_to_Parameter'>intoClause</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* other private fields will be set during intorel_startup */ 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN424"><span class='Ref_To_Local'>self</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * intorel_startup --- executor startup 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN441"></a><span class='Declare_Function'>intorel_startup</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>operation</span><span class='Delimiter'>, </span><a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>typeinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN443"></a>    <a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myState</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN441"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span><a name="LN444"></a>    <a href="../../include/nodes/primnodes.h.html#LN104"><span class='Ref_to_Struct'>IntoClause</span></a> <span class='Operator'>*</span><span class='Declare_Local'>into</span> <span class='Operator'>= </span><a href="createas.c.html#LN443"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN55"><span class='Ref_to_Member'>into</span></a><span class='Delimiter'>; 
</span><a name="LN445"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_matview</span><span class='Delimiter'>; 
</span><a name="LN446"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>relkind</span><span class='Delimiter'>; 
</span><a name="LN447"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>attrList</span><span class='Delimiter'>; 
</span><a name="LN448"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>intoRelationAddr</span><span class='Delimiter'>; 
</span><a name="LN449"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>intoRelationDesc</span><span class='Delimiter'>; 
</span><a name="LN450"></a>    <a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rte</span><span class='Delimiter'>; 
</span><a name="LN451"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN452"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="createas.c.html#LN444"><span class='Ref_To_Local'>into</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* else somebody forgot to set it */ 
</span> 
    <span class='Comment_Multi_Line'>/* This code supports both CREATE TABLE AS and CREATE MATERIALIZED VIEW */ 
</span>    <a href="createas.c.html#LN445"><span class='Ref_To_Local'>is_matview</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN444"><span class='Ref_To_Local'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN113"><span class='Ref_to_Member'>viewQuery</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN446"><span class='Ref_To_Local'>relkind</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN445"><span class='Ref_To_Local'>is_matview</span></a> <span class='Operator'>? </span><a href="../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a> <span class='Operator'>: </span><a href="../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build column definitions using "pre-cooked" type and collation info. If 
     * a column name list was specified in CREATE TABLE AS, override the 
     * column names derived from the query.  (Too few column names are OK, too 
     * many are not.) 
     */ 
</span>    <a href="createas.c.html#LN447"><span class='Ref_To_Local'>attrList</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN451"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN75"><span class='Ref_to_Func'>list_head</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN444"><span class='Ref_To_Local'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN109"><span class='Ref_to_Member'>colNames</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT; </span><a href="createas.c.html#LN441"><span class='Ref_to_Parameter'>typeinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN470"></a>        <a href="../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attribute</span> <span class='Operator'>= </span><a href="createas.c.html#LN441"><span class='Ref_to_Parameter'>typeinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>]; 
</span><a name="LN471"></a>        <a href="../../include/nodes/parsenodes.h.html#LN636"><span class='Ref_to_Struct'>ColumnDef</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>col</span><span class='Delimiter'>; 
</span><a name="LN472"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN451"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="createas.c.html#LN472"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN451"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="createas.c.html#LN451"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN104"><span class='Ref_to_Macro'>lnext</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN451"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="createas.c.html#LN472"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN470"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="createas.c.html#LN471"><span class='Ref_To_Local'>col</span></a> <span class='Operator'>= </span><a href="../../include/nodes/makefuncs.h.html#LN74"><span class='Ref_to_Proto'>makeColumnDef</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN472"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, 
</span>                            <a href="createas.c.html#LN470"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                            <a href="createas.c.html#LN470"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                            <a href="createas.c.html#LN470"><span class='Ref_To_Local'>attribute</span></a><span class='Operator'>-&GT;</span>attcollation<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * It's possible that the column is of a collatable type but the 
         * collation could not be resolved, so double-check.  (We must check 
         * this here because DefineRelation would adopt the type's default 
         * collation rather than complaining.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN471"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN651"><span class='Ref_to_Member'>collOid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="../../include/utils/lsyscache.h.html#LN167"><span class='Ref_to_Proto'>type_is_collatable</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN471"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN209"><span class='Ref_to_Member'>typeOid</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INDETERMINATE_COLLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no collation was derived for column \"%s\" with collatable type %s"</span><span class='Delimiter'>, 
</span>                            <a href="createas.c.html#LN471"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN639"><span class='Ref_to_Member'>colname</span></a><span class='Delimiter'>, 
</span>                            <a href="../utils/adt/format_type.c.html#LN92"><span class='Ref_to_Func'>format_type_be</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN471"><span class='Ref_To_Local'>col</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN640"><span class='Ref_to_Member'>typeName</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN209"><span class='Ref_to_Member'>typeOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the COLLATE clause to set the collation explicitly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="createas.c.html#LN447"><span class='Ref_To_Local'>attrList</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN447"><span class='Ref_To_Local'>attrList</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN471"><span class='Ref_To_Local'>col</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for attnum=0;attnum&LT;typei... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN451"><span class='Ref_To_Local'>lc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"too many column names were specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Actually create the target table 
     */ 
</span>    <a href="createas.c.html#LN448"><span class='Ref_To_Local'>intoRelationAddr</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN65"><span class='Ref_to_Proto'>create_ctas_internal</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN447"><span class='Ref_To_Local'>attrList</span></a><span class='Delimiter'>, </span><a href="createas.c.html#LN444"><span class='Ref_To_Local'>into</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally we can open the target table 
     */ 
</span>    <a href="createas.c.html#LN449"><span class='Ref_To_Local'>intoRelationDesc</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN448"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN45"><span class='Ref_to_Const'>AccessExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check INSERT permission on the constructed table. 
     * 
     * XXX: It would arguably make sense to skip this check if into-&GT;skipData 
     * is true. 
     */ 
</span>    <a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN932"><span class='Ref_to_Struct'>RangeTblEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN936"><span class='Ref_to_Member'>rtekind</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN922"><span class='Ref_to_EnumConst'>RTE_RELATION</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN947"><span class='Ref_to_Member'>relid</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN448"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN948"><span class='Ref_to_Member'>relkind</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN446"><span class='Ref_To_Local'>relkind</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1027"><span class='Ref_to_Member'>requiredPerms</span></a> <span class='Operator'>= </span><a href="../../include/nodes/parsenodes.h.html#LN71"><span class='Ref_to_Const'>ACL_INSERT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>&LT;= </span><a href="createas.c.html#LN449"><span class='Ref_To_Local'>intoRelationDesc</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a> <span class='Operator'>= </span><a href="../../include/nodes/bitmapset.h.html#LN89"><span class='Ref_to_Proto'>bms_add_member</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1030"><span class='Ref_to_Member'>insertedCols</span></a><span class='Delimiter'>, 
</span>                                <a href="createas.c.html#LN452"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>- </span><a href="../../include/access/sysattr.h.html#LN27"><span class='Ref_to_Const'>FirstLowInvalidHeapAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/executor/executor.h.html#LN178"><span class='Ref_to_Proto'>ExecCheckRTPerms</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN450"><span class='Ref_To_Local'>rte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure the constructed table does not have RLS enabled. 
     * 
     * check_enable_rls() will ereport(ERROR) itself if the user has requested 
     * something invalid, and otherwise will return RLS_ENABLED if RLS should 
     * be enabled here.  We don't actually support that currently, so throw 
     * our own ereport(ERROR) if that happens. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/rls.h.html#LN47"><span class='Ref_to_Proto'>check_enable_rls</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN448"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/utils/rls.h.html#LN44"><span class='Ref_to_EnumConst'>RLS_ENABLED</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"policies not yet implemented for this command"</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Tentatively mark the target as populated, if it's a matview and we're 
     * going to fill it; otherwise, no change needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN445"><span class='Ref_To_Local'>is_matview</span></a> <span class='Operator'>&& !</span><a href="createas.c.html#LN444"><span class='Ref_To_Local'>into</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/primnodes.h.html#LN114"><span class='Ref_to_Member'>skipData</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/commands/matview.h.html#LN23"><span class='Ref_to_Proto'>SetMatViewPopulatedState</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN449"><span class='Ref_To_Local'>intoRelationDesc</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fill private fields of myState for use by later routines 
     */ 
</span>    <a href="createas.c.html#LN443"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN57"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN449"><span class='Ref_To_Local'>intoRelationDesc</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN443"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN58"><span class='Ref_to_Member'>reladdr</span></a> <span class='Operator'>= </span><a href="createas.c.html#LN448"><span class='Ref_To_Local'>intoRelationAddr</span></a><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN443"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN59"><span class='Ref_to_Member'>output_cid</span></a> <span class='Operator'>= </span><a href="../../include/access/xact.h.html#LN339"><span class='Ref_to_Proto'>GetCurrentCommandId</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can skip WAL-logging the insertions, unless PITR or streaming 
     * replication is in use. We can skip the FSM in any case. 
     */ 
</span>    <a href="createas.c.html#LN443"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN60"><span class='Ref_to_Member'>hi_options</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN28"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_FSM</span></a> <span class='Operator'>| 
</span>        <span class='Parentheses'>(</span><a href="../../include/access/xlog.h.html#LN144"><span class='Ref_to_Macro'>XLogIsNeeded</span></a><span class='Parentheses'>() </span><span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="../../include/access/heapam.h.html#LN27"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_WAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN443"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN61"><span class='Ref_to_Member'>bistate</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN147"><span class='Ref_to_Proto'>GetBulkInsertState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Not using WAL requires smgr_targblock be initially invalid */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/utils/rel.h.html#LN488"><span class='Ref_to_Macro'>RelationGetTargetBlock</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN449"><span class='Ref_To_Local'>intoRelationDesc</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/storage/block.h.html#LN32"><span class='Ref_to_Const'>InvalidBlockNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end intorel_startup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * intorel_receive --- receive one tuple 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN581"></a><span class='Declare_Function'>intorel_receive</span><span class='Parentheses'>(</span><a href="../../include/executor/tuptable.h.html#LN112"><span class='Ref_to_Struct'>TupleTableSlot</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>slot</span><span class='Delimiter'>, </span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN583"></a>    <a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myState</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN581"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span><a name="LN584"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the heap tuple out of the tuple table slot, making sure we have a 
     * writable copy 
     */ 
</span>    <a href="createas.c.html#LN584"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/executor/tuptable.h.html#LN162"><span class='Ref_to_Proto'>ExecMaterializeSlot</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN581"><span class='Ref_to_Parameter'>slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * force assignment of new OID (see comments in ExecInsert) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN583"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN57"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasoids<span class='Parentheses'>) 
</span>        <a href="../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN584"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN151"><span class='Ref_to_Proto'>heap_insert</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN583"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN57"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, 
</span>                <a href="createas.c.html#LN584"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, 
</span>                <a href="createas.c.html#LN583"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN59"><span class='Ref_to_Member'>output_cid</span></a><span class='Delimiter'>, 
</span>                <a href="createas.c.html#LN583"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN60"><span class='Ref_to_Member'>hi_options</span></a><span class='Delimiter'>, 
</span>                <a href="createas.c.html#LN583"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN61"><span class='Ref_to_Member'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We know this is a newly created relation, so there are no indexes */ 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end intorel_receive &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * intorel_shutdown --- executor end 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN613"></a><span class='Declare_Function'>intorel_shutdown</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN615"></a>    <a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Declare_Local'>myState</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="createas.c.html#LN52"><span class='Ref_to_Typedef'>DR_intorel</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="createas.c.html#LN613"><span class='Ref_to_Parameter'>self</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN148"><span class='Ref_to_Proto'>FreeBulkInsertState</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN615"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN61"><span class='Ref_to_Member'>bistate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If we skipped using WAL, must heap_sync before commit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="createas.c.html#LN615"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN60"><span class='Ref_to_Member'>hi_options</span></a> <span class='Operator'>& </span><a href="../../include/access/heapam.h.html#LN27"><span class='Ref_to_Const'>HEAP_INSERT_SKIP_WAL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN180"><span class='Ref_to_Proto'>heap_sync</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN615"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN57"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* close rel, but keep lock until commit */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN615"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN57"><span class='Ref_to_Member'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="createas.c.html#LN615"><span class='Ref_To_Local'>myState</span></a><span class='Operator'>-&GT;</span><a href="createas.c.html#LN57"><span class='Ref_to_Member'>rel</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * intorel_destroy --- release DestReceiver object 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN632"></a><span class='Declare_Function'>intorel_destroy</span><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>self</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="createas.c.html#LN632"><span class='Ref_to_Parameter'>self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>