<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\event_trigger.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\event_trigger.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:34 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * event_trigger.c 
 *    PostgreSQL EVENT TRIGGER support code. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/event_trigger.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opclass.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_opfamily.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_proc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_ts_config.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/event_trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_func.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"pgstat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/ilist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/deparse_utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/evtcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
 
<a name="LN49"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>EventTriggerQueryState</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* memory context for this state's objects */ 
</span><a name="LN52"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>cxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sql_drop */ 
</span><a name="LN55"></a>    <a href="../../include/lib/ilist.h.html#LN202"><span class='Ref_to_Struct'>slist_head</span></a>  <span class='Declare_Member'>SQLDropList</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>in_sql_drop</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* table_rewrite */ 
</span><a name="LN59"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>table_rewrite_oid</span><span class='Delimiter'>;</span>      <span class='Comment_Multi_Line'>/* InvalidOid, or set for 
                                         * table_rewrite event */ 
</span><a name="LN61"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>table_rewrite_reason</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* AT_REWRITE reason */ 
</span> 
    <span class='Comment_Multi_Line'>/* Support for command collection */ 
</span><a name="LN64"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>commandCollectionInhibited</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Member'>currentCommand</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>commandList</span><span class='Delimiter'>;</span>    <span class='Comment_Multi_Line'>/* list of CollectedCommand; see 
                                 * deparse_utility.h */ 
</span><a name="LN68"></a>    <span class='Control'>struct</span> <a href="event_trigger.c.html#LN49"><span class='Ref_to_Struct'>EventTriggerQueryState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>previous</span><span class='Delimiter'>; 
</span><a name="LN69"></a>}<span class='Auto_Annotations'> &laquo; end EventTriggerQueryState &raquo; </span> <span class='Declare_Typedef'>EventTriggerQueryState</span><span class='Delimiter'>; 
</span> 
<a name="LN71"></a><span class='Keyword'>static </span><a href="event_trigger.c.html#LN49"><span class='Ref_to_Struct'>EventTriggerQueryState</span></a> <span class='Operator'>*</span><span class='Declare_Var'>currentEventTriggerState</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN75"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>obtypename</span><span class='Delimiter'>; 
</span><a name="LN76"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>supported</span><span class='Delimiter'>; 
</span><a name="LN77"></a>} <span class='Declare_Typedef'>event_trigger_support_data</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN81"></a>    <span class='Declare_Enum_Const'>EVENT_TRIGGER_COMMAND_TAG_OK</span><span class='Delimiter'>, 
</span><a name="LN82"></a>    <span class='Declare_Enum_Const'>EVENT_TRIGGER_COMMAND_TAG_NOT_SUPPORTED</span><span class='Delimiter'>, 
</span><a name="LN83"></a>    <span class='Declare_Enum_Const'>EVENT_TRIGGER_COMMAND_TAG_NOT_RECOGNIZED</span> 
<a name="LN84"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>event_trigger_command_tag_check_result</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* XXX merge this with ObjectTypeMap? */ 
</span><a name="LN87"></a><span class='Keyword'>static </span><a href="event_trigger.c.html#LN73"><span class='Ref_to_Typedef'>event_trigger_support_data</span></a> <span class='Declare_Var'>event_trigger_support</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Delimiter'>{</span><span class='String'>"ACCESS METHOD"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"AGGREGATE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"CAST"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"CONSTRAINT"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"COLLATION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"CONVERSION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"DATABASE"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"DOMAIN"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"EXTENSION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"EVENT TRIGGER"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"FOREIGN DATA WRAPPER"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"FOREIGN TABLE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"FUNCTION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"INDEX"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"LANGUAGE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"MATERIALIZED VIEW"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"OPERATOR"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"OPERATOR CLASS"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"OPERATOR FAMILY"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"POLICY"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"PUBLICATION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"ROLE"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"RULE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"SCHEMA"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"SEQUENCE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"SERVER"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"STATISTICS"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"SUBSCRIPTION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TABLE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TABLESPACE"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TRANSFORM"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TRIGGER"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TEXT SEARCH CONFIGURATION"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TEXT SEARCH DICTIONARY"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TEXT SEARCH PARSER"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TEXT SEARCH TEMPLATE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"TYPE"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"USER MAPPING"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"VIEW"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>} 
}; 
</span> 
<span class='Comment_Multi_Line'>/* Support for dropped objects */ 
</span><a name="LN131"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>SQLDropObject</span> 
<span class='Delimiter'>{ 
</span><a name="LN133"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Member'>address</span><span class='Delimiter'>; 
</span><a name="LN134"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>schemaname</span><span class='Delimiter'>; 
</span><a name="LN135"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>objname</span><span class='Delimiter'>; 
</span><a name="LN136"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>objidentity</span><span class='Delimiter'>; 
</span><a name="LN137"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>objecttype</span><span class='Delimiter'>; 
</span><a name="LN138"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>addrnames</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>addrargs</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>original</span><span class='Delimiter'>; 
</span><a name="LN141"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>normal</span><span class='Delimiter'>; 
</span><a name="LN142"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>istemp</span><span class='Delimiter'>; 
</span><a name="LN143"></a>    <a href="../../include/lib/ilist.h.html#LN190"><span class='Ref_to_Struct'>slist_node</span></a>  <span class='Declare_Member'>next</span><span class='Delimiter'>; 
</span><a name="LN144"></a>} <span class='Declare_Typedef'>SQLDropObject</span><span class='Delimiter'>; 
</span> 
<a name="LN146"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AlterEventTriggerOwner_internal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                                <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                                <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN149"></a><span class='Keyword'>static </span><a href="event_trigger.c.html#LN79"><span class='Ref_to_Typedef'>event_trigger_command_tag_check_result</span></a> <span class='Declare_Prototype'>check_ddl_tag</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Keyword'>static </span><a href="event_trigger.c.html#LN79"><span class='Ref_to_Typedef'>event_trigger_command_tag_check_result</span></a> <span class='Declare_Prototype'>check_table_rewrite_ddl_tag</span><span class='Parentheses'>( 
</span><a name="LN151"></a>                            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN152"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>error_duplicate_filter_variable</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>defname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN153"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>filter_list_to_array</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>filterlist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN154"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>insert_event_trigger_tuple</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>trigname</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eventname</span><span class='Delimiter'>, 
</span><a name="LN155"></a>                           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>evtOwner</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>funcoid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tags</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN156"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>validate_ddl_tags</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filtervar</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>taglist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>validate_table_rewrite_tags</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filtervar</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>taglist</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>EventTriggerInvoke</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fn_oid_list</span><span class='Delimiter'>, </span><a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN159"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>stringify_grantobjtype</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>stringify_adefprivs_objtype</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create an event trigger. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN166"></a><span class='Declare_Function'>CreateEventTrigger</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2349"><span class='Ref_to_Struct'>CreateEventTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN168"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN169"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcoid</span><span class='Delimiter'>; 
</span><a name="LN170"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>funcrettype</span><span class='Delimiter'>; 
</span><a name="LN171"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fargtypes</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>];</span>   <span class='Comment_Single_Line'>/* dummy */ 
</span><a name="LN172"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>evtowner</span> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN173"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN174"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tags</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It would be nice to allow database owners or even regular users to do 
     * this, but there are obvious privilege escalation risks which would have 
     * to somehow be plugged first. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to create event trigger \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2352"><span class='Ref_to_Member'>trigname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Must be superuser to create an event trigger."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Validate event name. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"ddl_command_start"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"ddl_command_end"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"sql_drop"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"table_rewrite"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized event name \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Validate filter conditions. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN173"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2354"><span class='Ref_to_Member'>whenclause</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN201"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>def</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN173"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN201"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"tag"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="event_trigger.c.html#LN152"><span class='Ref_to_Proto'>error_duplicate_filter_variable</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN201"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="event_trigger.c.html#LN201"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized filter variable \"%s\""</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN201"><span class='Ref_To_Local'>def</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Validate tag list, if any. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span>strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"ddl_command_start"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>         strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"ddl_command_end"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>         strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"sql_drop"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Operator'>&& </span><a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="event_trigger.c.html#LN156"><span class='Ref_to_Proto'>validate_ddl_tags</span></a><span class='Parentheses'>(</span><span class='String'>"tag"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, </span><span class='String'>"table_rewrite"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> 
             <span class='Operator'>&& </span><a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="event_trigger.c.html#LN157"><span class='Ref_to_Proto'>validate_table_rewrite_tags</span></a><span class='Parentheses'>(</span><span class='String'>"tag"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Give user a nice error message if an event trigger of the same name 
     * already exists. 
     */ 
</span>    <a href="event_trigger.c.html#LN168"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN58"><span class='Ref_to_EnumConst'>EVENTTRIGGERNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2352"><span class='Ref_to_Member'>trigname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN168"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                        <a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2352"><span class='Ref_to_Member'>trigname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find and validate the trigger function. */ 
</span>    <a href="event_trigger.c.html#LN169"><span class='Ref_To_Local'>funcoid</span></a> <span class='Operator'>= </span><a href="../../include/parser/parse_func.h.html#LN62"><span class='Ref_to_Proto'>LookupFuncName</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2355"><span class='Ref_to_Member'>funcname</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN171"><span class='Ref_To_Local'>fargtypes</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN170"><span class='Ref_To_Local'>funcrettype</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN112"><span class='Ref_to_Proto'>get_func_rettype</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN169"><span class='Ref_To_Local'>funcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN170"><span class='Ref_To_Local'>funcrettype</span></a> <span class='Operator'>!= </span><a href="../../include/catalog/pg_type.h.html#LN693"><span class='Ref_to_Const'>EVTTRIGGEROID</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_OBJECT_DEFINITION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function %s must return type %s"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/namespace.h.html#LN120"><span class='Ref_to_Proto'>NameListToString</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2355"><span class='Ref_to_Member'>funcname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"event_trigger"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Insert catalog entries. */ 
</span>    <span class='Control'>return</span> <a href="event_trigger.c.html#LN154"><span class='Ref_to_Proto'>insert_event_trigger_tuple</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2352"><span class='Ref_to_Member'>trigname</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN166"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2353"><span class='Ref_to_Member'>eventname</span></a><span class='Delimiter'>, 
</span>                                      <a href="event_trigger.c.html#LN172"><span class='Ref_To_Local'>evtowner</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN169"><span class='Ref_To_Local'>funcoid</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN174"><span class='Ref_To_Local'>tags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateEventTrigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Validate DDL command tags. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN254"></a><span class='Declare_Function'>validate_ddl_tags</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filtervar</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>taglist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN256"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN256"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN254"><span class='Ref_to_Parameter'>taglist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN260"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tag</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN256"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN261"></a>        <a href="event_trigger.c.html#LN79"><span class='Ref_to_Typedef'>event_trigger_command_tag_check_result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="event_trigger.c.html#LN261"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN149"><span class='Ref_to_Proto'>check_ddl_tag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN260"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN261"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="event_trigger.c.html#LN83"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_RECOGNIZED</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"filter value \"%s\" not recognized for filter variable \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="event_trigger.c.html#LN260"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN254"><span class='Ref_to_Parameter'>filtervar</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN261"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="event_trigger.c.html#LN82"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_SUPPORTED</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <span class='Comment_Multi_Line'>/* translator: %s represents an SQL statement name */ 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event triggers are not supported for %s"</span><span class='Delimiter'>, 
</span>                            <a href="event_trigger.c.html#LN260"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end validate_ddl_tags &raquo; </span> 
 
<span class='Keyword'>static </span><a href="event_trigger.c.html#LN79"><span class='Ref_to_Typedef'>event_trigger_command_tag_check_result</span></a> 
<a name="LN279"></a><span class='Declare_Function'>check_ddl_tag</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN281"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>obtypename</span><span class='Delimiter'>; 
</span><a name="LN282"></a>    <a href="event_trigger.c.html#LN73"><span class='Ref_to_Typedef'>event_trigger_support_data</span></a> <span class='Operator'>*</span><span class='Declare_Local'>etsd</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle some idiosyncratic special cases. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE TABLE AS"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT INTO"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"REFRESH MATERIALIZED VIEW"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER DEFAULT PRIVILEGES"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER LARGE OBJECT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"COMMENT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"GRANT"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"REVOKE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"DROP OWNED"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"IMPORT FOREIGN SCHEMA"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"SECURITY LABEL"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="event_trigger.c.html#LN81"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_OK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, command should be CREATE, ALTER, or DROP. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"CREATE "</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="event_trigger.c.html#LN281"><span class='Ref_To_Local'>obtypename</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a> <span class='Operator'>+ </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER "</span><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="event_trigger.c.html#LN281"><span class='Ref_To_Local'>obtypename</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a> <span class='Operator'>+ </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"DROP "</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="event_trigger.c.html#LN281"><span class='Ref_To_Local'>obtypename</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN279"><span class='Ref_to_Parameter'>tag</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="event_trigger.c.html#LN83"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_RECOGNIZED</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * ...and the object type should be something recognizable. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN282"><span class='Ref_To_Local'>etsd</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN87"><span class='Ref_to_Global_Var'>event_trigger_support</span></a><span class='Delimiter'>; </span><a href="event_trigger.c.html#LN282"><span class='Ref_To_Local'>etsd</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN75"><span class='Ref_to_Member'>obtypename</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="event_trigger.c.html#LN282"><span class='Ref_To_Local'>etsd</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN282"><span class='Ref_To_Local'>etsd</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN75"><span class='Ref_to_Member'>obtypename</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN281"><span class='Ref_To_Local'>obtypename</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN282"><span class='Ref_To_Local'>etsd</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN75"><span class='Ref_to_Member'>obtypename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="event_trigger.c.html#LN83"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_RECOGNIZED</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN282"><span class='Ref_To_Local'>etsd</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN76"><span class='Ref_to_Member'>supported</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="event_trigger.c.html#LN82"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_SUPPORTED</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="event_trigger.c.html#LN81"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_OK</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_ddl_tag &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Validate DDL command tags for event table_rewrite. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN329"></a><span class='Declare_Function'>validate_table_rewrite_tags</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filtervar</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>taglist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN331"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN331"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN329"><span class='Ref_to_Parameter'>taglist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN335"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tag</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN331"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN336"></a>        <a href="event_trigger.c.html#LN79"><span class='Ref_to_Typedef'>event_trigger_command_tag_check_result</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="event_trigger.c.html#LN336"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN150"><span class='Ref_to_Proto'>check_table_rewrite_ddl_tag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN335"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN336"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="event_trigger.c.html#LN82"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_SUPPORTED</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <span class='Comment_Multi_Line'>/* translator: %s represents an SQL statement name */ 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event triggers are not supported for %s"</span><span class='Delimiter'>, 
</span>                            <a href="event_trigger.c.html#LN335"><span class='Ref_To_Local'>tag</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static </span><a href="event_trigger.c.html#LN79"><span class='Ref_to_Typedef'>event_trigger_command_tag_check_result</span></a> 
<a name="LN349"></a><span class='Declare_Function'>check_table_rewrite_ddl_tag</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tag</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN349"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TABLE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN349"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><span class='String'>"ALTER TYPE"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="event_trigger.c.html#LN81"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_OK</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="event_trigger.c.html#LN82"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_NOT_SUPPORTED</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Complain about a duplicate filter variable. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN362"></a><span class='Declare_Function'>error_duplicate_filter_variable</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>defname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"filter variable \"%s\" specified more than once"</span><span class='Delimiter'>, 
</span>                    <a href="event_trigger.c.html#LN362"><span class='Ref_to_Parameter'>defname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Insert the new pg_event_trigger row and record dependencies. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN374"></a><span class='Declare_Function'>insert_event_trigger_tuple</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>trigname</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eventname</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>evtOwner</span><span class='Delimiter'>, 
</span><a name="LN375"></a>                           <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>funcoid</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>taglist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN377"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN378"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>trigoid</span><span class='Delimiter'>; 
</span><a name="LN379"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN380"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_trigger</span></a><span class='Delimiter'>]; 
</span><a name="LN381"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_trigger.h.html#LN77"><span class='Ref_to_Const'>Natts_pg_trigger</span></a><span class='Delimiter'>]; 
</span><a name="LN382"></a>    <a href="../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>evtnamedata</span><span class='Delimiter'>, 
</span><a name="LN383"></a>                <span class='Declare_Local'>evteventdata</span><span class='Delimiter'>; 
</span><a name="LN384"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>, 
</span><a name="LN385"></a>                <span class='Declare_Local'>referenced</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Open pg_event_trigger. */ 
</span>    <a href="event_trigger.c.html#LN377"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build the new pg_trigger tuple. */ 
</span>    memset<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN381"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN381"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN382"><span class='Ref_To_Local'>evtnamedata</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN374"><span class='Ref_to_Parameter'>trigname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN56"><span class='Ref_to_Const'>Anum_pg_event_trigger_evtname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN382"><span class='Ref_To_Local'>evtnamedata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN383"><span class='Ref_To_Local'>evteventdata</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN374"><span class='Ref_to_Parameter'>eventname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN57"><span class='Ref_to_Const'>Anum_pg_event_trigger_evtevent</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN383"><span class='Ref_To_Local'>evteventdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_event_trigger_evtowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN374"><span class='Ref_to_Parameter'>evtOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_event_trigger_evtfoid</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN375"><span class='Ref_to_Parameter'>funcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_event_trigger_evtenabled</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/postgres.h.html#LN421"><span class='Ref_to_Macro'>CharGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN375"><span class='Ref_to_Parameter'>taglist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="event_trigger.c.html#LN381"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_event_trigger_evttags</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_event_trigger.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_event_trigger_evttags</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="event_trigger.c.html#LN153"><span class='Ref_to_Proto'>filter_list_to_array</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN375"><span class='Ref_to_Parameter'>taglist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Insert heap tuple. */ 
</span>    <a href="event_trigger.c.html#LN379"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN377"><span class='Ref_To_Local'>tgrel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN380"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN381"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN378"><span class='Ref_To_Local'>trigoid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN377"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN379"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN379"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Depend on owner. */ 
</span>    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN378"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN374"><span class='Ref_to_Parameter'>evtOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Depend on event trigger function. */ 
</span>    <a href="event_trigger.c.html#LN384"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN384"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN378"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN384"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN385"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_proc.h.html#LN32"><span class='Ref_to_Const'>ProcedureRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN385"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN375"><span class='Ref_to_Parameter'>funcoid</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN385"><span class='Ref_To_Local'>referenced</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN384"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN385"><span class='Ref_To_Local'>referenced</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Depend on extension, if any. */ 
</span>    <a href="../catalog/pg_depend.c.html#LN137"><span class='Ref_to_Func'>recordDependencyOnCurrentExtension</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN384"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Post creation hook for new event trigger */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN378"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Close pg_event_trigger. */ 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN377"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="event_trigger.c.html#LN378"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end insert_event_trigger_tuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * In the parser, a clause like WHEN tag IN ('cmd1', 'cmd2') is represented 
 * by a DefElem whose value is a List of String nodes; in the catalog, we 
 * store the list of strings as a text array.  This function transforms the 
 * former representation into the latter one. 
 * 
 * For cleanliness, we store command tags in the catalog as text.  It's 
 * possible (although not currently anticipated) that we might have 
 * a case-sensitive filter variable in the future, in which case this would 
 * need some further adjustment. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN447"></a><span class='Declare_Function'>filter_list_to_array</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>filterlist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN449"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN450"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN451"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN452"></a>                <span class='Declare_Local'>l</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN447"><span class='Ref_to_Parameter'>filterlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN450"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN452"><span class='Ref_To_Local'>l</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN449"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN447"><span class='Ref_to_Parameter'>filterlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN458"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN449"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN459"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>, 
</span><a name="LN460"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
        <a href="event_trigger.c.html#LN459"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN460"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN459"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="event_trigger.c.html#LN460"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="event_trigger.c.html#LN460"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="event_trigger.c.html#LN460"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../include/port.h.html#LN126"><span class='Ref_to_Proto'>pg_ascii_toupper</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="event_trigger.c.html#LN460"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="event_trigger.c.html#LN450"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN451"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN459"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN459"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN450"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN452"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end filter_list_to_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Guts of event trigger deletion. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN476"></a><span class='Declare_Function'>RemoveEventTriggerById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>trigOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN478"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN479"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN478"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN479"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN59"><span class='Ref_to_EnumConst'>EVENTTRIGGEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN476"><span class='Ref_to_Parameter'>trigOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN479"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for event trigger %u"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN476"><span class='Ref_to_Parameter'>trigOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN478"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN479"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN479"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN478"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ALTER EVENT TRIGGER foo ENABLE|DISABLE|ENABLE ALWAYS|REPLICA 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN498"></a><span class='Declare_Function'>AlterEventTrigger</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2362"><span class='Ref_to_Struct'>AlterEventTrigStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN500"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>tgrel</span><span class='Delimiter'>; 
</span><a name="LN501"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN502"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>trigoid</span><span class='Delimiter'>; 
</span><a name="LN503"></a>    <a href="../../include/catalog/pg_event_trigger.h.html#LN49"><span class='Ref_to_Typedef'>Form_pg_event_trigger</span></a> <span class='Declare_Local'>evtForm</span><span class='Delimiter'>; 
</span><a name="LN504"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tgenabled</span> <span class='Operator'>= </span><a href="event_trigger.c.html#LN498"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2366"><span class='Ref_to_Member'>tgenabled</span></a><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN500"><span class='Ref_To_Local'>tgrel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN58"><span class='Ref_to_EnumConst'>EVENTTRIGGERNAME</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN498"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2365"><span class='Ref_to_Member'>trigname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="event_trigger.c.html#LN498"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2365"><span class='Ref_to_Member'>trigname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN502"><span class='Ref_To_Local'>trigoid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN325"><span class='Ref_to_Proto'>pg_event_trigger_ownercheck</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN502"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN200"><span class='Ref_to_EnumConst'>ACL_KIND_EVENT_TRIGGER</span></a><span class='Delimiter'>, 
</span>                       <a href="event_trigger.c.html#LN498"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2365"><span class='Ref_to_Member'>trigname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* tuple is a copy, so we can modify it below */ 
</span>    <a href="event_trigger.c.html#LN503"><span class='Ref_To_Local'>evtForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN49"><span class='Ref_to_Typedef'>Form_pg_event_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN503"><span class='Ref_To_Local'>evtForm</span></a><span class='Operator'>-&GT;</span>evtenabled <span class='Operator'>= </span><a href="event_trigger.c.html#LN504"><span class='Ref_To_Local'>tgenabled</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN500"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="event_trigger.c.html#LN502"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* clean up */ 
</span>    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN501"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN500"><span class='Ref_To_Local'>tgrel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="event_trigger.c.html#LN502"><span class='Ref_To_Local'>trigoid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterEventTrigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change event trigger's owner -- by name 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN542"></a><span class='Declare_Function'>AlterEventTriggerOwner</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN544"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>evtOid</span><span class='Delimiter'>; 
</span><a name="LN545"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN546"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN547"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN546"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN545"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN58"><span class='Ref_to_EnumConst'>EVENTTRIGGERNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN542"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN545"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN542"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN544"><span class='Ref_To_Local'>evtOid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN545"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN146"><span class='Ref_to_Proto'>AlterEventTriggerOwner_internal</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN546"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN545"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN542"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN547"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN544"><span class='Ref_To_Local'>evtOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN545"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN546"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="event_trigger.c.html#LN547"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterEventTriggerOwner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Change event trigger owner, by OID 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN575"></a><span class='Declare_Function'>AlterEventTriggerOwner_oid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>trigOid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN577"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN578"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN578"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN577"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN164"><span class='Ref_to_Macro'>SearchSysCacheCopy1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN59"><span class='Ref_to_EnumConst'>EVENTTRIGGEROID</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN575"><span class='Ref_to_Parameter'>trigOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN577"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger with OID %u does not exist"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN575"><span class='Ref_to_Parameter'>trigOid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN146"><span class='Ref_to_Proto'>AlterEventTriggerOwner_internal</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN578"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN577"><span class='Ref_To_Local'>tup</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN575"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN577"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN578"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterEventTriggerOwner_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Internal workhorse for changing an event trigger's owner 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN600"></a><span class='Declare_Function'>AlterEventTriggerOwner_internal</span><span class='Parentheses'>(</span><a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Delimiter'>, </span><a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tup</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>newOwnerId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN602"></a>    <a href="../../include/catalog/pg_event_trigger.h.html#LN49"><span class='Ref_to_Typedef'>Form_pg_event_trigger</span></a> <span class='Declare_Local'>form</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN602"><span class='Ref_To_Local'>form</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN49"><span class='Ref_to_Typedef'>Form_pg_event_trigger</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN602"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>evtowner <span class='Operator'>== </span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN325"><span class='Ref_to_Proto'>pg_event_trigger_ownercheck</span></a><span class='Parentheses'>(</span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN200"><span class='Ref_to_EnumConst'>ACL_KIND_EVENT_TRIGGER</span></a><span class='Delimiter'>, 
</span>                       <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN602"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>evtname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* New owner must be a superuser */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/misc/superuser.c.html#LN55"><span class='Ref_to_Func'>superuser_arg</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to change owner of event trigger \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN602"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>evtname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>             <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The owner of an event trigger must be a superuser."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN602"><span class='Ref_To_Local'>form</span></a><span class='Operator'>-&GT;</span>evtowner <span class='Operator'>= </span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>tup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update owner dependency reference */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN259"><span class='Ref_to_Proto'>changeDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, 
</span>                            <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>newOwnerId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_event_trigger.h.html#LN28"><span class='Ref_to_Const'>EventTriggerRelationId</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN600"><span class='Ref_to_Parameter'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterEventTriggerOwner_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_event_trigger_oid - Look up an event trigger by name to find its OID. 
 * 
 * If missing_ok is false, throw an error if trigger not found.  If 
 * true, just return InvalidOid. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN640"></a><span class='Declare_Function'>get_event_trigger_oid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>trigname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN642"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN642"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../include/utils/syscache.h.html#LN182"><span class='Ref_to_Macro'>GetSysCacheOid1</span></a><span class='Parentheses'>(</span><a href="../../include/utils/syscache.h.html#LN58"><span class='Ref_to_EnumConst'>EVENTTRIGGERNAME</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN640"><span class='Ref_to_Parameter'>trigname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN642"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="event_trigger.c.html#LN640"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"event trigger \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN640"><span class='Ref_to_Parameter'>trigname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="event_trigger.c.html#LN642"><span class='Ref_To_Local'>oid</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return true when we want to fire given Event Trigger and false otherwise, 
 * filtering on the session replication role and the event trigger registered 
 * tags matching. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN658"></a><span class='Declare_Function'>filter_event_trigger</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>tag</span><span class='Delimiter'>, </span><a href="../../include/utils/evtcache.h.html#LN26"><span class='Ref_to_Typedef'>EventTriggerCacheItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>item</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Filter by session replication role, knowing that we never see disabled 
     * items down here. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="trigger.c.html#LN63"><span class='Ref_to_Global_Var'>SessionReplicationRole</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN100"><span class='Ref_to_Const'>SESSION_REPLICATION_ROLE_REPLICA</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN658"><span class='Ref_to_Parameter'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/evtcache.h.html#LN29"><span class='Ref_to_Member'>enabled</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN108"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_ORIGIN</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN658"><span class='Ref_to_Parameter'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/evtcache.h.html#LN29"><span class='Ref_to_Member'>enabled</span></a> <span class='Operator'>== </span><a href="../../include/commands/trigger.h.html#LN110"><span class='Ref_to_Const'>TRIGGER_FIRES_ON_REPLICA</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Filter by tags, if any were specified. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN658"><span class='Ref_to_Parameter'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/evtcache.h.html#LN30"><span class='Ref_to_Member'>ntags</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span>bsearch<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN658"><span class='Ref_to_Parameter'>tag</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN658"><span class='Ref_to_Parameter'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/evtcache.h.html#LN31"><span class='Ref_to_Member'>tag</span></a><span class='Delimiter'>, 
</span>                                    <a href="event_trigger.c.html#LN658"><span class='Ref_to_Parameter'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/evtcache.h.html#LN30"><span class='Ref_to_Member'>ntags</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../port/qsort.c.html#LN230"><span class='Ref_to_Func'>pg_qsort_strcmp</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we reach that point, we're not filtering out this item */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end filter_event_trigger &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Setup for running triggers for the given event.  Return value is an OID list 
 * of functions to run; if there are any, trigdata is filled with an 
 * appropriate EventTriggerData for them to receive. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN691"></a><span class='Declare_Function'>EventTriggerCommonSetup</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, 
</span><a name="LN692"></a>                        <a href="../../include/utils/evtcache.h.html#LN18"><span class='Ref_to_Typedef'>EventTriggerEvent</span></a> <span class='Declare_Parameter'>event</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eventstr</span><span class='Delimiter'>, 
</span><a name="LN693"></a>                        <a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN695"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tag</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cachelist</span><span class='Delimiter'>; 
</span><a name="LN697"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN698"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>runlist</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We want the list of command tags for which this procedure is actually 
     * invoked to match up exactly with the list that CREATE EVENT TRIGGER 
     * accepts.  This debugging cross-check will throw an error if this 
     * function is invoked for a command tag that CREATE EVENT TRIGGER won't 
     * accept.  (Unfortunately, there doesn't seem to be any simple, automated 
     * way to verify that CREATE EVENT TRIGGER doesn't accept extra stuff that 
     * never reaches this control point.) 
     * 
     * If this cross-check fails for you, you probably need to either adjust 
     * standard_ProcessUtility() not to invoke event triggers for the command 
     * type in question, or you need to adjust check_ddl_tag to accept the 
     * relevant command tag. 
     */ 
</span><span class='Directive'>#ifdef</span> USE_ASSERT_CHECKING 
    <span class='Delimiter'>{ 
</span><a name="LN716"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>dbgtag</span><span class='Delimiter'>; 
</span> 
        <a href="event_trigger.c.html#LN716"><span class='Ref_To_Local'>dbgtag</span></a> <span class='Operator'>= </span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN691"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN692"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/utils/evtcache.h.html#LN20"><span class='Ref_to_EnumConst'>EVT_DDLCommandStart</span></a> <span class='Operator'>|| 
</span>            <a href="event_trigger.c.html#LN692"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/utils/evtcache.h.html#LN21"><span class='Ref_to_EnumConst'>EVT_DDLCommandEnd</span></a> <span class='Operator'>|| 
</span>            <a href="event_trigger.c.html#LN692"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/utils/evtcache.h.html#LN22"><span class='Ref_to_EnumConst'>EVT_SQLDrop</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN149"><span class='Ref_to_Proto'>check_ddl_tag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN716"><span class='Ref_To_Local'>dbgtag</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="event_trigger.c.html#LN81"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_OK</span></a><span class='Parentheses'>)</span> 
                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected command tag \"%s\""</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN716"><span class='Ref_To_Local'>dbgtag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN692"><span class='Ref_to_Parameter'>event</span></a> <span class='Operator'>== </span><a href="../../include/utils/evtcache.h.html#LN23"><span class='Ref_to_EnumConst'>EVT_TableRewrite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN150"><span class='Ref_to_Proto'>check_table_rewrite_ddl_tag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN716"><span class='Ref_To_Local'>dbgtag</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="event_trigger.c.html#LN81"><span class='Ref_to_EnumConst'>EVENT_TRIGGER_COMMAND_TAG_OK</span></a><span class='Parentheses'>)</span> 
                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected command tag \"%s\""</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN716"><span class='Ref_To_Local'>dbgtag</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* Use cache to find triggers for this event; fast exit if none. */ 
</span>    <a href="event_trigger.c.html#LN696"><span class='Ref_To_Local'>cachelist</span></a> <span class='Operator'>= </span><a href="../../include/utils/evtcache.h.html#LN34"><span class='Ref_to_Proto'>EventCacheLookup</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN692"><span class='Ref_to_Parameter'>event</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN696"><span class='Ref_To_Local'>cachelist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get the command tag. */ 
</span>    <a href="event_trigger.c.html#LN695"><span class='Ref_To_Local'>tag</span></a> <span class='Operator'>= </span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN691"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Filter list of event triggers by command tag, and copy them into our 
     * memory context.  Once we start running the command triggers, or indeed 
     * once we do anything at all that touches the catalogs, an invalidation 
     * might leave cachelist pointing at garbage, so we must do this before we 
     * can do much else. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN697"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN696"><span class='Ref_To_Local'>cachelist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN751"></a>        <a href="../../include/utils/evtcache.h.html#LN26"><span class='Ref_to_Typedef'>EventTriggerCacheItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN697"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN657"><span class='Ref_to_Func'>filter_event_trigger</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN695"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN751"><span class='Ref_To_Local'>item</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We must plan to fire this trigger. */ 
</span>            <a href="event_trigger.c.html#LN698"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN698"><span class='Ref_To_Local'>runlist</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN751"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/evtcache.h.html#LN28"><span class='Ref_to_Member'>fnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* don't spend any more time on this if no functions to run */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN698"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN693"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/event_trigger.h.html#LN24"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN491"><span class='Ref_to_EnumConst'>T_EventTriggerData</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN693"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/event_trigger.h.html#LN25"><span class='Ref_to_Member'>event</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN692"><span class='Ref_to_Parameter'>eventstr</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN693"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/event_trigger.h.html#LN26"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN691"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN693"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../include/commands/event_trigger.h.html#LN27"><span class='Ref_to_Member'>tag</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN695"><span class='Ref_To_Local'>tag</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="event_trigger.c.html#LN698"><span class='Ref_To_Local'>runlist</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCommonSetup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fire ddl_command_start triggers. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN776"></a><span class='Declare_Function'>EventTriggerDDLCommandStart</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN778"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>runlist</span><span class='Delimiter'>; 
</span><a name="LN779"></a>    <a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Declare_Local'>trigdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Event Triggers are completely disabled in standalone mode.  There are 
     * (at least) two reasons for this: 
     * 
     * 1. A sufficiently broken event trigger might not only render the 
     * database unusable, but prevent disabling itself to fix the situation. 
     * In this scenario, restarting in standalone mode provides an escape 
     * hatch. 
     * 
     * 2. BuildEventTriggerCache relies on systable_beginscan_ordered, and 
     * therefore will malfunction if pg_event_trigger's indexes are damaged. 
     * To allow recovery from a damaged index, we need some operating mode 
     * wherein event triggers are disabled.  (Or we could implement 
     * heapscan-and-sort logic for that case, but having disaster recovery 
     * scenarios depend on code that's otherwise untested isn't appetizing.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN778"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN690"><span class='Ref_to_Func'>EventTriggerCommonSetup</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN776"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/evtcache.h.html#LN20"><span class='Ref_to_EnumConst'>EVT_DDLCommandStart</span></a><span class='Delimiter'>, 
</span>                                      <span class='String'>"ddl_command_start"</span><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="event_trigger.c.html#LN779"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN778"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Run the triggers. */ 
</span>    <a href="event_trigger.c.html#LN158"><span class='Ref_to_Proto'>EventTriggerInvoke</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN778"><span class='Ref_To_Local'>runlist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN779"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN778"><span class='Ref_To_Local'>runlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure anything the event triggers did will be visible to the main 
     * command. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerDDLCommandStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fire ddl_command_end triggers. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN824"></a><span class='Declare_Function'>EventTriggerDDLCommandEnd</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN826"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>runlist</span><span class='Delimiter'>; 
</span><a name="LN827"></a>    <a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Declare_Local'>trigdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See EventTriggerDDLCommandStart for a discussion about why event 
     * triggers are disabled in single user mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN826"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN690"><span class='Ref_to_Func'>EventTriggerCommonSetup</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN824"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/evtcache.h.html#LN21"><span class='Ref_to_EnumConst'>EVT_DDLCommandEnd</span></a><span class='Delimiter'>, </span><span class='String'>"ddl_command_end"</span><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="event_trigger.c.html#LN827"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN826"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure anything the main command did will be visible to the event 
     * triggers. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Run the triggers. */ 
</span>    <a href="event_trigger.c.html#LN158"><span class='Ref_to_Proto'>EventTriggerInvoke</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN826"><span class='Ref_To_Local'>runlist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN827"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN826"><span class='Ref_To_Local'>runlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerDDLCommandEnd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Fire sql_drop triggers. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN859"></a><span class='Declare_Function'>EventTriggerSQLDrop</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN861"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>runlist</span><span class='Delimiter'>; 
</span><a name="LN862"></a>    <a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Declare_Local'>trigdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * See EventTriggerDDLCommandStart for a discussion about why event 
     * triggers are disabled in single user mode. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use current state to determine whether this event fires at all.  If 
     * there are no triggers for the sql_drop event, then we don't have 
     * anything to do here.  Note that dropped object collection is disabled 
     * if this is the case, so even if we were to try to run, the list would 
     * be empty. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="../../include/lib/ilist.h.html#LN561"><span class='Ref_to_Func'>slist_is_empty</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN55"><span class='Ref_to_Member'>SQLDropList</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN861"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN690"><span class='Ref_to_Func'>EventTriggerCommonSetup</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN859"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/evtcache.h.html#LN22"><span class='Ref_to_EnumConst'>EVT_SQLDrop</span></a><span class='Delimiter'>, </span><span class='String'>"sql_drop"</span><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="event_trigger.c.html#LN862"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Nothing to do if run list is empty.  Note this shouldn't happen, 
     * because if there are no sql_drop events, then objects-to-drop wouldn't 
     * have been collected in the first place and we would have quit above. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN861"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure anything the main command did will be visible to the event 
     * triggers. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure pg_event_trigger_dropped_objects only works when running 
     * these triggers.  Use PG_TRY to ensure in_sql_drop is reset even when 
     * one trigger fails.  (This is perhaps not necessary, as the currentState 
     * variable will be removed shortly by our caller, but it seems better to 
     * play safe.) 
     */ 
</span>    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN56"><span class='Ref_to_Member'>in_sql_drop</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Run the triggers. */ 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="event_trigger.c.html#LN158"><span class='Ref_to_Proto'>EventTriggerInvoke</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN861"><span class='Ref_To_Local'>runlist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN862"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN56"><span class='Ref_to_Member'>in_sql_drop</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN56"><span class='Ref_to_Member'>in_sql_drop</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN861"><span class='Ref_To_Local'>runlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerSQLDrop &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Fire table_rewrite triggers. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN931"></a><span class='Declare_Function'>EventTriggerTableRewrite</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableOid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>reason</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN933"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>runlist</span><span class='Delimiter'>; 
</span><a name="LN934"></a>    <a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Declare_Local'>trigdata</span><span class='Delimiter'>; 
</span> 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"EventTriggerTableRewrite(%u)"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN931"><span class='Ref_to_Parameter'>tableOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Event Triggers are completely disabled in standalone mode.  There are 
     * (at least) two reasons for this: 
     * 
     * 1. A sufficiently broken event trigger might not only render the 
     * database unusable, but prevent disabling itself to fix the situation. 
     * In this scenario, restarting in standalone mode provides an escape 
     * hatch. 
     * 
     * 2. BuildEventTriggerCache relies on systable_beginscan_ordered, and 
     * therefore will malfunction if pg_event_trigger's indexes are damaged. 
     * To allow recovery from a damaged index, we need some operating mode 
     * wherein event triggers are disabled.  (Or we could implement 
     * heapscan-and-sort logic for that case, but having disaster recovery 
     * scenarios depend on code that's otherwise untested isn't appetizing.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../utils/init/globals.c.html#LN100"><span class='Ref_to_Global_Var'>IsUnderPostmaster</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN933"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN690"><span class='Ref_to_Func'>EventTriggerCommonSetup</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN931"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/evtcache.h.html#LN23"><span class='Ref_to_EnumConst'>EVT_TableRewrite</span></a><span class='Delimiter'>, 
</span>                                      <span class='String'>"table_rewrite"</span><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="event_trigger.c.html#LN934"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN933"><span class='Ref_To_Local'>runlist</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure pg_event_trigger_table_rewrite_oid only works when running 
     * these triggers. Use PG_TRY to ensure table_rewrite_oid is reset even 
     * when one trigger fails. (This is perhaps not necessary, as the 
     * currentState variable will be removed shortly by our caller, but it 
     * seems better to play safe.) 
     */ 
</span>    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN59"><span class='Ref_to_Member'>table_rewrite_oid</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN931"><span class='Ref_to_Parameter'>tableOid</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN61"><span class='Ref_to_Member'>table_rewrite_reason</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN931"><span class='Ref_to_Parameter'>reason</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Run the triggers. */ 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="event_trigger.c.html#LN158"><span class='Ref_to_Proto'>EventTriggerInvoke</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN933"><span class='Ref_To_Local'>runlist</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN934"><span class='Ref_To_Local'>trigdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN59"><span class='Ref_to_Member'>table_rewrite_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN61"><span class='Ref_to_Member'>table_rewrite_reason</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN59"><span class='Ref_to_Member'>table_rewrite_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN61"><span class='Ref_to_Member'>table_rewrite_reason</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN933"><span class='Ref_To_Local'>runlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make sure anything the event triggers did will be visible to the main 
     * command. 
     */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerTableRewrite &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Invoke each event trigger in a list of event triggers. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1004"></a><span class='Declare_Function'>EventTriggerInvoke</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fn_oid_list</span><span class='Delimiter'>, </span><a href="../../include/commands/event_trigger.h.html#LN22"><span class='Ref_to_Struct'>EventTriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>trigdata</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1006"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span><a name="LN1007"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1008"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN1009"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>first</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Guard against stack overflow due to recursive event trigger */ 
</span>    <a href="../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let's evaluate event triggers in their own memory context, so that any 
     * leaks get cleaned up promptly. 
     */ 
</span>    <a href="event_trigger.c.html#LN1006"><span class='Ref_To_Local'>context</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"event trigger context"</span><span class='Delimiter'>, 
</span>                                    <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1007"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1006"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Call each event trigger. */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1008"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1004"><span class='Ref_to_Parameter'>fn_oid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1026"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>fnoid</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1008"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1027"></a>        <a href="../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>flinfo</span><span class='Delimiter'>; 
</span><a name="LN1028"></a>        <a href="../../include/fmgr.h.html#LN76"><span class='Ref_to_Struct'>FunctionCallInfoData</span></a> <span class='Declare_Local'>fcinfo</span><span class='Delimiter'>; 
</span><a name="LN1029"></a>        <a href="../../include/pgstat.h.html#LN1086"><span class='Ref_to_Struct'>PgStat_FunctionCallUsage</span></a> <span class='Declare_Local'>fcusage</span><span class='Delimiter'>; 
</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"EventTriggerInvoke %u"</span><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1026"><span class='Ref_To_Local'>fnoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We want each event trigger to be able to see the results of the 
         * previous event trigger's action.  Caller is responsible for any 
         * command-counter increment that is needed between the event trigger 
         * and anything else in the transaction. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1009"><span class='Ref_To_Local'>first</span></a><span class='Parentheses'>) 
</span>            <a href="event_trigger.c.html#LN1009"><span class='Ref_To_Local'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Look up the function */ 
</span>        <a href="../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1026"><span class='Ref_To_Local'>fnoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1027"><span class='Ref_To_Local'>flinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Call the function, passing no arguments but setting a context. */ 
</span>        <a href="../../include/fmgr.h.html#LN119"><span class='Ref_to_Macro'>InitFunctionCallInfoData</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1028"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1027"><span class='Ref_To_Local'>flinfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="event_trigger.c.html#LN1004"><span class='Ref_to_Parameter'>trigdata</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/pgstat.h.html#LN1293"><span class='Ref_to_Proto'>pgstat_init_function_usage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1028"><span class='Ref_To_Local'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1029"><span class='Ref_To_Local'>fcusage</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/fmgr.h.html#LN136"><span class='Ref_to_Macro'>FunctionCallInvoke</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1028"><span class='Ref_To_Local'>fcinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/pgstat.h.html#LN1295"><span class='Ref_to_Proto'>pgstat_end_function_usage</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1029"><span class='Ref_To_Local'>fcusage</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Reclaim memory. */ 
</span>        <a href="../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1006"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Restore old memory context and delete the temporary one. */ 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1007"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1006"><span class='Ref_To_Local'>context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerInvoke &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Do event triggers support this object type? 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1067"></a><span class='Declare_Function'>EventTriggerSupportsObjectType</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1583"><span class='Ref_to_Enum'>ObjectType</span></a> <span class='Declare_Parameter'>obtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1067"><span class='Ref_to_Parameter'>obtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1594"><span class='Ref_to_EnumConst'>OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1623"><span class='Ref_to_EnumConst'>OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1615"><span class='Ref_to_EnumConst'>OBJECT_ROLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no support for global objects */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1599"><span class='Ref_to_EnumConst'>OBJECT_EVENT_TRIGGER</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no support for event triggers on event triggers */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1585"><span class='Ref_to_EnumConst'>OBJECT_ACCESS_METHOD</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1586"><span class='Ref_to_EnumConst'>OBJECT_AGGREGATE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1587"><span class='Ref_to_EnumConst'>OBJECT_AMOP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1588"><span class='Ref_to_EnumConst'>OBJECT_AMPROC</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1589"><span class='Ref_to_EnumConst'>OBJECT_ATTRIBUTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1590"><span class='Ref_to_EnumConst'>OBJECT_CAST</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1591"><span class='Ref_to_EnumConst'>OBJECT_COLUMN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1592"><span class='Ref_to_EnumConst'>OBJECT_COLLATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1593"><span class='Ref_to_EnumConst'>OBJECT_CONVERSION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1596"><span class='Ref_to_EnumConst'>OBJECT_DEFACL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1595"><span class='Ref_to_EnumConst'>OBJECT_DEFAULT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1597"><span class='Ref_to_EnumConst'>OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1598"><span class='Ref_to_EnumConst'>OBJECT_DOMCONSTRAINT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1600"><span class='Ref_to_EnumConst'>OBJECT_EXTENSION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1601"><span class='Ref_to_EnumConst'>OBJECT_FDW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1602"><span class='Ref_to_EnumConst'>OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1603"><span class='Ref_to_EnumConst'>OBJECT_FOREIGN_TABLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1604"><span class='Ref_to_EnumConst'>OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1605"><span class='Ref_to_EnumConst'>OBJECT_INDEX</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1606"><span class='Ref_to_EnumConst'>OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1607"><span class='Ref_to_EnumConst'>OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1608"><span class='Ref_to_EnumConst'>OBJECT_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1609"><span class='Ref_to_EnumConst'>OBJECT_OPCLASS</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1610"><span class='Ref_to_EnumConst'>OBJECT_OPERATOR</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1611"><span class='Ref_to_EnumConst'>OBJECT_OPFAMILY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1612"><span class='Ref_to_EnumConst'>OBJECT_POLICY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1613"><span class='Ref_to_EnumConst'>OBJECT_PUBLICATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1614"><span class='Ref_to_EnumConst'>OBJECT_PUBLICATION_REL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1616"><span class='Ref_to_EnumConst'>OBJECT_RULE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1617"><span class='Ref_to_EnumConst'>OBJECT_SCHEMA</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1618"><span class='Ref_to_EnumConst'>OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1619"><span class='Ref_to_EnumConst'>OBJECT_SUBSCRIPTION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1620"><span class='Ref_to_EnumConst'>OBJECT_STATISTIC_EXT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1621"><span class='Ref_to_EnumConst'>OBJECT_TABCONSTRAINT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1622"><span class='Ref_to_EnumConst'>OBJECT_TABLE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1624"><span class='Ref_to_EnumConst'>OBJECT_TRANSFORM</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1625"><span class='Ref_to_EnumConst'>OBJECT_TRIGGER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1626"><span class='Ref_to_EnumConst'>OBJECT_TSCONFIGURATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1627"><span class='Ref_to_EnumConst'>OBJECT_TSDICTIONARY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1628"><span class='Ref_to_EnumConst'>OBJECT_TSPARSER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1629"><span class='Ref_to_EnumConst'>OBJECT_TSTEMPLATE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1630"><span class='Ref_to_EnumConst'>OBJECT_TYPE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1631"><span class='Ref_to_EnumConst'>OBJECT_USER_MAPPING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1632"><span class='Ref_to_EnumConst'>OBJECT_VIEW</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * There's intentionally no default: case here; we want the 
             * compiler to warn if a new ObjectType hasn't been handled above. 
             */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch obtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Shouldn't get here, but if we do, say "no support" */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerSupportsObjectType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Do event triggers support this object class? 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1139"></a><span class='Declare_Function'>EventTriggerSupportsObjectClass</span><span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN128"><span class='Ref_to_Enum'>ObjectClass</span></a> <span class='Declare_Parameter'>objclass</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1139"><span class='Ref_to_Parameter'>objclass</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN155"><span class='Ref_to_EnumConst'>OCLASS_DATABASE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN156"><span class='Ref_to_EnumConst'>OCLASS_TBLSPACE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN154"><span class='Ref_to_EnumConst'>OCLASS_ROLE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no support for global objects */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN162"><span class='Ref_to_EnumConst'>OCLASS_EVENT_TRIGGER</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no support for event triggers on event triggers */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN130"><span class='Ref_to_EnumConst'>OCLASS_CLASS</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN131"><span class='Ref_to_EnumConst'>OCLASS_PROC</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN132"><span class='Ref_to_EnumConst'>OCLASS_TYPE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN133"><span class='Ref_to_EnumConst'>OCLASS_CAST</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN134"><span class='Ref_to_EnumConst'>OCLASS_COLLATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN135"><span class='Ref_to_EnumConst'>OCLASS_CONSTRAINT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN136"><span class='Ref_to_EnumConst'>OCLASS_CONVERSION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN137"><span class='Ref_to_EnumConst'>OCLASS_DEFAULT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN138"><span class='Ref_to_EnumConst'>OCLASS_LANGUAGE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN139"><span class='Ref_to_EnumConst'>OCLASS_LARGEOBJECT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN140"><span class='Ref_to_EnumConst'>OCLASS_OPERATOR</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN141"><span class='Ref_to_EnumConst'>OCLASS_OPCLASS</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN142"><span class='Ref_to_EnumConst'>OCLASS_OPFAMILY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN143"><span class='Ref_to_EnumConst'>OCLASS_AM</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN144"><span class='Ref_to_EnumConst'>OCLASS_AMOP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN145"><span class='Ref_to_EnumConst'>OCLASS_AMPROC</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN146"><span class='Ref_to_EnumConst'>OCLASS_REWRITE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN147"><span class='Ref_to_EnumConst'>OCLASS_TRIGGER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN148"><span class='Ref_to_EnumConst'>OCLASS_SCHEMA</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN149"><span class='Ref_to_EnumConst'>OCLASS_STATISTIC_EXT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN150"><span class='Ref_to_EnumConst'>OCLASS_TSPARSER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN151"><span class='Ref_to_EnumConst'>OCLASS_TSDICT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN152"><span class='Ref_to_EnumConst'>OCLASS_TSTEMPLATE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN153"><span class='Ref_to_EnumConst'>OCLASS_TSCONFIG</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN157"><span class='Ref_to_EnumConst'>OCLASS_FDW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN158"><span class='Ref_to_EnumConst'>OCLASS_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN159"><span class='Ref_to_EnumConst'>OCLASS_USER_MAPPING</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN160"><span class='Ref_to_EnumConst'>OCLASS_DEFACL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN161"><span class='Ref_to_EnumConst'>OCLASS_EXTENSION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN163"><span class='Ref_to_EnumConst'>OCLASS_POLICY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN164"><span class='Ref_to_EnumConst'>OCLASS_PUBLICATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN165"><span class='Ref_to_EnumConst'>OCLASS_PUBLICATION_REL</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN166"><span class='Ref_to_EnumConst'>OCLASS_SUBSCRIPTION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/catalog/dependency.h.html#LN167"><span class='Ref_to_EnumConst'>OCLASS_TRANSFORM</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * There's intentionally no default: case here; we want the 
             * compiler to warn if a new OCLASS hasn't been handled above. 
             */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objclass &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Shouldn't get here, but if we do, say "no support" */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerSupportsObjectClass &raquo; </span> 
 
<span class='Keyword'>bool 
</span><a name="LN1198"></a><span class='Declare_Function'>EventTriggerSupportsGrantObjectType</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1198"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no support for global objects */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1813"><span class='Ref_to_EnumConst'>ACL_OBJECT_COLUMN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * There's intentionally no default: case here; we want the 
             * compiler to warn if a new ACL class hasn't been handled above. 
             */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Shouldn't get here, but if we do, say "no support" */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerSupportsGrantObjectType &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Prepare event trigger state for a new complete query to run, if necessary; 
 * returns whether this was done.  If it was, EventTriggerEndCompleteQuery must 
 * be called when the query is done, regardless of whether it succeeds or fails 
 * -- so use of a PG_TRY block is mandatory. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1237"></a><span class='Declare_Function'>EventTriggerBeginCompleteQuery</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1239"></a>    <a href="event_trigger.c.html#LN49"><span class='Ref_to_Struct'>EventTriggerQueryState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN1240"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>cxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Currently, sql_drop, table_rewrite, ddl_command_end events are the only 
     * reason to have event trigger state at all; so if there are none, don't 
     * install one. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/commands/event_trigger.h.html#LN60"><span class='Ref_to_Proto'>trackDroppedObjectsNeeded</span></a><span class='Parentheses'>())</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1240"><span class='Ref_To_Local'>cxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../utils/mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"event trigger state"</span><span class='Delimiter'>, 
</span>                                <a href="../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1240"><span class='Ref_To_Local'>cxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN49"><span class='Ref_to_Struct'>EventTriggerQueryState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1240"><span class='Ref_To_Local'>cxt</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/lib/ilist.h.html#LN552"><span class='Ref_to_Func'>slist_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN55"><span class='Ref_to_Member'>SQLDropList</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN56"><span class='Ref_to_Member'>in_sql_drop</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN59"><span class='Ref_to_Member'>table_rewrite_oid</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>? 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a> <span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN68"><span class='Ref_to_Member'>previous</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1239"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerBeginCompleteQuery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Query completed (or errored out) -- clean up local state, return to previous 
 * one. 
 * 
 * Note: it's an error to call this routine if EventTriggerBeginCompleteQuery 
 * returned false previously. 
 * 
 * Note: this might be called in the PG_CATCH block of a failing transaction, 
 * so be wary of running anything unnecessary.  (In particular, it's probably 
 * unwise to try to allocate memory.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1281"></a><span class='Declare_Function'>EventTriggerEndCompleteQuery</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1283"></a>    <a href="event_trigger.c.html#LN49"><span class='Ref_to_Struct'>EventTriggerQueryState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>prevstate</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1283"><span class='Ref_To_Local'>prevstate</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN68"><span class='Ref_to_Member'>previous</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* this avoids the need for retail pfree of SQLDropList items: */ 
</span>    <a href="../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1283"><span class='Ref_To_Local'>prevstate</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Do we need to keep close track of objects being dropped? 
 * 
 * This is useful because there is a cost to running with them enabled. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1299"></a><span class='Declare_Function'>trackDroppedObjectsNeeded</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * true if any sql_drop, table_rewrite, ddl_command_end event trigger 
     * exists 
     */ 
</span>    <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="../../include/utils/evtcache.h.html#LN34"><span class='Ref_to_Proto'>EventCacheLookup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/evtcache.h.html#LN22"><span class='Ref_to_EnumConst'>EVT_SQLDrop</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="../../include/utils/evtcache.h.html#LN34"><span class='Ref_to_Proto'>EventCacheLookup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/evtcache.h.html#LN23"><span class='Ref_to_EnumConst'>EVT_TableRewrite</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="../../include/utils/evtcache.h.html#LN34"><span class='Ref_to_Proto'>EventCacheLookup</span></a><span class='Parentheses'>(</span><a href="../../include/utils/evtcache.h.html#LN21"><span class='Ref_to_EnumConst'>EVT_DDLCommandEnd</span></a><span class='Parentheses'>))</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Support for dropped objects information on event trigger functions. 
 * 
 * We keep the list of objects dropped by the current command in current 
 * state's SQLDropList (comprising SQLDropObject items).  Each time a new 
 * command is to start, a clean EventTriggerQueryState is created; commands 
 * that drop objects do the dependency.c dance to drop objects, which 
 * populates the current state's SQLDropList; when the event triggers are 
 * invoked they can consume the list via pg_event_trigger_dropped_objects(). 
 * When the command finishes, the EventTriggerQueryState is cleared, and 
 * the one from the previous command is restored (when no command is in 
 * execution, the current state is NULL). 
 * 
 * All this lets us support the case that an event trigger function drops 
 * objects "reentrantly". 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Register one object as being dropped by the current command. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1331"></a><span class='Declare_Function'>EventTriggerSQLDropAddObject</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>original</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>normal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1333"></a>    <a href="event_trigger.c.html#LN131"><span class='Ref_to_Struct'>SQLDropObject</span></a> <span class='Operator'>*</span><span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span><a name="LN1334"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/commands/event_trigger.h.html#LN51"><span class='Ref_to_Proto'>EventTriggerSupportsObjectClass</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN198"><span class='Ref_to_Proto'>getObjectClass</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't report temp schemas except my own */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN126"><span class='Ref_to_Proto'>isAnyTempNamespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>         <span class='Operator'>!</span><a href="../../include/catalog/namespace.h.html#LN123"><span class='Ref_to_Proto'>isTempNamespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1334"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN131"><span class='Ref_to_Struct'>SQLDropObject</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a> <span class='Operator'>= *</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN140"><span class='Ref_to_Member'>original</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>original</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN141"><span class='Ref_to_Member'>normal</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>normal</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Obtain schema names from the object's catalog tuple, if one exists; 
     * this lets us skip objects in temp schemas.  We trust that 
     * ObjectProperty contains all object classes that can be 
     * schema-qualified. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN56"><span class='Ref_to_Proto'>is_objectclass_supported</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1362"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalog</span><span class='Delimiter'>; 
</span><a name="LN1363"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="event_trigger.c.html#LN1362"><span class='Ref_To_Local'>catalog</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="event_trigger.c.html#LN1363"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN67"><span class='Ref_to_Proto'>get_catalog_object_by_oid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1362"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1363"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1370"></a>            <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>attnum</span><span class='Delimiter'>; 
</span><a name="LN1371"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN1372"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
            <a href="event_trigger.c.html#LN1370"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN61"><span class='Ref_to_Proto'>get_object_attnum_namespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1370"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>!= </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="event_trigger.c.html#LN1371"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1363"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1370"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, 
</span>                                     <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1362"><span class='Ref_To_Local'>catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1372"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN1372"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1381"></a>                    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>namespaceId</span><span class='Delimiter'>; 
</span> 
                    <a href="event_trigger.c.html#LN1381"><span class='Ref_To_Local'>namespaceId</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1371"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* temp objects are only reported if they are my own */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN123"><span class='Ref_to_Proto'>isTempNamespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1381"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN134"><span class='Ref_to_Member'>schemaname</span></a> <span class='Operator'>= </span><span class='String'>"pg_temp"</span><span class='Delimiter'>; 
</span>                        <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN142"><span class='Ref_to_Member'>istemp</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN126"><span class='Ref_to_Proto'>isAnyTempNamespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1381"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1362"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1334"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN134"><span class='Ref_to_Member'>schemaname</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1381"><span class='Ref_To_Local'>namespaceId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN142"><span class='Ref_to_Member'>istemp</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isnull &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if attnum!=InvalidAttrNu... &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN65"><span class='Ref_to_Proto'>get_object_namensp_unique</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="event_trigger.c.html#LN1370"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN60"><span class='Ref_to_Proto'>get_object_attnum_name</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1370"><span class='Ref_To_Local'>attnum</span></a> <span class='Operator'>!= </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="event_trigger.c.html#LN1371"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1363"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1370"><span class='Ref_To_Local'>attnum</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1362"><span class='Ref_To_Local'>catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1372"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN1372"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                        <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN135"><span class='Ref_to_Member'>objname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="../../include/postgres.h.html#LN590"><span class='Ref_to_Macro'>DatumGetName</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1371"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tuple &raquo; </span> 
 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1362"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_objectclass_suppor... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="../../include/catalog/namespace.h.html#LN123"><span class='Ref_to_Proto'>isTempNamespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1331"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span> 
            <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN142"><span class='Ref_to_Member'>istemp</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* object identity, objname and objargs */ 
</span>    <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN136"><span class='Ref_to_Member'>objidentity</span></a> <span class='Operator'>= 
</span>        <a href="../../include/catalog/objectaddress.h.html#LN76"><span class='Ref_to_Proto'>getObjectIdentityParts</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN138"><span class='Ref_to_Member'>addrnames</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN139"><span class='Ref_to_Member'>addrargs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* object type */ 
</span>    <a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN137"><span class='Ref_to_Member'>objecttype</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN74"><span class='Ref_to_Proto'>getObjectTypeDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/lib/ilist.h.html#LN572"><span class='Ref_to_Func'>slist_push_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN55"><span class='Ref_to_Member'>SQLDropList</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1333"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN143"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1334"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerSQLDropAddObject &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_event_trigger_dropped_objects 
 * 
 * Make the list of dropped objects available to the user function run by the 
 * Event Trigger. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1447"></a><span class='Declare_Function'>pg_event_trigger_dropped_objects</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1449"></a>    <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span><a name="LN1450"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1451"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupstore</span><span class='Delimiter'>; 
</span><a name="LN1452"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_query_ctx</span><span class='Delimiter'>; 
</span><a name="LN1453"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1454"></a>    <a href="../../include/lib/ilist.h.html#LN223"><span class='Ref_to_Struct'>slist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Protect this function from being called out of context 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN56"><span class='Ref_to_Member'>in_sql_drop</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_EVENT_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s can only be called in a sql_drop event trigger function"</span><span class='Delimiter'>, 
</span>                <span class='String'>"pg_event_trigger_dropped_objects()"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN1450"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuplestore to hold the result rows */ 
</span>    <a href="event_trigger.c.html#LN1452"><span class='Ref_To_Local'>per_query_ctx</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1453"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1452"><span class='Ref_To_Local'>per_query_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1451"><span class='Ref_To_Local'>tupstore</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1451"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1449"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1450"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1453"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/lib/ilist.h.html#LN699"><span class='Ref_to_Macro'>slist_foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1454"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN55"><span class='Ref_to_Member'>SQLDropList</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1493"></a>        <a href="event_trigger.c.html#LN131"><span class='Ref_to_Struct'>SQLDropObject</span></a> <span class='Operator'>*</span><span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span><a name="LN1494"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1495"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>]; 
</span><a name="LN1496"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>12</span><span class='Delimiter'>]; 
</span> 
        <a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a> <span class='Operator'>= </span><a href="../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN131"><span class='Ref_to_Struct'>SQLDropObject</span></a><span class='Delimiter'>, </span><a href="../regex/regcomp.c.html#LN84"><span class='Ref_to_Proto'>next</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1454"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../include/lib/ilist.h.html#LN225"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* classid */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* objid */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* objsubid */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN133"><span class='Ref_to_Member'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* original */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN140"><span class='Ref_to_Member'>original</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* normal */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN141"><span class='Ref_to_Member'>normal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* is_temporary */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN142"><span class='Ref_to_Member'>istemp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* object_type */ 
</span>        <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN137"><span class='Ref_to_Member'>objecttype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* schema_name */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN134"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>) 
</span>            <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN134"><span class='Ref_to_Member'>schemaname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* object_name */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN135"><span class='Ref_to_Member'>objname</span></a><span class='Parentheses'>) 
</span>            <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN135"><span class='Ref_to_Member'>objname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* object_identity */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN136"><span class='Ref_to_Member'>objidentity</span></a><span class='Parentheses'>) 
</span>            <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN136"><span class='Ref_to_Member'>objidentity</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* address_names and address_args */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN138"><span class='Ref_to_Member'>addrnames</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN78"><span class='Ref_to_Proto'>strlist_to_textarray</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN138"><span class='Ref_to_Member'>addrnames</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN139"><span class='Ref_to_Member'>addrargs</span></a><span class='Parentheses'>) 
</span>                <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN78"><span class='Ref_to_Proto'>strlist_to_textarray</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1493"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN139"><span class='Ref_to_Member'>addrargs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN1494"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1451"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1450"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1495"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1496"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* clean up and return the tuplestore */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN59"><span class='Ref_to_Macro'>tuplestore_donestoring</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1451"><span class='Ref_To_Local'>tupstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_event_trigger_dropped_objects &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_event_trigger_table_rewrite_oid 
 * 
 * Make the Oid of the table going to be rewritten available to the user 
 * function run by the Event Trigger. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1574"></a><span class='Declare_Function'>pg_event_trigger_table_rewrite_oid</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Protect this function from being called out of context 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN59"><span class='Ref_to_Member'>table_rewrite_oid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_EVENT_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s can only be called in a table_rewrite event trigger function"</span><span class='Delimiter'>, 
</span>                        <span class='String'>"pg_event_trigger_table_rewrite_oid()"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN319"><span class='Ref_to_Macro'>PG_RETURN_OID</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN59"><span class='Ref_to_Member'>table_rewrite_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_event_trigger_table_rewrite_reason 
 * 
 * Make the rewrite reason available to the user. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1595"></a><span class='Declare_Function'>pg_event_trigger_table_rewrite_reason</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Protect this function from being called out of context 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN61"><span class='Ref_to_Member'>table_rewrite_reason</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_EVENT_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s can only be called in a table_rewrite event trigger function"</span><span class='Delimiter'>, 
</span>                        <span class='String'>"pg_event_trigger_table_rewrite_reason()"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN61"><span class='Ref_to_Member'>table_rewrite_reason</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * Support for DDL command deparsing 
 * 
 * The routines below enable an event trigger function to obtain a list of 
 * DDL commands as they are executed.  There are three main pieces to this 
 * feature: 
 * 
 * 1) Within ProcessUtilitySlow, or some sub-routine thereof, each DDL command 
 * adds a struct CollectedCommand representation of itself to the command list, 
 * using the routines below. 
 * 
 * 2) Some time after that, ddl_command_end fires and the command list is made 
 * available to the event trigger function via pg_event_trigger_ddl_commands(); 
 * the complete command details are exposed as a column of type pg_ddl_command. 
 * 
 * 3) An extension can install a function capable of taking a value of type 
 * pg_ddl_command and transform it into some external, user-visible and/or 
 * -modifiable representation. 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Inhibit DDL command collection. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1635"></a><span class='Declare_Function'>EventTriggerInhibitCommandCollection</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Re-establish DDL command collection. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1647"></a><span class='Declare_Function'>EventTriggerUndoInhibitCommandCollection</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectSimpleCommand 
 *      Save data about a simple DDL command that was just executed 
 * 
 * address identifies the object being operated on.  secondaryObject is an 
 * object address that was related in some way to the executed command; its 
 * meaning is command-specific. 
 * 
 * For instance, for an ALTER obj SET SCHEMA command, objtype is the type of 
 * object being moved, objectId is its OID, and secondaryOid is the OID of the 
 * old schema.  (The destination schema OID can be obtained by catalog lookup 
 * of the object.) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1669"></a><span class='Declare_Function'>EventTriggerCollectSimpleCommand</span><span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Parameter'>address</span><span class='Delimiter'>, 
</span><a name="LN1670"></a>                                 <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Parameter'>secondaryObject</span><span class='Delimiter'>, 
</span><a name="LN1671"></a>                                 <a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1673"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1674"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1673"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN25"><span class='Ref_to_EnumConst'>SCT_Simple</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>simple<span class='Operator'>.</span>address <span class='Operator'>= </span><a href="event_trigger.c.html#LN1669"><span class='Ref_to_Parameter'>address</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>simple<span class='Operator'>.</span>secondaryObject <span class='Operator'>= </span><a href="event_trigger.c.html#LN1670"><span class='Ref_to_Parameter'>secondaryObject</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1671"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, 
</span>                                                    <a href="event_trigger.c.html#LN1674"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1673"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectSimpleCommand &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerAlterTableStart 
 *      Prepare to receive data on an ALTER TABLE command about to be executed 
 * 
 * Note we don't collect the command immediately; instead we keep it in 
 * currentCommand, and only when we're done processing the subcommands we will 
 * add it to the command list. 
 * 
 * XXX -- this API isn't considering the possibility of an ALTER TABLE command 
 * being called reentrantly by an event trigger function.  Do we need stackable 
 * commands at this level?  Perhaps at least we should detect the condition and 
 * raise an error. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1712"></a><span class='Declare_Function'>EventTriggerAlterTableStart</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parsetree</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1714"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1715"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1714"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN26"><span class='Ref_to_EnumConst'>SCT_AlterTable</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>classId <span class='Operator'>= </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>objectId <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>subcmds <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1712"><span class='Ref_to_Parameter'>parsetree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1715"><span class='Ref_To_Local'>command</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1714"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerAlterTableStart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remember the OID of the object being affected by an ALTER TABLE. 
 * 
 * This is needed because in some cases we don't know the OID until later. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1745"></a><span class='Declare_Function'>EventTriggerAlterTableRelid</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>objectId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>objectId <span class='Operator'>= </span><a href="event_trigger.c.html#LN1745"><span class='Ref_to_Parameter'>objectId</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectAlterTableSubcmd 
 *      Save data about a single part of an ALTER TABLE. 
 * 
 * Several different commands go through this path, but apart from ALTER TABLE 
 * itself, they are all concerned with AlterTableCmd nodes that are generated 
 * internally, so that's all that this code needs to handle at the moment. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1763"></a><span class='Declare_Function'>EventTriggerCollectAlterTableSubcmd</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subcmd</span><span class='Delimiter'>, </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Parameter'>address</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1765"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1766"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN37"><span class='Ref_to_Struct'>CollectedATSubcmd</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newsub</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1763"><span class='Ref_to_Parameter'>subcmd</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN1749"><span class='Ref_to_Struct'>AlterTableCmd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>objectId<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1765"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1766"><span class='Ref_To_Local'>newsub</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN37"><span class='Ref_to_Struct'>CollectedATSubcmd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1766"><span class='Ref_To_Local'>newsub</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN39"><span class='Ref_to_Member'>address</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN1763"><span class='Ref_to_Parameter'>address</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1766"><span class='Ref_To_Local'>newsub</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN40"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1763"><span class='Ref_to_Parameter'>subcmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>subcmds <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>subcmds<span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1766"><span class='Ref_To_Local'>newsub</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1765"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectAlterTableSubcmd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerAlterTableEnd 
 *      Finish up saving an ALTER TABLE command, and add it to command list. 
 * 
 * FIXME this API isn't considering the possibility that an xact/subxact is 
 * aborted partway through.  Probably it's best to add an 
 * AtEOSubXact_EventTriggers() to fix this. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1797"></a><span class='Declare_Function'>EventTriggerAlterTableEnd</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If no subcommands, don't collect */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>subcmds<span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= 
</span>            <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, 
</span>                    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN65"><span class='Ref_to_Member'>currentCommand</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerAlterTableEnd &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectGrant 
 *      Save data about a GRANT/REVOKE command being executed 
 * 
 * This function creates a copy of the InternalGrant, as the original might 
 * not have the right lifetime. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1825"></a><span class='Declare_Function'>EventTriggerCollectGrant</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>istmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1827"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1828"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span><a name="LN1829"></a>    <a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a> <span class='Operator'>*</span><span class='Declare_Local'>icopy</span><span class='Delimiter'>; 
</span><a name="LN1830"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1827"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is tedious, but necessary. 
     */ 
</span>    <a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1825"><span class='Ref_to_Parameter'>istmt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/utils/aclchk_internal.h.html#LN30"><span class='Ref_to_Typedef'>InternalGrant</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1825"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN34"><span class='Ref_to_Member'>objects</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1825"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN38"><span class='Ref_to_Member'>grantees</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1830"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1825"><span class='Ref_to_Parameter'>istmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a><span class='Parentheses'>) 
</span>        <a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/aclchk_internal.h.html#LN37"><span class='Ref_to_Member'>col_privs</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1830"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now collect it, using the copied InternalGrant */ 
</span>    <a href="event_trigger.c.html#LN1828"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1828"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN27"><span class='Ref_to_EnumConst'>SCT_Grant</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1828"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1828"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>grant<span class='Operator'>.</span>istmt <span class='Operator'>= </span><a href="event_trigger.c.html#LN1829"><span class='Ref_To_Local'>icopy</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1828"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1828"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1827"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectGrant &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectAlterOpFam 
 *      Save data about an ALTER OPERATOR FAMILY ADD/DROP command being 
 *      executed 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1869"></a><span class='Declare_Function'>EventTriggerCollectAlterOpFam</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2532"><span class='Ref_to_Struct'>AlterOpFamilyStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opfamoid</span><span class='Delimiter'>, 
</span><a name="LN1870"></a>                              <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operators</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procedures</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1872"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1873"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1872"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN28"><span class='Ref_to_EnumConst'>SCT_AlterOpFamily</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>opfam<span class='Operator'>.</span>address<span class='Delimiter'>, 
</span>                     <a href="../../include/catalog/pg_opfamily.h.html#LN28"><span class='Ref_to_Const'>OperatorFamilyRelationId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1869"><span class='Ref_to_Parameter'>opfamoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>opfam<span class='Operator'>.</span>operators <span class='Operator'>= </span><a href="event_trigger.c.html#LN1870"><span class='Ref_to_Parameter'>operators</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>opfam<span class='Operator'>.</span>procedures <span class='Operator'>= </span><a href="event_trigger.c.html#LN1870"><span class='Ref_to_Parameter'>procedures</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1869"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1873"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1872"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectAlterOpFam &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectCreateOpClass 
 *      Save data about a CREATE OPERATOR CLASS command being executed 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1902"></a><span class='Declare_Function'>EventTriggerCollectCreateOpClass</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2489"><span class='Ref_to_Struct'>CreateOpClassStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>opcoid</span><span class='Delimiter'>, 
</span><a name="LN1903"></a>                                 <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>operators</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>procedures</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1905"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1906"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1905"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN30"><span class='Ref_to_EnumConst'>SCT_CreateOpClass</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>createopc<span class='Operator'>.</span>address<span class='Delimiter'>, 
</span>                     <a href="../../include/catalog/pg_opclass.h.html#LN48"><span class='Ref_to_Const'>OperatorClassRelationId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1902"><span class='Ref_to_Parameter'>opcoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>createopc<span class='Operator'>.</span>operators <span class='Operator'>= </span><a href="event_trigger.c.html#LN1903"><span class='Ref_to_Parameter'>operators</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>createopc<span class='Operator'>.</span>procedures <span class='Operator'>= </span><a href="event_trigger.c.html#LN1903"><span class='Ref_to_Parameter'>procedures</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1902"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1906"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1905"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectCreateOpClass &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectAlterTSConfig 
 *      Save data about an ALTER TEXT SEARCH CONFIGURATION command being 
 *      executed 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1936"></a><span class='Declare_Function'>EventTriggerCollectAlterTSConfig</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN3329"><span class='Ref_to_Struct'>AlterTSConfigurationStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>cfgId</span><span class='Delimiter'>, 
</span><a name="LN1937"></a>                                 <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dictIds</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndicts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1939"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1940"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1939"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN31"><span class='Ref_to_EnumConst'>SCT_AlterTSConfig</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>atscfg<span class='Operator'>.</span>address<span class='Delimiter'>, 
</span>                     <a href="../../include/catalog/pg_ts_config.h.html#LN30"><span class='Ref_to_Const'>TSConfigRelationId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1936"><span class='Ref_to_Parameter'>cfgId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>atscfg<span class='Operator'>.</span>dictIds <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="event_trigger.c.html#LN1937"><span class='Ref_to_Parameter'>ndicts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>atscfg<span class='Operator'>.</span>dictIds<span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1937"><span class='Ref_to_Parameter'>dictIds</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="event_trigger.c.html#LN1937"><span class='Ref_to_Parameter'>ndicts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>atscfg<span class='Operator'>.</span>ndicts <span class='Operator'>= </span><a href="event_trigger.c.html#LN1937"><span class='Ref_to_Parameter'>ndicts</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1936"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1940"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1939"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectAlterTSConfig &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * EventTriggerCollectAlterDefPrivs 
 *      Save data about an ALTER DEFAULT PRIVILEGES command being 
 *      executed 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1971"></a><span class='Declare_Function'>EventTriggerCollectAlterDefPrivs</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1896"><span class='Ref_to_Struct'>AlterDefaultPrivilegesStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1973"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1974"></a>    <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>command</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ignore if event trigger context not set, or collection disabled */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a> <span class='Operator'>|| 
</span>        <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN64"><span class='Ref_to_Member'>commandCollectionInhibited</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1973"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN52"><span class='Ref_to_Member'>cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN1974"><span class='Ref_To_Local'>command</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1974"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../include/tcop/deparse_utility.h.html#LN29"><span class='Ref_to_EnumConst'>SCT_AlterDefaultPrivileges</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1974"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>defprivs<span class='Operator'>.</span>objtype <span class='Operator'>= </span><a href="event_trigger.c.html#LN1971"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1900"><span class='Ref_to_Member'>action</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1833"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1974"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN1974"><span class='Ref_To_Local'>command</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/nodes.h.html#LN618"><span class='Ref_to_Macro'>copyObject</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1971"><span class='Ref_to_Parameter'>stmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a> <span class='Operator'>= 
</span>        <a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN1974"><span class='Ref_To_Local'>command</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN1973"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EventTriggerCollectAlterDefPrivs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * In a ddl_command_end event trigger, this function reports the DDL commands 
 * being run. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1999"></a><span class='Declare_Function'>pg_event_trigger_ddl_commands</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2001"></a>    <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span><a name="LN2002"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2003"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupstore</span><span class='Delimiter'>; 
</span><a name="LN2004"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_query_ctx</span><span class='Delimiter'>; 
</span><a name="LN2005"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2006"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Protect this function from being called out of context 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_E_R_I_E_EVENT_TRIGGER_PROTOCOL_VIOLATED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s can only be called in an event trigger function"</span><span class='Delimiter'>, 
</span>                        <span class='String'>"pg_event_trigger_ddl_commands()"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN2002"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuplestore to hold the result rows */ 
</span>    <a href="event_trigger.c.html#LN2004"><span class='Ref_To_Local'>per_query_ctx</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN2005"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2004"><span class='Ref_To_Local'>per_query_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="event_trigger.c.html#LN2003"><span class='Ref_To_Local'>tupstore</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2003"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>; 
</span>    <a href="event_trigger.c.html#LN2001"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2002"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2005"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2006"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN71"><span class='Ref_to_Global_Var'>currentEventTriggerState</span></a><span class='Operator'>-&GT;</span><a href="event_trigger.c.html#LN66"><span class='Ref_to_Member'>commandList</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2044"></a>        <a href="../../include/tcop/deparse_utility.h.html#LN43"><span class='Ref_to_Struct'>CollectedCommand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cmd</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2006"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2045"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>9</span><span class='Delimiter'>]; 
</span><a name="LN2046"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>9</span><span class='Delimiter'>]; 
</span><a name="LN2047"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>addr</span><span class='Delimiter'>; 
</span><a name="LN2048"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * For IF NOT EXISTS commands that attempt to create an existing 
         * object, the returned OID is Invalid.  Don't return anything. 
         * 
         * One might think that a viable alternative would be to look up the 
         * Oid of the existing object and run the deparse with that.  But 
         * since the parse tree might be different from the one that created 
         * the object in the first place, we might not end up in a consistent 
         * state anyway. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../include/tcop/deparse_utility.h.html#LN25"><span class='Ref_to_EnumConst'>SCT_Simple</span></a> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>simple<span class='Operator'>.</span>address<span class='Operator'>.</span>objectId<span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN25"><span class='Ref_to_EnumConst'>SCT_Simple</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN26"><span class='Ref_to_EnumConst'>SCT_AlterTable</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN28"><span class='Ref_to_EnumConst'>SCT_AlterOpFamily</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN30"><span class='Ref_to_EnumConst'>SCT_CreateOpClass</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN31"><span class='Ref_to_EnumConst'>SCT_AlterTSConfig</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2074"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>identity</span><span class='Delimiter'>; 
</span><a name="LN2075"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN2076"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schema</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../include/tcop/deparse_utility.h.html#LN25"><span class='Ref_to_EnumConst'>SCT_Simple</span></a><span class='Parentheses'>) 
</span>                        <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>simple<span class='Operator'>.</span>address<span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../include/tcop/deparse_utility.h.html#LN26"><span class='Ref_to_EnumConst'>SCT_AlterTable</span></a><span class='Parentheses'>) 
</span>                        <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Delimiter'>, 
</span>                                         <a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>classId<span class='Delimiter'>, 
</span>                                         <a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>alterTable<span class='Operator'>.</span>objectId<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../include/tcop/deparse_utility.h.html#LN28"><span class='Ref_to_EnumConst'>SCT_AlterOpFamily</span></a><span class='Parentheses'>) 
</span>                        <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>opfam<span class='Operator'>.</span>address<span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../include/tcop/deparse_utility.h.html#LN30"><span class='Ref_to_EnumConst'>SCT_CreateOpClass</span></a><span class='Parentheses'>) 
</span>                        <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>createopc<span class='Operator'>.</span>address<span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN45"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../include/tcop/deparse_utility.h.html#LN31"><span class='Ref_to_EnumConst'>SCT_AlterTSConfig</span></a><span class='Parentheses'>) 
</span>                        <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a> <span class='Operator'>= </span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>atscfg<span class='Operator'>.</span>address<span class='Delimiter'>; 
</span> 
                    <a href="event_trigger.c.html#LN2075"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN74"><span class='Ref_to_Proto'>getObjectTypeDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="event_trigger.c.html#LN2074"><span class='Ref_To_Local'>identity</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN75"><span class='Ref_to_Proto'>getObjectIdentity</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Obtain schema name, if any ("pg_temp" if a temp 
                     * object). If the object class is not in the supported 
                     * list here, we assume it's a schema-less object type, 
                     * and thus "schema" remains set to NULL. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/objectaddress.h.html#LN56"><span class='Ref_to_Proto'>is_objectclass_supported</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span><a name="LN2102"></a>                        <a href="../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a>  <span class='Declare_Local'>nspAttnum</span><span class='Delimiter'>; 
</span> 
                        <a href="event_trigger.c.html#LN2102"><span class='Ref_To_Local'>nspAttnum</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN61"><span class='Ref_to_Proto'>get_object_attnum_namespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2102"><span class='Ref_To_Local'>nspAttnum</span></a> <span class='Operator'>!= </span><a href="../../include/access/attnum.h.html#LN22"><span class='Ref_to_Const'>InvalidAttrNumber</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span><a name="LN2107"></a>                            <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>catalog</span><span class='Delimiter'>; 
</span><a name="LN2108"></a>                            <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>objtup</span><span class='Delimiter'>; 
</span><a name="LN2109"></a>                            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schema_oid</span><span class='Delimiter'>; 
</span><a name="LN2110"></a>                            <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
                            <a href="event_trigger.c.html#LN2107"><span class='Ref_To_Local'>catalog</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="event_trigger.c.html#LN2108"><span class='Ref_To_Local'>objtup</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN67"><span class='Ref_to_Proto'>get_catalog_object_by_oid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2107"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, 
</span>                                                               <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2108"><span class='Ref_To_Local'>objtup</span></a><span class='Parentheses'>))</span> 
                                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for object %u/%u"</span><span class='Delimiter'>, 
</span>                                     <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="event_trigger.c.html#LN2109"><span class='Ref_To_Local'>schema_oid</span></a> <span class='Operator'>= 
</span>                                <a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2108"><span class='Ref_To_Local'>objtup</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2102"><span class='Ref_To_Local'>nspAttnum</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2107"><span class='Ref_To_Local'>catalog</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="event_trigger.c.html#LN2110"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2110"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                                <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"invalid null namespace in object %u/%u/%d"</span><span class='Delimiter'>, 
</span>                                     <a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Comment_Multi_Line'>/* XXX not quite get_namespace_name_or_temp */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/namespace.h.html#LN126"><span class='Ref_to_Proto'>isAnyTempNamespace</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2109"><span class='Ref_To_Local'>schema_oid</span></a><span class='Parentheses'>))</span> 
                                <a href="event_trigger.c.html#LN2076"><span class='Ref_To_Local'>schema</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"pg_temp"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>else</span> 
                                <a href="event_trigger.c.html#LN2076"><span class='Ref_To_Local'>schema</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2109"><span class='Ref_To_Local'>schema_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                            <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2107"><span class='Ref_To_Local'>catalog</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nspAttnum!=InvalidAtt... &raquo; </span> 
                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if is_objectclass_suppor... &raquo; </span> 
 
                    <span class='Comment_Multi_Line'>/* classid */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* objid */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* objsubid */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2047"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* command tag */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* object_type */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2075"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* schema */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2076"><span class='Ref_To_Local'>schema</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2076"><span class='Ref_To_Local'>schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* identity */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2074"><span class='Ref_To_Local'>identity</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* in_extension */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* command */ 
</span>                    <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN29"><span class='Ref_to_EnumConst'>SCT_AlterDefaultPrivileges</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* classid */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* objid */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* objsubid */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* command tag */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/utility.h.html#LN48"><span class='Ref_to_Proto'>CreateCommandTag</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN47"><span class='Ref_to_Member'>parsetree</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* object_type */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN160"><span class='Ref_to_Proto'>stringify_adefprivs_objtype</span></a><span class='Parentheses'>( 
</span>                                                   <a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>defprivs<span class='Operator'>.</span>objtype<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* schema */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* identity */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* in_extension */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* command */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../include/tcop/deparse_utility.h.html#LN27"><span class='Ref_to_EnumConst'>SCT_Grant</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* classid */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* objid */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* objsubid */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* command tag */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>grant<span class='Operator'>.</span>istmt<span class='Operator'>-&GT;</span>is_grant <span class='Operator'>? 
</span>                                                  <span class='String'>"GRANT"</span> <span class='Operator'>: </span><span class='String'>"REVOKE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* object_type */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN159"><span class='Ref_to_Proto'>stringify_grantobjtype</span></a><span class='Parentheses'>( 
</span>                                               <a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN101"><span class='Ref_to_Member'>d</span></a><span class='Operator'>.</span>grant<span class='Operator'>.</span>istmt<span class='Operator'>-&GT;</span>objtype<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* schema */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* identity */ 
</span>                <a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* in_extension */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Operator'>-&GT;</span><a href="../../include/tcop/deparse_utility.h.html#LN46"><span class='Ref_to_Member'>in_extension</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* command */ 
</span>                <a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="event_trigger.c.html#LN2048"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2044"><span class='Ref_To_Local'>cmd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmd-&GT;type &raquo; </span> 
 
        <a href="../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2003"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2002"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2045"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="event_trigger.c.html#LN2046"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* clean up and return the tuplestore */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN59"><span class='Ref_to_Macro'>tuplestore_donestoring</span></a><span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2003"><span class='Ref_To_Local'>tupstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_event_trigger_ddl_commands &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return the GrantObjectType as a string, as it would appear in GRANT and 
 * REVOKE commands. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN2219"></a><span class='Declare_Function'>stringify_grantobjtype</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2219"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1813"><span class='Ref_to_EnumConst'>ACL_OBJECT_COLUMN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"COLUMN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TABLE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SEQUENCE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"DATABASE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"DOMAIN"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"FOREIGN DATA WRAPPER"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"FOREIGN SERVER"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"FUNCTION"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"LANGUAGE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"LARGE OBJECT"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SCHEMA"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TABLESPACE"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TYPE"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized grant object type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="event_trigger.c.html#LN2219"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='String'>"???"</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end stringify_grantobjtype &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return the GrantObjectType as a string; as above, but use the spelling 
 * in ALTER DEFAULT PRIVILEGES commands instead.  Generally this is just 
 * the plural. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN2261"></a><span class='Declare_Function'>stringify_adefprivs_objtype</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1811"><span class='Ref_to_Enum'>GrantObjectType</span></a> <span class='Declare_Parameter'>objtype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="event_trigger.c.html#LN2261"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1813"><span class='Ref_to_EnumConst'>ACL_OBJECT_COLUMN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"COLUMNS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1814"><span class='Ref_to_EnumConst'>ACL_OBJECT_RELATION</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TABLES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1815"><span class='Ref_to_EnumConst'>ACL_OBJECT_SEQUENCE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SEQUENCES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1816"><span class='Ref_to_EnumConst'>ACL_OBJECT_DATABASE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"DATABASES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1817"><span class='Ref_to_EnumConst'>ACL_OBJECT_DOMAIN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"DOMAINS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1818"><span class='Ref_to_EnumConst'>ACL_OBJECT_FDW</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"FOREIGN DATA WRAPPERS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1819"><span class='Ref_to_EnumConst'>ACL_OBJECT_FOREIGN_SERVER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"FOREIGN SERVERS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1820"><span class='Ref_to_EnumConst'>ACL_OBJECT_FUNCTION</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"FUNCTIONS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1821"><span class='Ref_to_EnumConst'>ACL_OBJECT_LANGUAGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"LANGUAGES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1822"><span class='Ref_to_EnumConst'>ACL_OBJECT_LARGEOBJECT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"LARGE OBJECTS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1823"><span class='Ref_to_EnumConst'>ACL_OBJECT_NAMESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"SCHEMAS"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1824"><span class='Ref_to_EnumConst'>ACL_OBJECT_TABLESPACE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TABLESPACES"</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../include/nodes/parsenodes.h.html#LN1825"><span class='Ref_to_EnumConst'>ACL_OBJECT_TYPE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='String'>"TYPES"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch objtype &raquo; </span> 
 
    <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized grant object type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="event_trigger.c.html#LN2261"><span class='Ref_to_Parameter'>objtype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='String'>"???"</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end stringify_adefprivs_objtype &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>