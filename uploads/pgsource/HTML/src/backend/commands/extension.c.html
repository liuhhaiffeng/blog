<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\commands\extension.c</title>
<LINK REL=StyleSheet HREF="../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\commands\extension.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:34 2017
</td></tr>
<tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * extension.c 
 *    Commands to manipulate extensions 
 * 
 * Extensions in PostgreSQL allow management of collections of SQL objects. 
 * 
 * All we need internally to manage an extension is an OID so that the 
 * dependent objects can be associated with it.  An extension is created by 
 * populating the pg_extension catalog from a "control" file. 
 * The extension control file is parsed with the same parser we use for 
 * postgresql.conf and recovery.conf.  An extension also has an installation 
 * script file, containing SQL commands to create the extension's objects. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/commands/extension.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;dirent.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/file.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;unistd.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/dependency.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/indexing.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/objectaccess.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_depend.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/alter.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/comment.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/defrem.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/extension.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/schemacmds.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/fd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tcop/utility.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/snapmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Globally visible state variables */ 
</span><a name="LN66"></a><span class='Keyword'>bool</span>        <span class='Declare_Var'>creating_extension</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN67"></a><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Var'>CurrentExtensionObject</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Internal data structure to hold the results of parsing a control file 
 */ 
</span><a name="LN72"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ExtensionControlFile</span> 
<span class='Delimiter'>{ 
</span><a name="LN74"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* name of the extension */ 
</span><a name="LN75"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>directory</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* directory for script files */ 
</span><a name="LN76"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>default_version</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* default install target version, if any */ 
</span><a name="LN77"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>module_pathname</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* string to substitute for MODULE_PATHNAME */ 
</span><a name="LN78"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>comment</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* comment, if any */ 
</span><a name="LN79"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>schema</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* target schema (allowed if !relocatable) */ 
</span><a name="LN80"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>relocatable</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* is ALTER EXTENSION SET SCHEMA supported? */ 
</span><a name="LN81"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>superuser</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* must be superuser to install? */ 
</span><a name="LN82"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>encoding</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* encoding of the script file, or -1 */ 
</span><a name="LN83"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>requires</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* names of prerequisite extensions */ 
</span><a name="LN84"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ExtensionControlFile</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Internal data structure for update path information 
 */ 
</span><a name="LN89"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ExtensionVersionInfo</span> 
<span class='Delimiter'>{ 
</span><a name="LN91"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>name</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* name of the starting version */ 
</span><a name="LN92"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>reachable</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* List of ExtensionVersionInfo's */ 
</span><a name="LN93"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>installable</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* does this version have an install script? */ 
</span>    <span class='Comment_Multi_Line'>/* working state for Dijkstra's algorithm: */ 
</span><a name="LN95"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>distance_known</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* is distance from start known yet? */ 
</span><a name="LN96"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>distance</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* current worst-case distance estimate */ 
</span><a name="LN97"></a>    <span class='Control'>struct</span> <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Member'>previous</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* current best predecessor */ 
</span><a name="LN98"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ExtensionVersionInfo</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Local functions */ 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>find_update_path</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_list</span><span class='Delimiter'>, 
</span><a name="LN102"></a>                 <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_start</span><span class='Delimiter'>, 
</span><a name="LN103"></a>                 <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_target</span><span class='Delimiter'>, 
</span><a name="LN104"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>reject_indirect</span><span class='Delimiter'>, 
</span><a name="LN105"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>reinitialize</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Prototype'>get_required_extension</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>reqExtensionName</span><span class='Delimiter'>, 
</span><a name="LN107"></a>                       <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extensionName</span><span class='Delimiter'>, 
</span><a name="LN108"></a>                       <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origSchemaName</span><span class='Delimiter'>, 
</span><a name="LN109"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>cascade</span><span class='Delimiter'>, 
</span><a name="LN110"></a>                       <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parents</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_create</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_available_versions_for_extension</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcontrol</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                                     <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupstore</span><span class='Delimiter'>, 
</span><a name="LN114"></a>                                     <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>convert_requires_to_datum</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>requires</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ApplyExtensionUpdates</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>extensionOid</span><span class='Delimiter'>, 
</span><a name="LN117"></a>                      <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcontrol</span><span class='Delimiter'>, 
</span><a name="LN118"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>initialVersion</span><span class='Delimiter'>, 
</span><a name="LN119"></a>                      <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>updateVersions</span><span class='Delimiter'>, 
</span><a name="LN120"></a>                      <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origSchemaName</span><span class='Delimiter'>, 
</span><a name="LN121"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>cascade</span><span class='Delimiter'>, 
</span><a name="LN122"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_create</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>read_whole_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>length</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_extension_oid - given an extension name, look up the OID 
 * 
 * If missing_ok is false, throw an error if extension name not found.  If 
 * true, just return InvalidOid. 
 */ 
</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN133"></a><span class='Declare_Function'>get_extension_oid</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>missing_ok</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN135"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN136"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN137"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span><a name="LN138"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="extension.c.html#LN136"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN139"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_extension.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_extension_extname</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN133"><span class='Ref_to_Parameter'>extname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN137"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN136"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN320"><span class='Ref_to_Const'>ExtensionNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN139"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN137"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume that there can be at most one matching tuple */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="extension.c.html#LN135"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN138"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN135"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN137"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN136"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN135"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="extension.c.html#LN133"><span class='Ref_to_Parameter'>missing_ok</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN133"><span class='Ref_to_Parameter'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN135"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_extension_oid &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_extension_name - given an extension OID, look up the name 
 * 
 * Returns a palloc'd string, or NULL if no such extension. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN178"></a><span class='Declare_Function'>get_extension_name</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ext_oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN180"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN181"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN182"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span><a name="LN183"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN184"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="extension.c.html#LN181"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN184"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN178"><span class='Ref_to_Parameter'>ext_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN182"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN181"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN184"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN183"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN182"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume that there can be at most one matching tuple */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN183"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="extension.c.html#LN180"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(((</span><a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN183"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>extname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN180"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN182"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN181"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN180"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_extension_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_extension_schema - given an extension OID, fetch its extnamespace 
 * 
 * Returns InvalidOid if no such extension. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN217"></a><span class='Declare_Function'>get_extension_schema</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>ext_oid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN219"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN220"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN221"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span><a name="LN222"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN223"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="extension.c.html#LN220"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN223"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN217"><span class='Ref_to_Parameter'>ext_oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN221"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN220"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN223"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN222"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN221"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume that there can be at most one matching tuple */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN222"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="extension.c.html#LN219"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN222"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Operator'>-&GT;</span>extnamespace<span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN219"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN221"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN220"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN219"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_extension_schema &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Utility functions to check validity of extension and version names 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN254"></a><span class='Declare_Function'>check_valid_extension_name</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extensionname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN256"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>namelen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow empty names (the parser rejects empty identifiers anyway, but 
     * let's check). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN256"><span class='Ref_To_Local'>namelen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Extension names must not be empty."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No double dashes, since that would make script filenames ambiguous. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Extension names must not contain \"--\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No leading or trailing dash either.  (We could probably allow this, but 
     * it would require much care in filename parsing and would make filenames 
     * visually if not formally ambiguous.  Since there's no real-world use 
     * case, let's just forbid it.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| </span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN256"><span class='Ref_To_Local'>namelen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Extension names must not begin or end with \"-\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No directory separators either (this is sufficient to prevent ".." 
     * style attacks). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN37"><span class='Ref_to_Proto'>first_dir_separator</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN254"><span class='Ref_to_Parameter'>extensionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Extension names must not contain directory separator characters."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_valid_extension_name &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN301"></a><span class='Declare_Function'>check_valid_version_name</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>versionname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN303"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>namelen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow empty names (we could possibly allow this, but there seems 
     * little point). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN303"><span class='Ref_To_Local'>namelen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension version name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Version names must not be empty."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No double dashes, since that would make script filenames ambiguous. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension version name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Version names must not contain \"--\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No leading or trailing dash either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| </span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN303"><span class='Ref_To_Local'>namelen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension version name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Version names must not begin or end with \"-\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No directory separators either (this is sufficient to prevent ".." 
     * style attacks). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN37"><span class='Ref_to_Proto'>first_dir_separator</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid extension version name: \"%s\""</span><span class='Delimiter'>, </span><a href="extension.c.html#LN301"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Version names must not contain directory separator characters."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_valid_version_name &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Utility functions to handle extension-related path names 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN348"></a><span class='Declare_Function'>is_extension_control_filename</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN350"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>extension</span> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="extension.c.html#LN348"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN350"><span class='Ref_To_Local'>extension</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN350"><span class='Ref_To_Local'>extension</span></a><span class='Delimiter'>, </span><span class='String'>".control"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN356"></a><span class='Declare_Function'>is_extension_script_filename</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN358"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>extension</span> <span class='Operator'>= </span>strrchr<span class='Parentheses'>(</span><a href="extension.c.html#LN356"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN358"><span class='Ref_To_Local'>extension</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN358"><span class='Ref_To_Local'>extension</span></a><span class='Delimiter'>, </span><span class='String'>".sql"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN364"></a><span class='Declare_Function'>get_extension_control_directory</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN366"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sharepath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN367"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN50"><span class='Ref_to_Proto'>get_share_path</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN63"><span class='Ref_to_Global_Var'>my_exec_path</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN366"><span class='Ref_To_Local'>sharepath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN367"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN367"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/extension"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN366"><span class='Ref_To_Local'>sharepath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN367"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN377"></a><span class='Declare_Function'>get_extension_control_filename</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN379"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sharepath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN380"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN50"><span class='Ref_to_Proto'>get_share_path</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN63"><span class='Ref_to_Global_Var'>my_exec_path</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN379"><span class='Ref_To_Local'>sharepath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN380"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN380"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/extension/%s.control"</span><span class='Delimiter'>, 
</span>             <a href="extension.c.html#LN379"><span class='Ref_To_Local'>sharepath</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN377"><span class='Ref_to_Parameter'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN380"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN391"></a><span class='Declare_Function'>get_extension_script_directory</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN393"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>sharepath</span><span class='Delimiter'>[</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN394"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The directory parameter can be omitted, absolute, or relative to the 
     * installation's share directory. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN391"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN75"><span class='Ref_to_Member'>directory</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="extension.c.html#LN363"><span class='Ref_to_Func'>get_extension_control_directory</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN76"><span class='Ref_to_Macro'>is_absolute_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN391"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN75"><span class='Ref_to_Member'>directory</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN391"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN75"><span class='Ref_to_Member'>directory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/port.h.html#LN50"><span class='Ref_to_Proto'>get_share_path</span></a><span class='Parentheses'>(</span><a href="../utils/init/globals.c.html#LN63"><span class='Ref_to_Global_Var'>my_exec_path</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN393"><span class='Ref_To_Local'>sharepath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN394"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN394"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN393"><span class='Ref_To_Local'>sharepath</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN391"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN75"><span class='Ref_to_Member'>directory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN394"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_extension_script_directory &raquo; </span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN414"></a><span class='Declare_Function'>get_extension_aux_control_filename</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Delimiter'>, 
</span><a name="LN415"></a>                                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN417"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>scriptdir</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN418"><span class='Ref_To_Local'>scriptdir</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN390"><span class='Ref_to_Func'>get_extension_script_directory</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN414"><span class='Ref_to_Parameter'>control</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN417"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN417"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s--%s.control"</span><span class='Delimiter'>, 
</span>             <a href="extension.c.html#LN418"><span class='Ref_To_Local'>scriptdir</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN414"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN415"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN418"><span class='Ref_To_Local'>scriptdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN417"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN432"></a><span class='Declare_Function'>get_extension_script_filename</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Delimiter'>, 
</span><a name="LN433"></a>                              <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>from_version</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN435"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN436"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>scriptdir</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN436"><span class='Ref_To_Local'>scriptdir</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN390"><span class='Ref_to_Func'>get_extension_script_directory</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN432"><span class='Ref_to_Parameter'>control</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN435"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN433"><span class='Ref_to_Parameter'>from_version</span></a><span class='Parentheses'>) 
</span>        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN435"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s--%s--%s.sql"</span><span class='Delimiter'>, 
</span>                 <a href="extension.c.html#LN436"><span class='Ref_To_Local'>scriptdir</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN432"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN433"><span class='Ref_to_Parameter'>from_version</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN433"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN435"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s/%s--%s.sql"</span><span class='Delimiter'>, 
</span>                 <a href="extension.c.html#LN436"><span class='Ref_To_Local'>scriptdir</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN432"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN433"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN436"><span class='Ref_To_Local'>scriptdir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN435"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_extension_script_filename &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Parse contents of primary or auxiliary control file, and fill in 
 * fields of *control.  We parse primary file if version == NULL, 
 * else the optional auxiliary file for that version. 
 * 
 * Control files are supposed to be very short, half a dozen lines, 
 * so we don't worry about memory allocation risks here.  Also we don't 
 * worry about what encoding it's in; all values are expected to be ASCII. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN464"></a><span class='Declare_Function'>parse_extension_control_file</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Delimiter'>, 
</span><a name="LN465"></a>                             <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN467"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN468"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span><span class='Delimiter'>; 
</span><a name="LN469"></a>    <a href="../../include/utils/guc.h.html#LN132"><span class='Ref_to_Struct'>ConfigVariable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>item</span><span class='Delimiter'>, 
</span><a name="LN470"></a>               <span class='Operator'>*</span><span class='Declare_Local'>head</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN471"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tail</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Locate the file to read.  Auxiliary files are optional. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN465"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>        <a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN413"><span class='Ref_to_Func'>get_extension_aux_control_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN465"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN376"><span class='Ref_to_Func'>get_extension_control_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="extension.c.html#LN468"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='String'>"r"</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN465"><span class='Ref_to_Parameter'>version</span></a> <span class='Operator'>&& </span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* no auxiliary file for this version */ 
</span>            <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open extension control file \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the file content, using GUC's file parsing code.  We need not 
     * check the return value since any errors will be thrown at ERROR level. 
     */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/guc.h.html#LN148"><span class='Ref_to_Proto'>ParseConfigFp</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN468"><span class='Ref_To_Local'>file</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN470"><span class='Ref_To_Local'>head</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN471"><span class='Ref_To_Local'>tail</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN468"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert the ConfigVariable list into ExtensionControlFile entries. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN470"><span class='Ref_To_Local'>head</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; </span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN141"><span class='Ref_to_Member'>next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"directory"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN465"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"%s\" cannot be set in a secondary extension control file"</span><span class='Delimiter'>, 
</span>                                <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN75"><span class='Ref_to_Member'>directory</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"default_version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN465"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"%s\" cannot be set in a secondary extension control file"</span><span class='Delimiter'>, 
</span>                                <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"module_pathname"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN77"><span class='Ref_to_Member'>module_pathname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"comment"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"schema"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"relocatable"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/builtins.h.html#LN22"><span class='Ref_to_Proto'>parse_bool</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"%s\" requires a Boolean value"</span><span class='Delimiter'>, 
</span>                                <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"superuser"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/builtins.h.html#LN22"><span class='Ref_to_Proto'>parse_bool</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN81"><span class='Ref_to_Member'>superuser</span></a><span class='Parentheses'>))</span> 
                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"%s\" requires a Boolean value"</span><span class='Delimiter'>, 
</span>                                <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"encoding"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN82"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>= </span><a href="../utils/mb/encnames.c.html#LN499"><span class='Ref_to_Func'>pg_valid_server_encoding</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN82"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"\"%s\" is not a valid encoding name"</span><span class='Delimiter'>, 
</span>                                <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><span class='String'>"requires"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Need a modifiable copy of string */ 
</span><a name="LN568"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rawnames</span> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Parse string into list of identifiers */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN568"><span class='Ref_To_Local'>rawnames</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* syntax error in name list */ 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"%s\" must be a list of extension names"</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized parameter \"%s\" in file \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN469"><span class='Ref_To_Local'>item</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/guc.h.html#LN134"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for item=head;item!=NULL;... &raquo; </span> 
 
    <a href="../../include/utils/guc.h.html#LN156"><span class='Ref_to_Proto'>FreeConfigVariables</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN470"><span class='Ref_To_Local'>head</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a> <span class='Operator'>&& </span><a href="extension.c.html#LN464"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"parameter \"schema\" cannot be specified when \"relocatable\" is true"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN467"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_extension_control_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the primary control file for the specified extension. 
 */ 
</span><span class='Keyword'>static </span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>* 
</span><a name="LN601"></a><span class='Declare_Function'>read_extension_control_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN603"></a>    <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up default values.  Pointer fields are initially null. 
     */ 
</span>    <a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN601"><span class='Ref_to_Parameter'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN81"><span class='Ref_to_Member'>superuser</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN82"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the primary control file. 
     */ 
</span>    <a href="extension.c.html#LN463"><span class='Ref_to_Func'>parse_extension_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN603"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end read_extension_control_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the auxiliary control file for the specified extension and version. 
 * 
 * Returns a new modified ExtensionControlFile struct; the original struct 
 * (reflecting just the primary control file) is not modified. 
 */ 
</span><span class='Keyword'>static </span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>* 
</span><a name="LN629"></a><span class='Declare_Function'>read_extension_aux_control_file</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcontrol</span><span class='Delimiter'>, 
</span><a name="LN630"></a>                                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN632"></a>    <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>acontrol</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Flat-copy the struct.  Pointer fields share values with original. 
     */ 
</span>    <a href="extension.c.html#LN632"><span class='Ref_To_Local'>acontrol</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="extension.c.html#LN632"><span class='Ref_To_Local'>acontrol</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN629"><span class='Ref_to_Parameter'>pcontrol</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the auxiliary control file, overwriting struct fields 
     */ 
</span>    <a href="extension.c.html#LN463"><span class='Ref_to_Func'>parse_extension_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN632"><span class='Ref_To_Local'>acontrol</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN630"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN632"><span class='Ref_To_Local'>acontrol</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Read an SQL script file into a string, and convert to database encoding 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN652"></a><span class='Declare_Function'>read_extension_script_file</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Delimiter'>, 
</span><a name="LN653"></a>                           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN655"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>src_encoding</span><span class='Delimiter'>; 
</span><a name="LN656"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>src_str</span><span class='Delimiter'>; 
</span><a name="LN657"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dest_str</span><span class='Delimiter'>; 
</span><a name="LN658"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN656"><span class='Ref_To_Local'>src_str</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN123"><span class='Ref_to_Proto'>read_whole_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN653"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN658"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use database encoding if not given */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN652"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN82"><span class='Ref_to_Member'>encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="extension.c.html#LN655"><span class='Ref_To_Local'>src_encoding</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN655"><span class='Ref_To_Local'>src_encoding</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN652"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN82"><span class='Ref_to_Member'>encoding</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make sure that source string is valid in the expected encoding */ 
</span>    <a href="../../include/mb/pg_wchar.h.html#LN588"><span class='Ref_to_Proto'>pg_verify_mbstr_len</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN655"><span class='Ref_To_Local'>src_encoding</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN656"><span class='Ref_To_Local'>src_str</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN658"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert the encoding to the database encoding. read_whole_file 
     * null-terminated the string, so if no conversion happens the string is 
     * valid as is. 
     */ 
</span>    <a href="extension.c.html#LN657"><span class='Ref_To_Local'>dest_str</span></a> <span class='Operator'>= </span><a href="../../include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN656"><span class='Ref_To_Local'>src_str</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN658"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN655"><span class='Ref_To_Local'>src_encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN657"><span class='Ref_To_Local'>dest_str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end read_extension_script_file &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute given SQL string. 
 * 
 * filename is used only to report errors. 
 * 
 * Note: it's tempting to just use SPI to execute the string, but that does 
 * not work very well.  The really serious problem is that SPI will parse, 
 * analyze, and plan the whole string before executing any of it; of course 
 * this fails if there are any plannable statements referring to objects 
 * created earlier in the script.  A lesser annoyance is that SPI insists 
 * on printing the whole string as errcontext in case of any error, and that 
 * could be very long. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN695"></a><span class='Declare_Function'>execute_sql_string</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sql</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN697"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>raw_parsetree_list</span><span class='Delimiter'>; 
</span><a name="LN698"></a>    <a href="../../include/tcop/dest.h.html#LN112"><span class='Ref_to_Typedef'>DestReceiver</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dest</span><span class='Delimiter'>; 
</span><a name="LN699"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the SQL string into a list of raw parse trees. 
     */ 
</span>    <a href="extension.c.html#LN697"><span class='Ref_To_Local'>raw_parsetree_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN49"><span class='Ref_to_Proto'>pg_parse_query</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN695"><span class='Ref_to_Parameter'>sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* All output from SELECTs goes to the bit bucket */ 
</span>    <a href="extension.c.html#LN698"><span class='Ref_To_Local'>dest</span></a> <span class='Operator'>= </span><a href="../tcop/dest.c.html#LN107"><span class='Ref_to_Func'>CreateDestReceiver</span></a><span class='Parentheses'>(</span><a href="../../include/tcop/dest.h.html#LN87"><span class='Ref_to_EnumConst'>DestNone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do parse analysis, rule rewrite, planning, and execution for each raw 
     * parsetree.  We must fully execute each query before beginning parse 
     * analysis on the next one, since there may be interdependencies. 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN699"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN697"><span class='Ref_To_Local'>raw_parsetree_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN716"></a>        <a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>parsetree</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1396"><span class='Ref_to_Struct'>RawStmt</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN699"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN717"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>stmt_list</span><span class='Delimiter'>; 
</span><a name="LN718"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Be sure parser can see any DDL done so far */ 
</span>        <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN717"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN50"><span class='Ref_to_Proto'>pg_analyze_and_rewrite</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN716"><span class='Ref_To_Local'>parsetree</span></a><span class='Delimiter'>, 
</span>                                           <a href="extension.c.html#LN695"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN717"><span class='Ref_To_Local'>stmt_list</span></a> <span class='Operator'>= </span><a href="../../include/tcop/tcopprot.h.html#LN61"><span class='Ref_to_Proto'>pg_plan_queries</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN717"><span class='Ref_To_Local'>stmt_list</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2610"><span class='Ref_to_Const'>CURSOR_OPT_PARALLEL_OK</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN718"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN717"><span class='Ref_To_Local'>stmt_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN732"></a>            <a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stmt</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN108"><span class='Ref_to_Macro'>lfirst_node</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/plannodes.h.html#LN40"><span class='Ref_to_Struct'>PlannedStmt</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN718"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/snapmgr.h.html#LN73"><span class='Ref_to_Proto'>PushActiveSnapshot</span></a><span class='Parentheses'>(</span><a href="../../include/utils/snapmgr.h.html#LN63"><span class='Ref_to_Proto'>GetTransactionSnapshot</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN732"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN740"></a>                <a href="../../include/executor/execdesc.h.html#LN32"><span class='Ref_to_Struct'>QueryDesc</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>qdesc</span><span class='Delimiter'>; 
</span> 
                <a href="extension.c.html#LN740"><span class='Ref_To_Local'>qdesc</span></a> <span class='Operator'>= </span><a href="../../include/executor/execdesc.h.html#LN58"><span class='Ref_to_Proto'>CreateQueryDesc</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN732"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN695"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/snapmgr.h.html#LN77"><span class='Ref_to_Proto'>GetActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN698"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../executor/execMain.c.html#LN144"><span class='Ref_to_Func'>ExecutorStart</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN740"><span class='Ref_To_Local'>qdesc</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/executor.h.html#LN169"><span class='Ref_to_Proto'>ExecutorRun</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN740"><span class='Ref_To_Local'>qdesc</span></a><span class='Delimiter'>, </span><a href="../../include/access/sdir.h.html#LN25"><span class='Ref_to_EnumConst'>ForwardScanDirection</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/executor.h.html#LN173"><span class='Ref_to_Proto'>ExecutorFinish</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN740"><span class='Ref_To_Local'>qdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/executor/executor.h.html#LN175"><span class='Ref_to_Proto'>ExecutorEnd</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN740"><span class='Ref_To_Local'>qdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/executor/execdesc.h.html#LN67"><span class='Ref_to_Proto'>FreeQueryDesc</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN740"><span class='Ref_To_Local'>qdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN732"><span class='Ref_To_Local'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/plannodes.h.html#LN93"><span class='Ref_to_Member'>utilityStmt</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2902"><span class='Ref_to_Struct'>TransactionStmt</span></a><span class='Parentheses'>))</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"transaction control statements are not allowed within an extension script"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="../../include/tcop/utility.h.html#LN33"><span class='Ref_to_Proto'>ProcessUtility</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN732"><span class='Ref_To_Local'>stmt</span></a><span class='Delimiter'>, 
</span>                               <a href="extension.c.html#LN695"><span class='Ref_to_Parameter'>sql</span></a><span class='Delimiter'>, 
</span>                               <a href="../../include/tcop/utility.h.html#LN21"><span class='Ref_to_EnumConst'>PROCESS_UTILITY_QUERY</span></a><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                               <a href="extension.c.html#LN698"><span class='Ref_To_Local'>dest</span></a><span class='Delimiter'>, 
</span>                               <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/utils/snapmgr.h.html#LN76"><span class='Ref_to_Proto'>PopActiveSnapshot</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Be sure to advance the command counter after the last script command */ 
</span>    <a href="../../include/access/xact.h.html#LN346"><span class='Ref_to_Proto'>CommandCounterIncrement</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end execute_sql_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute the appropriate script file for installing or updating the extension 
 * 
 * If from_version isn't NULL, it's an update 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN784"></a><span class='Declare_Function'>execute_extension_script</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>extensionOid</span><span class='Delimiter'>, </span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Delimiter'>, 
</span><a name="LN785"></a>                         <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>from_version</span><span class='Delimiter'>, 
</span><a name="LN786"></a>                         <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Delimiter'>, 
</span><a name="LN787"></a>                         <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>requiredSchemas</span><span class='Delimiter'>, 
</span><a name="LN788"></a>                         <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>schemaName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>schemaOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN790"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN791"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>save_nestlevel</span><span class='Delimiter'>; 
</span><a name="LN792"></a>    <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>pathbuf</span><span class='Delimiter'>; 
</span><a name="LN793"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Enforce superuser-ness if appropriate.  We postpone this check until 
     * here so that the flag is correctly associated with the right script(s) 
     * if it's set in secondary control files. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN81"><span class='Ref_to_Member'>superuser</span></a> <span class='Operator'>&& !</span><a href="../utils/misc/superuser.c.html#LN45"><span class='Ref_to_Func'>superuser</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN785"><span class='Ref_to_Parameter'>from_version</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to create extension \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Must be superuser to create this extension."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INSUFFICIENT_PRIVILEGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"permission denied to update extension \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Must be superuser to update this extension."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="extension.c.html#LN790"><span class='Ref_To_Local'>filename</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN431"><span class='Ref_to_Func'>get_extension_script_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN785"><span class='Ref_to_Parameter'>from_version</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN786"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Force client_min_messages and log_min_messages to be at least WARNING, 
     * so that we won't spam the user with useless NOTICE messages from common 
     * script actions like creating shell types. 
     * 
     * We use the equivalent of a function SET option to allow the setting to 
     * persist for exactly the duration of the script execution.  guc.c also 
     * takes care of undoing the setting on error. 
     */ 
</span>    <a href="extension.c.html#LN791"><span class='Ref_To_Local'>save_nestlevel</span></a> <span class='Operator'>= </span><a href="../../include/utils/guc.h.html#LN354"><span class='Ref_to_Proto'>NewGUCNestLevel</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN451"><span class='Ref_to_Global_Var'>client_min_messages</span></a> <span class='Operator'>&LT; </span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"client_min_messages"</span><span class='Delimiter'>, </span><span class='String'>"warning"</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/guc.h.html#LN75"><span class='Ref_to_EnumConst'>PGC_USERSET</span></a><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN119"><span class='Ref_to_EnumConst'>PGC_S_SESSION</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/guc.h.html#LN195"><span class='Ref_to_EnumConst'>GUC_ACTION_SAVE</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../utils/misc/guc.c.html#LN450"><span class='Ref_to_Global_Var'>log_min_messages</span></a> <span class='Operator'>&LT; </span><a href="../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"log_min_messages"</span><span class='Delimiter'>, </span><span class='String'>"warning"</span><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/guc.h.html#LN74"><span class='Ref_to_EnumConst'>PGC_SUSET</span></a><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN119"><span class='Ref_to_EnumConst'>PGC_S_SESSION</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../include/utils/guc.h.html#LN195"><span class='Ref_to_EnumConst'>GUC_ACTION_SAVE</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set up the search path to contain the target schema, then the schemas 
     * of any prerequisite extensions, and nothing else.  In particular this 
     * makes the target schema be the default creation target namespace. 
     * 
     * Note: it might look tempting to use PushOverrideSearchPath for this, 
     * but we cannot do that.  We have to actually set the search_path GUC in 
     * case the extension script examines or changes it.  In any case, the 
     * GUC_ACTION_SAVE method is just as convenient. 
     */ 
</span>    <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN792"><span class='Ref_To_Local'>pathbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN792"><span class='Ref_To_Local'>pathbuf</span></a><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN788"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN793"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN787"><span class='Ref_to_Parameter'>requiredSchemas</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN852"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqschema</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN793"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN853"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>reqname</span> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN852"><span class='Ref_To_Local'>reqschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN853"><span class='Ref_To_Local'>reqname</span></a><span class='Parentheses'>) 
</span>            <a href="../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN792"><span class='Ref_To_Local'>pathbuf</span></a><span class='Delimiter'>, </span><span class='String'>", %s"</span><span class='Delimiter'>, </span><a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN853"><span class='Ref_To_Local'>reqname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../include/utils/guc.h.html#LN361"><span class='Ref_to_Proto'>set_config_option</span></a><span class='Parentheses'>(</span><span class='String'>"search_path"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN792"><span class='Ref_To_Local'>pathbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/guc.h.html#LN75"><span class='Ref_to_EnumConst'>PGC_USERSET</span></a><span class='Delimiter'>, </span><a href="../../include/utils/guc.h.html#LN119"><span class='Ref_to_EnumConst'>PGC_S_SESSION</span></a><span class='Delimiter'>, 
</span>                             <a href="../../include/utils/guc.h.html#LN195"><span class='Ref_to_EnumConst'>GUC_ACTION_SAVE</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set creating_extension and related variables so that 
     * recordDependencyOnCurrentExtension and other functions do the right 
     * things.  On failure, ensure we reset these variables. 
     */ 
</span>    <a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN872"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>c_sql</span> <span class='Operator'>= </span><a href="extension.c.html#LN651"><span class='Ref_to_Func'>read_extension_script_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN790"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN873"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>t_sql</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We use various functions that want to operate on text datums */ 
</span>        <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN872"><span class='Ref_To_Local'>c_sql</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Reduce any lines beginning with "\echo" to empty.  This allows 
         * scripts to contain messages telling people not to run them via 
         * psql, which has been found to be necessary due to old habits. 
         */ 
</span>        <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN469"><span class='Ref_to_Proto'>DirectFunctionCall4Coll</span></a><span class='Parentheses'>(</span><a href="../utils/adt/regexp.c.html#LN634"><span class='Ref_to_Func'>textregexreplace</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/catalog/pg_collation.h.html#LN77"><span class='Ref_to_Const'>C_COLLATION_OID</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"^\\\\echo.*$"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"ng"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's not relocatable, substitute the target schema name for 
         * occurrences of @extschema@. 
         * 
         * For a relocatable extension, we needn't do this.  There cannot be 
         * any need for @extschema@, else it wouldn't be relocatable. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN899"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>qSchemaName</span> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN788"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="../utils/adt/varlena.c.html#LN3670"><span class='Ref_to_Func'>replace_text</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"@extschema@"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN899"><span class='Ref_To_Local'>qSchemaName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If module_pathname was set in the control file, substitute its 
         * value for occurrences of MODULE_PATHNAME. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN77"><span class='Ref_to_Member'>module_pathname</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="../utils/adt/varlena.c.html#LN3670"><span class='Ref_to_Func'>replace_text</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"MODULE_PATHNAME"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN784"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN77"><span class='Ref_to_Member'>module_pathname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* And now back to C string */ 
</span>        <a href="extension.c.html#LN872"><span class='Ref_To_Local'>c_sql</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN873"><span class='Ref_To_Local'>t_sql</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN694"><span class='Ref_to_Func'>execute_sql_string</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN872"><span class='Ref_To_Local'>c_sql</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN790"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Restore the GUC variables we set above. 
     */ 
</span>    <a href="../../include/utils/guc.h.html#LN355"><span class='Ref_to_Proto'>AtEOXact_GUC</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="extension.c.html#LN791"><span class='Ref_To_Local'>save_nestlevel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end execute_extension_script &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find or create an ExtensionVersionInfo for the specified version name 
 * 
 * Currently, we just use a List of the ExtensionVersionInfo's.  Searching 
 * for them therefore uses about O(N^2) time when there are N versions of 
 * the extension.  We could change the data structure to a hash table if 
 * this ever becomes a bottleneck. 
 */ 
</span><span class='Keyword'>static </span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>* 
</span><a name="LN950"></a><span class='Declare_Function'>get_ext_ver_info</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>versionname</span><span class='Delimiter'>, </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>evi_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN952"></a>    <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi</span><span class='Delimiter'>; 
</span><a name="LN953"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN953"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="extension.c.html#LN950"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN953"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN950"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN950"><span class='Ref_to_Parameter'>versionname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN92"><span class='Ref_to_Member'>reachable</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* initialize for later application of Dijkstra's algorithm */ 
</span>    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN95"><span class='Ref_to_Member'>distance_known</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>= </span>INT_MAX<span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="extension.c.html#LN950"><span class='Ref_to_Parameter'>evi_list</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="extension.c.html#LN950"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN952"><span class='Ref_To_Local'>evi</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_ext_ver_info &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Locate the nearest unprocessed ExtensionVersionInfo 
 * 
 * This part of the algorithm is also about O(N^2).  A priority queue would 
 * make it much faster, but for now there's no need. 
 */ 
</span><span class='Keyword'>static </span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>* 
</span><a name="LN983"></a><span class='Declare_Function'>get_nearest_unprocessed_vertex</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN985"></a>    <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN986"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN986"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN983"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN990"></a>        <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN986"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* only vertices whose distance is still uncertain are candidates */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN990"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN95"><span class='Ref_to_Member'>distance_known</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* remember the closest such vertex */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN985"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="extension.c.html#LN985"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>&GT; </span><a href="extension.c.html#LN990"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN985"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN990"><span class='Ref_To_Local'>evi2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN985"><span class='Ref_To_Local'>evi</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_nearest_unprocessed_vertex &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Obtain information about the set of update scripts available for the 
 * specified extension.  The result is a List of ExtensionVersionInfo 
 * structs, each with a subsidiary list of the ExtensionVersionInfos for 
 * the versions that can be reached in one step from that version. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1011"></a><span class='Declare_Function'>get_ext_ver_list</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1013"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>evi_list</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN1014"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>extnamelen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="extension.c.html#LN1011"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1015"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>location</span><span class='Delimiter'>; 
</span><a name="LN1016"></a>    <a href="../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dir</span><span class='Delimiter'>; 
</span><a name="LN1017"></a>    <span class='Control'>struct</span> <a href="../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1015"><span class='Ref_To_Local'>location</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN390"><span class='Ref_to_Func'>get_extension_script_directory</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1011"><span class='Ref_to_Parameter'>control</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1016"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1015"><span class='Ref_To_Local'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="extension.c.html#LN1017"><span class='Ref_To_Local'>de</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1016"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1015"><span class='Ref_To_Local'>location</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1023"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>vername</span><span class='Delimiter'>; 
</span><a name="LN1024"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>vername2</span><span class='Delimiter'>; 
</span><a name="LN1025"></a>        <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi</span><span class='Delimiter'>; 
</span><a name="LN1026"></a>        <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi2</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* must be a .sql file ... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN355"><span class='Ref_to_Func'>is_extension_script_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1017"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ... matching extension name followed by separator */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strncmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1017"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1011"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1014"><span class='Ref_To_Local'>extnamelen</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="extension.c.html#LN1017"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN1014"><span class='Ref_To_Local'>extnamelen</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'-'</span> <span class='Operator'>|| 
</span>            <a href="extension.c.html#LN1017"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN1014"><span class='Ref_To_Local'>extnamelen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'-'</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* extract version name(s) from 'extname--something.sql' filename */ 
</span>        <a href="extension.c.html#LN1023"><span class='Ref_To_Local'>vername</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1017"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a> <span class='Operator'>+ </span><a href="extension.c.html#LN1014"><span class='Ref_To_Local'>extnamelen</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span>strrchr<span class='Parentheses'>(</span><a href="extension.c.html#LN1023"><span class='Ref_To_Local'>vername</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1024"><span class='Ref_To_Local'>vername2</span></a> <span class='Operator'>= </span>strstr<span class='Parentheses'>(</span><a href="extension.c.html#LN1023"><span class='Ref_To_Local'>vername</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN1024"><span class='Ref_To_Local'>vername2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* It's an install, not update, script; record its version name */ 
</span>            <a href="extension.c.html#LN1025"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN949"><span class='Ref_to_Func'>get_ext_ver_info</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1023"><span class='Ref_To_Local'>vername</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1013"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1025"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Operator'>*</span><a href="extension.c.html#LN1024"><span class='Ref_To_Local'>vername2</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* terminate first version */ 
</span>        <a href="extension.c.html#LN1024"><span class='Ref_To_Local'>vername2</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* and point to second */ 
</span> 
        <span class='Comment_Multi_Line'>/* if there's a third --, it's bogus, ignore it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="extension.c.html#LN1024"><span class='Ref_To_Local'>vername2</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Create ExtensionVersionInfos and link them together */ 
</span>        <a href="extension.c.html#LN1025"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN949"><span class='Ref_to_Func'>get_ext_ver_info</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1023"><span class='Ref_To_Local'>vername</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1013"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1026"><span class='Ref_To_Local'>evi2</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN949"><span class='Ref_to_Func'>get_ext_ver_info</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1024"><span class='Ref_To_Local'>vername2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1013"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1025"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN92"><span class='Ref_to_Member'>reachable</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1025"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN92"><span class='Ref_to_Member'>reachable</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1026"><span class='Ref_To_Local'>evi2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (de=ReadDir(dir,locat... &raquo; </span> 
    <a href="../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1016"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN1013"><span class='Ref_To_Local'>evi_list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_ext_ver_list &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given an initial and final version name, identify the sequence of update 
 * scripts that have to be applied to perform that update. 
 * 
 * Result is a List of names of versions to transition through (the initial 
 * version is *not* included). 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1074"></a><span class='Declare_Function'>identify_update_path</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>control</span><span class='Delimiter'>, 
</span><a name="LN1075"></a>                     <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>oldVersion</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newVersion</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1077"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1078"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>evi_list</span><span class='Delimiter'>; 
</span><a name="LN1079"></a>    <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi_start</span><span class='Delimiter'>; 
</span><a name="LN1080"></a>    <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi_target</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the version update graph from the script directory */ 
</span>    <a href="extension.c.html#LN1078"><span class='Ref_To_Local'>evi_list</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1010"><span class='Ref_to_Func'>get_ext_ver_list</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1074"><span class='Ref_to_Parameter'>control</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize start and end vertices */ 
</span>    <a href="extension.c.html#LN1079"><span class='Ref_To_Local'>evi_start</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN949"><span class='Ref_to_Func'>get_ext_ver_info</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1075"><span class='Ref_to_Parameter'>oldVersion</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1078"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1080"><span class='Ref_To_Local'>evi_target</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN949"><span class='Ref_to_Func'>get_ext_ver_info</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1075"><span class='Ref_to_Parameter'>newVersion</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1078"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find shortest path */ 
</span>    <a href="extension.c.html#LN1077"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN101"><span class='Ref_to_Proto'>find_update_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1078"><span class='Ref_To_Local'>evi_list</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1079"><span class='Ref_To_Local'>evi_start</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1080"><span class='Ref_To_Local'>evi_target</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1077"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" has no update path from version \"%s\" to version \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN1074"><span class='Ref_to_Parameter'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1075"><span class='Ref_to_Parameter'>oldVersion</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1075"><span class='Ref_to_Parameter'>newVersion</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN1077"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end identify_update_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Apply Dijkstra's algorithm to find the shortest path from evi_start to 
 * evi_target. 
 * 
 * If reject_indirect is true, ignore paths that go through installable 
 * versions.  This saves work when the caller will consider starting from 
 * all installable versions anyway. 
 * 
 * If reinitialize is false, assume the ExtensionVersionInfo list has not 
 * been used for this before, and the initialization done by get_ext_ver_info 
 * is still good.  Otherwise, reinitialize all transient fields used here. 
 * 
 * Result is a List of names of versions to transition through (the initial 
 * version is *not* included).  Returns NIL if no such path. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN1117"></a><span class='Declare_Function'>find_update_path</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_list</span><span class='Delimiter'>, 
</span><a name="LN1118"></a>                 <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_start</span><span class='Delimiter'>, 
</span><a name="LN1119"></a>                 <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_target</span><span class='Delimiter'>, 
</span><a name="LN1120"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>reject_indirect</span><span class='Delimiter'>, 
</span><a name="LN1121"></a>                 <span class='Keyword'>bool </span><span class='Declare_Parameter'>reinitialize</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1123"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1124"></a>    <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi</span><span class='Delimiter'>; 
</span><a name="LN1125"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Caller error if start == target */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1118"><span class='Ref_to_Parameter'>evi_start</span></a> <span class='Operator'>!= </span><a href="extension.c.html#LN1119"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Caller error if reject_indirect and target is installable */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1120"><span class='Ref_to_Parameter'>reject_indirect</span></a> <span class='Operator'>&& </span><a href="extension.c.html#LN1119"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1121"><span class='Ref_to_Parameter'>reinitialize</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1125"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1117"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1125"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN95"><span class='Ref_to_Member'>distance_known</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>= </span>INT_MAX<span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="extension.c.html#LN1118"><span class='Ref_to_Parameter'>evi_start</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN982"><span class='Ref_to_Func'>get_nearest_unprocessed_vertex</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1117"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>== </span>INT_MAX<span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* all remaining vertices are unreachable */ 
</span>        <a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN95"><span class='Ref_to_Member'>distance_known</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>== </span><a href="extension.c.html#LN1119"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* found shortest path to target */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1125"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN92"><span class='Ref_to_Member'>reachable</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1154"></a>            <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1125"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1155"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>newdist</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* if reject_indirect, treat installable versions as unreachable */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1120"><span class='Ref_to_Parameter'>reject_indirect</span></a> <span class='Operator'>&& </span><a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1155"><span class='Ref_To_Local'>newdist</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1155"><span class='Ref_To_Local'>newdist</span></a> <span class='Operator'>&LT; </span><a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1155"><span class='Ref_To_Local'>newdist</span></a><span class='Delimiter'>; 
</span>                <a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1155"><span class='Ref_To_Local'>newdist</span></a> <span class='Operator'>== </span><a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN96"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>&& 
</span>                     <a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                     strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Break ties in favor of the version name that comes first 
                 * according to strcmp().  This behavior is undocumented and 
                 * users shouldn't rely on it.  We do it just to ensure that 
                 * if there is a tie, the update path that is chosen does not 
                 * depend on random factors like the order in which directory 
                 * entries get visited. 
                 */ 
</span>                <a href="extension.c.html#LN1154"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (evi=get_nearest_unpr... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Return NIL if target is not reachable from start */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN1119"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN95"><span class='Ref_to_Member'>distance_known</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build and return list of version names representing the update path */ 
</span>    <a href="extension.c.html#LN1123"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1119"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>!= </span><a href="extension.c.html#LN1118"><span class='Ref_to_Parameter'>evi_start</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN97"><span class='Ref_to_Member'>previous</span></a><span class='Parentheses'>) 
</span>        <a href="extension.c.html#LN1123"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN215"><span class='Ref_to_Proto'>lcons</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1124"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1123"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN1123"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_update_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a target version that is not directly installable, find the 
 * best installation sequence starting from a directly-installable version. 
 * 
 * evi_list: previously-collected version update graph 
 * evi_target: member of that list that we want to reach 
 * 
 * Returns the best starting-point version, or NULL if there is none. 
 * On success, *best_path is set to the path from the start point. 
 * 
 * If there's more than one possible start point, prefer shorter update paths, 
 * and break any ties arbitrarily on the basis of strcmp'ing the starting 
 * versions' names. 
 */ 
</span><span class='Keyword'>static </span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>* 
</span><a name="LN1210"></a><span class='Declare_Function'>find_install_path</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_list</span><span class='Delimiter'>, </span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>evi_target</span><span class='Delimiter'>, 
</span><a name="LN1211"></a>                  <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>best_path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1213"></a>    <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi_start</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1214"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="extension.c.html#LN1211"><span class='Ref_to_Parameter'>best_path</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't expect to be called for an installable target, but if we are, 
     * the answer is easy: just start from there, with an empty update path. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1210"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="extension.c.html#LN1210"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Consider all installable versions as start points */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1214"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1210"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1228"></a>        <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1214"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1229"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN1228"><span class='Ref_To_Local'>evi1</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find shortest path from evi1 to evi_target; but no need to consider 
         * paths going through other installable versions. 
         */ 
</span>        <a href="extension.c.html#LN1229"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN101"><span class='Ref_to_Proto'>find_update_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1210"><span class='Ref_to_Parameter'>evi_list</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1228"><span class='Ref_To_Local'>evi1</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1210"><span class='Ref_to_Parameter'>evi_target</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1229"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Remember best path */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1213"><span class='Ref_To_Local'>evi_start</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1229"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="extension.c.html#LN1211"><span class='Ref_to_Parameter'>best_path</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1229"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="extension.c.html#LN1211"><span class='Ref_to_Parameter'>best_path</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>             strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1213"><span class='Ref_To_Local'>evi_start</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1228"><span class='Ref_To_Local'>evi1</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="extension.c.html#LN1213"><span class='Ref_To_Local'>evi_start</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1228"><span class='Ref_To_Local'>evi1</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="extension.c.html#LN1211"><span class='Ref_to_Parameter'>best_path</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1229"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN1213"><span class='Ref_To_Local'>evi_start</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end find_install_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CREATE EXTENSION worker 
 * 
 * When CASCADE is specified, CreateExtensionInternal() recurses if required 
 * extensions need to be installed.  To sanely handle cyclic dependencies, 
 * the "parents" list contains a list of names of extensions already being 
 * installed, allowing us to error out if we recurse to one of those. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1265"></a><span class='Declare_Function'>CreateExtensionInternal</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extensionName</span><span class='Delimiter'>, 
</span><a name="LN1266"></a>                        <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>schemaName</span><span class='Delimiter'>, 
</span><a name="LN1267"></a>                        <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>versionName</span><span class='Delimiter'>, 
</span><a name="LN1268"></a>                        <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>oldVersionName</span><span class='Delimiter'>, 
</span><a name="LN1269"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>cascade</span><span class='Delimiter'>, 
</span><a name="LN1270"></a>                        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parents</span><span class='Delimiter'>, 
</span><a name="LN1271"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_create</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1273"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>origSchemaName</span> <span class='Operator'>= </span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>; 
</span><a name="LN1274"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN1275"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>extowner</span> <span class='Operator'>= </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1276"></a>    <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pcontrol</span><span class='Delimiter'>; 
</span><a name="LN1277"></a>    <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN1278"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>updateVersions</span><span class='Delimiter'>; 
</span><a name="LN1279"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>requiredExtensions</span><span class='Delimiter'>; 
</span><a name="LN1280"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>requiredSchemas</span><span class='Delimiter'>; 
</span><a name="LN1281"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>extensionOid</span><span class='Delimiter'>; 
</span><a name="LN1282"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span><a name="LN1283"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the primary control file.  Note we assume that it does not contain 
     * any non-ASCII data, so there is no need to worry about encoding at this 
     * point. 
     */ 
</span>    <a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN600"><span class='Ref_to_Func'>read_extension_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1265"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the version to install 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"version to install must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="extension.c.html#LN300"><span class='Ref_to_Func'>check_valid_version_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Figure out which script(s) we need to run to install the desired 
     * version of the extension.  If we do not have a script that directly 
     * does what is needed, we try to find a sequence of update scripts that 
     * will get us there. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1268"><span class='Ref_to_Parameter'>oldVersionName</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * "FROM old_version" was specified, indicating that we're trying to 
         * update from some unpackaged version of the extension.  Locate a 
         * series of update scripts that will do it. 
         */ 
</span>        <a href="extension.c.html#LN300"><span class='Ref_to_Func'>check_valid_version_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1268"><span class='Ref_to_Parameter'>oldVersionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1268"><span class='Ref_to_Parameter'>oldVersionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"FROM version must be different from installation target version \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1073"><span class='Ref_to_Func'>identify_update_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Delimiter'>, 
</span>                                              <a href="extension.c.html#LN1268"><span class='Ref_to_Parameter'>oldVersionName</span></a><span class='Delimiter'>, 
</span>                                              <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Simple case where there's just one update script to run. We 
             * will not need any follow-on update steps. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span>strcmp<span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Multi-step sequence.  We treat this as installing the version 
             * that is the target of the first script, followed by successive 
             * updates to the later versions. 
             */ 
</span>            <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN237"><span class='Ref_to_Proto'>list_delete_first</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if oldVersionName &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No FROM, so we're installing from scratch.  If there is an install 
         * script for the desired version, we only need to run that one. 
         */ 
</span><a name="LN1357"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>filename</span><span class='Delimiter'>; 
</span><a name="LN1358"></a>        <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>fst</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN1268"><span class='Ref_to_Parameter'>oldVersionName</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN1357"><span class='Ref_To_Local'>filename</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN431"><span class='Ref_to_Func'>get_extension_script_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1357"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1358"><span class='Ref_To_Local'>fst</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Easy, no extra scripts */ 
</span>            <a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Look for best way to install this version */ 
</span><a name="LN1371"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>evi_list</span><span class='Delimiter'>; 
</span><a name="LN1372"></a>            <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi_start</span><span class='Delimiter'>; 
</span><a name="LN1373"></a>            <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi_target</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Extract the version update graph from the script directory */ 
</span>            <a href="extension.c.html#LN1371"><span class='Ref_To_Local'>evi_list</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1010"><span class='Ref_to_Func'>get_ext_ver_list</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Identify the target version */ 
</span>            <a href="extension.c.html#LN1373"><span class='Ref_To_Local'>evi_target</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN949"><span class='Ref_to_Func'>get_ext_ver_info</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1371"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Identify best path to reach target */ 
</span>            <a href="extension.c.html#LN1372"><span class='Ref_To_Local'>evi_start</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1209"><span class='Ref_to_Func'>find_install_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1371"><span class='Ref_To_Local'>evi_list</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1373"><span class='Ref_To_Local'>evi_target</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Fail if no path ... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1372"><span class='Ref_To_Local'>evi_start</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" has no installation script nor update path for version \"%s\""</span><span class='Delimiter'>, 
</span>                                <a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Otherwise, install best starting point and then upgrade */ 
</span>            <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1372"><span class='Ref_To_Local'>evi_start</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Fetch control parameters for installation target version 
     */ 
</span>    <a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN628"><span class='Ref_to_Func'>read_extension_aux_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the target schema to install the extension into 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If the user is giving us the schema name, it must exist already. */ 
</span>        <a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN114"><span class='Ref_to_Proto'>get_namespace_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The extension is not relocatable and the author gave us a schema 
         * for it. 
         * 
         * Unless CASCADE parameter was given, it's an error to give a schema 
         * different from control-&GT;schema if control-&GT;schema is specified. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <span class='Operator'>!</span><a href="extension.c.html#LN1269"><span class='Ref_to_Parameter'>cascade</span></a><span class='Parentheses'>)</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" must be installed in schema \"%s\""</span><span class='Delimiter'>, 
</span>                       <a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                       <a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Always use the schema from control file for current extension. */ 
</span>        <a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find or create the schema in case it does not exist. */ 
</span>        <a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN114"><span class='Ref_to_Proto'>get_namespace_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1436"></a>            <a href="../../include/nodes/parsenodes.h.html#LN1643"><span class='Ref_to_Struct'>CreateSchemaStmt</span></a> <span class='Operator'>*</span><span class='Declare_Local'>csstmt</span> <span class='Operator'>= </span><a href="../../include/nodes/nodes.h.html#LN556"><span class='Ref_to_Macro'>makeNode</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN1643"><span class='Ref_to_Struct'>CreateSchemaStmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN1436"><span class='Ref_To_Local'>csstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1646"><span class='Ref_to_Member'>schemaname</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1436"><span class='Ref_To_Local'>csstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1647"><span class='Ref_to_Member'>authrole</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* will be created by current user */ 
</span>            <a href="extension.c.html#LN1436"><span class='Ref_To_Local'>csstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1648"><span class='Ref_to_Member'>schemaElts</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1436"><span class='Ref_To_Local'>csstmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN1649"><span class='Ref_to_Member'>if_not_exists</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="../../include/commands/schemacmds.h.html#LN20"><span class='Ref_to_Proto'>CreateSchemaCommand</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1436"><span class='Ref_To_Local'>csstmt</span></a><span class='Delimiter'>, </span><span class='String'>"(generated CREATE SCHEMA command)"</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * CreateSchemaCommand includes CommandCounterIncrement, so new 
             * schema is now visible. 
             */ 
</span>            <a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN114"><span class='Ref_to_Proto'>get_namespace_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if control-&GT;schema!=NULL &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Neither user nor author of the extension specified schema; use the 
         * current default creation namespace, which is the first explicit 
         * entry in the search_path. 
         */ 
</span><a name="LN1459"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>search_path</span> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN156"><span class='Ref_to_Proto'>fetch_search_path</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1459"><span class='Ref_To_Local'>search_path</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* nothing valid in search_path? */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_SCHEMA<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no schema has been selected to create in"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN112"><span class='Ref_to_Macro'>linitial_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1459"><span class='Ref_To_Local'>search_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* recently-deleted namespace? */ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_SCHEMA<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"no schema has been selected to create in"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1459"><span class='Ref_To_Local'>search_path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !OidIsValid(schemaOid... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * We don't check creation rights on the target namespace here.  If the 
     * extension script actually creates any objects there, it will fail if 
     * the user doesn't have such permissions.  But there are cases such as 
     * procedural languages where it's convenient to set schema = pg_catalog 
     * yet we don't want to restrict the command to users with ACL_CREATE for 
     * pg_catalog. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the prerequisite extensions, install them if necessary, and 
     * build lists of their OIDs and the OIDs of their target schemas. 
     */ 
</span>    <a href="extension.c.html#LN1279"><span class='Ref_To_Local'>requiredExtensions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1280"><span class='Ref_To_Local'>requiredSchemas</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1283"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1492"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curreq</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1283"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1493"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqext</span><span class='Delimiter'>; 
</span><a name="LN1494"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqschema</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN1493"><span class='Ref_To_Local'>reqext</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN106"><span class='Ref_to_Proto'>get_required_extension</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1492"><span class='Ref_To_Local'>curreq</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN1265"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN1273"><span class='Ref_To_Local'>origSchemaName</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN1269"><span class='Ref_to_Parameter'>cascade</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN1270"><span class='Ref_to_Parameter'>parents</span></a><span class='Delimiter'>, 
</span>                                        <a href="extension.c.html#LN1271"><span class='Ref_to_Parameter'>is_create</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1494"><span class='Ref_To_Local'>reqschema</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN216"><span class='Ref_to_Func'>get_extension_schema</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1493"><span class='Ref_To_Local'>reqext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1279"><span class='Ref_To_Local'>requiredExtensions</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1279"><span class='Ref_To_Local'>requiredExtensions</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1493"><span class='Ref_To_Local'>reqext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1280"><span class='Ref_To_Local'>requiredSchemas</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1280"><span class='Ref_To_Local'>requiredSchemas</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1494"><span class='Ref_To_Local'>reqschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Insert new tuple into pg_extension, and create dependency entries. 
     */ 
</span>    <a href="extension.c.html#LN1282"><span class='Ref_To_Local'>address</span></a> <span class='Operator'>= </span><a href="../../include/commands/extension.h.html#LN37"><span class='Ref_to_Proto'>InsertExtensionTuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1275"><span class='Ref_To_Local'>extowner</span></a><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1279"><span class='Ref_To_Local'>requiredExtensions</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1281"><span class='Ref_To_Local'>extensionOid</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1282"><span class='Ref_To_Local'>address</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Apply any control-file comment on extension 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/commands/comment.h.html#LN36"><span class='Ref_to_Proto'>CreateComments</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1281"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Execute the installation script file 
     */ 
</span>    <a href="extension.c.html#LN783"><span class='Ref_to_Func'>execute_extension_script</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1281"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1277"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>, 
</span>                             <a href="extension.c.html#LN1268"><span class='Ref_to_Parameter'>oldVersionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Delimiter'>, 
</span>                             <a href="extension.c.html#LN1280"><span class='Ref_To_Local'>requiredSchemas</span></a><span class='Delimiter'>, 
</span>                             <a href="extension.c.html#LN1266"><span class='Ref_to_Parameter'>schemaName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1274"><span class='Ref_To_Local'>schemaOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If additional update scripts have to be executed, apply the updates as 
     * though a series of ALTER EXTENSION UPDATE commands were given 
     */ 
</span>    <a href="extension.c.html#LN116"><span class='Ref_to_Proto'>ApplyExtensionUpdates</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1281"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1276"><span class='Ref_To_Local'>pcontrol</span></a><span class='Delimiter'>, 
</span>                          <a href="extension.c.html#LN1267"><span class='Ref_to_Parameter'>versionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1278"><span class='Ref_To_Local'>updateVersions</span></a><span class='Delimiter'>, 
</span>                          <a href="extension.c.html#LN1273"><span class='Ref_To_Local'>origSchemaName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1269"><span class='Ref_to_Parameter'>cascade</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1271"><span class='Ref_to_Parameter'>is_create</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN1282"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateExtensionInternal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the OID of an extension listed in "requires", possibly creating it. 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> 
<a name="LN1547"></a><span class='Declare_Function'>get_required_extension</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>reqExtensionName</span><span class='Delimiter'>, 
</span><a name="LN1548"></a>                       <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extensionName</span><span class='Delimiter'>, 
</span><a name="LN1549"></a>                       <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origSchemaName</span><span class='Delimiter'>, 
</span><a name="LN1550"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>cascade</span><span class='Delimiter'>, 
</span><a name="LN1551"></a>                       <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parents</span><span class='Delimiter'>, 
</span><a name="LN1552"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_create</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1554"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqExtensionOid</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1554"><span class='Ref_To_Local'>reqExtensionOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/extension.h.html#LN47"><span class='Ref_to_Proto'>get_extension_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1554"><span class='Ref_To_Local'>reqExtensionOid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1550"><span class='Ref_to_Parameter'>cascade</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Must install it. */ 
</span><a name="LN1562"></a>            <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>addr</span><span class='Delimiter'>; 
</span><a name="LN1563"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>cascade_parents</span><span class='Delimiter'>; 
</span><a name="LN1564"></a>            <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Check extension name validity before trying to cascade. */ 
</span>            <a href="extension.c.html#LN253"><span class='Ref_to_Func'>check_valid_extension_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Check for cyclic dependency between extensions. */ 
</span>            <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1564"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1551"><span class='Ref_to_Parameter'>parents</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1572"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pname</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1564"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1572"><span class='Ref_To_Local'>pname</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_RECURSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cyclic dependency detected between extensions \"%s\" and \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1548"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"installing required extension \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add current extension to list of parents to pass down. */ 
</span>            <a href="extension.c.html#LN1563"><span class='Ref_To_Local'>cascade_parents</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN268"><span class='Ref_to_Proto'>list_copy</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1551"><span class='Ref_to_Parameter'>parents</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="extension.c.html#LN1548"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Create the required extension.  We propagate the SCHEMA option 
             * if any, and CASCADE, but no other options. 
             */ 
</span>            <a href="extension.c.html#LN1562"><span class='Ref_To_Local'>addr</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1264"><span class='Ref_to_Func'>CreateExtensionInternal</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Delimiter'>, 
</span>                                           <a href="extension.c.html#LN1549"><span class='Ref_to_Parameter'>origSchemaName</span></a><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                           <a href="extension.c.html#LN1550"><span class='Ref_to_Parameter'>cascade</span></a><span class='Delimiter'>, 
</span>                                           <a href="extension.c.html#LN1563"><span class='Ref_To_Local'>cascade_parents</span></a><span class='Delimiter'>, 
</span>                                           <a href="extension.c.html#LN1552"><span class='Ref_to_Parameter'>is_create</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get its newly-assigned OID. */ 
</span>            <a href="extension.c.html#LN1554"><span class='Ref_To_Local'>reqExtensionOid</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1562"><span class='Ref_To_Local'>addr</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cascade &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"required extension \"%s\" is not installed"</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN1547"><span class='Ref_to_Parameter'>reqExtensionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="extension.c.html#LN1552"><span class='Ref_to_Parameter'>is_create</span></a> <span class='Operator'>? 
</span>                     <a href="../utils/error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use CREATE EXTENSION ... CASCADE to install required extensions too."</span><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !OidIsValid(reqExtens... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="extension.c.html#LN1554"><span class='Ref_To_Local'>reqExtensionOid</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_required_extension &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * CREATE EXTENSION 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1619"></a><span class='Declare_Function'>CreateExtension</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2140"><span class='Ref_to_Struct'>CreateExtensionStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1621"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>d_schema</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1622"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>d_new_version</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1623"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>d_old_version</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1624"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>d_cascade</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1625"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaName</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1626"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>versionName</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1627"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldVersionName</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1628"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>cascade</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1629"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check extension name validity before any filesystem access */ 
</span>    <a href="extension.c.html#LN253"><span class='Ref_to_Func'>check_valid_extension_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2143"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for duplicate extension name.  The unique index on 
     * pg_extension.extname would catch this anyway, and serves as a backstop 
     * in case of race conditions; but this is a friendlier error message, and 
     * besides we need a check to support IF NOT EXISTS. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/commands/extension.h.html#LN47"><span class='Ref_to_Proto'>get_extension_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2143"><span class='Ref_to_Member'>extname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2144"><span class='Ref_to_Member'>if_not_exists</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" already exists, skipping"</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2143"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/pg_basebackup/streamutil.c.html#LN30"><span class='Ref_to_Const'>ERRCODE_DUPLICATE_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" already exists"</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2143"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use global variables to track the extension being created, so we can 
     * create only one extension at the same time. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"nested CREATE EXTENSION is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deconstruct the statement option list */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1629"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2145"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1669"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1629"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"schema"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1621"><span class='Ref_To_Local'>d_schema</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1621"><span class='Ref_To_Local'>d_schema</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1625"><span class='Ref_To_Local'>schemaName</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1621"><span class='Ref_To_Local'>d_schema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"new_version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1622"><span class='Ref_To_Local'>d_new_version</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1622"><span class='Ref_To_Local'>d_new_version</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1626"><span class='Ref_To_Local'>versionName</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1622"><span class='Ref_To_Local'>d_new_version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"old_version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1623"><span class='Ref_To_Local'>d_old_version</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1623"><span class='Ref_To_Local'>d_old_version</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1627"><span class='Ref_To_Local'>oldVersionName</span></a> <span class='Operator'>= </span><a href="define.c.html#LN47"><span class='Ref_to_Func'>defGetString</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1623"><span class='Ref_To_Local'>d_old_version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"cascade"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1624"><span class='Ref_To_Local'>d_cascade</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1624"><span class='Ref_To_Local'>d_cascade</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN1628"><span class='Ref_To_Local'>cascade</span></a> <span class='Operator'>= </span><a href="define.c.html#LN109"><span class='Ref_to_Func'>defGetBoolean</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1624"><span class='Ref_To_Local'>d_cascade</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized option: %s"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN1669"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Call CreateExtensionInternal to do the real work. */ 
</span>    <span class='Control'>return</span> <a href="extension.c.html#LN1264"><span class='Ref_to_Func'>CreateExtensionInternal</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1619"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2143"><span class='Ref_to_Member'>extname</span></a><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1625"><span class='Ref_To_Local'>schemaName</span></a><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1626"><span class='Ref_To_Local'>versionName</span></a><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1627"><span class='Ref_To_Local'>oldVersionName</span></a><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN1628"><span class='Ref_To_Local'>cascade</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                   <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CreateExtension &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * InsertExtensionTuple 
 * 
 * Insert the new pg_extension row, and create extension's dependency entries. 
 * Return the OID assigned to the new row. 
 * 
 * This is exported for the benefit of pg_upgrade, which has to create a 
 * pg_extension entry (and the extension-level dependencies) without 
 * actually running the extension's script. 
 * 
 * extConfig and extCondition should be arrays or PointerGetDatum(NULL). 
 * We declare them as plain Datum to avoid needing array.h in extension.h. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN1739"></a><span class='Declare_Function'>InsertExtensionTuple</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extName</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>extOwner</span><span class='Delimiter'>, 
</span><a name="LN1740"></a>                     <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>schemaOid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>relocatable</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extVersion</span><span class='Delimiter'>, 
</span><a name="LN1741"></a>                     <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>extConfig</span><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>extCondition</span><span class='Delimiter'>, 
</span><a name="LN1742"></a>                     <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>requiredExtensions</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1744"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>extensionOid</span><span class='Delimiter'>; 
</span><a name="LN1745"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1746"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN1747"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN1748"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1749"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN1750"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>nsp</span><span class='Delimiter'>; 
</span><a name="LN1751"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build and insert the pg_extension tuple 
     */ 
</span>    <a href="extension.c.html#LN1745"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN1747"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1747"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_extension_extname</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>        <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1739"><span class='Ref_to_Parameter'>extName</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN59"><span class='Ref_to_Const'>Anum_pg_extension_extowner</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1739"><span class='Ref_to_Parameter'>extOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN60"><span class='Ref_to_Const'>Anum_pg_extension_extnamespace</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1740"><span class='Ref_to_Parameter'>schemaOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_extension_extrelocatable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1740"><span class='Ref_to_Parameter'>relocatable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN62"><span class='Ref_to_Const'>Anum_pg_extension_extversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1740"><span class='Ref_to_Parameter'>extVersion</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1741"><span class='Ref_to_Parameter'>extConfig</span></a> <span class='Operator'>== </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="extension.c.html#LN1747"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="extension.c.html#LN1741"><span class='Ref_to_Parameter'>extConfig</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1741"><span class='Ref_to_Parameter'>extCondition</span></a> <span class='Operator'>== </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="extension.c.html#LN1747"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="extension.c.html#LN1741"><span class='Ref_to_Parameter'>extCondition</span></a><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1748"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1745"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1746"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1747"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1744"><span class='Ref_To_Local'>extensionOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/indexing.h.html#LN32"><span class='Ref_to_Proto'>CatalogTupleInsert</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1745"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1748"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1748"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1745"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Record dependencies on owner, schema, and prerequisite extensions 
     */ 
</span>    <a href="../catalog/pg_shdepend.c.html#LN157"><span class='Ref_to_Func'>recordDependencyOnOwner</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1744"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1739"><span class='Ref_to_Parameter'>extOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1749"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1749"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1744"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1749"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1750"><span class='Ref_To_Local'>nsp</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1750"><span class='Ref_To_Local'>nsp</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1740"><span class='Ref_to_Parameter'>schemaOid</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1750"><span class='Ref_To_Local'>nsp</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN1749"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1750"><span class='Ref_To_Local'>nsp</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1751"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1742"><span class='Ref_to_Parameter'>requiredExtensions</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1802"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqext</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1751"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1803"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>otherext</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN1803"><span class='Ref_To_Local'>otherext</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1803"><span class='Ref_To_Local'>otherext</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1802"><span class='Ref_To_Local'>reqext</span></a><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN1803"><span class='Ref_To_Local'>otherext</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN1749"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1803"><span class='Ref_To_Local'>otherext</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Post creation hook for new extension */ 
</span>    <a href="../../include/catalog/objectaccess.h.html#LN144"><span class='Ref_to_Macro'>InvokeObjectPostCreateHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1744"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN1749"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InsertExtensionTuple &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Guts of extension deletion. 
 * 
 * All we need do here is remove the pg_extension tuple itself.  Everything 
 * else is taken care of by the dependency infrastructure. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1824"></a><span class='Declare_Function'>RemoveExtensionById</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>extId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1826"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN1827"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span><a name="LN1828"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1829"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>entry</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Disallow deletion of any extension that's currently open for insertion; 
     * else subsequent executions of recordDependencyOnCurrentExtension() 
     * could create dangling pg_depend records that refer to a no-longer-valid 
     * pg_extension OID.  This is needed not so much because we think people 
     * might write "DROP EXTENSION foo" in foo's own script files, as because 
     * errors in dependency management in extension script files could give 
     * rise to cases where an extension is dropped as a result of recursing 
     * from some contained object.  Because of that, we must test for the case 
     * here, not at some higher level of the DROP EXTENSION command. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1824"><span class='Ref_to_Parameter'>extId</span></a> <span class='Operator'>== </span><a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot drop extension \"%s\" because it is being modified"</span><span class='Delimiter'>, 
</span>                 <a href="../../include/commands/extension.h.html#LN48"><span class='Ref_to_Proto'>get_extension_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1824"><span class='Ref_to_Parameter'>extId</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1826"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN1829"><span class='Ref_To_Local'>entry</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1824"><span class='Ref_to_Parameter'>extId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1827"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1826"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN1829"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1828"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1827"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We assume that there can be at most one matching tuple */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1828"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/catalog/indexing.h.html#LN40"><span class='Ref_to_Proto'>CatalogTupleDelete</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1826"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1828"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1827"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1826"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RemoveExtensionById &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This function lists the available extensions (one row per primary control 
 * file in the control directory).  We parse each control file and report the 
 * interesting fields. 
 * 
 * The system view pg_available_extensions provides a user interface to this 
 * SRF, adding information about whether the extensions are installed in the 
 * current DB. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1878"></a><span class='Declare_Function'>pg_available_extensions</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1880"></a>    <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span><a name="LN1881"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1882"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupstore</span><span class='Delimiter'>; 
</span><a name="LN1883"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_query_ctx</span><span class='Delimiter'>; 
</span><a name="LN1884"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1885"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>location</span><span class='Delimiter'>; 
</span><a name="LN1886"></a>    <a href="../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dir</span><span class='Delimiter'>; 
</span><a name="LN1887"></a>    <span class='Control'>struct</span> <a href="../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not "</span> <span class='Operator'>\ 
</span>                        <span class='String'>"allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1881"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuplestore to hold the result rows */ 
</span>    <a href="extension.c.html#LN1883"><span class='Ref_To_Local'>per_query_ctx</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1884"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1883"><span class='Ref_To_Local'>per_query_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1882"><span class='Ref_To_Local'>tupstore</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1882"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1880"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1881"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1884"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1885"><span class='Ref_To_Local'>location</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN363"><span class='Ref_to_Func'>get_extension_control_directory</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1886"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1885"><span class='Ref_To_Local'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the control directory doesn't exist, we want to silently return an 
     * empty set.  Any other error will be reported by ReadDir. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1886"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* do nothing */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="extension.c.html#LN1887"><span class='Ref_To_Local'>de</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1886"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1885"><span class='Ref_To_Local'>location</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1930"></a>            <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN1931"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>extname</span><span class='Delimiter'>; 
</span><a name="LN1932"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN1933"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN347"><span class='Ref_to_Func'>is_extension_control_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1887"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* extract extension name from 'name.control' filename */ 
</span>            <a href="extension.c.html#LN1931"><span class='Ref_To_Local'>extname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1887"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span>strrchr<span class='Parentheses'>(</span><a href="extension.c.html#LN1931"><span class='Ref_To_Local'>extname</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ignore it if it's an auxiliary control file */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="extension.c.html#LN1931"><span class='Ref_To_Local'>extname</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN1930"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN600"><span class='Ref_to_Func'>read_extension_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1931"><span class='Ref_To_Local'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            memset<span class='Parentheses'>(</span><a href="extension.c.html#LN1932"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1932"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><a href="extension.c.html#LN1933"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1933"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* name */ 
</span>            <a href="extension.c.html#LN1932"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1930"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* default_version */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1930"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="extension.c.html#LN1933"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="extension.c.html#LN1932"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1930"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* comment */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1930"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="extension.c.html#LN1933"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="extension.c.html#LN1932"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1930"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1882"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1881"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1932"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1933"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (de=ReadDir(dir,locat... &raquo; </span> 
 
        <a href="../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1886"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* clean up and return the tuplestore */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN59"><span class='Ref_to_Macro'>tuplestore_donestoring</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1882"><span class='Ref_To_Local'>tupstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_available_extensions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This function lists the available extension versions (one row per 
 * extension installation script).  For each version, we parse the related 
 * control file(s) and report the interesting fields. 
 * 
 * The system view pg_available_extension_versions provides a user interface 
 * to this SRF, adding information about which versions are installed in the 
 * current DB. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1987"></a><span class='Declare_Function'>pg_available_extension_versions</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1989"></a>    <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span><a name="LN1990"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1991"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupstore</span><span class='Delimiter'>; 
</span><a name="LN1992"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_query_ctx</span><span class='Delimiter'>; 
</span><a name="LN1993"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1994"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>location</span><span class='Delimiter'>; 
</span><a name="LN1995"></a>    <a href="../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dir</span><span class='Delimiter'>; 
</span><a name="LN1996"></a>    <span class='Control'>struct</span> <a href="../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>de</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not "</span> <span class='Operator'>\ 
</span>                        <span class='String'>"allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN1990"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuplestore to hold the result rows */ 
</span>    <a href="extension.c.html#LN1992"><span class='Ref_To_Local'>per_query_ctx</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1993"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1992"><span class='Ref_To_Local'>per_query_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1991"><span class='Ref_To_Local'>tupstore</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1991"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1989"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1990"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1993"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN1994"><span class='Ref_To_Local'>location</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN363"><span class='Ref_to_Func'>get_extension_control_directory</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN1995"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1994"><span class='Ref_To_Local'>location</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the control directory doesn't exist, we want to silently return an 
     * empty set.  Any other error will be reported by ReadDir. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1995"><span class='Ref_To_Local'>dir</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* do nothing */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="extension.c.html#LN1996"><span class='Ref_To_Local'>de</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1995"><span class='Ref_To_Local'>dir</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1994"><span class='Ref_To_Local'>location</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2039"></a>            <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN2040"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>extname</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN347"><span class='Ref_to_Func'>is_extension_control_filename</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1996"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* extract extension name from 'name.control' filename */ 
</span>            <a href="extension.c.html#LN2040"><span class='Ref_To_Local'>extname</span></a> <span class='Operator'>= </span><a href="../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1996"><span class='Ref_To_Local'>de</span></a><span class='Operator'>-&GT;</span><a href="../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span>strrchr<span class='Parentheses'>(</span><a href="extension.c.html#LN2040"><span class='Ref_To_Local'>extname</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ignore it if it's an auxiliary control file */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="extension.c.html#LN2040"><span class='Ref_To_Local'>extname</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>))</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* read the control file */ 
</span>            <a href="extension.c.html#LN2039"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN600"><span class='Ref_to_Func'>read_extension_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2040"><span class='Ref_To_Local'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* scan extension's script directory for install scripts */ 
</span>            <a href="extension.c.html#LN112"><span class='Ref_to_Proto'>get_available_versions_for_extension</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2039"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1991"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN1990"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (de=ReadDir(dir,locat... &raquo; </span> 
 
        <a href="../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1995"><span class='Ref_To_Local'>dir</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* clean up and return the tuplestore */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN59"><span class='Ref_to_Macro'>tuplestore_donestoring</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN1991"><span class='Ref_To_Local'>tupstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_available_extension_versions &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inner loop for pg_available_extension_versions: 
 *      read versions of one extension, add rows to tupstore 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2074"></a><span class='Declare_Function'>get_available_versions_for_extension</span><span class='Parentheses'>(</span><a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcontrol</span><span class='Delimiter'>, 
</span><a name="LN2075"></a>                                     <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupstore</span><span class='Delimiter'>, 
</span><a name="LN2076"></a>                                     <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2078"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>evi_list</span><span class='Delimiter'>; 
</span><a name="LN2079"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the version update graph from the script directory */ 
</span>    <a href="extension.c.html#LN2078"><span class='Ref_To_Local'>evi_list</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1010"><span class='Ref_to_Func'>get_ext_ver_list</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2074"><span class='Ref_to_Parameter'>pcontrol</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* For each installable version ... */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2079"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2078"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2087"></a>        <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2079"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2088"></a>        <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN2089"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>7</span><span class='Delimiter'>]; 
</span><a name="LN2090"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>7</span><span class='Delimiter'>]; 
</span><a name="LN2091"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN2087"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fetch parameters for specific version (pcontrol is not changed) 
         */ 
</span>        <a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN628"><span class='Ref_to_Func'>read_extension_aux_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2074"><span class='Ref_to_Parameter'>pcontrol</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2087"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* name */ 
</span>        <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* version */ 
</span>        <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2087"><span class='Ref_To_Local'>evi</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* superuser */ 
</span>        <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN81"><span class='Ref_to_Member'>superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* relocatable */ 
</span>        <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* schema */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN79"><span class='Ref_to_Member'>schema</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* requires */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="extension.c.html#LN115"><span class='Ref_to_Proto'>convert_requires_to_datum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* comment */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>6</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>6</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN78"><span class='Ref_to_Member'>comment</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2075"><span class='Ref_to_Parameter'>tupstore</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2076"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find all non-directly-installable versions that would be installed 
         * starting from this version, and report them, inheriting the 
         * parameters that aren't changed in updates from this version. 
         */ 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2091"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2078"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2139"></a>            <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2091"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2140"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>best_path</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2139"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN93"><span class='Ref_to_Member'>installable</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN1209"><span class='Ref_to_Func'>find_install_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2078"><span class='Ref_To_Local'>evi_list</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2139"><span class='Ref_To_Local'>evi2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2140"><span class='Ref_To_Local'>best_path</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="extension.c.html#LN2087"><span class='Ref_To_Local'>evi</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Fetch parameters for this version (pcontrol is not changed) 
                 */ 
</span>                <a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN628"><span class='Ref_to_Func'>read_extension_aux_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2074"><span class='Ref_to_Parameter'>pcontrol</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2139"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* name stays the same */ 
</span>                <span class='Comment_Multi_Line'>/* version */ 
</span>                <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2139"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* superuser */ 
</span>                <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN81"><span class='Ref_to_Member'>superuser</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* relocatable */ 
</span>                <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* schema stays the same */ 
</span>                <span class='Comment_Multi_Line'>/* requires */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                    <a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="extension.c.html#LN115"><span class='Ref_to_Proto'>convert_requires_to_datum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2088"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* comment stays the same */ 
</span> 
                <a href="../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2075"><span class='Ref_to_Parameter'>tupstore</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2076"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2089"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2090"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if find_install_path(evi... &raquo; </span> 
        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_available_versions_for_extension &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a list of extension names to a name[] Datum 
 */ 
</span><span class='Keyword'>static </span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2179"></a><span class='Declare_Function'>convert_requires_to_datum</span><span class='Parentheses'>(</span><a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>requires</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2181"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>datums</span><span class='Delimiter'>; 
</span><a name="LN2182"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums</span><span class='Delimiter'>; 
</span><a name="LN2183"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>a</span><span class='Delimiter'>; 
</span><a name="LN2184"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2182"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2179"><span class='Ref_to_Parameter'>requires</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2181"><span class='Ref_To_Local'>datums</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2182"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2182"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2184"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2179"><span class='Ref_to_Parameter'>requires</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2191"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curreq</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2184"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2181"><span class='Ref_To_Local'>datums</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2182"><span class='Ref_To_Local'>ndatums</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../utils/adt/name.c.html#LN44"><span class='Ref_to_Func'>namein</span></a><span class='Delimiter'>, </span><a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2191"><span class='Ref_To_Local'>curreq</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="extension.c.html#LN2183"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2181"><span class='Ref_To_Local'>datums</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2182"><span class='Ref_To_Local'>ndatums</span></a><span class='Delimiter'>, 
</span>                        <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Delimiter'>, 
</span>                        <a href="../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2183"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convert_requires_to_datum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This function reports the version update paths that exist for the 
 * specified extension. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2207"></a><span class='Declare_Function'>pg_extension_update_paths</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2209"></a>    <a href="../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>extname</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2210"></a>    <a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>resultinfo<span class='Delimiter'>; 
</span><a name="LN2211"></a>    <a href="../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2212"></a>    <a href="../utils/sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tupstore</span><span class='Delimiter'>; 
</span><a name="LN2213"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>per_query_ctx</span><span class='Delimiter'>; 
</span><a name="LN2214"></a>    <a href="../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2215"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>evi_list</span><span class='Delimiter'>; 
</span><a name="LN2216"></a>    <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN2217"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check extension name validity before any filesystem access */ 
</span>    <a href="extension.c.html#LN253"><span class='Ref_to_Func'>check_valid_extension_name</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="extension.c.html#LN2209"><span class='Ref_To_Local'>extname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check to see if caller supports us returning a tuplestore */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| !</span><a href="../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a><span class='Delimiter'>, </span><a href="../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"materialize mode required, but it is not "</span> <span class='Operator'>\ 
</span>                        <span class='String'>"allowed in this context"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a tuple descriptor for our result type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2211"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"return type must be a row type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build tuplestore to hold the result rows */ 
</span>    <a href="extension.c.html#LN2213"><span class='Ref_To_Local'>per_query_ctx</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2214"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2213"><span class='Ref_To_Local'>per_query_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2212"><span class='Ref_To_Local'>tupstore</span></a> <span class='Operator'>= </span><a href="../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../utils/init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2212"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2210"><span class='Ref_To_Local'>rsinfo</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2211"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2214"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Read the extension's control file */ 
</span>    <a href="extension.c.html#LN2216"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN600"><span class='Ref_to_Func'>read_extension_control_file</span></a><span class='Parentheses'>(</span><a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="extension.c.html#LN2209"><span class='Ref_To_Local'>extname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the version update graph from the script directory */ 
</span>    <a href="extension.c.html#LN2215"><span class='Ref_To_Local'>evi_list</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1010"><span class='Ref_to_Func'>get_ext_ver_list</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2216"><span class='Ref_To_Local'>control</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Iterate over all pairs of versions */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2217"><span class='Ref_To_Local'>lc1</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2215"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2257"></a>        <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2217"><span class='Ref_To_Local'>lc1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2258"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc2</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2258"><span class='Ref_To_Local'>lc2</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2215"><span class='Ref_To_Local'>evi_list</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2262"></a>            <a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>evi2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="extension.c.html#LN89"><span class='Ref_to_Struct'>ExtensionVersionInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2258"><span class='Ref_To_Local'>lc2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2263"></a>            <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span><a name="LN2264"></a>            <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN2265"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2257"><span class='Ref_To_Local'>evi1</span></a> <span class='Operator'>== </span><a href="extension.c.html#LN2262"><span class='Ref_To_Local'>evi2</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Find shortest path from evi1 to evi2 */ 
</span>            <a href="extension.c.html#LN2263"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN101"><span class='Ref_to_Proto'>find_update_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2215"><span class='Ref_To_Local'>evi_list</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2257"><span class='Ref_To_Local'>evi1</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2262"><span class='Ref_To_Local'>evi2</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Emit result row */ 
</span>            memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2264"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2264"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2265"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2265"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* source */ 
</span>            <a href="extension.c.html#LN2264"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2257"><span class='Ref_To_Local'>evi1</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* target */ 
</span>            <a href="extension.c.html#LN2264"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2262"><span class='Ref_To_Local'>evi2</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* path */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2263"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>== </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>                <a href="extension.c.html#LN2265"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2286"></a>                <a href="../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>pathbuf</span><span class='Delimiter'>; 
</span><a name="LN2287"></a>                <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcv</span><span class='Delimiter'>; 
</span> 
                <a href="../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2286"><span class='Ref_To_Local'>pathbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* The path doesn't include start vertex, but show it */ 
</span>                <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2286"><span class='Ref_To_Local'>pathbuf</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2257"><span class='Ref_To_Local'>evi1</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN91"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2287"><span class='Ref_To_Local'>lcv</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2263"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2294"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>versionName</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2287"><span class='Ref_To_Local'>lcv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2286"><span class='Ref_To_Local'>pathbuf</span></a><span class='Delimiter'>, </span><span class='String'>"--"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2286"><span class='Ref_To_Local'>pathbuf</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2294"><span class='Ref_To_Local'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="extension.c.html#LN2264"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2286"><span class='Ref_To_Local'>pathbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2286"><span class='Ref_To_Local'>pathbuf</span></a><span class='Operator'>.</span><a href="../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../include/utils/tuplestore.h.html#LN55"><span class='Ref_to_Proto'>tuplestore_putvalues</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2212"><span class='Ref_To_Local'>tupstore</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2211"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2264"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2265"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* clean up and return the tuplestore */ 
</span>    <a href="../../include/utils/tuplestore.h.html#LN59"><span class='Ref_to_Macro'>tuplestore_donestoring</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2212"><span class='Ref_To_Local'>tupstore</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_extension_update_paths &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_extension_config_dump 
 * 
 * Record information about a configuration table that belongs to an 
 * extension being created, but whose contents should be dumped in whole 
 * or in part during pg_dump. 
 */ 
</span><a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2321"></a><span class='Declare_Function'>pg_extension_config_dump</span><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2323"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tableoid</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2324"></a>    <a href="../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>wherecond</span> <span class='Operator'>= </span><a href="../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2325"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tablename</span><span class='Delimiter'>; 
</span><a name="LN2326"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>extRel</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2328"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>extScan</span><span class='Delimiter'>; 
</span><a name="LN2329"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>extTup</span><span class='Delimiter'>; 
</span><a name="LN2330"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arrayDatum</span><span class='Delimiter'>; 
</span><a name="LN2331"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elementDatum</span><span class='Delimiter'>; 
</span><a name="LN2332"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>arrayLength</span><span class='Delimiter'>; 
</span><a name="LN2333"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>arrayIndex</span><span class='Delimiter'>; 
</span><a name="LN2334"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2335"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN2336"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN2337"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN2338"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>a</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We only allow this to be called from an extension's SQL script. We 
     * shouldn't need any permissions check beyond that. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"pg_extension_config_dump() can only be called "</span> 
                        <span class='String'>"from an SQL script executed by CREATE EXTENSION"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that the table exists and is a member of the extension being 
     * created.  This ensures that we don't need to register an additional 
     * dependency to protect the extconfig entry. 
     */ 
</span>    <a href="extension.c.html#LN2325"><span class='Ref_To_Local'>tablename</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2323"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2325"><span class='Ref_To_Local'>tablename</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="../../bin/scripts/vacuumdb.c.html#LN25"><span class='Ref_to_Const'>ERRCODE_UNDEFINED_TABLE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"OID %u does not refer to a table"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2323"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN238"><span class='Ref_to_Proto'>getExtensionOfObject</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2323"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>) </span><span class='Operator'>!= 
</span>        <a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"table \"%s\" is not a member of the extension being created"</span><span class='Delimiter'>, 
</span>               <a href="extension.c.html#LN2325"><span class='Ref_To_Local'>tablename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add the table OID and WHERE condition to the extension's extconfig and 
     * extcondition arrays. 
     * 
     * If the table is already in extconfig, treat this as an update of the 
     * WHERE condition. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Find the pg_extension tuple */ 
</span>    <a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2327"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2328"><span class='Ref_To_Local'>extScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2327"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2328"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>))</span>      <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for extension %u"</span><span class='Delimiter'>, 
</span>             <a href="extension.c.html#LN67"><span class='Ref_to_Global_Var'>CurrentExtensionObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2335"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2335"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2336"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2336"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2337"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2337"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build or modify the extconfig value */ 
</span>    <a href="extension.c.html#LN2331"><span class='Ref_To_Local'>elementDatum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2323"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2330"><span class='Ref_To_Local'>arrayDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2334"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2334"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Previously empty extconfig, so build 1-element array */ 
</span>        <a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2333"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2331"><span class='Ref_To_Local'>elementDatum</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                            <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, 
</span>                            <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Modify or extend existing extconfig array */ 
</span><a name="LN2414"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>arrayData</span><span class='Delimiter'>; 
</span><a name="LN2415"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2330"><span class='Ref_To_Local'>arrayDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extconfig is not a 1-D Oid array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2414"><span class='Ref_To_Local'>arrayData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2333"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* set up to add after end */ 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2415"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="extension.c.html#LN2415"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN2415"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2414"><span class='Ref_To_Local'>arrayData</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2415"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="extension.c.html#LN2323"><span class='Ref_To_Local'>tableoid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="extension.c.html#LN2333"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2415"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* replace this element instead */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN358"><span class='Ref_to_Proto'>array_set</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2333"><span class='Ref_To_Local'>arrayIndex</span></a><span class='Delimiter'>, 
</span>                      <a href="extension.c.html#LN2331"><span class='Ref_To_Local'>elementDatum</span></a><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>-</span><span class='Number'>1</span> <span class='Comment_Multi_Line'>/* varlena array */ </span><span class='Delimiter'>, 
</span>                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Comment_Multi_Line'>/* OID's typlen */ </span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>true </span><span class='Comment_Multi_Line'>/* OID's typbyval */ </span><span class='Delimiter'>, 
</span>                      <span class='String'>'i'</span> <span class='Comment_Multi_Line'>/* OID's typalign */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="extension.c.html#LN2335"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2337"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build or modify the extcondition value */ 
</span>    <a href="extension.c.html#LN2331"><span class='Ref_To_Local'>elementDatum</span></a> <span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2324"><span class='Ref_To_Local'>wherecond</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2330"><span class='Ref_To_Local'>arrayDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2334"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2334"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extconfig and extcondition arrays do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2331"><span class='Ref_To_Local'>elementDatum</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                            <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                            <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2330"><span class='Ref_To_Local'>arrayDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extcondition is not a 1-D text array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="extension.c.html#LN2332"><span class='Ref_To_Local'>arrayLength</span></a><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extconfig and extcondition arrays do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add or replace at same index as in extconfig */ 
</span>        <a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN358"><span class='Ref_to_Proto'>array_set</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2333"><span class='Ref_To_Local'>arrayIndex</span></a><span class='Delimiter'>, 
</span>                      <a href="extension.c.html#LN2331"><span class='Ref_To_Local'>elementDatum</span></a><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>-</span><span class='Number'>1</span> <span class='Comment_Multi_Line'>/* varlena array */ </span><span class='Delimiter'>, 
</span>                      <span class='Operator'>-</span><span class='Number'>1</span> <span class='Comment_Multi_Line'>/* TEXT's typlen */ </span><span class='Delimiter'>, 
</span>                      <span class='Boolean'>false </span><span class='Comment_Multi_Line'>/* TEXT's typbyval */ </span><span class='Delimiter'>, 
</span>                      <span class='String'>'i'</span> <span class='Comment_Multi_Line'>/* TEXT's typalign */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="extension.c.html#LN2335"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2338"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2337"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="extension.c.html#LN2335"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2336"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2337"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2329"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2328"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2326"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_extension_config_dump &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * extension_config_remove 
 * 
 * Remove the specified table OID from extension's extconfig, if present. 
 * This is not currently exposed as a function, but it could be; 
 * for now, we just invoke it from ALTER EXTENSION DROP. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2508"></a><span class='Declare_Function'>extension_config_remove</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>extensionoid</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tableoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2510"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>extRel</span><span class='Delimiter'>; 
</span><a name="LN2511"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2512"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>extScan</span><span class='Delimiter'>; 
</span><a name="LN2513"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>extTup</span><span class='Delimiter'>; 
</span><a name="LN2514"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arrayDatum</span><span class='Delimiter'>; 
</span><a name="LN2515"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>arrayLength</span><span class='Delimiter'>; 
</span><a name="LN2516"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>arrayIndex</span><span class='Delimiter'>; 
</span><a name="LN2517"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2518"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>repl_val</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN2519"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_null</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN2520"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl_repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN2521"></a>    <a href="../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>a</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the pg_extension tuple */ 
</span>    <a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2511"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2508"><span class='Ref_to_Parameter'>extensionoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2512"><span class='Ref_To_Local'>extScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2511"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2512"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>))</span>      <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for extension %u"</span><span class='Delimiter'>, 
</span>             <a href="extension.c.html#LN2508"><span class='Ref_to_Parameter'>extensionoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Search extconfig for the tableoid */ 
</span>    <a href="extension.c.html#LN2514"><span class='Ref_To_Local'>arrayDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2517"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2517"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* nothing to do */ 
</span>        <a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2516"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2552"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>arrayData</span><span class='Delimiter'>; 
</span><a name="LN2553"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2514"><span class='Ref_To_Local'>arrayDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extconfig is not a 1-D Oid array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2552"><span class='Ref_To_Local'>arrayData</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2516"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* flag for no deletion needed */ 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2553"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="extension.c.html#LN2553"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN2553"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2552"><span class='Ref_To_Local'>arrayData</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2553"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="extension.c.html#LN2508"><span class='Ref_to_Parameter'>tableoid</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="extension.c.html#LN2516"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2553"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* index to remove */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* If tableoid is not in extconfig, nothing to do */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2516"><span class='Ref_To_Local'>arrayIndex</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2512"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Modify or delete the extconfig value */ 
</span>    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2518"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2518"><span class='Ref_To_Local'>repl_val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2519"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2519"><span class='Ref_To_Local'>repl_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="extension.c.html#LN2520"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN2520"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* removing only element, just set array to null */ 
</span>        <a href="extension.c.html#LN2519"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* squeeze out the target element */ 
</span><a name="LN2599"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN2600"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span><a name="LN2601"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN2602"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="extension.c.html#LN2599"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2600"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2601"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We already checked there are no nulls, so ignore dnulls */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2602"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2516"><span class='Ref_To_Local'>arrayIndex</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN2602"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="extension.c.html#LN2602"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2599"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2602"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="extension.c.html#LN2599"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2602"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2599"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                            <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2518"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="extension.c.html#LN2520"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN63"><span class='Ref_to_Const'>Anum_pg_extension_extconfig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Modify or delete the extcondition value */ 
</span>    <a href="extension.c.html#LN2514"><span class='Ref_To_Local'>arrayDatum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a><span class='Delimiter'>, 
</span>                              <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2517"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2517"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extconfig and extcondition arrays do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2514"><span class='Ref_To_Local'>arrayDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN276"><span class='Ref_to_Macro'>ARR_LBOUND</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>            <a href="../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extcondition is not a 1-D text array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extconfig and extcondition arrays do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* removing only element, just set array to null */ 
</span>        <a href="extension.c.html#LN2519"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* squeeze out the target element */ 
</span><a name="LN2646"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dvalues</span><span class='Delimiter'>; 
</span><a name="LN2647"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>dnulls</span><span class='Delimiter'>; 
</span><a name="LN2648"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nelems</span><span class='Delimiter'>; 
</span><a name="LN2649"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="extension.c.html#LN2646"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2647"><span class='Ref_To_Local'>dnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2648"><span class='Ref_To_Local'>nelems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We already checked there are no nulls, so ignore dnulls */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2649"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2516"><span class='Ref_To_Local'>arrayIndex</span></a><span class='Delimiter'>; </span><a href="extension.c.html#LN2649"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="extension.c.html#LN2649"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2646"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2649"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="extension.c.html#LN2646"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>[</span><a href="extension.c.html#LN2649"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
        <a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>= </span><a href="../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2646"><span class='Ref_To_Local'>dvalues</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2515"><span class='Ref_To_Local'>arrayLength</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                            <a href="../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2518"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2521"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <a href="extension.c.html#LN2520"><span class='Ref_To_Local'>repl_repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN64"><span class='Ref_to_Const'>Anum_pg_extension_extcondition</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="extension.c.html#LN2518"><span class='Ref_To_Local'>repl_val</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2519"><span class='Ref_To_Local'>repl_null</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2520"><span class='Ref_To_Local'>repl_repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2513"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2512"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2510"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end extension_config_remove &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER EXTENSION SET SCHEMA 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2679"></a><span class='Declare_Function'>AlterExtensionNamespace</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>extensionName</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>newschema</span><span class='Delimiter'>, </span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>oldschema</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2681"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>extensionOid</span><span class='Delimiter'>; 
</span><a name="LN2682"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspOid</span><span class='Delimiter'>; 
</span><a name="LN2683"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldNspOid</span> <span class='Operator'>= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN2684"></a>    <a href="../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span><a name="LN2685"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>extRel</span><span class='Delimiter'>; 
</span><a name="LN2686"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN2687"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>extScan</span><span class='Delimiter'>; 
</span><a name="LN2688"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>extTup</span><span class='Delimiter'>; 
</span><a name="LN2689"></a>    <a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a> <span class='Declare_Local'>extForm</span><span class='Delimiter'>; 
</span><a name="LN2690"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>depRel</span><span class='Delimiter'>; 
</span><a name="LN2691"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>depScan</span><span class='Delimiter'>; 
</span><a name="LN2692"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>depTup</span><span class='Delimiter'>; 
</span><a name="LN2693"></a>    <a href="../catalog/dependency.c.html#LN108"><span class='Ref_to_Struct'>ObjectAddresses</span></a> <span class='Operator'>*</span><span class='Declare_Local'>objsMoved</span><span class='Delimiter'>; 
</span><a name="LN2694"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>extAddr</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/extension.h.html#LN47"><span class='Ref_to_Proto'>get_extension_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a> <span class='Operator'>= </span><a href="../../include/catalog/namespace.h.html#LN116"><span class='Ref_to_Proto'>LookupCreationNamespace</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>newschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Permission check: must own extension.  Note that we don't bother to 
     * check ownership of the individual member objects ... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN326"><span class='Ref_to_Proto'>pg_extension_ownercheck</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN201"><span class='Ref_to_EnumConst'>ACL_KIND_EXTENSION</span></a><span class='Delimiter'>, 
</span>                       <a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permission check: must have creation rights in target namespace */ 
</span>    <a href="extension.c.html#LN2684"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../include/utils/acl.h.html#LN289"><span class='Ref_to_Proto'>pg_namespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2684"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2684"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN189"><span class='Ref_to_EnumConst'>ACL_KIND_NAMESPACE</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>newschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the schema is currently a member of the extension, disallow moving 
     * the extension into the schema.  That would create a dependency loop. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN238"><span class='Ref_to_Proto'>getExtensionOfObject</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot move extension \"%s\" into schema \"%s\" "</span> 
                        <span class='String'>"because the extension contains the schema"</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>extensionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>newschema</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Locate the pg_extension tuple */ 
</span>    <a href="extension.c.html#LN2685"><span class='Ref_To_Local'>extRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2686"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2687"><span class='Ref_To_Local'>extScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2685"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2686"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2687"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>))</span>      <span class='Comment_Single_Line'>/* should not happen */ 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for extension %u"</span><span class='Delimiter'>, 
</span>             <a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy tuple so we can modify it below */ 
</span>    <a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN606"><span class='Ref_to_Func'>heap_copytuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2689"><span class='Ref_To_Local'>extForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2687"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the extension is already in the target schema, just silently do 
     * nothing. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2689"><span class='Ref_To_Local'>extForm</span></a><span class='Operator'>-&GT;</span>extnamespace <span class='Operator'>== </span><a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2685"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Check extension is supposed to be relocatable */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="extension.c.html#LN2689"><span class='Ref_To_Local'>extForm</span></a><span class='Operator'>-&GT;</span>extrelocatable<span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" does not support SET SCHEMA"</span><span class='Delimiter'>, 
</span>                        <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2689"><span class='Ref_To_Local'>extForm</span></a><span class='Operator'>-&GT;</span>extname<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2693"><span class='Ref_To_Local'>objsMoved</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN200"><span class='Ref_to_Proto'>new_object_addresses</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Scan pg_depend to find objects that depend directly on the extension, 
     * and alter each one's schema. 
     */ 
</span>    <a href="extension.c.html#LN2690"><span class='Ref_To_Local'>depRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN28"><span class='Ref_to_Const'>DependRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2686"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN70"><span class='Ref_to_Const'>Anum_pg_depend_refclassid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2686"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_depend.h.html#LN71"><span class='Ref_to_Const'>Anum_pg_depend_refobjid</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2691"><span class='Ref_To_Local'>depScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2690"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN146"><span class='Ref_to_Const'>DependReferenceIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2686"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2692"><span class='Ref_To_Local'>depTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2691"><span class='Ref_To_Local'>depScan</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2786"></a>        <a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a> <span class='Declare_Local'>pg_depend</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_depend.h.html#LN60"><span class='Ref_to_Typedef'>Form_pg_depend</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2692"><span class='Ref_To_Local'>depTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2787"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>dep</span><span class='Delimiter'>; 
</span><a name="LN2788"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>dep_oldNspOid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore non-membership dependencies.  (Currently, the only other 
         * case we could see here is a normal dependency from another 
         * extension.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2786"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>deptype <span class='Operator'>!= </span><a href="../../include/catalog/dependency.h.html#LN77"><span class='Ref_to_EnumConst'>DEPENDENCY_EXTENSION</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2786"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>classid<span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2786"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objid<span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2786"><span class='Ref_To_Local'>pg_depend</span></a><span class='Operator'>-&GT;</span>objsubid<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* should not happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extension should not have a sub-object dependency"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Relocate the object */ 
</span>        <a href="extension.c.html#LN2788"><span class='Ref_To_Local'>dep_oldNspOid</span></a> <span class='Operator'>= </span><a href="../../include/commands/alter.h.html#LN27"><span class='Ref_to_Proto'>AlterObjectNamespace_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, 
</span>                                                 <a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, 
</span>                                                 <a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a><span class='Delimiter'>, 
</span>                                                 <a href="extension.c.html#LN2693"><span class='Ref_To_Local'>objsMoved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remember previous namespace of first object that has one 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2683"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>== </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& </span><a href="extension.c.html#LN2788"><span class='Ref_To_Local'>dep_oldNspOid</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2683"><span class='Ref_To_Local'>oldNspOid</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2788"><span class='Ref_To_Local'>dep_oldNspOid</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If not all the objects had the same old namespace (ignoring any 
         * that are not in namespaces), complain. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2788"><span class='Ref_To_Local'>dep_oldNspOid</span></a> <span class='Operator'>!= </span><a href="../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a> <span class='Operator'>&& </span><a href="extension.c.html#LN2788"><span class='Ref_To_Local'>dep_oldNspOid</span></a> <span class='Operator'>!= </span><a href="extension.c.html#LN2683"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" does not support SET SCHEMA"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2689"><span class='Ref_To_Local'>extForm</span></a><span class='Operator'>-&GT;</span>extname<span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not in the extension's schema \"%s\""</span><span class='Delimiter'>, 
</span>                               <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2787"><span class='Ref_To_Local'>dep</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2683"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(depT... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* report old schema, if caller wants it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>oldschema</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="extension.c.html#LN2679"><span class='Ref_to_Parameter'>oldschema</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2683"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2691"><span class='Ref_To_Local'>depScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2690"><span class='Ref_To_Local'>depRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now adjust pg_extension.extnamespace */ 
</span>    <a href="extension.c.html#LN2689"><span class='Ref_To_Local'>extForm</span></a><span class='Operator'>-&GT;</span>extnamespace <span class='Operator'>= </span><a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2685"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2688"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2685"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* update dependencies to point to the new schema */ 
</span>    <a href="../../include/catalog/dependency.h.html#LN234"><span class='Ref_to_Proto'>changeDependencyFor</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, 
</span>                        <a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2683"><span class='Ref_To_Local'>oldNspOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2682"><span class='Ref_To_Local'>nspOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2694"><span class='Ref_To_Local'>extAddr</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2681"><span class='Ref_To_Local'>extensionOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN2694"><span class='Ref_To_Local'>extAddr</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AlterExtensionNamespace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER EXTENSION UPDATE 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN2861"></a><span class='Declare_Function'>ExecAlterExtensionStmt</span><span class='Parentheses'>(</span><a href="../../include/parser/parse_node.h.html#LN164"><span class='Ref_to_Struct'>ParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../include/nodes/parsenodes.h.html#LN2149"><span class='Ref_to_Struct'>AlterExtensionStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2863"></a>    <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>d_new_version</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2864"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>versionName</span><span class='Delimiter'>; 
</span><a name="LN2865"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>oldVersionName</span><span class='Delimiter'>; 
</span><a name="LN2866"></a>    <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN2867"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>extensionOid</span><span class='Delimiter'>; 
</span><a name="LN2868"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>extRel</span><span class='Delimiter'>; 
</span><a name="LN2869"></a>    <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2870"></a>    <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>extScan</span><span class='Delimiter'>; 
</span><a name="LN2871"></a>    <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>extTup</span><span class='Delimiter'>; 
</span><a name="LN2872"></a>    <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>updateVersions</span><span class='Delimiter'>; 
</span><a name="LN2873"></a>    <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN2874"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2875"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN2876"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>address</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use global variables to track the extension being created, so we can 
     * create/update only one extension at the same time. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN66"><span class='Ref_to_Global_Var'>creating_extension</span></a><span class='Parentheses'>) 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"nested ALTER EXTENSION is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the extension --- it must already exist in pg_extension 
     */ 
</span>    <a href="extension.c.html#LN2868"><span class='Ref_To_Local'>extRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN2869"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                <a href="../../include/catalog/pg_extension.h.html#LN58"><span class='Ref_to_Const'>Anum_pg_extension_extname</span></a><span class='Delimiter'>, 
</span>                <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_NAMEEQ<span class='Delimiter'>, 
</span>                <a href="../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2152"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2870"><span class='Ref_To_Local'>extScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2868"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN320"><span class='Ref_to_Const'>ExtensionNameIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2869"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2871"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2870"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2871"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_OBJECT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"extension \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2152"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN2867"><span class='Ref_To_Local'>extensionOid</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2871"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the existing version we are updating from 
     */ 
</span>    <a href="extension.c.html#LN2873"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2871"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN62"><span class='Ref_to_Const'>Anum_pg_extension_extversion</span></a><span class='Delimiter'>, 
</span>                         <a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2868"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN2874"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2874"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"extversion is null"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN2865"><span class='Ref_To_Local'>oldVersionName</span></a> <span class='Operator'>= </span><a href="../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2873"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2870"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2868"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permission check: must own extension */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN326"><span class='Ref_to_Proto'>pg_extension_ownercheck</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2867"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN201"><span class='Ref_to_EnumConst'>ACL_KIND_EXTENSION</span></a><span class='Delimiter'>, 
</span>                       <a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2152"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the primary control file.  Note we assume that it does not contain 
     * any non-ASCII data, so there is no need to worry about encoding at this 
     * point. 
     */ 
</span>    <a href="extension.c.html#LN2866"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN600"><span class='Ref_to_Func'>read_extension_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2152"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the statement option list 
     */ 
</span>    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2875"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2153"><span class='Ref_to_Member'>options</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2940"></a>        <a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>defel</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN715"><span class='Ref_to_Struct'>DefElem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2875"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN2940"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Delimiter'>, </span><span class='String'>"new_version"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2863"><span class='Ref_To_Local'>d_new_version</span></a><span class='Parentheses'>) 
</span>                <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"conflicting or redundant options"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../../pl/plpgsql/src/pl_gram.y.html#LN55"><span class='Ref_to_Macro'>parser_errposition</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2940"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN722"><span class='Ref_to_Member'>location</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN2863"><span class='Ref_To_Local'>d_new_version</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2940"><span class='Ref_To_Local'>defel</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized option: %s"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN2940"><span class='Ref_To_Local'>defel</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN719"><span class='Ref_to_Member'>defname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the version to update to 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2863"><span class='Ref_To_Local'>d_new_version</span></a> <span class='Operator'>&& </span><a href="extension.c.html#LN2863"><span class='Ref_To_Local'>d_new_version</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>) 
</span>        <a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a> <span class='Operator'>= </span><a href="../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2863"><span class='Ref_To_Local'>d_new_version</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN720"><span class='Ref_to_Member'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN2866"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a><span class='Parentheses'>) 
</span>        <a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN2866"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN76"><span class='Ref_to_Member'>default_version</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"version to install must be specified"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span>    <a href="extension.c.html#LN300"><span class='Ref_to_Func'>check_valid_version_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're already at that version, just say so 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="extension.c.html#LN2865"><span class='Ref_To_Local'>oldVersionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>           <span class='Parentheses'>(</span><a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"version \"%s\" of extension \"%s\" is already installed"</span><span class='Delimiter'>, 
</span>                   <a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2861"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2152"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../catalog/objectaddress.c.html#LN718"><span class='Ref_to_Global_Var'>InvalidObjectAddress</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Identify the series of update script files we need to execute 
     */ 
</span>    <a href="extension.c.html#LN2872"><span class='Ref_To_Local'>updateVersions</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN1073"><span class='Ref_to_Func'>identify_update_path</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2866"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>, 
</span>                                          <a href="extension.c.html#LN2865"><span class='Ref_To_Local'>oldVersionName</span></a><span class='Delimiter'>, 
</span>                                          <a href="extension.c.html#LN2864"><span class='Ref_To_Local'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update the pg_extension row and execute the update scripts, one at a 
     * time 
     */ 
</span>    <a href="extension.c.html#LN116"><span class='Ref_to_Proto'>ApplyExtensionUpdates</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2867"><span class='Ref_To_Local'>extensionOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2866"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>, 
</span>                          <a href="extension.c.html#LN2865"><span class='Ref_To_Local'>oldVersionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2872"><span class='Ref_To_Local'>updateVersions</span></a><span class='Delimiter'>, 
</span>                          <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/catalog/objectaddress.h.html#LN39"><span class='Ref_to_Macro'>ObjectAddressSet</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN2876"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN2867"><span class='Ref_To_Local'>extensionOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN2876"><span class='Ref_To_Local'>address</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecAlterExtensionStmt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Apply a series of update scripts as though individual ALTER EXTENSION 
 * UPDATE commands had been given, including altering the pg_extension row 
 * and dependencies each time. 
 * 
 * This might be more work than necessary, but it ensures that old update 
 * scripts don't break if newer versions have different control parameters. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3011"></a><span class='Declare_Function'>ApplyExtensionUpdates</span><span class='Parentheses'>(</span><a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>extensionOid</span><span class='Delimiter'>, 
</span><a name="LN3012"></a>                      <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pcontrol</span><span class='Delimiter'>, 
</span><a name="LN3013"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>initialVersion</span><span class='Delimiter'>, 
</span><a name="LN3014"></a>                      <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>updateVersions</span><span class='Delimiter'>, 
</span><a name="LN3015"></a>                      <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>origSchemaName</span><span class='Delimiter'>, 
</span><a name="LN3016"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>cascade</span><span class='Delimiter'>, 
</span><a name="LN3017"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>is_create</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3019"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>oldVersionName</span> <span class='Operator'>= </span><a href="extension.c.html#LN3013"><span class='Ref_to_Parameter'>initialVersion</span></a><span class='Delimiter'>; 
</span><a name="LN3020"></a>    <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lcv</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3020"><span class='Ref_To_Local'>lcv</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3014"><span class='Ref_to_Parameter'>updateVersions</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3024"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>versionName</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3020"><span class='Ref_To_Local'>lcv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3025"></a>        <a href="extension.c.html#LN72"><span class='Ref_to_Struct'>ExtensionControlFile</span></a> <span class='Operator'>*</span><span class='Declare_Local'>control</span><span class='Delimiter'>; 
</span><a name="LN3026"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaName</span><span class='Delimiter'>; 
</span><a name="LN3027"></a>        <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>schemaOid</span><span class='Delimiter'>; 
</span><a name="LN3028"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>requiredExtensions</span><span class='Delimiter'>; 
</span><a name="LN3029"></a>        <a href="../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>requiredSchemas</span><span class='Delimiter'>; 
</span><a name="LN3030"></a>        <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>extRel</span><span class='Delimiter'>; 
</span><a name="LN3031"></a>        <a href="../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>key</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN3032"></a>        <a href="../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>extScan</span><span class='Delimiter'>; 
</span><a name="LN3033"></a>        <a href="../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>extTup</span><span class='Delimiter'>; 
</span><a name="LN3034"></a>        <a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a> <span class='Declare_Local'>extForm</span><span class='Delimiter'>; 
</span><a name="LN3035"></a>        <a href="../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN3036"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN3037"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>repl</span><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN57"><span class='Ref_to_Const'>Natts_pg_extension</span></a><span class='Delimiter'>]; 
</span><a name="LN3038"></a>        <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>myself</span><span class='Delimiter'>; 
</span><a name="LN3039"></a>        <a href="../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fetch parameters for specific version (pcontrol is not changed) 
         */ 
</span>        <a href="extension.c.html#LN3025"><span class='Ref_To_Local'>control</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN628"><span class='Ref_to_Func'>read_extension_aux_control_file</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3012"><span class='Ref_to_Parameter'>pcontrol</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3024"><span class='Ref_To_Local'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find the pg_extension tuple */ 
</span>        <a href="extension.c.html#LN3030"><span class='Ref_To_Local'>extRel</span></a> <span class='Operator'>= </span><a href="../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../access/common/scankey.c.html#LN74"><span class='Ref_to_Func'>ScanKeyInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN3031"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                    <a href="../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Delimiter'>, 
</span>                    <a href="../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>, </span>F_OIDEQ<span class='Delimiter'>, 
</span>                    <a href="../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3011"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN3032"><span class='Ref_To_Local'>extScan</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3030"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/indexing.h.html#LN318"><span class='Ref_to_Const'>ExtensionOidIndexId</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                                     <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN3031"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3032"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>))</span>  <span class='Comment_Single_Line'>/* should not happen */ 
</span>            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not find tuple for extension %u"</span><span class='Delimiter'>, 
</span>                 <a href="extension.c.html#LN3011"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN3034"><span class='Ref_To_Local'>extForm</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN50"><span class='Ref_to_Typedef'>Form_pg_extension</span></a><span class='Parentheses'>) </span><a href="../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Determine the target schema (set by original install) 
         */ 
</span>        <a href="extension.c.html#LN3027"><span class='Ref_To_Local'>schemaOid</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN3034"><span class='Ref_To_Local'>extForm</span></a><span class='Operator'>-&GT;</span>extnamespace<span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3026"><span class='Ref_To_Local'>schemaName</span></a> <span class='Operator'>= </span><a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3027"><span class='Ref_To_Local'>schemaOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Modify extrelocatable and extversion in the pg_extension tuple 
         */ 
</span>        memset<span class='Parentheses'>(</span><a href="extension.c.html#LN3035"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN3035"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="extension.c.html#LN3036"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN3036"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><a href="extension.c.html#LN3037"><span class='Ref_To_Local'>repl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="extension.c.html#LN3037"><span class='Ref_To_Local'>repl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN3035"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_extension_extrelocatable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3025"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN80"><span class='Ref_to_Member'>relocatable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3037"><span class='Ref_To_Local'>repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN61"><span class='Ref_to_Const'>Anum_pg_extension_extrelocatable</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3035"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN62"><span class='Ref_to_Const'>Anum_pg_extension_extversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span>            <a href="../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3024"><span class='Ref_To_Local'>versionName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3037"><span class='Ref_To_Local'>repl</span></a><span class='Delimiter'>[</span><a href="../../include/catalog/pg_extension.h.html#LN62"><span class='Ref_to_Const'>Anum_pg_extension_extversion</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a> <span class='Operator'>= </span><a href="../access/common/heaptuple.c.html#LN789"><span class='Ref_to_Func'>heap_modify_tuple</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a><span class='Delimiter'>, </span><a href="../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3030"><span class='Ref_To_Local'>extRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="extension.c.html#LN3035"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3036"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3037"><span class='Ref_To_Local'>repl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/catalog/indexing.h.html#LN35"><span class='Ref_to_Proto'>CatalogTupleUpdate</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3030"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a><span class='Operator'>-&GT;</span><a href="../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3033"><span class='Ref_To_Local'>extTup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3032"><span class='Ref_To_Local'>extScan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3030"><span class='Ref_To_Local'>extRel</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN37"><span class='Ref_to_Const'>RowExclusiveLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Look up the prerequisite extensions for this version, install them 
         * if necessary, and build lists of their OIDs and the OIDs of their 
         * target schemas. 
         */ 
</span>        <a href="extension.c.html#LN3028"><span class='Ref_To_Local'>requiredExtensions</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3029"><span class='Ref_To_Local'>requiredSchemas</span></a> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3039"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3025"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN83"><span class='Ref_to_Member'>requires</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3103"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curreq</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3039"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3104"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqext</span><span class='Delimiter'>; 
</span><a name="LN3105"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqschema</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN3104"><span class='Ref_To_Local'>reqext</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN106"><span class='Ref_to_Proto'>get_required_extension</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3103"><span class='Ref_To_Local'>curreq</span></a><span class='Delimiter'>, 
</span>                                            <a href="extension.c.html#LN3025"><span class='Ref_To_Local'>control</span></a><span class='Operator'>-&GT;</span><a href="extension.c.html#LN74"><span class='Ref_to_Member'>name</span></a><span class='Delimiter'>, 
</span>                                            <a href="extension.c.html#LN3015"><span class='Ref_to_Parameter'>origSchemaName</span></a><span class='Delimiter'>, 
</span>                                            <a href="extension.c.html#LN3016"><span class='Ref_to_Parameter'>cascade</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>, 
</span>                                            <a href="extension.c.html#LN3017"><span class='Ref_to_Parameter'>is_create</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN3105"><span class='Ref_To_Local'>reqschema</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN216"><span class='Ref_to_Func'>get_extension_schema</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3104"><span class='Ref_To_Local'>reqext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN3028"><span class='Ref_To_Local'>requiredExtensions</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3028"><span class='Ref_To_Local'>requiredExtensions</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3104"><span class='Ref_To_Local'>reqext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN3029"><span class='Ref_To_Local'>requiredSchemas</span></a> <span class='Operator'>= </span><a href="../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3029"><span class='Ref_To_Local'>requiredSchemas</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3105"><span class='Ref_To_Local'>reqschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove and recreate dependencies on prerequisite extensions 
         */ 
</span>        <a href="../../include/catalog/dependency.h.html#LN231"><span class='Ref_to_Proto'>deleteDependencyRecordsForClass</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3011"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="extension.c.html#LN3038"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3038"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN3011"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Delimiter'>; 
</span>        <a href="extension.c.html#LN3038"><span class='Ref_To_Local'>myself</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3039"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3028"><span class='Ref_To_Local'>requiredExtensions</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3131"></a>            <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reqext</span> <span class='Operator'>= </span><a href="../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3039"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3132"></a>            <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>otherext</span><span class='Delimiter'>; 
</span> 
            <a href="extension.c.html#LN3132"><span class='Ref_To_Local'>otherext</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN3132"><span class='Ref_To_Local'>otherext</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN3131"><span class='Ref_To_Local'>reqext</span></a><span class='Delimiter'>; 
</span>            <a href="extension.c.html#LN3132"><span class='Ref_To_Local'>otherext</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN3038"><span class='Ref_To_Local'>myself</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN3132"><span class='Ref_To_Local'>otherext</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN74"><span class='Ref_to_EnumConst'>DEPENDENCY_NORMAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3011"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finally, execute the update script file 
         */ 
</span>        <a href="extension.c.html#LN783"><span class='Ref_to_Func'>execute_extension_script</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3011"><span class='Ref_to_Parameter'>extensionOid</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3025"><span class='Ref_To_Local'>control</span></a><span class='Delimiter'>, 
</span>                                 <a href="extension.c.html#LN3019"><span class='Ref_To_Local'>oldVersionName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3024"><span class='Ref_To_Local'>versionName</span></a><span class='Delimiter'>, 
</span>                                 <a href="extension.c.html#LN3029"><span class='Ref_To_Local'>requiredSchemas</span></a><span class='Delimiter'>, 
</span>                                 <a href="extension.c.html#LN3026"><span class='Ref_To_Local'>schemaName</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3027"><span class='Ref_To_Local'>schemaOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Update prior-version name and loop around.  Since 
         * execute_sql_string did a final CommandCounterIncrement, we can 
         * update the pg_extension row again. 
         */ 
</span>        <a href="extension.c.html#LN3019"><span class='Ref_To_Local'>oldVersionName</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN3024"><span class='Ref_To_Local'>versionName</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end ApplyExtensionUpdates &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute ALTER EXTENSION ADD/DROP 
 * 
 * Return value is the address of the altered extension. 
 * 
 * objAddr is an output argument which, if not NULL, is set to the address of 
 * the added/dropped object. 
 */ 
</span><a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> 
<a name="LN3169"></a><span class='Declare_Function'>ExecAlterExtensionContentsStmt</span><span class='Parentheses'>(</span><a href="../../include/nodes/parsenodes.h.html#LN2156"><span class='Ref_to_Struct'>AlterExtensionContentsStmt</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stmt</span><span class='Delimiter'>, 
</span><a name="LN3170"></a>                               <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>objAddr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3172"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>extension</span><span class='Delimiter'>; 
</span><a name="LN3173"></a>    <a href="../../include/catalog/objectaddress.h.html#LN23"><span class='Ref_to_Struct'>ObjectAddress</span></a> <span class='Declare_Local'>object</span><span class='Delimiter'>; 
</span><a name="LN3174"></a>    <a href="../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN3175"></a>    <a href="../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>oldExtension</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>= </span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>= </span><a href="../../include/commands/extension.h.html#LN47"><span class='Ref_to_Proto'>get_extension_oid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2159"><span class='Ref_to_Member'>extname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permission check: must own extension */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../include/utils/acl.h.html#LN326"><span class='Ref_to_Proto'>pg_extension_ownercheck</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()))</span> 
        <a href="../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="../../include/utils/acl.h.html#LN173"><span class='Ref_to_EnumConst'>ACLCHECK_NOT_OWNER</span></a><span class='Delimiter'>, </span><a href="../../include/utils/acl.h.html#LN201"><span class='Ref_to_EnumConst'>ACL_KIND_EXTENSION</span></a><span class='Delimiter'>, 
</span>                       <a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2159"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Translate the parser representation that identifies the object into an 
     * ObjectAddress.  get_object_address() will throw an error if the object 
     * does not exist, and will also acquire a lock on the object to guard 
     * against concurrent DROP and ALTER EXTENSION ADD/DROP operations. 
     */ 
</span>    <a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a> <span class='Operator'>= </span><a href="../../include/catalog/objectaddress.h.html#LN42"><span class='Ref_to_Proto'>get_object_address</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2161"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2162"><span class='Ref_to_Member'>object</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="extension.c.html#LN3174"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN38"><span class='Ref_to_Const'>ShareUpdateExclusiveLock</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN27"><span class='Ref_to_Member'>objectSubId</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3170"><span class='Ref_to_Parameter'>objAddr</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="extension.c.html#LN3170"><span class='Ref_to_Parameter'>objAddr</span></a> <span class='Operator'>= </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Permission check: must own target object, too */ 
</span>    <a href="../../include/catalog/objectaddress.h.html#LN50"><span class='Ref_to_Proto'>check_object_ownership</span></a><span class='Parentheses'>(</span><a href="../utils/init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2161"><span class='Ref_to_Member'>objtype</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, 
</span>                           <a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2162"><span class='Ref_to_Member'>object</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3174"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check existing extension membership. 
     */ 
</span>    <a href="extension.c.html#LN3175"><span class='Ref_To_Local'>oldExtension</span></a> <span class='Operator'>= </span><a href="../../include/catalog/dependency.h.html#LN238"><span class='Ref_to_Proto'>getExtensionOfObject</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2160"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * ADD, so complain if object is already attached to some extension. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3175"><span class='Ref_To_Local'>oldExtension</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is already a member of extension \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../../include/commands/extension.h.html#LN48"><span class='Ref_to_Proto'>get_extension_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3175"><span class='Ref_To_Local'>oldExtension</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Prevent a schema from being added to an extension if the schema 
         * contains the extension.  That would create a dependency loop. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_namespace.h.html#LN33"><span class='Ref_to_Const'>NamespaceRelationId</span></a> <span class='Operator'>&& 
</span>            <a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a> <span class='Operator'>== </span><a href="extension.c.html#LN216"><span class='Ref_to_Func'>get_extension_schema</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>))</span> 
            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot add schema \"%s\" to extension \"%s\" "</span> 
                            <span class='String'>"because the schema contains the extension"</span><span class='Delimiter'>, 
</span>                            <a href="../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2159"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * OK, add the dependency. 
         */ 
</span>        <a href="../catalog/pg_depend.c.html#LN42"><span class='Ref_to_Func'>recordDependencyOn</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Delimiter'>, </span><a href="../../include/catalog/dependency.h.html#LN77"><span class='Ref_to_EnumConst'>DEPENDENCY_EXTENSION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Also record the initial ACL on the object, if any. 
         * 
         * Note that this will handle the object's ACLs, as well as any ACLs 
         * on object subIds.  (In other words, when the object is a table, 
         * this will record the table's ACL and the ACLs for the columns on 
         * the table, if any). 
         */ 
</span>        <a href="../../include/utils/acl.h.html#LN303"><span class='Ref_to_Proto'>recordExtObjInitPriv</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if stmt-&GT;action&GT;0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * DROP, so complain if it's not a member. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3175"><span class='Ref_To_Local'>oldExtension</span></a> <span class='Operator'>!= </span><a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>) 
</span>            <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"%s is not a member of extension \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="../../include/catalog/objectaddress.h.html#LN70"><span class='Ref_to_Proto'>getObjectDescription</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="extension.c.html#LN3169"><span class='Ref_to_Parameter'>stmt</span></a><span class='Operator'>-&GT;</span><a href="../../include/nodes/parsenodes.h.html#LN2159"><span class='Ref_to_Member'>extname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * OK, drop the dependency. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/catalog/dependency.h.html#LN231"><span class='Ref_to_Proto'>deleteDependencyRecordsForClass</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../include/catalog/dependency.h.html#LN77"><span class='Ref_to_EnumConst'>DEPENDENCY_EXTENSION</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <a href="../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected number of extension dependency records"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's a relation, it might have an entry in the extension's 
         * extconfig array, which we must remove. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a> <span class='Operator'>== </span><a href="../../include/catalog/pg_class.h.html#LN28"><span class='Ref_to_Const'>RelationRelationId</span></a><span class='Parentheses'>) 
</span>            <a href="extension.c.html#LN2507"><span class='Ref_to_Func'>extension_config_remove</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Remove all the initial ACLs, if any. 
         * 
         * Note that this will remove the object's ACLs, as well as any ACLs 
         * on object subIds.  (In other words, when the object is a table, 
         * this will remove the table's ACL and the ACLs for the columns on 
         * the table, if any). 
         */ 
</span>        <a href="../../include/utils/acl.h.html#LN304"><span class='Ref_to_Proto'>removeExtObjInitPriv</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3173"><span class='Ref_To_Local'>object</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN25"><span class='Ref_to_Member'>classId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../include/catalog/objectaccess.h.html#LN162"><span class='Ref_to_Macro'>InvokeObjectPostAlterHook</span></a><span class='Parentheses'>(</span><a href="../../include/catalog/pg_extension.h.html#LN28"><span class='Ref_to_Const'>ExtensionRelationId</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Operator'>.</span><a href="../../include/catalog/objectaddress.h.html#LN26"><span class='Ref_to_Member'>objectId</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If get_object_address() opened the relation for us, we close it to keep 
     * the reference count correct - but we retain any locks acquired by 
     * get_object_address() until commit time, to guard against concurrent 
     * activity. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3174"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3174"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="extension.c.html#LN3172"><span class='Ref_To_Local'>extension</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ExecAlterExtensionContentsStmt &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Read the whole of file into memory. 
 * 
 * The file contents are returned as a single palloc'd chunk. For convenience 
 * of the callers, an extra \0 byte is added to the end. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3307"></a><span class='Declare_Function'>read_whole_file</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>filename</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>length</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3309"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3310"></a>    FILE       <span class='Operator'>*</span><span class='Declare_Local'>file</span><span class='Delimiter'>; 
</span><a name="LN3311"></a>    size_t      <span class='Declare_Local'>bytes_to_read</span><span class='Delimiter'>; 
</span><a name="LN3312"></a>    <span class='Control'>struct</span> <a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>fst</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="extension.c.html#LN3312"><span class='Ref_To_Local'>fst</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="extension.c.html#LN3312"><span class='Ref_To_Local'>fst</span></a><span class='Operator'>.</span>st_size <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"file \"%s\" is too large"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="extension.c.html#LN3311"><span class='Ref_To_Local'>bytes_to_read</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>size_t<span class='Parentheses'>) </span><a href="extension.c.html#LN3312"><span class='Ref_To_Local'>fst</span></a><span class='Operator'>.</span>st_size<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="extension.c.html#LN3310"><span class='Ref_To_Local'>file</span></a> <span class='Operator'>= </span><a href="../../include/storage/fd.h.html#LN83"><span class='Ref_to_Proto'>AllocateFile</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>filename</span></a><span class='Delimiter'>, </span><a href="../../tools/entab/entab.c.html#LN12"><span class='Ref_to_Const'>PG_BINARY_R</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open file \"%s\" for reading: %m"</span><span class='Delimiter'>, 
</span>                        <a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN3309"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3311"><span class='Ref_To_Local'>bytes_to_read</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>length</span></a> <span class='Operator'>= </span>fread<span class='Parentheses'>(</span><a href="extension.c.html#LN3309"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="extension.c.html#LN3311"><span class='Ref_To_Local'>bytes_to_read</span></a><span class='Delimiter'>, </span><a href="extension.c.html#LN3310"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>ferror<span class='Parentheses'>(</span><a href="extension.c.html#LN3310"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>))</span> 
        <a href="../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../utils/error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not read file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../include/storage/fd.h.html#LN84"><span class='Ref_to_Proto'>FreeFile</span></a><span class='Parentheses'>(</span><a href="extension.c.html#LN3310"><span class='Ref_To_Local'>file</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="extension.c.html#LN3309"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="extension.c.html#LN3307"><span class='Ref_to_Parameter'>length</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="extension.c.html#LN3309"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end read_whole_file &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>